{
  "version": 3,
  "sources": ["../../blockly/core/registry.ts", "../../blockly/core/utils/idgenerator.ts", "../../blockly/core/events/utils.ts", "../../blockly/core/common.ts", "../../blockly/core/touch.ts", "../../blockly/core/browser_events.ts", "../../blockly/core/utils/array.ts", "../../blockly/core/css.ts", "../../blockly/core/utils/dom.ts", "../../blockly/core/utils/style.ts", "../../blockly/core/utils/svg_math.ts", "../../blockly/core/utils/xml.ts", "../../blockly/core/utils/toolbox.ts", "../../blockly/core/positionable_helpers.ts", "../../blockly/core/dialog.ts", "../../blockly/core/interfaces/i_variable_backed_parameter_model.ts", "../../blockly/core/interfaces/i_legacy_procedure_blocks.ts", "../../blockly/core/variables.ts", "../../blockly/core/render_management.ts", "../../blockly/core/serialization/registry.ts", "../../blockly/core/serialization/workspace_comments.ts", "../../blockly/core/clipboard/registry.ts", "../../blockly/core/clipboard/workspace_comment_paster.ts", "../../blockly/core/utils/aria.ts", "../../blockly/core/interfaces/i_serializable.ts", "../../blockly/core/serialization/blocks.ts", "../../blockly/core/interfaces/i_has_bubble.ts", "../../blockly/core/utils/math.ts", "../../blockly/core/dropdowndiv.ts", "../../blockly/core/utils/string.ts", "../../blockly/core/tooltip.ts", "../../blockly/core/utils/colour.ts", "../../blockly/core/utils/parsing.ts", "../../blockly/core/widgetdiv.ts", "../../blockly/core/contextmenu.ts", "../../blockly/core/xml.ts", "../../blockly/core/block_animations.ts", "../../blockly/core/interfaces/i_draggable.ts", "../../blockly/core/utils/object.ts", "../../blockly/core/interfaces/i_procedure_block.ts", "../../blockly/core/interfaces/i_observable.ts", "../../blockly/core/field_registry.ts", "../../blockly/core/field_dropdown.ts", "../../blockly/core/extensions.ts", "../../blockly/core/utils/deprecation.ts", "../../blockly/core/utils/svg_paths.ts", "../../blockly/core/icons/registry.ts", "../../blockly/core/procedures.ts", "../../blockly/core/renderers/common/constants.ts", "../../blockly/core/connection.ts", "../../blockly/core/interfaces/i_icon.ts", "../../blockly/core/interfaces/i_comment_icon.ts", "../../blockly/core/keyboard_nav/ast_node.ts", "../../blockly/core/renderers/common/block_rendering.ts", "../../blockly/core/variables_dynamic.ts", "../../blockly/core/workspace_svg.ts", "../../blockly/core/clipboard/block_paster.ts", "../../blockly/core/bump_objects.ts", "../../blockly/core/interfaces/i_deletable.ts", "../../blockly/core/clipboard.ts", "../../blockly/core/interfaces/i_copyable.ts", "../../blockly/core/shortcut_items.ts", "../../blockly/core/serialization/procedures.ts", "../../blockly/core/serialization/workspaces.ts", "../../blockly/core/inject.ts", "../../blockly/core/contextmenu_items.ts", "../../blockly/core/interfaces/i_paster.ts", "../../blockly/core/interfaces/i_rendered_element.ts", "../../blockly/core/interfaces/i_selectable.ts", "../../blockly/core/interfaces/i_selectable_toolbox_item.ts", "../../blockly/core/blockly.ts", "../../blockly/src/com/google/javascript/jscomp/js/base.js", "../../blockly/src/com/google/javascript/jscomp/js/util/defines.js", "../../blockly/src/com/google/javascript/jscomp/js/util/defineproperty.js", "../../blockly/src/com/google/javascript/jscomp/js/util/global.js", "../../blockly/src/com/google/javascript/jscomp/js/util/shouldpolyfill.js", "../../blockly/src/com/google/javascript/jscomp/js/util/polyfill.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/setprototypeof.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/arrayiterator.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/makeiterator.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/generator_engine.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/execute_async_generator.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/globalthis.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/includes.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/symbol.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/iteratorfromarray.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/values.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/flat.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/flatmap.js", "../../blockly/src/com/google/javascript/jscomp/js/util/owns.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/entries.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/values.js", "../../blockly/core/blocks.ts", "../../blockly/core/events/events_abstract.ts", "../../blockly/core/events/events_ui_base.ts", "../../blockly/core/events/events_click.ts", "../../blockly/core/utils/useragent.ts", "../../blockly/core/component_manager.ts", "../../blockly/core/utils/coordinate.ts", "../../blockly/core/utils/svg.ts", "../../blockly/core/utils/rect.ts", "../../blockly/core/utils/size.ts", "../../blockly/core/scrollbar.ts", "../../blockly/core/sprites.ts", "../../blockly/core/zoom_controls.ts", "../../blockly/core/constants.ts", "../../blockly/core/icons/icon_types.ts", "../../blockly/core/inputs/input_types.ts", "../../blockly/core/msg.ts", "../../blockly/core/events/events_var_base.ts", "../../blockly/core/events/events_var_create.ts", "../../blockly/core/variable_model.ts", "../../blockly/core/comments/workspace_comment.ts", "../../blockly/core/layers.ts", "../../blockly/core/comments/comment_view.ts", "../../blockly/core/dragging/comment_drag_strategy.ts", "../../blockly/core/serialization/priorities.ts", "../../blockly/core/config.ts", "../../blockly/core/menu.ts", "../../blockly/core/menuitem.ts", "../../blockly/core/serialization/exceptions.ts", "../../blockly/core/events/events_block_base.ts", "../../blockly/core/events/events_block_change.ts", "../../blockly/core/marker_manager.ts", "../../blockly/core/field.ts", "../../blockly/core/contextmenu_registry.ts", "../../blockly/core/comments/rendered_workspace_comment.ts", "../../blockly/core/events/events_block_create.ts", "../../blockly/core/events/events_theme_change.ts", "../../blockly/core/events/events_viewport.ts", "../../blockly/core/connection_type.ts", "../../blockly/core/connection_db.ts", "../../blockly/core/workspace_dragger.ts", "../../blockly/core/gesture.ts", "../../blockly/core/grid.ts", "../../blockly/core/theme.ts", "../../blockly/core/theme/classic.ts", "../../blockly/core/options.ts", "../../blockly/core/names.ts", "../../blockly/core/observable_procedure_map.ts", "../../blockly/core/icons/icon.ts", "../../blockly/core/dragging/bubble_drag_strategy.ts", "../../blockly/core/bubbles/bubble.ts", "../../blockly/core/bubbles/mini_workspace_bubble.ts", "../../blockly/core/icons/mutator_icon.ts", "../../blockly/core/utils/keycodes.ts", "../../blockly/core/utils.ts", "../../blockly/core/bubbles/text_bubble.ts", "../../blockly/core/bubbles/textinput_bubble.ts", "../../blockly/core/icons/comment_icon.ts", "../../blockly/core/icons/warning_icon.ts", "../../blockly/core/icons/exceptions.ts", "../../blockly/core/icons.ts", "../../blockly/core/renderers/measurables/types.ts", "../../blockly/core/renderers/measurables/base.ts", "../../blockly/core/renderers/measurables/row.ts", "../../blockly/core/renderers/measurables/bottom_row.ts", "../../blockly/core/renderers/measurables/connection.ts", "../../blockly/core/renderers/measurables/input_connection.ts", "../../blockly/core/renderers/measurables/external_value_input.ts", "../../blockly/core/renderers/measurables/field.ts", "../../blockly/core/renderers/measurables/hat.ts", "../../blockly/core/renderers/measurables/icon.ts", "../../blockly/core/renderers/measurables/in_row_spacer.ts", "../../blockly/core/renderers/measurables/inline_input.ts", "../../blockly/core/renderers/measurables/statement_input.ts", "../../blockly/core/renderers/measurables/input_row.ts", "../../blockly/core/renderers/measurables/jagged_edge.ts", "../../blockly/core/renderers/measurables/next_connection.ts", "../../blockly/core/renderers/measurables/output_connection.ts", "../../blockly/core/renderers/measurables/previous_connection.ts", "../../blockly/core/renderers/measurables/round_corner.ts", "../../blockly/core/renderers/measurables/spacer_row.ts", "../../blockly/core/renderers/measurables/square_corner.ts", "../../blockly/core/renderers/measurables/top_row.ts", "../../blockly/core/renderers/common/drawer.ts", "../../blockly/core/inputs/align.ts", "../../blockly/core/field_label.ts", "../../blockly/core/inputs/input.ts", "../../blockly/core/inputs/dummy_input.ts", "../../blockly/core/inputs/end_row_input.ts", "../../blockly/core/inputs/statement_input.ts", "../../blockly/core/inputs/value_input.ts", "../../blockly/core/renderers/common/info.ts", "../../blockly/core/events/events_block_delete.ts", "../../blockly/core/block.ts", "../../blockly/core/flyout_button.ts", "../../blockly/core/events/events_marker_move.ts", "../../blockly/core/renderers/common/marker_svg.ts", "../../blockly/core/renderers/common/path_object.ts", "../../blockly/core/insertion_marker_manager.ts", "../../blockly/core/renderers/common/renderer.ts", "../../blockly/core/theme_manager.ts", "../../blockly/core/internal_constants.ts", "../../blockly/core/connection_checker.ts", "../../blockly/core/events/events_var_delete.ts", "../../blockly/core/events/events_var_rename.ts", "../../blockly/core/variable_map.ts", "../../blockly/core/workspace.ts", "../../blockly/core/workspace_audio.ts", "../../blockly/core/layer_manager.ts", "../../blockly/core/events/events_trashcan_open.ts", "../../blockly/core/events/events_selected.ts", "../../blockly/core/keyboard_nav/marker.ts", "../../blockly/core/keyboard_nav/cursor.ts", "../../blockly/core/keyboard_nav/basic_cursor.ts", "../../blockly/core/keyboard_nav/tab_navigate_cursor.ts", "../../blockly/core/rendered_connection.ts", "../../blockly/core/dragging/block_drag_strategy.ts", "../../blockly/core/block_svg.ts", "../../blockly/core/drag_target.ts", "../../blockly/core/delete_area.ts", "../../blockly/core/trashcan.ts", "../../blockly/core/shortcut_registry.ts", "../../blockly/core/serialization/variables.ts", "../../blockly/core/serialization.ts", "../../blockly/core/scrollbar_pair.ts", "../../blockly/core/metrics_manager.ts", "../../blockly/core/main.ts", "../../blockly/core/renderers/zelos/constants.ts", "../../blockly/core/renderers/zelos/drawer.ts", "../../blockly/core/field_image.ts", "../../blockly/core/field_input.ts", "../../blockly/core/field_textinput.ts", "../../blockly/core/renderers/zelos/measurables/bottom_row.ts", "../../blockly/core/renderers/zelos/measurables/inputs.ts", "../../blockly/core/renderers/zelos/measurables/row_elements.ts", "../../blockly/core/renderers/zelos/measurables/top_row.ts", "../../blockly/core/renderers/zelos/info.ts", "../../blockly/core/renderers/zelos/marker_svg.ts", "../../blockly/core/renderers/zelos/path_object.ts", "../../blockly/core/renderers/zelos/renderer.ts", "../../blockly/core/insertion_marker_previewer.ts", "../../blockly/core/inputs.ts", "../../blockly/core/generator.ts", "../../blockly/core/flyout_metrics_manager.ts", "../../blockly/core/flyout_base.ts", "../../blockly/core/flyout_vertical.ts", "../../blockly/core/flyout_horizontal.ts", "../../blockly/core/field_variable.ts", "../../blockly/core/field_number.ts", "../../blockly/core/field_label_serializable.ts", "../../blockly/core/field_checkbox.ts", "../../blockly/core/dragging/dragger.ts", "../../blockly/core/dragging.ts", "../../blockly/core/events/events_block_drag.ts", "../../blockly/core/events/events_block_field_intermediate_change.ts", "../../blockly/core/events/events_block_move.ts", "../../blockly/core/events/events_bubble_open.ts", "../../blockly/core/events/events_comment_base.ts", "../../blockly/core/events/events_comment_change.ts", "../../blockly/core/events/events_comment_create.ts", "../../blockly/core/events/events_comment_delete.ts", "../../blockly/core/events/events_comment_move.ts", "../../blockly/core/events/events_comment_collapse.ts", "../../blockly/core/events/events_toolbox_item_select.ts", "../../blockly/core/events/workspace_events.ts", "../../blockly/core/events/events.ts", "../../blockly/core/renderers/zelos/zelos.ts", "../../blockly/core/comments.ts", "../../blockly/core/bubbles.ts", "../../blockly/core/blockly_options.ts", "../../blockly/core/renderers/geras/constants.ts", "../../blockly/core/renderers/geras/highlighter.ts", "../../blockly/core/renderers/geras/drawer.ts", "../../blockly/core/renderers/geras/highlight_constants.ts", "../../blockly/core/renderers/geras/measurables/inline_input.ts", "../../blockly/core/renderers/geras/measurables/statement_input.ts", "../../blockly/core/renderers/geras/info.ts", "../../blockly/core/renderers/geras/path_object.ts", "../../blockly/core/renderers/geras/renderer.ts", "../../blockly/core/renderers/geras/geras.ts", "../../blockly/core/renderers/thrasos/info.ts", "../../blockly/core/renderers/thrasos/renderer.ts", "../../blockly/core/renderers/thrasos/thrasos.ts", "../../blockly/core/theme/zelos.ts", "../../blockly/core/theme/themes.ts", "../../blockly/core/toolbox/toolbox_item.ts", "../../blockly/core/toolbox/category.ts", "../../blockly/core/toolbox/separator.ts", "../../blockly/core/toolbox/collapsible_category.ts", "../../blockly/core/toolbox/toolbox.ts", "../../blockly/core/utils/metrics.ts", "../../blockly/core/renderers/common/i_path_object.ts", "../../blockly/core/interfaces/i_toolbox_item.ts", "../../blockly/core/interfaces/i_toolbox.ts", "../../blockly/core/interfaces/i_styleable.ts", "../../blockly/core/interfaces/i_serializer.ts", "../../blockly/core/interfaces/i_registrable.ts", "../../blockly/core/interfaces/i_procedure_model.ts", "../../blockly/core/interfaces/i_procedure_map.ts", "../../blockly/core/interfaces/i_positionable.ts", "../../blockly/core/interfaces/i_parameter_model.ts", "../../blockly/core/interfaces/i_movable.ts", "../../blockly/core/interfaces/i_metrics_manager.ts", "../../blockly/core/interfaces/i_keyboard_accessible.ts", "../../blockly/core/interfaces/i_flyout.ts", "../../blockly/core/interfaces/i_dragger.ts", "../../blockly/core/interfaces/i_drag_target.ts", "../../blockly/core/interfaces/i_delete_area.ts", "../../blockly/core/interfaces/i_contextmenu.ts", "../../blockly/core/interfaces/i_connection_previewer.ts", "../../blockly/core/interfaces/i_connection_checker.ts", "../../blockly/core/interfaces/i_component.ts", "../../blockly/core/interfaces/i_collapsible_toolbox_item.ts", "../../blockly/core/interfaces/i_bubble.ts", "../../blockly/core/interfaces/i_bounded_element.ts", "../../blockly/core/interfaces/i_autohideable.ts", "../../blockly/core/interfaces/i_ast_node_location_with_block.ts", "../../blockly/core/interfaces/i_ast_node_location_svg.ts", "../../blockly/core/interfaces/i_ast_node_location.ts"],
  "sourcesContent": ["/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.registry\n\nimport type {Abstract} from './events/events_abstract.js';\nimport type {Field} from './field.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IIcon} from './interfaces/i_icon.js';\nimport type {Input} from './inputs/input.js';\nimport type {ISerializer} from './interfaces/i_serializer.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Options} from './options.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {Theme} from './theme.js';\nimport type {ToolboxItem} from './toolbox/toolbox_item.js';\nimport type {IPaster} from './interfaces/i_paster.js';\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\nimport type {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\nimport type {IDragger} from './interfaces/i_dragger.js';\n\n/**\n * A map of maps. With the keys being the type and name of the class we are\n * registering and the value being the constructor function.\n * e.g. {'field': {'field_angle': Blockly.FieldAngle}}\n */\nconst typeMap: {\n  [key: string]: {\n    [key: string]: (new () => AnyDuringMigration) | AnyDuringMigration;\n  };\n} = Object.create(null);\nexport const TEST_ONLY = {typeMap};\n\n/**\n * A map of maps. With the keys being the type and caseless name of the class we\n * are registring, and the value being the most recent cased name for that\n * registration.\n */\nconst nameMap: {[key: string]: {[key: string]: string}} = Object.create(null);\n\n/**\n * The string used to register the default class for a type of plugin.\n */\nexport const DEFAULT = 'default';\n\n/**\n * A name with the type of the element stored in the generic.\n */\nexport class Type<_T> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /**\n   * Returns the name of the type.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name;\n  }\n\n  static CONNECTION_CHECKER = new Type<IConnectionChecker>('connectionChecker');\n\n  static CONNECTION_PREVIEWER = new Type<IConnectionPreviewer>(\n    'connectionPreviewer',\n  );\n\n  static CURSOR = new Type<Cursor>('cursor');\n\n  static EVENT = new Type<Abstract>('event');\n\n  static FIELD = new Type<Field>('field');\n\n  static INPUT = new Type<Input>('input');\n\n  static RENDERER = new Type<Renderer>('renderer');\n\n  static TOOLBOX = new Type<IToolbox>('toolbox');\n\n  static THEME = new Type<Theme>('theme');\n\n  static TOOLBOX_ITEM = new Type<ToolboxItem>('toolboxItem');\n\n  static FLYOUTS_VERTICAL_TOOLBOX = new Type<IFlyout>('flyoutsVerticalToolbox');\n\n  static FLYOUTS_HORIZONTAL_TOOLBOX = new Type<IFlyout>(\n    'flyoutsHorizontalToolbox',\n  );\n\n  static METRICS_MANAGER = new Type<IMetricsManager>('metricsManager');\n\n  /**\n   * Type for an IDragger. Formerly behavior was mostly covered by\n   * BlockDraggeers, which is why the name is inaccurate.\n   */\n  static BLOCK_DRAGGER = new Type<IDragger>('blockDragger');\n\n  /** @internal */\n  static SERIALIZER = new Type<ISerializer>('serializer');\n\n  /** @internal */\n  static ICON = new Type<IIcon>('icon');\n\n  /** @internal */\n  static PASTER = new Type<IPaster<ICopyData, ICopyable<ICopyData>>>('paster');\n}\n\n/**\n * Registers a class based on a type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param registryItem The class or object to register.\n * @param opt_allowOverrides True to prevent an error when overriding an already\n *     registered item.\n * @throws {Error} if the type or name is empty, a name with the given type has\n *     already been registered, or if the given class or object is not valid for\n *     its type.\n */\nexport function register<T>(\n  type: string | Type<T>,\n  name: string,\n  registryItem:\n    | (new (...p1: AnyDuringMigration[]) => T)\n    | null\n    | AnyDuringMigration,\n  opt_allowOverrides?: boolean,\n): void {\n  if (\n    (!(type instanceof Type) && typeof type !== 'string') ||\n    `${type}`.trim() === ''\n  ) {\n    throw Error(\n      'Invalid type \"' +\n        type +\n        '\". The type must be a' +\n        ' non-empty string or a Blockly.registry.Type.',\n    );\n  }\n  type = `${type}`.toLowerCase();\n\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error(\n      'Invalid name \"' + name + '\". The name must be a' + ' non-empty string.',\n    );\n  }\n  const caselessName = name.toLowerCase();\n  if (!registryItem) {\n    throw Error('Can not register a null value');\n  }\n  let typeRegistry = typeMap[type];\n  let nameRegistry = nameMap[type];\n  // If the type registry has not been created, create it.\n  if (!typeRegistry) {\n    typeRegistry = typeMap[type] = Object.create(null);\n    nameRegistry = nameMap[type] = Object.create(null);\n  }\n\n  // Validate that the given class has all the required properties.\n  validate(type, registryItem);\n\n  // Don't throw an error if opt_allowOverrides is true,\n  // or if we're trying to register the same item.\n  if (\n    !opt_allowOverrides &&\n    typeRegistry[caselessName] &&\n    typeRegistry[caselessName] !== registryItem\n  ) {\n    throw Error(\n      'Name \"' +\n        caselessName +\n        '\" with type \"' +\n        type +\n        '\" already registered.',\n    );\n  }\n  typeRegistry[caselessName] = registryItem;\n  nameRegistry[caselessName] = name;\n}\n\n/**\n * Checks the given registry item for properties that are required based on the\n * type.\n *\n * @param type The type of the plugin. (e.g. Field, Renderer)\n * @param registryItem A class or object that we are checking for the required\n *     properties.\n */\nfunction validate(type: string, registryItem: Function | AnyDuringMigration) {\n  switch (type) {\n    case String(Type.FIELD):\n      if (typeof registryItem.fromJson !== 'function') {\n        throw Error('Type \"' + type + '\" must have a fromJson function');\n      }\n      break;\n  }\n}\n\n/**\n * Unregisters the registry item with the given type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n */\nexport function unregister<T>(type: string | Type<T>, name: string) {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    console.warn(\n      'Unable to unregister [' +\n        name +\n        '][' +\n        type +\n        '] from the ' +\n        'registry.',\n    );\n    return;\n  }\n  delete typeMap[type][name];\n  delete nameMap[type][name];\n}\n\n/**\n * Gets the registry item for the given name and type. This can be either a\n * class or an object.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class or object with the given name and type or null if none\n *     exists.\n */\nfunction getItem<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null | AnyDuringMigration {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    const msg = 'Unable to find [' + name + '][' + type + '] in the registry.';\n    if (opt_throwIfMissing) {\n      throw new Error(\n        msg + ' You must require or register a ' + type + ' plugin.',\n      );\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  return typeRegistry[name];\n}\n\n/**\n * Returns whether or not the registry contains an item with the given type and\n * name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @returns True if the registry has an item with the given type and name, false\n *     otherwise.\n */\nexport function hasItem<T>(type: string | Type<T>, name: string): boolean {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    return false;\n  }\n  return !!typeRegistry[name];\n}\n\n/**\n * Gets the class for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class with the given name and type or null if none exists.\n */\nexport function getClass<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null {\n  return getItem(type, name, opt_throwIfMissing) as\n    | (new (...p1: AnyDuringMigration[]) => T)\n    | null;\n}\n\n/**\n * Gets the object for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Category)\n * @param name The plugin's name. (Ex. logic_category)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object.\n * @returns The object with the given name and type or null if none exists.\n */\nexport function getObject<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): T | null {\n  return getItem(type, name, opt_throwIfMissing) as T;\n}\n\n/**\n * Returns a map of items registered with the given type.\n *\n * @param type The type of the plugin. (e.g. Category)\n * @param opt_cased Whether or not to return a map with cased keys (rather than\n *     caseless keys). False by default.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object. False by default.\n * @returns A map of objects with the given type, or null if none exists.\n */\nexport function getAllItems<T>(\n  type: string | Type<T>,\n  opt_cased?: boolean,\n  opt_throwIfMissing?: boolean,\n): {[key: string]: T | null | (new (...p1: AnyDuringMigration[]) => T)} | null {\n  type = `${type}`.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    const msg = `Unable to find [${type}] in the registry.`;\n    if (opt_throwIfMissing) {\n      throw new Error(`${msg} You must require or register a ${type} plugin.`);\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  if (!opt_cased) {\n    return typeRegistry;\n  }\n  const nameRegistry = nameMap[type];\n  const casedRegistry = Object.create(null);\n  for (const key of Object.keys(typeRegistry)) {\n    casedRegistry[nameRegistry[key]] = typeRegistry[key];\n  }\n  return casedRegistry;\n}\n\n/**\n * Gets the class from Blockly options for the given type.\n * This is used for plugins that override a built in feature. (e.g. Toolbox)\n *\n * @param type The type of the plugin.\n * @param options The option object to check for the given plugin.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class for the plugin.\n */\nexport function getClassFromOptions<T>(\n  type: Type<T>,\n  options: Options,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null {\n  const plugin = options.plugins[String(type)] || DEFAULT;\n\n  // If the user passed in a plugin class instead of a registered plugin name.\n  if (typeof plugin === 'function') {\n    return plugin;\n  }\n  return getClass(type, plugin, opt_throwIfMissing);\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.idGenerator\n\n/**\n * Legal characters for the universally unique IDs.  Should be all on\n * a US keyboard.  No characters that conflict with XML or JSON.\n * Requests to remove additional 'problematic' characters from this\n * soup will be denied.  That's your failure to properly escape in\n * your own environment.  Issues #251, #625, #682, #1304.\n */\nconst soup =\n  '!#$%()*+,-./:;=?@[]^_`{|}~' +\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n/**\n * Namespace object for internal implementations we want to be able to\n * stub in tests. Do not use externally.\n *\n * @internal\n */\nconst internal = {\n  /**\n   * Generate a random unique ID.  This should be globally unique.\n   * 87 characters ^ 20 length is greater than 128 bits (better than a UUID).\n   *\n   * @returns A globally unique ID string.\n   */\n  genUid: () => {\n    const length = 20;\n    const soupLength = soup.length;\n    const id = [];\n    for (let i = 0; i < length; i++) {\n      id[i] = soup.charAt(Math.random() * soupLength);\n    }\n    return id.join('');\n  },\n};\nexport const TEST_ONLY = internal;\n\n/** Next unique ID to use. */\nlet nextId = 0;\n\n/**\n * Generate the next unique element IDs.\n * IDs are compatible with the HTML4 'id' attribute restrictions:\n * Use only ASCII letters, digits, '_', '-' and '.'\n *\n * For UUIDs use genUid (below) instead; this ID generator should\n * primarily be used for IDs that end up in the DOM.\n *\n * @returns The next unique identifier.\n */\nexport function getNextUniqueId(): string {\n  return 'blockly-' + (nextId++).toString(36);\n}\n\n/**\n * Generate a random unique ID.\n *\n * @see internal.genUid\n * @returns A globally unique ID string.\n */\nexport function genUid(): string {\n  return internal.genUid();\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.utils\n\nimport type {Block} from '../block.js';\nimport * as common from '../common.js';\nimport * as registry from '../registry.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type {Workspace} from '../workspace.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {Abstract} from './events_abstract.js';\nimport type {BlockChange} from './events_block_change.js';\nimport type {BlockCreate} from './events_block_create.js';\nimport type {BlockMove} from './events_block_move.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentMove} from './events_comment_move.js';\nimport type {ViewportChange} from './events_viewport.js';\n\n/** Group ID for new events.  Grouped events are indivisible. */\nlet group = '';\n\n/** Sets whether the next event should be added to the undo stack. */\nlet recordUndo = true;\n\n/**\n * Sets whether events should be added to the undo stack.\n *\n * @param newValue True if events should be added to the undo stack.\n */\nexport function setRecordUndo(newValue: boolean) {\n  recordUndo = newValue;\n}\n\n/**\n * Returns whether or not events will be added to the undo stack.\n *\n * @returns True if events will be added to the undo stack.\n */\nexport function getRecordUndo(): boolean {\n  return recordUndo;\n}\n\n/** Allow change events to be created and fired. */\nlet disabled = 0;\n\n/**\n * Name of event that creates a block. Will be deprecated for BLOCK_CREATE.\n */\nexport const CREATE = 'create';\n\n/**\n * Name of event that creates a block.\n */\nexport const BLOCK_CREATE = CREATE;\n\n/**\n * Name of event that deletes a block. Will be deprecated for BLOCK_DELETE.\n */\nexport const DELETE = 'delete';\n\n/**\n * Name of event that deletes a block.\n */\nexport const BLOCK_DELETE = DELETE;\n\n/**\n * Name of event that changes a block. Will be deprecated for BLOCK_CHANGE.\n */\nexport const CHANGE = 'change';\n\n/**\n * Name of event that changes a block.\n */\nexport const BLOCK_CHANGE = CHANGE;\n\n/**\n * Name of event representing an in-progress change to a field of a block, which\n * is expected to be followed by a block change event.\n */\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\n  'block_field_intermediate_change';\n\n/**\n * Name of event that moves a block. Will be deprecated for BLOCK_MOVE.\n */\nexport const MOVE = 'move';\n\n/**\n * Name of event that moves a block.\n */\nexport const BLOCK_MOVE = MOVE;\n\n/**\n * Name of event that creates a variable.\n */\nexport const VAR_CREATE = 'var_create';\n\n/**\n * Name of event that deletes a variable.\n */\nexport const VAR_DELETE = 'var_delete';\n\n/**\n * Name of event that renames a variable.\n */\nexport const VAR_RENAME = 'var_rename';\n\n/**\n * Name of generic event that records a UI change.\n */\nexport const UI = 'ui';\n\n/**\n * Name of event that record a block drags a block.\n */\nexport const BLOCK_DRAG = 'drag';\n\n/**\n * Name of event that records a change in selected element.\n */\nexport const SELECTED = 'selected';\n\n/**\n * Name of event that records a click.\n */\nexport const CLICK = 'click';\n\n/**\n * Name of event that records a marker move.\n */\nexport const MARKER_MOVE = 'marker_move';\n\n/**\n * Name of event that records a bubble open.\n */\nexport const BUBBLE_OPEN = 'bubble_open';\n\n/**\n * Name of event that records a trashcan open.\n */\nexport const TRASHCAN_OPEN = 'trashcan_open';\n\n/**\n * Name of event that records a toolbox item select.\n */\nexport const TOOLBOX_ITEM_SELECT = 'toolbox_item_select';\n\n/**\n * Name of event that records a theme change.\n */\nexport const THEME_CHANGE = 'theme_change';\n\n/**\n * Name of event that records a viewport change.\n */\nexport const VIEWPORT_CHANGE = 'viewport_change';\n\n/**\n * Name of event that creates a comment.\n */\nexport const COMMENT_CREATE = 'comment_create';\n\n/**\n * Name of event that deletes a comment.\n */\nexport const COMMENT_DELETE = 'comment_delete';\n\n/**\n * Name of event that changes a comment.\n */\nexport const COMMENT_CHANGE = 'comment_change';\n\n/**\n * Name of event that moves a comment.\n */\nexport const COMMENT_MOVE = 'comment_move';\n\n/** Type of event that moves a comment. */\nexport const COMMENT_COLLAPSE = 'comment_collapse';\n\n/**\n * Name of event that records a workspace load.\n */\nexport const FINISHED_LOADING = 'finished_loading';\n\n/**\n * The language-neutral ID for when the reason why a block is disabled is\n * because the block is not descended from a root block.\n */\nconst ORPHANED_BLOCK_DISABLED_REASON = 'ORPHANED_BLOCK';\n\n/**\n * Type of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport type BumpEvent = BlockCreate | BlockMove | CommentCreate | CommentMove;\n\n/**\n * List of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport const BUMP_EVENTS: string[] = [\n  BLOCK_CREATE,\n  BLOCK_MOVE,\n  COMMENT_CREATE,\n  COMMENT_MOVE,\n];\n\n/** List of events queued for firing. */\nconst FIRE_QUEUE: Abstract[] = [];\n\n/**\n * Create a custom event and fire it.\n *\n * @param event Custom data for event.\n */\nexport function fire(event: Abstract) {\n  TEST_ONLY.fireInternal(event);\n}\n\n/**\n * Private version of fireInternal for stubbing in tests.\n */\nfunction fireInternal(event: Abstract) {\n  if (!isEnabled()) {\n    return;\n  }\n  if (!FIRE_QUEUE.length) {\n    // First event added; schedule a firing of the event queue.\n    try {\n      // If we are in a browser context, we want to make sure that the event\n      // fires after blocks have been rerendered this frame.\n      requestAnimationFrame(() => {\n        setTimeout(fireNow, 0);\n      });\n    } catch (e) {\n      // Otherwise we just want to delay so events can be coallesced.\n      // requestAnimationFrame will error triggering this.\n      setTimeout(fireNow, 0);\n    }\n  }\n  FIRE_QUEUE.push(event);\n}\n\n/** Fire all queued events. */\nfunction fireNow() {\n  const queue = filter(FIRE_QUEUE, true);\n  FIRE_QUEUE.length = 0;\n  for (let i = 0, event; (event = queue[i]); i++) {\n    if (!event.workspaceId) {\n      continue;\n    }\n    const eventWorkspace = common.getWorkspaceById(event.workspaceId);\n    if (eventWorkspace) {\n      eventWorkspace.fireChangeListener(event);\n    }\n  }\n\n  // Post-filter the undo stack to squash and remove any events that result in\n  // a null event\n\n  // 1. Determine which workspaces will need to have their undo stacks validated\n  const workspaceIds = new Set(queue.map((e) => e.workspaceId));\n  for (const workspaceId of workspaceIds) {\n    // Only process valid workspaces\n    if (!workspaceId) {\n      continue;\n    }\n    const eventWorkspace = common.getWorkspaceById(workspaceId);\n    if (!eventWorkspace) {\n      continue;\n    }\n\n    // Find the last contiguous group of events on the stack\n    const undoStack = eventWorkspace.getUndoStack();\n    let i;\n    let group: string | undefined = undefined;\n    for (i = undoStack.length; i > 0; i--) {\n      const event = undoStack[i - 1];\n      if (event.group === '') {\n        break;\n      } else if (group === undefined) {\n        group = event.group;\n      } else if (event.group !== group) {\n        break;\n      }\n    }\n    if (!group || i == undoStack.length - 1) {\n      // Need a group of two or more events on the stack. Nothing to do here.\n      continue;\n    }\n\n    // Extract the event group, filter, and add back to the undo stack\n    let events = undoStack.splice(i, undoStack.length - i);\n    events = filter(events, true);\n    undoStack.push(...events);\n  }\n}\n\n/**\n * Filter the queued events and merge duplicates.\n *\n * @param queueIn Array of events.\n * @param forward True if forward (redo), false if backward (undo).\n * @returns Array of filtered events.\n */\nexport function filter(queueIn: Abstract[], forward: boolean): Abstract[] {\n  let queue = queueIn.slice();\n  // Shallow copy of queue.\n  if (!forward) {\n    // Undo is merged in reverse order.\n    queue.reverse();\n  }\n  const mergedQueue = [];\n  const hash = Object.create(null);\n  // Merge duplicates.\n  for (let i = 0, event; (event = queue[i]); i++) {\n    if (!event.isNull()) {\n      // Treat all UI events as the same type in hash table.\n      const eventType = event.isUiEvent ? UI : event.type;\n      // TODO(#5927): Check whether `blockId` exists before accessing it.\n      const blockId = (event as AnyDuringMigration).blockId;\n      const key = [eventType, blockId, event.workspaceId].join(' ');\n\n      const lastEntry = hash[key];\n      const lastEvent = lastEntry ? lastEntry.event : null;\n      if (!lastEntry) {\n        // Each item in the hash table has the event and the index of that event\n        // in the input array.  This lets us make sure we only merge adjacent\n        // move events.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      } else if (event.type === MOVE && lastEntry.index === i - 1) {\n        const moveEvent = event as BlockMove;\n        // Merge move events.\n        lastEvent.newParentId = moveEvent.newParentId;\n        lastEvent.newInputName = moveEvent.newInputName;\n        lastEvent.newCoordinate = moveEvent.newCoordinate;\n        if (moveEvent.reason) {\n          if (lastEvent.reason) {\n            // Concatenate reasons without duplicates.\n            const reasonSet = new Set(\n              moveEvent.reason.concat(lastEvent.reason),\n            );\n            lastEvent.reason = Array.from(reasonSet);\n          } else {\n            lastEvent.reason = moveEvent.reason;\n          }\n        }\n        lastEntry.index = i;\n      } else if (\n        event.type === CHANGE &&\n        (event as BlockChange).element === lastEvent.element &&\n        (event as BlockChange).name === lastEvent.name\n      ) {\n        const changeEvent = event as BlockChange;\n        // Merge change events.\n        lastEvent.newValue = changeEvent.newValue;\n      } else if (event.type === VIEWPORT_CHANGE) {\n        const viewportEvent = event as ViewportChange;\n        // Merge viewport change events.\n        lastEvent.viewTop = viewportEvent.viewTop;\n        lastEvent.viewLeft = viewportEvent.viewLeft;\n        lastEvent.scale = viewportEvent.scale;\n        lastEvent.oldScale = viewportEvent.oldScale;\n      } else if (event.type === CLICK && lastEvent.type === BUBBLE_OPEN) {\n        // Drop click events caused by opening/closing bubbles.\n      } else {\n        // Collision: newer events should merge into this event to maintain\n        // order.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      }\n    }\n  }\n  // Filter out any events that have become null due to merging.\n  queue = mergedQueue.filter(function (e) {\n    return !e.isNull();\n  });\n  if (!forward) {\n    // Restore undo order.\n    queue.reverse();\n  }\n  // Move mutation events to the top of the queue.\n  // Intentionally skip first event.\n  for (let i = 1, event; (event = queue[i]); i++) {\n    // AnyDuringMigration because:  Property 'element' does not exist on type\n    // 'Abstract'.\n    if (\n      event.type === CHANGE &&\n      (event as AnyDuringMigration).element === 'mutation'\n    ) {\n      queue.unshift(queue.splice(i, 1)[0]);\n    }\n  }\n  return queue;\n}\n\n/**\n * Modify pending undo events so that when they are fired they don't land\n * in the undo stack.  Called by Workspace.clearUndo.\n */\nexport function clearPendingUndo() {\n  for (let i = 0, event; (event = FIRE_QUEUE[i]); i++) {\n    event.recordUndo = false;\n  }\n}\n\n/**\n * Stop sending events.  Every call to this function MUST also call enable.\n */\nexport function disable() {\n  disabled++;\n}\n\n/**\n * Start sending events.  Unless events were already disabled when the\n * corresponding call to disable was made.\n */\nexport function enable() {\n  disabled--;\n}\n\n/**\n * Returns whether events may be fired or not.\n *\n * @returns True if enabled.\n */\nexport function isEnabled(): boolean {\n  return disabled === 0;\n}\n\n/**\n * Current group.\n *\n * @returns ID string.\n */\nexport function getGroup(): string {\n  return group;\n}\n\n/**\n * Start or stop a group.\n *\n * @param state True to start new group, false to end group.\n *   String to set group explicitly.\n */\nexport function setGroup(state: boolean | string) {\n  TEST_ONLY.setGroupInternal(state);\n}\n\n/**\n * Private version of setGroup for stubbing in tests.\n */\nfunction setGroupInternal(state: boolean | string) {\n  if (typeof state === 'boolean') {\n    group = state ? idGenerator.genUid() : '';\n  } else {\n    group = state;\n  }\n}\n\n/**\n * Compute a list of the IDs of the specified block and all its descendants.\n *\n * @param block The root block.\n * @returns List of block IDs.\n * @internal\n */\nexport function getDescendantIds(block: Block): string[] {\n  const ids = [];\n  const descendants = block.getDescendants(false);\n  for (let i = 0, descendant; (descendant = descendants[i]); i++) {\n    ids[i] = descendant.id;\n  }\n  return ids;\n}\n\n/**\n * Decode the JSON into an event.\n *\n * @param json JSON representation.\n * @param workspace Target workspace for event.\n * @returns The event represented by the JSON.\n * @throws {Error} if an event type is not found in the registry.\n */\nexport function fromJson(\n  json: AnyDuringMigration,\n  workspace: Workspace,\n): Abstract {\n  const eventClass = get(json['type']);\n  if (!eventClass) throw Error('Unknown event type.');\n\n  return (eventClass as any).fromJson(json, workspace);\n}\n\n/**\n * Gets the class for a specific event type from the registry.\n *\n * @param eventType The type of the event to get.\n * @returns The event class with the given type.\n */\nexport function get(\n  eventType: string,\n): new (...p1: AnyDuringMigration[]) => Abstract {\n  const event = registry.getClass(registry.Type.EVENT, eventType);\n  if (!event) {\n    throw new Error(`Event type ${eventType} not found in registry.`);\n  }\n  return event;\n}\n\n/**\n * Set if a block is disabled depending on whether it is properly connected.\n * Use this on applications where all blocks should be connected to a top block.\n *\n * @param event Custom data for event.\n */\nexport function disableOrphans(event: Abstract) {\n  if (event.type === MOVE || event.type === CREATE) {\n    const blockEvent = event as BlockMove | BlockCreate;\n    if (!blockEvent.workspaceId) {\n      return;\n    }\n    const eventWorkspace = common.getWorkspaceById(\n      blockEvent.workspaceId,\n    ) as WorkspaceSvg;\n    if (!blockEvent.blockId) {\n      throw new Error('Encountered a blockEvent without a proper blockId');\n    }\n    let block = eventWorkspace.getBlockById(blockEvent.blockId);\n    if (block) {\n      // Changing blocks as part of this event shouldn't be undoable.\n      const initialUndoFlag = recordUndo;\n      try {\n        recordUndo = false;\n        const parent = block.getParent();\n        if (\n          parent &&\n          !parent.hasDisabledReason(ORPHANED_BLOCK_DISABLED_REASON)\n        ) {\n          const children = block.getDescendants(false);\n          for (let i = 0, child; (child = children[i]); i++) {\n            child.setDisabledReason(false, ORPHANED_BLOCK_DISABLED_REASON);\n          }\n        } else if (\n          (block.outputConnection || block.previousConnection) &&\n          !eventWorkspace.isDragging()\n        ) {\n          do {\n            block.setDisabledReason(true, ORPHANED_BLOCK_DISABLED_REASON);\n            block = block.getNextBlock();\n          } while (block);\n        }\n      } finally {\n        recordUndo = initialUndoFlag;\n      }\n    }\n  }\n}\n\nexport const TEST_ONLY = {\n  FIRE_QUEUE,\n  fireNow,\n  fireInternal,\n  setGroupInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.common\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Block} from './block.js';\nimport {ISelectable} from './blockly.js';\nimport {BlockDefinition, Blocks} from './blocks.js';\nimport type {Connection} from './connection.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as eventUtils from './events/utils.js';\n\n/** Database of all workspaces. */\nconst WorkspaceDB_ = Object.create(null);\n\n/**\n * Find the workspace with the specified ID.\n *\n * @param id ID of workspace to find.\n * @returns The sought after workspace or null if not found.\n */\nexport function getWorkspaceById(id: string): Workspace | null {\n  return WorkspaceDB_[id] || null;\n}\n\n/**\n * Find all workspaces.\n *\n * @returns Array of workspaces.\n */\nexport function getAllWorkspaces(): Workspace[] {\n  const workspaces = [];\n  for (const workspaceId in WorkspaceDB_) {\n    workspaces.push(WorkspaceDB_[workspaceId]);\n  }\n  return workspaces;\n}\n\n/**\n * Register a workspace in the workspace db.\n *\n * @param workspace\n */\nexport function registerWorkspace(workspace: Workspace) {\n  WorkspaceDB_[workspace.id] = workspace;\n}\n\n/**\n * Unregister a workspace from the workspace db.\n *\n * @param workspace\n */\nexport function unregisterWorkpace(workspace: Workspace) {\n  delete WorkspaceDB_[workspace.id];\n}\n\n/**\n * The main workspace most recently used.\n * Set by Blockly.WorkspaceSvg.prototype.markFocused\n */\nlet mainWorkspace: Workspace;\n\n/**\n * Returns the last used top level workspace (based on focus).  Try not to use\n * this function, particularly if there are multiple Blockly instances on a\n * page.\n *\n * @returns The main workspace.\n */\nexport function getMainWorkspace(): Workspace {\n  return mainWorkspace;\n}\n\n/**\n * Sets last used main workspace.\n *\n * @param workspace The most recently used top level workspace.\n */\nexport function setMainWorkspace(workspace: Workspace) {\n  mainWorkspace = workspace;\n}\n\n/**\n * Currently selected copyable object.\n */\nlet selected: ISelectable | null = null;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport function getSelected(): ISelectable | null {\n  return selected;\n}\n\n/**\n * Sets the currently selected block. This function does not visually mark the\n * block as selected or fire the required events. If you wish to\n * programmatically select a block, use `BlockSvg#select`.\n *\n * @param newSelection The newly selected block.\n * @internal\n */\nexport function setSelected(newSelection: ISelectable | null) {\n  if (selected === newSelection) return;\n\n  const event = new (eventUtils.get(eventUtils.SELECTED))(\n    selected?.id ?? null,\n    newSelection?.id ?? null,\n    newSelection?.workspace.id ?? selected?.workspace.id ?? '',\n  );\n  eventUtils.fire(event);\n\n  selected?.unselect();\n  selected = newSelection;\n  selected?.select();\n}\n\n/**\n * Container element in which to render the WidgetDiv, DropDownDiv and Tooltip.\n */\nlet parentContainer: Element | null;\n\n/**\n * Get the container element in which to render the WidgetDiv, DropDownDiv and\n * Tooltip.\n *\n * @returns The parent container.\n */\nexport function getParentContainer(): Element | null {\n  return parentContainer;\n}\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * DropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param newParent The container element.\n */\nexport function setParentContainer(newParent: Element) {\n  parentContainer = newParent;\n}\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n */\nexport function svgResize(workspace: WorkspaceSvg) {\n  let mainWorkspace = workspace;\n  while (mainWorkspace.options.parentWorkspace) {\n    mainWorkspace = mainWorkspace.options.parentWorkspace;\n  }\n  const svg = mainWorkspace.getParentSvg();\n  const cachedSize = mainWorkspace.getCachedParentSvgSize();\n  const div = svg.parentElement;\n  if (!(div instanceof HTMLElement)) {\n    // Workspace deleted, or something.\n    return;\n  }\n\n  const width = div.offsetWidth;\n  const height = div.offsetHeight;\n  if (cachedSize.width !== width) {\n    svg.setAttribute('width', width + 'px');\n    mainWorkspace.setCachedParentSvgSize(width, null);\n  }\n  if (cachedSize.height !== height) {\n    svg.setAttribute('height', height + 'px');\n    mainWorkspace.setCachedParentSvgSize(null, height);\n  }\n  mainWorkspace.resize();\n}\n\n/**\n * All of the connections on blocks that are currently being dragged.\n */\nexport const draggingConnections: Connection[] = [];\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following\n *    statements (blocks that are not inside a value or statement input\n *    of the block).\n * @returns Map of types to type counts for descendants of the bock.\n */\nexport function getBlockTypeCounts(\n  block: Block,\n  opt_stripFollowing?: boolean,\n): {[key: string]: number} {\n  const typeCountsMap = Object.create(null);\n  const descendants = block.getDescendants(true);\n  if (opt_stripFollowing) {\n    const nextBlock = block.getNextBlock();\n    if (nextBlock) {\n      const index = descendants.indexOf(nextBlock);\n      descendants.splice(index, descendants.length - index);\n    }\n  }\n  for (let i = 0, checkBlock; (checkBlock = descendants[i]); i++) {\n    if (typeCountsMap[checkBlock.type]) {\n      typeCountsMap[checkBlock.type]++;\n    } else {\n      typeCountsMap[checkBlock.type] = 1;\n    }\n  }\n  return typeCountsMap;\n}\n\n/**\n * Helper function for defining a block from JSON.  The resulting function has\n * the correct value of jsonDef at the point in code where jsonInit is called.\n *\n * @param jsonDef The JSON definition of a block.\n * @returns A function that calls jsonInit with the correct value\n *     of jsonDef.\n */\nfunction jsonInitFactory(jsonDef: AnyDuringMigration): () => void {\n  return function (this: Block) {\n    this.jsonInit(jsonDef);\n  };\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n */\nexport function defineBlocksWithJsonArray(jsonArray: AnyDuringMigration[]) {\n  TEST_ONLY.defineBlocksWithJsonArrayInternal(jsonArray);\n}\n\n/**\n * Private version of defineBlocksWithJsonArray for stubbing in tests.\n */\nfunction defineBlocksWithJsonArrayInternal(jsonArray: AnyDuringMigration[]) {\n  defineBlocks(createBlockDefinitionsFromJsonArray(jsonArray));\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @returns A map of the block\n *     definitions created.\n */\nexport function createBlockDefinitionsFromJsonArray(\n  jsonArray: AnyDuringMigration[],\n): {[key: string]: BlockDefinition} {\n  const blocks: {[key: string]: BlockDefinition} = {};\n  for (let i = 0; i < jsonArray.length; i++) {\n    const elem = jsonArray[i];\n    if (!elem) {\n      console.warn(`Block definition #${i} in JSON array is ${elem}. Skipping`);\n      continue;\n    }\n    const type = elem['type'];\n    if (!type) {\n      console.warn(\n        `Block definition #${i} in JSON array is missing a type attribute. ` +\n          'Skipping.',\n      );\n      continue;\n    }\n    blocks[type] = {init: jsonInitFactory(elem)};\n  }\n  return blocks;\n}\n\n/**\n * Add the specified block definitions to the block definitions\n * dictionary (Blockly.Blocks).\n *\n * @param blocks A map of block\n *     type names to block definitions.\n */\nexport function defineBlocks(blocks: {[key: string]: BlockDefinition}) {\n  // Iterate over own enumerable properties.\n  for (const type of Object.keys(blocks)) {\n    const definition = blocks[type];\n    if (type in Blocks) {\n      console.warn(\n        `Block definition \"${type}\" overwrites previous definition.`,\n      );\n    }\n    Blocks[type] = definition;\n  }\n}\n\nexport const TEST_ONLY = {defineBlocksWithJsonArrayInternal};\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Touch\n\nimport type {Gesture} from './gesture.js';\n\n/** Length in ms for a touch to become a long press. */\nconst LONGPRESS = 750;\n\n/**\n * Whether touch is enabled in the browser.\n * Copied from Closure's goog.events.BrowserFeature.TOUCH_ENABLED\n */\nexport const TOUCH_ENABLED =\n  'ontouchstart' in globalThis ||\n  !!(\n    globalThis['document'] &&\n    document.documentElement &&\n    'ontouchstart' in document.documentElement\n  ) || // IE10 uses non-standard touch events,\n  // so it has a different check.\n  !!(\n    globalThis['navigator'] &&\n    (globalThis['navigator']['maxTouchPoints'] ||\n      (globalThis['navigator'] as any)['msMaxTouchPoints'])\n  );\n\n/** Which touch events are we currently paying attention to? */\nlet touchIdentifier_: string | null = null;\n\n/**\n * The TOUCH_MAP lookup dictionary specifies additional touch events to fire,\n * in conjunction with mouse events.\n */\nexport const TOUCH_MAP: {[key: string]: string[]} = {\n  'mousedown': ['pointerdown'],\n  'mouseenter': ['pointerenter'],\n  'mouseleave': ['pointerleave'],\n  'mousemove': ['pointermove'],\n  'mouseout': ['pointerout'],\n  'mouseover': ['pointerover'],\n  'mouseup': ['pointerup', 'pointercancel'],\n  'touchend': ['pointerup'],\n  'touchcancel': ['pointercancel'],\n};\n\n/** PID of queued long-press task. */\nlet longPid_: AnyDuringMigration = 0;\n\n/**\n * Context menus on touch devices are activated using a long-press.\n * Unfortunately the contextmenu touch event is currently (2015) only supported\n * by Chrome.  This function is fired on any touchstart event, queues a task,\n * which after about a second opens the context menu.  The tasks is killed\n * if the touch event terminates early.\n *\n * @param e Touch start event.\n * @param gesture The gesture that triggered this longStart.\n * @internal\n */\nexport function longStart(e: PointerEvent, gesture: Gesture) {\n  longStop();\n  longPid_ = setTimeout(function () {\n    // Let the gesture route the right-click correctly.\n    if (gesture) {\n      gesture.handleRightClick(e);\n    }\n  }, LONGPRESS);\n}\n\n/**\n * Nope, that's not a long-press.  Either touchend or touchcancel was fired,\n * or a drag hath begun.  Kill the queued long-press task.\n *\n * @internal\n */\nexport function longStop() {\n  if (longPid_) {\n    clearTimeout(longPid_);\n    longPid_ = 0;\n  }\n}\n\n/**\n * Clear the touch identifier that tracks which touch stream to pay attention\n * to.  This ends the current drag/gesture and allows other pointers to be\n * captured.\n */\nexport function clearTouchIdentifier() {\n  touchIdentifier_ = null;\n}\n\n/**\n * Decide whether Blockly should handle or ignore this event.\n * Mouse and touch events require special checks because we only want to deal\n * with one touch stream at a time.  All other events should always be handled.\n *\n * @param e The event to check.\n * @returns True if this event should be passed through to the registered\n *     handler; false if it should be blocked.\n */\nexport function shouldHandleEvent(e: Event): boolean {\n  // Do not replace the startsWith with a check for `instanceof PointerEvent`.\n  // `click` and `contextmenu` are PointerEvents in some browsers,\n  // despite not starting with `pointer`, but we want to always handle them\n  // without worrying about touch identifiers.\n  return (\n    !e.type.startsWith('pointer') ||\n    (e instanceof PointerEvent && checkTouchIdentifier(e))\n  );\n}\n\n/**\n * Get the pointer identifier from the given event.\n *\n * @param e Pointer event.\n * @returns The pointerId of the event.\n */\nexport function getTouchIdentifierFromEvent(e: PointerEvent): string {\n  return `${e.pointerId}`;\n}\n\n/**\n * Check whether the pointer identifier on the event matches the current saved\n * identifier. If the current identifier was unset, save the identifier from\n * the event. This starts a drag/gesture, during which pointer events with\n * other identifiers will be silently ignored.\n *\n * @param e Pointer event.\n * @returns Whether the identifier on the event matches the current saved\n *     identifier.\n */\nexport function checkTouchIdentifier(e: PointerEvent): boolean {\n  const identifier = getTouchIdentifierFromEvent(e);\n\n  if (touchIdentifier_) {\n    // We're already tracking some touch/mouse event.  Is this from the same\n    // source?\n    return touchIdentifier_ === identifier;\n  }\n  if (e.type === 'pointerdown') {\n    // No identifier set yet, and this is the start of a drag.  Set it and\n    // return.\n    touchIdentifier_ = identifier;\n    return true;\n  }\n  // There was no identifier yet, but this wasn't a start event so we're going\n  // to ignore it.  This probably means that another drag finished while this\n  // pointer was down.\n  return false;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.browserEvents\n\nimport * as Touch from './touch.js';\nimport * as userAgent from './utils/useragent.js';\n\n/**\n * Blockly opaque event data used to unbind events when using\n * `bind` and `conditionalBind`.\n */\nexport type Data = [EventTarget, string, (e: Event) => void][];\n\n/**\n * The multiplier for scroll wheel deltas using the line delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst LINE_MODE_MULTIPLIER = 40;\n\n/**\n * The multiplier for scroll wheel deltas using the page delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst PAGE_MODE_MULTIPLIER = 125;\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function conditionalBind(\n  node: EventTarget,\n  name: string,\n  thisObject: Object | null,\n  func: Function,\n  opt_noCaptureIdentifier?: boolean,\n): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    const captureIdentifier = !opt_noCaptureIdentifier;\n\n    if (!(captureIdentifier && !Touch.shouldHandleEvent(e))) {\n      if (thisObject) {\n        func.call(thisObject, e);\n      } else {\n        func(e);\n      }\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function bind(\n  node: EventTarget,\n  name: string,\n  thisObject: Object | null,\n  func: Function,\n): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    if (thisObject) {\n      func.call(thisObject, e);\n    } else {\n      func(e);\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n */\nexport function unbind(bindData: Data): (e: Event) => void {\n  // Accessing an element of the last property of the array is unsafe if the\n  // bindData is an empty array. But that should never happen because developers\n  // should only pass Data from bind or conditionalBind.\n  const callback = bindData[bindData.length - 1][2];\n  while (bindData.length) {\n    const [node, name, func] = bindData.pop()!;\n    node.removeEventListener(name, func, false);\n  }\n  return callback;\n}\n\n/**\n * Returns true if this event is targeting a text input widget?\n *\n * @param e An event.\n * @returns True if text input.\n */\nexport function isTargetInput(e: Event): boolean {\n  if (e.target instanceof HTMLElement) {\n    if (\n      e.target.isContentEditable ||\n      e.target.getAttribute('data-is-text-input') === 'true'\n    ) {\n      return true;\n    }\n\n    if (e.target instanceof HTMLInputElement) {\n      const target = e.target;\n      return (\n        target.type === 'text' ||\n        target.type === 'number' ||\n        target.type === 'email' ||\n        target.type === 'password' ||\n        target.type === 'search' ||\n        target.type === 'tel' ||\n        target.type === 'url'\n      );\n    }\n\n    if (e.target instanceof HTMLTextAreaElement) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Returns true this event is a right-click.\n *\n * @param e Mouse event.\n * @returns True if right-click.\n */\nexport function isRightButton(e: MouseEvent): boolean {\n  if (e.ctrlKey && userAgent.MAC) {\n    // Control-clicking on Mac OS X is treated as a right-click.\n    // WebKit on Mac OS X fails to change button to 2 (but Gecko does).\n    return true;\n  }\n  return e.button === 2;\n}\n\n/**\n * Returns the converted coordinates of the given mouse event.\n * The origin (0,0) is the top-left corner of the Blockly SVG.\n *\n * @param e Mouse event.\n * @param svg SVG element.\n * @param matrix Inverted screen CTM to use.\n * @returns Object with .x and .y properties.\n */\nexport function mouseToSvg(\n  e: MouseEvent,\n  svg: SVGSVGElement,\n  matrix: SVGMatrix | null,\n): SVGPoint {\n  const svgPoint = svg.createSVGPoint();\n  svgPoint.x = e.clientX;\n  svgPoint.y = e.clientY;\n\n  if (!matrix) {\n    matrix = svg.getScreenCTM()!.inverse();\n  }\n  return svgPoint.matrixTransform(matrix);\n}\n\n/**\n * Returns the scroll delta of a mouse event in pixel units.\n *\n * @param e Mouse event.\n * @returns Scroll delta object with .x and .y properties.\n */\nexport function getScrollDeltaPixels(e: WheelEvent): {x: number; y: number} {\n  switch (e.deltaMode) {\n    case 0x00: // Pixel mode.\n    default:\n      return {x: e.deltaX, y: e.deltaY};\n    case 0x01: // Line mode.\n      return {\n        x: e.deltaX * LINE_MODE_MULTIPLIER,\n        y: e.deltaY * LINE_MODE_MULTIPLIER,\n      };\n    case 0x02: // Page mode.\n      return {\n        x: e.deltaX * PAGE_MODE_MULTIPLIER,\n        y: e.deltaY * PAGE_MODE_MULTIPLIER,\n      };\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.array\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @internal\n */\nexport function removeElem<T>(arr: Array<T>, value: T): boolean {\n  const i = arr.indexOf(value);\n  if (i === -1) {\n    return false;\n  }\n  arr.splice(i, 1);\n  return true;\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Css\n\n/** Has CSS already been injected? */\nlet injected = false;\n\n/**\n * Add some CSS to the blob that will be injected later.  Allows optional\n * components such as fields and the toolbox to store separate CSS.\n *\n * @param cssContent Multiline CSS string or an array of single lines of CSS.\n */\nexport function register(cssContent: string) {\n  if (injected) {\n    throw Error('CSS already injected');\n  }\n  content += '\\n' + cssContent;\n}\n\n/**\n * Inject the CSS into the DOM.  This is preferable over using a regular CSS\n * file since:\n * a) It loads synchronously and doesn't force a redraw later.\n * b) It speeds up loading by not blocking on a separate HTTP transfer.\n * c) The CSS content may be made dynamic depending on init options.\n *\n * @param hasCss If false, don't inject CSS (providing CSS becomes the\n *     document's responsibility).\n * @param pathToMedia Path from page to the Blockly media directory.\n */\nexport function inject(hasCss: boolean, pathToMedia: string) {\n  // Only inject the CSS once.\n  if (injected) {\n    return;\n  }\n  injected = true;\n  if (!hasCss) {\n    return;\n  }\n  // Strip off any trailing slash (either Unix or Windows).\n  const mediaPath = pathToMedia.replace(/[\\\\/]$/, '');\n  const cssContent = content.replace(/<<<PATH>>>/g, mediaPath);\n  // Cleanup the collected css content after injecting it to the DOM.\n  content = '';\n\n  // Inject CSS tag at start of head.\n  const cssNode = document.createElement('style');\n  cssNode.id = 'blockly-common-style';\n  const cssTextNode = document.createTextNode(cssContent);\n  cssNode.appendChild(cssTextNode);\n  document.head.insertBefore(cssNode, document.head.firstChild);\n}\n\n/**\n * The CSS content for Blockly.\n */\nlet content = `\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n  /* Drag surface disables events to not block the toolbox, so we have to\n   * reenable them here for the cursor values to work. */\n  pointer-events: auto;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don't allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyBlockDragSurface, .blocklyAnimationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n`;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.dom\n\nimport type {Svg} from './svg.js';\n\n/**\n * Required name space for SVG elements.\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Required name space for HTML elements.\n */\nexport const HTML_NS = 'http://www.w3.org/1999/xhtml';\n\n/**\n * Required name space for XLINK elements.\n */\nexport const XLINK_NS = 'http://www.w3.org/1999/xlink';\n\n/**\n * Node type constants.\n * https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n */\nexport enum NodeType {\n  ELEMENT_NODE = 1,\n  TEXT_NODE = 3,\n  COMMENT_NODE = 8,\n}\n\n/** Temporary cache of text widths. */\nlet cacheWidths: {[key: string]: number} | null = null;\n\n/** Number of current references to cache. */\nlet cacheReference = 0;\n\n/** A HTML canvas context used for computing text width. */\nlet canvasContext: CanvasRenderingContext2D | null = null;\n\n/**\n * Helper method for creating SVG elements.\n *\n * @param name Element's tag name.\n * @param attrs Dictionary of attribute names and values.\n * @param opt_parent Optional parent on which to append the element.\n * @returns if name is a string or a more specific type if it a member of Svg.\n */\nexport function createSvgElement<T extends SVGElement>(\n  name: string | Svg<T>,\n  attrs: {[key: string]: string | number},\n  opt_parent?: Element | null,\n): T {\n  const e = document.createElementNS(SVG_NS, `${name}`) as T;\n  for (const key in attrs) {\n    e.setAttribute(key, `${attrs[key]}`);\n  }\n  if (opt_parent) {\n    opt_parent.appendChild(e);\n  }\n  return e;\n}\n\n/**\n * Add a CSS class to a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to add class to.\n * @param className Name of class to add.\n * @returns True if class was added, false if already present.\n */\nexport function addClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.add(...classNames);\n  return true;\n}\n\n/**\n * Removes multiple classes from an element.\n *\n * @param element DOM element to remove classes from.\n * @param classNames A string of one or multiple class names for an element.\n */\nexport function removeClasses(element: Element, classNames: string) {\n  element.classList.remove(...classNames.split(' '));\n}\n\n/**\n * Remove a CSS class from a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to remove class from.\n * @param className Name of class to remove.\n * @returns True if class was removed, false if never present.\n */\nexport function removeClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => !element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.remove(...classNames);\n  return true;\n}\n\n/**\n * Checks if an element has the specified CSS class.\n *\n * @param element DOM element to check.\n * @param className Name of class to check.\n * @returns True if class exists, false otherwise.\n */\nexport function hasClass(element: Element, className: string): boolean {\n  return element.classList.contains(className);\n}\n\n/**\n * Removes a node from its parent. No-op if not attached to a parent.\n *\n * @param node The node to remove.\n * @returns The node removed if removed; else, null.\n */\n// Copied from Closure goog.dom.removeNode\nexport function removeNode(node: Node | null): Node | null {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * Insert a node after a reference node.\n * Contrast with node.insertBefore function.\n *\n * @param newNode New element to insert.\n * @param refNode Existing element to precede new node.\n */\nexport function insertAfter(newNode: Element, refNode: Element) {\n  const siblingNode = refNode.nextSibling;\n  const parentNode = refNode.parentNode;\n  if (!parentNode) {\n    throw Error('Reference node has no parent.');\n  }\n  if (siblingNode) {\n    parentNode.insertBefore(newNode, siblingNode);\n  } else {\n    parentNode.appendChild(newNode);\n  }\n}\n\n/**\n * Sets the CSS transform property on an element. This function sets the\n * non-vendor-prefixed and vendor-prefixed versions for backwards compatibility\n * with older browsers. See https://caniuse.com/#feat=transforms2d\n *\n * @param element Element to which the CSS transform will be applied.\n * @param transform The value of the CSS `transform` property.\n */\nexport function setCssTransform(\n  element: HTMLElement | SVGElement,\n  transform: string,\n) {\n  element.style['transform'] = transform;\n  element.style['-webkit-transform' as any] = transform;\n}\n\n/**\n * Start caching text widths. Every call to this function MUST also call\n * stopTextWidthCache. Caches must not survive between execution threads.\n */\nexport function startTextWidthCache() {\n  cacheReference++;\n  if (!cacheWidths) {\n    cacheWidths = Object.create(null);\n  }\n}\n\n/**\n * Stop caching field widths. Unless caching was already on when the\n * corresponding call to startTextWidthCache was made.\n */\nexport function stopTextWidthCache() {\n  cacheReference--;\n  if (!cacheReference) {\n    cacheWidths = null;\n  }\n}\n\n/**\n * Gets the width of a text element, caching it in the process.\n *\n * @param textElement An SVG 'text' element.\n * @returns Width of element.\n */\nexport function getTextWidth(textElement: SVGTextElement): number {\n  const key = textElement.textContent + '\\n' + textElement.className.baseVal;\n  let width;\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  // Attempt to compute fetch the width of the SVG text element.\n  try {\n    width = textElement.getComputedTextLength();\n  } catch (e) {\n    // In other cases where we fail to get the computed text. Instead, use an\n    // approximation and do not cache the result. At some later point in time\n    // when the block is inserted into the visible DOM, this method will be\n    // called again and, at that point in time, will not throw an exception.\n    return textElement.textContent!.length * 8;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidth(\n  textElement: SVGTextElement,\n  fontSize: number,\n  fontWeight: string,\n  fontFamily: string,\n): number {\n  return getFastTextWidthWithSizeString(\n    textElement,\n    fontSize + 'pt',\n    fontWeight,\n    fontFamily,\n  );\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n * This method is similar to `getFastTextWidth` but expects the font size\n * parameter to be a string.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidthWithSizeString(\n  textElement: SVGTextElement,\n  fontSize: string,\n  fontWeight: string,\n  fontFamily: string,\n): number {\n  const text = textElement.textContent;\n  const key = text + '\\n' + textElement.className.baseVal;\n  let width;\n\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  if (!canvasContext) {\n    // Inject the canvas element used for computing text widths.\n    const computeCanvas = document.createElement('canvas');\n    computeCanvas.className = 'blocklyComputeCanvas';\n    document.body.appendChild(computeCanvas);\n\n    // Initialize the HTML canvas context and set the font.\n    // The context font must match blocklyText's fontsize and font-family\n    // set in CSS.\n    canvasContext = computeCanvas.getContext('2d') as CanvasRenderingContext2D;\n  }\n  // Set the desired font size and family.\n  canvasContext.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n\n  // Measure the text width using the helper canvas context.\n  if (text) {\n    width = canvasContext.measureText(text).width;\n  } else {\n    width = 0;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Measure a font's metrics. The height and baseline values.\n *\n * @param text Text to measure the font dimensions of.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Font measurements.\n */\nexport function measureFontMetrics(\n  text: string,\n  fontSize: string,\n  fontWeight: string,\n  fontFamily: string,\n): {height: number; baseline: number} {\n  const span = document.createElement('span');\n  span.style.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n  span.textContent = text;\n\n  const block = document.createElement('div');\n  block.style.width = '1px';\n  block.style.height = '0';\n\n  const div = document.createElement('div');\n  div.style.display = 'flex';\n  div.style.position = 'fixed';\n  div.style.top = '0';\n  div.style.left = '0';\n  div.appendChild(span);\n  div.appendChild(block);\n\n  document.body.appendChild(div);\n  const result = {\n    height: 0,\n    baseline: 0,\n  };\n  try {\n    div.style.alignItems = 'baseline';\n    result.baseline = block.offsetTop - span.offsetTop;\n    div.style.alignItems = 'flex-end';\n    result.height = block.offsetTop - span.offsetTop;\n  } finally {\n    document.body.removeChild(div);\n  }\n  return result;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.style\n\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport {Size} from './size.js';\n\n/**\n * Gets the height and width of an element.\n * Similar to Closure's goog.style.getSize\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nexport function getSize(element: Element): Size {\n  return TEST_ONLY.getSizeInternal(element);\n}\n\n/**\n * Private version of getSize for stubbing in tests.\n */\nfunction getSizeInternal(element: Element): Size {\n  if (getComputedStyle(element, 'display') !== 'none') {\n    return getSizeWithDisplay(element);\n  }\n\n  // Evaluate size with a temporary element.\n  // AnyDuringMigration because:  Property 'style' does not exist on type\n  // 'Element'.\n  const style = (element as AnyDuringMigration).style;\n  const originalDisplay = style.display;\n  const originalVisibility = style.visibility;\n  const originalPosition = style.position;\n\n  style.visibility = 'hidden';\n  style.position = 'absolute';\n  style.display = 'inline';\n\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n\n  style.display = originalDisplay;\n  style.position = originalPosition;\n  style.visibility = originalVisibility;\n\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Gets the height and width of an element when the display is not none.\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nfunction getSizeWithDisplay(element: Element): Size {\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Retrieves a computed style value of a node. It returns empty string\n * if the property requested is an SVG one and it has not been\n * explicitly set (firefox and webkit).\n *\n * Copied from Closure's goog.style.getComputedStyle\n *\n * @param element Element to get style of.\n * @param property Property to get (camel-case).\n * @returns Style value.\n */\nexport function getComputedStyle(element: Element, property: string): string {\n  const styles = window.getComputedStyle(element);\n  // element.style[..] is undefined for browser specific styles\n  // as 'filter'.\n  return (\n    (styles as AnyDuringMigration)[property] ||\n    styles.getPropertyValue(property)\n  );\n}\n\n/**\n * Returns a Coordinate object relative to the top-left of the HTML document.\n * Similar to Closure's goog.style.getPageOffset\n *\n * @param el Element to get the page offset for.\n * @returns The page offset.\n */\nexport function getPageOffset(el: Element): Coordinate {\n  const pos = new Coordinate(0, 0);\n  const box = el.getBoundingClientRect();\n  const documentElement = document.documentElement;\n  // Must add the scroll coordinates in to get the absolute page offset\n  // of element since getBoundingClientRect returns relative coordinates to\n  // the viewport.\n  const scrollCoord = new Coordinate(\n    window.pageXOffset || documentElement.scrollLeft,\n    window.pageYOffset || documentElement.scrollTop,\n  );\n  pos.x = box.left + scrollCoord.x;\n  pos.y = box.top + scrollCoord.y;\n\n  return pos;\n}\n\n/**\n * Calculates the viewport coordinates relative to the document.\n * Similar to Closure's goog.style.getViewportPageOffset\n *\n * @returns The page offset of the viewport.\n */\nexport function getViewportPageOffset(): Coordinate {\n  const body = document.body;\n  const documentElement = document.documentElement;\n  const scrollLeft = body.scrollLeft || documentElement.scrollLeft;\n  const scrollTop = body.scrollTop || documentElement.scrollTop;\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\n/**\n * Gets the computed border widths (on all sides) in pixels\n * Copied from Closure's goog.style.getBorderBox\n *\n * @param element  The element to get the border widths for.\n * @returns The computed border widths.\n */\nexport function getBorderBox(element: Element): Rect {\n  const left = parseFloat(getComputedStyle(element, 'borderLeftWidth'));\n  const right = parseFloat(getComputedStyle(element, 'borderRightWidth'));\n  const top = parseFloat(getComputedStyle(element, 'borderTopWidth'));\n  const bottom = parseFloat(getComputedStyle(element, 'borderBottomWidth'));\n\n  return new Rect(top, bottom, left, right);\n}\n\n/**\n * Changes the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.scrollIntoContainerView\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n */\nexport function scrollIntoContainerView(\n  element: Element,\n  container: Element,\n  opt_center?: boolean,\n) {\n  const offset = getContainerOffsetToScrollInto(element, container, opt_center);\n  container.scrollLeft = offset.x;\n  container.scrollTop = offset.y;\n}\n\n/**\n * Calculate the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.getContainerOffsetToScrollInto\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n * @returns The new scroll position of the container.\n */\nexport function getContainerOffsetToScrollInto(\n  element: Element,\n  container: Element,\n  opt_center?: boolean,\n): Coordinate {\n  // Absolute position of the element's border's top left corner.\n  const elementPos = getPageOffset(element);\n  // Absolute position of the container's border's top left corner.\n  const containerPos = getPageOffset(container);\n  const containerBorder = getBorderBox(container);\n  // Relative pos. of the element's border box to the container's content box.\n  const relX = elementPos.x - containerPos.x - containerBorder.left;\n  const relY = elementPos.y - containerPos.y - containerBorder.top;\n  // How much the element can move in the container, i.e. the difference between\n  // the element's bottom-right-most and top-left-most position where it's\n  // fully visible.\n  const elementSize = getSizeWithDisplay(element);\n  const spaceX = container.clientWidth - elementSize.width;\n  const spaceY = container.clientHeight - elementSize.height;\n  let scrollLeft = container.scrollLeft;\n  let scrollTop = container.scrollTop;\n  if (opt_center) {\n    // All browsers round non-integer scroll positions down.\n    scrollLeft += relX - spaceX / 2;\n    scrollTop += relY - spaceY / 2;\n  } else {\n    // This formula was designed to give the correct scroll values in the\n    // following cases:\n    // - element is higher than container (spaceY < 0) => scroll down by relY\n    // - element is not higher that container (spaceY >= 0):\n    //   - it is above container (relY < 0) => scroll up by abs(relY)\n    //   - it is below container (relY > spaceY) => scroll down by relY - spaceY\n    //   - it is in the container => don't scroll\n    scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));\n    scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));\n  }\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\nexport const TEST_ONLY = {\n  getSizeInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.svgMath\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport * as style from './style.js';\n\n/**\n * Static regex to pull the x,y values out of an SVG translate() directive.\n * Note that Firefox and IE (9,10) return 'translate(12)' instead of\n * 'translate(12, 0)'.\n * Note that IE (9,10) returns 'translate(16 8)' instead of 'translate(16, 8)'.\n * Note that IE has been reported to return scientific notation (0.123456e-42).\n */\nconst XY_REGEX = /translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/;\n\n/**\n * Static regex to pull the x,y values out of a translate() or translate3d()\n * style property.\n * Accounts for same exceptions as XY_REGEX.\n */\nconst XY_STYLE_REGEX =\n  /transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/;\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  const xy = new Coordinate(0, 0);\n  // First, check for x and y attributes.\n  // Checking for the existence of x/y properties is faster than getAttribute.\n  // However, x/y contains an SVGAnimatedLength object, so rely on getAttribute\n  // to get the number.\n  const x = (element as any).x && element.getAttribute('x');\n  const y = (element as any).y && element.getAttribute('y');\n  if (x) {\n    xy.x = parseInt(x);\n  }\n  if (y) {\n    xy.y = parseInt(y);\n  }\n  // Second, check for transform=\"translate(...)\" attribute.\n  const transform = element.getAttribute('transform');\n  const r = transform && transform.match(XY_REGEX);\n  if (r) {\n    xy.x += Number(r[1]);\n    if (r[3]) {\n      xy.y += Number(r[3]);\n    }\n  }\n\n  // Then check for style = transform: translate(...) or translate3d(...)\n  const style = element.getAttribute('style');\n  if (style && style.includes('translate')) {\n    const styleComponents = style.match(XY_STYLE_REGEX);\n    if (styleComponents) {\n      xy.x += Number(styleComponents[1]);\n      if (styleComponents[3]) {\n        xy.y += Number(styleComponents[3]);\n      }\n    }\n  }\n  return xy;\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n */\nexport function getInjectionDivXY(element: Element): Coordinate {\n  let x = 0;\n  let y = 0;\n  while (element) {\n    const xy = getRelativeXY(element);\n    x += xy.x;\n    y += xy.y;\n    const classes = element.getAttribute('class') || '';\n    if ((' ' + classes + ' ').includes(' injectionDiv ')) {\n      break;\n    }\n    element = element.parentNode as Element;\n  }\n  return new Coordinate(x, y);\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  // Pixels, in window coordinates.\n  const scrollOffset = style.getViewportPageOffset();\n  return new Rect(\n    scrollOffset.y,\n    document.documentElement.clientHeight + scrollOffset.y,\n    scrollOffset.x,\n    document.documentElement.clientWidth + scrollOffset.x,\n  );\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n */\nexport function getDocumentScroll(): Coordinate {\n  const el = document.documentElement;\n  const win = window;\n  return new Coordinate(\n    win.pageXOffset || el.scrollLeft,\n    win.pageYOffset || el.scrollTop,\n  );\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @returns The workspace coordinates.\n */\nexport function screenToWsCoordinates(\n  ws: WorkspaceSvg,\n  screenCoordinates: Coordinate,\n): Coordinate {\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels = new Coordinate(\n    screenX - boundingRect.left,\n    screenY - boundingRect.top,\n  );\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffsetPixels = Coordinate.difference(\n    clientOffsetPixels,\n    mainOffsetPixels,\n  );\n  // The position in main workspace coordinates.\n  const finalOffsetMainWs = finalOffsetPixels.scale(1 / ws.scale);\n  return finalOffsetMainWs;\n}\n\n/**\n * Converts workspace coordinates to screen coordinates.\n *\n * @param ws The workspace to get the coordinates out of.\n * @param workspaceCoordinates  The workspace coordinates to be converted\n *     to screen coordinates.\n * @returns The screen coordinates.\n */\nexport function wsToScreenCoordinates(\n  ws: WorkspaceSvg,\n  workspaceCoordinates: Coordinate,\n): Coordinate {\n  // Fix workspace scale vs browser scale.\n  const screenCoordinates = workspaceCoordinates.scale(ws.scale);\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  const boundingRect = injectionDiv.getBoundingClientRect();\n  const mainOffset = ws.getOriginOffsetInPixels();\n\n  // Fix workspace origin vs browser origin.\n  return new Coordinate(\n    screenX + boundingRect.left + mainOffset.x,\n    screenY + boundingRect.top + mainOffset.y,\n  );\n}\n\nexport const TEST_ONLY = {\n  XY_REGEX,\n  XY_STYLE_REGEX,\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.xml\n\nlet domParser: DOMParser = {\n  parseFromString: function () {\n    throw new Error(\n      'DOMParser was not found in the global scope and was not properly ' +\n        'injected using injectDependencies',\n    );\n  },\n};\n\nlet xmlSerializer: XMLSerializer = {\n  serializeToString: function () {\n    throw new Error(\n      'XMLSerializer was not foundin the global scope and was not properly ' +\n        'injected using injectDependencies',\n    );\n  },\n};\n\n/**\n * Injected dependencies.  By default these are just (and have the\n * same types as) the corresponding DOM Window properties, but the\n * Node.js wrapper for Blockly (see scripts/package/node/core.js)\n * calls injectDependencies to supply implementations from the jsdom\n * package instead.\n */\nlet {document, DOMParser, XMLSerializer} = globalThis;\nif (DOMParser) domParser = new DOMParser();\nif (XMLSerializer) xmlSerializer = new XMLSerializer();\n\n/**\n * Inject implementations of document, DOMParser and/or XMLSerializer\n * to use instead of the default ones.\n *\n * Used by the Node.js wrapper for Blockly (see\n * scripts/package/node/core.js) to supply implementations from the\n * jsdom package instead.\n *\n * While they may be set individually, it is normally the case that\n * all three will be sourced from the same JSDOM instance.  They MUST\n * at least come from the same copy of the jsdom package.  (Typically\n * this is hard to avoid satsifying this requirement, but it can be\n * inadvertently violated by using webpack to build multiple bundles\n * containing Blockly and jsdom, and then loading more than one into\n * the same JavaScript runtime.  See\n * https://github.com/google/blockly-samples/pull/1452#issuecomment-1364442135\n * for an example of how this happened.)\n *\n * @param dependencies Options object containing dependencies to set.\n */\nexport function injectDependencies(dependencies: {\n  document?: Document;\n  DOMParser?: typeof DOMParser;\n  XMLSerializer?: typeof XMLSerializer;\n}) {\n  ({\n    // Default to existing value if option not supplied.\n    document = document,\n    DOMParser = DOMParser,\n    XMLSerializer = XMLSerializer,\n  } = dependencies);\n\n  domParser = new DOMParser();\n  xmlSerializer = new XMLSerializer();\n}\n\n/**\n * Namespace for Blockly's XML.\n */\nexport const NAME_SPACE = 'https://developers.google.com/blockly/xml';\n\n// eslint-disable-next-line no-control-regex\nconst INVALID_CONTROL_CHARS = /[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F]/g;\n\n/**\n * Create DOM element for XML.\n *\n * @param tagName Name of DOM element.\n * @returns New DOM element.\n */\nexport function createElement(tagName: string): Element {\n  return document.createElementNS(NAME_SPACE, tagName);\n}\n\n/**\n * Create text element for XML.\n *\n * @param text Text content.\n * @returns New DOM text node.\n */\nexport function createTextNode(text: string): Text {\n  return document.createTextNode(text);\n}\n\n/**\n * Converts an XML string into a DOM structure.\n *\n * Control characters should be escaped. (But we will try to best-effort parse\n * unescaped characters.)\n *\n * Note that even when escaped, U+0000 will be parsed as U+FFFD (the\n * \"replacement character\") because U+0000 is never a valid XML character\n * (even in XML 1.1).\n * https://www.w3.org/TR/xml11/#charsets\n *\n * @param text An XML string.\n * @returns A DOM object representing the singular child of the document\n *     element.\n * @throws if the text doesn't parse.\n */\nexport function textToDom(text: string): Element {\n  let doc = domParser.parseFromString(text, 'text/xml');\n  if (\n    doc &&\n    doc.documentElement &&\n    !doc.getElementsByTagName('parsererror').length\n  ) {\n    return doc.documentElement;\n  }\n\n  // Attempt to parse as HTML to deserialize control characters that were\n  // serialized before the serializer did proper escaping.\n  doc = domParser.parseFromString(text, 'text/html');\n  if (\n    doc &&\n    doc.body.firstChild &&\n    doc.body.firstChild.nodeName.toLowerCase() === 'xml'\n  ) {\n    return doc.body.firstChild as Element;\n  }\n\n  throw new Error(`DOMParser was unable to parse: ${text}`);\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace.\n *\n * Control characters are escaped using their decimal encodings. This includes\n * U+0000 even though it is technically never a valid XML character (even in\n * XML 1.1).\n * https://www.w3.org/TR/xml11/#charsets\n *\n * When decoded U+0000 will be parsed as U+FFFD (the \"replacement character\").\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  return sanitizeText(xmlSerializer.serializeToString(dom));\n}\n\nfunction sanitizeText(text: string) {\n  return text.replace(\n    INVALID_CONTROL_CHARS,\n    (match) => `&#${match.charCodeAt(0)};`,\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.toolbox\n\nimport type {ConnectionState} from '../serialization/blocks.js';\nimport type {CssConfig as CategoryCssConfig} from '../toolbox/category.js';\nimport type {CssConfig as SeparatorCssConfig} from '../toolbox/separator.js';\nimport * as utilsXml from './xml.js';\n\n/**\n * The information needed to create a block in the toolbox.\n * Note that disabled has a different type for backwards compatibility.\n */\nexport interface BlockInfo {\n  kind: string;\n  blockxml?: string | Node;\n  type?: string;\n  gap?: string | number;\n  disabled?: string | boolean;\n  disabledReasons?: string[];\n  enabled?: boolean;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * The information needed to create a separator in the toolbox.\n */\nexport interface SeparatorInfo {\n  kind: string;\n  id: string | undefined;\n  gap: number | undefined;\n  cssconfig: SeparatorCssConfig | undefined;\n}\n\n/**\n * The information needed to create a button in the toolbox.\n */\nexport interface ButtonInfo {\n  kind: string;\n  text: string;\n  callbackkey: string;\n}\n\n/**\n * The information needed to create a label in the toolbox.\n */\nexport interface LabelInfo {\n  kind: string;\n  text: string;\n  id: string | undefined;\n}\n\n/**\n * The information needed to create either a button or a label in the flyout.\n */\nexport type ButtonOrLabelInfo = ButtonInfo | LabelInfo;\n\n/**\n * The information needed to create a category in the toolbox.\n */\nexport interface StaticCategoryInfo {\n  kind: string;\n  name: string;\n  contents: ToolboxItemInfo[];\n  id: string | undefined;\n  categorystyle: string | undefined;\n  colour: string | undefined;\n  cssconfig: CategoryCssConfig | undefined;\n  hidden: string | undefined;\n  expanded?: string | boolean;\n}\n\n/**\n * The information needed to create a custom category.\n */\nexport interface DynamicCategoryInfo {\n  kind: string;\n  custom: string;\n  id: string | undefined;\n  categorystyle: string | undefined;\n  colour: string | undefined;\n  cssconfig: CategoryCssConfig | undefined;\n  hidden: string | undefined;\n  expanded?: string | boolean;\n}\n\n/**\n * The information needed to create either a dynamic or static category.\n */\nexport type CategoryInfo = StaticCategoryInfo | DynamicCategoryInfo;\n\n/**\n * Any information that can be used to create an item in the toolbox.\n */\nexport type ToolboxItemInfo = FlyoutItemInfo | StaticCategoryInfo;\n\n/**\n * All the different types that can be displayed in a flyout.\n */\nexport type FlyoutItemInfo =\n  | BlockInfo\n  | SeparatorInfo\n  | ButtonInfo\n  | LabelInfo\n  | DynamicCategoryInfo;\n\n/**\n * The JSON definition of a toolbox.\n */\nexport interface ToolboxInfo {\n  kind?: string;\n  contents: ToolboxItemInfo[];\n}\n\n/**\n * An array holding flyout items.\n */\nexport type FlyoutItemInfoArray = FlyoutItemInfo[];\n\n/**\n * All of the different types that can create a toolbox.\n */\nexport type ToolboxDefinition = Node | ToolboxInfo | string;\n\n/**\n * All of the different types that can be used to show items in a flyout.\n */\nexport type FlyoutDefinition =\n  | FlyoutItemInfoArray\n  | NodeList\n  | ToolboxInfo\n  | Node[];\n\n/**\n * The name used to identify a toolbox that has category like items.\n * This only needs to be used if a toolbox wants to be treated like a category\n * toolbox but does not actually contain any toolbox items with the kind\n * 'category'.\n */\nconst CATEGORY_TOOLBOX_KIND = 'categoryToolbox';\n\n/**\n * The name used to identify a toolbox that has no categories and is displayed\n * as a simple flyout displaying blocks, buttons, or labels.\n */\nconst FLYOUT_TOOLBOX_KIND = 'flyoutToolbox';\n\n/**\n * Position of the toolbox and/or flyout relative to the workspace.\n */\nexport enum Position {\n  TOP,\n  BOTTOM,\n  LEFT,\n  RIGHT,\n}\n\n/**\n * Converts the toolbox definition into toolbox JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n * @internal\n */\nexport function convertToolboxDefToJson(\n  toolboxDef: ToolboxDefinition | null,\n): ToolboxInfo | null {\n  if (!toolboxDef) {\n    return null;\n  }\n\n  if (toolboxDef instanceof Element || typeof toolboxDef === 'string') {\n    toolboxDef = parseToolboxTree(toolboxDef);\n    // AnyDuringMigration because:  Argument of type 'Node | null' is not\n    // assignable to parameter of type 'Node'.\n    toolboxDef = convertToToolboxJson(toolboxDef as AnyDuringMigration);\n  }\n\n  const toolboxJson = toolboxDef as ToolboxInfo;\n  validateToolbox(toolboxJson);\n  return toolboxJson;\n}\n\n/**\n * Validates the toolbox JSON fields have been set correctly.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @throws {Error} if the toolbox is not the correct format.\n */\nfunction validateToolbox(toolboxJson: ToolboxInfo) {\n  const toolboxKind = toolboxJson['kind'];\n  const toolboxContents = toolboxJson['contents'];\n\n  if (toolboxKind) {\n    if (\n      toolboxKind !== FLYOUT_TOOLBOX_KIND &&\n      toolboxKind !== CATEGORY_TOOLBOX_KIND\n    ) {\n      throw Error(\n        'Invalid toolbox kind ' +\n          toolboxKind +\n          '.' +\n          ' Please supply either ' +\n          FLYOUT_TOOLBOX_KIND +\n          ' or ' +\n          CATEGORY_TOOLBOX_KIND,\n      );\n    }\n  }\n  if (!toolboxContents) {\n    throw Error('Toolbox must have a contents attribute.');\n  }\n}\n\n/**\n * Converts the flyout definition into a list of flyout items.\n *\n * @param flyoutDef The definition of the flyout in one of its many forms.\n * @returns A list of flyout items.\n * @internal\n */\nexport function convertFlyoutDefToJsonArray(\n  flyoutDef: FlyoutDefinition | null,\n): FlyoutItemInfoArray {\n  if (!flyoutDef) {\n    return [];\n  }\n\n  if ((flyoutDef as AnyDuringMigration)['contents']) {\n    return (flyoutDef as AnyDuringMigration)['contents'];\n  }\n  // If it is already in the correct format return the flyoutDef.\n  // AnyDuringMigration because:  Property 'nodeType' does not exist on type\n  // 'Node | FlyoutItemInfo'.\n  if (\n    Array.isArray(flyoutDef) &&\n    flyoutDef.length > 0 &&\n    !(flyoutDef[0] as AnyDuringMigration).nodeType\n  ) {\n    // AnyDuringMigration because:  Type 'FlyoutItemInfoArray | Node[]' is not\n    // assignable to type 'FlyoutItemInfoArray'.\n    return flyoutDef as AnyDuringMigration;\n  }\n\n  // AnyDuringMigration because:  Type 'ToolboxItemInfo[] | FlyoutItemInfoArray'\n  // is not assignable to type 'FlyoutItemInfoArray'.\n  return xmlToJsonArray(flyoutDef as Node[] | NodeList) as AnyDuringMigration;\n}\n\n/**\n * Whether or not the toolbox definition has categories.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @returns True if the toolbox has categories.\n * @internal\n */\nexport function hasCategories(toolboxJson: ToolboxInfo | null): boolean {\n  return TEST_ONLY.hasCategoriesInternal(toolboxJson);\n}\n\n/**\n * Private version of hasCategories for stubbing in tests.\n */\nfunction hasCategoriesInternal(toolboxJson: ToolboxInfo | null): boolean {\n  if (!toolboxJson) {\n    return false;\n  }\n\n  const toolboxKind = toolboxJson['kind'];\n  if (toolboxKind) {\n    return toolboxKind === CATEGORY_TOOLBOX_KIND;\n  }\n\n  const categories = toolboxJson['contents'].filter(function (item) {\n    return item['kind'].toUpperCase() === 'CATEGORY';\n  });\n  return !!categories.length;\n}\n\n/**\n * Whether or not the category is collapsible.\n *\n * @param categoryInfo Object holing information for creating a category.\n * @returns True if the category has subcategories.\n * @internal\n */\nexport function isCategoryCollapsible(categoryInfo: CategoryInfo): boolean {\n  if (!categoryInfo || !(categoryInfo as AnyDuringMigration)['contents']) {\n    return false;\n  }\n\n  const categories = (categoryInfo as AnyDuringMigration)['contents'].filter(\n    function (item: AnyDuringMigration) {\n      return item['kind'].toUpperCase() === 'CATEGORY';\n    },\n  );\n  return !!categories.length;\n}\n\n/**\n * Parses the provided toolbox definition into a consistent format.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n */\nfunction convertToToolboxJson(toolboxDef: Node): ToolboxInfo {\n  const contents = xmlToJsonArray(toolboxDef as Node | Node[]);\n  const toolboxJson = {'contents': contents};\n  if (toolboxDef instanceof Node) {\n    addAttributes(toolboxDef, toolboxJson);\n  }\n  return toolboxJson;\n}\n\n/**\n * Converts the xml for a toolbox to JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns A list of objects in the toolbox.\n */\nfunction xmlToJsonArray(\n  toolboxDef: Node | Node[] | NodeList,\n): FlyoutItemInfoArray | ToolboxItemInfo[] {\n  const arr = [];\n  // If it is a node it will have children.\n  // AnyDuringMigration because:  Property 'childNodes' does not exist on type\n  // 'Node | NodeList | Node[]'.\n  let childNodes = (toolboxDef as AnyDuringMigration).childNodes;\n  if (!childNodes) {\n    // Otherwise the toolboxDef is an array or collection.\n    childNodes = toolboxDef;\n  }\n  for (let i = 0, child; (child = childNodes[i]); i++) {\n    if (!child.tagName) {\n      continue;\n    }\n    const obj = {};\n    const tagName = child.tagName.toUpperCase();\n    (obj as AnyDuringMigration)['kind'] = tagName;\n\n    // Store the XML for a block.\n    if (tagName === 'BLOCK') {\n      (obj as AnyDuringMigration)['blockxml'] = child;\n    } else if (child.childNodes && child.childNodes.length > 0) {\n      // Get the contents of a category\n      (obj as AnyDuringMigration)['contents'] = xmlToJsonArray(child);\n    }\n\n    // Add XML attributes to object\n    addAttributes(child, obj);\n    arr.push(obj);\n  }\n  // AnyDuringMigration because:  Type '{}[]' is not assignable to type\n  // 'ToolboxItemInfo[] | FlyoutItemInfoArray'.\n  return arr as AnyDuringMigration;\n}\n\n/**\n * Adds the attributes on the node to the given object.\n *\n * @param node The node to copy the attributes from.\n * @param obj The object to copy the attributes to.\n */\nfunction addAttributes(node: Node, obj: AnyDuringMigration) {\n  // AnyDuringMigration because:  Property 'attributes' does not exist on type\n  // 'Node'.\n  for (let j = 0; j < (node as AnyDuringMigration).attributes.length; j++) {\n    // AnyDuringMigration because:  Property 'attributes' does not exist on type\n    // 'Node'.\n    const attr = (node as AnyDuringMigration).attributes[j];\n    if (attr.nodeName.includes('css-')) {\n      obj['cssconfig'] = obj['cssconfig'] || {};\n      obj['cssconfig'][attr.nodeName.replace('css-', '')] = attr.value;\n    } else {\n      obj[attr.nodeName] = attr.value;\n    }\n  }\n}\n\n/**\n * Parse the provided toolbox tree into a consistent DOM format.\n *\n * @param toolboxDef DOM tree of blocks, or text representation of same.\n * @returns DOM tree of blocks, or null.\n */\nexport function parseToolboxTree(\n  toolboxDef: Element | null | string,\n): Element | null {\n  let parsedToolboxDef: Element | null = null;\n  if (toolboxDef) {\n    if (typeof toolboxDef === 'string') {\n      parsedToolboxDef = utilsXml.textToDom(toolboxDef);\n      if (parsedToolboxDef.nodeName.toLowerCase() !== 'xml') {\n        throw TypeError('Toolbox should be an <xml> document.');\n      }\n    } else if (toolboxDef instanceof Element) {\n      parsedToolboxDef = toolboxDef;\n    }\n  }\n  return parsedToolboxDef;\n}\n\nexport const TEST_ONLY = {\n  hasCategoriesInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.uiPosition\n\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Enum for vertical positioning.\n *\n * @internal\n */\nexport enum verticalPosition {\n  TOP,\n  BOTTOM,\n}\n\n/**\n * Enum for horizontal positioning.\n *\n * @internal\n */\nexport enum horizontalPosition {\n  LEFT,\n  RIGHT,\n}\n\n/**\n * An object defining a horizontal and vertical positioning.\n *\n * @internal\n */\nexport interface Position {\n  horizontal: horizontalPosition;\n  vertical: verticalPosition;\n}\n\n/**\n * Enum for bump rules to use for dealing with collisions.\n *\n * @internal\n */\nexport enum bumpDirection {\n  UP,\n  DOWN,\n}\n\n/**\n * Returns a rectangle representing reasonable position for where to place a UI\n * element of the specified size given the restraints and locations of the\n * scrollbars. This method does not take into account any already placed UI\n * elements.\n *\n * @param position The starting horizontal and vertical position.\n * @param size the size of the UI element to get a start position for.\n * @param horizontalPadding The horizontal padding to use.\n * @param verticalPadding The vertical padding to use.\n * @param metrics The workspace UI metrics.\n * @param workspace The workspace.\n * @returns The suggested start position.\n * @internal\n */\nexport function getStartPositionRect(\n  position: Position,\n  size: Size,\n  horizontalPadding: number,\n  verticalPadding: number,\n  metrics: UiMetrics,\n  workspace: WorkspaceSvg,\n): Rect {\n  // Horizontal positioning.\n  let left = 0;\n  const hasVerticalScrollbar =\n    workspace.scrollbar && workspace.scrollbar.canScrollVertically();\n  if (position.horizontal === horizontalPosition.LEFT) {\n    left = metrics.absoluteMetrics.left + horizontalPadding;\n    if (hasVerticalScrollbar && workspace.RTL) {\n      left += Scrollbar.scrollbarThickness;\n    }\n  } else {\n    // position.horizontal === horizontalPosition.RIGHT\n    left =\n      metrics.absoluteMetrics.left +\n      metrics.viewMetrics.width -\n      size.width -\n      horizontalPadding;\n    if (hasVerticalScrollbar && !workspace.RTL) {\n      left -= Scrollbar.scrollbarThickness;\n    }\n  }\n  // Vertical positioning.\n  let top = 0;\n  if (position.vertical === verticalPosition.TOP) {\n    top = metrics.absoluteMetrics.top + verticalPadding;\n  } else {\n    // position.vertical === verticalPosition.BOTTOM\n    top =\n      metrics.absoluteMetrics.top +\n      metrics.viewMetrics.height -\n      size.height -\n      verticalPadding;\n    if (workspace.scrollbar && workspace.scrollbar.canScrollHorizontally()) {\n      // The scrollbars are always positioned on the bottom if they exist.\n      top -= Scrollbar.scrollbarThickness;\n    }\n  }\n  return new Rect(top, top + size.height, left, left + size.width);\n}\n\n/**\n * Returns a corner position that is on the opposite side of the workspace from\n * the toolbox.\n * If in horizontal orientation, defaults to the bottom corner. If in vertical\n * orientation, defaults to the right corner.\n *\n * @param workspace The workspace.\n * @param metrics The workspace metrics.\n * @returns The suggested corner position.\n * @internal\n */\nexport function getCornerOppositeToolbox(\n  workspace: WorkspaceSvg,\n  metrics: UiMetrics,\n): Position {\n  const leftCorner =\n    metrics.toolboxMetrics.position !== toolbox.Position.LEFT &&\n    (!workspace.horizontalLayout || workspace.RTL);\n  const topCorner = metrics.toolboxMetrics.position === toolbox.Position.BOTTOM;\n  const hPosition = leftCorner\n    ? horizontalPosition.LEFT\n    : horizontalPosition.RIGHT;\n  const vPosition = topCorner ? verticalPosition.TOP : verticalPosition.BOTTOM;\n  return {horizontal: hPosition, vertical: vPosition};\n}\n\n/**\n * Returns a position Rect based on a starting position that is bumped\n * so that it doesn't intersect with any of the provided savedPositions. This\n * method does not check that the bumped position is still within bounds.\n *\n * @param startRect The starting position to use.\n * @param margin The margin to use between elements when bumping.\n * @param bumpDir The direction to bump if there is a collision with an existing\n *     UI element.\n * @param savedPositions List of rectangles that represent the positions of UI\n *     elements already placed.\n * @returns The suggested position rectangle.\n * @internal\n */\nexport function bumpPositionRect(\n  startRect: Rect,\n  margin: number,\n  bumpDir: bumpDirection,\n  savedPositions: Rect[],\n): Rect {\n  let top = startRect.top;\n  const left = startRect.left;\n  const width = startRect.right - startRect.left;\n  const height = startRect.bottom - startRect.top;\n\n  // Check for collision and bump if needed.\n  let boundingRect = startRect;\n  for (let i = 0; i < savedPositions.length; i++) {\n    const otherEl = savedPositions[i];\n    if (boundingRect.intersects(otherEl)) {\n      if (bumpDir === bumpDirection.UP) {\n        top = otherEl.top - height - margin;\n      } else {\n        // bumpDir === bumpDirection.DOWN\n        top = otherEl.bottom + margin;\n      }\n      // Recheck other savedPositions\n      boundingRect = new Rect(top, top + height, left, left + width);\n      i = -1;\n    }\n  }\n  return boundingRect;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.dialog\n\nlet alertImplementation = function (\n  message: string,\n  opt_callback?: () => void,\n) {\n  window.alert(message);\n  if (opt_callback) {\n    opt_callback();\n  }\n};\n\nlet confirmImplementation = function (\n  message: string,\n  callback: (result: boolean) => void,\n) {\n  callback(window.confirm(message));\n};\n\nlet promptImplementation = function (\n  message: string,\n  defaultValue: string,\n  callback: (result: string | null) => void,\n) {\n  callback(window.prompt(message, defaultValue));\n};\n\n/**\n * Wrapper to window.alert() that app developers may override via setAlert to\n * provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param opt_callback The callback when the alert is dismissed.\n */\nexport function alert(message: string, opt_callback?: () => void) {\n  alertImplementation(message, opt_callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.alert() is called.\n *\n * @param alertFunction The function to be run.\n * @see Blockly.dialog.alert\n */\nexport function setAlert(alertFunction: (p1: string, p2?: () => void) => void) {\n  alertImplementation = alertFunction;\n}\n\n/**\n * Wrapper to window.confirm() that app developers may override via setConfirm\n * to provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param callback The callback for handling user response.\n */\nexport function confirm(message: string, callback: (p1: boolean) => void) {\n  TEST_ONLY.confirmInternal(message, callback);\n}\n\n/**\n * Private version of confirm for stubbing in tests.\n */\nfunction confirmInternal(message: string, callback: (p1: boolean) => void) {\n  confirmImplementation(message, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.confirm() is called.\n *\n * @param confirmFunction The function to be run.\n * @see Blockly.dialog.confirm\n */\nexport function setConfirm(\n  confirmFunction: (p1: string, p2: (p1: boolean) => void) => void,\n) {\n  confirmImplementation = confirmFunction;\n}\n\n/**\n * Wrapper to window.prompt() that app developers may override via setPrompt to\n * provide alternatives to the modal browser window. Built-in browser prompts\n * are often used for better text input experience on mobile device. We strongly\n * recommend testing mobile when overriding this.\n *\n * @param message The message to display to the user.\n * @param defaultValue The value to initialize the prompt with.\n * @param callback The callback for handling user response.\n */\nexport function prompt(\n  message: string,\n  defaultValue: string,\n  callback: (p1: string | null) => void,\n) {\n  promptImplementation(message, defaultValue, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.prompt() is called.\n *\n * @param promptFunction The function to be run.\n * @see Blockly.dialog.prompt\n */\nexport function setPrompt(\n  promptFunction: (\n    p1: string,\n    p2: string,\n    p3: (p1: string | null) => void,\n  ) => void,\n) {\n  promptImplementation = promptFunction;\n}\n\nexport const TEST_ONLY = {\n  confirmInternal,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {VariableModel} from '../variable_model.js';\nimport {IParameterModel} from './i_parameter_model.js';\n\n/** Interface for a parameter model that holds a variable model. */\nexport interface IVariableBackedParameterModel extends IParameterModel {\n  /** Returns the variable model held by this type. */\n  getVariableModel(): VariableModel;\n}\n\n/**\n * Returns whether the given object is a variable holder or not.\n */\nexport function isVariableBackedParameterModel(\n  param: IParameterModel,\n): param is IVariableBackedParameterModel {\n  return (param as any).getVariableModel !== undefined;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Legacy means of representing a procedure signature. The elements are\n * respectively: name, parameter names, and whether it has a return value.\n */\nexport type ProcedureTuple = [string, string[], boolean];\n\n/**\n * Procedure block type.\n *\n * @internal\n */\nexport interface ProcedureBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport interface LegacyProcedureDefBlock {\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport function isLegacyProcedureDefBlock(\n  block: Object,\n): block is LegacyProcedureDefBlock {\n  return (block as any).getProcedureDef !== undefined;\n}\n\n/** @internal */\nexport interface LegacyProcedureCallBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n}\n\n/** @internal */\nexport function isLegacyProcedureCallBlock(\n  block: Object,\n): block is LegacyProcedureCallBlock {\n  return (\n    (block as any).getProcedureCall !== undefined &&\n    (block as any).renameProcedure !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Variables\n\nimport {Blocks} from './blocks.js';\nimport * as dialog from './dialog.js';\nimport {isVariableBackedParameterModel} from './interfaces/i_variable_backed_parameter_model.js';\nimport {Msg} from './msg.js';\nimport {isLegacyProcedureDefBlock} from './interfaces/i_legacy_procedure_blocks.js';\nimport * as utilsXml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Procedures.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE';\n\n/**\n * Find all user-created variables that are in use in the workspace.\n * For use by generators.\n * To get a list of all variables on a workspace, including unused variables,\n * call Workspace.getAllVariables.\n *\n * @param ws The workspace to search for variables.\n * @returns Array of variable models.\n */\nexport function allUsedVarModels(ws: Workspace): VariableModel[] {\n  const blocks = ws.getAllBlocks(false);\n  const variables = new Set<VariableModel>();\n  // Iterate through every block and add each variable to the set.\n  for (let i = 0; i < blocks.length; i++) {\n    const blockVariables = blocks[i].getVarModels();\n    if (blockVariables) {\n      for (let j = 0; j < blockVariables.length; j++) {\n        const variable = blockVariables[j];\n        const id = variable.getId();\n        if (id) {\n          variables.add(variable);\n        }\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Find all developer variables used by blocks in the workspace.\n * Developer variables are never shown to the user, but are declared as global\n * variables in the generated code.\n * To declare developer variables, define the getDeveloperVariables function on\n * your block and return a list of variable names.\n * For use by generators.\n *\n * @param workspace The workspace to search.\n * @returns A list of non-duplicated variable names.\n */\nexport function allDeveloperVariables(workspace: Workspace): string[] {\n  const blocks = workspace.getAllBlocks(false);\n  const variables = new Set<string>();\n  for (let i = 0, block; (block = blocks[i]); i++) {\n    const getDeveloperVariables = block.getDeveloperVariables;\n    if (getDeveloperVariables) {\n      const devVars = getDeveloperVariables();\n      for (let j = 0; j < devVars.length; j++) {\n        variables.add(devVars[j]);\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  const button = document.createElement('button');\n  button.setAttribute('text', '%{BKY_NEW_VARIABLE}');\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE');\n\n  workspace.registerButtonCallback('CREATE_VARIABLE', function (button) {\n    createVariableButtonHandler(button.getTargetWorkspace());\n  });\n\n  xmlList.push(button);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getVariablesOfType('');\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    // New variables are added to the end of the variableModelList.\n    const mostRecentVariable = variableModelList[variableModelList.length - 1];\n    if (Blocks['variables_set']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'variables_set');\n      block.setAttribute('gap', Blocks['math_change'] ? '8' : '24');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['math_change']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'math_change');\n      block.setAttribute('gap', Blocks['variables_get'] ? '20' : '8');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      const value = utilsXml.textToDom(\n        '<value name=\"DELTA\">' +\n          '<shadow type=\"math_number\">' +\n          '<field name=\"NUM\">1</field>' +\n          '</shadow>' +\n          '</value>',\n      );\n      block.appendChild(value);\n      xmlList.push(block);\n    }\n\n    if (Blocks['variables_get']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\n        const block = utilsXml.createElement('block');\n        block.setAttribute('type', 'variables_get');\n        block.setAttribute('gap', '8');\n        block.appendChild(generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n\nexport const VAR_LETTER_OPTIONS = 'ijkmnopqrstuvwxyzabcdefgh';\n\n/**\n * Return a new variable name that is not yet being used. This will try to\n * generate single letter variable names in the range 'i' to 'z' to start with.\n * If no unique name is located it will try 'i' to 'z', 'a' to 'h',\n * then 'i2' to 'z2' etc.  Skip 'l'.\n *\n * @param workspace The workspace to be unique in.\n * @returns New variable name.\n */\nexport function generateUniqueName(workspace: Workspace): string {\n  return TEST_ONLY.generateUniqueNameInternal(workspace);\n}\n\n/**\n * Private version of generateUniqueName for stubbing in tests.\n */\nfunction generateUniqueNameInternal(workspace: Workspace): string {\n  return generateUniqueNameFromOptions(\n    VAR_LETTER_OPTIONS.charAt(0),\n    workspace.getAllVariableNames(),\n  );\n}\n\n/**\n * Returns a unique name that is not present in the usedNames array. This\n * will try to generate single letter names in the range a - z (skip l). It\n * will start with the character passed to startChar.\n *\n * @param startChar The character to start the search at.\n * @param usedNames A list of all of the used names.\n * @returns A unique name that is not present in the usedNames array.\n */\nexport function generateUniqueNameFromOptions(\n  startChar: string,\n  usedNames: string[],\n): string {\n  if (!usedNames.length) {\n    return startChar;\n  }\n\n  const letters = VAR_LETTER_OPTIONS;\n  let suffix = '';\n  let letterIndex = letters.indexOf(startChar);\n  let potName = startChar;\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    let inUse = false;\n    for (let i = 0; i < usedNames.length; i++) {\n      if (usedNames[i].toLowerCase() === potName) {\n        inUse = true;\n        break;\n      }\n    }\n    if (!inUse) {\n      break;\n    }\n\n    letterIndex++;\n    if (letterIndex === letters.length) {\n      // Reached the end of the character sequence so back to 'i'.\n      letterIndex = 0;\n      suffix = `${Number(suffix) + 1}`;\n    }\n    potName = letters.charAt(letterIndex) + suffix;\n  }\n  return potName;\n}\n\n/**\n * Handles \"Create Variable\" button in the default variables toolbox category.\n * It will prompt the user for a variable name, including re-prompts if a name\n * is already in use among the workspace's variables.\n *\n * Custom button handlers can delegate to this function, allowing variables\n * types and after-creation processing. More complex customization (e.g.,\n * prompting for variable type) is beyond the scope of this function.\n *\n * @param workspace The workspace on which to create the variable.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n * @param opt_type The type of the variable like 'int', 'string', or ''. This\n *     will default to '', which is a specific type.\n */\nexport function createVariableButtonHandler(\n  workspace: Workspace,\n  opt_callback?: (p1?: string | null) => void,\n  opt_type?: string,\n) {\n  const type = opt_type || '';\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    promptName(Msg['NEW_VARIABLE_TITLE'], defaultName, function (text) {\n      if (!text) {\n        // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithAnyType(text, workspace);\n      if (!existing) {\n        // No conflict\n        workspace.createVariable(text, type);\n        if (opt_callback) opt_callback(text);\n        return;\n      }\n\n      let msg;\n      if (existing.type === type) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS'].replace('%1', existing.name);\n      } else {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE'];\n        msg = msg.replace('%1', existing.name).replace('%2', existing.type);\n      }\n      dialog.alert(msg, function () {\n        promptAndCheckWithAlert(text);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Opens a prompt that allows the user to enter a new name for a variable.\n * Triggers a rename if the new name is valid. Or re-prompts if there is a\n * collision.\n *\n * @param workspace The workspace on which to rename the variable.\n * @param variable Variable to rename.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n */\nexport function renameVariable(\n  workspace: Workspace,\n  variable: VariableModel,\n  opt_callback?: (p1?: string | null) => void,\n) {\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    const promptText = Msg['RENAME_VARIABLE_TITLE'].replace(\n      '%1',\n      variable.name,\n    );\n    promptName(promptText, defaultName, function (newName) {\n      if (!newName) {\n        // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithOtherType(newName, variable.type, workspace);\n      const procedure = nameUsedWithConflictingParam(\n        variable.name,\n        newName,\n        workspace,\n      );\n      if (!existing && !procedure) {\n        // No conflict.\n        workspace.renameVariableById(variable.getId(), newName);\n        if (opt_callback) opt_callback(newName);\n        return;\n      }\n\n      let msg = '';\n      if (existing) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE']\n          .replace('%1', existing.name)\n          .replace('%2', existing.type);\n      } else if (procedure) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER']\n          .replace('%1', newName)\n          .replace('%2', procedure);\n      }\n      dialog.alert(msg, function () {\n        promptAndCheckWithAlert(newName);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Prompt the user for a new variable name.\n *\n * @param promptText The string of the prompt.\n * @param defaultText The default value to show in the prompt's field.\n * @param callback A callback. It will be passed the new variable name, or null\n *     if the user picked something illegal.\n */\nexport function promptName(\n  promptText: string,\n  defaultText: string,\n  callback: (p1: string | null) => void,\n) {\n  dialog.prompt(promptText, defaultText, function (newVar) {\n    // Merge runs of whitespace.  Strip leading and trailing whitespace.\n    // Beyond this, all names are legal.\n    if (newVar) {\n      newVar = newVar.replace(/[\\s\\xa0]+/g, ' ').trim();\n      if (newVar === Msg['RENAME_VARIABLE'] || newVar === Msg['NEW_VARIABLE']) {\n        // Ok, not ALL names are legal...\n        newVar = null;\n      }\n    }\n    callback(newVar);\n  });\n}\n/**\n * Check whether there exists a variable with the given name but a different\n * type.\n *\n * @param name The name to search for.\n * @param type The type to exclude from the search.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name and a different type, or null if\n *     none was found.\n */\nfunction nameUsedWithOtherType(\n  name: string,\n  type: string,\n  workspace: Workspace,\n): VariableModel | null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\n    if (variable.name.toLowerCase() === name && variable.type !== type) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Check whether there exists a variable with the given name of any type.\n *\n * @param name The name to search for.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name, or null if none was found.\n */\nexport function nameUsedWithAnyType(\n  name: string,\n  workspace: Workspace,\n): VariableModel | null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\n    if (variable.name.toLowerCase() === name) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure with a conflicting parameter name, or null\n * if one does not exist.\n *\n * This checks the procedure map if it contains models, and the legacy procedure\n * blocks otherwise.\n *\n * @param oldName The old name of the variable.\n * @param newName The proposed name of the variable.\n * @param workspace The workspace to search for conflicting parameters.\n * @internal\n */\nexport function nameUsedWithConflictingParam(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  return workspace.getProcedureMap().getProcedures().length\n    ? checkForConflictingParamWithProcedureModels(oldName, newName, workspace)\n    : checkForConflictingParamWithLegacyProcedures(oldName, newName, workspace);\n}\n\n/**\n * Returns the name of the procedure model with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithProcedureModels(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const procedures = workspace.getProcedureMap().getProcedures();\n  for (const procedure of procedures) {\n    const params = procedure\n      .getParameters()\n      .filter(isVariableBackedParameterModel)\n      .map((param) => param.getVariableModel().name);\n    if (!params) continue;\n    const procHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const procHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (procHasOld && procHasNew) return procedure.getName();\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure block with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithLegacyProcedures(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const blocks = workspace.getAllBlocks(false);\n  for (const block of blocks) {\n    if (!isLegacyProcedureDefBlock(block)) continue;\n    const def = block.getProcedureDef();\n    const params = def[1];\n    const blockHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const blockHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (blockHasOld && blockHasNew) return def[0];\n  }\n  return null;\n}\n\n/**\n * Generate DOM objects representing a variable field.\n *\n * @param variableModel The variable model to represent.\n * @returns The generated DOM.\n */\nexport function generateVariableFieldDom(\n  variableModel: VariableModel,\n): Element {\n  /* Generates the following XML:\n   * <field name=\"VAR\" id=\"goKTKmYJ8DhVHpruv\" variabletype=\"int\">foo</field>\n   */\n  const field = utilsXml.createElement('field');\n  field.setAttribute('name', 'VAR');\n  field.setAttribute('id', variableModel.getId());\n  field.setAttribute('variabletype', variableModel.type);\n  const name = utilsXml.createTextNode(variableModel.name);\n  field.appendChild(name);\n  return field;\n}\n\n/**\n * Helper function to look up or create a variable on the given workspace.\n * If no variable exists, creates and returns it.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up or create the variable, or null.\n * @param opt_name The string to use to look up or create the variable.\n * @param opt_type The type to use to look up or create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nexport function getOrCreateVariablePackage(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel {\n  let variable = getVariable(workspace, id, opt_name, opt_type);\n  if (!variable) {\n    variable = createVariable(workspace, id, opt_name, opt_type);\n  }\n  return variable;\n}\n\n/**\n * Look up  a variable on the given workspace.\n * Always looks in the main workspace before looking in the flyout workspace.\n * Always prefers lookup by ID to lookup by name + type.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up the variable, or null.\n * @param opt_name The string to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @param opt_type The type to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @returns The variable corresponding to the given ID or name + type\n *     combination, or null if not found.\n */\nexport function getVariable(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel | null {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  let variable = null;\n  // Try to just get the variable, by ID if possible.\n  if (id) {\n    // Look in the real variable map before checking the potential variable map.\n    variable = workspace.getVariableById(id);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariableById(id);\n    }\n    if (variable) {\n      return variable;\n    }\n  }\n  // If there was no ID, or there was an ID but it didn't match any variables,\n  // look up by name and type.\n  if (opt_name) {\n    if (opt_type === undefined) {\n      throw Error('Tried to look up a variable by name without a type');\n    }\n    // Otherwise look up by name and type.\n    variable = workspace.getVariable(opt_name, opt_type);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariable(opt_name, opt_type);\n    }\n  }\n  return variable;\n}\n\n/**\n * Helper function to create a variable on the given workspace.\n *\n * @param workspace The workspace in which to create the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to create the variable, or null.\n * @param opt_name The string to use to create the variable.\n * @param opt_type The type to use to create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nfunction createVariable(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  // Variables without names get uniquely named for this workspace.\n  if (!opt_name) {\n    const ws = workspace.isFlyout\n      ? (workspace as WorkspaceSvg).targetWorkspace\n      : workspace;\n    opt_name = generateUniqueName(ws!);\n  }\n\n  // Create a potential variable if in the flyout.\n  let variable = null;\n  if (potentialVariableMap) {\n    variable = potentialVariableMap.createVariable(opt_name, opt_type, id);\n  } else {\n    // In the main workspace, create a real variable.\n    variable = workspace.createVariable(opt_name, opt_type, id);\n  }\n  return variable;\n}\n\n/**\n * Helper function to get the list of variables that have been added to the\n * workspace after adding a new block, using the given list of variables that\n * were in the workspace before the new block was added.\n *\n * @param workspace The workspace to inspect.\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n * @returns The new array of variables that were freshly added to the workspace\n *     after creating the new block, or [] if no new variables were added to the\n *     workspace.\n * @internal\n */\nexport function getAddedVariables(\n  workspace: Workspace,\n  originalVariables: VariableModel[],\n): VariableModel[] {\n  const allCurrentVariables = workspace.getAllVariables();\n  const addedVariables = [];\n  if (originalVariables.length !== allCurrentVariables.length) {\n    for (let i = 0; i < allCurrentVariables.length; i++) {\n      const variable = allCurrentVariables[i];\n      // For any variable that is present in allCurrentVariables but not\n      // present in originalVariables, add the variable to addedVariables.\n      if (!originalVariables.includes(variable)) {\n        addedVariables.push(variable);\n      }\n    }\n  }\n  return addedVariables;\n}\n\nexport const TEST_ONLY = {\n  generateUniqueNameInternal,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from './block_svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as eventUtils from './events/utils.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** The set of all blocks in need of rendering which don't have parents. */\nconst rootBlocks = new Set<BlockSvg>();\n\n/** The set of all blocks in need of rendering. */\nconst dirtyBlocks = new WeakSet<BlockSvg>();\n\n/** A map from queued blocks to the event group from when they were queued. */\nconst eventGroups = new WeakMap<BlockSvg, string>();\n\n/**\n * The promise which resolves after the current set of renders is completed. Or\n * null if there are no queued renders.\n *\n * Stored so that we can return it from afterQueuedRenders.\n */\nlet afterRendersPromise: Promise<void> | null = null;\n\n/** The function to call to resolve the `afterRendersPromise`. */\nlet afterRendersResolver: (() => void) | null = null;\n\n/**\n * The ID of the current animation frame request. Used to cancel the request\n * if necessary.\n */\nlet animationRequestId = 0;\n\n/**\n * Registers that the given block and all of its parents need to be rerendered,\n * and registers a callback to do so after a delay, to allowf or batching.\n *\n * @param block The block to rerender.\n * @returns A promise that resolves after the currently queued renders have been\n *     completed. Used for triggering other behavior that relies on updated\n *     size/position location for the block.\n * @internal\n */\nexport function queueRender(block: BlockSvg): Promise<void> {\n  queueBlock(block);\n\n  if (alwaysImmediatelyRender()) {\n    doRenders();\n    return Promise.resolve();\n  }\n\n  if (!afterRendersPromise) {\n    afterRendersPromise = new Promise((resolve) => {\n      afterRendersResolver = resolve;\n      animationRequestId = window.requestAnimationFrame(() => {\n        doRenders();\n        resolve();\n      });\n    });\n  }\n  return afterRendersPromise;\n}\n\n/**\n * @returns A promise that resolves after the currently queued renders have\n *     been completed.\n */\nexport function finishQueuedRenders(): Promise<void> {\n  // If there are no queued renders, return a resolved promise so `then`\n  // callbacks trigger immediately.\n  return afterRendersPromise ? afterRendersPromise : Promise.resolve();\n}\n\n/**\n * Triggers an immediate render of all queued renders. Should only be used in\n * cases where queueing renders breaks functionality + backwards compatibility\n * (such as rendering icons).\n *\n * @param workspace If provided, only rerender blocks in this workspace.\n *\n * @internal\n */\nexport function triggerQueuedRenders(workspace?: WorkspaceSvg) {\n  if (!workspace) window.cancelAnimationFrame(animationRequestId);\n  doRenders(workspace);\n  if (!workspace && afterRendersResolver) afterRendersResolver();\n}\n\n/**\n * @returns True if we should always trigger an immediate render.\n *     Some platforms don't properly support `requestAnimationFrame`, so to\n *     avoid glitchiness, we give up the performance improvements.\n */\nfunction alwaysImmediatelyRender() {\n  return userAgent.JavaFx;\n}\n\n/**\n * Adds the given block and its parents to the render queue. Adds the root block\n * to the list of root blocks.\n *\n * @param block The block to queue.\n */\nfunction queueBlock(block: BlockSvg) {\n  dirtyBlocks.add(block);\n  eventGroups.set(block, eventUtils.getGroup());\n  const parent = block.getParent();\n  if (parent) {\n    queueBlock(parent);\n  } else {\n    rootBlocks.add(block);\n  }\n}\n\n/**\n * Rerenders all of the blocks in the queue.\n *\n * @param workspace If provided, only rerender blocks in this workspace.\n */\nfunction doRenders(workspace?: WorkspaceSvg) {\n  const workspaces = workspace\n    ? new Set([workspace])\n    : new Set([...rootBlocks].map((block) => block.workspace));\n  const blocks = [...rootBlocks]\n    .filter(shouldRenderRootBlock)\n    .filter((b) => workspaces.has(b.workspace));\n  for (const block of blocks) {\n    renderBlock(block);\n  }\n  for (const workspace of workspaces) {\n    workspace.resizeContents();\n  }\n  for (const block of blocks) {\n    const blockOrigin = block.getRelativeToSurfaceXY();\n    block.updateComponentLocations(blockOrigin);\n  }\n  for (const block of blocks) {\n    const oldGroup = eventUtils.getGroup();\n    const newGroup = eventGroups.get(block);\n    if (newGroup) eventUtils.setGroup(newGroup);\n\n    block.bumpNeighbours();\n\n    eventUtils.setGroup(oldGroup);\n  }\n\n  for (const block of blocks) {\n    dequeueBlock(block);\n  }\n  if (!workspace) afterRendersPromise = null;\n}\n\n/** Removes the given block and children from the render queue. */\nfunction dequeueBlock(block: BlockSvg) {\n  rootBlocks.delete(block);\n  dirtyBlocks.delete(block);\n  eventGroups.delete(block);\n  for (const child of block.getChildren(false)) {\n    dequeueBlock(child);\n  }\n}\n\n/**\n * Returns true if the block should be rendered.\n *\n * No need to render dead blocks.\n *\n * No need to render blocks with parents. A render for the block may have been\n * queued, and the block was connected to a parent, so it is no longer a\n * root block. Rendering will be triggered through the real root block.\n */\nfunction shouldRenderRootBlock(block: BlockSvg): boolean {\n  return !block.isDisposed() && !block.getParent();\n}\n\n/**\n * Recursively renders all of the dirty children of the given block, and\n * then renders the block.\n *\n * @param block The block to rerender.\n */\nfunction renderBlock(block: BlockSvg) {\n  if (!dirtyBlocks.has(block)) return;\n  if (!block.initialized) return;\n  for (const child of block.getChildren(false)) {\n    renderBlock(child);\n  }\n  block.renderEfficiently();\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.registry\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\n\n/**\n * Registers the given serializer so that it can be used for serialization and\n * deserialization.\n *\n * @param name The name of the serializer to register.\n * @param serializer The serializer to register.\n */\nexport function register(name: string, serializer: ISerializer) {\n  registry.register(registry.Type.SERIALIZER, name, serializer);\n}\n\n/**\n * Unregisters the serializer associated with the given name.\n *\n * @param name The name of the serializer to unregister.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.SERIALIZER, name);\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ISerializer} from '../interfaces/i_serializer.js';\nimport {Workspace} from '../workspace.js';\nimport * as priorities from './priorities.js';\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as eventUtils from '../events/utils.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as serializationRegistry from './registry.js';\nimport {Size} from '../utils/size.js';\n\nexport interface State {\n  id?: string;\n  text?: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  collapsed?: boolean;\n  editable?: boolean;\n  movable?: boolean;\n  deletable?: boolean;\n}\n\n/** Serializes the state of the given comment to JSON. */\nexport function save(\n  comment: WorkspaceComment,\n  {\n    addCoordinates = false,\n    saveIds = true,\n  }: {\n    addCoordinates?: boolean;\n    saveIds?: boolean;\n  } = {},\n): State {\n  const workspace = comment.workspace;\n  const state: State = Object.create(null);\n\n  state.height = comment.getSize().height;\n  state.width = comment.getSize().width;\n\n  if (saveIds) state.id = comment.id;\n  if (addCoordinates) {\n    const loc = comment.getRelativeToSurfaceXY();\n    state.x = workspace.RTL ? workspace.getWidth() - loc.x : loc.x;\n    state.y = loc.y;\n  }\n\n  if (comment.getText()) state.text = comment.getText();\n  if (comment.isCollapsed()) state.collapsed = true;\n  if (!comment.isOwnEditable()) state.editable = false;\n  if (!comment.isOwnMovable()) state.movable = false;\n  if (!comment.isOwnDeletable()) state.deletable = false;\n\n  return state;\n}\n\n/** Appends the comment defined by the given state to the given workspace. */\nexport function append(\n  state: State,\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n): WorkspaceComment {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n\n  const comment = workspace.newComment(state.id);\n\n  if (state.text !== undefined) comment.setText(state.text);\n  if (state.x !== undefined || state.y !== undefined) {\n    const defaultLoc = comment.getRelativeToSurfaceXY();\n    let x = state.x ?? defaultLoc.x;\n    x = workspace.RTL ? workspace.getWidth() - x : x;\n    const y = state.y ?? defaultLoc.y;\n    comment.moveTo(new Coordinate(x, y));\n  }\n  if (state.width !== undefined || state.height) {\n    const defaultSize = comment.getSize();\n    comment.setSize(\n      new Size(\n        state.width ?? defaultSize.width,\n        state.height ?? defaultSize.height,\n      ),\n    );\n  }\n  if (state.collapsed !== undefined) comment.setCollapsed(state.collapsed);\n  if (state.editable !== undefined) comment.setEditable(state.editable);\n  if (state.movable !== undefined) comment.setMovable(state.movable);\n  if (state.deletable !== undefined) comment.setDeletable(state.deletable);\n\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  return comment;\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveComment = save;\n\n/** Serializer for saving and loading workspace comment state. */\nexport class WorkspaceCommentSerializer implements ISerializer {\n  priority = priorities.WORKSPACE_COMMENTS;\n\n  /**\n   * Returns the state of all workspace comments in the given workspace.\n   */\n  save(workspace: Workspace): State[] | null {\n    const commentStates = [];\n    for (const comment of workspace.getTopComments()) {\n      const state = saveComment(comment as AnyDuringMigration, {\n        addCoordinates: true,\n        saveIds: true,\n      });\n      if (state) commentStates.push(state);\n    }\n    return commentStates.length ? commentStates : null;\n  }\n\n  /**\n   * Deserializes the comments defined by the given state into the given\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const commentState of state) {\n      append(commentState, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /** Disposes of any comments that exist on the given workspace. */\n  clear(workspace: Workspace) {\n    for (const comment of workspace.getTopComments()) {\n      comment.dispose();\n    }\n  }\n}\n\nserializationRegistry.register(\n  'workspaceComments',\n  new WorkspaceCommentSerializer(),\n);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ICopyable, ICopyData} from '../interfaces/i_copyable.js';\nimport type {IPaster} from '../interfaces/i_paster.js';\nimport * as registry from '../registry.js';\n\n/**\n * Registers the given paster so that it cna be used for pasting.\n *\n * @param type The type of the paster to register, e.g. 'block', 'comment', etc.\n * @param paster The paster to register.\n */\nexport function register<U extends ICopyData, T extends ICopyable<U>>(\n  type: string,\n  paster: IPaster<U, T>,\n) {\n  registry.register(registry.Type.PASTER, type, paster);\n}\n\n/**\n * Unregisters the paster associated with the given type.\n *\n * @param type The type of the paster to unregister.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.PASTER, type);\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IPaster} from '../interfaces/i_paster.js';\nimport {ICopyData} from '../interfaces/i_copyable.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as registry from './registry.js';\nimport * as commentSerialiation from '../serialization/workspace_comments.js';\nimport * as eventUtils from '../events/utils.js';\nimport * as common from '../common.js';\nimport {RenderedWorkspaceComment} from '../comments/rendered_workspace_comment.js';\n\nexport class WorkspaceCommentPaster\n  implements IPaster<WorkspaceCommentCopyData, RenderedWorkspaceComment>\n{\n  static TYPE = 'workspace-comment';\n\n  paste(\n    copyData: WorkspaceCommentCopyData,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): RenderedWorkspaceComment | null {\n    const state = copyData.commentState;\n\n    if (coordinate) {\n      state['x'] = coordinate.x;\n      state['y'] = coordinate.y;\n    }\n\n    eventUtils.disable();\n    let comment;\n    try {\n      comment = commentSerialiation.append(\n        state,\n        workspace,\n      ) as RenderedWorkspaceComment;\n      moveCommentToNotConflict(comment);\n    } finally {\n      eventUtils.enable();\n    }\n\n    if (!comment) return null;\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_CREATE))(comment));\n    }\n    common.setSelected(comment);\n    return comment;\n  }\n}\n\nfunction moveCommentToNotConflict(comment: RenderedWorkspaceComment) {\n  const workspace = comment.workspace;\n  const translateDistance = 30;\n  const coord = comment.getRelativeToSurfaceXY();\n  const offset = new Coordinate(0, 0);\n  // getRelativeToSurfaceXY is really expensive, so we want to cache this.\n  const otherCoords = workspace\n    .getTopComments(false)\n    .filter((otherComment) => otherComment.id !== comment.id)\n    .map((c) => c.getRelativeToSurfaceXY());\n\n  while (\n    commentOverlapsOtherExactly(Coordinate.sum(coord, offset), otherCoords)\n  ) {\n    offset.translate(\n      workspace.RTL ? -translateDistance : translateDistance,\n      translateDistance,\n    );\n  }\n\n  comment.moveTo(Coordinate.sum(coord, offset));\n}\n\nfunction commentOverlapsOtherExactly(\n  coord: Coordinate,\n  otherCoords: Coordinate[],\n): boolean {\n  return otherCoords.some(\n    (otherCoord) =>\n      Math.abs(otherCoord.x - coord.x) <= 1 &&\n      Math.abs(otherCoord.y - coord.y) <= 1,\n  );\n}\n\nexport interface WorkspaceCommentCopyData extends ICopyData {\n  commentState: commentSerialiation.State;\n}\n\nregistry.register(WorkspaceCommentPaster.TYPE, new WorkspaceCommentPaster());\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.aria\n\n/** ARIA states/properties prefix. */\nconst ARIA_PREFIX = 'aria-';\n\n/** ARIA role attribute. */\nconst ROLE_ATTRIBUTE = 'role';\n\n/**\n * ARIA role values.\n * Copied from Closure's goog.a11y.aria.Role\n */\nexport enum Role {\n  // ARIA role for an interactive control of tabular data.\n  GRID = 'grid',\n\n  // ARIA role for a cell in a grid.\n  GRIDCELL = 'gridcell',\n  // ARIA role for a group of related elements like tree item siblings.\n  GROUP = 'group',\n\n  // ARIA role for a listbox.\n  LISTBOX = 'listbox',\n\n  // ARIA role for a popup menu.\n  MENU = 'menu',\n\n  // ARIA role for menu item elements.\n  MENUITEM = 'menuitem',\n  // ARIA role for a checkbox box element inside a menu.\n  MENUITEMCHECKBOX = 'menuitemcheckbox',\n  // ARIA role for option items that are  children of combobox, listbox, menu,\n  // radiogroup, or tree elements.\n  OPTION = 'option',\n  // ARIA role for ignorable cosmetic elements with no semantic significance.\n  PRESENTATION = 'presentation',\n\n  // ARIA role for a row of cells in a grid.\n  ROW = 'row',\n  // ARIA role for a tree.\n  TREE = 'tree',\n\n  // ARIA role for a tree item that sometimes may be expanded or collapsed.\n  TREEITEM = 'treeitem',\n}\n\n/**\n * ARIA states and properties.\n * Copied from Closure's goog.a11y.aria.State\n */\nexport enum State {\n  // ARIA property for setting the currently active descendant of an element,\n  // for example the selected item in a list box. Value: ID of an element.\n  ACTIVEDESCENDANT = 'activedescendant',\n  // ARIA property defines the total number of columns in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  COLCOUNT = 'colcount',\n  // ARIA state for a disabled item. Value: one of {true, false}.\n  DISABLED = 'disabled',\n\n  // ARIA state for setting whether the element like a tree node is expanded.\n  // Value: one of {true, false, undefined}.\n  EXPANDED = 'expanded',\n\n  // ARIA state indicating that the entered value does not conform. Value:\n  // one of {false, true, 'grammar', 'spelling'}\n  INVALID = 'invalid',\n\n  // ARIA property that provides a label to override any other text, value, or\n  // contents used to describe this element. Value: string.\n  LABEL = 'label',\n  // ARIA property for setting the element which labels another element.\n  // Value: space-separated IDs of elements.\n  LABELLEDBY = 'labelledby',\n\n  // ARIA property for setting the level of an element in the hierarchy.\n  // Value: integer.\n  LEVEL = 'level',\n  // ARIA property indicating if the element is horizontal or vertical.\n  // Value: one of {'vertical', 'horizontal'}.\n  ORIENTATION = 'orientation',\n\n  // ARIA property that defines an element's number of position in a list.\n  // Value: integer.\n  POSINSET = 'posinset',\n\n  // ARIA property defines the total number of rows in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  ROWCOUNT = 'rowcount',\n\n  // ARIA state for setting the currently selected item in the list.\n  // Value: one of {true, false, undefined}.\n  SELECTED = 'selected',\n  // ARIA property defining the number of items in a list. Value: integer.\n  SETSIZE = 'setsize',\n\n  // ARIA property for slider maximum value. Value: number.\n  VALUEMAX = 'valuemax',\n\n  // ARIA property for slider minimum value. Value: number.\n  VALUEMIN = 'valuemin',\n}\n\n/**\n * Sets the role of an element.\n *\n * Similar to Closure's goog.a11y.aria\n *\n * @param element DOM node to set role of.\n * @param roleName Role name.\n */\nexport function setRole(element: Element, roleName: Role) {\n  element.setAttribute(ROLE_ATTRIBUTE, roleName);\n}\n\n/**\n * Sets the state or property of an element.\n * Copied from Closure's goog.a11y.aria\n *\n * @param element DOM node where we set state.\n * @param stateName State attribute being set.\n *     Automatically adds prefix 'aria-' to the state name if the attribute is\n * not an extra attribute.\n * @param value Value for the state attribute.\n */\nexport function setState(\n  element: Element,\n  stateName: State,\n  value: string | boolean | number | string[],\n) {\n  if (Array.isArray(value)) {\n    value = value.join(' ');\n  }\n  const attrStateName = ARIA_PREFIX + stateName;\n  element.setAttribute(attrStateName, `${value}`);\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface ISerializable {\n  /**\n   * @param doFullSerialization If true, this signals that any backing data\n   *     structures used by this ISerializable should also be serialized. This\n   *     is used for copy-paste.\n   * @returns a JSON serializable value that records the ISerializable's state.\n   */\n  saveState(doFullSerialization: boolean): any;\n\n  /**\n   * Takes in a JSON serializable value and sets the ISerializable's state\n   * based on that.\n   *\n   * @param state The state to apply to the ISerializable.\n   */\n  loadState(state: any): void;\n}\n\n/** Type guard that checks whether the given object is a ISerializable. */\nexport function isSerializable(obj: any): obj is ISerializable {\n  return obj.saveState !== undefined && obj.loadState !== undefined;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.blocks\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport {MANUALLY_DISABLED} from '../constants.js';\nimport * as eventUtils from '../events/utils.js';\nimport {inputTypes} from '../inputs/input_types.js';\nimport {isSerializable} from '../interfaces/i_serializable.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport * as renderManagement from '../render_management.js';\n\nimport {\n  BadConnectionCheck,\n  MissingBlockType,\n  MissingConnection,\n  RealChildOfShadow,\n  UnregisteredIcon,\n} from './exceptions.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\nimport * as Variables from '../variables.js';\nimport {VariableModel} from '../variable_model.js';\n\n// TODO(#5160): Remove this once lint is fixed.\n/* eslint-disable no-use-before-define */\n\n/**\n * Represents the state of a connection.\n */\nexport interface ConnectionState {\n  shadow?: State;\n  block?: State;\n}\n\n/**\n * Represents the state of a given block.\n */\nexport interface State {\n  type: string;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  deletable?: boolean;\n  movable?: boolean;\n  editable?: boolean;\n  enabled?: boolean;\n  disabledReasons?: string[];\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * Returns the state of the given block as a plain JavaScript object.\n *\n * @param block The block to serialize.\n * @param param1 addCoordinates: If true, the coordinates of the block are added\n *     to the serialized state. False by default. addinputBlocks: If true,\n *     children of the block which are connected to inputs will be serialized.\n *     True by default. addNextBlocks: If true, children of the block which are\n *     connected to the block's next connection (if it exists) will be\n *     serialized. True by default. doFullSerialization: If true, fields that\n *     normally just save a reference to some external state (eg variables) will\n *     instead serialize all of the info about that state. This supports\n *     deserializing the block into a workspace where that state doesn't yet\n *     exist. True by default.\n * @returns The serialized state of the block, or null if the block could not be\n *     serialied (eg it was an insertion marker).\n */\nexport function save(\n  block: Block,\n  {\n    addCoordinates = false,\n    addInputBlocks = true,\n    addNextBlocks = true,\n    doFullSerialization = true,\n    saveIds = true,\n  }: {\n    addCoordinates?: boolean;\n    addInputBlocks?: boolean;\n    addNextBlocks?: boolean;\n    doFullSerialization?: boolean;\n    saveIds?: boolean;\n  } = {},\n): State | null {\n  if (block.isInsertionMarker()) {\n    return null;\n  }\n  const state = {\n    'type': block.type,\n    'id': saveIds ? block.id : undefined,\n  };\n\n  if (addCoordinates) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveCoords(block, state as AnyDuringMigration);\n  }\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveAttributes(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveExtraState(block, state as AnyDuringMigration, doFullSerialization);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveIcons(block, state as AnyDuringMigration, doFullSerialization);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveFields(block, state as AnyDuringMigration, doFullSerialization);\n  if (addInputBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveInputBlocks(\n      block,\n      state as AnyDuringMigration,\n      doFullSerialization,\n      saveIds,\n    );\n  }\n  if (addNextBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveNextBlocks(\n      block,\n      state as AnyDuringMigration,\n      doFullSerialization,\n      saveIds,\n    );\n  }\n\n  // AnyDuringMigration because:  Type '{ type: string; id: string; }' is not\n  // assignable to type 'State'.\n  return state as AnyDuringMigration;\n}\n\n/**\n * Adds attributes to the given state object based on the state of the block.\n * Eg collapsed, disabled, inline, etc.\n *\n * @param block The block to base the attributes on.\n * @param state The state object to append to.\n */\nfunction saveAttributes(block: Block, state: State) {\n  if (block.isCollapsed()) {\n    state['collapsed'] = true;\n  }\n  if (!block.isEnabled()) {\n    state['disabledReasons'] = Array.from(block.getDisabledReasons());\n  }\n  if (!block.isOwnDeletable()) {\n    state['deletable'] = false;\n  }\n  if (!block.isOwnMovable()) {\n    state['movable'] = false;\n  }\n  if (!block.isOwnEditable()) {\n    state['editable'] = false;\n  }\n  if (\n    block.inputsInline !== undefined &&\n    block.inputsInline !== block.inputsInlineDefault\n  ) {\n    state['inline'] = block.inputsInline;\n  }\n  // Data is a nullable string, so we don't need to worry about falsy values.\n  if (block.data) {\n    state['data'] = block.data;\n  }\n}\n\n/**\n * Adds the coordinates of the given block to the given state object.\n *\n * @param block The block to base the coordinates on.\n * @param state The state object to append to.\n */\nfunction saveCoords(block: Block, state: State) {\n  const workspace = block.workspace;\n  const xy = block.getRelativeToSurfaceXY();\n  state['x'] = Math.round(workspace.RTL ? workspace.getWidth() - xy.x : xy.x);\n  state['y'] = Math.round(xy.y);\n}\n\n/**\n * Adds any extra state the block may provide to the given state object.\n *\n * @param block The block to serialize the extra state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     extra state (rather than possibly saving a reference to some state).\n */\nfunction saveExtraState(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n) {\n  if (block.saveExtraState) {\n    const extraState = block.saveExtraState(doFullSerialization);\n    if (extraState !== null) {\n      state['extraState'] = extraState;\n    }\n  } else if (block.mutationToDom) {\n    const extraState = block.mutationToDom();\n    if (extraState !== null) {\n      state['extraState'] = Xml.domToText(extraState).replace(\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\n        '',\n      );\n    }\n  }\n}\n\n/**\n * Adds the state of all of the icons on the block to the given state object.\n *\n * @param block The block to serialize the icon state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     icon (rather than possibly saving a reference to some state).\n */\nfunction saveIcons(block: Block, state: State, doFullSerialization: boolean) {\n  const icons = Object.create(null);\n  for (const icon of block.getIcons()) {\n    if (isSerializable(icon)) {\n      const state = icon.saveState(doFullSerialization);\n      if (state) icons[icon.getType().toString()] = state;\n    }\n  }\n\n  if (Object.keys(icons).length) {\n    state['icons'] = icons;\n  }\n}\n\n/**\n * Adds the state of all of the fields on the block to the given state object.\n *\n * @param block The block to serialize the field state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     field (rather than possibly saving a reference to some state).\n */\nfunction saveFields(block: Block, state: State, doFullSerialization: boolean) {\n  const fields = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      if (field.isSerializable()) {\n        fields[field.name!] = field.saveState(doFullSerialization);\n      }\n    }\n  }\n  if (Object.keys(fields).length) {\n    state['fields'] = fields;\n  }\n}\n\n/**\n * Adds the state of all of the child blocks of the given block (which are\n * connected to inputs) to the given state object.\n *\n * @param block The block to serialize the input blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveInputBlocks(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n) {\n  const inputs = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    if (!input.connection) continue;\n    const connectionState = saveConnection(\n      input.connection as Connection,\n      doFullSerialization,\n      saveIds,\n    );\n    if (connectionState) {\n      inputs[input.name] = connectionState;\n    }\n  }\n\n  if (Object.keys(inputs).length) {\n    state['inputs'] = inputs;\n  }\n}\n\n/**\n * Adds the state of all of the next blocks of the given block to the given\n * state object.\n *\n * @param block The block to serialize the next blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveNextBlocks(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n) {\n  if (!block.nextConnection) {\n    return;\n  }\n  const connectionState = saveConnection(\n    block.nextConnection,\n    doFullSerialization,\n    saveIds,\n  );\n  if (connectionState) {\n    state['next'] = connectionState;\n  }\n}\n\n/**\n * Returns the state of the given connection (ie the state of any connected\n * shadow or real blocks).\n *\n * @param connection The connection to serialize the connected blocks of.\n * @returns An object containing the state of any connected shadow block, or any\n *     connected real block.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveConnection(\n  connection: Connection,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n): ConnectionState | null {\n  const shadow = connection.getShadowState(true);\n  const child = connection.targetBlock();\n  if (!shadow && !child) {\n    return null;\n  }\n  const state = Object.create(null);\n  if (shadow) {\n    state['shadow'] = shadow;\n  }\n  if (child && !child.isShadow()) {\n    state['block'] = save(child, {doFullSerialization, saveIds});\n  }\n  return state;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n * @returns The block that was just loaded.\n */\nexport function append(\n  state: State,\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n): Block {\n  const block = appendInternal(state, workspace, {recordUndo});\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined internally so that the extra parameters don't clutter our\n * external API.\n * But it is exported so that other places within Blockly can call it directly\n * with the extra parameters.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: If true, the block will be set to a shadow block after\n *     it is created. False by default. recordUndo: If true, events triggered by\n *     this function will be undo-able by the user. False by default.\n * @returns The block that was just appended.\n * @internal\n */\nexport function appendInternal(\n  state: State,\n  workspace: Workspace,\n  {\n    parentConnection = undefined,\n    isShadow = false,\n    recordUndo = false,\n  }: {\n    parentConnection?: Connection;\n    isShadow?: boolean;\n    recordUndo?: boolean;\n  } = {},\n): Block {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n  eventUtils.disable();\n\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let block;\n  try {\n    block = appendPrivate(state, workspace, {parentConnection, isShadow});\n  } finally {\n    eventUtils.enable();\n  }\n\n  // Fire a VarCreate event for each (if any) new variable created.\n  checkNewVariables(workspace, variablesBeforeCreation);\n\n  if (eventUtils.isEnabled()) {\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\n  }\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  // Adding connections to the connection db is expensive. This defers that\n  // operation to decrease load time.\n  if (workspace.rendered) {\n    const blockSvg = block as BlockSvg;\n    setTimeout(() => {\n      if (!blockSvg.disposed) {\n        blockSvg.setConnectionTracking(true);\n      }\n    }, 1);\n  }\n\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined privately so that it can be called recursively without firing\n * eroneous events. Events (and other things we only want to occur on the top\n * block) are handled by appendInternal.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: The block will be set to a shadow block after it is\n *     created. False by default.\n * @returns The block that was just appended.\n */\nfunction appendPrivate(\n  state: State,\n  workspace: Workspace,\n  {\n    parentConnection = undefined,\n    isShadow = false,\n  }: {parentConnection?: Connection; isShadow?: boolean} = {},\n): Block {\n  if (!state['type']) {\n    throw new MissingBlockType(state);\n  }\n\n  const block = workspace.newBlock(state['type'], state['id']);\n  block.setShadow(isShadow);\n  loadCoords(block, state);\n  loadAttributes(block, state);\n  loadExtraState(block, state);\n  tryToConnectParent(parentConnection, block, state);\n  loadIcons(block, state);\n  loadFields(block, state);\n  loadInputBlocks(block, state);\n  loadNextBlocks(block, state);\n  initBlock(block, workspace.rendered);\n\n  return block;\n}\n\n/**\n * Checks the workspace for any new variables that were created during the\n * deserialization of a block and fires a VarCreate event for each.\n *\n * @param workspace The workspace where new variables are being created\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n */\nfunction checkNewVariables(\n  workspace: Workspace,\n  originalVariables: VariableModel[],\n) {\n  if (eventUtils.isEnabled()) {\n    const newVariables = Variables.getAddedVariables(\n      workspace,\n      originalVariables,\n    );\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\n      );\n    }\n  }\n}\n\n/**\n * Applies any coordinate information available on the state object to the\n * block.\n *\n * @param block The block to set the position of.\n * @param state The state object to reference.\n */\nfunction loadCoords(block: Block, state: State) {\n  let x = state['x'] === undefined ? 0 : state['x'];\n  const y = state['y'] === undefined ? 0 : state['y'];\n\n  const workspace = block.workspace;\n  x = workspace.RTL ? workspace.getWidth() - x : x;\n\n  block.moveBy(x, y);\n}\n\n/**\n * Applies any attribute information available on the state object to the block.\n *\n * @param block The block to set the attributes of.\n * @param state The state object to reference.\n */\nfunction loadAttributes(block: Block, state: State) {\n  if (state['collapsed']) {\n    block.setCollapsed(true);\n  }\n  if (state['deletable'] === false) {\n    block.setDeletable(false);\n  }\n  if (state['movable'] === false) {\n    block.setMovable(false);\n  }\n  if (state['editable'] === false) {\n    block.setEditable(false);\n  }\n  if (state['enabled'] === false) {\n    // Before May 2024 we just used 'enabled', with no reasons.\n    // Contiune to support this syntax.\n    block.setDisabledReason(true, MANUALLY_DISABLED);\n  }\n  if (Array.isArray(state['disabledReasons'])) {\n    for (const reason of state['disabledReasons']) {\n      block.setDisabledReason(true, reason);\n    }\n  }\n  if (state['inline'] !== undefined) {\n    block.setInputsInline(state['inline']);\n  }\n  if (state['data'] !== undefined) {\n    block.data = state['data'];\n  }\n}\n\n/**\n * Applies any extra state information available on the state object to the\n * block.\n *\n * @param block The block to set the extra state of.\n * @param state The state object to reference.\n */\nfunction loadExtraState(block: Block, state: State) {\n  if (!state['extraState']) {\n    return;\n  }\n  if (block.loadExtraState) {\n    block.loadExtraState(state['extraState']);\n  } else if (block.domToMutation) {\n    block.domToMutation(utilsXml.textToDom(state['extraState']));\n  }\n}\n\n/**\n * Attempts to connect the block to the parent connection, if it exists.\n *\n * @param parentConnection The parent connection to try to connect the block to.\n * @param child The block to try to connect to the parent.\n * @param state The state which defines the given block\n */\nfunction tryToConnectParent(\n  parentConnection: Connection | undefined,\n  child: Block,\n  state: State,\n) {\n  if (!parentConnection) {\n    return;\n  }\n\n  if (parentConnection.getSourceBlock().isShadow() && !child.isShadow()) {\n    throw new RealChildOfShadow(state);\n  }\n\n  let connected = false;\n  let childConnection;\n  if (parentConnection.type === inputTypes.VALUE) {\n    childConnection = child.outputConnection;\n    if (!childConnection) {\n      throw new MissingConnection('output', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  } else {\n    // Statement type.\n    childConnection = child.previousConnection;\n    if (!childConnection) {\n      throw new MissingConnection('previous', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  }\n\n  if (!connected) {\n    const checker = child.workspace.connectionChecker;\n    throw new BadConnectionCheck(\n      checker.getErrorMessage(\n        checker.canConnectWithReason(childConnection, parentConnection, false),\n        childConnection,\n        parentConnection,\n      ),\n      parentConnection.type === inputTypes.VALUE\n        ? 'output connection'\n        : 'previous connection',\n      child,\n      state,\n    );\n  }\n}\n\n/**\n * Applies icon state to the icons on the block, based on the given state\n * object.\n *\n * @param block The block to set the icon state of.\n * @param state The state object to reference.\n */\nfunction loadIcons(block: Block, state: State) {\n  if (!state['icons']) return;\n\n  const iconTypes = Object.keys(state['icons']);\n  for (const iconType of iconTypes) {\n    const iconState = state['icons'][iconType];\n    let icon = block.getIcon(iconType);\n    if (!icon) {\n      const constructor = registry.getClass(\n        registry.Type.ICON,\n        iconType,\n        false,\n      );\n      if (!constructor) throw new UnregisteredIcon(iconType, block, state);\n      icon = new constructor(block);\n      block.addIcon(icon);\n    }\n    if (isSerializable(icon)) icon.loadState(iconState);\n  }\n}\n\n/**\n * Applies any field information available on the state object to the block.\n *\n * @param block The block to set the field state of.\n * @param state The state object to reference.\n */\nfunction loadFields(block: Block, state: State) {\n  if (!state['fields']) {\n    return;\n  }\n  const keys = Object.keys(state['fields']);\n  for (let i = 0; i < keys.length; i++) {\n    const fieldName = keys[i];\n    const fieldState = state['fields'][fieldName];\n    const field = block.getField(fieldName);\n    if (!field) {\n      console.warn(\n        `Ignoring non-existant field ${fieldName} in block ${block.type}`,\n      );\n      continue;\n    }\n    field.loadState(fieldState);\n  }\n}\n\n/**\n * Creates any child blocks (attached to inputs) defined by the given state\n * and attaches them to the given block.\n *\n * @param block The block to attach input blocks to.\n * @param state The state object to reference.\n */\nfunction loadInputBlocks(block: Block, state: State) {\n  if (!state['inputs']) {\n    return;\n  }\n  const keys = Object.keys(state['inputs']);\n  for (let i = 0; i < keys.length; i++) {\n    const inputName = keys[i];\n    const input = block.getInput(inputName);\n    if (!input || !input.connection) {\n      throw new MissingConnection(inputName, block, state);\n    }\n    loadConnection(input.connection, state['inputs'][inputName]);\n  }\n}\n\n/**\n * Creates any next blocks defined by the given state and attaches them to the\n * given block.\n *\n * @param block The block to attach next blocks to.\n * @param state The state object to reference.\n */\nfunction loadNextBlocks(block: Block, state: State) {\n  if (!state['next']) {\n    return;\n  }\n  if (!block.nextConnection) {\n    throw new MissingConnection('next', block, state);\n  }\n  loadConnection(block.nextConnection, state['next']);\n}\n/**\n * Applies the state defined by connectionState to the given connection, ie\n * assigns shadows and attaches child blocks.\n *\n * @param connection The connection to deserialize the connected blocks of.\n * @param connectionState The object containing the state of any connected\n *     shadow block, or any connected real block.\n */\nfunction loadConnection(\n  connection: Connection,\n  connectionState: ConnectionState,\n) {\n  if (connectionState['shadow']) {\n    connection.setShadowState(connectionState['shadow']);\n  }\n  if (connectionState['block']) {\n    appendPrivate(\n      connectionState['block'],\n      connection.getSourceBlock().workspace,\n      {parentConnection: connection},\n    );\n  }\n}\n\n// TODO(#5146): Remove this from the serialization system.\n/**\n * Initializes the give block, eg init the model, inits the svg, renders, etc.\n *\n * @param block The block to initialize.\n * @param rendered Whether the block is a rendered or headless block.\n */\nfunction initBlock(block: Block, rendered: boolean) {\n  if (rendered) {\n    const blockSvg = block as BlockSvg;\n    // Adding connections to the connection db is expensive. This defers that\n    // operation to decrease load time.\n    blockSvg.setConnectionTracking(false);\n\n    blockSvg.initSvg();\n    blockSvg.queueRender();\n\n    // fixes #6076 JSO deserialization doesn't\n    // set .iconXY_ property so here it will be set\n    for (const icon of blockSvg.getIcons()) {\n      icon.onLocationChange(blockSvg.getRelativeToSurfaceXY());\n    }\n  } else {\n    block.initModel();\n  }\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveBlock = save;\n\n/**\n * Serializer for saving and loading block state.\n */\nexport class BlockSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing blocks. */\n    this.priority = priorities.BLOCKS;\n  }\n\n  /**\n   * Serializes the blocks of the given workspace.\n   *\n   * @param workspace The workspace to save the blocks of.\n   * @returns The state of the workspace's blocks, or null if there are no\n   *     blocks.\n   */\n  save(\n    workspace: Workspace,\n  ): {languageVersion: number; blocks: State[]} | null {\n    const blockStates = [];\n    for (const block of workspace.getTopBlocks(false)) {\n      const state = saveBlock(block, {\n        addCoordinates: true,\n        doFullSerialization: false,\n      });\n      if (state) {\n        blockStates.push(state);\n      }\n    }\n    if (blockStates.length) {\n      return {\n        'languageVersion': 0, // Currently unused.\n        'blocks': blockStates,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Deserializes the blocks defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the blocks to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(\n    state: {languageVersion: number; blocks: State[]},\n    workspace: Workspace,\n  ) {\n    const blockStates = state['blocks'];\n    for (const state of blockStates) {\n      append(state, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /**\n   * Disposes of any blocks that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the blocks of.\n   */\n  clear(workspace: Workspace) {\n    // Cannot use workspace.clear() because that also removes variables.\n    for (const block of workspace.getTopBlocks(false)) {\n      block.dispose(false);\n    }\n  }\n}\n\nserializationRegistry.register('blocks', new BlockSerializer());\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface IHasBubble {\n  /** @returns True if the bubble is currently open, false otherwise. */\n  bubbleIsVisible(): boolean;\n\n  /** Sets whether the bubble is open or not. */\n  setBubbleVisible(visible: boolean): Promise<void>;\n}\n\n/** Type guard that checks whether the given object is a IHasBubble. */\nexport function hasBubble(obj: any): obj is IHasBubble {\n  return (\n    obj.bubbleIsVisible !== undefined && obj.setBubbleVisible !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.math\n\n/**\n * Converts degrees to radians.\n * Copied from Closure's goog.math.toRadians.\n *\n * @param angleDegrees Angle in degrees.\n * @returns Angle in radians.\n */\nexport function toRadians(angleDegrees: number): number {\n  return (angleDegrees * Math.PI) / 180;\n}\n\n/**\n * Converts radians to degrees.\n * Copied from Closure's goog.math.toDegrees.\n *\n * @param angleRadians Angle in radians.\n * @returns Angle in degrees.\n */\nexport function toDegrees(angleRadians: number): number {\n  return (angleRadians * 180) / Math.PI;\n}\n\n/**\n * Clamp the provided number between the lower bound and the upper bound.\n *\n * @param lowerBound The desired lower bound.\n * @param number The number to clamp.\n * @param upperBound The desired upper bound.\n * @returns The clamped number.\n */\nexport function clamp(\n  lowerBound: number,\n  number: number,\n  upperBound: number,\n): number {\n  if (upperBound < lowerBound) {\n    const temp = upperBound;\n    upperBound = lowerBound;\n    lowerBound = temp;\n  }\n  return Math.max(lowerBound, Math.min(number, upperBound));\n}\n", "/**\n * @license\n * Copyright 2016 Massachusetts Institute of Technology\n * All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A div that floats on top of the workspace, for drop-down menus.\n *\n * @class\n */\n// Former goog.module ID: Blockly.dropDownDiv\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Field} from './field.js';\nimport * as math from './utils/math.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Arrow size in px. Should match the value in CSS\n * (need to position pre-render).\n */\nexport const ARROW_SIZE = 16;\n\n/**\n * Drop-down border size in px. Should match the value in CSS (need to position\n * the arrow).\n */\nexport const BORDER_SIZE = 1;\n\n/**\n * Amount the arrow must be kept away from the edges of the main drop-down div,\n * in px.\n */\nexport const ARROW_HORIZONTAL_PADDING = 12;\n\n/** Amount drop-downs should be padded away from the source, in px. */\nexport const PADDING_Y = 16;\n\n/** Length of animations in seconds. */\nexport const ANIMATION_TIME = 0.25;\n\n/**\n * Timer for animation out, to be cleared if we need to immediately hide\n * without disrupting new shows.\n */\nlet animateOutTimer: ReturnType<typeof setTimeout> | null = null;\n\n/** Callback for when the drop-down is hidden. */\nlet onHide: Function | null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet renderedClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The content element. */\nlet div: HTMLDivElement;\n\n/** The content element. */\nlet content: HTMLDivElement;\n\n/** The arrow element. */\nlet arrow: HTMLDivElement;\n\n/**\n * Drop-downs will appear within the bounds of this element if possible.\n * Set in setBoundsElement.\n */\nlet boundsElement: Element | null = null;\n\n/** The object currently using the drop-down. */\nlet owner: Field | null = null;\n\n/** Whether the dropdown was positioned to a field or the source block. */\nlet positionToField: boolean | null = null;\n\n/**\n * Dropdown bounds info object used to encapsulate sizing information about a\n * bounding element (bounding box and width/height).\n */\nexport interface BoundsInfo {\n  top: number;\n  left: number;\n  bottom: number;\n  right: number;\n  width: number;\n  height: number;\n}\n\n/** Dropdown position metrics. */\nexport interface PositionMetrics {\n  initialX: number;\n  initialY: number;\n  finalX: number;\n  finalY: number;\n  arrowX: number | null;\n  arrowY: number | null;\n  arrowAtTop: boolean | null;\n  arrowVisible: boolean;\n}\n\n/**\n * Create and insert the DOM element for this div.\n *\n * @internal\n */\nexport function createDom() {\n  if (document.querySelector('.blocklyDropDownDiv')) {\n    return; // Already created.\n  }\n  div = document.createElement('div');\n  div.className = 'blocklyDropDownDiv';\n  const parentDiv = common.getParentContainer() || document.body;\n  parentDiv.appendChild(div);\n\n  content = document.createElement('div');\n  content.className = 'blocklyDropDownContent';\n  div.appendChild(content);\n\n  arrow = document.createElement('div');\n  arrow.className = 'blocklyDropDownArrow';\n  div.appendChild(arrow);\n\n  div.style.opacity = '0';\n  // Transition animation for transform: translate() and opacity.\n  div.style.transition =\n    'transform ' + ANIMATION_TIME + 's, ' + 'opacity ' + ANIMATION_TIME + 's';\n\n  // Handle focusin/out events to add a visual indicator when\n  // a child is focused or blurred.\n  div.addEventListener('focusin', function () {\n    dom.addClass(div, 'blocklyFocused');\n  });\n  div.addEventListener('focusout', function () {\n    dom.removeClass(div, 'blocklyFocused');\n  });\n}\n\n/**\n * Set an element to maintain bounds within. Drop-downs will appear\n * within the box of this element if possible.\n *\n * @param boundsElem Element to bind drop-down to.\n */\nexport function setBoundsElement(boundsElem: Element | null) {\n  boundsElement = boundsElem;\n}\n\n/**\n * @returns The field that currently owns this, or null.\n */\nexport function getOwner(): Field | null {\n  return owner;\n}\n\n/**\n * Provide the div for inserting content into the drop-down.\n *\n * @returns Div to populate with content.\n */\nexport function getContentDiv(): Element {\n  return content;\n}\n\n/** Clear the content of the drop-down. */\nexport function clearContent() {\n  content.textContent = '';\n  content.style.width = '';\n}\n\n/**\n * Set the colour for the drop-down.\n *\n * @param backgroundColour Any CSS colour for the background.\n * @param borderColour Any CSS colour for the border.\n */\nexport function setColour(backgroundColour: string, borderColour: string) {\n  div.style.backgroundColor = backgroundColour;\n  div.style.borderColor = borderColour;\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular block. The primary position will be below the block,\n * and the secondary position above the block. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field showing the drop-down.\n * @param block Block to position the drop-down around.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByBlock<T>(\n  field: Field<T>,\n  block: BlockSvg,\n  opt_onHide?: Function,\n  opt_secondaryYOffset?: number,\n): boolean {\n  return showPositionedByRect(\n    getScaledBboxOfBlock(block),\n    field as Field,\n    opt_onHide,\n    opt_secondaryYOffset,\n  );\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular field. The primary position will be below the field,\n * and the secondary position above the field. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByField<T>(\n  field: Field<T>,\n  opt_onHide?: Function,\n  opt_secondaryYOffset?: number,\n): boolean {\n  positionToField = true;\n  return showPositionedByRect(\n    getScaledBboxOfField(field as Field),\n    field as Field,\n    opt_onHide,\n    opt_secondaryYOffset,\n  );\n}\n/**\n * Get the scaled bounding box of a block.\n *\n * @param block The block.\n * @returns The scaled bounding box of the block.\n */\nfunction getScaledBboxOfBlock(block: BlockSvg): Rect {\n  const blockSvg = block.getSvgRoot();\n  const scale = block.workspace.scale;\n  const scaledHeight = block.height * scale;\n  const scaledWidth = block.width * scale;\n  const xy = style.getPageOffset(blockSvg);\n  return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n}\n\n/**\n * Get the scaled bounding box of a field.\n *\n * @param field The field.\n * @returns The scaled bounding box of the field.\n */\nfunction getScaledBboxOfField(field: Field): Rect {\n  const bBox = field.getScaledBBox();\n  return new Rect(bBox.top, bBox.bottom, bBox.left, bBox.right);\n}\n\n/**\n * Helper method to show and place the drop-down with positioning determined\n * by a scaled bounding box.  The primary position will be below the rect,\n * and the secondary position above the rect. Drop-down will be constrained to\n * the block's workspace.\n *\n * @param bBox The scaled bounding box.\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nfunction showPositionedByRect(\n  bBox: Rect,\n  field: Field,\n  opt_onHide?: Function,\n  opt_secondaryYOffset?: number,\n): boolean {\n  // If we can fit it, render below the block.\n  const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n  const primaryY = bBox.bottom;\n  // If we can't fit it, render above the entire parent block.\n  const secondaryX = primaryX;\n  let secondaryY = bBox.top;\n  if (opt_secondaryYOffset) {\n    secondaryY += opt_secondaryYOffset;\n  }\n  const sourceBlock = field.getSourceBlock() as BlockSvg;\n  // Set bounds to main workspace; show the drop-down.\n  let workspace = sourceBlock.workspace;\n  while (workspace.options.parentWorkspace) {\n    workspace = workspace.options.parentWorkspace;\n  }\n  setBoundsElement(workspace.getParentSvg().parentNode as Element | null);\n  return show(\n    field,\n    sourceBlock.RTL,\n    primaryX,\n    primaryY,\n    secondaryX,\n    secondaryY,\n    opt_onHide,\n  );\n}\n\n/**\n * Show and place the drop-down.\n * The drop-down is placed with an absolute \"origin point\" (x, y) - i.e.,\n * the arrow will point at this origin and box will positioned below or above\n * it.  If we can maintain the container bounds at the primary point, the arrow\n * will point there, and the container will be positioned below it.\n * If we can't maintain the container bounds at the primary point, fall-back to\n * the secondary point and position above.\n *\n * @param newOwner The object showing the drop-down\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @returns True if the menu rendered at the primary origin point.\n * @internal\n */\nexport function show<T>(\n  newOwner: Field<T>,\n  rtl: boolean,\n  primaryX: number,\n  primaryY: number,\n  secondaryX: number,\n  secondaryY: number,\n  opt_onHide?: Function,\n): boolean {\n  owner = newOwner as Field;\n  onHide = opt_onHide || null;\n  // Set direction.\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  renderedClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (renderedClassName) {\n    dom.addClass(div, renderedClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n\n  // When we change `translate` multiple times in close succession,\n  // Chrome may choose to wait and apply them all at once.\n  // Since we want the translation to initial X, Y to be immediate,\n  // and the translation to final X, Y to be animated,\n  // we saw problems where both would be applied after animation was turned on,\n  // making the dropdown appear to fly in from (0, 0).\n  // Using both `left`, `top` for the initial translation and then `translate`\n  // for the animated transition to final X, Y is a workaround.\n  return positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n}\n\nconst internal = {\n  /**\n   * Get sizing info about the bounding element.\n   *\n   * @returns An object containing size information about the bounding element\n   *     (bounding box and width/height).\n   */\n  getBoundsInfo: function (): BoundsInfo {\n    const boundPosition = style.getPageOffset(boundsElement as Element);\n    const boundSize = style.getSize(boundsElement as Element);\n\n    return {\n      left: boundPosition.x,\n      right: boundPosition.x + boundSize.width,\n      top: boundPosition.y,\n      bottom: boundPosition.y + boundSize.height,\n      width: boundSize.width,\n      height: boundSize.height,\n    };\n  },\n\n  /**\n   * Helper to position the drop-down and the arrow, maintaining bounds.\n   * See explanation of origin points in show.\n   *\n   * @param primaryX Desired origin point x, in absolute px.\n   * @param primaryY Desired origin point y, in absolute px.\n   * @param secondaryX Secondary/alternative origin point x, in absolute px.\n   * @param secondaryY Secondary/alternative origin point y, in absolute px.\n   * @returns Various final metrics, including rendered positions for drop-down\n   *     and arrow.\n   */\n  getPositionMetrics: function (\n    primaryX: number,\n    primaryY: number,\n    secondaryX: number,\n    secondaryY: number,\n  ): PositionMetrics {\n    const boundsInfo = internal.getBoundsInfo();\n    const divSize = style.getSize(div as Element);\n\n    // Can we fit in-bounds below the target?\n    if (primaryY + divSize.height < boundsInfo.bottom) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit in-bounds above the target?\n    if (secondaryY - divSize.height > boundsInfo.top) {\n      return getPositionAboveMetrics(\n        secondaryX,\n        secondaryY,\n        boundsInfo,\n        divSize,\n      );\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // below?\n    if (primaryY + divSize.height < document.documentElement.clientHeight) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // above?\n    if (secondaryY - divSize.height > document.documentElement.clientTop) {\n      return getPositionAboveMetrics(\n        secondaryX,\n        secondaryY,\n        boundsInfo,\n        divSize,\n      );\n    }\n\n    // Last resort, render at top of page.\n    return getPositionTopOfPageMetrics(primaryX, boundsInfo, divSize);\n  },\n};\n\n/**\n * Get the metrics for positioning the div below the source.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionBelowMetrics(\n  primaryX: number,\n  primaryY: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    primaryX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  const arrowY = -(ARROW_SIZE / 2 + BORDER_SIZE);\n  const finalY = primaryY + PADDING_Y;\n\n  return {\n    initialX: xCoords.divX,\n    initialY: primaryY,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: true,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div above the source.\n *\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionAboveMetrics(\n  secondaryX: number,\n  secondaryY: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    secondaryX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  const arrowY = divSize.height - BORDER_SIZE * 2 - ARROW_SIZE / 2;\n  const finalY = secondaryY - divSize.height - PADDING_Y;\n  const initialY = secondaryY - divSize.height; // No padding on Y.\n\n  return {\n    initialX: xCoords.divX,\n    initialY,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: false,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div at the top of the page.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionTopOfPageMetrics(\n  sourceX: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    sourceX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  // No need to provide arrow-specific information because it won't be visible.\n  return {\n    initialX: xCoords.divX,\n    initialY: 0,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY: 0, // Y position remains constant during animation.\n    arrowAtTop: null,\n    arrowX: null,\n    arrowY: null,\n    arrowVisible: false,\n  };\n}\n\n/**\n * Get the x positions for the left side of the DropDownDiv and the arrow,\n * accounting for the bounds of the workspace.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsLeft The left edge of the bounding element, in absolute px.\n * @param boundsRight The right edge of the bounding element, in absolute px.\n * @param divWidth The width of the div in px.\n * @returns An object containing metrics for the x positions of the left side of\n *     the DropDownDiv and the arrow.\n * @internal\n */\nexport function getPositionX(\n  sourceX: number,\n  boundsLeft: number,\n  boundsRight: number,\n  divWidth: number,\n): {divX: number; arrowX: number} {\n  let divX = sourceX;\n  // Offset the topLeft coord so that the dropdowndiv is centered.\n  divX -= divWidth / 2;\n  // Fit the dropdowndiv within the bounds of the workspace.\n  divX = math.clamp(boundsLeft, divX, boundsRight - divWidth);\n\n  let arrowX = sourceX;\n  // Offset the arrow coord so that the arrow is centered.\n  arrowX -= ARROW_SIZE / 2;\n  // Convert the arrow position to be relative to the top left of the div.\n  let relativeArrowX = arrowX - divX;\n  const horizPadding = ARROW_HORIZONTAL_PADDING;\n  // Clamp the arrow position so that it stays attached to the dropdowndiv.\n  relativeArrowX = math.clamp(\n    horizPadding,\n    relativeArrowX,\n    divWidth - horizPadding - ARROW_SIZE,\n  );\n\n  return {arrowX: relativeArrowX, divX};\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Hide the menu only if it is owned by the provided object.\n *\n * @param divOwner Object which must be owning the drop-down to hide.\n * @param opt_withoutAnimation True if we should hide the dropdown without\n *     animating.\n * @returns True if hidden.\n */\nexport function hideIfOwner<T>(\n  divOwner: Field<T>,\n  opt_withoutAnimation?: boolean,\n): boolean {\n  if (owner === divOwner) {\n    if (opt_withoutAnimation) {\n      hideWithoutAnimation();\n    } else {\n      hide();\n    }\n    return true;\n  }\n  return false;\n}\n\n/** Hide the menu, triggering animation. */\nexport function hide() {\n  // Start the animation by setting the translation and fading out.\n  // Reset to (initialX, initialY) - i.e., no translation.\n  div.style.transform = 'translate(0, 0)';\n  div.style.opacity = '0';\n  // Finish animation - reset all values to default.\n  animateOutTimer = setTimeout(function () {\n    hideWithoutAnimation();\n  }, ANIMATION_TIME * 1000);\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n}\n\n/** Hide the menu, without animation. */\nexport function hideWithoutAnimation() {\n  if (!isVisible()) {\n    return;\n  }\n  if (animateOutTimer) {\n    clearTimeout(animateOutTimer);\n  }\n\n  // Reset style properties in case this gets called directly\n  // instead of hide() - see discussion on #2551.\n  div.style.transform = '';\n  div.style.left = '';\n  div.style.top = '';\n  div.style.opacity = '0';\n  div.style.display = 'none';\n  div.style.backgroundColor = '';\n  div.style.borderColor = '';\n\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n  clearContent();\n  owner = null;\n\n  if (renderedClassName) {\n    dom.removeClass(div, renderedClassName);\n    renderedClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Set the dropdown div's position.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @returns True if the menu rendered at the primary origin point.\n */\nfunction positionInternal(\n  primaryX: number,\n  primaryY: number,\n  secondaryX: number,\n  secondaryY: number,\n): boolean {\n  const metrics = internal.getPositionMetrics(\n    primaryX,\n    primaryY,\n    secondaryX,\n    secondaryY,\n  );\n\n  // Update arrow CSS.\n  if (metrics.arrowVisible) {\n    arrow.style.display = '';\n    arrow.style.transform =\n      'translate(' +\n      metrics.arrowX +\n      'px,' +\n      metrics.arrowY +\n      'px) rotate(45deg)';\n    arrow.setAttribute(\n      'class',\n      metrics.arrowAtTop\n        ? 'blocklyDropDownArrow blocklyArrowTop'\n        : 'blocklyDropDownArrow blocklyArrowBottom',\n    );\n  } else {\n    arrow.style.display = 'none';\n  }\n\n  const initialX = Math.floor(metrics.initialX);\n  const initialY = Math.floor(metrics.initialY);\n  const finalX = Math.floor(metrics.finalX);\n  const finalY = Math.floor(metrics.finalY);\n\n  // First apply initial translation.\n  div.style.left = initialX + 'px';\n  div.style.top = initialY + 'px';\n\n  // Show the div.\n  div.style.display = 'block';\n  div.style.opacity = '1';\n  // Add final translate, animated through `transition`.\n  // Coordinates are relative to (initialX, initialY),\n  // where the drop-down is absolutely positioned.\n  const dx = finalX - initialX;\n  const dy = finalY - initialY;\n  div.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';\n\n  return !!metrics.arrowAtTop;\n}\n\n/**\n * Repositions the dropdownDiv on window resize. If it doesn't know how to\n * calculate the new position, it will just hide it instead.\n *\n * @internal\n */\nexport function repositionForWindowResize() {\n  // This condition mainly catches the dropdown div when it is being used as a\n  // dropdown.  It is important not to close it in this case because on Android,\n  // when a field is focused, the soft keyboard opens triggering a window resize\n  // event and we want the dropdown div to stick around so users can type into\n  // it.\n  if (owner) {\n    const block = owner.getSourceBlock() as BlockSvg;\n    const bBox = positionToField\n      ? getScaledBboxOfField(owner)\n      : getScaledBboxOfBlock(block);\n    // If we can fit it, render below the block.\n    const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n    const primaryY = bBox.bottom;\n    // If we can't fit it, render above the entire parent block.\n    const secondaryX = primaryX;\n    const secondaryY = bBox.top;\n    positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n  } else {\n    hide();\n  }\n}\n\nexport const TEST_ONLY = internal;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.string\n\n/**\n * Given an array of strings, return the length of the shortest one.\n *\n * @param array Array of strings.\n * @returns Length of shortest string.\n */\nexport function shortestStringLength(array: string[]): number {\n  if (!array.length) {\n    return 0;\n  }\n  return array.reduce(function (a, b) {\n    return a.length < b.length ? a : b;\n  }).length;\n}\n\n/**\n * Given an array of strings, return the length of the common prefix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common prefix.\n */\nexport function commonWordPrefix(\n  array: string[],\n  opt_shortest?: number,\n): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0][len];\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i][len]) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i][len];\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Given an array of strings, return the length of the common suffix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common suffix.\n */\nexport function commonWordSuffix(\n  array: string[],\n  opt_shortest?: number,\n): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0].substr(-len - 1, 1);\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i].substr(-len - 1, 1)) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i].charAt(array[i].length - len - 1);\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Wrap text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nexport function wrap(text: string, limit: number): string {\n  const lines = text.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    lines[i] = wrapLine(lines[i], limit);\n  }\n  return lines.join('\\n');\n}\n\n/**\n * Wrap single line of text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nfunction wrapLine(text: string, limit: number): string {\n  if (text.length <= limit) {\n    // Short text, no need to wrap.\n    return text;\n  }\n  // Split the text into words.\n  const words = text.trim().split(/\\s+/);\n  // Set limit to be the length of the largest word.\n  for (let i = 0; i < words.length; i++) {\n    if (words[i].length > limit) {\n      limit = words[i].length;\n    }\n  }\n\n  let lastScore;\n  let score = -Infinity;\n  let lastText;\n  let lineCount = 1;\n  do {\n    lastScore = score;\n    lastText = text;\n    // Create a list of booleans representing if a space (false) or\n    // a break (true) appears after each word.\n    let wordBreaks = [];\n    // Seed the list with evenly spaced linebreaks.\n    const steps = words.length / lineCount;\n    let insertedBreaks = 1;\n    for (let i = 0; i < words.length - 1; i++) {\n      if (insertedBreaks < (i + 1.5) / steps) {\n        insertedBreaks++;\n        wordBreaks[i] = true;\n      } else {\n        wordBreaks[i] = false;\n      }\n    }\n    wordBreaks = wrapMutate(words, wordBreaks, limit);\n    score = wrapScore(words, wordBreaks, limit);\n    text = wrapToText(words, wordBreaks);\n    lineCount++;\n  } while (score > lastScore);\n  return lastText;\n}\n\n/**\n * Compute a score for how good the wrapping is.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns Larger the better.\n */\nfunction wrapScore(\n  words: string[],\n  wordBreaks: boolean[],\n  limit: number,\n): number {\n  // If this function becomes a performance liability, add caching.\n  // Compute the length of each line.\n  const lineLengths = [0];\n  const linePunctuation = [];\n  for (let i = 0; i < words.length; i++) {\n    lineLengths[lineLengths.length - 1] += words[i].length;\n    if (wordBreaks[i] === true) {\n      lineLengths.push(0);\n      linePunctuation.push(words[i].charAt(words[i].length - 1));\n    } else if (wordBreaks[i] === false) {\n      lineLengths[lineLengths.length - 1]++;\n    }\n  }\n  const maxLength = Math.max(...lineLengths);\n\n  let score = 0;\n  for (let i = 0; i < lineLengths.length; i++) {\n    // Optimize for width.\n    // -2 points per char over limit (scaled to the power of 1.5).\n    score -= Math.pow(Math.abs(limit - lineLengths[i]), 1.5) * 2;\n    // Optimize for even lines.\n    // -1 point per char smaller than max (scaled to the power of 1.5).\n    score -= Math.pow(maxLength - lineLengths[i], 1.5);\n    // Optimize for structure.\n    // Add score to line endings after punctuation.\n    if ('.?!'.includes(linePunctuation[i])) {\n      score += limit / 3;\n    } else if (',;)]}'.includes(linePunctuation[i])) {\n      score += limit / 4;\n    }\n  }\n  // All else being equal, the last line should not be longer than the\n  // previous line.  For example, this looks wrong:\n  // aaa bbb\n  // ccc ddd eee\n  if (\n    lineLengths.length > 1 &&\n    lineLengths[lineLengths.length - 1] <= lineLengths[lineLengths.length - 2]\n  ) {\n    score += 0.5;\n  }\n  return score;\n}\n/**\n * Mutate the array of line break locations until an optimal solution is found.\n * No line breaks are added or deleted, they are simply moved around.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns New array of optimal line breaks.\n */\nfunction wrapMutate(\n  words: string[],\n  wordBreaks: boolean[],\n  limit: number,\n): boolean[] {\n  let bestScore = wrapScore(words, wordBreaks, limit);\n  let bestBreaks;\n  // Try shifting every line break forward or backward.\n  for (let i = 0; i < wordBreaks.length - 1; i++) {\n    if (wordBreaks[i] === wordBreaks[i + 1]) {\n      continue;\n    }\n    const mutatedWordBreaks = new Array<boolean>().concat(wordBreaks);\n    mutatedWordBreaks[i] = !mutatedWordBreaks[i];\n    mutatedWordBreaks[i + 1] = !mutatedWordBreaks[i + 1];\n    const mutatedScore = wrapScore(words, mutatedWordBreaks, limit);\n    if (mutatedScore > bestScore) {\n      bestScore = mutatedScore;\n      bestBreaks = mutatedWordBreaks;\n    }\n  }\n  if (bestBreaks) {\n    // Found an improvement.  See if it may be improved further.\n    return wrapMutate(words, bestBreaks, limit);\n  }\n  // No improvements found.  Done.\n  return wordBreaks;\n}\n\n/**\n * Reassemble the array of words into text, with the specified line breaks.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @returns Plain text.\n */\nfunction wrapToText(words: string[], wordBreaks: boolean[]): string {\n  const text = [];\n  for (let i = 0; i < words.length; i++) {\n    text.push(words[i]);\n    if (wordBreaks[i] !== undefined) {\n      text.push(wordBreaks[i] ? '\\n' : ' ');\n    }\n  }\n  return text.join('');\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n */\nexport function isNumber(str: string): boolean {\n  return /^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(str);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Tooltip\n\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as blocklyString from './utils/string.js';\n\n/**\n * A type which can define a tooltip.\n * Either a string, an object containing a tooltip property, or a function which\n * returns either a string, or another arbitrarily nested function which\n * eventually unwinds to a string.\n */\nexport type TipInfo =\n  | string\n  | {tooltip: AnyDuringMigration}\n  | (() => TipInfo | string | Function);\n\n/**\n * A function that renders custom tooltip UI.\n * 1st parameter: the div element to render content into.\n * 2nd parameter: the element being moused over (i.e., the element for which the\n * tooltip should be shown).\n */\nexport type CustomTooltip = (p1: Element, p2: Element) => AnyDuringMigration;\n\n/**\n * An optional function that renders custom tooltips into the provided DIV. If\n * this is defined, the function will be called instead of rendering the default\n * tooltip UI.\n */\nlet customTooltip: CustomTooltip | undefined = undefined;\n\n/**\n * Sets a custom function that will be called if present instead of the default\n * tooltip UI.\n *\n * @param customFn A custom tooltip used to render an alternate tooltip UI.\n */\nexport function setCustomTooltip(customFn: CustomTooltip) {\n  customTooltip = customFn;\n}\n\n/**\n * Gets the custom tooltip function.\n *\n * @returns The custom tooltip function, if defined.\n */\nexport function getCustomTooltip(): CustomTooltip | undefined {\n  return customTooltip;\n}\n\n/** Is a tooltip currently showing? */\nlet visible = false;\n\n/**\n * Returns whether or not a tooltip is showing\n *\n * @returns True if a tooltip is showing\n */\nexport function isVisible(): boolean {\n  return visible;\n}\n\n/** Is someone else blocking the tooltip from being shown? */\nlet blocked = false;\n\n/**\n * Maximum width (in characters) of a tooltip.\n */\nexport const LIMIT = 50;\n\n/** PID of suspended thread to clear tooltip on mouse out. */\nlet mouseOutPid: AnyDuringMigration = 0;\n\n/** PID of suspended thread to show the tooltip. */\nlet showPid: AnyDuringMigration = 0;\n\n/**\n * Last observed X location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastX = 0;\n\n/**\n * Last observed Y location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastY = 0;\n\n/** Current element being pointed at. */\nlet element: AnyDuringMigration = null;\n\n/**\n * Once a tooltip has opened for an element, that element is 'poisoned' and\n * cannot respawn a tooltip until the pointer moves over a different element.\n */\nlet poisonedElement: AnyDuringMigration = null;\n\n/**\n * Horizontal offset between mouse cursor and tooltip.\n */\nexport const OFFSET_X = 0;\n\n/**\n * Vertical offset between mouse cursor and tooltip.\n */\nexport const OFFSET_Y = 10;\n\n/**\n * Radius mouse can move before killing tooltip.\n */\nexport const RADIUS_OK = 10;\n\n/**\n * Delay before tooltip appears.\n */\nexport const HOVER_MS = 750;\n\n/**\n * Horizontal padding between tooltip and screen edge.\n */\nexport const MARGINS = 5;\n\n/** The HTML container.  Set once by createDom. */\nlet containerDiv: HTMLDivElement | null = null;\n\n/**\n * Returns the HTML tooltip container.\n *\n * @returns The HTML tooltip container.\n */\nexport function getDiv(): HTMLDivElement | null {\n  return containerDiv;\n}\n\n/**\n * Returns the tooltip text for the given element.\n *\n * @param object The object to get the tooltip text of.\n * @returns The tooltip text of the element.\n */\nexport function getTooltipOfObject(object: AnyDuringMigration | null): string {\n  const obj = getTargetObject(object);\n  if (obj) {\n    let tooltip = obj.tooltip;\n    while (typeof tooltip === 'function') {\n      tooltip = tooltip();\n    }\n    if (typeof tooltip !== 'string') {\n      throw Error('Tooltip function must return a string.');\n    }\n    return tooltip;\n  }\n  return '';\n}\n\n/**\n * Returns the target object that the given object is targeting for its\n * tooltip. Could be the object itself.\n *\n * @param obj The object are trying to find the target tooltip object of.\n * @returns The target tooltip object.\n */\nfunction getTargetObject(\n  obj: object | null,\n): {tooltip: AnyDuringMigration} | null {\n  while (obj && (obj as any).tooltip) {\n    if (\n      typeof (obj as any).tooltip === 'string' ||\n      typeof (obj as any).tooltip === 'function'\n    ) {\n      return obj as {tooltip: string | (() => string)};\n    }\n    obj = (obj as any).tooltip;\n  }\n  return null;\n}\n\n/**\n * Create the tooltip div and inject it onto the page.\n */\nexport function createDom() {\n  if (document.querySelector('.blocklyTooltipDiv')) {\n    return; // Already created.\n  }\n  // Create an HTML container for popup overlays (e.g. editor widgets).\n  containerDiv = document.createElement('div');\n  containerDiv.className = 'blocklyTooltipDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Binds the required mouse events onto an SVG element.\n *\n * @param element SVG element onto which tooltip is to be bound.\n */\nexport function bindMouseEvents(element: Element) {\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  (element as AnyDuringMigration).mouseOverWrapper_ = browserEvents.bind(\n    element,\n    'pointerover',\n    null,\n    onMouseOver,\n  );\n  (element as AnyDuringMigration).mouseOutWrapper_ = browserEvents.bind(\n    element,\n    'pointerout',\n    null,\n    onMouseOut,\n  );\n\n  // Don't use bindEvent_ for mousemove since that would create a\n  // corresponding touch handler, even though this only makes sense in the\n  // context of a mouseover/mouseout.\n  element.addEventListener('pointermove', onMouseMove, false);\n}\n\n/**\n * Unbinds tooltip mouse events from the SVG element.\n *\n * @param element SVG element onto which tooltip is bound.\n */\nexport function unbindMouseEvents(element: Element | null) {\n  if (!element) {\n    return;\n  }\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  browserEvents.unbind((element as AnyDuringMigration).mouseOverWrapper_);\n  browserEvents.unbind((element as AnyDuringMigration).mouseOutWrapper_);\n  element.removeEventListener('pointermove', onMouseMove);\n}\n\n/**\n * Hide the tooltip if the mouse is over a different object.\n * Initialize the tooltip to potentially appear for this object.\n *\n * @param e Mouse event.\n */\nfunction onMouseOver(e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // If the tooltip is an object, treat it as a pointer to the next object in\n  // the chain to look at.  Terminate when a string or function is found.\n  const newElement = getTargetObject(e.currentTarget);\n  if (element !== newElement) {\n    hide();\n    poisonedElement = null;\n    element = newElement;\n  }\n  // Forget about any immediately preceding mouseOut event.\n  clearTimeout(mouseOutPid);\n}\n\n/**\n * Hide the tooltip if the mouse leaves the object and enters the workspace.\n *\n * @param _e Mouse event.\n */\nfunction onMouseOut(_e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // Moving from one element to another (overlapping or with no gap) generates\n  // a mouseOut followed instantly by a mouseOver.  Fork off the mouseOut\n  // event and kill it if a mouseOver is received immediately.\n  // This way the task only fully executes if mousing into the void.\n  mouseOutPid = setTimeout(function () {\n    element = null;\n    poisonedElement = null;\n    hide();\n  }, 1);\n  clearTimeout(showPid);\n  showPid = 0;\n}\n\n/**\n * When hovering over an element, schedule a tooltip to be shown.  If a tooltip\n * is already visible, hide it if the mouse strays out of a certain radius.\n *\n * @param e Mouse event.\n */\nfunction onMouseMove(e: Event) {\n  if (!element || !(element as AnyDuringMigration).tooltip) {\n    // No tooltip here to show.\n    return;\n  } else if (blocked) {\n    // Someone doesn't want us to show tooltips.  We are probably handling a\n    // user gesture, such as a click or drag.\n    return;\n  }\n  if (visible) {\n    // Compute the distance between the mouse position when the tooltip was\n    // shown and the current mouse position.  Pythagorean theorem.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    const dx = lastX - (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    const dy = lastY - (e as AnyDuringMigration).pageY;\n    if (Math.sqrt(dx * dx + dy * dy) > RADIUS_OK) {\n      hide();\n    }\n  } else if (poisonedElement !== element) {\n    // The mouse moved, clear any previously scheduled tooltip.\n    clearTimeout(showPid);\n    // Maybe this time the mouse will stay put.  Schedule showing of tooltip.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    lastX = (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    lastY = (e as AnyDuringMigration).pageY;\n    showPid = setTimeout(show, HOVER_MS);\n  }\n}\n\n/**\n * Dispose of the tooltip.\n *\n * @internal\n */\nexport function dispose() {\n  element = null;\n  poisonedElement = null;\n  hide();\n}\n\n/**\n * Hide the tooltip.\n */\nexport function hide() {\n  if (visible) {\n    visible = false;\n    if (containerDiv) {\n      containerDiv.style.display = 'none';\n    }\n  }\n  if (showPid) {\n    clearTimeout(showPid);\n    showPid = 0;\n  }\n}\n\n/**\n * Hide any in-progress tooltips and block showing new tooltips until the next\n * call to unblock().\n *\n * @internal\n */\nexport function block() {\n  hide();\n  blocked = true;\n}\n\n/**\n * Unblock tooltips: allow them to be scheduled and shown according to their own\n * logic.\n *\n * @internal\n */\nexport function unblock() {\n  blocked = false;\n}\n\n/** Renders the tooltip content into the tooltip div. */\nfunction renderContent() {\n  if (!containerDiv || !element) {\n    // This shouldn't happen, but if it does, we can't render.\n    return;\n  }\n  if (typeof customTooltip === 'function') {\n    customTooltip(containerDiv, element);\n  } else {\n    renderDefaultContent();\n  }\n}\n\n/** Renders the default tooltip UI. */\nfunction renderDefaultContent() {\n  let tip = getTooltipOfObject(element);\n  tip = blocklyString.wrap(tip, LIMIT);\n  // Create new text, line by line.\n  const lines = tip.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    const div = document.createElement('div');\n    div.appendChild(document.createTextNode(lines[i]));\n    containerDiv!.appendChild(div);\n  }\n}\n\n/**\n * Gets the coordinates for the tooltip div, taking into account the edges of\n * the screen to prevent showing the tooltip offscreen.\n *\n * @param rtl True if the tooltip should be in right-to-left layout.\n * @returns Coordinates at which the tooltip div should be placed.\n */\nfunction getPosition(rtl: boolean): {x: number; y: number} {\n  // Position the tooltip just below the cursor.\n  const windowWidth = document.documentElement.clientWidth;\n  const windowHeight = document.documentElement.clientHeight;\n\n  let anchorX = lastX;\n  if (rtl) {\n    anchorX -= OFFSET_X + containerDiv!.offsetWidth;\n  } else {\n    anchorX += OFFSET_X;\n  }\n\n  let anchorY = lastY + OFFSET_Y;\n  if (anchorY + containerDiv!.offsetHeight > windowHeight + window.scrollY) {\n    // Falling off the bottom of the screen; shift the tooltip up.\n    anchorY -= containerDiv!.offsetHeight + 2 * OFFSET_Y;\n  }\n\n  if (rtl) {\n    // Prevent falling off left edge in RTL mode.\n    anchorX = Math.max(MARGINS - window.scrollX, anchorX);\n  } else {\n    if (\n      anchorX + containerDiv!.offsetWidth >\n      windowWidth + window.scrollX - 2 * MARGINS\n    ) {\n      // Falling off the right edge of the screen;\n      // clamp the tooltip on the edge.\n      anchorX = windowWidth - containerDiv!.offsetWidth - 2 * MARGINS;\n    }\n  }\n\n  return {x: anchorX, y: anchorY};\n}\n\n/** Create the tooltip and show it. */\nfunction show() {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  poisonedElement = element;\n  if (!containerDiv) {\n    return;\n  }\n  // Erase all existing text.\n  containerDiv.textContent = '';\n\n  // Add new content.\n  renderContent();\n\n  // Display the tooltip.\n  const rtl = (element as any).RTL;\n  containerDiv.style.direction = rtl ? 'rtl' : 'ltr';\n  containerDiv.style.display = 'block';\n  visible = true;\n\n  const {x, y} = getPosition(rtl);\n  containerDiv.style.left = x + 'px';\n  containerDiv.style.top = y + 'px';\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.colour\n\n/**\n * The richness of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvSaturation = 0.45;\n\n/**\n * Get the richness of block colours, regardless of the hue.\n *\n * @returns The current richness.\n * @internal\n */\nexport function getHsvSaturation(): number {\n  return hsvSaturation;\n}\n\n/**\n * Set the richness of block colours, regardless of the hue.\n *\n * @param newSaturation The new richness, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvSaturation(newSaturation: number) {\n  hsvSaturation = newSaturation;\n}\n\n/**\n * The intensity of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvValue = 0.65;\n\n/**\n * Get the intensity of block colours, regardless of the hue.\n *\n * @returns The current intensity.\n * @internal\n */\nexport function getHsvValue(): number {\n  return hsvValue;\n}\n\n/**\n * Set the intensity of block colours, regardless of the hue.\n *\n * @param newValue The new intensity, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvValue(newValue: number) {\n  hsvValue = newValue;\n}\n\n/**\n * Parses a colour from a string.\n * .parse('red') = '#ff0000'\n * .parse('#f00') = '#ff0000'\n * .parse('#ff0000') = '#ff0000'\n * .parse('0xff0000') = '#ff0000'\n * .parse('rgb(255, 0, 0)') = '#ff0000'\n *\n * @param str Colour in some CSS format.\n * @returns A string containing a hex representation of the colour, or null if\n *     can't be parsed.\n */\nexport function parse(str: string | number): string | null {\n  str = `${str}`.toLowerCase().trim();\n  let hex = names[str];\n  if (hex) {\n    // e.g. 'red'\n    return hex;\n  }\n  hex = str.substring(0, 2) === '0x' ? '#' + str.substring(2) : str;\n  hex = hex[0] === '#' ? hex : '#' + hex;\n  if (/^#[0-9a-f]{6}$/.test(hex)) {\n    // e.g. '#00ff88'\n    return hex;\n  }\n  if (/^#[0-9a-f]{3}$/.test(hex)) {\n    // e.g. '#0f8'\n    return ['#', hex[1], hex[1], hex[2], hex[2], hex[3], hex[3]].join('');\n  }\n  const rgb = str.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n  if (rgb) {\n    // e.g. 'rgb(0, 128, 255)'\n    const r = Number(rgb[1]);\n    const g = Number(rgb[2]);\n    const b = Number(rgb[3]);\n    if (r >= 0 && r < 256 && g >= 0 && g < 256 && b >= 0 && b < 256) {\n      return rgbToHex(r, g, b);\n    }\n  }\n  return null;\n}\n\n/**\n * Converts a colour from RGB to hex representation.\n *\n * @param r Amount of red, int between 0 and 255.\n * @param g Amount of green, int between 0 and 255.\n * @param b Amount of blue, int between 0 and 255.\n * @returns Hex representation of the colour.\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  const rgb = (r << 16) | (g << 8) | b;\n  if (r < 0x10) {\n    return '#' + (0x1000000 | rgb).toString(16).substr(1);\n  }\n  return '#' + rgb.toString(16);\n}\n\n/**\n * Converts a colour to RGB.\n *\n * @param colour String representing colour in any colour format ('#ff0000',\n *     'red', '0xff000', etc).\n * @returns RGB representation of the colour.\n */\nexport function hexToRgb(colour: string): number[] {\n  const hex = parse(colour);\n  if (!hex) {\n    return [0, 0, 0];\n  }\n\n  const rgb = parseInt(hex.substr(1), 16);\n  const r = rgb >> 16;\n  const g = (rgb >> 8) & 255;\n  const b = rgb & 255;\n\n  return [r, g, b];\n}\n\n/**\n * Converts an HSV triplet to hex representation.\n *\n * @param h Hue value in [0, 360].\n * @param s Saturation value in [0, 1].\n * @param v Brightness in [0, 255].\n * @returns Hex representation of the colour.\n */\nexport function hsvToHex(h: number, s: number, v: number): string {\n  let red = 0;\n  let green = 0;\n  let blue = 0;\n  if (s === 0) {\n    red = v;\n    green = v;\n    blue = v;\n  } else {\n    const sextant = Math.floor(h / 60);\n    const remainder = h / 60 - sextant;\n    const val1 = v * (1 - s);\n    const val2 = v * (1 - s * remainder);\n    const val3 = v * (1 - s * (1 - remainder));\n    switch (sextant) {\n      case 1:\n        red = val2;\n        green = v;\n        blue = val1;\n        break;\n      case 2:\n        red = val1;\n        green = v;\n        blue = val3;\n        break;\n      case 3:\n        red = val1;\n        green = val2;\n        blue = v;\n        break;\n      case 4:\n        red = val3;\n        green = val1;\n        blue = v;\n        break;\n      case 5:\n        red = v;\n        green = val1;\n        blue = val2;\n        break;\n      case 6:\n      case 0:\n        red = v;\n        green = val3;\n        blue = val1;\n        break;\n    }\n  }\n  return rgbToHex(Math.floor(red), Math.floor(green), Math.floor(blue));\n}\n\n/**\n * Blend two colours together, using the specified factor to indicate the\n * weight given to the first colour.\n *\n * @param colour1 First colour.\n * @param colour2 Second colour.\n * @param factor The weight to be given to colour1 over colour2.\n *     Values should be in the range [0, 1].\n * @returns Combined colour represented in hex.\n */\nexport function blend(\n  colour1: string,\n  colour2: string,\n  factor: number,\n): string | null {\n  const hex1 = parse(colour1);\n  if (!hex1) {\n    return null;\n  }\n  const hex2 = parse(colour2);\n  if (!hex2) {\n    return null;\n  }\n  const rgb1 = hexToRgb(hex1);\n  const rgb2 = hexToRgb(hex2);\n  const r = Math.round(rgb2[0] + factor * (rgb1[0] - rgb2[0]));\n  const g = Math.round(rgb2[1] + factor * (rgb1[1] - rgb2[1]));\n  const b = Math.round(rgb2[2] + factor * (rgb1[2] - rgb2[2]));\n  return rgbToHex(r, g, b);\n}\n\n/**\n * A map that contains the 16 basic colour keywords as defined by W3C:\n * https://www.w3.org/TR/2018/REC-css-color-3-20180619/#html4\n * The keys of this map are the lowercase \"readable\" names of the colours,\n * while the values are the \"hex\" values.\n */\nexport const names: {[key: string]: string} = {\n  'aqua': '#00ffff',\n  'black': '#000000',\n  'blue': '#0000ff',\n  'fuchsia': '#ff00ff',\n  'gray': '#808080',\n  'green': '#008000',\n  'lime': '#00ff00',\n  'maroon': '#800000',\n  'navy': '#000080',\n  'olive': '#808000',\n  'purple': '#800080',\n  'red': '#ff0000',\n  'silver': '#c0c0c0',\n  'teal': '#008080',\n  'white': '#ffffff',\n  'yellow': '#ffff00',\n};\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n */\nexport function hueToHex(hue: number): string {\n  return hsvToHex(hue, hsvSaturation, hsvValue * 255);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.parsing\n\nimport {Msg} from '../msg.js';\n\nimport * as colourUtils from './colour.js';\n\n/**\n * Internal implementation of the message reference and interpolation token\n * parsing used by tokenizeInterpolation() and replaceMessageReferences().\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @param parseInterpolationTokens Option to parse numeric interpolation\n *     tokens (%1, %2, ...) when true.\n * @param tokenizeNewlines Split individual newline characters into separate\n *     tokens when true.\n * @returns Array of strings and numbers.\n */\nfunction tokenizeInterpolationInternal(\n  message: string,\n  parseInterpolationTokens: boolean,\n  tokenizeNewlines: boolean,\n): (string | number)[] {\n  const tokens = [];\n  const chars = message.split('');\n  chars.push(''); // End marker.\n  // Parse the message with a finite state machine.\n  // 0 - Base case.\n  // 1 - % found.\n  // 2 - Digit found.\n  // 3 - Message ref found.\n  let state = 0;\n  const buffer = new Array<string>();\n  let number = null;\n  for (let i = 0; i < chars.length; i++) {\n    const c = chars[i];\n    if (state === 0) {\n      // Start escape.\n      if (c === '%') {\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        state = 1;\n      } else if (tokenizeNewlines && c === '\\n') {\n        // Output newline characters as single-character tokens, to be replaced\n        // with endOfRow dummies during interpolation.\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        tokens.push(c);\n      } else {\n        buffer.push(c); // Regular char.\n      }\n    } else if (state === 1) {\n      if (c === '%') {\n        buffer.push(c); // Escaped %: %%\n        state = 0;\n      } else if (parseInterpolationTokens && '0' <= c && c <= '9') {\n        state = 2;\n        number = c;\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n      } else if (c === '{') {\n        state = 3;\n      } else {\n        buffer.push('%', c); // Not recognized. Return as literal.\n        state = 0;\n      }\n    } else if (state === 2) {\n      if ('0' <= c && c <= '9') {\n        number += c; // Multi-digit number.\n      } else {\n        tokens.push(parseInt(number ?? '', 10));\n        i--; // Parse this char again.\n        state = 0;\n      }\n    } else if (state === 3) {\n      // String table reference\n      if (c === '') {\n        // Premature end before closing '}'\n        buffer.splice(0, 0, '%{'); // Re-insert leading delimiter\n        i--; // Parse this char again.\n        state = 0; // and parse as string literal.\n      } else if (c !== '}') {\n        buffer.push(c);\n      } else {\n        const rawKey = buffer.join('');\n        if (/[A-Z]\\w*/i.test(rawKey)) {\n          // Strict matching\n          // Found a valid string key. Attempt case insensitive match.\n          const keyUpper = rawKey.toUpperCase();\n\n          // BKY_ is the prefix used to namespace the strings used in\n          // Blockly core files and the predefined blocks in ../blocks/.\n          // These strings are defined in ../msgs/ files.\n          const bklyKey = keyUpper.startsWith('BKY_')\n            ? keyUpper.substring(4)\n            : null;\n          if (bklyKey && bklyKey in Msg) {\n            const rawValue = Msg[bklyKey];\n            if (typeof rawValue === 'string') {\n              // Attempt to dereference substrings, too, appending to the\n              // end.\n              Array.prototype.push.apply(\n                tokens,\n                tokenizeInterpolationInternal(\n                  rawValue,\n                  parseInterpolationTokens,\n                  tokenizeNewlines,\n                ),\n              );\n            } else if (parseInterpolationTokens) {\n              // When parsing interpolation tokens, numbers are special\n              // placeholders (%1, %2, etc). Make sure all other values are\n              // strings.\n              tokens.push(`${rawValue}`);\n            } else {\n              tokens.push(rawValue);\n            }\n          } else {\n            // No entry found in the string table. Pass reference as string.\n            tokens.push('%{' + rawKey + '}');\n          }\n          buffer.length = 0; // Clear the array\n          state = 0;\n        } else {\n          tokens.push('%{' + rawKey + '}');\n          buffer.length = 0;\n          state = 0; // and parse as string literal.\n        }\n      }\n    }\n  }\n  let text = buffer.join('');\n  if (text) {\n    tokens.push(text);\n  }\n\n  // Merge adjacent text tokens into a single string (but if newlines should be\n  // tokenized, don't merge those with adjacent text).\n  const mergedTokens = [];\n  buffer.length = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (\n      typeof tokens[i] === 'string' &&\n      !(tokenizeNewlines && tokens[i] === '\\n')\n    ) {\n      buffer.push(tokens[i] as string);\n    } else {\n      text = buffer.join('');\n      if (text) {\n        mergedTokens.push(text);\n      }\n      buffer.length = 0;\n      mergedTokens.push(tokens[i]);\n    }\n  }\n  text = buffer.join('');\n  if (text) {\n    mergedTokens.push(text);\n  }\n  buffer.length = 0;\n\n  return mergedTokens;\n}\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%'). Newline characters will also be output as string tokens\n * containing a single newline character.\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n */\nexport function tokenizeInterpolation(message: string): (string | number)[] {\n  return tokenizeInterpolationInternal(message, true, true);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains\n *     string table references.\n * @returns String with message references replaced.\n */\nexport function replaceMessageReferences(message: string | any): string {\n  if (typeof message !== 'string') {\n    return message;\n  }\n  const interpolatedResult = tokenizeInterpolationInternal(\n    message,\n    false,\n    false,\n  );\n  // When parseInterpolationTokens and tokenizeNewlines are false,\n  // interpolatedResult should be at most length 1.\n  return interpolatedResult.length ? String(interpolatedResult[0]) : '';\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n */\nexport function checkMessageReferences(message: string): boolean {\n  let validSoFar = true;\n\n  const msgTable = Msg;\n  // TODO (#1169): Implement support for other string tables,\n  // prefixes other than BKY_.\n  const m = message.match(/%{BKY_[A-Z]\\w*}/gi);\n  if (m) {\n    for (let i = 0; i < m.length; i++) {\n      const msgKey = m[i].toUpperCase();\n      if (msgTable[msgKey.slice(6, -1)] === undefined) {\n        console.warn('No message string for ' + m[i] + ' in ' + message);\n        validSoFar = false; // Continue to report other errors.\n      }\n    }\n  }\n\n  return validSoFar;\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string,\n *     or a message reference string pointing to one of those two values.\n * @returns An object containing the colour as\n *     a #RRGGBB string, and the hue if the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n */\nexport function parseBlockColour(colour: number | string): {\n  hue: number | null;\n  hex: string;\n} {\n  const dereferenced =\n    typeof colour === 'string' ? replaceMessageReferences(colour) : colour;\n\n  const hue = Number(dereferenced);\n  if (!isNaN(hue) && 0 <= hue && hue <= 360) {\n    return {\n      hue: hue,\n      hex: colourUtils.hsvToHex(\n        hue,\n        colourUtils.getHsvSaturation(),\n        colourUtils.getHsvValue() * 255,\n      ),\n    };\n  } else {\n    const hex = colourUtils.parse(dereferenced);\n    if (hex) {\n      // Only store hue if colour is set as a hue.\n      return {hue: null, hex: hex};\n    } else {\n      let errorMsg = 'Invalid colour: \"' + dereferenced + '\"';\n      if (colour !== dereferenced) {\n        errorMsg += ' (from \"' + colour + '\")';\n      }\n      throw Error(errorMsg);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.WidgetDiv\n\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport {Field} from './field.js';\nimport type {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** The object currently using this container. */\nlet owner: unknown = null;\n\n/** The workspace associated with the owner currently using this container. */\nlet ownerWorkspace: WorkspaceSvg | null = null;\n\n/** Optional cleanup function set by whichever object uses the widget. */\nlet dispose: (() => void) | null = null;\n\n/** A class name representing the current owner's workspace container. */\nconst containerClassName = 'blocklyWidgetDiv';\n\n/** A class name representing the current owner's workspace renderer. */\nlet rendererClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The HTML container for popup overlays (e.g. editor widgets). */\nlet containerDiv: HTMLDivElement | null;\n\n/**\n * Returns the HTML container for editor widgets.\n *\n * @returns The editor widget container.\n */\nexport function getDiv(): HTMLDivElement | null {\n  return containerDiv;\n}\n\n/**\n * Allows unit tests to reset the div. Do not use outside of tests.\n *\n * @param newDiv The new value for the DIV field.\n * @internal\n */\nexport function testOnly_setDiv(newDiv: HTMLDivElement | null) {\n  containerDiv = newDiv;\n  if (newDiv === null) {\n    document.querySelector('.' + containerClassName)?.remove();\n  }\n}\n\n/**\n * Create the widget div and inject it onto the page.\n */\nexport function createDom() {\n  const container = common.getParentContainer() || document.body;\n\n  if (document.querySelector('.' + containerClassName)) {\n    containerDiv = document.querySelector('.' + containerClassName);\n  } else {\n    containerDiv = document.createElement('div') as HTMLDivElement;\n    containerDiv.className = containerClassName;\n  }\n\n  container.appendChild(containerDiv!);\n}\n\n/**\n * Initialize and display the widget div.  Close the old one if needed.\n *\n * @param newOwner The object that will be using this container.\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param newDispose Optional cleanup function to be run when the widget is\n *     closed.\n * @param workspace The workspace associated with the widget owner.\n */\nexport function show(\n  newOwner: unknown,\n  rtl: boolean,\n  newDispose: () => void,\n  workspace?: WorkspaceSvg | null,\n) {\n  hide();\n  owner = newOwner;\n  dispose = newDispose;\n  const div = containerDiv;\n  if (!div) return;\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n  div.style.display = 'block';\n  if (!workspace && newOwner instanceof Field) {\n    // For backward compatibility with plugin fields that do not provide a\n    // workspace to this function, attempt to derive it from the field.\n    workspace = (newOwner as Field).getSourceBlock()?.workspace as WorkspaceSvg;\n  }\n  ownerWorkspace = workspace ?? null;\n  const rendererWorkspace =\n    workspace ?? (common.getMainWorkspace() as WorkspaceSvg);\n  rendererClassName = rendererWorkspace.getRenderer().getClassName();\n  themeClassName = rendererWorkspace.getTheme().getClassName();\n  if (rendererClassName) {\n    dom.addClass(div, rendererClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n}\n\n/**\n * Destroy the widget and hide the div.\n */\nexport function hide() {\n  if (!isVisible()) {\n    return;\n  }\n  owner = null;\n\n  const div = containerDiv;\n  if (!div) return;\n  div.style.display = 'none';\n  div.style.left = '';\n  div.style.top = '';\n  dispose && dispose();\n  dispose = null;\n  div.textContent = '';\n\n  if (rendererClassName) {\n    dom.removeClass(div, rendererClassName);\n    rendererClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by the specified\n * object.\n *\n * @param oldOwner The object that was using this container.\n */\nexport function hideIfOwner(oldOwner: unknown) {\n  if (owner === oldOwner) {\n    hide();\n  }\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by an object in the\n * specified workspace, or if it is used by an unknown workspace.\n *\n * @param oldOwnerWorkspace The workspace that was using this container.\n */\nexport function hideIfOwnerIsInWorkspace(oldOwnerWorkspace: WorkspaceSvg) {\n  if (ownerWorkspace === null || ownerWorkspace === oldOwnerWorkspace) {\n    hide();\n  }\n}\n\n/**\n * Set the widget div's position and height.  This function does nothing clever:\n * it will not ensure that your widget div ends up in the visible window.\n *\n * @param x Horizontal location (window coordinates, not body).\n * @param y Vertical location (window coordinates, not body).\n * @param height The height of the widget div (pixels).\n */\nfunction positionInternal(x: number, y: number, height: number) {\n  containerDiv!.style.left = x + 'px';\n  containerDiv!.style.top = y + 'px';\n  containerDiv!.style.height = height + 'px';\n}\n\n/**\n * Position the widget div based on an anchor rectangle.\n * The widget should be placed adjacent to but not overlapping the anchor\n * rectangle.  The preferred position is directly below and aligned to the left\n * (LTR) or right (RTL) side of the anchor.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The size of the widget that is inside the widget div, in\n *     window coordinates.\n * @param rtl Whether the workspace is in RTL mode.  This determines horizontal\n *     alignment.\n * @internal\n */\nexport function positionWithAnchor(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n  rtl: boolean,\n) {\n  const y = calculateY(viewportBBox, anchorBBox, widgetSize);\n  const x = calculateX(viewportBBox, anchorBBox, widgetSize, rtl);\n\n  if (y < 0) {\n    positionInternal(x, 0, widgetSize.height + y);\n  } else {\n    positionInternal(x, y, widgetSize.height);\n  }\n}\n\n/**\n * Calculate an x position (in window coordinates) such that the widget will not\n * be offscreen on the right or left.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @param rtl Whether the Blockly workspace is in RTL mode.\n * @returns A valid x-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateX(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n  rtl: boolean,\n): number {\n  if (rtl) {\n    // Try to align the right side of the field and the right side of widget.\n    const widgetLeft = anchorBBox.right - widgetSize.width;\n    // Don't go offscreen left.\n    const x = Math.max(widgetLeft, viewportBBox.left);\n    // But really don't go offscreen right:\n    return Math.min(x, viewportBBox.right - widgetSize.width);\n  } else {\n    // Try to align the left side of the field and the left side of widget.\n    // Don't go offscreen right.\n    const x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\n    // But left is more important, because that's where the text is.\n    return Math.max(x, viewportBBox.left);\n  }\n}\n\n/**\n * Calculate a y position (in window coordinates) such that the widget will not\n * be offscreen on the top or bottom.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @returns A valid y-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateY(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n): number {\n  // Flip the widget vertically if off the bottom.\n  // The widget could go off the top of the window, but it would also go off\n  // the bottom.  The window is just too small.\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\n    // The bottom of the widget is at the top of the field.\n    return anchorBBox.top - widgetSize.height;\n  } else {\n    // The top of the widget is at the bottom of the field.\n    return anchorBBox.bottom;\n  }\n}\n\n/**\n * Determine if the owner is a field for purposes of repositioning.\n * We can't simply check `instanceof Field` as that would introduce a circular\n * dependency.\n */\nfunction isRepositionable(item: any): item is Field {\n  return !!item?.repositionForWindowResize;\n}\n\n/**\n * Reposition the widget div if the owner of it says to.\n * If the owner isn't a field, just give up and hide it.\n */\nexport function repositionForWindowResize(): void {\n  if (!isRepositionable(owner) || !owner.repositionForWindowResize()) {\n    // If the owner is not a Field, or if the owner returns false from the\n    // reposition method, we should hide the widget div. Otherwise, we'll assume\n    // the owner handled any needed resize.\n    hide();\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ContextMenu\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {config} from './config.js';\nimport * as dom from './utils/dom.js';\nimport type {\n  ContextMenuOption,\n  LegacyContextMenuOption,\n} from './contextmenu_registry.js';\nimport * as eventUtils from './events/utils.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Rect} from './utils/rect.js';\nimport * as serializationBlocks from './serialization/blocks.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\nimport * as common from './common.js';\n\n/**\n * Which block is the context menu attached to?\n */\nlet currentBlock: Block | null = null;\n\nconst dummyOwner = {};\n\n/**\n * Gets the block the context menu is currently attached to.\n *\n * @returns The block the context menu is attached to.\n */\nexport function getCurrentBlock(): Block | null {\n  return currentBlock;\n}\n\n/**\n * Sets the block the context menu is currently attached to.\n *\n * @param block The block the context menu is attached to.\n */\nexport function setCurrentBlock(block: Block | null) {\n  currentBlock = block;\n}\n\n/**\n * Menu object.\n */\nlet menu_: Menu | null = null;\n\n/**\n * Construct the menu based on the list of options and show the menu.\n *\n * @param e Mouse event.\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @param workspace The workspace associated with the context menu, if any.\n */\nexport function show(\n  e: PointerEvent,\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\n  rtl: boolean,\n  workspace?: WorkspaceSvg,\n) {\n  WidgetDiv.show(dummyOwner, rtl, dispose, workspace);\n  if (!options.length) {\n    hide();\n    return;\n  }\n  const menu = populate_(options, rtl, e);\n  menu_ = menu;\n\n  position_(menu, e, rtl);\n  // 1ms delay is required for focusing on context menus because some other\n  // mouse event is still waiting in the queue and clears focus.\n  setTimeout(function () {\n    menu.focus();\n  }, 1);\n  currentBlock = null; // May be set by Blockly.Block.\n}\n\n/**\n * Create the context menu object and populate it with the given options.\n *\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @param e The event that triggered the context menu to open.\n * @returns The menu that will be shown on right click.\n */\nfunction populate_(\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\n  rtl: boolean,\n  e: PointerEvent,\n): Menu {\n  /* Here's what one option object looks like:\n      {text: 'Make It So',\n       enabled: true,\n       callback: Blockly.MakeItSo}\n    */\n  const menu = new Menu();\n  menu.setRole(aria.Role.MENU);\n  for (let i = 0; i < options.length; i++) {\n    const option = options[i];\n    const menuItem = new MenuItem(option.text);\n    menuItem.setRightToLeft(rtl);\n    menuItem.setRole(aria.Role.MENUITEM);\n    menu.addChild(menuItem);\n    menuItem.setEnabled(option.enabled);\n    if (option.enabled) {\n      const actionHandler = function () {\n        hide();\n        requestAnimationFrame(() => {\n          setTimeout(() => {\n            // If .scope does not exist on the option, then the callback\n            // will not be expecting a scope parameter, so there should be\n            // no problems. Just assume it is a ContextMenuOption and we'll\n            // pass undefined if it's not.\n            option.callback((option as ContextMenuOption).scope, e);\n          }, 0);\n        });\n      };\n      menuItem.onAction(actionHandler, {});\n    }\n  }\n  return menu;\n}\n\n/**\n * Add the menu to the page and position it correctly.\n *\n * @param menu The menu to add and position.\n * @param e Mouse event for the right click that is making the context\n *     menu appear.\n * @param rtl True if RTL, false if LTR.\n */\nfunction position_(menu: Menu, e: Event, rtl: boolean) {\n  // Record windowSize and scrollOffset before adding menu.\n  const viewportBBox = svgMath.getViewportBBox();\n  const mouseEvent = e as MouseEvent;\n  // This one is just a point, but we'll pretend that it's a rect so we can use\n  // some helper functions.\n  const anchorBBox = new Rect(\n    mouseEvent.clientY + viewportBBox.top,\n    mouseEvent.clientY + viewportBBox.top,\n    mouseEvent.clientX + viewportBBox.left,\n    mouseEvent.clientX + viewportBBox.left,\n  );\n\n  createWidget_(menu);\n  const menuSize = menu.getSize();\n\n  if (rtl) {\n    anchorBBox.left += menuSize.width;\n    anchorBBox.right += menuSize.width;\n    viewportBBox.left += menuSize.width;\n    viewportBBox.right += menuSize.width;\n  }\n\n  WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\n  // Calling menuDom.focus() has to wait until after the menu has been placed\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\n  // in view.  See issue #1329.\n  menu.focus();\n}\n\n/**\n * Create and render the menu widget inside Blockly's widget div.\n *\n * @param menu The menu to add to the widget div.\n */\nfunction createWidget_(menu: Menu) {\n  const div = WidgetDiv.getDiv();\n  if (!div) {\n    throw Error('Attempting to create a context menu when widget div is null');\n  }\n  const menuDom = menu.render(div);\n  dom.addClass(menuDom, 'blocklyContextMenu');\n  // Prevent system context menu when right-clicking a Blockly context menu.\n  browserEvents.conditionalBind(\n    menuDom as EventTarget,\n    'contextmenu',\n    null,\n    haltPropagation,\n  );\n  // Focus only after the initial render to avoid issue #1329.\n  menu.focus();\n}\n/**\n * Halts the propagation of the event without doing anything else.\n *\n * @param e An event.\n */\nfunction haltPropagation(e: Event) {\n  // This event has been handled.  No need to bubble up to the document.\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/**\n * Hide the context menu.\n */\nexport function hide() {\n  WidgetDiv.hideIfOwner(dummyOwner);\n  currentBlock = null;\n}\n\n/**\n * Dispose of the menu.\n */\nexport function dispose() {\n  if (menu_) {\n    menu_.dispose();\n    menu_ = null;\n  }\n}\n\n/**\n * Create a callback function that creates and configures a block,\n *   then places the new block next to the original and returns it.\n *\n * @param block Original block.\n * @param state XML or JSON object representation of the new block.\n * @returns Function that creates a block.\n */\nexport function callbackFactory(\n  block: Block,\n  state: Element | serializationBlocks.State,\n): () => BlockSvg {\n  return () => {\n    eventUtils.disable();\n    let newBlock: BlockSvg;\n    try {\n      if (state instanceof Element) {\n        newBlock = Xml.domToBlockInternal(state, block.workspace!) as BlockSvg;\n      } else {\n        newBlock = serializationBlocks.appendInternal(\n          state,\n          block.workspace,\n        ) as BlockSvg;\n      }\n      // Move the new block next to the old block.\n      const xy = block.getRelativeToSurfaceXY();\n      if (block.RTL) {\n        xy.x -= config.snapRadius;\n      } else {\n        xy.x += config.snapRadius;\n      }\n      xy.y += config.snapRadius * 2;\n      newBlock.moveBy(xy.x, xy.y);\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !newBlock.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    common.setSelected(newBlock);\n    return newBlock;\n  };\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Xml\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {Connection} from './connection.js';\nimport {MANUALLY_DISABLED} from './constants.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {IconType} from './icons/icon_types.js';\nimport {inputTypes} from './inputs/input_types.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport * as utilsXml from './utils/xml.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as renderManagement from './render_management.js';\nimport {WorkspaceComment} from './comments/workspace_comment.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n/**\n * Encode a block tree as XML.\n *\n * @param workspace The workspace containing blocks.\n * @param skipId True if the encoder should skip the block IDs. False by\n *     default.\n * @returns XML DOM element.\n */\nexport function workspaceToDom(workspace: Workspace, skipId = false): Element {\n  const treeXml = utilsXml.createElement('xml');\n  const variablesElement = variablesToDom(\n    Variables.allUsedVarModels(workspace),\n  );\n  if (variablesElement.hasChildNodes()) {\n    treeXml.appendChild(variablesElement);\n  }\n  for (const comment of workspace.getTopComments()) {\n    treeXml.appendChild(\n      saveWorkspaceComment(comment as AnyDuringMigration, skipId),\n    );\n  }\n  const blocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    treeXml.appendChild(blockToDomWithXY(block, skipId));\n  }\n  return treeXml;\n}\n\n/** Serializes the given workspace comment to XML. */\nexport function saveWorkspaceComment(\n  comment: WorkspaceComment,\n  skipId = false,\n): Element {\n  const elem = utilsXml.createElement('comment');\n  if (!skipId) elem.setAttribute('id', comment.id);\n\n  const workspace = comment.workspace;\n  const loc = comment.getRelativeToSurfaceXY();\n  loc.x = workspace.RTL ? workspace.getWidth() - loc.x : loc.x;\n  elem.setAttribute('x', `${loc.x}`);\n  elem.setAttribute('y', `${loc.y}`);\n  elem.setAttribute('w', `${comment.getSize().width}`);\n  elem.setAttribute('h', `${comment.getSize().height}`);\n\n  if (comment.getText()) elem.textContent = comment.getText();\n  if (comment.isCollapsed()) elem.setAttribute('collapsed', 'true');\n  if (!comment.isOwnEditable()) elem.setAttribute('editable', 'false');\n  if (!comment.isOwnMovable()) elem.setAttribute('movable', 'false');\n  if (!comment.isOwnDeletable()) elem.setAttribute('deletable', 'false');\n\n  return elem;\n}\n\n/**\n * Encode a list of variables as XML.\n *\n * @param variableList List of all variable models.\n * @returns Tree of XML elements.\n */\nexport function variablesToDom(variableList: VariableModel[]): Element {\n  const variables = utilsXml.createElement('variables');\n  for (let i = 0; i < variableList.length; i++) {\n    const variable = variableList[i];\n    const element = utilsXml.createElement('variable');\n    element.appendChild(utilsXml.createTextNode(variable.name));\n    if (variable.type) {\n      element.setAttribute('type', variable.type);\n    }\n    element.id = variable.getId();\n    variables.appendChild(element);\n  }\n  return variables;\n}\n\n/**\n * Encode a block subtree as XML with XY coordinates.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDomWithXY(\n  block: Block,\n  opt_noId?: boolean,\n): Element | DocumentFragment {\n  if (block.isInsertionMarker()) {\n    // Skip over insertion markers.\n    block = block.getChildren(false)[0];\n    if (!block) {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  let width = 0; // Not used in LTR.\n  if (block.workspace.RTL) {\n    width = block.workspace.getWidth();\n  }\n\n  const element = blockToDom(block, opt_noId);\n  if (isElement(element)) {\n    const xy = block.getRelativeToSurfaceXY();\n    element.setAttribute(\n      'x',\n      String(Math.round(block.workspace.RTL ? width - xy.x : xy.x)),\n    );\n    element.setAttribute('y', String(Math.round(xy.y)));\n  }\n  return element;\n}\n\n/**\n * Encode a field as XML.\n *\n * @param field The field to encode.\n * @returns XML element, or null if the field did not need to be serialized.\n */\nfunction fieldToDom(field: Field): Element | null {\n  if (field.isSerializable()) {\n    const container = utilsXml.createElement('field');\n    container.setAttribute('name', field.name || '');\n    return field.toXml(container);\n  }\n  return null;\n}\n\n/**\n * Encode all of a block's fields as XML and attach them to the given tree of\n * XML elements.\n *\n * @param block A block with fields to be encoded.\n * @param element The XML element to which the field DOM should be attached.\n */\nfunction allFieldsToDom(block: Block, element: Element) {\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      const fieldDom = fieldToDom(field);\n      if (fieldDom) {\n        element.appendChild(fieldDom);\n      }\n    }\n  }\n}\n\n/**\n * Encode a block subtree as XML.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDom(\n  block: Block,\n  opt_noId?: boolean,\n): Element | DocumentFragment {\n  // Skip over insertion markers.\n  if (block.isInsertionMarker()) {\n    const child = block.getChildren(false)[0];\n    if (child) {\n      return blockToDom(child);\n    } else {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  const element = utilsXml.createElement(block.isShadow() ? 'shadow' : 'block');\n  element.setAttribute('type', block.type);\n  if (!opt_noId) {\n    element.id = block.id;\n  }\n  if (block.mutationToDom) {\n    // Custom data for an advanced block.\n    const mutation = block.mutationToDom();\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\n      element.appendChild(mutation);\n    }\n  }\n\n  allFieldsToDom(block, element);\n\n  const commentText = block.getCommentText();\n  if (commentText) {\n    const comment = block.getIcon(IconType.COMMENT)!;\n    const size = comment.getBubbleSize();\n    const pinned = comment.bubbleIsVisible();\n\n    const commentElement = utilsXml.createElement('comment');\n    commentElement.appendChild(utilsXml.createTextNode(commentText));\n    commentElement.setAttribute('pinned', `${pinned}`);\n    commentElement.setAttribute('h', String(size.height));\n    commentElement.setAttribute('w', String(size.width));\n\n    element.appendChild(commentElement);\n  }\n\n  if (block.data) {\n    const dataElement = utilsXml.createElement('data');\n    dataElement.appendChild(utilsXml.createTextNode(block.data));\n    element.appendChild(dataElement);\n  }\n\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    let container: Element;\n    let empty = true;\n    if (input.type === inputTypes.DUMMY || input.type === inputTypes.END_ROW) {\n      continue;\n    } else {\n      const childBlock = input.connection!.targetBlock();\n      if (input.type === inputTypes.VALUE) {\n        container = utilsXml.createElement('value');\n      } else if (input.type === inputTypes.STATEMENT) {\n        container = utilsXml.createElement('statement');\n      }\n      const childShadow = input.connection!.getShadowDom();\n      if (childShadow && (!childBlock || !childBlock.isShadow())) {\n        container!.appendChild(cloneShadow(childShadow, opt_noId));\n      }\n      if (childBlock) {\n        const childElem = blockToDom(childBlock, opt_noId);\n        if (childElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n          container!.appendChild(childElem);\n          empty = false;\n        }\n      }\n    }\n    container!.setAttribute('name', input.name);\n    if (!empty) {\n      element.appendChild(container!);\n    }\n  }\n  if (\n    block.inputsInline !== undefined &&\n    block.inputsInline !== block.inputsInlineDefault\n  ) {\n    element.setAttribute('inline', String(block.inputsInline));\n  }\n  if (block.isCollapsed()) {\n    element.setAttribute('collapsed', 'true');\n  }\n  if (!block.isEnabled()) {\n    // Set the value of the attribute to a comma-separated list of reasons.\n    // Use encodeURIComponent to escape commas in the reasons so that they\n    // won't be confused with separator commas.\n    element.setAttribute(\n      'disabled-reasons',\n      Array.from(block.getDisabledReasons()).map(encodeURIComponent).join(','),\n    );\n  }\n  if (!block.isOwnDeletable()) {\n    element.setAttribute('deletable', 'false');\n  }\n  if (!block.isOwnMovable()) {\n    element.setAttribute('movable', 'false');\n  }\n  if (!block.isOwnEditable()) {\n    element.setAttribute('editable', 'false');\n  }\n\n  const nextBlock = block.getNextBlock();\n  let container: Element;\n  if (nextBlock) {\n    const nextElem = blockToDom(nextBlock, opt_noId);\n    if (nextElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n      container = utilsXml.createElement('next');\n      container.appendChild(nextElem);\n      element.appendChild(container);\n    }\n  }\n  const nextShadow =\n    block.nextConnection && block.nextConnection.getShadowDom();\n  if (nextShadow && (!nextBlock || !nextBlock.isShadow())) {\n    container!.appendChild(cloneShadow(nextShadow, opt_noId));\n  }\n\n  return element;\n}\n\n/**\n * Deeply clone the shadow's DOM so that changes don't back-wash to the block.\n *\n * @param shadow A tree of XML elements.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns A tree of XML elements.\n */\nfunction cloneShadow(shadow: Element, opt_noId?: boolean): Element {\n  shadow = shadow.cloneNode(true) as Element;\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\n  let node: Node | null = shadow;\n  let textNode;\n  while (node) {\n    if (opt_noId && node.nodeName === 'shadow') {\n      // Strip off IDs from shadow blocks.  There should never be a 'block' as\n      // a child of a 'shadow', so no need to check that.\n      (node as Element).removeAttribute('id');\n    }\n    if (node.firstChild) {\n      node = node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        textNode = node;\n        node = node.parentNode;\n        if (\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\n          (textNode as Text).data.trim() === '' &&\n          node?.firstChild !== textNode\n        ) {\n          // Prune whitespace after a tag.\n          dom.removeNode(textNode);\n        }\n      }\n      if (node) {\n        textNode = node;\n        node = node.nextSibling;\n        if (\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\n          (textNode as Text).data.trim() === ''\n        ) {\n          // Prune whitespace before a tag.\n          dom.removeNode(textNode);\n        }\n      }\n    }\n  }\n  return shadow;\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace,\n * unless the DOM itself has whitespace built-in.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  const text = utilsXml.domToText(dom);\n  // Unpack self-closing tags.  These tags fail when embedded in HTML.\n  // <block name=\"foo\"/> -> <block name=\"foo\"></block>\n  return text.replace(/<(\\w+)([^<]*)\\/>/g, '<$1$2></$1>');\n}\n\n/**\n * Converts a DOM structure into properly indented text.\n *\n * @param dom A tree of XML elements.\n * @returns Text representation.\n */\nexport function domToPrettyText(dom: Node): string {\n  // This function is not guaranteed to be correct for all XML.\n  // But it handles the XML that Blockly generates.\n  const blob = domToText(dom);\n  // Place every open and close tag on its own line.\n  const lines = blob.split('<');\n  // Indent every line.\n  let indent = '';\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    if (line[0] === '/') {\n      indent = indent.substring(2);\n    }\n    lines[i] = indent + '<' + line;\n    if (line[0] !== '/' && line.slice(-2) !== '/>') {\n      indent += '  ';\n    }\n  }\n  // Pull simple tags back together.\n  // E.g. <foo></foo>\n  let text = lines.join('\\n');\n  text = text.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g, '$1</$2>');\n  // Trim leading blank line.\n  return text.replace(/^\\n/, '');\n}\n\n/**\n * Clear the given workspace then decode an XML DOM and\n * create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function clearWorkspaceAndLoadFromXml(\n  xml: Element,\n  workspace: WorkspaceSvg,\n): string[] {\n  workspace.setResizesEnabled(false);\n  workspace.clear();\n  const blockIds = domToWorkspace(xml, workspace);\n  workspace.setResizesEnabled(true);\n  return blockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function domToWorkspace(xml: Element, workspace: Workspace): string[] {\n  let width = 0; // Not used in LTR.\n  if (workspace.RTL) {\n    width = workspace.getWidth();\n  }\n  const newBlockIds = []; // A list of block IDs added by this call.\n  dom.startTextWidthCache();\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  // Disable workspace resizes as an optimization.\n  // Assume it is rendered so we can check.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(false);\n  }\n  let variablesFirst = true;\n  try {\n    for (let i = 0, xmlChild; (xmlChild = xml.childNodes[i]); i++) {\n      const name = xmlChild.nodeName.toLowerCase();\n      const xmlChildElement = xmlChild as Element;\n      if (\n        name === 'block' ||\n        (name === 'shadow' && !eventUtils.getRecordUndo())\n      ) {\n        // Allow top-level shadow blocks if recordUndo is disabled since\n        // that means an undo is in progress.  Such a block is expected\n        // to be moved to a nested destination in the next operation.\n        const block = domToBlockInternal(xmlChildElement, workspace);\n        newBlockIds.push(block.id);\n        const blockX = parseInt(xmlChildElement.getAttribute('x') ?? '10', 10);\n        const blockY = parseInt(xmlChildElement.getAttribute('y') ?? '10', 10);\n        if (!isNaN(blockX) && !isNaN(blockY)) {\n          block.moveBy(workspace.RTL ? width - blockX : blockX, blockY, [\n            'create',\n          ]);\n        }\n        variablesFirst = false;\n      } else if (name === 'shadow') {\n        throw TypeError('Shadow block cannot be a top-level block.');\n      } else if (name === 'comment') {\n        loadWorkspaceComment(xmlChildElement, workspace);\n      } else if (name === 'variables') {\n        if (variablesFirst) {\n          domToVariables(xmlChildElement, workspace);\n        } else {\n          throw Error(\n            \"'variables' tag must exist once before block and \" +\n              'shadow tag elements in the workspace XML, but it was found in ' +\n              'another location.',\n          );\n        }\n        variablesFirst = false;\n      }\n    }\n  } finally {\n    eventUtils.setGroup(existingGroup);\n    if ((workspace as WorkspaceSvg).setResizesEnabled) {\n      (workspace as WorkspaceSvg).setResizesEnabled(true);\n    }\n    if (workspace.rendered) renderManagement.triggerQueuedRenders();\n    dom.stopTextWidthCache();\n  }\n  // Re-enable workspace resizing.\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n  return newBlockIds;\n}\n\n/** Deserializes the given comment state into the given workspace. */\nexport function loadWorkspaceComment(\n  elem: Element,\n  workspace: Workspace,\n): WorkspaceComment {\n  const id = elem.getAttribute('id') ?? undefined;\n  const comment = workspace.rendered\n    ? new RenderedWorkspaceComment(workspace as WorkspaceSvg, id)\n    : new WorkspaceComment(workspace, id);\n\n  comment.setText(elem.textContent ?? '');\n\n  let x = parseInt(elem.getAttribute('x') ?? '', 10);\n  const y = parseInt(elem.getAttribute('y') ?? '', 10);\n  if (!isNaN(x) && !isNaN(y)) {\n    x = workspace.RTL ? workspace.getWidth() - x : x;\n    comment.moveTo(new Coordinate(x, y));\n  }\n\n  const w = parseInt(elem.getAttribute('w') ?? '', 10);\n  const h = parseInt(elem.getAttribute('h') ?? '', 10);\n  if (!isNaN(w) && !isNaN(h)) comment.setSize(new Size(w, h));\n\n  if (elem.getAttribute('collapsed') === 'true') comment.setCollapsed(true);\n  if (elem.getAttribute('editable') === 'false') comment.setEditable(false);\n  if (elem.getAttribute('movable') === 'false') comment.setMovable(false);\n  if (elem.getAttribute('deletable') === 'false') comment.setDeletable(false);\n\n  return comment;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace. Position the new\n * blocks immediately below prior blocks, aligned by their starting edge.\n *\n * @param xml The XML DOM.\n * @param workspace The workspace to add to.\n * @returns An array containing new block IDs.\n */\nexport function appendDomToWorkspace(\n  xml: Element,\n  workspace: WorkspaceSvg,\n): string[] {\n  // First check if we have a WorkspaceSvg, otherwise the blocks have no shape\n  // and the position does not matter.\n  // Assume it is rendered so we can check.\n  if (!(workspace as WorkspaceSvg).getBlocksBoundingBox) {\n    return domToWorkspace(xml, workspace);\n  }\n\n  const bbox = (workspace as WorkspaceSvg).getBlocksBoundingBox();\n  // Load the new blocks into the workspace and get the IDs of the new blocks.\n  const newBlockIds = domToWorkspace(xml, workspace);\n  if (bbox && bbox.top !== bbox.bottom) {\n    // Check if any previous block.\n    let offsetY = 0; // Offset to add to y of the new block.\n    let offsetX = 0;\n    const farY = bbox.bottom; // Bottom position.\n    const topX = workspace.RTL ? bbox.right : bbox.left; // X of bounding box.\n    // Check position of the new blocks.\n    let newLeftX = Infinity; // X of top left corner.\n    let newRightX = -Infinity; // X of top right corner.\n    let newY = Infinity; // Y of top corner.\n    const ySeparation = 10;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const blockXY = workspace\n        .getBlockById(newBlockIds[i])!\n        .getRelativeToSurfaceXY();\n      if (blockXY.y < newY) {\n        newY = blockXY.y;\n      }\n      if (blockXY.x < newLeftX) {\n        // if we left align also on x\n        newLeftX = blockXY.x;\n      }\n      if (blockXY.x > newRightX) {\n        // if we right align also on x\n        newRightX = blockXY.x;\n      }\n    }\n    offsetY = farY - newY + ySeparation;\n    offsetX = workspace.RTL ? topX - newRightX : topX - newLeftX;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const block = workspace.getBlockById(newBlockIds[i]);\n      block!.moveBy(offsetX, offsetY, ['create']);\n    }\n  }\n  return newBlockIds;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n */\nexport function domToBlock(xmlBlock: Element, workspace: Workspace): Block {\n  const block = domToBlockInternal(xmlBlock, workspace);\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\n  return block;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * This is defined internally so that it doesn't trigger an immediate render,\n * which we do want to happen for external calls.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n * @internal\n */\nexport function domToBlockInternal(\n  xmlBlock: Element,\n  workspace: Workspace,\n): Block {\n  // Create top-level block.\n  eventUtils.disable();\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let topBlock;\n  try {\n    topBlock = domToBlockHeadless(xmlBlock, workspace);\n    // Generate list of all blocks.\n    if (workspace.rendered) {\n      const topBlockSvg = topBlock as BlockSvg;\n      const blocks = topBlock.getDescendants(false);\n      topBlockSvg.setConnectionTracking(false);\n      // Render each block.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).initSvg();\n      }\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).queueRender();\n      }\n      // Populating the connection database may be deferred until after the\n      // blocks have rendered.\n      setTimeout(function () {\n        if (!topBlockSvg.disposed) {\n          topBlockSvg.setConnectionTracking(true);\n        }\n      }, 1);\n      // Allow the scrollbars to resize and move based on the new contents.\n      // TODO(@picklesrus): #387. Remove when domToBlock avoids resizing.\n      (workspace as WorkspaceSvg).resizeContents();\n    } else {\n      const blocks = topBlock.getDescendants(false);\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].initModel();\n      }\n    }\n  } finally {\n    eventUtils.enable();\n  }\n  if (eventUtils.isEnabled()) {\n    const newVariables = Variables.getAddedVariables(\n      workspace,\n      variablesBeforeCreation,\n    );\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\n      );\n    }\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(eventUtils.CREATE))(topBlock));\n  }\n  return topBlock;\n}\n\n/**\n * Decode an XML list of variables and add the variables to the workspace.\n *\n * @param xmlVariables List of XML variable elements.\n * @param workspace The workspace to which the variable should be added.\n */\nexport function domToVariables(xmlVariables: Element, workspace: Workspace) {\n  for (let i = 0; i < xmlVariables.children.length; i++) {\n    const xmlChild = xmlVariables.children[i];\n    const type = xmlChild.getAttribute('type');\n    const id = xmlChild.getAttribute('id');\n    const name = xmlChild.textContent;\n\n    if (!name) return;\n    workspace.createVariable(name, type, id);\n  }\n}\n\n/** A mapping of nodeName to node for child nodes of xmlBlock. */\ninterface childNodeTagMap {\n  mutation: Element[];\n  comment: Element[];\n  data: Element[];\n  field: Element[];\n  input: Element[];\n  next: Element[];\n}\n\n/**\n * Creates a mapping of childNodes for each supported XML tag for the provided\n * xmlBlock. Logs a warning for any encountered unsupported tags.\n *\n * @param xmlBlock XML block element.\n * @returns The childNode map from nodeName to node.\n */\nfunction mapSupportedXmlTags(xmlBlock: Element): childNodeTagMap {\n  const childNodeMap = {\n    mutation: new Array<Element>(),\n    comment: new Array<Element>(),\n    data: new Array<Element>(),\n    field: new Array<Element>(),\n    input: new Array<Element>(),\n    next: new Array<Element>(),\n  };\n  for (let i = 0; i < xmlBlock.children.length; i++) {\n    const xmlChild = xmlBlock.children[i];\n    if (xmlChild.nodeType === dom.NodeType.TEXT_NODE) {\n      // Ignore any text at the <block> level.  It's all whitespace anyway.\n      continue;\n    }\n    switch (xmlChild.nodeName.toLowerCase()) {\n      case 'mutation':\n        childNodeMap.mutation.push(xmlChild);\n        break;\n      case 'comment':\n        childNodeMap.comment.push(xmlChild);\n        break;\n      case 'data':\n        childNodeMap.data.push(xmlChild);\n        break;\n      case 'title':\n      // Titles were renamed to field in December 2013.\n      // Fall through.\n      case 'field':\n        childNodeMap.field.push(xmlChild);\n        break;\n      case 'value':\n      case 'statement':\n        childNodeMap.input.push(xmlChild);\n        break;\n      case 'next':\n        childNodeMap.next.push(xmlChild);\n        break;\n      default:\n        // Unknown tag; ignore.  Same principle as HTML parsers.\n        console.warn('Ignoring unknown tag: ' + xmlChild.nodeName);\n    }\n  }\n  return childNodeMap;\n}\n\n/**\n * Applies mutation tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n * @returns True if mutation may have added some elements that need\n *     initialization (requiring initSvg call).\n */\nfunction applyMutationTagNodes(xmlChildren: Element[], block: Block): boolean {\n  let shouldCallInitSvg = false;\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    // Custom data for an advanced block.\n    if (block.domToMutation) {\n      block.domToMutation(xmlChild);\n      if ((block as BlockSvg).initSvg) {\n        // Mutation may have added some elements that need initializing.\n        shouldCallInitSvg = true;\n      }\n    }\n  }\n  return shouldCallInitSvg;\n}\n\n/**\n * Applies comment tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyCommentTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const text = xmlChild.textContent;\n    const pinned = xmlChild.getAttribute('pinned') === 'true';\n    const width = parseInt(xmlChild.getAttribute('w') ?? '50', 10);\n    const height = parseInt(xmlChild.getAttribute('h') ?? '50', 10);\n\n    block.setCommentText(text);\n    const comment = block.getIcon(IconType.COMMENT)!;\n    if (!isNaN(width) && !isNaN(height)) {\n      comment.setBubbleSize(new Size(width, height));\n    }\n    // Set the pinned state of the bubble.\n    comment.setBubbleVisible(pinned);\n    // Actually show the bubble after the block has been rendered.\n    setTimeout(() => comment.setBubbleVisible(pinned), 1);\n  }\n}\n\n/**\n * Applies data tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyDataTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    block.data = xmlChild.textContent;\n  }\n}\n\n/**\n * Applies field tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyFieldTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    if (!nodeName) {\n      console.warn(`Ignoring unnamed field in block ${block.type}`);\n      continue;\n    }\n    domToField(block, nodeName, xmlChild);\n  }\n}\n\n/**\n * Finds any enclosed blocks or shadows within this XML node.\n *\n * @param xmlNode The XML node to extract child block info from.\n * @returns Any found child block.\n */\nfunction findChildBlocks(xmlNode: Element): {\n  childBlockElement: Element | null;\n  childShadowElement: Element | null;\n} {\n  let childBlockElement: Element | null = null;\n  let childShadowElement: Element | null = null;\n  for (let i = 0; i < xmlNode.childNodes.length; i++) {\n    const xmlChild = xmlNode.childNodes[i];\n    if (isElement(xmlChild)) {\n      if (xmlChild.nodeName.toLowerCase() === 'block') {\n        childBlockElement = xmlChild;\n      } else if (xmlChild.nodeName.toLowerCase() === 'shadow') {\n        childShadowElement = xmlChild;\n      }\n    }\n  }\n  return {childBlockElement, childShadowElement};\n}\n/**\n * Applies input child nodes (value or statement) to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n * @param prototypeName The prototype name of the block.\n */\nfunction applyInputTagNodes(\n  xmlChildren: Element[],\n  workspace: Workspace,\n  block: Block,\n  prototypeName: string,\n) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    const input = nodeName ? block.getInput(nodeName) : null;\n    if (!input) {\n      console.warn(\n        'Ignoring non-existent input ' +\n          nodeName +\n          ' in block ' +\n          prototypeName,\n      );\n      break;\n    }\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!input.connection) {\n        throw TypeError('Input connection does not exist.');\n      }\n      domToBlockHeadless(\n        childBlockInfo.childBlockElement,\n        workspace,\n        input.connection,\n        false,\n      );\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement) {\n      input.connection?.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Applies next child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n */\nfunction applyNextTagNodes(\n  xmlChildren: Element[],\n  workspace: Workspace,\n  block: Block,\n) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!block.nextConnection) {\n        throw TypeError('Next statement does not exist.');\n      }\n      // If there is more than one XML 'next' tag.\n      if (block.nextConnection.isConnected()) {\n        throw TypeError('Next statement is already connected.');\n      }\n      // Create child block.\n      domToBlockHeadless(\n        childBlockInfo.childBlockElement,\n        workspace,\n        block.nextConnection,\n        true,\n      );\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement && block.nextConnection) {\n      block.nextConnection.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @param parentConnection The parent connection to connect this block to\n *     after instantiating.\n * @param connectedToParentNext Whether the provided parent connection is a next\n *     connection, rather than output or statement.\n * @returns The root block created.\n */\nfunction domToBlockHeadless(\n  xmlBlock: Element,\n  workspace: Workspace,\n  parentConnection?: Connection,\n  connectedToParentNext?: boolean,\n): Block {\n  let block = null;\n  const prototypeName = xmlBlock.getAttribute('type');\n  if (!prototypeName) {\n    throw TypeError('Block type unspecified: ' + xmlBlock.outerHTML);\n  }\n  const id = xmlBlock.getAttribute('id') ?? undefined;\n  block = workspace.newBlock(prototypeName, id);\n\n  // Preprocess childNodes so tags can be processed in a consistent order.\n  const xmlChildNameMap = mapSupportedXmlTags(xmlBlock);\n\n  const shouldCallInitSvg = applyMutationTagNodes(\n    xmlChildNameMap.mutation,\n    block,\n  );\n  applyCommentTagNodes(xmlChildNameMap.comment, block);\n  applyDataTagNodes(xmlChildNameMap.data, block);\n\n  // Connect parent after processing mutation and before setting fields.\n  if (parentConnection) {\n    if (connectedToParentNext) {\n      if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError('Next block does not have previous statement.');\n      }\n    } else {\n      if (block.outputConnection) {\n        parentConnection.connect(block.outputConnection);\n      } else if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError(\n          'Child block does not have output or previous statement.',\n        );\n      }\n    }\n  }\n\n  applyFieldTagNodes(xmlChildNameMap.field, block);\n  applyInputTagNodes(xmlChildNameMap.input, workspace, block, prototypeName);\n  applyNextTagNodes(xmlChildNameMap.next, workspace, block);\n\n  if (shouldCallInitSvg) {\n    // This shouldn't even be called here\n    // (ref: https://github.com/google/blockly/pull/4296#issuecomment-884226021\n    // But the XML serializer/deserializer is iceboxed so I'm not going to fix\n    // it.\n    (block as BlockSvg).initSvg();\n  }\n\n  const inline = xmlBlock.getAttribute('inline');\n  if (inline) {\n    block.setInputsInline(inline === 'true');\n  }\n  const disabled = xmlBlock.getAttribute('disabled');\n  if (disabled) {\n    // Before May 2024 we just used 'disabled', with no reasons.\n    // Contiune to support this syntax.\n    block.setDisabledReason(\n      disabled === 'true' || disabled === 'disabled',\n      MANUALLY_DISABLED,\n    );\n  }\n  const disabledReasons = xmlBlock.getAttribute('disabled-reasons');\n  if (disabledReasons !== null) {\n    for (const reason of disabledReasons.split(',')) {\n      // Use decodeURIComponent to restore characters that were encoded in the\n      // value, such as commas.\n      block.setDisabledReason(true, decodeURIComponent(reason));\n    }\n  }\n  const deletable = xmlBlock.getAttribute('deletable');\n  if (deletable) {\n    block.setDeletable(deletable === 'true');\n  }\n  const movable = xmlBlock.getAttribute('movable');\n  if (movable) {\n    block.setMovable(movable === 'true');\n  }\n  const editable = xmlBlock.getAttribute('editable');\n  if (editable) {\n    block.setEditable(editable === 'true');\n  }\n  const collapsed = xmlBlock.getAttribute('collapsed');\n  if (collapsed) {\n    block.setCollapsed(collapsed === 'true');\n  }\n  if (xmlBlock.nodeName.toLowerCase() === 'shadow') {\n    // Ensure all children are also shadows.\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      if (!child.isShadow()) {\n        throw TypeError('Shadow block not allowed non-shadow child.');\n      }\n    }\n\n    block.setShadow(true);\n  }\n  return block;\n}\n\n/**\n * Decode an XML field tag and set the value of that field on the given block.\n *\n * @param block The block that is currently being deserialized.\n * @param fieldName The name of the field on the block.\n * @param xml The field tag to decode.\n */\nfunction domToField(block: Block, fieldName: string, xml: Element) {\n  const field = block.getField(fieldName);\n  if (!field) {\n    console.warn(\n      'Ignoring non-existent field ' + fieldName + ' in block ' + block.type,\n    );\n    return;\n  }\n  field.fromXml(xml);\n}\n\n/**\n * Remove any 'next' block (statements in a stack).\n *\n * @param xmlBlock XML block element or an empty DocumentFragment if the block\n *     was an insertion marker.\n */\nexport function deleteNext(xmlBlock: Element | DocumentFragment) {\n  for (let i = 0; i < xmlBlock.childNodes.length; i++) {\n    const child = xmlBlock.childNodes[i];\n    if (child.nodeName.toLowerCase() === 'next') {\n      xmlBlock.removeChild(child);\n      break;\n    }\n  }\n}\n\nfunction isElement(node: Node): node is Element {\n  return node.nodeType === dom.NodeType.ELEMENT_NODE;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockAnimations\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n/** A bounding box for a cloned block. */\ninterface CloneRect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n/** PID of disconnect UI animation.  There can only be one at a time. */\nlet disconnectPid: ReturnType<typeof setTimeout> | null = null;\n\n/** The wobbling block.  There can only be one at a time. */\nlet wobblingBlock: BlockSvg | null = null;\n\n/**\n * Play some UI effects (sound, animation) when disposing of a block.\n *\n * @param block The block being disposed of.\n * @internal\n */\nexport function disposeUiEffect(block: BlockSvg) {\n  // Disposing is going to take so long the animation won't play anyway.\n  if (block.getDescendants(false).length > 100) return;\n\n  const workspace = block.workspace;\n  const svgGroup = block.getSvgRoot();\n  workspace.getAudioManager().play('delete');\n\n  const xy = block.getRelativeToSurfaceXY();\n  // Deeply clone the current block.\n  const clone: SVGGElement = svgGroup.cloneNode(true) as SVGGElement;\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\n  workspace.getLayerManager()?.appendToAnimationLayer({\n    getSvgRoot: () => {\n      return clone;\n    },\n  });\n  const cloneRect = {\n    'x': xy.x,\n    'y': xy.y,\n    'width': block.width,\n    'height': block.height,\n  };\n  disposeUiStep(clone, cloneRect, workspace.RTL, new Date());\n}\n/**\n * Animate a cloned block and eventually dispose of it.\n * This is a class method, not an instance method since the original block has\n * been destroyed and is no longer accessible.\n *\n * @param clone SVG element to animate and dispose of.\n * @param rect Starting rect of the clone.\n * @param rtl True if RTL, false if LTR.\n * @param start Date of animation's start.\n */\nfunction disposeUiStep(\n  clone: Element,\n  rect: CloneRect,\n  rtl: boolean,\n  start: Date,\n) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(clone);\n  } else {\n    const x = rect.x + (((rtl ? -1 : 1) * rect.width) / 2) * percent;\n    const y = rect.y + (rect.height / 2) * percent;\n    const scale = 1 - percent;\n    clone.setAttribute(\n      'transform',\n      'translate(' + x + ',' + y + ')' + ' scale(' + scale + ')',\n    );\n    setTimeout(disposeUiStep, 10, clone, rect, rtl, start);\n  }\n}\n\n/**\n * Play some UI effects (sound, ripple) after a connection has been established.\n *\n * @param block The block being connected.\n * @internal\n */\nexport function connectionUiEffect(block: BlockSvg) {\n  const workspace = block.workspace;\n  const scale = workspace.scale;\n  workspace.getAudioManager().play('click');\n  if (scale < 1) {\n    return; // Too small to care about visual effects.\n  }\n  // Determine the absolute coordinates of the inferior block.\n  const xy = workspace.getSvgXY(block.getSvgRoot());\n  // Offset the coordinates based on the two connection types, fix scale.\n  if (block.outputConnection) {\n    xy.x += (block.RTL ? 3 : -3) * scale;\n    xy.y += 13 * scale;\n  } else if (block.previousConnection) {\n    xy.x += (block.RTL ? -23 : 23) * scale;\n    xy.y += 3 * scale;\n  }\n  const ripple = dom.createSvgElement(\n    Svg.CIRCLE,\n    {\n      'cx': xy.x,\n      'cy': xy.y,\n      'r': 0,\n      'fill': 'none',\n      'stroke': '#888',\n      'stroke-width': 10,\n    },\n    workspace.getParentSvg(),\n  );\n\n  const scaleAnimation = dom.createSvgElement(\n    Svg.ANIMATE,\n    {\n      'id': 'animationCircle',\n      'begin': 'indefinite',\n      'attributeName': 'r',\n      'dur': '150ms',\n      'from': 0,\n      'to': 25 * scale,\n    },\n    ripple,\n  );\n  const opacityAnimation = dom.createSvgElement(\n    Svg.ANIMATE,\n    {\n      'id': 'animationOpacity',\n      'begin': 'indefinite',\n      'attributeName': 'opacity',\n      'dur': '150ms',\n      'from': 1,\n      'to': 0,\n    },\n    ripple,\n  );\n\n  scaleAnimation.beginElement();\n  opacityAnimation.beginElement();\n\n  setTimeout(() => void dom.removeNode(ripple), 150);\n}\n\n/**\n * Play some UI effects (sound, animation) when disconnecting a block.\n *\n * @param block The block being disconnected.\n * @internal\n */\nexport function disconnectUiEffect(block: BlockSvg) {\n  disconnectUiStop();\n  block.workspace.getAudioManager().play('disconnect');\n  if (block.workspace.scale < 1) {\n    return; // Too small to care about visual effects.\n  }\n  // Horizontal distance for bottom of block to wiggle.\n  const DISPLACEMENT = 10;\n  // Scale magnitude of skew to height of block.\n  const height = block.getHeightWidth().height;\n  let magnitude = (Math.atan(DISPLACEMENT / height) / Math.PI) * 180;\n  if (!block.RTL) {\n    magnitude *= -1;\n  }\n  // Start the animation.\n  wobblingBlock = block;\n  disconnectUiStep(block, magnitude, new Date());\n}\n\n/**\n * Animate a brief wiggle of a disconnected block.\n *\n * @param block Block to animate.\n * @param magnitude Maximum degrees skew (reversed for RTL).\n * @param start Date of animation's start.\n */\nfunction disconnectUiStep(block: BlockSvg, magnitude: number, start: Date) {\n  const DURATION = 200; // Milliseconds.\n  const WIGGLES = 3; // Half oscillations.\n\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / DURATION;\n\n  let skew = '';\n  if (percent <= 1) {\n    const val = Math.round(\n      Math.sin(percent * Math.PI * WIGGLES) * (1 - percent) * magnitude,\n    );\n    skew = `skewX(${val})`;\n    disconnectPid = setTimeout(disconnectUiStep, 10, block, magnitude, start);\n  }\n\n  block\n    .getSvgRoot()\n    .setAttribute('transform', `${block.getTranslation()} ${skew}`);\n}\n\n/**\n * Stop the disconnect UI animation immediately.\n *\n * @internal\n */\nexport function disconnectUiStop() {\n  if (!wobblingBlock) return;\n  if (disconnectPid) {\n    clearTimeout(disconnectPid);\n    disconnectPid = null;\n  }\n  wobblingBlock\n    .getSvgRoot()\n    .setAttribute('transform', wobblingBlock.getTranslation());\n  wobblingBlock = null;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate';\n\n/**\n * Represents an object that can be dragged.\n */\nexport interface IDraggable extends IDragStrategy {\n  /**\n   * Returns the current location of the draggable in workspace\n   * coordinates.\n   *\n   * @returns Coordinate of current location on workspace.\n   */\n  getRelativeToSurfaceXY(): Coordinate;\n}\n\nexport interface IDragStrategy {\n  /** Returns true iff the element is currently movable. */\n  isMovable(): boolean;\n\n  /**\n   * Handles any drag startup (e.g moving elements to the front of the\n   * workspace).\n   *\n   * @param e PointerEvent that started the drag; can be used to\n   *     check modifier keys, etc.  May be missing when dragging is\n   *     triggered programatically rather than by user.\n   */\n  startDrag(e?: PointerEvent): void;\n\n  /**\n   * Handles moving elements to the new location, and updating any\n   * visuals based on that (e.g connection previews for blocks).\n   *\n   * @param newLoc Workspace coordinate to which the draggable has\n   *     been dragged.\n   * @param e PointerEvent that continued the drag.  Can be\n   *     used to check modifier keys, etc.\n   */\n  drag(newLoc: Coordinate, e?: PointerEvent): void;\n\n  /**\n   * Handles any drag cleanup, including e.g. connecting or deleting\n   * blocks.\n   *\n   * @param newLoc Workspace coordinate at which the drag finished.\n   *     been dragged.\n   * @param e PointerEvent that finished the drag.  Can be\n   *     used to check modifier keys, etc.\n   */\n  endDrag(e?: PointerEvent): void;\n\n  /** Moves the draggable back to where it was at the start of the drag. */\n  revertDrag(): void;\n}\n\n/** Returns whether the given object is an IDraggable or not. */\nexport function isDraggable(obj: any): obj is IDraggable {\n  return (\n    obj.getRelativeToSurfaceXY !== undefined &&\n    obj.isMovable !== undefined &&\n    obj.startDrag !== undefined &&\n    obj.drag !== undefined &&\n    obj.endDrag !== undefined &&\n    obj.revertDrag !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.object\n\n/**\n * Complete a deep merge of all members of a source object with a target object.\n *\n * @param target Target.\n * @param source Source.\n * @returns The resulting object.\n */\nexport function deepMerge(\n  target: AnyDuringMigration,\n  source: AnyDuringMigration,\n): AnyDuringMigration {\n  for (const x in source) {\n    if (source[x] !== null && typeof source[x] === 'object') {\n      target[x] = deepMerge(target[x] || Object.create(null), source[x]);\n    } else {\n      target[x] = source[x];\n    }\n  }\n  return target;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {IProcedureModel} from './i_procedure_model.js';\n// Former goog.module ID: Blockly.procedures.IProcedureBlock\n\n/** The interface for a block which models a procedure. */\nexport interface IProcedureBlock {\n  getProcedureModel(): IProcedureModel;\n  doProcedureUpdate(): void;\n  isProcedureDef(): boolean;\n}\n\n/** A type guard which checks if the given block is a procedure block. */\nexport function isProcedureBlock(\n  block: Block | IProcedureBlock,\n): block is IProcedureBlock {\n  return (\n    (block as IProcedureBlock).getProcedureModel !== undefined &&\n    (block as IProcedureBlock).doProcedureUpdate !== undefined &&\n    (block as IProcedureBlock).isProcedureDef !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that fires events optionally.\n *\n * @internal\n */\nexport interface IObservable {\n  startPublishing(): void;\n  stopPublishing(): void;\n}\n\n/**\n * Type guard for checking if an object fulfills IObservable.\n *\n * @internal\n */\nexport function isObservable(obj: any): obj is IObservable {\n  return obj.startPublishing !== undefined && obj.stopPublishing !== undefined;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.fieldRegistry\n\nimport type {Field, FieldConfig} from './field.js';\nimport * as registry from './registry.js';\n\n/**\n * When constructing a field from JSON using the registry, the\n * `fromJson` method in this file is called with an options parameter\n * object consisting of the \"type\" which is the name of the field, and\n * other options that are part of the field's config object.\n *\n * These options are then passed to the field's static `fromJson`\n * method. That method accepts an options parameter with a type that usually\n * extends from FieldConfig, and may or may not have a \"type\" attribute (in\n * fact, it shouldn't, because we'd overwrite it as described above!)\n *\n * Unfortunately the registry has no way of knowing the actual Field subclass\n * that will be returned from passing in the name of the field. Therefore it\n * also has no way of knowing that the options object not only implements\n * `FieldConfig`, but it also should satisfy the Config that belongs to that\n * specific class's `fromJson` method.\n *\n * Because of this uncertainty, we just give up on type checking the properties\n * passed to the `fromJson` method, and allow arbitrary string keys with\n * unknown types.\n */\ntype RegistryOptions = FieldConfig & {\n  // The name of the field, e.g. field_dropdown\n  type: string;\n  [key: string]: unknown;\n};\n\n/**\n * Represents the static methods that must be defined on any\n * field that is registered, i.e. the constructor and fromJson methods.\n *\n * Because we don't know which Field subclass will be registered, we\n * are unable to typecheck the parameters of the constructor.\n */\nexport interface RegistrableField {\n  new (...args: any[]): Field;\n  fromJson(options: FieldConfig): Field;\n}\n\n/**\n * Registers a field type.\n * fieldRegistry.fromJson uses this registry to\n * find the appropriate field type.\n *\n * @param type The field type name as used in the JSON definition.\n * @param fieldClass The field class containing a fromJson function that can\n *     construct an instance of the field.\n * @throws {Error} if the type name is empty, the field is already registered,\n *     or the fieldClass is not an object containing a fromJson function.\n */\nexport function register(type: string, fieldClass: RegistrableField) {\n  registry.register(registry.Type.FIELD, type, fieldClass);\n}\n\n/**\n * Unregisters the field registered with the given type.\n *\n * @param type The field type name as used in the JSON definition.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.FIELD, type);\n}\n\n/**\n * Construct a Field from a JSON arg object.\n * Finds the appropriate registered field by the type name as registered using\n * fieldRegistry.register.\n *\n * @param options A JSON object with a type and options specific to the field\n *     type.\n * @returns The new field instance or null if a field wasn't found with the\n *     given type name\n * @internal\n */\nexport function fromJson<T>(options: RegistryOptions): Field<T> | null {\n  return TEST_ONLY.fromJsonInternal(options);\n}\n\n/**\n * Private version of fromJson for stubbing in tests.\n *\n * @param options\n */\nfunction fromJsonInternal<T>(options: RegistryOptions): Field<T> | null {\n  const fieldObject = registry.getObject(\n    registry.Type.FIELD,\n    options.type,\n  ) as unknown as RegistrableField;\n  if (!fieldObject) {\n    console.warn(\n      'Blockly could not create a field of type ' +\n        options['type'] +\n        '. The field is probably not being registered. This could be because' +\n        ' the file is not loaded, the field does not register itself (Issue' +\n        ' #1584), or the registration is not being reached.',\n    );\n    return null;\n  }\n  return fieldObject.fromJson(options);\n}\n\nexport const TEST_ONLY = {\n  fromJsonInternal,\n};\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Dropdown input field.  Used for editable titles and variables.\n * In the interests of a consistent UI, the toolbox shares some functions and\n * properties with the context menu.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldDropdown\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as style from './utils/style.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as utilsString from './utils/string.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an editable dropdown field.\n */\nexport class FieldDropdown extends Field<string> {\n  /** Horizontal distance that a checkmark overhangs the dropdown. */\n  static CHECKMARK_OVERHANG = 25;\n\n  /**\n   * Maximum height of the dropdown menu, as a percentage of the viewport\n   * height.\n   */\n  static MAX_MENU_HEIGHT_VH = 0.45;\n\n  static ARROW_CHAR = '';\n\n  /** A reference to the currently selected menu item. */\n  private selectedMenuItem: MenuItem | null = null;\n\n  /** The dropdown menu. */\n  protected menu_: Menu | null = null;\n\n  /**\n   * SVG image element if currently selected option is an image, or null.\n   */\n  private imageElement: SVGImageElement | null = null;\n\n  /** Tspan based arrow element. */\n  private arrow: SVGTSpanElement | null = null;\n\n  /** SVG based arrow element. */\n  private svgArrow: SVGElement | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  protected menuGenerator_?: MenuGenerator;\n\n  /** A cache of the most recently generated options. */\n  private generatedOptions: MenuOption[] | null = null;\n\n  /**\n   * The prefix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override prefixField: string | null = null;\n\n  /**\n   * The suffix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override suffixField: string | null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  private selectedOption!: MenuOption;\n  override clickTarget_: SVGElement | null = null;\n\n  /**\n   * @param menuGenerator A non-empty array of options for a dropdown list, or a\n   *     function which generates these options. Also accepts Field.SKIP_SETUP\n   *     if you wish to skip setup (only used by subclasses that want to handle\n   *     configuration and setting the field value after their own constructors\n   *     have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a language-neutral dropdown option & returns a\n   *     validated language-neutral dropdown option, or null to abort the\n   *     change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/dropdown#creation}\n   * for a list of properties this parameter supports.\n   * @throws {TypeError} If `menuGenerator` options are incorrectly structured.\n   */\n  constructor(\n    menuGenerator: MenuGenerator,\n    validator?: FieldDropdownValidator,\n    config?: FieldDropdownConfig,\n  );\n  constructor(menuGenerator: typeof Field.SKIP_SETUP);\n  constructor(\n    menuGenerator: MenuGenerator | typeof Field.SKIP_SETUP,\n    validator?: FieldDropdownValidator,\n    config?: FieldDropdownConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    // If we pass SKIP_SETUP, don't do *anything* with the menu generator.\n    if (menuGenerator === Field.SKIP_SETUP) return;\n\n    if (Array.isArray(menuGenerator)) {\n      validateOptions(menuGenerator);\n      const trimmed = trimOptions(menuGenerator);\n      this.menuGenerator_ = trimmed.options;\n      this.prefixField = trimmed.prefix || null;\n      this.suffixField = trimmed.suffix || null;\n    } else {\n      this.menuGenerator_ = menuGenerator;\n    }\n\n    /**\n     * The currently selected option. The field is initialized with the\n     * first option selected.\n     */\n    this.selectedOption = this.getOptions(false)[0];\n\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(this.selectedOption[1]);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(fieldElement.textContent);\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state to apply to the dropdown field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(FieldDropdown, state)) {\n      return;\n    }\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this dropdown.\n   */\n  override initView() {\n    if (this.shouldAddBorderRect_()) {\n      this.createBorderRect_();\n    } else {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n    this.createTextElement_();\n\n    this.imageElement = dom.createSvgElement(Svg.IMAGE, {}, this.fieldGroup_);\n\n    if (this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW) {\n      this.createSVGArrow_();\n    } else {\n      this.createTextArrow_();\n    }\n\n    if (this.borderRect_) {\n      dom.addClass(this.borderRect_, 'blocklyDropdownRect');\n    }\n  }\n\n  /**\n   * Whether or not the dropdown should add a border rect.\n   *\n   * @returns True if the dropdown field should add a border rect.\n   */\n  protected shouldAddBorderRect_(): boolean {\n    return (\n      !this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n      (this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW &&\n        !this.getSourceBlock()?.isShadow())\n    );\n  }\n\n  /** Create a tspan based arrow. */\n  protected createTextArrow_() {\n    this.arrow = dom.createSvgElement(Svg.TSPAN, {}, this.textElement_);\n    this.arrow!.appendChild(\n      document.createTextNode(\n        this.getSourceBlock()?.RTL\n          ? FieldDropdown.ARROW_CHAR + ' '\n          : ' ' + FieldDropdown.ARROW_CHAR,\n      ),\n    );\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.arrow.setAttribute('dominant-baseline', 'central');\n    }\n    if (this.getSourceBlock()?.RTL) {\n      this.getTextElement().insertBefore(this.arrow, this.textContent_);\n    } else {\n      this.getTextElement().appendChild(this.arrow);\n    }\n  }\n\n  /** Create an SVG based arrow. */\n  protected createSVGArrow_() {\n    this.svgArrow = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'height': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n        'width': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n      },\n      this.fieldGroup_,\n    );\n    this.svgArrow!.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_DATAURI,\n    );\n  }\n\n  /**\n   * Create a dropdown menu under the text.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected override showEditor_(e?: MouseEvent) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.dropdownCreate();\n    if (e && typeof e.clientX === 'number') {\n      this.menu_!.openingCoords = new Coordinate(e.clientX, e.clientY);\n    } else {\n      this.menu_!.openingCoords = null;\n    }\n\n    // Remove any pre-existing elements in the dropdown.\n    dropDownDiv.clearContent();\n    // Element gets created in render.\n    const menuElement = this.menu_!.render(dropDownDiv.getContentDiv());\n    dom.addClass(menuElement, 'blocklyDropdownMenu');\n\n    if (this.getConstants()!.FIELD_DROPDOWN_COLOURED_DIV) {\n      const primaryColour = block.getColour();\n      const borderColour = (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      dropDownDiv.setColour(primaryColour, borderColour);\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\n\n    // Focusing needs to be handled after the menu is rendered and positioned.\n    // Otherwise it will cause a page scroll to get the misplaced menu in\n    // view. See issue #1329.\n    this.menu_!.focus();\n\n    if (this.selectedMenuItem) {\n      this.menu_!.setHighlighted(this.selectedMenuItem);\n      style.scrollIntoContainerView(\n        this.selectedMenuItem.getElement()!,\n        dropDownDiv.getContentDiv(),\n        true,\n      );\n    }\n\n    this.applyColour();\n  }\n\n  /** Create the dropdown editor. */\n  private dropdownCreate() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const menu = new Menu();\n    menu.setRole(aria.Role.LISTBOX);\n    this.menu_ = menu;\n\n    const options = this.getOptions(false);\n    this.selectedMenuItem = null;\n    for (let i = 0; i < options.length; i++) {\n      const [label, value] = options[i];\n      const content = (() => {\n        if (typeof label === 'object') {\n          // Convert ImageProperties to an HTMLImageElement.\n          const image = new Image(label['width'], label['height']);\n          image.src = label['src'];\n          image.alt = label['alt'] || '';\n          return image;\n        }\n        return label;\n      })();\n      const menuItem = new MenuItem(content, value);\n      menuItem.setRole(aria.Role.OPTION);\n      menuItem.setRightToLeft(block.RTL);\n      menuItem.setCheckable(true);\n      menu.addChild(menuItem);\n      menuItem.setChecked(value === this.value_);\n      if (value === this.value_) {\n        this.selectedMenuItem = menuItem;\n      }\n      menuItem.onAction(this.handleMenuActionEvent, this);\n    }\n  }\n\n  /**\n   * Disposes of events and DOM-references belonging to the dropdown editor.\n   */\n  protected dropdownDispose_() {\n    if (this.menu_) {\n      this.menu_.dispose();\n    }\n    this.menu_ = null;\n    this.selectedMenuItem = null;\n    this.applyColour();\n  }\n\n  /**\n   * Handle an action in the dropdown menu.\n   *\n   * @param menuItem The MenuItem selected within menu.\n   */\n  private handleMenuActionEvent(menuItem: MenuItem) {\n    dropDownDiv.hideIfOwner(this, true);\n    this.onItemSelected_(this.menu_ as Menu, menuItem);\n  }\n\n  /**\n   * Handle the selection of an item in the dropdown menu.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    this.setValue(menuItem.getValue());\n  }\n\n  /**\n   * @returns True if the option list is generated by a function.\n   *     Otherwise false.\n   */\n  isOptionListDynamic(): boolean {\n    return typeof this.menuGenerator_ === 'function';\n  }\n\n  /**\n   * Return a list of the options for this dropdown.\n   *\n   * @param useCache For dynamic options, whether or not to use the cached\n   *     options or to re-generate them.\n   * @returns A non-empty array of option tuples:\n   *     (human-readable text or image, language-neutral name).\n   * @throws {TypeError} If generated options are incorrectly structured.\n   */\n  getOptions(useCache?: boolean): MenuOption[] {\n    if (!this.menuGenerator_) {\n      // A subclass improperly skipped setup without defining the menu\n      // generator.\n      throw TypeError('A menu generator was never defined.');\n    }\n    if (Array.isArray(this.menuGenerator_)) return this.menuGenerator_;\n    if (useCache && this.generatedOptions) return this.generatedOptions;\n\n    this.generatedOptions = this.menuGenerator_();\n    validateOptions(this.generatedOptions);\n    return this.generatedOptions;\n  }\n\n  /**\n   * Ensure that the input value is a valid language-neutral option.\n   *\n   * @param newValue The input value.\n   * @returns A valid language-neutral option, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue: string,\n  ): string | null | undefined;\n  protected override doClassValidation_(newValue?: string): string | null;\n  protected override doClassValidation_(\n    newValue?: string,\n  ): string | null | undefined {\n    const options = this.getOptions(true);\n    const isValueValid = options.some((option) => option[1] === newValue);\n\n    if (!isValueValid) {\n      if (this.sourceBlock_) {\n        console.warn(\n          \"Cannot set the dropdown's value to an unavailable option.\" +\n            ' Block type: ' +\n            this.sourceBlock_.type +\n            ', Field name: ' +\n            this.name +\n            ', Value: ' +\n            newValue,\n        );\n      }\n      return null;\n    }\n    return newValue;\n  }\n\n  /**\n   * Update the value of this dropdown field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is one of the valid dropdown options.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    super.doValueUpdate_(newValue);\n    const options = this.getOptions(true);\n    for (let i = 0, option; (option = options[i]); i++) {\n      if (option[1] === this.value_) {\n        this.selectedOption = option;\n      }\n    }\n  }\n\n  /**\n   * Updates the dropdown arrow to match the colour/style of the block.\n   */\n  override applyColour() {\n    const style = (this.sourceBlock_ as BlockSvg).style;\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', style.colourTertiary);\n      if (this.menu_) {\n        this.borderRect_.setAttribute('fill', style.colourTertiary);\n      } else {\n        this.borderRect_.setAttribute('fill', 'transparent');\n      }\n    }\n    // Update arrow's colour.\n    if (this.sourceBlock_ && this.arrow) {\n      if (this.sourceBlock_.isShadow()) {\n        this.arrow.style.fill = style.colourSecondary;\n      } else {\n        this.arrow.style.fill = style.colourPrimary;\n      }\n    }\n  }\n\n  /** Draws the border with the correct width. */\n  protected override render_() {\n    // Hide both elements.\n    this.getTextContent().nodeValue = '';\n    this.imageElement!.style.display = 'none';\n\n    // Show correct element.\n    const option = this.selectedOption && this.selectedOption[0];\n    if (option && typeof option === 'object') {\n      this.renderSelectedImage(option);\n    } else {\n      this.renderSelectedText();\n    }\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Renders the selected option, which must be an image.\n   *\n   * @param imageJson Selected option that must be an image.\n   */\n  private renderSelectedImage(imageJson: ImageProperties) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.imageElement!.style.display = '';\n    this.imageElement!.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      imageJson.src,\n    );\n    this.imageElement!.setAttribute('height', String(imageJson.height));\n    this.imageElement!.setAttribute('width', String(imageJson.width));\n\n    const imageHeight = Number(imageJson.height);\n    const imageWidth = Number(imageJson.width);\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n      imageHeight + IMAGE_Y_PADDING,\n    );\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow) {\n      arrowWidth = this.positionSVGArrow(\n        imageWidth + xPadding,\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\n      );\n    } else {\n      arrowWidth = dom.getFastTextWidth(\n        this.arrow as SVGTSpanElement,\n        this.getConstants()!.FIELD_TEXT_FONTSIZE,\n        this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n        this.getConstants()!.FIELD_TEXT_FONTFAMILY,\n      );\n    }\n    this.size_.width = imageWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    let arrowX = 0;\n    if (block.RTL) {\n      const imageX = xPadding + arrowWidth;\n      this.imageElement!.setAttribute('x', `${imageX}`);\n    } else {\n      arrowX = imageWidth + arrowWidth;\n      this.getTextElement().setAttribute('text-anchor', 'end');\n      this.imageElement!.setAttribute('x', `${xPadding}`);\n    }\n    this.imageElement!.setAttribute('y', String(height / 2 - imageHeight / 2));\n\n    this.positionTextElement_(arrowX + xPadding, imageWidth + arrowWidth);\n  }\n\n  /** Renders the selected option, which must be text. */\n  private renderSelectedText() {\n    // Retrieves the selected option to display through getText_.\n    this.getTextContent().nodeValue = this.getDisplayText_();\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyDropdownText');\n    textElement.setAttribute('text-anchor', 'start');\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n      this.getConstants()!.FIELD_TEXT_HEIGHT,\n    );\n    const textWidth = dom.getFastTextWidth(\n      this.getTextElement(),\n      this.getConstants()!.FIELD_TEXT_FONTSIZE,\n      this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n      this.getConstants()!.FIELD_TEXT_FONTFAMILY,\n    );\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow) {\n      arrowWidth = this.positionSVGArrow(\n        textWidth + xPadding,\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\n      );\n    }\n    this.size_.width = textWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    this.positionTextElement_(xPadding, textWidth);\n  }\n\n  /**\n   * Position a drop-down arrow at the appropriate location at render-time.\n   *\n   * @param x X position the arrow is being rendered at, in px.\n   * @param y Y position the arrow is being rendered at, in px.\n   * @returns Amount of space the arrow is taking up, in px.\n   */\n  private positionSVGArrow(x: number, y: number): number {\n    if (!this.svgArrow) {\n      return 0;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const hasBorder = !!this.borderRect_;\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    const textPadding = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_PADDING;\n    const svgArrowSize = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE;\n    const arrowX = block.RTL ? xPadding : x + textPadding;\n    this.svgArrow.setAttribute(\n      'transform',\n      'translate(' + arrowX + ',' + y + ')',\n    );\n    return svgArrowSize + textPadding;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.  Get the selected option text.  If the selected option is\n   * an image we return the image alt text.\n   *\n   * @returns Selected option text.\n   */\n  protected override getText_(): string | null {\n    if (!this.selectedOption) {\n      return null;\n    }\n    const option = this.selectedOption[0];\n    if (typeof option === 'object') {\n      return option['alt'];\n    }\n    return option;\n  }\n\n  /**\n   * Construct a FieldDropdown from a JSON arg object.\n   *\n   * @param options A JSON object with options (options).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldDropdownFromJsonConfig,\n  ): FieldDropdown {\n    if (!options.options) {\n      throw new Error(\n        'options are required for the dropdown field. The ' +\n          'options property must be assigned an array of ' +\n          '[humanReadableValue, languageNeutralValue] tuples.',\n      );\n    }\n    // `this` might be a subclass of FieldDropdown if that class doesn't\n    // override the static fromJson method.\n    return new this(options.options, undefined, options);\n  }\n}\n\n/**\n * Definition of a human-readable image dropdown option.\n */\nexport interface ImageProperties {\n  src: string;\n  alt: string;\n  width: number;\n  height: number;\n}\n\n/**\n * An individual option in the dropdown menu. The first element is the human-\n * readable value (text or image), and the second element is the language-\n * neutral value.\n */\nexport type MenuOption = [string | ImageProperties, string];\n\n/**\n * A function that generates an array of menu options for FieldDropdown\n * or its descendants.\n */\nexport type MenuGeneratorFunction = (this: FieldDropdown) => MenuOption[];\n\n/**\n * Either an array of menu options or a function that generates an array of\n * menu options for FieldDropdown or its descendants.\n */\nexport type MenuGenerator = MenuOption[] | MenuGeneratorFunction;\n\n/**\n * Config options for the dropdown field.\n */\nexport type FieldDropdownConfig = FieldConfig;\n\n/**\n * fromJson config for the dropdown field.\n */\nexport interface FieldDropdownFromJsonConfig extends FieldDropdownConfig {\n  options?: MenuOption[];\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldDropdownValidator = FieldValidator<string>;\n\n/**\n * The y offset from the top of the field to the top of the image, if an image\n * is selected.\n */\nconst IMAGE_Y_OFFSET = 5;\n\n/** The total vertical padding above and below an image. */\nconst IMAGE_Y_PADDING: number = IMAGE_Y_OFFSET * 2;\n\n/**\n * Factor out common words in statically defined options.\n * Create prefix and/or suffix labels.\n */\nfunction trimOptions(options: MenuOption[]): {\n  options: MenuOption[];\n  prefix?: string;\n  suffix?: string;\n} {\n  let hasImages = false;\n  const trimmedOptions = options.map(([label, value]): MenuOption => {\n    if (typeof label === 'string') {\n      return [parsing.replaceMessageReferences(label), value];\n    }\n\n    hasImages = true;\n    // Copy the image properties so they're not influenced by the original.\n    // NOTE: No need to deep copy since image properties are only 1 level deep.\n    const imageLabel =\n      label.alt !== null\n        ? {...label, alt: parsing.replaceMessageReferences(label.alt)}\n        : {...label};\n    return [imageLabel, value];\n  });\n\n  if (hasImages || options.length < 2) return {options: trimmedOptions};\n\n  const stringOptions = trimmedOptions as [string, string][];\n  const stringLabels = stringOptions.map(([label]) => label);\n\n  const shortest = utilsString.shortestStringLength(stringLabels);\n  const prefixLength = utilsString.commonWordPrefix(stringLabels, shortest);\n  const suffixLength = utilsString.commonWordSuffix(stringLabels, shortest);\n\n  if (\n    (!prefixLength && !suffixLength) ||\n    shortest <= prefixLength + suffixLength\n  ) {\n    // One or more strings will entirely vanish if we proceed.  Abort.\n    return {options: stringOptions};\n  }\n\n  const prefix = prefixLength\n    ? stringLabels[0].substring(0, prefixLength - 1)\n    : undefined;\n  const suffix = suffixLength\n    ? stringLabels[0].substr(1 - suffixLength)\n    : undefined;\n  return {\n    options: applyTrim(stringOptions, prefixLength, suffixLength),\n    prefix,\n    suffix,\n  };\n}\n\n/**\n * Use the calculated prefix and suffix lengths to trim all of the options in\n * the given array.\n *\n * @param options Array of option tuples:\n *     (human-readable text or image, language-neutral name).\n * @param prefixLength The length of the common prefix.\n * @param suffixLength The length of the common suffix\n * @returns A new array with all of the option text trimmed.\n */\nfunction applyTrim(\n  options: [string, string][],\n  prefixLength: number,\n  suffixLength: number,\n): MenuOption[] {\n  return options.map(([text, value]) => [\n    text.substring(prefixLength, text.length - suffixLength),\n    value,\n  ]);\n}\n\n/**\n * Validates the data structure to be processed as an options list.\n *\n * @param options The proposed dropdown options.\n * @throws {TypeError} If proposed options are incorrectly structured.\n */\nfunction validateOptions(options: MenuOption[]) {\n  if (!Array.isArray(options)) {\n    throw TypeError('FieldDropdown options must be an array.');\n  }\n  if (!options.length) {\n    throw TypeError('FieldDropdown options must not be an empty array.');\n  }\n  let foundError = false;\n  for (let i = 0; i < options.length; i++) {\n    const tuple = options[i];\n    if (!Array.isArray(tuple)) {\n      foundError = true;\n      console.error(\n        'Invalid option[' +\n          i +\n          ']: Each FieldDropdown option must be an ' +\n          'array. Found: ',\n        tuple,\n      );\n    } else if (typeof tuple[1] !== 'string') {\n      foundError = true;\n      console.error(\n        'Invalid option[' +\n          i +\n          ']: Each FieldDropdown option id must be ' +\n          'a string. Found ' +\n          tuple[1] +\n          ' in: ',\n        tuple,\n      );\n    } else if (\n      tuple[0] &&\n      typeof tuple[0] !== 'string' &&\n      typeof tuple[0].src !== 'string'\n    ) {\n      foundError = true;\n      console.error(\n        'Invalid option[' +\n          i +\n          ']: Each FieldDropdown option must have a ' +\n          'string label or image description. Found' +\n          tuple[0] +\n          ' in: ',\n        tuple,\n      );\n    }\n  }\n  if (foundError) {\n    throw TypeError('Found invalid FieldDropdown options.');\n  }\n}\n\nfieldRegistry.register('field_dropdown', FieldDropdown);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Extensions\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {FieldDropdown} from './field_dropdown.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport * as parsing from './utils/parsing.js';\n\n/** The set of all registered extensions, keyed by extension name/id. */\nconst allExtensions = Object.create(null);\nexport const TEST_ONLY = {allExtensions};\n\n/**\n * Registers a new extension function. Extensions are functions that help\n * initialize blocks, usually adding dynamic behavior such as onchange\n * handlers and mutators. These are applied using Block.applyExtension(), or\n * the JSON \"extensions\" array attribute.\n *\n * @param name The name of this extension.\n * @param initFn The function to initialize an extended block.\n * @throws {Error} if the extension name is empty, the extension is already\n *     registered, or extensionFn is not a function.\n */\nexport function register(name: string, initFn: Function) {\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error('Error: Invalid extension name \"' + name + '\"');\n  }\n  if (allExtensions[name]) {\n    throw Error('Error: Extension \"' + name + '\" is already registered.');\n  }\n  if (typeof initFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" must be a function');\n  }\n  allExtensions[name] = initFn;\n}\n\n/**\n * Registers a new extension function that adds all key/value of mixinObj.\n *\n * @param name The name of this extension.\n * @param mixinObj The values to mix in.\n * @throws {Error} if the extension name is empty or the extension is already\n *     registered.\n */\nexport function registerMixin(name: string, mixinObj: AnyDuringMigration) {\n  if (!mixinObj || typeof mixinObj !== 'object') {\n    throw Error('Error: Mixin \"' + name + '\" must be a object');\n  }\n  register(name, function (this: Block) {\n    this.mixin(mixinObj);\n  });\n}\n\n/**\n * Registers a new extension function that adds a mutator to the block.\n * At register time this performs some basic sanity checks on the mutator.\n * The wrapper may also add a mutator dialog to the block, if both compose and\n * decompose are defined on the mixin.\n *\n * @param name The name of this mutator extension.\n * @param mixinObj The values to mix in.\n * @param opt_helperFn An optional function to apply after mixing in the object.\n * @param opt_blockList A list of blocks to appear in the flyout of the mutator\n *     dialog.\n * @throws {Error} if the mutation is invalid or can't be applied to the block.\n */\nexport function registerMutator(\n  name: string,\n  mixinObj: AnyDuringMigration,\n  opt_helperFn?: () => AnyDuringMigration,\n  opt_blockList?: string[],\n) {\n  const errorPrefix = 'Error when registering mutator \"' + name + '\": ';\n\n  checkHasMutatorProperties(errorPrefix, mixinObj);\n  const hasMutatorDialog = checkMutatorDialog(mixinObj, errorPrefix);\n\n  if (opt_helperFn && typeof opt_helperFn !== 'function') {\n    throw Error(errorPrefix + 'Extension \"' + name + '\" is not a function');\n  }\n\n  // Sanity checks passed.\n  register(name, function (this: Block) {\n    if (hasMutatorDialog) {\n      this.setMutator(new MutatorIcon(opt_blockList || [], this as BlockSvg));\n    }\n    // Mixin the object.\n    this.mixin(mixinObj);\n\n    if (opt_helperFn) {\n      opt_helperFn.apply(this);\n    }\n  });\n}\n\n/**\n * Unregisters the extension registered with the given name.\n *\n * @param name The name of the extension to unregister.\n */\nexport function unregister(name: string) {\n  if (isRegistered(name)) {\n    delete allExtensions[name];\n  } else {\n    console.warn(\n      'No extension mapping for name \"' + name + '\" found to unregister',\n    );\n  }\n}\n\n/**\n * Returns whether an extension is registered with the given name.\n *\n * @param name The name of the extension to check for.\n * @returns True if the extension is registered.  False if it is not registered.\n */\nexport function isRegistered(name: string): boolean {\n  return !!allExtensions[name];\n}\n\n/**\n * Applies an extension method to a block. This should only be called during\n * block construction.\n *\n * @param name The name of the extension.\n * @param block The block to apply the named extension to.\n * @param isMutator True if this extension defines a mutator.\n * @throws {Error} if the extension is not found.\n */\nexport function apply(name: string, block: Block, isMutator: boolean) {\n  const extensionFn = allExtensions[name];\n  if (typeof extensionFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" not found.');\n  }\n  let mutatorProperties;\n  if (isMutator) {\n    // Fail early if the block already has mutation properties.\n    checkNoMutatorProperties(name, block);\n  } else {\n    // Record the old properties so we can make sure they don't change after\n    // applying the extension.\n    mutatorProperties = getMutatorProperties(block);\n  }\n  extensionFn.apply(block);\n\n  if (isMutator) {\n    const errorPrefix = 'Error after applying mutator \"' + name + '\": ';\n    checkHasMutatorProperties(errorPrefix, block);\n  } else {\n    if (\n      !mutatorPropertiesMatch(mutatorProperties as AnyDuringMigration[], block)\n    ) {\n      throw Error(\n        'Error when applying extension \"' +\n          name +\n          '\": ' +\n          'mutation properties changed when applying a non-mutator extension.',\n      );\n    }\n  }\n}\n\n/**\n * Check that the given block does not have any of the four mutator properties\n * defined on it.  This function should be called before applying a mutator\n * extension to a block, to make sure we are not overwriting properties.\n *\n * @param mutationName The name of the mutation to reference in error messages.\n * @param block The block to check.\n * @throws {Error} if any of the properties already exist on the block.\n */\nfunction checkNoMutatorProperties(mutationName: string, block: Block) {\n  const properties = getMutatorProperties(block);\n  if (properties.length) {\n    throw Error(\n      'Error: tried to apply mutation \"' +\n        mutationName +\n        '\" to a block that already has mutator functions.' +\n        '  Block id: ' +\n        block.id,\n    );\n  }\n}\n\n/**\n * Checks if the given object has both the 'mutationToDom' and 'domToMutation'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkXmlHooks(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.mutationToDom,\n    object.domToMutation,\n    errorPrefix + ' mutationToDom/domToMutation',\n  );\n}\n/**\n * Checks if the given object has both the 'saveExtraState' and 'loadExtraState'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkJsonHooks(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.saveExtraState,\n    object.loadExtraState,\n    errorPrefix + ' saveExtraState/loadExtraState',\n  );\n}\n\n/**\n * Checks if the given object has both the 'compose' and 'decompose' functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkMutatorDialog(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.compose,\n    object.decompose,\n    errorPrefix + ' compose/decompose',\n  );\n}\n\n/**\n * Checks that both or neither of the given functions exist and that they are\n * indeed functions.\n *\n * @param func1 The first function in the pair.\n * @param func2 The second function in the pair.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} If the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkHasFunctionPair(\n  func1: AnyDuringMigration,\n  func2: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  if (func1 && func2) {\n    if (typeof func1 !== 'function' || typeof func2 !== 'function') {\n      throw Error(errorPrefix + ' must be a function');\n    }\n    return true;\n  } else if (!func1 && !func2) {\n    return false;\n  }\n  throw Error(errorPrefix + 'Must have both or neither functions');\n}\n\n/**\n * Checks that the given object required mutator properties.\n *\n * @param errorPrefix The string to prepend to any error message.\n * @param object The object to inspect.\n */\nfunction checkHasMutatorProperties(\n  errorPrefix: string,\n  object: AnyDuringMigration,\n) {\n  const hasXmlHooks = checkXmlHooks(object, errorPrefix);\n  const hasJsonHooks = checkJsonHooks(object, errorPrefix);\n  if (!hasXmlHooks && !hasJsonHooks) {\n    throw Error(\n      errorPrefix +\n        'Mutations must contain either XML hooks, or JSON hooks, or both',\n    );\n  }\n  // A block with a mutator isn't required to have a mutation dialog, but\n  // it should still have both or neither of compose and decompose.\n  checkMutatorDialog(object, errorPrefix);\n}\n\n/**\n * Get a list of values of mutator properties on the given block.\n *\n * @param block The block to inspect.\n * @returns A list with all of the defined properties, which should be\n *     functions, but may be anything other than undefined.\n */\nfunction getMutatorProperties(block: Block): AnyDuringMigration[] {\n  const result = [];\n  // List each function explicitly by reference to allow for renaming\n  // during compilation.\n  if (block.domToMutation !== undefined) {\n    result.push(block.domToMutation);\n  }\n  if (block.mutationToDom !== undefined) {\n    result.push(block.mutationToDom);\n  }\n  if (block.saveExtraState !== undefined) {\n    result.push(block.saveExtraState);\n  }\n  if (block.loadExtraState !== undefined) {\n    result.push(block.loadExtraState);\n  }\n  if (block.compose !== undefined) {\n    result.push(block.compose);\n  }\n  if (block.decompose !== undefined) {\n    result.push(block.decompose);\n  }\n  return result;\n}\n\n/**\n * Check that the current mutator properties match a list of old mutator\n * properties.  This should be called after applying a non-mutator extension,\n * to verify that the extension didn't change properties it shouldn't.\n *\n * @param oldProperties The old values to compare to.\n * @param block The block to inspect for new values.\n * @returns True if the property lists match.\n */\nfunction mutatorPropertiesMatch(\n  oldProperties: AnyDuringMigration[],\n  block: Block,\n): boolean {\n  const newProperties = getMutatorProperties(block);\n  if (newProperties.length !== oldProperties.length) {\n    return false;\n  }\n  for (let i = 0; i < newProperties.length; i++) {\n    if (oldProperties[i] !== newProperties[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @internal\n */\nexport function runAfterPageLoad(fn: () => void) {\n  if (typeof document !== 'object') {\n    throw Error('runAfterPageLoad() requires browser document.');\n  }\n  if (document.readyState === 'complete') {\n    fn(); // Page has already loaded. Call immediately.\n  } else {\n    // Poll readyState.\n    const readyStateCheckInterval = setInterval(function () {\n      if (document.readyState === 'complete') {\n        clearInterval(readyStateCheckInterval);\n        fn();\n      }\n    }, 10);\n  }\n}\n\n/**\n * Builds an extension function that will map a dropdown value to a tooltip\n * string.\n *\n * @param dropdownName The name of the field whose value is the key to the\n *     lookup table.\n * @param lookupTable The table of field values to tooltip text.\n * @returns The extension function.\n */\nexport function buildTooltipForDropdown(\n  dropdownName: string,\n  lookupTable: {[key: string]: string},\n): (this: Block) => void {\n  // List of block types already validated, to minimize duplicate warnings.\n  const blockTypesChecked: string[] = [];\n\n  return function (this: Block) {\n    if (!blockTypesChecked.includes(this.type)) {\n      checkDropdownOptionsInTable(this, dropdownName, lookupTable);\n      blockTypesChecked.push(this.type);\n    }\n\n    this.setTooltip(\n      function (this: Block) {\n        const value = String(this.getFieldValue(dropdownName));\n        return parsing.replaceMessageReferences(lookupTable[value]);\n      }.bind(this),\n    );\n  };\n}\n\n/**\n * Checks all options keys are present in the provided string lookup table.\n * Emits console warnings when they are not.\n *\n * @param block The block containing the dropdown\n * @param dropdownName The name of the dropdown\n * @param lookupTable The string lookup table\n */\nfunction checkDropdownOptionsInTable(\n  block: Block,\n  dropdownName: string,\n  lookupTable: {[key: string]: string},\n) {\n  const dropdown = block.getField(dropdownName);\n  if (!(dropdown instanceof FieldDropdown) || dropdown.isOptionListDynamic()) {\n    return;\n  }\n\n  const options = dropdown.getOptions();\n  for (const [, key] of options) {\n    if (lookupTable[key] === undefined) {\n      console.warn(\n        `No tooltip mapping for value ${key} of field ` +\n          `${dropdownName} of block type ${block.type}.`,\n      );\n    }\n  }\n}\n\n/**\n * Builds an extension function that will install a dynamic tooltip. The\n * tooltip message should include the string '%1' and that string will be\n * replaced with the text of the named field.\n *\n * @param msgTemplate The template form to of the message text, with %1\n *     placeholder.\n * @param fieldName The field with the replacement text.\n * @returns The extension function.\n */\nexport function buildTooltipWithFieldText(\n  msgTemplate: string,\n  fieldName: string,\n): (this: Block) => void {\n  return function (this: Block) {\n    this.setTooltip(\n      function (this: Block) {\n        const field = this.getField(fieldName);\n        return parsing\n          .replaceMessageReferences(msgTemplate)\n          .replace('%1', field ? field.getText() : '');\n      }.bind(this),\n    );\n  };\n}\n\n/**\n * Configures the tooltip to mimic the parent block when connected. Otherwise,\n * uses the tooltip text at the time this extension is initialized. This takes\n * advantage of the fact that all other values from JSON are initialized before\n * extensions.\n */\nfunction extensionParentTooltip(this: Block) {\n  const tooltipWhenNotConnected = this.tooltip;\n  this.setTooltip(\n    function (this: Block) {\n      const parent = this.getParent();\n      return (\n        (parent && parent.getInputsInline() && parent.tooltip) ||\n        tooltipWhenNotConnected\n      );\n    }.bind(this),\n  );\n}\nregister('parent_tooltip_when_inline', extensionParentTooltip);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.deprecation\n\n// Set of previously-emitted warnings.\nconst previousWarnings = new Set();\n\n/**\n * Warn developers that a function or property is deprecated.\n *\n * @param name The name of the function or property.\n * @param deprecationDate The date of deprecation. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param deletionDate The date of deletion. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param opt_use The name of a function or property to use instead, if any.\n * @internal\n */\nexport function warn(\n  name: string,\n  deprecationDate: string,\n  deletionDate: string,\n  opt_use?: string,\n) {\n  let msg =\n    name +\n    ' was deprecated in ' +\n    deprecationDate +\n    ' and will be deleted in ' +\n    deletionDate +\n    '.';\n  if (opt_use) {\n    msg += '\\nUse ' + opt_use + ' instead.';\n  }\n\n  // Don't log deprecation warnings multiple times.\n  if (previousWarnings.has(msg)) {\n    return;\n  }\n\n  previousWarnings.add(msg);\n  console.warn(msg);\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.svgPaths\n\n/**\n * Create a string representing the given x, y pair.  It does not matter whether\n * the coordinate is relative or absolute.  The result has leading\n * and trailing spaces, and separates the x and y coordinates with a comma but\n * no space.\n *\n * @param x The x coordinate.\n * @param y The y coordinate.\n * @returns A string of the format ' x,y '\n */\nexport function point(x: number, y: number): string {\n  return ' ' + x + ',' + y + ' ';\n}\n\n/**\n * Draw a cubic or quadratic curve.  See\n * developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Cubic_B%C3%A9zier_Curve\n * These coordinates are unitless and hence in the user coordinate system.\n *\n * @param command The command to use.\n *     Should be one of: c, C, s, S, q, Q.\n * @param points  An array containing all of the points to pass to the curve\n *     command, in order.  The points are represented as strings of the format '\n *     x, y '.\n * @returns A string defining one or more Bezier curves.  See the MDN\n *     documentation for exact format.\n */\nexport function curve(command: string, points: string[]): string {\n  return ' ' + command + points.join('');\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * The coordinates are absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param x The absolute x coordinate.\n * @param y The absolute y coordinate.\n * @returns A string of the format ' M x,y '\n */\nexport function moveTo(x: number, y: number): string {\n  return ' M ' + x + ',' + y + ' ';\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * Coordinates are relative.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' m dx,dy '\n */\nexport function moveBy(dx: number, dy: number): string {\n  return ' m ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw a line from the current point to the end point, which is the current\n * point shifted by dx along the x-axis and dy along the y-axis.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' l dx,dy '\n */\nexport function lineTo(dx: number, dy: number): string {\n  return ' l ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw multiple lines connecting all of the given points in order.  This is\n * equivalent to a series of 'l' commands.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param points An array containing all of the points to draw lines to, in\n *     order.  The points are represented as strings of the format ' dx,dy '.\n * @returns A string of the format ' l (dx,dy)+ '\n */\nexport function line(points: string[]): string {\n  return ' l' + points.join('');\n}\n\n/**\n * Draw a horizontal or vertical line.\n * The first argument specifies the direction and whether the given position is\n * relative or absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#LineTo_path_commands\n *\n * @param command The command to prepend to the coordinate.  This should be one\n *     of: V, v, H, h.\n * @param val The coordinate to pass to the command.  It may be absolute or\n *     relative.\n * @returns A string of the format ' command val '\n */\nexport function lineOnAxis(command: string, val: number): string {\n  return ' ' + command + ' ' + val + ' ';\n}\n\n/**\n * Draw an elliptical arc curve.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\n *\n * @param command The command string.  Either 'a' or 'A'.\n * @param flags The flag string.  See the MDN documentation for a description\n *     and examples.\n * @param radius The radius of the arc to draw.\n * @param point The point to move the cursor to after drawing the arc, specified\n *     either in absolute or relative coordinates depending on the command.\n * @returns A string of the format 'command radius radius flags point'\n */\nexport function arc(\n  command: string,\n  flags: string,\n  radius: number,\n  point: string,\n): string {\n  return command + ' ' + radius + ' ' + radius + ' ' + flags + point;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {IIcon} from '../interfaces/i_icon.js';\nimport * as registry from '../registry.js';\nimport {IconType} from './icon_types.js';\n\n/**\n * Registers the given icon so that it can be deserialized.\n *\n * @param type The type of the icon to register. This should be the same string\n *     that is returned from its `getType` method.\n * @param iconConstructor The icon class/constructor to register.\n */\nexport function register(\n  type: IconType<IIcon>,\n  iconConstructor: new (block: Block) => IIcon,\n) {\n  registry.register(registry.Type.ICON, type.toString(), iconConstructor);\n}\n\n/**\n * Unregisters the icon associated with the given type.\n *\n * @param type The type of the icon to unregister.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.ICON, type);\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Procedures\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BubbleOpen} from './events/events_bubble_open.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport {IParameterModel} from './interfaces/i_parameter_model.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {\n  IProcedureBlock,\n  isProcedureBlock,\n} from './interfaces/i_procedure_block.js';\nimport {\n  isLegacyProcedureCallBlock,\n  isLegacyProcedureDefBlock,\n  ProcedureBlock,\n  ProcedureTuple,\n} from './interfaces/i_legacy_procedure_blocks.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {MutatorIcon} from './icons.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'PROCEDURE';\n\n/**\n * The default argument for a procedures_mutatorarg block.\n */\nexport const DEFAULT_ARG = 'x';\n\n/**\n * Find all user-created procedure definitions in a workspace.\n *\n * @param root Root workspace.\n * @returns Pair of arrays, the first contains procedures without return\n *     variables, the second with. Each procedure is defined by a three-element\n *     list of name, parameter list, and return value boolean.\n */\nexport function allProcedures(\n  root: Workspace,\n): [ProcedureTuple[], ProcedureTuple[]] {\n  const proceduresNoReturn: ProcedureTuple[] = root\n    .getProcedureMap()\n    .getProcedures()\n    .filter((p) => !p.getReturnTypes())\n    .map((p) => [\n      p.getName(),\n      p.getParameters().map((pa) => pa.getName()),\n      false,\n    ]);\n  root.getBlocksByType('procedures_defnoreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresNoReturn.push(b.getProcedureDef());\n    }\n  });\n\n  const proceduresReturn: ProcedureTuple[] = root\n    .getProcedureMap()\n    .getProcedures()\n    .filter((p) => !!p.getReturnTypes())\n    .map((p) => [\n      p.getName(),\n      p.getParameters().map((pa) => pa.getName()),\n      true,\n    ]);\n  root.getBlocksByType('procedures_defreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresReturn.push(b.getProcedureDef());\n    }\n  });\n  proceduresNoReturn.sort(procTupleComparator);\n  proceduresReturn.sort(procTupleComparator);\n  return [proceduresNoReturn, proceduresReturn];\n}\n\n/**\n * Comparison function for case-insensitive sorting of the first element of\n * a tuple.\n *\n * @param ta First tuple.\n * @param tb Second tuple.\n * @returns -1, 0, or 1 to signify greater than, equality, or less than.\n */\nfunction procTupleComparator(ta: ProcedureTuple, tb: ProcedureTuple): number {\n  return ta[0].localeCompare(tb[0], undefined, {sensitivity: 'base'});\n}\n\n/**\n * Ensure two identically-named procedures don't exist.\n * Take the proposed procedure name, and return a legal name i.e. one that\n * is not empty and doesn't collide with other procedures.\n *\n * @param name Proposed procedure name.\n * @param block Block to disambiguate.\n * @returns Non-colliding name.\n */\nexport function findLegalName(name: string, block: Block): string {\n  if (block.isInFlyout) {\n    // Flyouts can have multiple procedures called 'do something'.\n    return name;\n  }\n  name = name || Msg['UNNAMED_KEY'] || 'unnamed';\n  while (!isLegalName(name, block.workspace, block)) {\n    // Collision with another procedure.\n    const r = name.match(/^(.*?)(\\d+)$/);\n    if (!r) {\n      name += '2';\n    } else {\n      name = r[1] + (parseInt(r[2]) + 1);\n    }\n  }\n  return name;\n}\n/**\n * Does this procedure have a legal name?  Illegal names include names of\n * procedures already defined.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is legal.\n */\nfunction isLegalName(\n  name: string,\n  workspace: Workspace,\n  opt_exclude?: Block,\n): boolean {\n  return !isNameUsed(name, workspace, opt_exclude);\n}\n\n/**\n * Return if the given name is already a procedure name.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is used, otherwise return false.\n */\nexport function isNameUsed(\n  name: string,\n  workspace: Workspace,\n  opt_exclude?: Block,\n): boolean {\n  for (const block of workspace.getAllBlocks(false)) {\n    if (block === opt_exclude) continue;\n\n    if (\n      isLegacyProcedureDefBlock(block) &&\n      Names.equals(block.getProcedureDef()[0], name)\n    ) {\n      return true;\n    }\n  }\n\n  const excludeModel =\n    opt_exclude && isProcedureBlock(opt_exclude)\n      ? opt_exclude?.getProcedureModel()\n      : undefined;\n  for (const model of workspace.getProcedureMap().getProcedures()) {\n    if (model === excludeModel) continue;\n    if (Names.equals(model.getName(), name)) return true;\n  }\n  return false;\n}\n\n/**\n * Rename a procedure.  Called by the editable field.\n *\n * @param name The proposed new name.\n * @returns The accepted name.\n */\nexport function rename(this: Field, name: string): string {\n  const block = this.getSourceBlock();\n  if (!block) {\n    throw new UnattachedFieldError();\n  }\n\n  // Strip leading and trailing whitespace.  Beyond this, all names are legal.\n  name = name.trim();\n\n  const legalName = findLegalName(name, block);\n  if (isProcedureBlock(block) && !block.isInsertionMarker()) {\n    block.getProcedureModel().setName(legalName);\n  }\n  const oldName = this.getValue();\n  if (oldName !== name && oldName !== legalName) {\n    // Rename any callers.\n    const blocks = block.workspace.getAllBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      // Assume it is a procedure so we can check.\n      const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n      if (procedureBlock.renameProcedure) {\n        procedureBlock.renameProcedure(oldName as string, legalName);\n      }\n    }\n  }\n  return legalName;\n}\n\n/**\n * Construct the blocks required by the flyout for the procedure category.\n *\n * @param workspace The workspace containing procedures.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  const xmlList = [];\n  if (Blocks['procedures_defnoreturn']) {\n    // <block type=\"procedures_defnoreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defnoreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFNORETURN_PROCEDURE']),\n    );\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_defreturn']) {\n    // <block type=\"procedures_defreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFRETURN_PROCEDURE']),\n    );\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_ifreturn']) {\n    // <block type=\"procedures_ifreturn\" gap=\"16\"></block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_ifreturn');\n    block.setAttribute('gap', '16');\n    xmlList.push(block);\n  }\n  if (xmlList.length) {\n    // Add slightly larger gap between system blocks and user calls.\n    xmlList[xmlList.length - 1].setAttribute('gap', '24');\n  }\n\n  /**\n   * Add items to xmlList for each listed procedure.\n   *\n   * @param procedureList A list of procedures, each of which is defined by a\n   *     three-element list of name, parameter list, and return value boolean.\n   * @param templateName The type of the block to generate.\n   */\n  function populateProcedures(\n    procedureList: ProcedureTuple[],\n    templateName: string,\n  ) {\n    for (let i = 0; i < procedureList.length; i++) {\n      const name = procedureList[i][0];\n      const args = procedureList[i][1];\n      // <block type=\"procedures_callnoreturn\" gap=\"16\">\n      //   <mutation name=\"do something\">\n      //     <arg name=\"x\"></arg>\n      //   </mutation>\n      // </block>\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', templateName);\n      block.setAttribute('gap', '16');\n      const mutation = utilsXml.createElement('mutation');\n      mutation.setAttribute('name', name);\n      block.appendChild(mutation);\n      for (let j = 0; j < args.length; j++) {\n        const arg = utilsXml.createElement('arg');\n        arg.setAttribute('name', args[j]);\n        mutation.appendChild(arg);\n      }\n      xmlList.push(block);\n    }\n  }\n\n  const tuple = allProcedures(workspace);\n  populateProcedures(tuple[0], 'procedures_callnoreturn');\n  populateProcedures(tuple[1], 'procedures_callreturn');\n  return xmlList;\n}\n\n/**\n * Updates the procedure mutator's flyout so that the arg block is not a\n * duplicate of another arg.\n *\n * @param workspace The procedure mutator's workspace. This workspace's flyout\n *     is what is being updated.\n */\nfunction updateMutatorFlyout(workspace: WorkspaceSvg) {\n  const usedNames = [];\n  const blocks = workspace.getBlocksByType('procedures_mutatorarg', false);\n  for (let i = 0, block; (block = blocks[i]); i++) {\n    usedNames.push(block.getFieldValue('NAME'));\n  }\n\n  const xmlElement = utilsXml.createElement('xml');\n  const argBlock = utilsXml.createElement('block');\n  argBlock.setAttribute('type', 'procedures_mutatorarg');\n  const nameField = utilsXml.createElement('field');\n  nameField.setAttribute('name', 'NAME');\n  const argValue = Variables.generateUniqueNameFromOptions(\n    DEFAULT_ARG,\n    usedNames,\n  );\n  const fieldContent = utilsXml.createTextNode(argValue);\n\n  nameField.appendChild(fieldContent);\n  argBlock.appendChild(nameField);\n  xmlElement.appendChild(argBlock);\n\n  workspace.updateToolbox(xmlElement);\n}\n\n/**\n * Listens for when a procedure mutator is opened. Then it triggers a flyout\n * update and adds a mutator change listener to the mutator workspace.\n *\n * @param e The event that triggered this listener.\n * @internal\n */\nexport function mutatorOpenListener(e: Abstract) {\n  if (e.type !== eventUtils.BUBBLE_OPEN) {\n    return;\n  }\n  const bubbleEvent = e as BubbleOpen;\n  if (\n    !(bubbleEvent.bubbleType === 'mutator' && bubbleEvent.isOpen) ||\n    !bubbleEvent.blockId\n  ) {\n    return;\n  }\n  const workspaceId = bubbleEvent.workspaceId;\n  const block = common\n    .getWorkspaceById(workspaceId)!\n    .getBlockById(bubbleEvent.blockId) as BlockSvg;\n  const type = block.type;\n  if (type !== 'procedures_defnoreturn' && type !== 'procedures_defreturn') {\n    return;\n  }\n  const workspace = (\n    block.getIcon(MutatorIcon.TYPE) as MutatorIcon\n  ).getWorkspace()!;\n  updateMutatorFlyout(workspace);\n  workspace.addChangeListener(mutatorChangeListener);\n}\n/**\n * Listens for changes in a procedure mutator and triggers flyout updates when\n * necessary.\n *\n * @param e The event that triggered this listener.\n */\nfunction mutatorChangeListener(e: Abstract) {\n  if (\n    e.type !== eventUtils.BLOCK_CREATE &&\n    e.type !== eventUtils.BLOCK_DELETE &&\n    e.type !== eventUtils.BLOCK_CHANGE &&\n    e.type !== eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE\n  ) {\n    return;\n  }\n  const workspaceId = e.workspaceId as string;\n  const workspace = common.getWorkspaceById(workspaceId) as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n}\n\n/**\n * Find all the callers of a named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to find callers in.\n * @returns Array of caller blocks.\n */\nexport function getCallers(name: string, workspace: Workspace): Block[] {\n  return workspace.getAllBlocks(false).filter((block) => {\n    return (\n      blockIsModernCallerFor(block, name) ||\n      (isLegacyProcedureCallBlock(block) &&\n        Names.equals(block.getProcedureCall(), name))\n    );\n  });\n}\n\n/**\n * @returns True if the given block is a modern-style caller block of the given\n *     procedure name.\n */\nfunction blockIsModernCallerFor(block: Block, procName: string): boolean {\n  return (\n    isProcedureBlock(block) &&\n    !block.isProcedureDef() &&\n    block.getProcedureModel() &&\n    Names.equals(block.getProcedureModel().getName(), procName)\n  );\n}\n\n/**\n * When a procedure definition changes its parameters, find and edit all its\n * callers.\n *\n * @param defBlock Procedure definition block.\n */\nexport function mutateCallers(defBlock: Block) {\n  const oldRecordUndo = eventUtils.getRecordUndo();\n  const procedureBlock = defBlock as unknown as ProcedureBlock;\n  const name = procedureBlock.getProcedureDef()[0];\n  const xmlElement = defBlock.mutationToDom!(true);\n  const callers = getCallers(name, defBlock.workspace);\n  for (let i = 0, caller; (caller = callers[i]); i++) {\n    const oldMutationDom = caller.mutationToDom!();\n    const oldMutation = oldMutationDom && utilsXml.domToText(oldMutationDom);\n    if (caller.domToMutation) {\n      caller.domToMutation(xmlElement);\n    }\n    const newMutationDom = caller.mutationToDom!();\n    const newMutation = newMutationDom && utilsXml.domToText(newMutationDom);\n    if (oldMutation !== newMutation) {\n      // Fire a mutation on every caller block.  But don't record this as an\n      // undo action since it is deterministically tied to the procedure's\n      // definition mutation.\n      eventUtils.setRecordUndo(false);\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          caller,\n          'mutation',\n          null,\n          oldMutation,\n          newMutation,\n        ),\n      );\n      eventUtils.setRecordUndo(oldRecordUndo);\n    }\n  }\n}\n\n/**\n * Find the definition block for the named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to search.\n * @returns The procedure definition block, or null not found.\n */\nexport function getDefinition(\n  name: string,\n  workspace: Workspace,\n): Block | null {\n  // Do not assume procedure is a top block. Some languages allow nested\n  // procedures. Also do not assume it is one of the built-in blocks. Only\n  // rely on isProcedureDef and getProcedureDef.\n  for (const block of workspace.getAllBlocks(false)) {\n    if (\n      isProcedureBlock(block) &&\n      block.isProcedureDef() &&\n      Names.equals(block.getProcedureModel().getName(), name)\n    ) {\n      return block;\n    }\n    if (\n      isLegacyProcedureDefBlock(block) &&\n      Names.equals(block.getProcedureDef()[0], name)\n    ) {\n      return block;\n    }\n  }\n  return null;\n}\n\nexport {\n  ObservableProcedureMap,\n  IParameterModel,\n  IProcedureBlock,\n  isProcedureBlock,\n  IProcedureMap,\n  IProcedureModel,\n  ProcedureTuple,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.ConstantProvider\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport * as parsing from '../../utils/parsing.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\n\n/** An object containing sizing and path information about outside corners. */\nexport interface OutsideCorners {\n  topLeft: string;\n  topRight: string;\n  bottomRight: string;\n  bottomLeft: string;\n  rightHeight: number;\n}\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  height: number;\n  width: number;\n  path: string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  type: number;\n  width: number;\n  height: number;\n  pathLeft: string;\n  pathRight: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  type: number;\n  width: number;\n  height: number;\n  pathDown: string;\n  pathUp: string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  path: string;\n}\n\nexport type BaseShape = {\n  type: number;\n  width: number;\n  height: number;\n};\n\n/** An object containing sizing and type information about a dynamic shape. */\nexport type DynamicShape = {\n  type: number;\n  width: (p1: number) => number;\n  height: (p1: number) => number;\n  isDynamic: true;\n  connectionOffsetY: (p1: number) => number;\n  connectionOffsetX: (p1: number) => number;\n  pathDown: (p1: number) => string;\n  pathUp: (p1: number) => string;\n  pathRightDown: (p1: number) => string;\n  pathRightUp: (p1: number) => string;\n};\n\n/** An object containing sizing and type information about a shape. */\nexport type Shape = BaseShape | DynamicShape;\n\n/**\n * Returns whether the shape is dynamic or not.\n *\n * @param shape The shape to check for dynamic-ness.\n * @returns Whether the shape is a dynamic shape or not.\n */\nexport function isDynamicShape(shape: Shape): shape is DynamicShape {\n  return (shape as DynamicShape).isDynamic;\n}\n\n/** Returns whether the shape is a puzzle tab or not. */\nexport function isPuzzleTab(shape: Shape): shape is PuzzleTab {\n  return (\n    (shape as PuzzleTab).pathDown !== undefined &&\n    (shape as PuzzleTab).pathUp !== undefined\n  );\n}\n\n/** Returns whether the shape is a notch or not. */\nexport function isNotch(shape: Shape): shape is Notch {\n  return (\n    (shape as Notch).pathLeft !== undefined &&\n    (shape as Notch).pathRight !== undefined\n  );\n}\n\n/**\n * An object that provides constants for rendering blocks.\n */\nexport class ConstantProvider {\n  /** The size of an empty spacer. */\n  NO_PADDING = 0;\n\n  /** The size of small padding. */\n  SMALL_PADDING = 3;\n\n  /** The size of medium padding. */\n  MEDIUM_PADDING = 5;\n\n  /** The size of medium-large padding. */\n  MEDIUM_LARGE_PADDING = 8;\n\n  /** The size of large padding. */\n  LARGE_PADDING = 10;\n  TALL_INPUT_FIELD_OFFSET_Y: number;\n\n  /** The height of the puzzle tab used for input and output connections. */\n  TAB_HEIGHT = 15;\n\n  /**\n   * The offset from the top of the block at which a puzzle tab is positioned.\n   */\n  TAB_OFFSET_FROM_TOP = 5;\n\n  /**\n   * Vertical overlap of the puzzle tab, used to make it look more like a\n   * puzzle piece.\n   */\n  TAB_VERTICAL_OVERLAP = 2.5;\n\n  /** The width of the puzzle tab used for input and output connections. */\n  TAB_WIDTH = 8;\n\n  /** The width of the notch used for previous and next connections. */\n  NOTCH_WIDTH = 15;\n\n  /** The height of the notch used for previous and next connections. */\n  NOTCH_HEIGHT = 4;\n\n  /** The minimum width of the block. */\n  MIN_BLOCK_WIDTH = 12;\n  EMPTY_BLOCK_SPACER_HEIGHT = 16;\n  DUMMY_INPUT_MIN_HEIGHT: number;\n  DUMMY_INPUT_SHADOW_MIN_HEIGHT: number;\n\n  /** Rounded corner radius. */\n  CORNER_RADIUS = 8;\n\n  /**\n   * Offset from the left side of a block or the inside of a statement input\n   * to the left side of the notch.\n   */\n  NOTCH_OFFSET_LEFT = 15;\n  STATEMENT_INPUT_NOTCH_OFFSET: number;\n\n  STATEMENT_BOTTOM_SPACER = 0;\n  STATEMENT_INPUT_PADDING_LEFT = 20;\n\n  /** Vertical padding between consecutive statement inputs. */\n  BETWEEN_STATEMENT_PADDING_Y = 4;\n  TOP_ROW_MIN_HEIGHT: number;\n  TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT: number;\n  BOTTOM_ROW_MIN_HEIGHT: number;\n  BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT: number;\n\n  /**\n   * Whether to add a 'hat' on top of all blocks with no previous or output\n   * connections. Can be overridden by 'hat' property on Theme.BlockStyle.\n   */\n  ADD_START_HATS = false;\n\n  /** Height of the top hat. */\n  START_HAT_HEIGHT = 15;\n\n  /** Width of the top hat. */\n  START_HAT_WIDTH = 100;\n\n  SPACER_DEFAULT_HEIGHT = 15;\n\n  MIN_BLOCK_HEIGHT = 24;\n\n  EMPTY_INLINE_INPUT_PADDING = 14.5;\n  EMPTY_INLINE_INPUT_HEIGHT: number;\n\n  EXTERNAL_VALUE_INPUT_PADDING = 2;\n  EMPTY_STATEMENT_INPUT_HEIGHT: number;\n  START_POINT: string;\n\n  /** Height of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_HEIGHT = 12;\n\n  /** Width of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_WIDTH = 6;\n\n  /** Point size of text. */\n  FIELD_TEXT_FONTSIZE = 11;\n\n  /** Text font weight. */\n  FIELD_TEXT_FONTWEIGHT = 'normal';\n\n  /** Text font family. */\n  FIELD_TEXT_FONTFAMILY = 'sans-serif';\n\n  /**\n   * Height of text.  This constant is dynamically set in\n   * `setFontConstants_` to be the height of the text based on the font\n   * used.\n   */\n  FIELD_TEXT_HEIGHT = -1; // Dynamically set.\n\n  /**\n   * Text baseline.  This constant is dynamically set in `setFontConstants_`\n   * to be the baseline of the text based on the font used.\n   */\n  FIELD_TEXT_BASELINE = -1; // Dynamically set.\n\n  /** A field's border rect corner radius. */\n  FIELD_BORDER_RECT_RADIUS = 4;\n\n  /** A field's border rect default height. */\n  FIELD_BORDER_RECT_HEIGHT = 16;\n\n  /** A field's border rect X padding. */\n  FIELD_BORDER_RECT_X_PADDING = 5;\n\n  /** A field's border rect Y padding. */\n  FIELD_BORDER_RECT_Y_PADDING = 3;\n\n  /**\n   * The backing colour of a field's border rect.\n   */\n  FIELD_BORDER_RECT_COLOUR = '#fff';\n  FIELD_TEXT_BASELINE_CENTER: boolean;\n  FIELD_DROPDOWN_BORDER_RECT_HEIGHT: number;\n\n  /**\n   * Whether or not a dropdown field should add a border rect when in a shadow\n   * block.\n   */\n  FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = false;\n\n  /**\n   * Whether or not a dropdown field's div should be coloured to match the\n   * block colours.\n   */\n  FIELD_DROPDOWN_COLOURED_DIV = false;\n\n  /** Whether or not a dropdown field uses a text or SVG arrow. */\n  FIELD_DROPDOWN_SVG_ARROW = false;\n  FIELD_DROPDOWN_SVG_ARROW_PADDING: number;\n\n  /** A dropdown field's SVG arrow size. */\n  FIELD_DROPDOWN_SVG_ARROW_SIZE = 12;\n  FIELD_DROPDOWN_SVG_ARROW_DATAURI: string;\n\n  /**\n   * Whether or not to show a box shadow around the widget div. This is only a\n   * feature of full block fields.\n   */\n  FIELD_TEXTINPUT_BOX_SHADOW = false;\n\n  /**\n   * Whether or not the colour field should display its colour value on the\n   * entire block.\n   */\n  FIELD_COLOUR_FULL_BLOCK = false;\n\n  /** A colour field's default width. */\n  FIELD_COLOUR_DEFAULT_WIDTH = 26;\n  FIELD_COLOUR_DEFAULT_HEIGHT: number;\n  FIELD_CHECKBOX_X_OFFSET: number;\n  randomIdentifier: string;\n\n  /**\n   * The defs tag that contains all filters and patterns for this Blockly\n   * instance.\n   */\n  private defs: SVGElement | null = null;\n\n  /**\n   * The ID of the emboss filter, or the empty string if no filter is set.\n   */\n  embossFilterId = '';\n\n  /** The <filter> element to use for highlighting, or null if not set. */\n  private embossFilter: SVGElement | null = null;\n\n  /**\n   * The ID of the disabled pattern, or the empty string if no pattern is set.\n   */\n  disabledPatternId = '';\n\n  /**\n   * The <pattern> element to use for disabled blocks, or null if not set.\n   */\n  private disabledPattern: SVGElement | null = null;\n\n  /**\n   * The ID of the debug filter, or the empty string if no pattern is set.\n   */\n  debugFilterId = '';\n\n  /**\n   * The <filter> element to use for a debug highlight, or null if not set.\n   */\n  private debugFilter: SVGElement | null = null;\n\n  /** The <style> element to use for injecting renderer specific CSS. */\n  private cssNode: HTMLStyleElement | null = null;\n\n  /**\n   * Cursor colour.\n   */\n  CURSOR_COLOUR = '#cc0a0a';\n\n  /**\n   * Immovable marker colour.\n   */\n  MARKER_COLOUR = '#4286f4';\n\n  /**\n   * Width of the horizontal cursor.\n   */\n  CURSOR_WS_WIDTH = 100;\n\n  /**\n   * Height of the horizontal cursor.\n   */\n  WS_CURSOR_HEIGHT = 5;\n\n  /**\n   * Padding around a stack.\n   */\n  CURSOR_STACK_PADDING = 10;\n\n  /**\n   * Padding around a block.\n   */\n  CURSOR_BLOCK_PADDING = 2;\n\n  /**\n   * Stroke of the cursor.\n   */\n  CURSOR_STROKE_WIDTH = 4;\n\n  /**\n   * Whether text input and colour fields fill up the entire source block.\n   */\n  FULL_BLOCK_FIELDS = false;\n\n  /**\n   * The main colour of insertion markers, in hex.  The block is rendered a\n   * transparent grey by changing the fill opacity in CSS.\n   */\n  INSERTION_MARKER_COLOUR = '#000000';\n\n  /**\n   * The insertion marker opacity.\n   */\n  INSERTION_MARKER_OPACITY = 0.2;\n\n  SHAPES: {[key: string]: number} = {PUZZLE: 1, NOTCH: 2};\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNERS!: InsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNERS!: OutsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n\n  blockStyles!: {[key: string]: BlockStyle};\n\n  constructor() {\n    /**\n     * Offset from the top of the row for placing fields on inline input rows\n     * and statement input rows.\n     * Matches existing rendering (in 2019).\n     */\n    this.TALL_INPUT_FIELD_OFFSET_Y = this.MEDIUM_PADDING;\n\n    /** The minimum height of a dummy input row. */\n    this.DUMMY_INPUT_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /** The minimum height of a dummy input row in a shadow block. */\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /**\n     * Additional offset added to the statement input's width to account for the\n     * notch.\n     */\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    /** The top row's minimum height. */\n    this.TOP_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The top row's minimum height if it precedes a statement. */\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The bottom row's minimum height. */\n    this.BOTTOM_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The bottom row's minimum height if it follows a statement input. */\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The height of an empty inline input. */\n    this.EMPTY_INLINE_INPUT_HEIGHT = this.TAB_HEIGHT + 11;\n\n    /**\n     * The height of an empty statement input.  Note that in the old rendering\n     * this varies slightly depending on whether the block has external or\n     * inline inputs. In the new rendering this is consistent.  It seems\n     * unlikely that the old behaviour was intentional.\n     */\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = this.MIN_BLOCK_HEIGHT;\n\n    this.START_POINT = svgPaths.moveBy(0, 0);\n\n    /**\n     * A field's text element's dominant baseline. Pre-2022 this could be false\n     * for certain browsers.\n     */\n    this.FIELD_TEXT_BASELINE_CENTER = true;\n\n    /** A dropdown field's border rect height. */\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A dropdown field's SVG arrow padding. */\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    /** A dropdown field's SVG arrow datauri. */\n    this.FIELD_DROPDOWN_SVG_ARROW_DATAURI =\n      'data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllci' +\n      'AxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaG' +\n      'VpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLW' +\n      'Fycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuND' +\n      'EsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTD' +\n      'AuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNz' +\n      'FDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMC' +\n      'wxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNz' +\n      'lhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYz' +\n      'AuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMz' +\n      'dBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=';\n\n    /** A colour field's default height. */\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A checkbox field's X offset. */\n    this.FIELD_CHECKBOX_X_OFFSET = this.FIELD_BORDER_RECT_X_PADDING - 3;\n\n    /**\n     * A random identifier used to ensure a unique ID is used for each\n     * filter/pattern for the case of multiple Blockly instances on a page.\n     */\n    this.randomIdentifier = String(Math.random()).substring(2);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about collapsed block\n     * indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /** An object containing sizing and path information about notches. */\n    this.NOTCH = this.makeNotch();\n\n    /** An object containing sizing and path information about start hats */\n    this.START_HAT = this.makeStartHat();\n\n    /**\n     * An object containing sizing and path information about puzzle tabs.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about inside corners\n     */\n    this.INSIDE_CORNERS = this.makeInsideCorners();\n\n    /**\n     * An object containing sizing and path information about outside corners.\n     */\n    this.OUTSIDE_CORNERS = this.makeOutsideCorners();\n  }\n\n  /**\n   * Refresh constants properties that depend on the theme.\n   *\n   * @param theme The current workspace theme.\n   */\n  setTheme(theme: Theme) {\n    /** The block styles map. */\n    this.blockStyles = Object.create(null);\n\n    const blockStyles = theme.blockStyles;\n    for (const key in blockStyles) {\n      this.blockStyles[key] = this.validatedBlockStyle_(blockStyles[key]);\n    }\n\n    this.setDynamicProperties_(theme);\n  }\n\n  /**\n   * Sets dynamic properties that depend on other values or theme properties.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setDynamicProperties_(theme: Theme) {\n    this.setFontConstants_(theme);\n    this.setComponentConstants_(theme);\n\n    this.ADD_START_HATS =\n      theme.startHats !== undefined ? theme.startHats : this.ADD_START_HATS;\n  }\n\n  /**\n   * Set constants related to fonts.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setFontConstants_(theme: Theme) {\n    if (theme.fontStyle && theme.fontStyle['family']) {\n      this.FIELD_TEXT_FONTFAMILY = theme.fontStyle['family'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['weight']) {\n      this.FIELD_TEXT_FONTWEIGHT = theme.fontStyle['weight'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['size']) {\n      this.FIELD_TEXT_FONTSIZE = theme.fontStyle['size'];\n    }\n\n    const fontMetrics = dom.measureFontMetrics(\n      'Hg',\n      this.FIELD_TEXT_FONTSIZE + 'pt',\n      this.FIELD_TEXT_FONTWEIGHT,\n      this.FIELD_TEXT_FONTFAMILY,\n    );\n\n    this.FIELD_TEXT_HEIGHT = fontMetrics.height;\n    this.FIELD_TEXT_BASELINE = fontMetrics.baseline;\n  }\n\n  /**\n   * Set constants from a theme's component styles.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setComponentConstants_(theme: Theme) {\n    this.CURSOR_COLOUR =\n      theme.getComponentStyle('cursorColour') || this.CURSOR_COLOUR;\n    this.MARKER_COLOUR =\n      theme.getComponentStyle('markerColour') || this.MARKER_COLOUR;\n    this.INSERTION_MARKER_COLOUR =\n      theme.getComponentStyle('insertionMarkerColour') ||\n      this.INSERTION_MARKER_COLOUR;\n    this.INSERTION_MARKER_OPACITY =\n      Number(theme.getComponentStyle('insertionMarkerOpacity')) ||\n      this.INSERTION_MARKER_OPACITY;\n  }\n\n  /**\n   * Get or create a block style based on a single colour value.  Generate a\n   * name for the style based on the colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns An object containing the style and an autogenerated name for that\n   *     style.\n   */\n  getBlockStyleForColour(colour: string): {style: BlockStyle; name: string} {\n    const name = 'auto_' + colour;\n    if (!this.blockStyles[name]) {\n      this.blockStyles[name] = this.createBlockStyle_(colour);\n    }\n    return {style: this.blockStyles[name], name};\n  }\n\n  /**\n   * Gets the BlockStyle for the given block style name.\n   *\n   * @param blockStyleName The name of the block style.\n   * @returns The named block style, or a default style if no style with the\n   *     given name was found.\n   */\n  getBlockStyle(blockStyleName: string | null): BlockStyle {\n    return (\n      this.blockStyles[blockStyleName || ''] ||\n      (blockStyleName && blockStyleName.startsWith('auto_')\n        ? this.getBlockStyleForColour(blockStyleName.substring(5)).style\n        : this.createBlockStyle_('#000000'))\n    );\n  }\n\n  /**\n   * Create a block style object based on the given colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns A populated block style based on the given colour.\n   */\n  protected createBlockStyle_(colour: string): BlockStyle {\n    return this.validatedBlockStyle_({'colourPrimary': colour});\n  }\n\n  /**\n   * Get a full block style object based on the input style object.  Populate\n   * any missing values.\n   *\n   * @param blockStyle A full or partial block style object.\n   * @returns A full block style object, with all required properties populated.\n   */\n  protected validatedBlockStyle_(blockStyle: Partial<BlockStyle>): BlockStyle {\n    // Make a new object with all of the same properties.\n    const valid = {} as BlockStyle;\n    if (blockStyle) {\n      Object.assign(valid, blockStyle);\n    }\n    // Validate required properties.\n    const parsedColour = parsing.parseBlockColour(\n      valid['colourPrimary'] || '#000',\n    );\n    valid.colourPrimary = parsedColour.hex;\n    valid.colourSecondary = valid['colourSecondary']\n      ? parsing.parseBlockColour(valid['colourSecondary']).hex\n      : this.generateSecondaryColour_(valid.colourPrimary);\n    valid.colourTertiary = valid['colourTertiary']\n      ? parsing.parseBlockColour(valid['colourTertiary']).hex\n      : this.generateTertiaryColour_(valid.colourPrimary);\n\n    valid.hat = valid['hat'] || '';\n    return valid;\n  }\n\n  /**\n   * Generate a secondary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated secondary colour.\n   */\n  protected generateSecondaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.6) || inputColour;\n  }\n\n  /**\n   * Generate a tertiary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated tertiary colour.\n   */\n  protected generateTertiaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.3) || inputColour;\n  }\n\n  /**\n   * Dispose of this constants provider.\n   * Delete all DOM elements that this provider created.\n   */\n  dispose() {\n    if (this.embossFilter) {\n      dom.removeNode(this.embossFilter);\n    }\n    if (this.disabledPattern) {\n      dom.removeNode(this.disabledPattern);\n    }\n    if (this.debugFilter) {\n      dom.removeNode(this.debugFilter);\n    }\n    this.cssNode = null;\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block indicators.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const height = this.JAGGED_TEETH_HEIGHT;\n    const width = this.JAGGED_TEETH_WIDTH;\n\n    const mainPath = svgPaths.line([\n      svgPaths.point(width, height / 4),\n      svgPaths.point(-width * 2, height / 2),\n      svgPaths.point(width, height / 4),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start hats.\n   */\n  protected makeStartHat(): StartHat {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(30, -height),\n      svgPaths.point(70, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle\n   *     tabs.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.TAB_WIDTH;\n    const height = this.TAB_HEIGHT;\n\n    /**\n     * Make the main path for the puzzle tab made out of a few curves (c and s).\n     * Those curves are defined with relative positions.  The 'up' and 'down'\n     * versions of the paths are the same, but the Y sign flips.  Forward and\n     * back are the signs to use to move the cursor in the direction that the\n     * path is being drawn.\n     *\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @returns A path fragment describing a puzzle tab.\n     */\n    function makeMainPath(up: boolean): string {\n      const forward = up ? -1 : 1;\n      const back = -forward;\n\n      const overlap = 2.5;\n      const halfHeight = height / 2;\n      const control1Y = halfHeight + overlap;\n      const control2Y = halfHeight + 0.5;\n      const control3Y = overlap; // 2.5\n\n      const endPoint1 = svgPaths.point(-width, forward * halfHeight);\n      const endPoint2 = svgPaths.point(width, forward * halfHeight);\n\n      return (\n        svgPaths.curve('c', [\n          svgPaths.point(0, forward * control1Y),\n          svgPaths.point(-width, back * control2Y),\n          endPoint1,\n        ]) +\n        svgPaths.curve('s', [\n          svgPaths.point(width, back * control3Y),\n          endPoint2,\n        ])\n      );\n    }\n\n    // c 0,-10  -8,8  -8,-7.5  s 8,2.5  8,-7.5\n    const pathUp = makeMainPath(true);\n    // c 0,10  -8,-8  -8,7.5  s 8,-2.5  8,7.5\n    const pathDown = makeMainPath(false);\n\n    return {\n      type: this.SHAPES.PUZZLE,\n      width,\n      height,\n      pathDown,\n      pathUp,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notches.\n   */\n  protected makeNotch(): Notch {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n    const innerWidth = 3;\n    const outerWidth = (width - innerWidth) / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.line([\n        svgPaths.point(dir * outerWidth, height),\n        svgPaths.point(dir * innerWidth, 0),\n        svgPaths.point(dir * outerWidth, -height),\n      ]);\n    }\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corners.\n   */\n  protected makeInsideCorners(): InsideCorners {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerBottomLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corners.\n   */\n  protected makeOutsideCorners(): OutsideCorners {\n    const radius = this.CORNER_RADIUS;\n    /** SVG path for drawing the rounded top-left corner. */\n    const topLeft =\n      svgPaths.moveBy(0, radius) +\n      svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, -radius));\n\n    /** SVG path for drawing the rounded top-right corner. */\n    const topRight = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    /** SVG path for drawing the rounded bottom-left corner. */\n    const bottomLeft = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, -radius),\n    );\n\n    /** SVG path for drawing the rounded bottom-right corner. */\n    const bottomRight = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    return {\n      topLeft,\n      topRight,\n      bottomRight,\n      bottomLeft,\n      rightHeight: radius,\n    };\n  }\n\n  /**\n   * Get an object with connection shape and sizing information based on the\n   * type of the connection.\n   *\n   * @param connection The connection to find a shape object for\n   * @returns The shape object for the connection.\n   */\n  shapeFor(connection: RenderedConnection): Shape {\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        return this.PUZZLE_TAB;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH;\n      default:\n        throw Error('Unknown connection type');\n    }\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs (filters, patterns, etc).\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param tagName The name to use for the CSS style tag.\n   * @param selector The CSS selector to use.\n   */\n  createDom(svg: SVGElement, tagName: string, selector: string) {\n    this.injectCSS_(tagName, selector);\n\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    this.defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    /*\n          <filter id=\"blocklyEmbossFilter837493\">\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"1\" result=\"blur\" />\n            <feSpecularLighting in=\"blur\" surfaceScale=\"1\"\n       specularConstant=\"0.5\" specularExponent=\"10\" lighting-color=\"white\"\n                                result=\"specOut\">\n              <fePointLight x=\"-5000\" y=\"-10000\" z=\"20000\" />\n            </feSpecularLighting>\n            <feComposite in=\"specOut\" in2=\"SourceAlpha\" operator=\"in\"\n                         result=\"specOut\" />\n            <feComposite in=\"SourceGraphic\" in2=\"specOut\" operator=\"arithmetic\"\n                         k1=\"0\" k2=\"1\" k3=\"1\" k4=\"0\" />\n          </filter>\n        */\n    const embossFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {'id': 'blocklyEmbossFilter' + this.randomIdentifier},\n      this.defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceAlpha', 'stdDeviation': 1, 'result': 'blur'},\n      embossFilter,\n    );\n    const feSpecularLighting = dom.createSvgElement(\n      Svg.FESPECULARLIGHTING,\n      {\n        'in': 'blur',\n        'surfaceScale': 1,\n        'specularConstant': 0.5,\n        'specularExponent': 10,\n        'lighting-color': 'white',\n        'result': 'specOut',\n      },\n      embossFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEPOINTLIGHT,\n      {'x': -5000, 'y': -10000, 'z': 20000},\n      feSpecularLighting,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'specOut',\n        'in2': 'SourceAlpha',\n        'operator': 'in',\n        'result': 'specOut',\n      },\n      embossFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'SourceGraphic',\n        'in2': 'specOut',\n        'operator': 'arithmetic',\n        'k1': 0,\n        'k2': 1,\n        'k3': 1,\n        'k4': 0,\n      },\n      embossFilter,\n    );\n    this.embossFilterId = embossFilter.id;\n    this.embossFilter = embossFilter;\n\n    /*\n          <pattern id=\"blocklyDisabledPattern837493\"\n       patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"> <rect width=\"10\"\n       height=\"10\" fill=\"#aaa\" /> <path d=\"M 0 0 L 10 10 M 10 0 L 0 10\"\n       stroke=\"#cc0\" />\n          </pattern>\n        */\n    const disabledPattern = dom.createSvgElement(\n      Svg.PATTERN,\n      {\n        'id': 'blocklyDisabledPattern' + this.randomIdentifier,\n        'patternUnits': 'userSpaceOnUse',\n        'width': 10,\n        'height': 10,\n      },\n      this.defs,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': 10, 'height': 10, 'fill': '#aaa'},\n      disabledPattern,\n    );\n    dom.createSvgElement(\n      Svg.PATH,\n      {'d': 'M 0 0 L 10 10 M 10 0 L 0 10', 'stroke': '#cc0'},\n      disabledPattern,\n    );\n    this.disabledPatternId = disabledPattern.id;\n    this.disabledPattern = disabledPattern;\n\n    this.createDebugFilter();\n  }\n\n  /**\n   * Create a filter for highlighting the currently rendering block during\n   * render debugging.\n   */\n  private createDebugFilter() {\n    // Only create the debug filter once.\n    if (!this.debugFilter) {\n      const debugFilter = dom.createSvgElement(\n        Svg.FILTER,\n        {\n          'id': 'blocklyDebugFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        this.defs,\n      );\n      // Set all gaussian blur pixels to 1 opacity before applying flood\n      const debugComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER,\n        {'result': 'outBlur'},\n        debugFilter,\n      );\n      dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        debugComponentTransfer,\n      );\n      // Color the highlight\n      dom.createSvgElement(\n        Svg.FEFLOOD,\n        {\n          'flood-color': '#ff0000',\n          'flood-opacity': 0.5,\n          'result': 'outColor',\n        },\n        debugFilter,\n      );\n      dom.createSvgElement(\n        Svg.FECOMPOSITE,\n        {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        debugFilter,\n      );\n      this.debugFilterId = debugFilter.id;\n      this.debugFilter = debugFilter;\n    }\n  }\n\n  /**\n   * Inject renderer specific CSS into the page.\n   *\n   * @param tagName The name of the style tag to use.\n   * @param selector The CSS selector to use.\n   */\n  protected injectCSS_(tagName: string, selector: string) {\n    const cssArray = this.getCSS_(selector);\n    const cssNodeId = 'blockly-renderer-style-' + tagName;\n    this.cssNode = document.getElementById(cssNodeId) as HTMLStyleElement;\n    const text = cssArray.join('\\n');\n    if (this.cssNode) {\n      // Already injected, update if the theme changed.\n      this.cssNode.firstChild!.textContent = text;\n      return;\n    }\n    // Inject CSS tag at start of head.\n    const cssNode = document.createElement('style');\n    cssNode.id = cssNodeId;\n    const cssTextNode = document.createTextNode(text);\n    cssNode.appendChild(cssTextNode);\n    document.head.insertBefore(cssNode, document.head.firstChild);\n    this.cssNode = cssNode;\n  }\n\n  /**\n   * Get any renderer specific CSS to inject when the renderer is initialized.\n   *\n   * @param selector CSS selector to use.\n   * @returns Array of CSS strings.\n   */\n  protected getCSS_(selector: string): string[] {\n    // prettier-ignore\n    return [\n      // Text.\n      `${selector} .blocklyText, `,\n      `${selector} .blocklyFlyoutLabelText {`,\n        `font: ${this.FIELD_TEXT_FONTWEIGHT} ` +\n            `${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n        `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect,`,\n      `${selector} .blocklyEditableText>rect {`,\n        `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n        `fill-opacity: .6;`,\n        `stroke: none;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text {`,\n        `fill: #000;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyEditableText:not(.editing):hover>rect {`,\n        `stroke: #fff;`,\n        `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n        `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n        `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `}`,\n\n      // Selection highlight.\n      `${selector} .blocklySelected>.blocklyPath {`,\n        `stroke: #fc3;`,\n        `stroke-width: 3px;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n        `stroke: #fc3;`,\n      `}`,\n\n      // Replaceable highlight.\n      `${selector} .blocklyReplaceable .blocklyPath {`,\n        `fill-opacity: .5;`,\n      `}`,\n      `${selector} .blocklyReplaceable .blocklyPathLight,`,\n      `${selector} .blocklyReplaceable .blocklyPathDark {`,\n        `display: none;`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n        `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n        `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Connection\n\nimport type {Block} from './block.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a connection between blocks.\n */\nexport class Connection implements IASTNodeLocationWithBlock {\n  /** Constants for checking whether two connections are compatible. */\n  static CAN_CONNECT = 0;\n  static REASON_SELF_CONNECTION = 1;\n  static REASON_WRONG_TYPE = 2;\n  static REASON_TARGET_NULL = 3;\n  static REASON_CHECKS_FAILED = 4;\n  static REASON_DIFFERENT_WORKSPACES = 5;\n  static REASON_SHADOW_PARENT = 6;\n  static REASON_DRAG_CHECKS_FAILED = 7;\n  static REASON_PREVIOUS_AND_OUTPUT = 8;\n\n  protected sourceBlock_: Block;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  targetConnection: Connection | null = null;\n\n  /**\n   * Has this connection been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** List of compatible value types.  Null if all types are compatible. */\n  private check: string[] | null = null;\n\n  /** DOM representation of a shadow block, or null if none. */\n  private shadowDom: Element | null = null;\n\n  /**\n   * Horizontal location of this connection.\n   *\n   * @internal\n   */\n  x = 0;\n\n  /**\n   * Vertical location of this connection.\n   *\n   * @internal\n   */\n  y = 0;\n\n  private shadowState: blocks.State | null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(\n    source: Block,\n    public type: number,\n  ) {\n    this.sourceBlock_ = source;\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected connect_(childConnection: Connection) {\n    const INPUT = ConnectionType.INPUT_VALUE;\n    const parentBlock = this.getSourceBlock();\n    const childBlock = childConnection.getSourceBlock();\n\n    // Make sure the childConnection is available.\n    if (childConnection.isConnected()) {\n      childConnection.disconnectInternal(false);\n    }\n\n    // Make sure the parentConnection is available.\n    let orphan;\n    if (this.isConnected()) {\n      const shadowState = this.stashShadowState();\n      const target = this.targetBlock();\n      if (target!.isShadow()) {\n        target!.dispose(false);\n      } else {\n        this.disconnectInternal();\n        orphan = target;\n      }\n      this.applyShadowState(shadowState);\n    }\n\n    // Connect the new connection to the parent.\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n        childBlock,\n      ) as BlockMove;\n      event.setReason(['connect']);\n    }\n    connectReciprocally(this, childConnection);\n    childBlock.setParent(parentBlock);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    // Deal with the orphan if it exists.\n    if (orphan) {\n      const orphanConnection =\n        this.type === INPUT\n          ? orphan.outputConnection\n          : orphan.previousConnection;\n      if (!orphanConnection) return;\n      const connection = Connection.getConnectionForOrphanedConnection(\n        childBlock,\n        orphanConnection,\n      );\n      if (connection) {\n        orphanConnection.connect(connection);\n      } else {\n        orphanConnection.onFailedConnect(this);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this connection and deal with connected blocks.\n   *\n   * @internal\n   */\n  dispose() {\n    // isConnected returns true for shadows and non-shadows.\n    if (this.isConnected()) {\n      if (this.isSuperior()) {\n        // Destroy the attached shadow block & its children (if it exists).\n        this.setShadowStateInternal();\n      }\n\n      const targetBlock = this.targetBlock();\n      if (targetBlock && !targetBlock.isDeadOrDying()) {\n        // Disconnect the attached normal block.\n        targetBlock.unplug();\n      }\n    }\n\n    this.disposed = true;\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Does the connection belong to a superior block (higher in the source\n   * stack)?\n   *\n   * @returns True if connection faces down or right.\n   */\n  isSuperior(): boolean {\n    return (\n      this.type === ConnectionType.INPUT_VALUE ||\n      this.type === ConnectionType.NEXT_STATEMENT\n    );\n  }\n\n  /**\n   * Is the connection connected?\n   *\n   * @returns True if connection is connected to another connection.\n   */\n  isConnected(): boolean {\n    return !!this.targetConnection;\n  }\n\n  /**\n   * Get the workspace's connection type checker object.\n   *\n   * @returns The connection type checker for the source block's workspace.\n   * @internal\n   */\n  getConnectionChecker(): IConnectionChecker {\n    return this.sourceBlock_.workspace.connectionChecker;\n  }\n\n  /**\n   * Called when an attempted connection fails. NOP by default (i.e. for\n   * headless workspaces).\n   *\n   * @param _otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  onFailedConnect(_otherConnection: Connection) {}\n  // NOP\n\n  /**\n   * Connect this connection to another connection.\n   *\n   * @param otherConnection Connection to connect to.\n   * @returns Whether the blocks are now connected or not.\n   */\n  connect(otherConnection: Connection): boolean {\n    if (this.targetConnection === otherConnection) {\n      // Already connected together.  NOP.\n      return true;\n    }\n\n    const checker = this.getConnectionChecker();\n    if (checker.canConnect(this, otherConnection, false)) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      // Determine which block is superior (higher in the source stack).\n      if (this.isSuperior()) {\n        // Superior block.\n        this.connect_(otherConnection);\n      } else {\n        // Inferior block.\n        otherConnection.connect_(this);\n      }\n      eventUtils.setGroup(existingGroup);\n    }\n\n    return this.isConnected();\n  }\n\n  /**\n   * Disconnect this connection.\n   */\n  disconnect() {\n    this.disconnectInternal();\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  protected disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n      this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) {\n      throw Error('Source connection not connected.');\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n        childConnection.getSourceBlock(),\n      ) as BlockMove;\n      event.setReason(['disconnect']);\n    }\n    const otherConnection = this.targetConnection;\n    if (otherConnection) {\n      otherConnection.targetConnection = null;\n    }\n    this.targetConnection = null;\n    if (setParent) childConnection.getSourceBlock().setParent(null);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    if (!childConnection.getSourceBlock().isShadow()) {\n      // If we were disconnecting a shadow, no need to spawn a new one.\n      parentConnection.respawnShadow_();\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * Returns the parent connection (superior) and child connection (inferior)\n   * given this connection and the connection it is connected to.\n   *\n   * @returns The parent connection and child connection, given this connection\n   *     and the connection it is connected to.\n   */\n  protected getParentAndChildConnections(): {\n    parentConnection?: Connection;\n    childConnection?: Connection;\n  } {\n    if (!this.targetConnection) return {};\n    if (this.isSuperior()) {\n      return {\n        parentConnection: this,\n        childConnection: this.targetConnection,\n      };\n    }\n    return {\n      parentConnection: this.targetConnection,\n      childConnection: this,\n    };\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   */\n  protected respawnShadow_() {\n    // Have to keep respawnShadow_ for backwards compatibility.\n    this.createShadowBlock(true);\n  }\n\n  /**\n   * Reconnects this connection to the input with the given name on the given\n   * block. If there is already a connection connected to that input, that\n   * connection is disconnected.\n   *\n   * @param block The block to connect this connection to.\n   * @param inputName The name of the input to connect this connection to.\n   * @returns True if this connection was able to connect, false otherwise.\n   */\n  reconnect(block: Block, inputName: string): boolean {\n    // No need to reconnect if this connection's block is deleted.\n    if (this.getSourceBlock().isDeadOrDying()) return false;\n\n    const connectionParent = block.getInput(inputName)?.connection;\n    const currentParent = this.targetBlock();\n    if (\n      (!currentParent || currentParent === block) &&\n      connectionParent &&\n      connectionParent.targetConnection !== this\n    ) {\n      if (connectionParent.isConnected()) {\n        // There's already something connected here.  Get rid of it.\n        connectionParent.disconnect();\n      }\n      connectionParent.connect(this);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  targetBlock(): Block | null {\n    if (this.isConnected()) {\n      return this.targetConnection?.getSourceBlock() ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (\n      this.isConnected() &&\n      (!this.targetConnection ||\n        !this.getConnectionChecker().canConnect(\n          this,\n          this.targetConnection,\n          false,\n        ))\n    ) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  setCheck(check: string | string[] | null): Connection {\n    if (check) {\n      if (!Array.isArray(check)) {\n        check = [check];\n      }\n      this.check = check;\n      this.onCheckChanged_();\n    } else {\n      this.check = null;\n    }\n    return this;\n  }\n\n  /**\n   * Get a connection's compatibility.\n   *\n   * @returns List of compatible value types.\n   *     Null if all types are compatible.\n   */\n  getCheck(): string[] | null {\n    return this.check;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowDom DOM representation of a block or null.\n   */\n  setShadowDom(shadowDom: Element | null) {\n    this.setShadowStateInternal({shadowDom});\n  }\n\n  /**\n   * Returns the xml representation of the connection's shadow block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved shadowDom is\n   *     just returned.\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(returnCurrent?: boolean): Element | null {\n    return returnCurrent && this.targetBlock()!.isShadow()\n      ? (Xml.blockToDom(this.targetBlock() as Block) as Element)\n      : this.shadowDom;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowState An state represetation of the block or null.\n   */\n  setShadowState(shadowState: blocks.State | null) {\n    this.setShadowStateInternal({shadowState});\n  }\n\n  /**\n   * Returns the serialized object representation of the connection's shadow\n   * block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved state is just\n   *     returned.\n   * @returns Serialized object representation of the block, or null.\n   */\n  getShadowState(returnCurrent?: boolean): blocks.State | null {\n    if (returnCurrent && this.targetBlock() && this.targetBlock()!.isShadow()) {\n      return blocks.save(this.targetBlock() as Block);\n    }\n    return this.shadowState;\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * Headless configurations (the default) do not have neighboring connection,\n   * and always return an empty list (the default).\n   * {@link RenderedConnection#neighbours} overrides this behavior with a list\n   * computed from the rendered positioning.\n   *\n   * @param _maxLimit The maximum radius to another connection.\n   * @returns List of connections.\n   * @internal\n   */\n  neighbours(_maxLimit: number): Connection[] {\n    return [];\n  }\n\n  /**\n   * Get the parent input of a connection.\n   *\n   * @returns The input that the connection belongs to or null if no parent\n   *     exists.\n   * @internal\n   */\n  getParentInput(): Input | null {\n    let parentInput = null;\n    const inputs = this.sourceBlock_.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      if (inputs[i].connection === this) {\n        parentInput = inputs[i];\n        break;\n      }\n    }\n    return parentInput;\n  }\n\n  /**\n   * This method returns a string describing this Connection in developer terms\n   * (English only). Intended to on be used in console logs and errors.\n   *\n   * @returns The description.\n   */\n  toString(): string {\n    const block = this.sourceBlock_;\n    if (!block) {\n      return 'Orphan Connection';\n    }\n    let msg;\n    if (block.outputConnection === this) {\n      msg = 'Output Connection of ';\n    } else if (block.previousConnection === this) {\n      msg = 'Previous Connection of ';\n    } else if (block.nextConnection === this) {\n      msg = 'Next Connection of ';\n    } else {\n      let parentInput = null;\n      for (let i = 0, input; (input = block.inputList[i]); i++) {\n        if (input.connection === this) {\n          parentInput = input;\n          break;\n        }\n      }\n      if (parentInput) {\n        msg = 'Input \"' + parentInput.name + '\" connection on ';\n      } else {\n        console.warn('Connection not actually connected to sourceBlock_');\n        return 'Orphan Connection';\n      }\n    }\n    return msg + block.toDevString();\n  }\n\n  /**\n   * Returns the state of the shadowDom_ and shadowState_ properties, then\n   * temporarily sets those properties to null so no shadow respawns.\n   *\n   * @returns The state of both the shadowDom_ and shadowState_ properties.\n   */\n  private stashShadowState(): {\n    shadowDom: Element | null;\n    shadowState: blocks.State | null;\n  } {\n    const shadowDom = this.getShadowDom(true);\n    const shadowState = this.getShadowState(true);\n    // Set to null so it doesn't respawn.\n    this.shadowDom = null;\n    this.shadowState = null;\n    return {shadowDom, shadowState};\n  }\n\n  /**\n   * Reapplies the stashed state of the shadowDom_ and shadowState_ properties.\n   *\n   * @param param0 The state to reapply to the shadowDom_ and shadowState_\n   *     properties.\n   */\n  private applyShadowState({\n    shadowDom,\n    shadowState,\n  }: {\n    shadowDom: Element | null;\n    shadowState: blocks.State | null;\n  }) {\n    this.shadowDom = shadowDom;\n    this.shadowState = shadowState;\n  }\n\n  /**\n   * Sets the state of the shadow of this connection.\n   *\n   * @param param0 The state to set the shadow of this connection to.\n   */\n  private setShadowStateInternal({\n    shadowDom = null,\n    shadowState = null,\n  }: {\n    shadowDom?: Element | null;\n    shadowState?: blocks.State | null;\n  } = {}) {\n    // One or both of these should always be null.\n    // If neither is null, the shadowState will get priority.\n    this.shadowDom = shadowDom;\n    this.shadowState = shadowState;\n\n    if (this.getSourceBlock().isDeadOrDying()) return;\n\n    const target = this.targetBlock();\n    if (!target) {\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow(this.targetBlock());\n      }\n    } else if (target.isShadow()) {\n      target.dispose(false);\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow(this.targetBlock());\n      }\n    } else {\n      const shadow = this.createShadowBlock(false);\n      this.serializeShadow(shadow);\n      if (shadow) {\n        shadow.dispose(false);\n      }\n    }\n  }\n\n  /**\n   * Creates a shadow block based on the current shadowState_ or shadowDom_.\n   * shadowState_ gets priority.\n   *\n   * @param attemptToConnect Whether to try to connect the shadow block to this\n   *     connection or not.\n   * @returns The shadow block that was created, or null if both the\n   *     shadowState_ and shadowDom_ are null.\n   */\n  private createShadowBlock(attemptToConnect: boolean): Block | null {\n    const parentBlock = this.getSourceBlock();\n    const shadowState = this.getShadowState();\n    const shadowDom = this.getShadowDom();\n    if (parentBlock.isDeadOrDying() || (!shadowState && !shadowDom)) {\n      return null;\n    }\n\n    let blockShadow;\n    if (shadowState) {\n      blockShadow = blocks.appendInternal(shadowState, parentBlock.workspace, {\n        parentConnection: attemptToConnect ? this : undefined,\n        isShadow: true,\n        recordUndo: false,\n      });\n      return blockShadow;\n    }\n\n    if (shadowDom) {\n      blockShadow = Xml.domToBlockInternal(shadowDom, parentBlock.workspace);\n      if (attemptToConnect) {\n        if (this.type === ConnectionType.INPUT_VALUE) {\n          if (!blockShadow.outputConnection) {\n            throw new Error('Shadow block is missing an output connection');\n          }\n          if (!this.connect(blockShadow.outputConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else if (this.type === ConnectionType.NEXT_STATEMENT) {\n          if (!blockShadow.previousConnection) {\n            throw new Error('Shadow block is missing previous connection');\n          }\n          if (!this.connect(blockShadow.previousConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else {\n          throw new Error(\n            'Cannot connect a shadow block to a previous/output connection',\n          );\n        }\n      }\n      return blockShadow;\n    }\n    return null;\n  }\n\n  /**\n   * Saves the given shadow block to both the shadowDom_ and shadowState_\n   * properties, in their respective serialized forms.\n   *\n   * @param shadow The shadow to serialize, or null.\n   */\n  private serializeShadow(shadow: Block | null) {\n    if (!shadow) {\n      return;\n    }\n    this.shadowDom = Xml.blockToDom(shadow) as Element;\n    this.shadowState = blocks.save(shadow);\n  }\n\n  /**\n   * Returns the connection (starting at the startBlock) which will accept\n   * the given connection. This includes compatible connection types and\n   * connection checks.\n   *\n   * @param startBlock The block on which to start the search.\n   * @param orphanConnection The connection that is looking for a home.\n   * @returns The suitable connection point on the chain of blocks, or null.\n   */\n  static getConnectionForOrphanedConnection(\n    startBlock: Block,\n    orphanConnection: Connection,\n  ): Connection | null {\n    if (orphanConnection.type === ConnectionType.OUTPUT_VALUE) {\n      return getConnectionForOrphanedOutput(\n        startBlock,\n        orphanConnection.getSourceBlock(),\n      );\n    }\n    // Otherwise we're dealing with a stack.\n    const connection = startBlock.lastConnectionInStack(true);\n    const checker = orphanConnection.getConnectionChecker();\n    if (connection && checker.canConnect(orphanConnection, connection, false)) {\n      return connection;\n    }\n    return null;\n  }\n}\n\n/**\n * Update two connections to target each other.\n *\n * @param first The first connection to update.\n * @param second The second connection to update.\n */\nfunction connectReciprocally(first: Connection, second: Connection) {\n  if (!first || !second) {\n    throw Error('Cannot connect null connections.');\n  }\n  first.targetConnection = second;\n  second.targetConnection = first;\n}\n/**\n * Returns the single connection on the block that will accept the orphaned\n * block, if one can be found. If the block has multiple compatible connections\n * (even if they are filled) this returns null. If the block has no compatible\n * connections, this returns null.\n *\n * @param block The superior block.\n * @param orphanBlock The inferior block.\n * @returns The suitable connection point on 'block', or null.\n */\nfunction getSingleConnection(\n  block: Block,\n  orphanBlock: Block,\n): Connection | null {\n  let foundConnection = null;\n  const output = orphanBlock.outputConnection;\n  const typeChecker = output?.getConnectionChecker();\n\n  for (let i = 0, input; (input = block.inputList[i]); i++) {\n    const connection = input.connection;\n    if (connection && typeChecker?.canConnect(output, connection, false)) {\n      if (foundConnection) {\n        return null; // More than one connection.\n      }\n      foundConnection = connection;\n    }\n  }\n  return foundConnection;\n}\n\n/**\n * Walks down a row a blocks, at each stage checking if there are any\n * connections that will accept the orphaned block.  If at any point there\n * are zero or multiple eligible connections, returns null.  Otherwise\n * returns the only input on the last block in the chain.\n * Terminates early for shadow blocks.\n *\n * @param startBlock The block on which to start the search.\n * @param orphanBlock The block that is looking for a home.\n * @returns The suitable connection point on the chain of blocks, or null.\n */\nfunction getConnectionForOrphanedOutput(\n  startBlock: Block,\n  orphanBlock: Block,\n): Connection | null {\n  let newBlock: Block | null = startBlock;\n  let connection;\n  while ((connection = getSingleConnection(newBlock, orphanBlock))) {\n    newBlock = connection.targetBlock();\n    if (!newBlock || newBlock.isShadow()) {\n      return connection;\n    }\n  }\n  return null;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IconType} from '../icons/icon_types.js';\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {Size} from '../utils/size.js';\n\nexport interface IIcon {\n  /**\n   * @returns the IconType representing the type of the icon. This value should\n   *     also be used to register the icon via `Blockly.icons.registry.register`.\n   */\n  getType(): IconType<IIcon>;\n\n  /**\n   * Creates the SVG elements for the icon that will live on the block.\n   *\n   * @param pointerdownListener An event listener that must be attached to the\n   *     root SVG element by the implementation of `initView`. Used by Blockly's\n   *     gesture system to properly handle clicks and drags.\n   */\n  initView(pointerdownListener: (e: PointerEvent) => void): void;\n\n  /**\n   * Disposes of any elements of the icon.\n   *\n   * @remarks\n   *\n   * In particular, if this icon is currently showing a bubble, this should be\n   * used to hide it.\n   */\n  dispose(): void;\n\n  /**\n   * @returns the \"weight\" of the icon, which determines the static order which\n   *     icons should be rendered in. More positive numbers are rendered farther\n   *     toward the end of the block.\n   */\n  getWeight(): number;\n\n  /** @returns The dimensions of the icon for use in rendering. */\n  getSize(): Size;\n\n  /** Updates the icon's color when the block's color changes.. */\n  applyColour(): void;\n\n  /** Hides the icon when it is part of an insertion marker. */\n  hideForInsertionMarker(): void;\n\n  /** Updates the icon's editability when the block's editability changes. */\n  updateEditable(): void;\n\n  /**\n   * Updates the icon's collapsed-ness/view when the block's collapsed-ness\n   * changes.\n   */\n  updateCollapsed(): void;\n\n  /**\n   * @returns Whether this icon is shown when the block is collapsed. Used\n   *     to allow renderers to account for padding.\n   */\n  isShownWhenCollapsed(): boolean;\n\n  /**\n   * Notifies the icon where it is relative to its block's top-start, in\n   * workspace units.\n   */\n  setOffsetInBlock(offset: Coordinate): void;\n\n  /**\n   * Notifies the icon that it has changed locations.\n   *\n   * @param blockOrigin The location of this icon's block's top-start corner\n   *     in workspace coordinates.\n   */\n  onLocationChange(blockOrigin: Coordinate): void;\n\n  /**\n   * Notifies the icon that it has been clicked.\n   */\n  onClick(): void;\n\n  /**\n   * Check whether the icon should be clickable while the block is in a flyout.\n   * If this function is not defined, the icon will be clickable in all flyouts.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the icon should be clickable while the block is in a flyout.\n   */\n  isClickableInFlyout?(autoClosingFlyout: boolean): boolean;\n}\n\n/** Type guard that checks whether the given object is an IIcon. */\nexport function isIcon(obj: any): obj is IIcon {\n  return (\n    obj.getType !== undefined &&\n    obj.initView !== undefined &&\n    obj.dispose !== undefined &&\n    obj.getWeight !== undefined &&\n    obj.getSize !== undefined &&\n    obj.applyColour !== undefined &&\n    obj.hideForInsertionMarker !== undefined &&\n    obj.updateEditable !== undefined &&\n    obj.updateCollapsed !== undefined &&\n    obj.isShownWhenCollapsed !== undefined &&\n    obj.setOffsetInBlock !== undefined &&\n    obj.onLocationChange !== undefined &&\n    obj.onClick !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IconType} from '../icons/icon_types.js';\nimport {CommentState} from '../icons/comment_icon.js';\nimport {IIcon, isIcon} from './i_icon.js';\nimport {Size} from '../utils/size.js';\nimport {IHasBubble, hasBubble} from './i_has_bubble.js';\nimport {ISerializable, isSerializable} from './i_serializable.js';\n\nexport interface ICommentIcon extends IIcon, IHasBubble, ISerializable {\n  setText(text: string): void;\n\n  getText(): string;\n\n  setBubbleSize(size: Size): void;\n\n  getBubbleSize(): Size;\n\n  saveState(): CommentState;\n\n  loadState(state: CommentState): void;\n}\n\n/** Checks whether the given object is an ICommentIcon. */\nexport function isCommentIcon(obj: Object): obj is ICommentIcon {\n  return (\n    isIcon(obj) &&\n    hasBubble(obj) &&\n    isSerializable(obj) &&\n    (obj as any)['setText'] !== undefined &&\n    (obj as any)['getText'] !== undefined &&\n    (obj as any)['setBubbleSize'] !== undefined &&\n    (obj as any)['getBubbleSize'] !== undefined &&\n    obj.getType() === IconType.COMMENT\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an AST node.\n * Used to traverse the Blockly AST.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ASTNode\n\nimport {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport type {Input} from '../inputs/input.js';\nimport type {IASTNodeLocation} from '../interfaces/i_ast_node_location.js';\nimport type {IASTNodeLocationWithBlock} from '../interfaces/i_ast_node_location_with_block.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\nimport {FlyoutButton} from '../flyout_button.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {FlyoutItem} from '../flyout_base.js';\n\n/**\n * Class for an AST node.\n * It is recommended that you use one of the createNode methods instead of\n * creating a node directly.\n */\nexport class ASTNode {\n  /**\n   * True to navigate to all fields. False to only navigate to clickable fields.\n   */\n  static NAVIGATE_ALL_FIELDS = false;\n\n  /**\n   * The default y offset to use when moving the cursor from a stack to the\n   * workspace.\n   */\n  private static readonly DEFAULT_OFFSET_Y: number = -20;\n  private readonly type: string;\n  private readonly isConnectionLocation: boolean;\n  private readonly location: IASTNodeLocation;\n\n  /** The coordinate on the workspace. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Coordinate'.\n  private wsCoordinate: Coordinate = null as AnyDuringMigration;\n\n  /**\n   * @param type The type of the location.\n   *     Must be in ASTNode.types.\n   * @param location The position in the AST.\n   * @param opt_params Optional dictionary of options.\n   */\n  constructor(type: string, location: IASTNodeLocation, opt_params?: Params) {\n    if (!location) {\n      throw Error('Cannot create a node without a location.');\n    }\n\n    /**\n     * The type of the location.\n     * One of ASTNode.types\n     */\n    this.type = type;\n\n    /** Whether the location points to a connection. */\n    this.isConnectionLocation = ASTNode.isConnectionType(type);\n\n    /** The location of the AST node. */\n    this.location = location;\n\n    this.processParams(opt_params || null);\n  }\n\n  /**\n   * Parse the optional parameters.\n   *\n   * @param params The user specified parameters.\n   */\n  private processParams(params: Params | null) {\n    if (!params) {\n      return;\n    }\n    if (params.wsCoordinate) {\n      this.wsCoordinate = params.wsCoordinate;\n    }\n  }\n\n  /**\n   * Gets the value pointed to by this node.\n   * It is the callers responsibility to check the node type to figure out what\n   * type of object they get back from this.\n   *\n   * @returns The current field, connection, workspace, or block the cursor is\n   *     on.\n   */\n  getLocation(): IASTNodeLocation {\n    return this.location;\n  }\n\n  /**\n   * The type of the current location.\n   * One of ASTNode.types\n   *\n   * @returns The type of the location.\n   */\n  getType(): string {\n    return this.type;\n  }\n\n  /**\n   * The coordinate on the workspace.\n   *\n   * @returns The workspace coordinate or null if the location is not a\n   *     workspace.\n   */\n  getWsCoordinate(): Coordinate {\n    return this.wsCoordinate;\n  }\n\n  /**\n   * Whether the node points to a connection.\n   *\n   * @returns [description]\n   * @internal\n   */\n  isConnection(): boolean {\n    return this.isConnectionLocation;\n  }\n\n  /**\n   * Given an input find the next editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the next field or connection or null if there\n   *     is no editable field or input connection after the given input.\n   */\n  private findNextForInput(): ASTNode | null {\n    const location = this.location as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx + 1; i < block!.inputList.length; i++) {\n      const input = block!.inputList[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the next editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node pointing to the next field or connection or null if\n   *     there is no editable field or input connection after the given input.\n   */\n  private findNextForField(): ASTNode | null {\n    const location = this.location as Field;\n    const input = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n        'The current AST location is not associated with a block',\n      );\n    }\n    const curIdx = block.inputList.indexOf(input);\n    let fieldIdx = input.fieldRow.indexOf(location) + 1;\n    for (let i = curIdx; i < block.inputList.length; i++) {\n      const newInput = block.inputList[i];\n      const fieldRow = newInput.fieldRow;\n      while (fieldIdx < fieldRow.length) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx++;\n      }\n      fieldIdx = 0;\n      if (newInput.connection) {\n        return ASTNode.createInputNode(newInput);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given an input find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the previous field or connection.\n   */\n  private findPrevForInput(): ASTNode | null {\n    const location = this.location as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block!.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      for (let j = fieldRow.length - 1; j >= 0; j--) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node holding the previous input or field.\n   */\n  private findPrevForField(): ASTNode | null {\n    const location = this.location as Field;\n    const parentInput = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n        'The current AST location is not associated with a block',\n      );\n    }\n    const curIdx = block.inputList.indexOf(parentInput);\n    let fieldIdx = parentInput.fieldRow.indexOf(location) - 1;\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      while (fieldIdx > -1) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx--;\n      }\n      // Reset the fieldIdx to the length of the field row of the previous\n      // input.\n      if (i - 1 >= 0) {\n        fieldIdx = block.inputList[i - 1].fieldRow.length - 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Navigate between stacks of blocks on the workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The first block of the next stack or null if there are no blocks\n   *     on the workspace.\n   */\n  private navigateBetweenStacks(forward: boolean): ASTNode | null {\n    let curLocation = this.getLocation();\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    if ((curLocation as IASTNodeLocationWithBlock).getSourceBlock) {\n      const block = (curLocation as IASTNodeLocationWithBlock).getSourceBlock();\n      if (block) {\n        curLocation = block;\n      }\n    }\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    const curLocationAsBlock = curLocation as Block;\n    if (!curLocationAsBlock || curLocationAsBlock.isDeadOrDying()) {\n      return null;\n    }\n    if (curLocationAsBlock.workspace.isFlyout) {\n      return this.navigateFlyoutContents(forward);\n    }\n    const curRoot = curLocationAsBlock.getRootBlock();\n    const topBlocks = curRoot.workspace.getTopBlocks(true);\n    for (let i = 0; i < topBlocks.length; i++) {\n      const topBlock = topBlocks[i];\n      if (curRoot.id === topBlock.id) {\n        const offset = forward ? 1 : -1;\n        const resultIndex = i + offset;\n        if (resultIndex === -1 || resultIndex === topBlocks.length) {\n          return null;\n        }\n        return ASTNode.createStackNode(topBlocks[resultIndex]);\n      }\n    }\n    throw Error(\n      \"Couldn't find \" + (forward ? 'next' : 'previous') + ' stack?!',\n    );\n  }\n\n  /**\n   * Navigate between buttons and stacks of blocks on the flyout workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The next button, or next stack's first block, or null\n   */\n  private navigateFlyoutContents(forward: boolean): ASTNode | null {\n    const nodeType = this.getType();\n    let location;\n    let targetWorkspace;\n\n    switch (nodeType) {\n      case ASTNode.types.STACK: {\n        location = this.getLocation() as Block;\n        const workspace = location.workspace as WorkspaceSvg;\n        targetWorkspace = workspace.targetWorkspace as WorkspaceSvg;\n        break;\n      }\n      case ASTNode.types.BUTTON: {\n        location = this.getLocation() as FlyoutButton;\n        targetWorkspace = location.getTargetWorkspace() as WorkspaceSvg;\n        break;\n      }\n      default:\n        return null;\n    }\n\n    const flyout = targetWorkspace.getFlyout();\n    if (!flyout) return null;\n\n    const nextItem = this.findNextLocationInFlyout(\n      flyout.getContents(),\n      location,\n      forward,\n    );\n    if (!nextItem) return null;\n\n    if (nextItem.type === 'button' && nextItem.button) {\n      return ASTNode.createButtonNode(nextItem.button);\n    } else if (nextItem.type === 'block' && nextItem.block) {\n      return ASTNode.createStackNode(nextItem.block);\n    }\n\n    return null;\n  }\n\n  /**\n   * Finds the next (or previous if navigating backward) item in the flyout that should be navigated to.\n   *\n   * @param flyoutContents Contents of the current flyout.\n   * @param currentLocation Current ASTNode location.\n   * @param forward True if we're navigating forward, else false.\n   * @returns The next (or previous) FlyoutItem, or null if there is none.\n   */\n  private findNextLocationInFlyout(\n    flyoutContents: FlyoutItem[],\n    currentLocation: IASTNodeLocation,\n    forward: boolean,\n  ): FlyoutItem | null {\n    const currentIndex = flyoutContents.findIndex((item: FlyoutItem) => {\n      if (currentLocation instanceof Block && item.block === currentLocation) {\n        return true;\n      }\n      if (\n        currentLocation instanceof FlyoutButton &&\n        item.button === currentLocation\n      ) {\n        return true;\n      }\n      return false;\n    });\n\n    if (currentIndex < 0) return null;\n\n    const resultIndex = forward ? currentIndex + 1 : currentIndex - 1;\n    if (resultIndex === -1 || resultIndex === flyoutContents.length) {\n      return null;\n    }\n\n    return flyoutContents[resultIndex];\n  }\n\n  /**\n   * Finds the top most AST node for a given block.\n   * This is either the previous connection, output connection or block\n   * depending on what kind of connections the block has.\n   *\n   * @param block The block that we want to find the top connection on.\n   * @returns The AST node containing the top connection.\n   */\n  private findTopASTNodeForBlock(block: Block): ASTNode | null {\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      return ASTNode.createConnectionNode(topConnection);\n    } else {\n      return ASTNode.createBlockNode(block);\n    }\n  }\n\n  /**\n   * Get the AST node pointing to the input that the block is nested under or if\n   * the block is not nested then get the stack AST node.\n   *\n   * @param block The source block of the current location.\n   * @returns The AST node pointing to the input connection or the top block of\n   *     the stack this block is in.\n   */\n  private getOutAstNodeForBlock(block: Block): ASTNode | null {\n    if (!block) {\n      return null;\n    }\n    // If the block doesn't have a previous connection then it is the top of the\n    // substack.\n    const topBlock = block.getTopStackBlock();\n    const topConnection = getParentConnection(topBlock);\n    // If the top connection has a parentInput, create an AST node pointing to\n    // that input.\n    if (\n      topConnection &&\n      topConnection.targetConnection &&\n      topConnection.targetConnection.getParentInput()\n    ) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        topConnection.targetConnection.getParentInput() as AnyDuringMigration,\n      );\n    } else {\n      // Go to stack level if you are not underneath an input.\n      return ASTNode.createStackNode(topBlock);\n    }\n  }\n\n  /**\n   * Find the first editable field or input with a connection on a given block.\n   *\n   * @param block The source block of the current location.\n   * @returns An AST node pointing to the first field or input.\n   * Null if there are no editable fields or inputs with connections on the\n   * block.\n   */\n  private findFirstFieldOrInput(block: Block): ASTNode | null {\n    const inputs = block.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      const input = inputs[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Finds the source block of the location of this node.\n   *\n   * @returns The source block of the location, or null if the node is of type\n   *     workspace or button.\n   */\n  getSourceBlock(): Block | null {\n    if (this.getType() === ASTNode.types.BLOCK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.STACK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.WORKSPACE) {\n      return null;\n    } else if (this.getType() === ASTNode.types.BUTTON) {\n      return null;\n    } else {\n      return (this.getLocation() as IASTNodeLocationWithBlock).getSourceBlock();\n    }\n  }\n\n  /**\n   * Find the element to the right of the current element in the AST.\n   *\n   * @returns An AST node that wraps the next field, connection, block, or\n   *     workspace. Or null if there is no node to the right.\n   */\n  next(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks(true);\n\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD:\n        return this.findNextForField();\n\n      case ASTNode.types.INPUT:\n        return this.findNextForInput();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        const nextConnection = block.nextConnection;\n        if (!nextConnection) return null;\n        return ASTNode.createConnectionNode(nextConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n      case ASTNode.types.BUTTON:\n        return this.navigateFlyoutContents(true);\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element one level below and all the way to the left of the current\n   * location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace, or\n   *     block. Or null if there is nothing below this node.\n   */\n  in(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.WORKSPACE: {\n        const workspace = this.location as Workspace;\n        const topBlocks = workspace.getTopBlocks(true);\n        if (topBlocks.length > 0) {\n          return ASTNode.createStackNode(topBlocks[0]);\n        }\n        break;\n      }\n      case ASTNode.types.STACK: {\n        const block = this.location as Block;\n        return this.findTopASTNodeForBlock(block);\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        return this.findFirstFieldOrInput(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element to the left of the current element in the AST.\n   *\n   * @returns An AST node that wraps the previous field, connection, workspace\n   *     or block. Or null if no node exists to the left. null.\n   */\n  prev(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks(false);\n\n      case ASTNode.types.OUTPUT:\n        return null;\n\n      case ASTNode.types.FIELD:\n        return this.findPrevForField();\n\n      case ASTNode.types.INPUT:\n        return this.findPrevForInput();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        const topConnection = getParentConnection(block);\n        if (!topConnection) return null;\n        return ASTNode.createConnectionNode(topConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        if (targetConnection && !targetConnection.getParentInput()) {\n          return ASTNode.createConnectionNode(targetConnection);\n        }\n        break;\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BUTTON:\n        return this.navigateFlyoutContents(false);\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the next element that is one position above and all the way to the\n   * left of the current location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace or\n   *     block. Or null if we are at the workspace level.\n   */\n  out(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK: {\n        const block = this.location as Block;\n        const blockPos = block.getRelativeToSurfaceXY();\n        // TODO: Make sure this is in the bounds of the workspace.\n        const wsCoordinate = new Coordinate(\n          blockPos.x,\n          blockPos.y + ASTNode.DEFAULT_OFFSET_Y,\n        );\n        return ASTNode.createWorkspaceNode(block.workspace, wsCoordinate);\n      }\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location as Connection;\n        const target = connection.targetConnection;\n        if (target) {\n          return ASTNode.createConnectionNode(target);\n        }\n        return ASTNode.createStackNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD: {\n        const field = this.location as Field;\n        const block = field.getSourceBlock();\n        if (!block) {\n          throw new Error(\n            'The current AST location is not associated with a block',\n          );\n        }\n        return ASTNode.createBlockNode(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        return this.getOutAstNodeForBlock(block);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Whether an AST node of the given type points to a connection.\n   *\n   * @param type The type to check.  One of ASTNode.types.\n   * @returns True if a node of the given type points to a connection.\n   */\n  private static isConnectionType(type: string): boolean {\n    switch (type) {\n      case ASTNode.types.PREVIOUS:\n      case ASTNode.types.NEXT:\n      case ASTNode.types.INPUT:\n      case ASTNode.types.OUTPUT:\n        return true;\n    }\n    return false;\n  }\n\n  /**\n   * Create an AST node pointing to a field.\n   *\n   * @param field The location of the AST node.\n   * @returns An AST node pointing to a field.\n   */\n  static createFieldNode(field: Field): ASTNode | null {\n    if (!field) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.FIELD, field);\n  }\n\n  /**\n   * Creates an AST node pointing to a connection. If the connection has a\n   * parent input then create an AST node of type input that will hold the\n   * connection.\n   *\n   * @param connection This is the connection the node will point to.\n   * @returns An AST node pointing to a connection.\n   */\n  static createConnectionNode(connection: Connection): ASTNode | null {\n    if (!connection) {\n      return null;\n    }\n    const type = connection.type;\n    if (type === ConnectionType.INPUT_VALUE) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        connection.getParentInput() as AnyDuringMigration,\n      );\n    } else if (\n      type === ConnectionType.NEXT_STATEMENT &&\n      connection.getParentInput()\n    ) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        connection.getParentInput() as AnyDuringMigration,\n      );\n    } else if (type === ConnectionType.NEXT_STATEMENT) {\n      return new ASTNode(ASTNode.types.NEXT, connection);\n    } else if (type === ConnectionType.OUTPUT_VALUE) {\n      return new ASTNode(ASTNode.types.OUTPUT, connection);\n    } else if (type === ConnectionType.PREVIOUS_STATEMENT) {\n      return new ASTNode(ASTNode.types.PREVIOUS, connection);\n    }\n    return null;\n  }\n\n  /**\n   * Creates an AST node pointing to an input. Stores the input connection as\n   * the location.\n   *\n   * @param input The input used to create an AST node.\n   * @returns An AST node pointing to a input.\n   */\n  static createInputNode(input: Input): ASTNode | null {\n    if (!input || !input.connection) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.INPUT, input.connection);\n  }\n\n  /**\n   * Creates an AST node pointing to a block.\n   *\n   * @param block The block used to create an AST node.\n   * @returns An AST node pointing to a block.\n   */\n  static createBlockNode(block: Block): ASTNode | null {\n    if (!block) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BLOCK, block);\n  }\n\n  /**\n   * Create an AST node of type stack. A stack, represented by its top block, is\n   *     the set of all blocks connected to a top block, including the top\n   * block.\n   *\n   * @param topBlock A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createStackNode(topBlock: Block): ASTNode | null {\n    if (!topBlock) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.STACK, topBlock);\n  }\n\n  /**\n   * Create an AST node of type button. A button in this case refers\n   * specifically to a button in a flyout.\n   *\n   * @param button A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createButtonNode(button: FlyoutButton): ASTNode | null {\n    if (!button) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BUTTON, button);\n  }\n\n  /**\n   * Creates an AST node pointing to a workspace.\n   *\n   * @param workspace The workspace that we are on.\n   * @param wsCoordinate The position on the workspace for this node.\n   * @returns An AST node pointing to a workspace and a position on the\n   *     workspace.\n   */\n  static createWorkspaceNode(\n    workspace: Workspace | null,\n    wsCoordinate: Coordinate | null,\n  ): ASTNode | null {\n    if (!wsCoordinate || !workspace) {\n      return null;\n    }\n    const params = {wsCoordinate};\n    return new ASTNode(ASTNode.types.WORKSPACE, workspace, params);\n  }\n\n  /**\n   * Creates an AST node for the top position on a block.\n   * This is either an output connection, previous connection, or block.\n   *\n   * @param block The block to find the top most AST node on.\n   * @returns The AST node holding the top most position on the block.\n   */\n  static createTopNode(block: Block): ASTNode | null {\n    let astNode;\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      astNode = ASTNode.createConnectionNode(topConnection);\n    } else {\n      astNode = ASTNode.createBlockNode(block);\n    }\n    return astNode;\n  }\n}\n\nexport namespace ASTNode {\n  export interface Params {\n    wsCoordinate: Coordinate;\n  }\n\n  export enum types {\n    FIELD = 'field',\n    BLOCK = 'block',\n    INPUT = 'input',\n    OUTPUT = 'output',\n    NEXT = 'next',\n    PREVIOUS = 'previous',\n    STACK = 'stack',\n    WORKSPACE = 'workspace',\n    BUTTON = 'button',\n  }\n}\n\nexport type Params = ASTNode.Params;\n// No need to export ASTNode.types from the module at this time because (1) it\n// wasn't automatically converted by the automatic migration script, (2) the\n// name doesn't follow the styleguide.\n\n/**\n * Gets the parent connection on a block.\n * This is either an output connection, previous connection or undefined.\n * If both connections exist return the one that is actually connected\n * to another block.\n *\n * @param block The block to find the parent connection on.\n * @returns The connection connecting to the parent of the block.\n */\nfunction getParentConnection(block: Block): Connection | null {\n  let topConnection = block.outputConnection;\n  if (\n    !topConnection ||\n    (block.previousConnection && block.previousConnection.isConnected())\n  ) {\n    topConnection = block.previousConnection;\n  }\n  return topConnection;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering\n\nimport * as registry from '../../registry.js';\nimport type {Theme} from '../../theme.js';\nimport {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {Connection} from '../measurables/connection.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n/**\n * Registers a new renderer.\n *\n * @param name The name of the renderer.\n * @param rendererClass The new renderer class to register.\n * @throws {Error} if a renderer with the same name has already been registered.\n */\nexport function register(name: string, rendererClass: Function) {\n  registry.register(registry.Type.RENDERER, name, rendererClass);\n}\n\n/**\n * Unregisters the renderer registered with the given name.\n *\n * @param name The name of the renderer.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.RENDERER, name);\n}\n\n/**\n * Initialize anything needed for rendering (constants, etc).\n *\n * @param name Name of the renderer to initialize.\n * @param theme The workspace theme object.\n * @param opt_rendererOverrides Rendering constant overrides.\n * @returns The new instance of a renderer.\n *     Already initialized.\n * @internal\n */\nexport function init(\n  name: string,\n  theme: Theme,\n  opt_rendererOverrides?: {[rendererConstant: string]: any},\n): Renderer {\n  const rendererClass = registry.getClass(registry.Type.RENDERER, name);\n  const renderer = new rendererClass!(name);\n  renderer.init(theme, opt_rendererOverrides);\n  return renderer;\n}\nexport {BottomRow};\nexport {Connection};\nexport {Drawer};\nexport {ExternalValueInput};\nexport {Field};\nexport {Hat};\nexport {Icon};\nexport {InRowSpacer};\nexport {InlineInput};\nexport {InputConnection};\nexport {InputRow};\nexport {IPathObject};\nexport {JaggedEdge};\nexport {MarkerSvg};\nexport {Measurable};\nexport {NextConnection};\nexport {OutputConnection};\nexport {PathObject};\nexport {PreviousConnection};\nexport {Renderer};\nexport {RenderInfo};\nexport {RoundCorner};\nexport {Row};\nexport {SpacerRow};\nexport {SquareCorner};\nexport {StatementInput};\nexport {TopRow};\nexport {Types};\n\nexport {\n  OutsideCorners,\n  InsideCorners,\n  StartHat,\n  Notch,\n  PuzzleTab,\n  JaggedTeeth,\n  BaseShape,\n  DynamicShape,\n  ConstantProvider,\n} from './constants.js';\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.VariablesDynamic\n\nimport {Blocks} from './blocks.js';\nimport {Msg} from './msg.js';\nimport * as xml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {FlyoutButton} from './flyout_button.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.Procedures.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE_DYNAMIC';\n\n/**\n * Click handler for a button that creates String variables.\n *\n * @param button\n */\nfunction stringButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'String',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_String = stringButtonClickHandler;\n\n/**\n * Click handler for a button that creates Number variables.\n *\n * @param button\n */\nfunction numberButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'Number',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Number = numberButtonClickHandler;\n\n/**\n * Click handler for a button that creates Colour variables.\n *\n * @param button\n */\nfunction colourButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'Colour',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Colour = colourButtonClickHandler;\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  let button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_STRING_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_STRING');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_NUMBER_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_NUMBER');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_COLOUR_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_COLOUR');\n  xmlList.push(button);\n\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_STRING',\n    stringButtonClickHandler,\n  );\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_NUMBER',\n    numberButtonClickHandler,\n  );\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_COLOUR',\n    colourButtonClickHandler,\n  );\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getAllVariables();\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    if (Blocks['variables_set_dynamic']) {\n      const firstVariable = variableModelList[variableModelList.length - 1];\n      const block = xml.createElement('block');\n      block.setAttribute('type', 'variables_set_dynamic');\n      block.setAttribute('gap', '24');\n      block.appendChild(Variables.generateVariableFieldDom(firstVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['variables_get_dynamic']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\n        const block = xml.createElement('block');\n        block.setAttribute('type', 'variables_get_dynamic');\n        block.setAttribute('gap', '8');\n        block.appendChild(Variables.generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n", "/**\n * @license\n * Copyright 2014 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace rendered as SVG.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_theme_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_viewport.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {ConnectionDB} from './connection_db.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Options} from './options.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {ScrollbarPair} from './scrollbar_pair.js';\nimport type {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport {ThemeManager} from './theme_manager.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Trashcan} from './trashcan.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './comments/workspace_comment.js';\nimport {ZoomControls} from './zoom_controls.js';\nimport {ContextMenuOption} from './contextmenu_registry.js';\nimport * as renderManagement from './render_management.js';\nimport {LayerManager} from './layer_manager.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\n\n/** Margin around the top/bottom/left/right after a zoomToFit call. */\nconst ZOOM_TO_FIT_MARGIN = 20;\n\n/**\n * Class for a workspace.  This is an onscreen area with optional trashcan,\n * scrollbars, bubbles, and dragging.\n */\nexport class WorkspaceSvg extends Workspace implements IASTNodeLocationSvg {\n  /**\n   * A wrapper function called when a resize event occurs.\n   * You can pass the result to `eventHandling.unbind`.\n   */\n  private resizeHandlerWrapper: browserEvents.Data | null = null;\n\n  /**\n   * The render status of an SVG workspace.\n   * Returns `false` for headless workspaces and true for instances of\n   * `WorkspaceSvg`.\n   */\n  override rendered = true;\n\n  /**\n   * Whether the workspace is visible.  False if the workspace has been hidden\n   * by calling `setVisible(false)`.\n   */\n  private isVisible_ = true;\n\n  /**\n   * Whether this workspace has resizes enabled.\n   * Disable during batch operations for a performance improvement.\n   */\n  private resizesEnabled = true;\n\n  /**\n   * Current horizontal scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves right, this value becomes more positive, and\n   * the view is now \"seeing\" the left side of the canvas. As the canvas moves\n   * left, this value becomes more negative, and the view is now \"seeing\" the\n   * right side of the canvas.\n   *\n   * The confusing thing about this value is that it does not, and must not\n   * include the absoluteLeft offset. This is because it is used to calculate\n   * the viewLeft value.\n   *\n   * The viewLeft is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewLeft and workspace origin are at\n   * the same X location. As the canvas slides towards the right beneath the\n   * view this value (scrollX) becomes more positive, and the viewLeft becomes\n   * more negative relative to the workspace origin (imagine the workspace\n   * origin as a dot on the canvas sliding to the right as the canvas moves).\n   *\n   * So if the scrollX were to include the absoluteLeft this would in a way\n   * \"unshift\" the workspace origin. This means that the viewLeft would be\n   * representing the left edge of the blocklyDiv, rather than the left edge\n   * of the workspace.\n   */\n  scrollX = 0;\n\n  /**\n   * Current vertical scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves down, this value becomes more positive, and the\n   * view is now \"seeing\" the upper part of the canvas. As the canvas moves\n   * up, this value becomes more negative, and the view is \"seeing\" the lower\n   * part of the canvas.\n   *\n   * This confusing thing about this value is that it does not, and must not\n   * include the absoluteTop offset. This is because it is used to calculate\n   * the viewTop value.\n   *\n   * The viewTop is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewTop and workspace origin are at the\n   * same Y location. As the canvas slides towards the bottom this value\n   * (scrollY) becomes more positive, and the viewTop becomes more negative\n   * relative to the workspace origin (image in the workspace origin as a dot\n   * on the canvas sliding downwards as the canvas moves).\n   *\n   * So if the scrollY were to include the absoluteTop this would in a way\n   * \"unshift\" the workspace origin. This means that the viewTop would be\n   * representing the top edge of the blocklyDiv, rather than the top edge of\n   * the workspace.\n   */\n  scrollY = 0;\n\n  /** Horizontal scroll value when scrolling started in pixel units. */\n  startScrollX = 0;\n\n  /** Vertical scroll value when scrolling started in pixel units. */\n  startScrollY = 0;\n\n  /** Distance from mouse to object being dragged. */\n  private dragDeltaXY: Coordinate | null = null;\n\n  /** Current scale. */\n  scale = 1;\n\n  /** Cached scale value. Used to detect changes in viewport. */\n  private oldScale = 1;\n\n  /** Cached viewport top value. Used to detect changes in viewport. */\n  private oldTop = 0;\n\n  /** Cached viewport left value. Used to detect changes in viewport. */\n  private oldLeft = 0;\n\n  /** The workspace's trashcan (if any). */\n  trashcan: Trashcan | null = null;\n\n  /** This workspace's scrollbars, if they exist. */\n  scrollbar: ScrollbarPair | null = null;\n\n  /**\n   * Fixed flyout providing blocks which may be dragged into this workspace.\n   */\n  private flyout: IFlyout | null = null;\n\n  /**\n   * Category-based toolbox providing blocks which may be dragged into this\n   * workspace.\n   */\n  private toolbox_: IToolbox | null = null;\n\n  /**\n   * The current gesture in progress on this workspace, if any.\n   *\n   * @internal\n   */\n  currentGesture_: Gesture | null = null;\n\n  /**\n   * The first parent div with 'injectionDiv' in the name, or null if not set.\n   * Access this with getInjectionDiv.\n   */\n  private injectionDiv: Element | null = null;\n\n  /**\n   * Last known position of the page scroll.\n   * This is used to determine whether we have recalculated screen coordinate\n   * stuff since the page scrolled.\n   */\n  private lastRecordedPageScroll: Coordinate | null = null;\n\n  /**\n   * Developers may define this function to add custom menu options to the\n   * workspace's context menu or edit the workspace-created set of menu\n   * options.\n   *\n   * @param options List of menu options to add to.\n   * @param e The right-click event that triggered the context menu.\n   */\n  configureContextMenu:\n    | ((menuOptions: ContextMenuOption[], e: Event) => void)\n    | null = null;\n\n  /**\n   * A dummy wheel event listener used as a workaround for a Safari scrolling issue.\n   * Set in createDom and used for removal in dispose to ensure proper cleanup.\n   */\n  private dummyWheelListener: (() => void) | null = null;\n\n  /**\n   * In a flyout, the target workspace where blocks should be placed after a\n   * drag. Otherwise null.\n   *\n   * @internal\n   */\n  targetWorkspace: WorkspaceSvg | null = null;\n\n  /** Inverted screen CTM, for use in mouseToSvg. */\n  private inverseScreenCTM: SVGMatrix | null = null;\n\n  /** Inverted screen CTM is dirty, recalculate it. */\n  private inverseScreenCTMDirty = true;\n  private metricsManager: IMetricsManager;\n  /** @internal */\n  getMetrics: () => Metrics;\n  /** @internal */\n  setMetrics: (p1: {x?: number; y?: number}) => void;\n  private readonly componentManager: ComponentManager;\n\n  /**\n   * List of currently highlighted blocks.  Block highlighting is often used\n   * to visually mark blocks currently being executed.\n   */\n  private readonly highlightedBlocks: BlockSvg[] = [];\n  private audioManager: WorkspaceAudio;\n  private grid: Grid | null;\n  private markerManager: MarkerManager;\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * custom toolbox category is opened.\n   */\n  private toolboxCategoryCallbacks = new Map<\n    string,\n    (p1: WorkspaceSvg) => toolbox.FlyoutDefinition\n  >();\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * button is clicked.\n   */\n  private flyoutButtonCallbacks = new Map<string, (p1: FlyoutButton) => void>();\n  protected themeManager_: ThemeManager;\n  private readonly renderer: Renderer;\n\n  /** Cached parent SVG. */\n  private cachedParentSvg: SVGElement | null = null;\n\n  /** True if keyboard accessibility mode is on, false otherwise. */\n  keyboardAccessibilityMode = false;\n\n  /** The list of top-level bounded elements on the workspace. */\n  private topBoundedElements: IBoundedElement[] = [];\n\n  /** The recorded drag targets. */\n  private dragTargetAreas: Array<{component: IDragTarget; clientRect: Rect}> =\n    [];\n  private readonly cachedParentSvgSize: Size;\n  private layerManager: LayerManager | null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgGroup_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBackground_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBlockCanvas_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBubbleCanvas_!: SVGElement;\n  zoomControls_: ZoomControls | null = null;\n\n  /**\n   * @param options Dictionary of options.\n   */\n  constructor(options: Options) {\n    super(options);\n\n    const MetricsManagerClass = registry.getClassFromOptions(\n      registry.Type.METRICS_MANAGER,\n      options,\n      true,\n    );\n    /** Object in charge of calculating metrics for the workspace. */\n    this.metricsManager = new MetricsManagerClass!(this);\n\n    /** Method to get all the metrics that have to do with a workspace. */\n    this.getMetrics =\n      options.getMetrics ||\n      this.metricsManager.getMetrics.bind(this.metricsManager);\n\n    /** Translates the workspace. */\n    this.setMetrics =\n      options.setMetrics || WorkspaceSvg.setTopLevelWorkspaceMetrics_;\n\n    this.componentManager = new ComponentManager();\n\n    this.connectionDBList = ConnectionDB.init(this.connectionChecker);\n\n    /**\n     * Object in charge of loading, storing, and playing audio for a workspace.\n     */\n    this.audioManager = new WorkspaceAudio(\n      options.parentWorkspace as WorkspaceSvg,\n    );\n\n    /** This workspace's grid object or null. */\n    this.grid = this.options.gridPattern\n      ? new Grid(this.options.gridPattern, options.gridOptions)\n      : null;\n\n    /** Manager in charge of markers and cursors. */\n    this.markerManager = new MarkerManager(this);\n\n    if (Variables && Variables.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        Variables.CATEGORY_NAME,\n        Variables.flyoutCategory,\n      );\n    }\n\n    if (VariablesDynamic && VariablesDynamic.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        VariablesDynamic.CATEGORY_NAME,\n        VariablesDynamic.flyoutCategory,\n      );\n    }\n\n    if (Procedures && Procedures.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        Procedures.CATEGORY_NAME,\n        Procedures.flyoutCategory,\n      );\n      this.addChangeListener(Procedures.mutatorOpenListener);\n    }\n\n    /** Object in charge of storing and updating the workspace theme. */\n    this.themeManager_ = this.options.parentWorkspace\n      ? this.options.parentWorkspace.getThemeManager()\n      : new ThemeManager(this, this.options.theme || Classic);\n    this.themeManager_.subscribeWorkspace(this);\n\n    /** The block renderer used for rendering blocks on this workspace. */\n    this.renderer = blockRendering.init(\n      this.options.renderer || 'geras',\n      this.getTheme(),\n      this.options.rendererOverrides ?? undefined,\n    );\n\n    /**\n     * The cached size of the parent svg element.\n     * Used to compute svg metrics.\n     */\n    this.cachedParentSvgSize = new Size(0, 0);\n  }\n\n  /**\n   * Get the marker manager for this workspace.\n   *\n   * @returns The marker manager.\n   */\n  getMarkerManager(): MarkerManager {\n    return this.markerManager;\n  }\n\n  /**\n   * Gets the metrics manager for this workspace.\n   *\n   * @returns The metrics manager.\n   */\n  getMetricsManager(): IMetricsManager {\n    return this.metricsManager;\n  }\n\n  /**\n   * Sets the metrics manager for the workspace.\n   *\n   * @param metricsManager The metrics manager.\n   * @internal\n   */\n  setMetricsManager(metricsManager: IMetricsManager) {\n    this.metricsManager = metricsManager;\n    this.getMetrics = this.metricsManager.getMetrics.bind(this.metricsManager);\n  }\n\n  /**\n   * Gets the component manager for this workspace.\n   *\n   * @returns The component manager.\n   */\n  getComponentManager(): ComponentManager {\n    return this.componentManager;\n  }\n\n  /**\n   * Add the cursor SVG to this workspaces SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.markerManager.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.markerManager.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Get the marker with the given ID.\n   *\n   * @param id The ID of the marker.\n   * @returns The marker with the given ID or null if no marker with the given\n   *     ID exists.\n   * @internal\n   */\n  getMarker(id: string): Marker | null {\n    if (this.markerManager) {\n      return this.markerManager.getMarker(id);\n    }\n    return null;\n  }\n\n  /**\n   * The cursor for this workspace.\n   *\n   * @returns The cursor for the workspace.\n   */\n  getCursor(): Cursor | null {\n    if (this.markerManager) {\n      return this.markerManager.getCursor();\n    }\n    return null;\n  }\n\n  /**\n   * Get the block renderer attached to this workspace.\n   *\n   * @returns The renderer attached to this workspace.\n   */\n  getRenderer(): Renderer {\n    return this.renderer;\n  }\n\n  /**\n   * Get the theme manager for this workspace.\n   *\n   * @returns The theme manager for this workspace.\n   * @internal\n   */\n  getThemeManager(): ThemeManager {\n    return this.themeManager_;\n  }\n\n  /**\n   * Get the workspace theme object.\n   *\n   * @returns The workspace theme object.\n   */\n  getTheme(): Theme {\n    return this.themeManager_.getTheme();\n  }\n\n  /**\n   * Set the workspace theme object.\n   * If no theme is passed, default to the `Classic` theme.\n   *\n   * @param theme The workspace theme object.\n   */\n  setTheme(theme: Theme) {\n    if (!theme) {\n      theme = Classic as Theme;\n    }\n    this.themeManager_.setTheme(theme);\n  }\n\n  /**\n   * Refresh all blocks on the workspace after a theme update.\n   */\n  refreshTheme() {\n    if (this.svgGroup_) {\n      this.renderer.refreshDom(this.svgGroup_, this.getTheme());\n    }\n\n    // Update all blocks in workspace that have a style name.\n    this.updateBlockStyles_(\n      this.getAllBlocks(false).filter(function (block) {\n        return !!block.getStyleName();\n      }),\n    );\n\n    // Update current toolbox selection.\n    this.refreshToolboxSelection();\n    if (this.toolbox_) {\n      this.toolbox_.refreshTheme();\n    }\n\n    // Re-render if workspace is visible\n    if (this.isVisible()) {\n      this.setVisible(true);\n    }\n\n    const event = new (eventUtils.get(eventUtils.THEME_CHANGE))(\n      this.getTheme().name,\n      this.id,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Updates all the blocks with new style.\n   *\n   * @param blocks List of blocks to update the style on.\n   */\n  private updateBlockStyles_(blocks: Block[]) {\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      const blockStyleName = block.getStyleName();\n      if (blockStyleName) {\n        const blockSvg = block as BlockSvg;\n        blockSvg.setStyle(blockStyleName);\n      }\n    }\n  }\n\n  /**\n   * Getter for the inverted screen CTM.\n   *\n   * @returns The matrix to use in mouseToSvg\n   */\n  getInverseScreenCTM(): SVGMatrix | null {\n    // Defer getting the screen CTM until we actually need it, this should\n    // avoid forced reflows from any calls to updateInverseScreenCTM.\n    if (this.inverseScreenCTMDirty) {\n      const ctm = this.getParentSvg().getScreenCTM();\n      if (ctm) {\n        this.inverseScreenCTM = ctm.inverse();\n        this.inverseScreenCTMDirty = false;\n      }\n    }\n\n    return this.inverseScreenCTM;\n  }\n\n  /** Mark the inverse screen CTM as dirty. */\n  updateInverseScreenCTM() {\n    this.inverseScreenCTMDirty = true;\n  }\n\n  /**\n   * Getter for isVisible\n   *\n   * @returns Whether the workspace is visible.\n   *     False if the workspace has been hidden by calling `setVisible(false)`.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this element,\n   * scales that after canvas SVG element, if it's a descendant.\n   * The origin (0,0) is the top-left corner of the Blockly SVG.\n   *\n   * @param element SVG element to find the coordinates of.\n   * @returns Object with .x and .y properties.\n   * @internal\n   */\n  getSvgXY(element: SVGElement): Coordinate {\n    let x = 0;\n    let y = 0;\n    let scale = 1;\n    if (\n      this.getCanvas().contains(element) ||\n      this.getBubbleCanvas().contains(element)\n    ) {\n      // Before the SVG canvas, scale the coordinates.\n      scale = this.scale;\n    }\n    do {\n      // Loop through this block and every parent.\n      const xy = svgMath.getRelativeXY(element);\n      if (element === this.getCanvas() || element === this.getBubbleCanvas()) {\n        // After the SVG canvas, don't scale the coordinates.\n        scale = 1;\n      }\n      x += xy.x * scale;\n      y += xy.y * scale;\n      element = element.parentNode as SVGElement;\n    } while (\n      element &&\n      element !== this.getParentSvg() &&\n      element !== this.getInjectionDiv()\n    );\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Gets the size of the workspace's parent SVG element.\n   *\n   * @returns The cached width and height of the workspace's parent SVG element.\n   * @internal\n   */\n  getCachedParentSvgSize(): Size {\n    const size = this.cachedParentSvgSize;\n    return new Size(size.width, size.height);\n  }\n\n  /**\n   * Return the position of the workspace origin relative to the injection div\n   * origin in pixels.\n   * The workspace origin is where a block would render at position (0, 0).\n   * It is not the upper left corner of the workspace SVG.\n   *\n   * @returns Offset in pixels.\n   * @internal\n   */\n  getOriginOffsetInPixels(): Coordinate {\n    return svgMath.getInjectionDivXY(this.getCanvas());\n  }\n\n  /**\n   * Return the injection div that is a parent of this workspace.\n   * Walks the DOM the first time it's called, then returns a cached value.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns The first parent div with 'injectionDiv' in the name.\n   * @internal\n   */\n  getInjectionDiv(): Element {\n    // NB: it would be better to pass this in at createDom, but is more likely\n    // to break existing uses of Blockly.\n    if (!this.injectionDiv) {\n      let element: Element = this.svgGroup_;\n      while (element) {\n        const classes = element.getAttribute('class') || '';\n        if ((' ' + classes + ' ').includes(' injectionDiv ')) {\n          this.injectionDiv = element;\n          break;\n        }\n        element = element.parentNode as Element;\n      }\n    }\n    return this.injectionDiv!;\n  }\n\n  /**\n   * Returns the SVG group for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   */\n  getSvgGroup(): Element {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the SVG block canvas for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   * @internal\n   */\n  getBlockCanvas(): SVGElement | null {\n    return this.getCanvas();\n  }\n\n  /**\n   * Save resize handler data so we can delete it later in dispose.\n   *\n   * @param handler Data that can be passed to eventHandling.unbind.\n   */\n  setResizeHandlerWrapper(handler: browserEvents.Data) {\n    this.resizeHandlerWrapper = handler;\n  }\n\n  /**\n   * Create the workspace DOM elements.\n   *\n   * @param opt_backgroundClass Either 'blocklyMainBackground' or\n   *     'blocklyMutatorBackground'.\n   * @returns The workspace's SVG group.\n   */\n  createDom(opt_backgroundClass?: string, injectionDiv?: Element): Element {\n    if (!this.injectionDiv) {\n      this.injectionDiv = injectionDiv ?? null;\n    }\n\n    /**\n     * <g class=\"blocklyWorkspace\">\n     *   <rect class=\"blocklyMainBackground\" height=\"100%\" width=\"100%\"></rect>\n     *   [Trashcan and/or flyout may go here]\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\"></g>\n     * </g>\n     */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyWorkspace'});\n\n    // Note that a <g> alone does not receive mouse events--it must have a\n    // valid target inside it.  If no background class is specified, as in the\n    // flyout, the workspace will not receive mouse events.\n    if (opt_backgroundClass) {\n      this.svgBackground_ = dom.createSvgElement(\n        Svg.RECT,\n        {'height': '100%', 'width': '100%', 'class': opt_backgroundClass},\n        this.svgGroup_,\n      );\n\n      if (opt_backgroundClass === 'blocklyMainBackground' && this.grid) {\n        this.svgBackground_.style.fill =\n          'url(#' + this.grid.getPatternId() + ')';\n      } else {\n        this.themeManager_.subscribe(\n          this.svgBackground_,\n          'workspaceBackgroundColour',\n          'fill',\n        );\n      }\n    }\n\n    this.layerManager = new LayerManager(this);\n    // Assign the canvases for backwards compatibility.\n    this.svgBlockCanvas_ = this.layerManager.getBlockLayer();\n    this.svgBubbleCanvas_ = this.layerManager.getBubbleLayer();\n\n    if (!this.isFlyout) {\n      browserEvents.conditionalBind(\n        this.svgGroup_,\n        'pointerdown',\n        this,\n        this.onMouseDown_,\n        false,\n      );\n      // This no-op works around https://bugs.webkit.org/show_bug.cgi?id=226683,\n      // which otherwise prevents zoom/scroll events from being observed in\n      // Safari. Once that bug is fixed it should be removed.\n      this.dummyWheelListener = () => {};\n      document.body.addEventListener('wheel', this.dummyWheelListener);\n      browserEvents.conditionalBind(\n        this.svgGroup_,\n        'wheel',\n        this,\n        this.onMouseWheel_,\n      );\n    }\n\n    // Determine if there needs to be a category tree, or a simple list of\n    // blocks.  This cannot be changed later, since the UI is very different.\n    if (this.options.hasCategories) {\n      const ToolboxClass = registry.getClassFromOptions(\n        registry.Type.TOOLBOX,\n        this.options,\n        true,\n      );\n      this.toolbox_ = new ToolboxClass!(this);\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n    this.recordDragTargets();\n    const CursorClass = registry.getClassFromOptions(\n      registry.Type.CURSOR,\n      this.options,\n    );\n\n    CursorClass && this.markerManager.setCursor(new CursorClass());\n\n    this.renderer.createDom(this.svgGroup_, this.getTheme());\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  override dispose() {\n    // Stop rerendering.\n    this.rendered = false;\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.toolbox_) {\n      this.toolbox_.dispose();\n      this.toolbox_ = null;\n    }\n    if (this.flyout) {\n      this.flyout.dispose();\n      this.flyout = null;\n    }\n    if (this.trashcan) {\n      this.trashcan.dispose();\n      this.trashcan = null;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.dispose();\n      this.scrollbar = null;\n    }\n    if (this.zoomControls_) {\n      this.zoomControls_.dispose();\n    }\n\n    if (this.audioManager) {\n      this.audioManager.dispose();\n    }\n\n    if (this.grid) {\n      this.grid = null;\n    }\n\n    this.renderer.dispose();\n\n    if (this.markerManager) {\n      this.markerManager.dispose();\n    }\n\n    super.dispose();\n\n    // Dispose of theme manager after all blocks and mutators are disposed of.\n    if (this.themeManager_) {\n      this.themeManager_.unsubscribeWorkspace(this);\n      this.themeManager_.unsubscribe(this.svgBackground_);\n      if (!this.options.parentWorkspace) {\n        this.themeManager_.dispose();\n      }\n    }\n\n    this.connectionDBList.length = 0;\n\n    this.toolboxCategoryCallbacks.clear();\n    this.flyoutButtonCallbacks.clear();\n\n    if (!this.options.parentWorkspace) {\n      // Top-most workspace.  Dispose of the div that the\n      // SVG is injected into (i.e. injectionDiv).\n      const parentSvg = this.getParentSvg();\n      if (parentSvg && parentSvg.parentNode) {\n        dom.removeNode(parentSvg.parentNode);\n      }\n    }\n    if (this.resizeHandlerWrapper) {\n      browserEvents.unbind(this.resizeHandlerWrapper);\n      this.resizeHandlerWrapper = null;\n    }\n\n    // Remove the dummy wheel listener\n    if (this.dummyWheelListener) {\n      document.body.removeEventListener('wheel', this.dummyWheelListener);\n      this.dummyWheelListener = null;\n    }\n  }\n\n  /**\n   * Add a trashcan.\n   *\n   * @internal\n   */\n  addTrashcan() {\n    this.trashcan = WorkspaceSvg.newTrashcan(this);\n    const svgTrashcan = this.trashcan.createDom();\n    this.svgGroup_.insertBefore(svgTrashcan, this.getCanvas());\n  }\n\n  /**\n   * @param _workspace\n   * @internal\n   */\n  static newTrashcan(_workspace: WorkspaceSvg): Trashcan {\n    throw new Error(\n      'The implementation of newTrashcan should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Add zoom controls.\n   *\n   * @internal\n   */\n  addZoomControls() {\n    this.zoomControls_ = new ZoomControls(this);\n    const svgZoomControls = this.zoomControls_.createDom();\n    this.svgGroup_.appendChild(svgZoomControls);\n  }\n\n  /**\n   * Add a flyout element in an element with the given tag name.\n   *\n   * @param tagName What type of tag the flyout belongs in.\n   * @returns The element containing the flyout DOM.\n   * @internal\n   */\n  addFlyout(tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>): Element {\n    const workspaceOptions = new Options({\n      'parentWorkspace': this,\n      'rtl': this.RTL,\n      'oneBasedIndex': this.options.oneBasedIndex,\n      'horizontalLayout': this.horizontalLayout,\n      'renderer': this.options.renderer,\n      'rendererOverrides': this.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    workspaceOptions.toolboxPosition = this.options.toolboxPosition;\n    if (this.horizontalLayout) {\n      const HorizontalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.options,\n        true,\n      );\n      this.flyout = new HorizontalFlyout!(workspaceOptions);\n    } else {\n      const VerticalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.options,\n        true,\n      );\n      this.flyout = new VerticalFlyout!(workspaceOptions);\n    }\n    this.flyout.autoClose = false;\n    this.flyout.getWorkspace().setVisible(true);\n\n    // Return the element so that callers can place it in their desired\n    // spot in the DOM.  For example, mutator flyouts do not go in the same\n    // place as main workspace flyouts.\n    return this.flyout.createDom(tagName);\n  }\n\n  /**\n   * Getter for the flyout associated with this workspace.  This flyout may be\n   * owned by either the toolbox or the workspace, depending on toolbox\n   * configuration.  It will be null if there is no flyout.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout.\n   * @returns The flyout on this workspace.\n   */\n  getFlyout(opt_own?: boolean): IFlyout | null {\n    if (this.flyout || opt_own) {\n      return this.flyout;\n    }\n    if (this.toolbox_) {\n      return this.toolbox_.getFlyout();\n    }\n    return null;\n  }\n\n  /**\n   * Getter for the toolbox associated with this workspace, if one exists.\n   *\n   * @returns The toolbox on this workspace.\n   */\n  getToolbox(): IToolbox | null {\n    return this.toolbox_;\n  }\n\n  /**\n   * Update items that use screen coordinate calculations\n   * because something has changed (e.g. scroll position, window size).\n   */\n  private updateScreenCalculations_() {\n    this.updateInverseScreenCTM();\n    this.recordDragTargets();\n  }\n\n  /**\n   * If enabled, resize the parts of the workspace that change when the\n   * workspace contents (e.g. block positions) change.  This will also scroll\n   * the workspace contents if needed.\n   *\n   * @internal\n   */\n  resizeContents() {\n    if (!this.resizesEnabled || !this.rendered) {\n      return;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateInverseScreenCTM();\n  }\n\n  /**\n   * Resize and reposition all of the workspace chrome (toolbox,\n   * trash, scrollbars etc.)\n   * This should be called when something changes that\n   * requires recalculating dimensions and positions of the\n   * trash, zoom, toolbox, etc. (e.g. window resize).\n   */\n  resize() {\n    if (this.toolbox_) {\n      this.toolbox_.position();\n    }\n    if (this.flyout) {\n      this.flyout.position();\n    }\n\n    const positionables = this.componentManager.getComponents(\n      ComponentManager.Capability.POSITIONABLE,\n      true,\n    );\n    const metrics = this.getMetricsManager().getUiMetrics();\n    const savedPositions = [];\n    for (let i = 0, positionable; (positionable = positionables[i]); i++) {\n      positionable.position(metrics, savedPositions);\n      const boundingRect = positionable.getBoundingRectangle();\n      if (boundingRect) {\n        savedPositions.push(boundingRect);\n      }\n    }\n\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateScreenCalculations_();\n  }\n\n  /**\n   * Resizes and repositions workspace chrome if the page has a new\n   * scroll position.\n   *\n   * @internal\n   */\n  updateScreenCalculationsIfScrolled() {\n    /* eslint-disable indent */\n    const currScroll = svgMath.getDocumentScroll();\n    if (!Coordinate.equals(this.lastRecordedPageScroll, currScroll)) {\n      this.lastRecordedPageScroll = currScroll;\n      this.updateScreenCalculations_();\n    }\n  }\n  /* eslint-enable indent */\n\n  /**\n   * @returns The layer manager for this workspace.\n   */\n  getLayerManager(): LayerManager | null {\n    return this.layerManager;\n  }\n\n  /**\n   * Get the SVG element that forms the drawing surface.\n   *\n   * @returns SVG group element.\n   */\n  getCanvas(): SVGGElement {\n    return this.layerManager!.getBlockLayer();\n  }\n\n  /**\n   * Caches the width and height of the workspace's parent SVG element for use\n   * with getSvgMetrics.\n   *\n   * @param width The width of the parent SVG element.\n   * @param height The height of the parent SVG element\n   * @internal\n   */\n  setCachedParentSvgSize(width: number | null, height: number | null) {\n    const svg = this.getParentSvg();\n    if (width != null) {\n      this.cachedParentSvgSize.width = width;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-width', `${width}`);\n    }\n    if (height != null) {\n      this.cachedParentSvgSize.height = height;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-height', `${height}`);\n    }\n  }\n\n  /**\n   * Get the SVG element that forms the bubble surface.\n   *\n   * @returns SVG group element.\n   */\n  getBubbleCanvas(): SVGGElement {\n    return this.layerManager!.getBubbleLayer();\n  }\n\n  /**\n   * Get the SVG element that contains this workspace.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns SVG element.\n   */\n  getParentSvg(): SVGSVGElement {\n    if (!this.cachedParentSvg) {\n      let element = this.svgGroup_;\n      while (element) {\n        if (element.tagName === 'svg') {\n          this.cachedParentSvg = element;\n          break;\n        }\n        element = element.parentNode as SVGSVGElement;\n      }\n    }\n    return this.cachedParentSvg as SVGSVGElement;\n  }\n\n  /**\n   * Fires a viewport event if events are enabled and there is a change in\n   * viewport values.\n   *\n   * @internal\n   */\n  maybeFireViewportChangeEvent() {\n    if (!eventUtils.isEnabled()) {\n      return;\n    }\n    const scale = this.scale;\n    const top = -this.scrollY;\n    const left = -this.scrollX;\n    if (\n      scale === this.oldScale &&\n      Math.abs(top - this.oldTop) < 1 &&\n      Math.abs(left - this.oldLeft) < 1\n    ) {\n      // Ignore sub-pixel changes in top and left. Due to #4192 there are a lot\n      // of negligible changes in viewport top/left.\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.VIEWPORT_CHANGE))(\n      top,\n      left,\n      scale,\n      this.id,\n      this.oldScale,\n    );\n    this.oldScale = scale;\n    this.oldTop = top;\n    this.oldLeft = left;\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Translate this workspace to new coordinates.\n   *\n   * @param x Horizontal translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   * @param y Vertical translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   */\n  translate(x: number, y: number) {\n    this.layerManager?.translateLayers(new Coordinate(x, y), this.scale);\n    this.grid?.moveTo(x, y);\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   *\n   * @returns Width.\n   */\n  override getWidth(): number {\n    const metrics = this.getMetrics();\n    return metrics ? metrics.viewWidth / this.scale : 0;\n  }\n\n  /**\n   * Toggles the visibility of the workspace.\n   * Currently only intended for main workspace.\n   *\n   * @param isVisible True if workspace should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    this.isVisible_ = isVisible;\n    if (!this.svgGroup_) {\n      return;\n    }\n\n    // Tell the scrollbar whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.scrollbar) {\n      this.scrollbar.setContainerVisible(isVisible);\n    }\n\n    // Tell the flyout whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.getFlyout()) {\n      this.getFlyout()!.setContainerVisible(isVisible);\n    }\n\n    this.getParentSvg().style.display = isVisible ? 'block' : 'none';\n    if (this.toolbox_) {\n      // Currently does not support toolboxes in mutators.\n      this.toolbox_.setVisible(isVisible);\n    }\n    if (!isVisible) {\n      this.hideChaff(true);\n    }\n  }\n\n  /**\n   * Render all blocks in workspace.\n   */\n  render() {\n    // Generate list of all blocks.\n    const blocks = this.getAllBlocks(false);\n    // Render each block.\n    for (let i = blocks.length - 1; i >= 0; i--) {\n      blocks[i].queueRender();\n    }\n\n    this.getTopBlocks()\n      .flatMap((block) => block.getDescendants(false))\n      .filter((block) => block.isInsertionMarker())\n      .forEach((block) => block.queueRender());\n\n    renderManagement\n      .finishQueuedRenders()\n      .then(() => void this.markerManager.updateMarkers());\n  }\n\n  /**\n   * Highlight or unhighlight a block in the workspace.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param id ID of block to highlight/unhighlight, or null for no block (used\n   *     to unhighlight all blocks).\n   * @param opt_state If undefined, highlight specified block and automatically\n   *     unhighlight all others.  If true or false, manually\n   *     highlight/unhighlight the specified block.\n   */\n  highlightBlock(id: string | null, opt_state?: boolean) {\n    if (opt_state === undefined) {\n      // Unhighlight all blocks.\n      for (let i = 0, block; (block = this.highlightedBlocks[i]); i++) {\n        block.setHighlighted(false);\n      }\n      this.highlightedBlocks.length = 0;\n    }\n    // Highlight/unhighlight the specified block.\n    const block = id ? this.getBlockById(id) : null;\n    if (block) {\n      const state = opt_state === undefined || opt_state;\n      // Using Set here would be great, but at the cost of IE10 support.\n      if (!state) {\n        arrayUtils.removeElem(this.highlightedBlocks, block);\n      } else if (!this.highlightedBlocks.includes(block)) {\n        this.highlightedBlocks.push(block);\n      }\n      block.setHighlighted(state);\n    }\n  }\n\n  /**\n   * Refresh the toolbox unless there's a drag in progress.\n   *\n   * @internal\n   */\n  refreshToolboxSelection() {\n    const ws = this.isFlyout ? this.targetWorkspace : this;\n    if (ws && !ws.currentGesture_ && ws.toolbox_ && ws.toolbox_.getFlyout()) {\n      ws.toolbox_.refreshSelection();\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map.  Update the\n   *     flyout to show the renamed variable immediately.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  override renameVariableById(id: string, newName: string) {\n    super.renameVariableById(id, newName);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Delete a variable by the passed in ID.   Update the flyout to show\n   *     immediately that the variable is deleted.\n   *\n   * @param id ID of variable to delete.\n   */\n  override deleteVariableById(id: string) {\n    super.deleteVariableById(id);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Create a new variable with the given name.  Update the flyout to show the\n   *     new variable immediately.\n   *\n   * @param name The new variable's name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  override createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    const newVar = super.createVariable(name, opt_type, opt_id);\n    this.refreshToolboxSelection();\n    return newVar;\n  }\n\n  /** Make a list of all the delete areas for this workspace. */\n  recordDragTargets() {\n    const dragTargets = this.componentManager.getComponents(\n      ComponentManager.Capability.DRAG_TARGET,\n      true,\n    );\n\n    this.dragTargetAreas = [];\n    for (let i = 0, targetArea; (targetArea = dragTargets[i]); i++) {\n      const rect = targetArea.getClientRect();\n      if (rect) {\n        this.dragTargetAreas.push({\n          component: targetArea,\n          clientRect: rect,\n        });\n      }\n    }\n  }\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  override newBlock(prototypeName: string, opt_id?: string): BlockSvg {\n    throw new Error(\n      'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Obtain a newly created comment.\n   *\n   * @param id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created comment.\n   */\n  newComment(id?: string): WorkspaceComment {\n    throw new Error(\n      'The implementation of newComment should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n  /* eslint-enable */\n\n  /**\n   * Returns the drag target the pointer event is over.\n   *\n   * @param e Pointer move event.\n   * @returns Null if not over a drag target, or the drag target the event is\n   *     over.\n   */\n  getDragTarget(e: PointerEvent): IDragTarget | null {\n    for (let i = 0, targetArea; (targetArea = this.dragTargetAreas[i]); i++) {\n      if (targetArea.clientRect.contains(e.clientX, e.clientY)) {\n        return targetArea.component;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Handle a pointerdown on SVG drawing surface.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.getGesture(e);\n    if (gesture) {\n      gesture.handleWsStart(e, this);\n    }\n  }\n\n  /**\n   * Start tracking a drag of an object on this workspace.\n   *\n   * @param e Pointer down event.\n   * @param xy Starting location of object.\n   */\n  startDrag(e: PointerEvent, xy: Coordinate) {\n    // Record the starting offset between the bubble's location and the mouse.\n    const point = browserEvents.mouseToSvg(\n      e,\n      this.getParentSvg(),\n      this.getInverseScreenCTM(),\n    );\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    this.dragDeltaXY = Coordinate.difference(xy, point);\n  }\n\n  /**\n   * Track a drag of an object on this workspace.\n   *\n   * @param e Pointer move event.\n   * @returns New location of object.\n   */\n  moveDrag(e: PointerEvent): Coordinate {\n    const point = browserEvents.mouseToSvg(\n      e,\n      this.getParentSvg(),\n      this.getInverseScreenCTM(),\n    );\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    return Coordinate.sum(this.dragDeltaXY!, point);\n  }\n\n  /**\n   * Is the user currently dragging a block or scrolling the flyout/workspace?\n   *\n   * @returns True if currently dragging or scrolling.\n   */\n  isDragging(): boolean {\n    return this.currentGesture_ !== null && this.currentGesture_.isDragging();\n  }\n\n  /**\n   * Is this workspace draggable?\n   *\n   * @returns True if this workspace may be dragged.\n   */\n  isDraggable(): boolean {\n    return this.options.moveOptions && this.options.moveOptions.drag;\n  }\n\n  /**\n   * Is this workspace movable?\n   *\n   * This means the user can reposition the X Y coordinates of the workspace\n   * through input. This can be through scrollbars, scroll wheel, dragging, or\n   * through zooming with the scroll wheel or pinch (since the zoom is centered\n   * on the mouse position). This does not include zooming with the zoom\n   * controls since the X Y coordinates are decided programmatically.\n   *\n   * @returns True if the workspace is movable, false otherwise.\n   */\n  isMovable(): boolean {\n    return (\n      (this.options.moveOptions && !!this.options.moveOptions.scrollbars) ||\n      (this.options.moveOptions && this.options.moveOptions.wheel) ||\n      (this.options.moveOptions && this.options.moveOptions.drag) ||\n      (this.options.zoomOptions && this.options.zoomOptions.wheel) ||\n      (this.options.zoomOptions && this.options.zoomOptions.pinch)\n    );\n  }\n\n  /**\n   * Is this workspace movable horizontally?\n   *\n   * @returns True if the workspace is movable horizontally, false otherwise.\n   */\n  isMovableHorizontally(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return (\n      this.isMovable() &&\n      (!hasScrollbars ||\n        (hasScrollbars && this.scrollbar!.canScrollHorizontally()))\n    );\n  }\n\n  /**\n   * Is this workspace movable vertically?\n   *\n   * @returns True if the workspace is movable vertically, false otherwise.\n   */\n  isMovableVertically(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return (\n      this.isMovable() &&\n      (!hasScrollbars ||\n        (hasScrollbars && this.scrollbar!.canScrollVertically()))\n    );\n  }\n\n  /**\n   * Handle a mouse-wheel on SVG drawing surface.\n   *\n   * @param e Mouse wheel event.\n   */\n  private onMouseWheel_(e: WheelEvent) {\n    // Don't scroll or zoom anything if drag is in progress.\n    if (Gesture.inProgress()) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    const canWheelZoom =\n      this.options.zoomOptions && this.options.zoomOptions.wheel;\n    const canWheelMove =\n      this.options.moveOptions && this.options.moveOptions.wheel;\n    if (!canWheelZoom && !canWheelMove) {\n      return;\n    }\n\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    // Zoom should also be enabled by the command key on Mac devices,\n    // but not super on Unix.\n    let commandKey;\n    if (userAgent.MAC) {\n      commandKey = e.metaKey;\n    }\n\n    if (canWheelZoom && (e.ctrlKey || commandKey || !canWheelMove)) {\n      // Zoom.\n      // The vertical scroll distance that corresponds to a click of a zoom\n      // button.\n      const PIXELS_PER_ZOOM_STEP = 50;\n      const delta = -scrollDelta.y / PIXELS_PER_ZOOM_STEP;\n      const position = browserEvents.mouseToSvg(\n        e,\n        this.getParentSvg(),\n        this.getInverseScreenCTM(),\n      );\n      this.zoom(position.x, position.y, delta);\n    } else {\n      // Scroll.\n      let x = this.scrollX - scrollDelta.x;\n      let y = this.scrollY - scrollDelta.y;\n\n      if (e.shiftKey && !scrollDelta.x) {\n        // Scroll horizontally (based on vertical scroll delta).\n        // This is needed as for some browser/system combinations which do not\n        // set deltaX.\n        x = this.scrollX - scrollDelta.y;\n        y = this.scrollY; // Don't scroll vertically.\n      }\n      this.scroll(x, y);\n    }\n    e.preventDefault();\n  }\n\n  /**\n   * Calculate the bounding box for the blocks on the workspace.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Contains the position and size of the bounding box containing the\n   *     blocks on the workspace.\n   */\n  getBlocksBoundingBox(): Rect {\n    const topElements = this.getTopBoundedElements();\n    // There are no blocks, return empty rectangle.\n    if (!topElements.length) {\n      return new Rect(0, 0, 0, 0);\n    }\n\n    // Initialize boundary using the first block.\n    const boundary = topElements[0].getBoundingRectangle();\n\n    // Start at 1 since the 0th block was used for initialization.\n    for (let i = 1; i < topElements.length; i++) {\n      const topElement = topElements[i];\n      if (\n        (topElement as any).isInsertionMarker &&\n        (topElement as any).isInsertionMarker()\n      ) {\n        continue;\n      }\n      const blockBoundary = topElement.getBoundingRectangle();\n      if (blockBoundary.top < boundary.top) {\n        boundary.top = blockBoundary.top;\n      }\n      if (blockBoundary.bottom > boundary.bottom) {\n        boundary.bottom = blockBoundary.bottom;\n      }\n      if (blockBoundary.left < boundary.left) {\n        boundary.left = blockBoundary.left;\n      }\n      if (blockBoundary.right > boundary.right) {\n        boundary.right = blockBoundary.right;\n      }\n    }\n    return boundary;\n  }\n\n  /** Clean up the workspace by ordering all the blocks in a column. */\n  cleanUp() {\n    this.setResizesEnabled(false);\n    eventUtils.setGroup(true);\n    const topBlocks = this.getTopBlocks(true);\n    let cursorY = 0;\n    for (let i = 0, block; (block = topBlocks[i]); i++) {\n      if (!block.isMovable()) {\n        continue;\n      }\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(-xy.x, cursorY - xy.y, ['cleanup']);\n      block.snapToGrid();\n      cursorY =\n        block.getRelativeToSurfaceXY().y +\n        block.getHeightWidth().height +\n        this.renderer.getConstants().MIN_BLOCK_HEIGHT;\n    }\n    eventUtils.setGroup(false);\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Show the context menu for the workspace.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: PointerEvent) {\n    if (this.options.readOnly || this.isFlyout) {\n      return;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.WORKSPACE,\n      {workspace: this},\n    );\n\n    // Allow the developer to add or modify menuOptions.\n    if (this.configureContextMenu) {\n      this.configureContextMenu(menuOptions, e);\n    }\n\n    ContextMenu.show(e, menuOptions, this.RTL, this);\n  }\n\n  /**\n   * Modify the block tree on the existing toolbox.\n   *\n   * @param toolboxDef DOM tree of toolbox contents, string of toolbox contents,\n   *     or JSON representing toolbox definition.\n   */\n  updateToolbox(toolboxDef: toolbox.ToolboxDefinition | null) {\n    const parsedToolboxDef = toolbox.convertToolboxDefToJson(toolboxDef);\n\n    if (!parsedToolboxDef) {\n      if (this.options.languageTree) {\n        throw Error(\"Can't nullify an existing toolbox.\");\n      }\n      return; // No change (null to null).\n    }\n    if (!this.options.languageTree) {\n      throw Error(\"Existing toolbox is null.  Can't create new toolbox.\");\n    }\n\n    if (toolbox.hasCategories(parsedToolboxDef)) {\n      if (!this.toolbox_) {\n        throw Error(\"Existing toolbox has no categories.  Can't change mode.\");\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.toolbox_.render(parsedToolboxDef);\n    } else {\n      if (!this.flyout) {\n        throw Error(\"Existing toolbox has categories.  Can't change mode.\");\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.flyout.show(parsedToolboxDef);\n    }\n  }\n\n  /** Mark this workspace as the currently focused main workspace. */\n  markFocused() {\n    if (this.options.parentWorkspace) {\n      this.options.parentWorkspace.markFocused();\n    } else {\n      common.setMainWorkspace(this);\n      // We call e.preventDefault in many event handlers which means we\n      // need to explicitly grab focus (e.g from a textarea) because\n      // the browser will not do it for us.\n      this.getParentSvg().focus({preventScroll: true});\n    }\n  }\n\n  /**\n   * Zooms the workspace in or out relative to/centered on the given (x, y)\n   * coordinate.\n   *\n   * @param x X coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param y Y coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param amount Amount of zooming. The formula for the new scale is newScale\n   *     = currentScale * (scaleSpeed^amount). scaleSpeed is set in the\n   *     workspace options. Negative amount values zoom out, and positive amount\n   *     values zoom in.\n   */\n  zoom(x: number, y: number, amount: number) {\n    // Scale factor.\n    const speed = this.options.zoomOptions.scaleSpeed;\n    let scaleChange = Math.pow(speed, amount);\n    const newScale = this.scale * scaleChange;\n    if (this.scale === newScale) {\n      return; // No change in zoom.\n    }\n\n    // Clamp scale within valid range.\n    if (newScale > this.options.zoomOptions.maxScale) {\n      scaleChange = this.options.zoomOptions.maxScale / this.scale;\n    } else if (newScale < this.options.zoomOptions.minScale) {\n      scaleChange = this.options.zoomOptions.minScale / this.scale;\n    }\n\n    // Transform the x/y coordinates from the parentSVG's space into the\n    // canvas' space, so that they are in workspace units relative to the top\n    // left of the visible portion of the workspace.\n    let matrix = this.getCanvas().getCTM();\n    let center = this.getParentSvg().createSVGPoint();\n    center.x = x;\n    center.y = y;\n    center = center.matrixTransform(matrix!.inverse());\n    x = center.x;\n    y = center.y;\n\n    // Find the new scrollX/scrollY so that the center remains in the same\n    // position (relative to the center) after we zoom.\n    // newScale and matrix.a should be identical (within a rounding error).\n    matrix = matrix!\n      .translate(x * (1 - scaleChange), y * (1 - scaleChange))\n      .scale(scaleChange);\n    // scrollX and scrollY are in pixels.\n    // The scrollX and scrollY still need to have absoluteLeft and absoluteTop\n    // subtracted from them, but we'll leave that for setScale so that they're\n    // correctly updated for the new flyout size if we have a simple toolbox.\n    this.scrollX = matrix.e;\n    this.scrollY = matrix.f;\n    this.setScale(newScale);\n  }\n\n  /**\n   * Zooming the blocks centered in the center of view with zooming in or out.\n   *\n   * @param type Type of zooming (-1 zooming out and 1 zooming in).\n   */\n  zoomCenter(type: number) {\n    const metrics = this.getMetrics();\n    let x;\n    let y;\n    if (this.flyout) {\n      // If you want blocks in the center of the view (visible portion of the\n      // workspace) to stay centered when the size of the view decreases (i.e.\n      // when the size of the flyout increases) you need the center of the\n      // *blockly div* to stay in the same pixel-position.\n      // Note: This only works because of how scrollCenter positions blocks.\n      x = metrics.svgWidth ? metrics.svgWidth / 2 : 0;\n      y = metrics.svgHeight ? metrics.svgHeight / 2 : 0;\n    } else {\n      x = metrics.viewWidth / 2 + metrics.absoluteLeft;\n      y = metrics.viewHeight / 2 + metrics.absoluteTop;\n    }\n    this.zoom(x, y, type);\n  }\n\n  /** Zoom the blocks to fit in the workspace if possible. */\n  zoomToFit() {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let workspaceWidth = metrics.viewWidth;\n    let workspaceHeight = metrics.viewHeight;\n    const blocksBox = this.getBlocksBoundingBox();\n    const doubleMargin = ZOOM_TO_FIT_MARGIN * 2;\n    let blocksWidth = blocksBox.right - blocksBox.left + doubleMargin;\n    let blocksHeight = blocksBox.bottom - blocksBox.top + doubleMargin;\n    if (!blocksWidth) {\n      return; // Prevents zooming to infinity.\n    }\n    if (this.flyout) {\n      // We have to add the flyout size to both the workspace size and the\n      // block size because the blocks we want to resize include the blocks in\n      // the flyout, and the area we want to fit them includes the portion of\n      // the workspace that is behind the flyout.\n      if (this.horizontalLayout) {\n        workspaceHeight += this.flyout.getHeight();\n        // Convert from pixels to workspace coordinates.\n        blocksHeight += this.flyout.getHeight() / this.scale;\n      } else {\n        workspaceWidth += this.flyout.getWidth();\n        // Convert from pixels to workspace coordinates.\n        blocksWidth += this.flyout.getWidth() / this.scale;\n      }\n    }\n\n    // Scale Units: (pixels / workspaceUnit)\n    const ratioX = workspaceWidth / blocksWidth;\n    const ratioY = workspaceHeight / blocksHeight;\n    eventUtils.disable();\n    try {\n      this.setScale(Math.min(ratioX, ratioY));\n      this.scrollCenter();\n    } finally {\n      eventUtils.enable();\n    }\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Add a transition class to the block and bubble canvas, to animate any\n   * transform changes.\n   *\n   * @internal\n   */\n  beginCanvasTransition() {\n    dom.addClass(this.getCanvas(), 'blocklyCanvasTransitioning');\n    dom.addClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\n  }\n\n  /**\n   * Remove transition class from the block and bubble canvas.\n   *\n   * @internal\n   */\n  endCanvasTransition() {\n    dom.removeClass(this.getCanvas(), 'blocklyCanvasTransitioning');\n    dom.removeClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\n  }\n\n  /** Center the workspace. */\n  scrollCenter() {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let x = (metrics.scrollWidth - metrics.viewWidth) / 2;\n    let y = (metrics.scrollHeight - metrics.viewHeight) / 2;\n\n    // Convert from workspace directions to canvas directions.\n    x = -x - metrics.scrollLeft;\n    y = -y - metrics.scrollTop;\n    this.scroll(x, y);\n  }\n\n  /**\n   * Scroll the workspace to center on the given block. If the block has other\n   * blocks stacked below it, the workspace will be centered on the stack,\n   * unless blockOnly is true.\n   *\n   * @param id ID of block center on.\n   * @param blockOnly True to center only on the block itself, not its stack.\n   */\n  centerOnBlock(id: string | null, blockOnly?: boolean) {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const block = id ? this.getBlockById(id) : null;\n    if (!block) {\n      return;\n    }\n\n    // XY is in workspace coordinates.\n    const xy = block.getRelativeToSurfaceXY();\n    // Height/width is in workspace units.\n    const heightWidth = blockOnly\n      ? {height: block.height, width: block.width}\n      : block.getHeightWidth();\n\n    // Find the enter of the block in workspace units.\n    const blockCenterY = xy.y + heightWidth.height / 2;\n\n    // In RTL the block's position is the top right of the block, not top left.\n    const multiplier = this.RTL ? -1 : 1;\n    const blockCenterX = xy.x + (multiplier * heightWidth.width) / 2;\n\n    // Workspace scale, used to convert from workspace coordinates to pixels.\n    const scale = this.scale;\n\n    // Center of block in pixels, relative to workspace origin (center 0,0).\n    // Scrolling to here would put the block in the top-left corner of the\n    // visible workspace.\n    const pixelX = blockCenterX * scale;\n    const pixelY = blockCenterY * scale;\n\n    const metrics = this.getMetrics();\n\n    // viewHeight and viewWidth are in pixels.\n    const halfViewWidth = metrics.viewWidth / 2;\n    const halfViewHeight = metrics.viewHeight / 2;\n\n    // Put the block in the center of the visible workspace instead.\n    const scrollToCenterX = pixelX - halfViewWidth;\n    const scrollToCenterY = pixelY - halfViewHeight;\n\n    // Convert from workspace directions to canvas directions.\n    const x = -scrollToCenterX;\n    const y = -scrollToCenterY;\n\n    this.scroll(x, y);\n  }\n\n  /**\n   * Set the workspace's zoom factor.\n   *\n   * @param newScale Zoom factor. Units: (pixels / workspaceUnit).\n   */\n  setScale(newScale: number) {\n    if (\n      this.options.zoomOptions.maxScale &&\n      newScale > this.options.zoomOptions.maxScale\n    ) {\n      newScale = this.options.zoomOptions.maxScale;\n    } else if (\n      this.options.zoomOptions.minScale &&\n      newScale < this.options.zoomOptions.minScale\n    ) {\n      newScale = this.options.zoomOptions.minScale;\n    }\n    this.scale = newScale;\n\n    this.hideChaff(false);\n    // Get the flyout, if any, whether our own or owned by the toolbox.\n    const flyout = this.getFlyout(false);\n    if (flyout && flyout.isVisible()) {\n      flyout.reflow();\n      this.recordDragTargets();\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n\n    // We call scroll instead of scrollbar.resize() so that we can center the\n    // zoom correctly without scrollbars, but scroll does not resize the\n    // scrollbars so we have to call resizeView/resizeContent as well.\n    const metrics = this.getMetrics();\n\n    this.scrollX -= metrics.absoluteLeft;\n    this.scrollY -= metrics.absoluteTop;\n    // The scroll values and the view values are additive inverses of\n    // each other, so when we subtract from one we have to add to the other.\n    metrics.viewLeft += metrics.absoluteLeft;\n    metrics.viewTop += metrics.absoluteTop;\n\n    this.scroll(this.scrollX, this.scrollY);\n    if (this.scrollbar) {\n      if (this.flyout) {\n        this.scrollbar.resizeView(metrics);\n      } else {\n        this.scrollbar.resizeContent(metrics);\n      }\n    }\n  }\n\n  /**\n   * Get the workspace's zoom factor.  If the workspace has a parent, we call\n   * into the parent to get the workspace scale.\n   *\n   * @returns The workspace zoom factor. Units: (pixels / workspaceUnit).\n   */\n  getScale(): number {\n    if (this.options.parentWorkspace) {\n      return this.options.parentWorkspace.getScale();\n    }\n    return this.scale;\n  }\n\n  /**\n   * Scroll the workspace to a specified offset (in pixels), keeping in the\n   * workspace bounds. See comment on workspaceSvg.scrollX for more detail on\n   * the meaning of these values.\n   *\n   * @param x Target X to scroll to.\n   * @param y Target Y to scroll to.\n   */\n  scroll(x: number, y: number) {\n    this.hideChaff(/* opt_onlyClosePopups= */ true);\n\n    // Keep scrolling within the bounds of the content.\n    const metrics = this.getMetrics();\n    // Canvas coordinates (aka scroll coordinates) have inverse directionality\n    // to workspace coordinates so we have to inverse them.\n    x = Math.min(x, -metrics.scrollLeft);\n    y = Math.min(y, -metrics.scrollTop);\n    const maxXDisplacement = Math.max(\n      0,\n      metrics.scrollWidth - metrics.viewWidth,\n    );\n    const maxXScroll = metrics.scrollLeft + maxXDisplacement;\n    const maxYDisplacement = Math.max(\n      0,\n      metrics.scrollHeight - metrics.viewHeight,\n    );\n    const maxYScroll = metrics.scrollTop + maxYDisplacement;\n    x = Math.max(x, -maxXScroll);\n    y = Math.max(y, -maxYScroll);\n    this.scrollX = x;\n    this.scrollY = y;\n\n    if (this.scrollbar) {\n      // The content position (displacement from the content's top-left to the\n      // origin) plus the scroll position (displacement from the view's top-left\n      // to the origin) gives us the distance from the view's top-left to the\n      // content's top-left. Then we negate this so we get the displacement from\n      // the content's top-left to the view's top-left, matching the\n      // directionality of the scrollbars.\n      this.scrollbar.set(\n        -(x + metrics.scrollLeft),\n        -(y + metrics.scrollTop),\n        false,\n      );\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    x += metrics.absoluteLeft;\n    y += metrics.absoluteTop;\n    this.translate(x, y);\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  override getBlockById(id: string): BlockSvg | null {\n    return super.getBlockById(id) as BlockSvg;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getAllBlocks(ordered = false): BlockSvg[] {\n    return super.getAllBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  override getTopBlocks(ordered = false): BlockSvg[] {\n    return super.getTopBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  override addTopBlock(block: Block) {\n    this.addTopBoundedElement(block as BlockSvg);\n    super.addTopBlock(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  override removeTopBlock(block: Block) {\n    this.removeTopBoundedElement(block as BlockSvg);\n    super.removeTopBlock(block);\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   */\n  override addTopComment(comment: WorkspaceComment) {\n    this.addTopBoundedElement(comment as RenderedWorkspaceComment);\n    super.addTopComment(comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   */\n  override removeTopComment(comment: WorkspaceComment) {\n    this.removeTopBoundedElement(comment as RenderedWorkspaceComment);\n    super.removeTopComment(comment);\n  }\n\n  override getRootWorkspace(): WorkspaceSvg | null {\n    return super.getRootWorkspace() as WorkspaceSvg | null;\n  }\n\n  /**\n   * Adds a bounded element to the list of top bounded elements.\n   *\n   * @param element Bounded element to add.\n   */\n  addTopBoundedElement(element: IBoundedElement) {\n    this.topBoundedElements.push(element);\n  }\n\n  /**\n   * Removes a bounded element from the list of top bounded elements.\n   *\n   * @param element Bounded element to remove.\n   */\n  removeTopBoundedElement(element: IBoundedElement) {\n    arrayUtils.removeElem(this.topBoundedElements, element);\n  }\n\n  /**\n   * Finds the top-level bounded elements and returns them.\n   *\n   * @returns The top-level bounded elements.\n   */\n  getTopBoundedElements(): IBoundedElement[] {\n    return new Array<IBoundedElement>().concat(this.topBoundedElements);\n  }\n\n  /**\n   * Update whether this workspace has resizes enabled.\n   * If enabled, workspace will resize when appropriate.\n   * If disabled, workspace will not resize until re-enabled.\n   * Use to avoid resizing during a batch operation, for performance.\n   *\n   * @param enabled Whether resizes should be enabled.\n   */\n  setResizesEnabled(enabled: boolean) {\n    const reenabled = !this.resizesEnabled && enabled;\n    this.resizesEnabled = enabled;\n    if (reenabled) {\n      // Newly enabled.  Trigger a resize.\n      this.resizeContents();\n    }\n  }\n\n  /**\n   * Dispose of all blocks in workspace, with an optimization to prevent\n   * resizes.\n   */\n  override clear() {\n    this.setResizesEnabled(false);\n    super.clear();\n    this.topBoundedElements = [];\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   * For instance, a button specified by the XML\n   * <button text=\"create variable\" callbackKey=\"CREATE_VARIABLE\"></button>\n   * should be matched by a call to\n   * registerButtonCallback(\"CREATE_VARIABLE\", yourCallbackFunction).\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given button is clicked.\n   */\n  registerButtonCallback(key: string, func: (p1: FlyoutButton) => void) {\n    if (typeof func !== 'function') {\n      throw TypeError('Button callbacks must be functions.');\n    }\n    this.flyoutButtonCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace;\n   *     null if no callback is registered.\n   */\n  getButtonCallback(key: string): ((p1: FlyoutButton) => void) | null {\n    return this.flyoutButtonCallbacks.get(key) ?? null;\n  }\n\n  /**\n   * Remove a callback for a click on a button in the flyout.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeButtonCallback(key: string) {\n    this.flyoutButtonCallbacks.delete(key);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.  See the variable and\n   * procedure categories as an example.\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given toolbox category is opened.\n   */\n  registerToolboxCategoryCallback(\n    key: string,\n    func: (p1: WorkspaceSvg) => toolbox.FlyoutDefinition,\n  ) {\n    if (typeof func !== 'function') {\n      throw TypeError('Toolbox category callbacks must be functions.');\n    }\n    this.toolboxCategoryCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace, or\n   *     null if no function is registered.\n   */\n  getToolboxCategoryCallback(\n    key: string,\n  ): ((p1: WorkspaceSvg) => toolbox.FlyoutDefinition) | null {\n    return this.toolboxCategoryCallbacks.get(key) || null;\n  }\n\n  /**\n   * Remove a callback for a click on a custom category's name in the toolbox.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeToolboxCategoryCallback(key: string) {\n    this.toolboxCategoryCallbacks.delete(key);\n  }\n\n  /**\n   * Look up the gesture that is tracking this touch stream on this workspace.\n   * May create a new gesture.\n   *\n   * @param e Pointer event.\n   * @returns The gesture that is tracking this touch stream, or null if no\n   *     valid gesture exists.\n   * @internal\n   */\n  getGesture(e: PointerEvent): Gesture | null {\n    const isStart = e.type === 'pointerdown';\n\n    const gesture = this.currentGesture_;\n    if (gesture) {\n      if (isStart && gesture.hasStarted()) {\n        console.warn('Tried to start the same gesture twice.');\n        // That's funny.  We must have missed a mouse up.\n        // Cancel it, rather than try to retrieve all of the state we need.\n        gesture.cancel();\n        return null;\n      }\n      return gesture;\n    }\n\n    // No gesture existed on this workspace, but this looks like the start of a\n    // new gesture.\n    if (isStart) {\n      this.currentGesture_ = new Gesture(e, this);\n      return this.currentGesture_;\n    }\n    // No gesture existed and this event couldn't be the start of a new gesture.\n    return null;\n  }\n\n  /**\n   * Clear the reference to the current gesture.\n   *\n   * @internal\n   */\n  clearGesture() {\n    this.currentGesture_ = null;\n  }\n\n  /**\n   * Cancel the current gesture, if one exists.\n   *\n   * @internal\n   */\n  cancelCurrentGesture() {\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n  }\n\n  /**\n   * Get the audio manager for this workspace.\n   *\n   * @returns The audio manager for this workspace.\n   */\n  getAudioManager(): WorkspaceAudio {\n    return this.audioManager;\n  }\n\n  /**\n   * Get the grid object for this workspace, or null if there is none.\n   *\n   * @returns The grid object for this workspace.\n   */\n  getGrid(): Grid | null {\n    return this.grid;\n  }\n\n  /**\n   * Close tooltips, context menus, dropdown selections, etc.\n   *\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\n   *     false.\n   */\n  hideChaff(onlyClosePopups = false) {\n    Tooltip.hide();\n    WidgetDiv.hideIfOwnerIsInWorkspace(this);\n    dropDownDiv.hideWithoutAnimation();\n\n    this.hideComponents(onlyClosePopups);\n  }\n\n  /**\n   * Hide any autohideable components (like flyout, trashcan, and any\n   * user-registered components).\n   *\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\n   *     false.\n   */\n  hideComponents(onlyClosePopups = false) {\n    const autoHideables = this.getComponentManager().getComponents(\n      ComponentManager.Capability.AUTOHIDEABLE,\n      true,\n    );\n    autoHideables.forEach((autoHideable) =>\n      autoHideable.autoHide(onlyClosePopups),\n    );\n  }\n\n  /**\n   * Sets the X/Y translations of a top level workspace.\n   *\n   * @param xyRatio Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  private static setTopLevelWorkspaceMetrics_(\n    this: WorkspaceSvg,\n    xyRatio: {x?: number; y?: number},\n  ) {\n    const metrics = this.getMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.scrollX = -(\n        metrics.scrollLeft +\n        (metrics.scrollWidth - metrics.viewWidth) * xyRatio.x\n      );\n    }\n    if (typeof xyRatio.y === 'number') {\n      this.scrollY = -(\n        metrics.scrollTop +\n        (metrics.scrollHeight - metrics.viewHeight) * xyRatio.y\n      );\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    const x = this.scrollX + metrics.absoluteLeft;\n    const y = this.scrollY + metrics.absoluteTop;\n    // We could call scroll here, but that has extra checks we don't need to do.\n    this.translate(x, y);\n  }\n}\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @internal\n */\nexport function resizeSvgContents(workspace: WorkspaceSvg) {\n  workspace.resizeContents();\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from '../block_svg.js';\nimport * as registry from './registry.js';\nimport {ICopyData} from '../interfaces/i_copyable.js';\nimport {IPaster} from '../interfaces/i_paster.js';\nimport {State, append} from '../serialization/blocks.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as eventUtils from '../events/utils.js';\nimport {config} from '../config.js';\nimport * as common from '../common.js';\n\nexport class BlockPaster implements IPaster<BlockCopyData, BlockSvg> {\n  static TYPE = 'block';\n\n  paste(\n    copyData: BlockCopyData,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): BlockSvg | null {\n    if (!workspace.isCapacityAvailable(copyData.typeCounts!)) return null;\n\n    if (coordinate) {\n      copyData.blockState['x'] = coordinate.x;\n      copyData.blockState['y'] = coordinate.y;\n    }\n\n    // After appending the block to the workspace, it will be bumped from its neighbors\n    // However, the algorithm for deciding where to paste a block depends on\n    // the starting position of the copied block, so we'll pass those coordinates along\n    const initialCoordinates =\n      coordinate ||\n      new Coordinate(\n        copyData.blockState['x'] || 0,\n        copyData.blockState['y'] || 0,\n      );\n\n    eventUtils.disable();\n    let block;\n    try {\n      block = append(copyData.blockState, workspace) as BlockSvg;\n      moveBlockToNotConflict(block, initialCoordinates);\n    } finally {\n      eventUtils.enable();\n    }\n\n    if (!block) return block;\n\n    if (eventUtils.isEnabled() && !block.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\n    }\n    common.setSelected(block);\n    return block;\n  }\n}\n\n/**\n * Moves the given block to a location where it does not: (1) overlap exactly\n * with any other blocks, or (2) look like it is connected to any other blocks.\n *\n * Exported for testing.\n *\n * @param block The block to move to an unambiguous location.\n * @param originalPosition The initial coordinate to start searching from,\n *    likely the position of the copied block.\n * @internal\n */\nexport function moveBlockToNotConflict(\n  block: BlockSvg,\n  originalPosition: Coordinate,\n) {\n  const workspace = block.workspace;\n  const snapRadius = config.snapRadius;\n  const bumpOffset = Coordinate.difference(\n    originalPosition,\n    block.getRelativeToSurfaceXY(),\n  );\n  const offset = new Coordinate(0, 0);\n  // getRelativeToSurfaceXY is really expensive, so we want to cache this.\n  const otherCoords = workspace\n    .getAllBlocks(false)\n    .filter((otherBlock) => otherBlock.id != block.id)\n    .map((b) => b.getRelativeToSurfaceXY());\n\n  while (\n    blockOverlapsOtherExactly(\n      Coordinate.sum(originalPosition, offset),\n      otherCoords,\n    ) ||\n    blockIsInSnapRadius(block, Coordinate.sum(bumpOffset, offset), snapRadius)\n  ) {\n    if (workspace.RTL) {\n      offset.translate(-snapRadius, snapRadius * 2);\n    } else {\n      offset.translate(snapRadius, snapRadius * 2);\n    }\n  }\n\n  block!.moveTo(Coordinate.sum(originalPosition, offset));\n}\n\n/**\n * @returns true if the given block coordinates are less than a delta of 1 from\n *     any of the other coordinates.\n */\nfunction blockOverlapsOtherExactly(\n  coord: Coordinate,\n  otherCoords: Coordinate[],\n): boolean {\n  return otherCoords.some(\n    (otherCoord) =>\n      Math.abs(otherCoord.x - coord.x) <= 1 &&\n      Math.abs(otherCoord.y - coord.y) <= 1,\n  );\n}\n\n/**\n * @returns true if the given block (when offset by the given amount) is close\n *     enough to any other connections (within the snap radius) that it looks\n *     like they could connect.\n */\nfunction blockIsInSnapRadius(\n  block: BlockSvg,\n  offset: Coordinate,\n  snapRadius: number,\n): boolean {\n  return block\n    .getConnections_(false)\n    .some((connection) => !!connection.closest(snapRadius, offset).connection);\n}\n\nexport interface BlockCopyData extends ICopyData {\n  blockState: State;\n  typeCounts: {[key: string]: number};\n}\n\nregistry.register(BlockPaster.TYPE, new BlockPaster());\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.bumpObjects\n\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockCreate} from './events/events_block_create.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport type {CommentCreate} from './events/events_comment_create.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport type {ViewportChange} from './events/events_viewport.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport * as mathUtils from './utils/math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Bumps the given object that has passed out of bounds.\n *\n * @param workspace The workspace containing the object.\n * @param bounds The region to bump an object into. For example, pass\n *     ScrollMetrics to bump a block into the scrollable region of the\n *     workspace, or pass ViewMetrics to bump a block into the visible region of\n *     the workspace. This should be specified in workspace coordinates.\n * @param object The object to bump.\n * @returns True if object was bumped.\n */\nfunction bumpObjectIntoBounds(\n  workspace: WorkspaceSvg,\n  bounds: ContainerRegion,\n  object: IBoundedElement,\n): boolean {\n  // Compute new top/left position for object.\n  const objectMetrics = object.getBoundingRectangle();\n  const height = objectMetrics.bottom - objectMetrics.top;\n  const width = objectMetrics.right - objectMetrics.left;\n\n  const topClamp = bounds.top;\n  const boundsBottom = bounds.top + bounds.height;\n  const bottomClamp = boundsBottom - height;\n  // If the object is taller than the workspace we want to\n  // top-align the block\n  const newYPosition = mathUtils.clamp(\n    topClamp,\n    objectMetrics.top,\n    bottomClamp,\n  );\n  const deltaY = newYPosition - objectMetrics.top;\n\n  // Note: Even in RTL mode the \"anchor\" of the object is the\n  // top-left corner of the object.\n  let leftClamp = bounds.left;\n  const boundsRight = bounds.left + bounds.width;\n  let rightClamp = boundsRight - width;\n  if (workspace.RTL) {\n    // If the object is wider than the workspace and we're in RTL\n    // mode we want to right-align the block, which means setting\n    // the left clamp to match.\n    leftClamp = Math.min(rightClamp, leftClamp);\n  } else {\n    // If the object is wider than the workspace and we're in LTR\n    // mode we want to left-align the block, which means setting\n    // the right clamp to match.\n    rightClamp = Math.max(leftClamp, rightClamp);\n  }\n  const newXPosition = mathUtils.clamp(\n    leftClamp,\n    objectMetrics.left,\n    rightClamp,\n  );\n  const deltaX = newXPosition - objectMetrics.left;\n\n  if (deltaX || deltaY) {\n    object.moveBy(deltaX, deltaY, ['inbounds']);\n    return true;\n  }\n  return false;\n}\nexport const bumpIntoBounds = bumpObjectIntoBounds;\n\n/**\n * Creates a handler for bumping objects when they cross fixed bounds.\n *\n * @param workspace The workspace to handle.\n * @returns The event handler.\n */\nexport function bumpIntoBoundsHandler(\n  workspace: WorkspaceSvg,\n): (p1: Abstract) => void {\n  return (e) => {\n    const metricsManager = workspace.getMetricsManager();\n    if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n      return;\n    }\n\n    if (eventUtils.BUMP_EVENTS.includes(e.type ?? '')) {\n      const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n\n      // Triggered by move/create event\n      const object = extractObjectFromEvent(\n        workspace,\n        e as eventUtils.BumpEvent,\n      );\n      if (!object) {\n        return;\n      }\n      // Handle undo.\n      const existingGroup = eventUtils.getGroup() || false;\n      eventUtils.setGroup(e.group);\n\n      const wasBumped = bumpObjectIntoBounds(\n        workspace,\n        scrollMetricsInWsCoords,\n        object as IBoundedElement,\n      );\n\n      if (wasBumped && !e.group) {\n        console.warn(\n          'Moved object in bounds but there was no' +\n            ' event group. This may break undo.',\n        );\n      }\n      eventUtils.setGroup(existingGroup);\n    } else if (e.type === eventUtils.VIEWPORT_CHANGE) {\n      const viewportEvent = e as ViewportChange;\n      if (\n        viewportEvent.scale &&\n        viewportEvent.oldScale &&\n        viewportEvent.scale > viewportEvent.oldScale\n      ) {\n        bumpTopObjectsIntoBounds(workspace);\n      }\n    }\n  };\n}\n\n/**\n * Extracts the object from the given event.\n *\n * @param workspace The workspace the event originated\n *    from.\n * @param e An event containing an object.\n * @returns The extracted\n *    object.\n */\nfunction extractObjectFromEvent(\n  workspace: WorkspaceSvg,\n  e: eventUtils.BumpEvent,\n): IBoundedElement | null {\n  let object = null;\n  switch (e.type) {\n    case eventUtils.BLOCK_CREATE:\n    case eventUtils.BLOCK_MOVE:\n      object = workspace.getBlockById((e as BlockCreate | BlockMove).blockId!);\n      if (object) {\n        object = object.getRootBlock();\n      }\n      break;\n    case eventUtils.COMMENT_CREATE:\n    case eventUtils.COMMENT_MOVE:\n      object = workspace.getCommentById(\n        (e as CommentCreate | CommentMove).commentId!,\n      ) as RenderedWorkspaceComment;\n      break;\n  }\n  return object;\n}\n\n/**\n * Bumps the top objects in the given workspace into bounds.\n *\n * @param workspace The workspace.\n */\nexport function bumpTopObjectsIntoBounds(workspace: WorkspaceSvg) {\n  const metricsManager = workspace.getMetricsManager();\n  if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n    return;\n  }\n\n  const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n  const topBlocks = workspace.getTopBoundedElements();\n  for (let i = 0, block; (block = topBlocks[i]); i++) {\n    bumpObjectIntoBounds(workspace, scrollMetricsInWsCoords, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDeletable\n\n/**\n * The interface for an object that can be deleted.\n */\nexport interface IDeletable {\n  /**\n   * Get whether this object is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean;\n\n  /** Disposes of this object, cleaning up any references or DOM elements. */\n  dispose(): void;\n\n  /** Visually indicates that the object is pending deletion. */\n  setDeleteStyle(wouldDelete: boolean): void;\n}\n\n/** Returns whether the given object is an IDeletable. */\nexport function isDeletable(obj: any): obj is IDeletable {\n  return (\n    obj['isDeletable'] !== undefined &&\n    obj['dispose'] !== undefined &&\n    obj['setDeleteStyle'] !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.clipboard\n\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\nimport {BlockPaster} from './clipboard/block_paster.js';\nimport * as globalRegistry from './registry.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as registry from './clipboard/registry.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n/** Metadata about the object that is currently on the clipboard. */\nlet stashedCopyData: ICopyData | null = null;\n\nlet stashedWorkspace: WorkspaceSvg | null = null;\n\n/**\n * Private version of copy for stubbing in tests.\n */\nfunction copyInternal<T extends ICopyData>(toCopy: ICopyable<T>): T | null {\n  const data = toCopy.toCopyData();\n  stashedCopyData = data;\n  stashedWorkspace = (toCopy as any).workspace ?? null;\n  return data;\n}\n\n/**\n * Paste a pasteable element into the workspace.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nexport function paste<T extends ICopyData>(\n  copyData: T,\n  workspace: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<T> | null;\n\n/**\n * Pastes the last copied ICopyable into the workspace.\n *\n * @returns the pasted thing if the paste was successful, null otherwise.\n */\nexport function paste(): ICopyable<ICopyData> | null;\n\n/**\n * Pastes the given data into the workspace, or the last copied ICopyable if\n * no data is passed.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nexport function paste<T extends ICopyData>(\n  copyData?: T,\n  workspace?: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<ICopyData> | null {\n  if (!copyData || !workspace) {\n    if (!stashedCopyData || !stashedWorkspace) return null;\n    return pasteFromData(stashedCopyData, stashedWorkspace);\n  }\n  return pasteFromData(copyData, workspace, coordinate);\n}\n\n/**\n * Paste a pasteable element into the workspace.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nfunction pasteFromData<T extends ICopyData>(\n  copyData: T,\n  workspace: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<T> | null {\n  workspace = workspace.getRootWorkspace() ?? workspace;\n  return (globalRegistry\n    .getObject(globalRegistry.Type.PASTER, copyData.paster, false)\n    ?.paste(copyData, workspace, coordinate) ?? null) as ICopyable<T> | null;\n}\n\n/**\n * Private version of duplicate for stubbing in tests.\n */\nfunction duplicateInternal<\n  U extends ICopyData,\n  T extends ICopyable<U> & IHasWorkspace,\n>(toDuplicate: T): T | null {\n  const data = toDuplicate.toCopyData();\n  if (!data) return null;\n  return paste(data, toDuplicate.workspace) as T;\n}\n\ninterface IHasWorkspace {\n  workspace: WorkspaceSvg;\n}\n\nexport const TEST_ONLY = {\n  duplicateInternal,\n  copyInternal,\n};\n\nexport {BlockPaster, registry};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ICopyable\n\nimport type {ISelectable} from './i_selectable.js';\n\nexport interface ICopyable<T extends ICopyData> extends ISelectable {\n  /**\n   * Encode for copying.\n   *\n   * @returns Copy metadata.\n   */\n  toCopyData(): T | null;\n}\n\nexport namespace ICopyable {\n  export interface ICopyData {\n    paster: string;\n  }\n}\n\nexport type ICopyData = ICopyable.ICopyData;\n\n/** @returns true if the given object is copyable. */\nexport function isCopyable(obj: any): obj is ICopyable<ICopyData> {\n  return obj.toCopyData !== undefined;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ShortcutItems\n\nimport {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport {Gesture} from './gesture.js';\nimport {ICopyData, isCopyable} from './interfaces/i_copyable.js';\nimport {isDeletable} from './interfaces/i_deletable.js';\nimport {KeyboardShortcut, ShortcutRegistry} from './shortcut_registry.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {isDraggable} from './interfaces/i_draggable.js';\nimport * as eventUtils from './events/utils.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\n\n/**\n * Object holding the names of the default shortcut items.\n */\nexport enum names {\n  ESCAPE = 'escape',\n  DELETE = 'delete',\n  COPY = 'copy',\n  CUT = 'cut',\n  PASTE = 'paste',\n  UNDO = 'undo',\n  REDO = 'redo',\n}\n\n/**\n * Keyboard shortcut to hide chaff on escape.\n */\nexport function registerEscape() {\n  const escapeAction: KeyboardShortcut = {\n    name: names.ESCAPE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      return true;\n    },\n    keyCodes: [KeyCodes.ESC],\n  };\n  ShortcutRegistry.registry.register(escapeAction);\n}\n\n/**\n * Keyboard shortcut to delete a block on delete or backspace\n */\nexport function registerDelete() {\n  const deleteShortcut: KeyboardShortcut = {\n    name: names.DELETE,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        selected != null &&\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        !Gesture.inProgress()\n      );\n    },\n    callback(workspace, e) {\n      // Delete or backspace.\n      // Stop the browser from going back to the previous page.\n      // Do this first to prevent an error in the delete code from resulting in\n      // data loss.\n      e.preventDefault();\n      const selected = common.getSelected();\n      if (selected instanceof BlockSvg) {\n        selected.checkAndDelete();\n      } else if (isDeletable(selected) && selected.isDeletable()) {\n        eventUtils.setGroup(true);\n        selected.dispose();\n        eventUtils.setGroup(false);\n      }\n      return true;\n    },\n    keyCodes: [KeyCodes.DELETE, KeyCodes.BACKSPACE],\n  };\n  ShortcutRegistry.registry.register(deleteShortcut);\n}\n\nlet copyData: ICopyData | null = null;\nlet copyWorkspace: WorkspaceSvg | null = null;\nlet copyCoords: Coordinate | null = null;\n\n/**\n * Keyboard shortcut to copy a block on ctrl+c, cmd+c, or alt+c.\n */\nexport function registerCopy() {\n  const ctrlC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.CTRL,\n  ]);\n  const altC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.ALT,\n  ]);\n  const metaC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.META,\n  ]);\n\n  const copyShortcut: KeyboardShortcut = {\n    name: names.COPY,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        !Gesture.inProgress() &&\n        selected != null &&\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        isDraggable(selected) &&\n        selected.isMovable() &&\n        isCopyable(selected)\n      );\n    },\n    callback(workspace, e) {\n      // Prevent the default copy behavior, which may beep or otherwise indicate\n      // an error due to the lack of a selection.\n      e.preventDefault();\n      workspace.hideChaff();\n      const selected = common.getSelected();\n      if (!selected || !isCopyable(selected)) return false;\n      copyData = selected.toCopyData();\n      copyWorkspace = workspace;\n      copyCoords = isDraggable(selected)\n        ? selected.getRelativeToSurfaceXY()\n        : null;\n      return !!copyData;\n    },\n    keyCodes: [ctrlC, altC, metaC],\n  };\n  ShortcutRegistry.registry.register(copyShortcut);\n}\n\n/**\n * Keyboard shortcut to copy and delete a block on ctrl+x, cmd+x, or alt+x.\n */\nexport function registerCut() {\n  const ctrlX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.CTRL,\n  ]);\n  const altX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.ALT,\n  ]);\n  const metaX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.META,\n  ]);\n\n  const cutShortcut: KeyboardShortcut = {\n    name: names.CUT,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        !Gesture.inProgress() &&\n        selected != null &&\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        isDraggable(selected) &&\n        selected.isMovable() &&\n        !selected.workspace!.isFlyout\n      );\n    },\n    callback(workspace) {\n      const selected = common.getSelected();\n\n      if (selected instanceof BlockSvg) {\n        copyData = selected.toCopyData();\n        copyWorkspace = workspace;\n        copyCoords = selected.getRelativeToSurfaceXY();\n        selected.checkAndDelete();\n        return true;\n      } else if (\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        isCopyable(selected)\n      ) {\n        copyData = selected.toCopyData();\n        copyWorkspace = workspace;\n        copyCoords = isDraggable(selected)\n          ? selected.getRelativeToSurfaceXY()\n          : null;\n        selected.dispose();\n        return true;\n      }\n      return false;\n    },\n    keyCodes: [ctrlX, altX, metaX],\n  };\n\n  ShortcutRegistry.registry.register(cutShortcut);\n}\n\n/**\n * Keyboard shortcut to paste a block on ctrl+v, cmd+v, or alt+v.\n */\nexport function registerPaste() {\n  const ctrlV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.CTRL,\n  ]);\n  const altV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.ALT,\n  ]);\n  const metaV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.META,\n  ]);\n\n  const pasteShortcut: KeyboardShortcut = {\n    name: names.PASTE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback() {\n      if (!copyData || !copyWorkspace) return false;\n      if (!copyCoords) {\n        // If we don't have location data about the original copyable, let the\n        // paster determine position.\n        return !!clipboard.paste(copyData, copyWorkspace);\n      }\n\n      const {left, top, width, height} = copyWorkspace\n        .getMetricsManager()\n        .getViewMetrics(true);\n      const viewportRect = new Rect(top, top + height, left, left + width);\n\n      if (viewportRect.contains(copyCoords.x, copyCoords.y)) {\n        // If the original copyable is inside the viewport, let the paster\n        // determine position.\n        return !!clipboard.paste(copyData, copyWorkspace);\n      }\n\n      // Otherwise, paste in the middle of the viewport.\n      const centerCoords = new Coordinate(left + width / 2, top + height / 2);\n      return !!clipboard.paste(copyData, copyWorkspace, centerCoords);\n    },\n    keyCodes: [ctrlV, altV, metaV],\n  };\n\n  ShortcutRegistry.registry.register(pasteShortcut);\n}\n\n/**\n * Keyboard shortcut to undo the previous action on ctrl+z, cmd+z, or alt+z.\n */\nexport function registerUndo() {\n  const ctrlZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.CTRL,\n  ]);\n  const altZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.ALT,\n  ]);\n  const metaZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.META,\n  ]);\n\n  const undoShortcut: KeyboardShortcut = {\n    name: names.UNDO,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback(workspace, e) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(false);\n      e.preventDefault();\n      return true;\n    },\n    keyCodes: [ctrlZ, altZ, metaZ],\n  };\n  ShortcutRegistry.registry.register(undoShortcut);\n}\n\n/**\n * Keyboard shortcut to redo the previous action on ctrl+shift+z, cmd+shift+z,\n * or alt+shift+z.\n */\nexport function registerRedo() {\n  const ctrlShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.CTRL,\n  ]);\n  const altShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.ALT,\n  ]);\n  const metaShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.META,\n  ]);\n  // Ctrl-y is redo in Windows.  Command-y is never valid on Macs.\n  const ctrlY = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Y, [\n    KeyCodes.CTRL,\n  ]);\n\n  const redoShortcut: KeyboardShortcut = {\n    name: names.REDO,\n    preconditionFn(workspace) {\n      return !Gesture.inProgress() && !workspace.options.readOnly;\n    },\n    callback(workspace, e) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(true);\n      e.preventDefault();\n      return true;\n    },\n    keyCodes: [ctrlShiftZ, altShiftZ, metaShiftZ, ctrlY],\n  };\n  ShortcutRegistry.registry.register(redoShortcut);\n}\n\n/**\n * Registers all default keyboard shortcut item. This should be called once per\n * instance of KeyboardShortcutRegistry.\n *\n * @internal\n */\nexport function registerDefaultShortcuts() {\n  registerEscape();\n  registerDelete();\n  registerCopy();\n  registerCut();\n  registerPaste();\n  registerUndo();\n  registerRedo();\n}\n\nregisterDefaultShortcuts();\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as priorities from './priorities.js';\nimport type {Workspace} from '../workspace.js';\n\n/** Represents the state of a procedure model. */\nexport interface State {\n  id: string;\n  name: string;\n  returnTypes: string[] | null;\n  parameters?: ParameterState[];\n  [key: string]: unknown;\n}\n\n/** Represents the state of a parameter model. */\nexport interface ParameterState {\n  id: string;\n  name: string;\n  types?: string[];\n  [key: string]: unknown;\n}\n\n/**\n * A newable signature for an IProcedureModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/interfaces.html#difference-between-the-static-and-instance-sides-of-classes\n * for what is going on with this.\n */\ninterface ProcedureModelConstructor<ProcedureModel extends IProcedureModel> {\n  new (workspace: Workspace, name: string, id: string): ProcedureModel;\n\n  /**\n   * Deserializes the JSON state and returns a procedure model.\n   *\n   * @param state The state to deserialize.\n   * @param workspace The workspace to load the procedure model into.\n   * @returns The constructed procedure model.\n   */\n  loadState(state: Object, workspace: Workspace): ProcedureModel;\n}\n\n/**\n * A newable signature for an IParameterModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/interfaces.html#difference-between-the-static-and-instance-sides-of-classes\n * for what is going on with this.\n */\ninterface ParameterModelConstructor<ParameterModel extends IParameterModel> {\n  new (workspace: Workspace, name: string, id: string): ParameterModel;\n\n  /**\n   * Deserializes the JSON state and returns a parameter model.\n   *\n   * @param state The state to deserialize.\n   * @param workspace The workspace to load the parameter model into.\n   * @returns The constructed parameter model.\n   */\n  loadState(state: Object, workspace: Workspace): ParameterModel;\n}\n\n/**\n * Serializes the given IProcedureModel to JSON.\n */\nexport function saveProcedure(proc: IProcedureModel): State {\n  const state: State = proc.saveState();\n  if (!proc.getParameters().length) return state;\n  state.parameters = proc.getParameters().map((param) => param.saveState());\n  return state;\n}\n\n/**\n * Deserializes the given procedure model State from JSON.\n */\nexport function loadProcedure<\n  ProcedureModel extends IProcedureModel,\n  ParameterModel extends IParameterModel,\n>(\n  procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n  parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  state: State,\n  workspace: Workspace,\n): ProcedureModel {\n  const proc = procedureModelClass.loadState(state, workspace);\n  if (!state.parameters) return proc;\n  for (const [index, param] of state.parameters.entries()) {\n    proc.insertParameter(\n      parameterModelClass.loadState(param, workspace),\n      index,\n    );\n  }\n  return proc;\n}\n\n/** Serializer for saving and loading procedure state. */\nexport class ProcedureSerializer<\n  ProcedureModel extends IProcedureModel,\n  ParameterModel extends IParameterModel,\n> implements ISerializer\n{\n  public priority = priorities.PROCEDURES;\n\n  /**\n   * Constructs the procedure serializer.\n   *\n   * Example usage:\n   *   new ProcedureSerializer(MyProcedureModelClass, MyParameterModelClass)\n   *\n   * @param procedureModelClass The class (implementing IProcedureModel) that\n   *     you want this serializer to deserialize.\n   * @param parameterModelClass The class (implementing IParameterModel) that\n   *     you want this serializer to deserialize.\n   */\n  constructor(\n    private readonly procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n    private readonly parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  ) {}\n\n  /** Serializes the procedure models of the given workspace. */\n  save(workspace: Workspace): State[] | null {\n    const save = workspace\n      .getProcedureMap()\n      .getProcedures()\n      .map((proc) => saveProcedure(proc));\n    return save.length ? save : null;\n  }\n\n  /**\n   * Deserializes the procedures models defined by the given state into the\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    const map = workspace.getProcedureMap();\n    for (const procState of state) {\n      map.add(\n        loadProcedure(\n          this.procedureModelClass,\n          this.parameterModelClass,\n          procState,\n          workspace,\n        ),\n      );\n    }\n  }\n\n  /** Disposes of any procedure models that exist on the workspace. */\n  clear(workspace: Workspace) {\n    workspace.getProcedureMap().clear();\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.workspaces\n\nimport * as eventUtils from '../events/utils.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\n// eslint-disable-next-line no-unused-vars\nimport type {Workspace} from '../workspace.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Returns the state of the workspace as a plain JavaScript object.\n *\n * @param workspace The workspace to serialize.\n * @returns The serialized state of the workspace.\n */\nexport function save(workspace: Workspace): {\n  [key: string]: AnyDuringMigration;\n} {\n  const state = Object.create(null);\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  for (const key in serializerMap) {\n    const save = (serializerMap[key] as ISerializer)?.save(workspace);\n    if (save) {\n      state[key] = save;\n    }\n  }\n  return state;\n}\n\n/**\n * Loads the variable represented by the given state into the given workspace.\n *\n * @param state The state of the workspace to deserialize into the workspace.\n * @param workspace The workspace to add the new state to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n */\nexport function load(\n  state: {[key: string]: AnyDuringMigration},\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n) {\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  if (!serializerMap) {\n    return;\n  }\n\n  const deserializers = Object.entries(serializerMap).sort(\n    (a, b) => (b[1] as ISerializer)!.priority - (a[1] as ISerializer)!.priority,\n  );\n\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  dom.startTextWidthCache();\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(false);\n  }\n\n  // We want to trigger clearing in reverse priority order so plugins don't end\n  // up missing dependencies.\n  for (const [, deserializer] of deserializers.reverse()) {\n    (deserializer as ISerializer)?.clear(workspace);\n  }\n\n  // reverse() is destructive, so we have to re-reverse to correct the order.\n  for (const [name, deserializer] of deserializers.reverse()) {\n    const pluginState = state[name];\n    if (pluginState) {\n      (deserializer as ISerializer)?.load(state[name], workspace);\n    }\n  }\n\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(true);\n  }\n  dom.stopTextWidthCache();\n\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.inject\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Grid} from './grid.js';\nimport {Msg} from './msg.js';\nimport {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Inject a Blockly editor into the specified container element (usually a div).\n *\n * @param container Containing element, or its ID, or a CSS selector.\n * @param opt_options Optional dictionary of options.\n * @returns Newly created main workspace.\n */\nexport function inject(\n  container: Element | string,\n  opt_options?: BlocklyOptions,\n): WorkspaceSvg {\n  let containerElement: Element | null = null;\n  if (typeof container === 'string') {\n    containerElement =\n      document.getElementById(container) || document.querySelector(container);\n  } else {\n    containerElement = container;\n  }\n  // Verify that the container is in document.\n  if (\n    !document.contains(containerElement) &&\n    document !== containerElement?.ownerDocument\n  ) {\n    throw Error('Error: container is not in current document');\n  }\n  const options = new Options(opt_options || ({} as BlocklyOptions));\n  const subContainer = document.createElement('div');\n  dom.addClass(subContainer, 'injectionDiv');\n  if (opt_options?.rtl) {\n    dom.addClass(subContainer, 'blocklyRTL');\n  }\n  subContainer.tabIndex = 0;\n  aria.setState(subContainer, aria.State.LABEL, Msg['WORKSPACE_ARIA_LABEL']);\n\n  containerElement!.appendChild(subContainer);\n  const svg = createDom(subContainer, options);\n\n  const workspace = createMainWorkspace(subContainer, svg, options);\n\n  init(workspace);\n\n  // Keep focus on the first workspace so entering keyboard navigation looks\n  // correct.\n  common.setMainWorkspace(workspace);\n\n  common.svgResize(workspace);\n\n  subContainer.addEventListener('focusin', function () {\n    common.setMainWorkspace(workspace);\n  });\n\n  return workspace;\n}\n\n/**\n * Create the SVG image.\n *\n * @param container Containing element.\n * @param options Dictionary of options.\n * @returns Newly created SVG image.\n */\nfunction createDom(container: Element, options: Options): SVGElement {\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\n  // then manually positions content in RTL as needed.\n  container.setAttribute('dir', 'LTR');\n\n  // Load CSS.\n  Css.inject(options.hasCss, options.pathToMedia);\n\n  // Build the SVG DOM.\n  /*\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:html=\"http://www.w3.org/1999/xhtml\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      version=\"1.1\"\n      class=\"blocklySvg\">\n      ...\n    </svg>\n    */\n  const svg = dom.createSvgElement(\n    Svg.SVG,\n    {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'class': 'blocklySvg',\n      'tabindex': '0',\n    },\n    container,\n  );\n  /*\n    <defs>\n      ... filters go here ...\n    </defs>\n    */\n  const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\n  // https://neil.fraser.name/news/2015/11/01/\n  const rnd = String(Math.random()).substring(2);\n\n  options.gridPattern = Grid.createDom(rnd, options.gridOptions, defs);\n  return svg;\n}\n\n/**\n * Create a main workspace and add it to the SVG.\n *\n * @param svg SVG element with pattern defined.\n * @param options Dictionary of options.\n * @returns Newly created main workspace.\n */\nfunction createMainWorkspace(\n  injectionDiv: Element,\n  svg: SVGElement,\n  options: Options,\n): WorkspaceSvg {\n  options.parentWorkspace = null;\n  const mainWorkspace = new WorkspaceSvg(options);\n  const wsOptions = mainWorkspace.options;\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\n  svg.appendChild(\n    mainWorkspace.createDom('blocklyMainBackground', injectionDiv),\n  );\n\n  // Set the theme name and renderer name onto the injection div.\n  const rendererClassName = mainWorkspace.getRenderer().getClassName();\n  if (rendererClassName) {\n    dom.addClass(injectionDiv, rendererClassName);\n  }\n  const themeClassName = mainWorkspace.getTheme().getClassName();\n  if (themeClassName) {\n    dom.addClass(injectionDiv, themeClassName);\n  }\n\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\n    // Add flyout as an <svg> that is a sibling of the workspace SVG.\n    const flyout = mainWorkspace.addFlyout(Svg.SVG);\n    dom.insertAfter(flyout, svg);\n  }\n  if (wsOptions.hasTrashcan) {\n    mainWorkspace.addTrashcan();\n  }\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\n    mainWorkspace.addZoomControls();\n  }\n  // Register the workspace svg as a UI component.\n  mainWorkspace\n    .getThemeManager()\n    .subscribe(svg, 'workspaceBackgroundColour', 'background-color');\n\n  // A null translation will also apply the correct initial scale.\n  mainWorkspace.translate(0, 0);\n\n  mainWorkspace.addChangeListener(\n    bumpObjects.bumpIntoBoundsHandler(mainWorkspace),\n  );\n\n  // The SVG is now fully assembled.\n  common.svgResize(mainWorkspace);\n  WidgetDiv.createDom();\n  dropDownDiv.createDom();\n  Tooltip.createDom();\n  return mainWorkspace;\n}\n\n/**\n * Initialize Blockly with various handlers.\n *\n * @param mainWorkspace Newly created main workspace.\n */\nfunction init(mainWorkspace: WorkspaceSvg) {\n  const options = mainWorkspace.options;\n  const svg = mainWorkspace.getParentSvg();\n\n  // Suppress the browser's context menu.\n  browserEvents.conditionalBind(\n    svg.parentNode as Element,\n    'contextmenu',\n    null,\n    function (e: Event) {\n      if (!browserEvents.isTargetInput(e)) {\n        e.preventDefault();\n      }\n    },\n  );\n\n  const workspaceResizeHandler = browserEvents.conditionalBind(\n    window,\n    'resize',\n    null,\n    function () {\n      // Don't hide all the chaff. Leave the dropdown and widget divs open if\n      // possible.\n      Tooltip.hide();\n      mainWorkspace.hideComponents(true);\n      dropDownDiv.repositionForWindowResize();\n      WidgetDiv.repositionForWindowResize();\n      common.svgResize(mainWorkspace);\n      bumpObjects.bumpTopObjectsIntoBounds(mainWorkspace);\n    },\n  );\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\n\n  bindDocumentEvents();\n\n  if (options.languageTree) {\n    const toolbox = mainWorkspace.getToolbox();\n    const flyout = mainWorkspace.getFlyout(true);\n    if (toolbox) {\n      toolbox.init();\n    } else if (flyout) {\n      // Build a fixed flyout with the root blocks.\n      flyout.init(mainWorkspace);\n      flyout.show(options.languageTree);\n      if (typeof flyout.scrollToStart === 'function') {\n        flyout.scrollToStart();\n      }\n    }\n  }\n\n  if (options.hasTrashcan) {\n    mainWorkspace.trashcan!.init();\n  }\n  if (options.zoomOptions && options.zoomOptions.controls) {\n    mainWorkspace.zoomControls_!.init();\n  }\n\n  if (options.moveOptions && options.moveOptions.scrollbars) {\n    const horizontalScroll =\n      options.moveOptions.scrollbars === true ||\n      !!options.moveOptions.scrollbars.horizontal;\n    const verticalScroll =\n      options.moveOptions.scrollbars === true ||\n      !!options.moveOptions.scrollbars.vertical;\n    mainWorkspace.scrollbar = new ScrollbarPair(\n      mainWorkspace,\n      horizontalScroll,\n      verticalScroll,\n      'blocklyMainWorkspaceScrollbar',\n    );\n    mainWorkspace.scrollbar.resize();\n  } else {\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\n  }\n\n  // Load the sounds.\n  if (options.hasSounds) {\n    loadSounds(options.pathToMedia, mainWorkspace);\n  }\n}\n\n/**\n * Handle a key-down on SVG drawing surface. Does nothing if the main workspace\n * is not visible.\n *\n * @param e Key down event.\n */\n// TODO (https://github.com/google/blockly/issues/1998) handle cases where there\n// are multiple workspaces and non-main workspaces are able to accept input.\nfunction onKeyDown(e: KeyboardEvent) {\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  if (!mainWorkspace) {\n    return;\n  }\n\n  if (\n    browserEvents.isTargetInput(e) ||\n    (mainWorkspace.rendered && !mainWorkspace.isVisible())\n  ) {\n    // When focused on an HTML text input widget, don't trap any keys.\n    // Ignore keypresses on rendered workspaces that have been explicitly\n    // hidden.\n    return;\n  }\n  ShortcutRegistry.registry.onKeyDown(mainWorkspace, e);\n}\n\n/**\n * Whether event handlers have been bound. Document event handlers will only\n * be bound once, even if Blockly is destroyed and reinjected.\n */\nlet documentEventsBound = false;\n\n/**\n * Bind document events, but only once.  Destroying and reinjecting Blockly\n * should not bind again.\n * Bind events for scrolling the workspace.\n * Most of these events should be bound to the SVG's surface.\n * However, 'mouseup' has to be on the whole document so that a block dragged\n * out of bounds and released will know that it has been released.\n * Also, 'keydown' has to be on the whole document since the browser doesn't\n * understand a concept of focus on the SVG image.\n */\nfunction bindDocumentEvents() {\n  if (!documentEventsBound) {\n    browserEvents.conditionalBind(document, 'scroll', null, function () {\n      const workspaces = common.getAllWorkspaces();\n      for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\n        if (workspace instanceof WorkspaceSvg) {\n          workspace.updateInverseScreenCTM();\n        }\n      }\n    });\n    browserEvents.conditionalBind(document, 'keydown', null, onKeyDown);\n    // longStop needs to run to stop the context menu from showing up.  It\n    // should run regardless of what other touch event handlers have run.\n    browserEvents.bind(document, 'touchend', null, Touch.longStop);\n    browserEvents.bind(document, 'touchcancel', null, Touch.longStop);\n    // Some iPad versions don't fire resize after portrait to landscape change.\n    if (userAgent.IPAD) {\n      browserEvents.conditionalBind(\n        window,\n        'orientationchange',\n        document,\n        function () {\n          // TODO (#397): Fix for multiple Blockly workspaces.\n          common.svgResize(common.getMainWorkspace() as WorkspaceSvg);\n        },\n      );\n    }\n  }\n  documentEventsBound = true;\n}\n\n/**\n * Load sounds for the given workspace.\n *\n * @param pathToMedia The path to the media directory.\n * @param workspace The workspace to load sounds for.\n */\nfunction loadSounds(pathToMedia: string, workspace: WorkspaceSvg) {\n  const audioMgr = workspace.getAudioManager();\n  audioMgr.load(\n    [\n      pathToMedia + 'click.mp3',\n      pathToMedia + 'click.wav',\n      pathToMedia + 'click.ogg',\n    ],\n    'click',\n  );\n  audioMgr.load(\n    [\n      pathToMedia + 'disconnect.wav',\n      pathToMedia + 'disconnect.mp3',\n      pathToMedia + 'disconnect.ogg',\n    ],\n    'disconnect',\n  );\n  audioMgr.load(\n    [\n      pathToMedia + 'delete.mp3',\n      pathToMedia + 'delete.ogg',\n      pathToMedia + 'delete.wav',\n    ],\n    'delete',\n  );\n\n  // Bind temporary hooks that preload the sounds.\n  const soundBinds: browserEvents.Data[] = [];\n  /**\n   *\n   */\n  function unbindSounds() {\n    while (soundBinds.length) {\n      const oldSoundBinding = soundBinds.pop();\n      if (oldSoundBinding) {\n        browserEvents.unbind(oldSoundBinding);\n      }\n    }\n    audioMgr.preload();\n  }\n\n  // These are bound on mouse/touch events with\n  // Blockly.browserEvents.conditionalBind, so they restrict the touch\n  // identifier that will be recognized.  But this is really something that\n  // happens on a click, not a drag, so that's not necessary.\n\n  // Android ignores any sound not loaded as a result of a user action.\n  soundBinds.push(\n    browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      null,\n      unbindSounds,\n      true,\n    ),\n  );\n  soundBinds.push(\n    browserEvents.conditionalBind(\n      document,\n      'touchstart',\n      null,\n      unbindSounds,\n      true,\n    ),\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ContextMenuItems\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport {\n  ContextMenuRegistry,\n  RegistryItem,\n  Scope,\n} from './contextmenu_registry.js';\nimport {MANUALLY_DISABLED} from './constants.js';\nimport * as dialog from './dialog.js';\nimport * as Events from './events/events.js';\nimport * as eventUtils from './events/utils.js';\nimport {CommentIcon} from './icons/comment_icon.js';\nimport {Msg} from './msg.js';\nimport {StatementInput} from './renderers/zelos/zelos.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as common from './common.js';\n\n/**\n * Option to undo previous action.\n */\nexport function registerUndo() {\n  const undoOption: RegistryItem = {\n    displayText() {\n      return Msg['UNDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getUndoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'undoWorkspace',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(undoOption);\n}\n\n/**\n * Option to redo previous action.\n */\nexport function registerRedo() {\n  const redoOption: RegistryItem = {\n    displayText() {\n      return Msg['REDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getRedoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(true);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'redoWorkspace',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(redoOption);\n}\n\n/**\n * Option to clean up blocks.\n */\nexport function registerCleanup() {\n  const cleanOption: RegistryItem = {\n    displayText() {\n      return Msg['CLEAN_UP'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.isMovable()) {\n        if (scope.workspace!.getTopBlocks(false).length > 1) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.cleanUp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'cleanWorkspace',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(cleanOption);\n}\n/**\n * Creates a callback to collapse or expand top blocks.\n *\n * @param shouldCollapse Whether a block should collapse.\n * @param topBlocks Top blocks in the workspace.\n */\nfunction toggleOption_(shouldCollapse: boolean, topBlocks: BlockSvg[]) {\n  const DELAY = 10;\n  let ms = 0;\n  let timeoutCounter = 0;\n  function timeoutFn(block: BlockSvg) {\n    timeoutCounter--;\n    block.setCollapsed(shouldCollapse);\n    if (timeoutCounter === 0) {\n      Events.setGroup(false);\n    }\n  }\n  Events.setGroup(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    let block: BlockSvg | null = topBlocks[i];\n    while (block) {\n      timeoutCounter++;\n      setTimeout(timeoutFn.bind(null, block), ms);\n      block = block.getNextBlock();\n      ms += DELAY;\n    }\n  }\n}\n\n/**\n * Option to collapse all blocks.\n */\nexport function registerCollapse() {\n  const collapseOption: RegistryItem = {\n    displayText() {\n      return Msg['COLLAPSE_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg | null = topBlocks[i];\n          while (block) {\n            if (!block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(true, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'collapseWorkspace',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseOption);\n}\n\n/**\n * Option to expand all blocks.\n */\nexport function registerExpand() {\n  const expandOption: RegistryItem = {\n    displayText() {\n      return Msg['EXPAND_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg | null = topBlocks[i];\n          while (block) {\n            if (block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(false, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'expandWorkspace',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(expandOption);\n}\n/**\n * Adds a block and its children to a list of deletable blocks.\n *\n * @param block to delete.\n * @param deleteList list of blocks that can be deleted.\n *     This will be modified in place with the given block and its descendants.\n */\nfunction addDeletableBlocks_(block: BlockSvg, deleteList: BlockSvg[]) {\n  if (block.isDeletable()) {\n    Array.prototype.push.apply(deleteList, block.getDescendants(false));\n  } else {\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      addDeletableBlocks_(children[i], deleteList);\n    }\n  }\n}\n\n/**\n * Constructs a list of blocks that can be deleted in the given workspace.\n *\n * @param workspace to delete all blocks from.\n * @returns list of blocks to delete.\n */\nfunction getDeletableBlocks_(workspace: WorkspaceSvg): BlockSvg[] {\n  const deleteList: BlockSvg[] = [];\n  const topBlocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    addDeletableBlocks_(topBlocks[i], deleteList);\n  }\n  return deleteList;\n}\n\n/**\n * Deletes the given blocks. Used to delete all blocks in the workspace.\n *\n * @param deleteList List of blocks to delete.\n * @param eventGroup Event group ID with which all delete events should be\n *     associated.  If not specified, create a new group.\n */\nfunction deleteNext_(deleteList: BlockSvg[], eventGroup?: string) {\n  const DELAY = 10;\n  if (eventGroup) {\n    eventUtils.setGroup(eventGroup);\n  } else {\n    eventUtils.setGroup(true);\n    eventGroup = eventUtils.getGroup();\n  }\n  const block = deleteList.shift();\n  if (block) {\n    if (!block.isDeadOrDying()) {\n      block.dispose(false, true);\n      setTimeout(deleteNext_, DELAY, deleteList, eventGroup);\n    } else {\n      deleteNext_(deleteList, eventGroup);\n    }\n  }\n  eventUtils.setGroup(false);\n}\n\n/**\n * Option to delete all blocks.\n */\nexport function registerDeleteAll() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (!scope.workspace) {\n        return '';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      if (deletableBlocksLength === 1) {\n        return Msg['DELETE_BLOCK'];\n      }\n      return Msg['DELETE_X_BLOCKS'].replace('%1', `${deletableBlocksLength}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.workspace) {\n        return 'disabled';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      return deletableBlocksLength > 0 ? 'enabled' : 'disabled';\n    },\n    callback(scope: Scope) {\n      if (!scope.workspace) {\n        return;\n      }\n      scope.workspace.cancelCurrentGesture();\n      const deletableBlocks = getDeletableBlocks_(scope.workspace);\n      if (deletableBlocks.length < 2) {\n        deleteNext_(deletableBlocks);\n      } else {\n        dialog.confirm(\n          Msg['DELETE_ALL_BLOCKS'].replace(\n            '%1',\n            String(deletableBlocks.length),\n          ),\n          function (ok) {\n            if (ok) {\n              deleteNext_(deletableBlocks);\n            }\n          },\n        );\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'workspaceDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n/** Registers all workspace-scoped context menu items. */\nfunction registerWorkspaceOptions_() {\n  registerUndo();\n  registerRedo();\n  registerCleanup();\n  registerCollapse();\n  registerExpand();\n  registerDeleteAll();\n}\n\n/**\n * Option to duplicate a block.\n */\nexport function registerDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText() {\n      return Msg['DUPLICATE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isDeletable() && block!.isMovable()) {\n        if (block!.isDuplicatable()) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (!scope.block) return;\n      const data = scope.block.toCopyData();\n      if (!data) return;\n      clipboard.paste(data, scope.block.workspace);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/**\n * Option to add or remove block-level comment.\n */\nexport function registerComment() {\n  const commentOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (scope.block!.hasIcon(CommentIcon.TYPE)) {\n        // If there's already a comment,  option is to remove.\n        return Msg['REMOVE_COMMENT'];\n      }\n      // If there's no comment yet, option is to add.\n      return Msg['ADD_COMMENT'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.workspace.options.comments &&\n        !block!.isCollapsed() &&\n        block!.isEditable()\n      ) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      if (block!.hasIcon(CommentIcon.TYPE)) {\n        block!.setCommentText(null);\n      } else {\n        block!.setCommentText('');\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockComment',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(commentOption);\n}\n\n/**\n * Option to inline variables.\n */\nexport function registerInline() {\n  const inlineOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.getInputsInline()\n        ? Msg['EXTERNAL_INPUTS']\n        : Msg['INLINE_INPUTS'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() && !block!.isCollapsed()) {\n        for (let i = 1; i < block!.inputList.length; i++) {\n          // Only display this option if there are two value or dummy inputs\n          // next to each other.\n          if (\n            !(block!.inputList[i - 1] instanceof StatementInput) &&\n            !(block!.inputList[i] instanceof StatementInput)\n          ) {\n            return 'enabled';\n          }\n        }\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setInputsInline(!scope.block!.getInputsInline());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockInline',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(inlineOption);\n}\n\n/**\n * Option to collapse or expand a block.\n */\nexport function registerCollapseExpandBlock() {\n  const collapseExpandOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isCollapsed()\n        ? Msg['EXPAND_BLOCK']\n        : Msg['COLLAPSE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.isMovable() &&\n        block!.workspace.options.collapse\n      ) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setCollapsed(!scope.block!.isCollapsed());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockCollapseExpand',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseExpandOption);\n}\n\n/**\n * Option to disable or enable a block.\n */\nexport function registerDisable() {\n  const disableOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.hasDisabledReason(MANUALLY_DISABLED)\n        ? Msg['ENABLE_BLOCK']\n        : Msg['DISABLE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.workspace.options.disable &&\n        block!.isEditable()\n      ) {\n        // Determine whether this block is currently disabled for any reason\n        // other than the manual reason that this context menu item controls.\n        const disabledReasons = block!.getDisabledReasons();\n        const isDisabledForOtherReason =\n          disabledReasons.size >\n          (disabledReasons.has(MANUALLY_DISABLED) ? 1 : 0);\n\n        if (block!.getInheritedDisabled() || isDisabledForOtherReason) {\n          return 'disabled';\n        }\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      block!.setDisabledReason(\n        !block!.hasDisabledReason(MANUALLY_DISABLED),\n        MANUALLY_DISABLED,\n      );\n      eventUtils.setGroup(existingGroup);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDisable',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(disableOption);\n}\n\n/**\n * Option to delete a block.\n */\nexport function registerDelete() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      const block = scope.block;\n      // Count the number of blocks that are nested in this block.\n      let descendantCount = block!.getDescendants(false).length;\n      const nextBlock = block!.getNextBlock();\n      if (nextBlock) {\n        // Blocks in the current stack would survive this block's deletion.\n        descendantCount -= nextBlock.getDescendants(false).length;\n      }\n      return descendantCount === 1\n        ? Msg['DELETE_BLOCK']\n        : Msg['DELETE_X_BLOCKS'].replace('%1', `${descendantCount}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.block!.isInFlyout && scope.block!.isDeletable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        scope.block.checkAndDelete();\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/**\n * Option to open help for a block.\n */\nexport function registerHelp() {\n  const helpOption: RegistryItem = {\n    displayText() {\n      return Msg['HELP'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      const url =\n        typeof block!.helpUrl === 'function'\n          ? block!.helpUrl()\n          : block!.helpUrl;\n      if (url) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.showHelp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockHelp',\n    weight: 7,\n  };\n  ContextMenuRegistry.registry.register(helpOption);\n}\n\n/** Registers an option for deleting a workspace comment. */\nexport function registerCommentDelete() {\n  const deleteOption: RegistryItem = {\n    displayText: () => Msg['REMOVE_COMMENT'],\n    preconditionFn(scope: Scope) {\n      return scope.comment?.isDeletable() ? 'enabled' : 'hidden';\n    },\n    callback(scope: Scope) {\n      eventUtils.setGroup(true);\n      scope.comment?.dispose();\n      eventUtils.setGroup(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.COMMENT,\n    id: 'commentDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/** Registers an option for duplicating a workspace comment. */\nexport function registerCommentDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText: () => Msg['DUPLICATE_COMMENT'],\n    preconditionFn(scope: Scope) {\n      return scope.comment?.isMovable() ? 'enabled' : 'hidden';\n    },\n    callback(scope: Scope) {\n      if (!scope.comment) return;\n      const data = scope.comment.toCopyData();\n      if (!data) return;\n      clipboard.paste(data, scope.comment.workspace);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.COMMENT,\n    id: 'commentDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/** Registers an option for adding a workspace comment to the workspace. */\nexport function registerCommentCreate() {\n  const createOption: RegistryItem = {\n    displayText: () => Msg['ADD_COMMENT'],\n    preconditionFn: () => 'enabled',\n    callback: (scope: Scope, e: PointerEvent) => {\n      const workspace = scope.workspace;\n      if (!workspace) return;\n      eventUtils.setGroup(true);\n      const comment = new RenderedWorkspaceComment(workspace);\n      comment.setText(Msg['WORKSPACE_COMMENT_DEFAULT_TEXT']);\n      comment.moveTo(\n        pixelsToWorkspaceCoords(\n          new Coordinate(e.clientX, e.clientY),\n          workspace,\n        ),\n      );\n      common.setSelected(comment);\n      eventUtils.setGroup(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'commentCreate',\n    weight: 8,\n  };\n  ContextMenuRegistry.registry.register(createOption);\n}\n\n/**\n * Converts pixel coordinates (relative to the window) to workspace coordinates.\n */\nfunction pixelsToWorkspaceCoords(\n  pixelCoord: Coordinate,\n  workspace: WorkspaceSvg,\n): Coordinate {\n  const injectionDiv = workspace.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels = new Coordinate(\n    pixelCoord.x - boundingRect.left,\n    pixelCoord.y - boundingRect.top,\n  );\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = workspace.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffset = Coordinate.difference(\n    clientOffsetPixels,\n    mainOffsetPixels,\n  );\n  // The position of the new comment in main workspace coordinates.\n  finalOffset.scale(1 / workspace.scale);\n  return finalOffset;\n}\n\n/** Registers all block-scoped context menu items. */\nfunction registerBlockOptions_() {\n  registerDuplicate();\n  registerComment();\n  registerInline();\n  registerCollapseExpandBlock();\n  registerDisable();\n  registerDelete();\n  registerHelp();\n}\n\n/** Registers all workspace comment related menu items. */\nexport function registerCommentOptions() {\n  registerCommentDuplicate();\n  registerCommentDelete();\n  registerCommentCreate();\n}\n\n/**\n * Registers all default context menu items. This should be called once per\n * instance of ContextMenuRegistry.\n *\n * @internal\n */\nexport function registerDefaultOptions() {\n  registerWorkspaceOptions_();\n  registerBlockOptions_();\n}\n\nregisterDefaultOptions();\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {ICopyable, ICopyData} from './i_copyable.js';\n\n/** An object that can paste data into a workspace. */\nexport interface IPaster<U extends ICopyData, T extends ICopyable<U>> {\n  paste(\n    copyData: U,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): T | null;\n}\n\n/** @returns True if the given object is a paster. */\nexport function isPaster(\n  obj: any,\n): obj is IPaster<ICopyData, ICopyable<ICopyData>> {\n  return obj.paste !== undefined;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/** @internal */\nexport interface IRenderedElement {\n  /**\n   * @returns The root SVG element of htis rendered element.\n   */\n  getSvgRoot(): SVGElement;\n}\n\n/**\n * @returns True if the given object is an IRenderedElement.\n *\n * @internal\n */\nexport function isRenderedElement(obj: any): obj is IRenderedElement {\n  return obj['getSvgRoot'] !== undefined;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ISelectable\n\nimport type {Workspace} from '../workspace.js';\n\n/**\n * The interface for an object that is selectable.\n */\nexport interface ISelectable {\n  id: string;\n\n  workspace: Workspace;\n\n  /** Select this.  Highlight it visually. */\n  select(): void;\n\n  /** Unselect this.  Unhighlight it visually. */\n  unselect(): void;\n}\n\n/** Checks whether the given object is an ISelectable. */\nexport function isSelectable(obj: Object): obj is ISelectable {\n  return (\n    typeof (obj as any).id === 'string' &&\n    (obj as any).workspace !== undefined &&\n    (obj as any).select !== undefined &&\n    (obj as any).unselect !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {FlyoutItemInfoArray} from '../utils/toolbox';\n// Former goog.module ID: Blockly.ISelectableToolboxItem\n\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for an item in the toolbox that can be selected.\n */\nexport interface ISelectableToolboxItem extends IToolboxItem {\n  /**\n   * Gets the name of the toolbox item. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string;\n\n  /**\n   * Gets the contents of the toolbox item. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray | string;\n\n  /**\n   * Sets the current toolbox item as selected.\n   *\n   * @param _isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(_isSelected: boolean): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element;\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event): void;\n}\n\n/**\n * Type guard that checks whether an IToolboxItem is an ISelectableToolboxItem.\n */\nexport function isSelectableToolboxItem(\n  toolboxItem: IToolboxItem,\n): toolboxItem is ISelectableToolboxItem {\n  return toolboxItem.isSelectable();\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/workspace_events.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui_base.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport {BlockSvg} from './block_svg.js';\nimport {BlocklyOptions} from './blockly_options.js';\nimport {Blocks} from './blocks.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bubbles from './bubbles.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport {ConnectionChecker} from './connection_checker.js';\nimport {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as ContextMenu from './contextmenu.js';\nimport * as ContextMenuItems from './contextmenu_items.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as comments from './comments.js';\nimport * as Css from './css.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as dialog from './dialog.js';\nimport * as dragging from './dragging.js';\nimport {DragTarget} from './drag_target.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as Events from './events/events.js';\nimport * as Extensions from './extensions.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport {\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n} from './field_checkbox.js';\nimport {\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n} from './field_dropdown.js';\nimport {\n  FieldImage,\n  FieldImageConfig,\n  FieldImageFromJsonConfig,\n} from './field_image.js';\nimport {\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n} from './field_label.js';\nimport {FieldLabelSerializable} from './field_label_serializable.js';\nimport {\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n} from './field_number.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n} from './field_textinput.js';\nimport {\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n} from './field_variable.js';\nimport {Flyout} from './flyout_base.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {HorizontalFlyout} from './flyout_horizontal.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport {VerticalFlyout} from './flyout_vertical.js';\nimport {CodeGenerator} from './generator.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport * as icons from './icons.js';\nimport {inject} from './inject.js';\nimport {Input} from './inputs/input.js';\nimport * as inputs from './inputs.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport {InsertionMarkerPreviewer} from './insertion_marker_previewer.js';\nimport {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\nimport {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport {IBubble} from './interfaces/i_bubble.js';\nimport {ICollapsibleToolboxItem} from './interfaces/i_collapsible_toolbox_item.js';\nimport {IComponent} from './interfaces/i_component.js';\nimport {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\nimport {IContextMenu} from './interfaces/i_contextmenu.js';\nimport {ICopyable, isCopyable, ICopyData} from './interfaces/i_copyable.js';\nimport {IDeletable, isDeletable} from './interfaces/i_deletable.js';\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\nimport {IDragTarget} from './interfaces/i_drag_target.js';\nimport {IDragger} from './interfaces/i_dragger.js';\nimport {\n  IDraggable,\n  isDraggable,\n  IDragStrategy,\n} from './interfaces/i_draggable.js';\nimport {IFlyout} from './interfaces/i_flyout.js';\nimport {IHasBubble, hasBubble} from './interfaces/i_has_bubble.js';\nimport {IIcon, isIcon} from './interfaces/i_icon.js';\nimport {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport {IMovable} from './interfaces/i_movable.js';\nimport {IObservable, isObservable} from './interfaces/i_observable.js';\nimport {IPaster, isPaster} from './interfaces/i_paster.js';\nimport {IPositionable} from './interfaces/i_positionable.js';\nimport {IRegistrable} from './interfaces/i_registrable.js';\nimport {\n  IRenderedElement,\n  isRenderedElement,\n} from './interfaces/i_rendered_element.js';\nimport {ISelectable, isSelectable} from './interfaces/i_selectable.js';\nimport {ISelectableToolboxItem} from './interfaces/i_selectable_toolbox_item.js';\nimport {ISerializable, isSerializable} from './interfaces/i_serializable.js';\nimport {IStyleable} from './interfaces/i_styleable.js';\nimport {IToolbox} from './interfaces/i_toolbox.js';\nimport {IToolboxItem} from './interfaces/i_toolbox_item.js';\nimport {\n  IVariableBackedParameterModel,\n  isVariableBackedParameterModel,\n} from './interfaces/i_variable_backed_parameter_model.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {BasicCursor} from './keyboard_nav/basic_cursor.js';\nimport {Cursor} from './keyboard_nav/cursor.js';\nimport {Marker} from './keyboard_nav/marker.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport type {LayerManager} from './layer_manager.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {MetricsManager} from './metrics_manager.js';\nimport {Msg, setLocale} from './msg.js';\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\nimport {Names} from './names.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport * as renderManagement from './render_management.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport * as constants from './constants.js';\nimport * as geras from './renderers/geras/geras.js';\nimport * as thrasos from './renderers/thrasos/thrasos.js';\nimport * as zelos from './renderers/zelos/zelos.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as serialization from './serialization.js';\nimport * as ShortcutItems from './shortcut_items.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport {Theme} from './theme.js';\nimport * as Themes from './theme/themes.js';\nimport {ThemeManager} from './theme_manager.js';\nimport {ToolboxCategory} from './toolbox/category.js';\nimport {CollapsibleToolboxCategory} from './toolbox/collapsible_category.js';\nimport {ToolboxSeparator} from './toolbox/separator.js';\nimport {Toolbox} from './toolbox/toolbox.js';\nimport {ToolboxItem} from './toolbox/toolbox_item.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Trashcan} from './trashcan.js';\nimport * as utils from './utils.js';\nimport * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\n\n/**\n * Blockly core version.\n * This constant is overridden by the build script (npm run build) to the value\n * of the version in package.json. This is done by the Closure Compiler in the\n * buildCompressed gulp task.\n * For local builds, you can pass --define='Blockly.VERSION=X.Y.Z' to the\n * compiler to override this constant.\n *\n * @define {string}\n */\nexport const VERSION = 'uncompiled';\n\n/*\n * Top-level functions and properties on the Blockly namespace.\n * These are used only in external code. Do not reference these\n * from internal code as importing from this file can cause circular\n * dependencies. Do not add new functions here. There is probably a better\n * namespace to put new functions on.\n */\n\n/*\n * Aliases for constants used for connection and input types.\n */\n\n/**\n * @see ConnectionType.INPUT_VALUE\n */\nexport const INPUT_VALUE = ConnectionType.INPUT_VALUE;\n\n/**\n * @see ConnectionType.OUTPUT_VALUE\n */\nexport const OUTPUT_VALUE = ConnectionType.OUTPUT_VALUE;\n\n/**\n * @see ConnectionType.NEXT_STATEMENT\n */\nexport const NEXT_STATEMENT = ConnectionType.NEXT_STATEMENT;\n\n/**\n * @see ConnectionType.PREVIOUS_STATEMENT\n */\nexport const PREVIOUS_STATEMENT = ConnectionType.PREVIOUS_STATEMENT;\n\n/** Aliases for toolbox positions. */\n\n/**\n * @see toolbox.Position.TOP\n */\nexport const TOOLBOX_AT_TOP = toolbox.Position.TOP;\n\n/**\n * @see toolbox.Position.BOTTOM\n */\nexport const TOOLBOX_AT_BOTTOM = toolbox.Position.BOTTOM;\n\n/**\n * @see toolbox.Position.LEFT\n */\nexport const TOOLBOX_AT_LEFT = toolbox.Position.LEFT;\n\n/**\n * @see toolbox.Position.RIGHT\n */\nexport const TOOLBOX_AT_RIGHT = toolbox.Position.RIGHT;\n\n/*\n * Other aliased functions.\n */\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n * @see Blockly.common.svgResize\n */\nexport const svgResize = common.svgResize;\n\n/**\n * Close tooltips, context menus, dropdown selections, etc.\n *\n * @param opt_onlyClosePopups Whether only popups should be closed.\n * @see Blockly.WorkspaceSvg.hideChaff\n */\nexport function hideChaff(opt_onlyClosePopups?: boolean) {\n  (common.getMainWorkspace() as WorkspaceSvg).hideChaff(opt_onlyClosePopups);\n}\n\n/**\n * Returns the main workspace.  Returns the last used main workspace (based on\n * focus).  Try not to use this function, particularly if there are multiple\n * Blockly instances on a page.\n *\n * @see Blockly.common.getMainWorkspace\n */\nexport const getMainWorkspace = common.getMainWorkspace;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport const getSelected = common.getSelected;\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @see Blockly.common.defineBlocksWithJsonArray\n */\nexport const defineBlocksWithJsonArray = common.defineBlocksWithJsonArray;\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * dropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param container The container element.\n * @see Blockly.common.setParentContainer\n */\nexport const setParentContainer = common.setParentContainer;\n\n// Aliases to allow external code to access these values for legacy reasons.\nexport const COLLAPSE_CHARS = internalConstants.COLLAPSE_CHARS;\nexport const OPPOSITE_TYPE = internalConstants.OPPOSITE_TYPE;\nexport const RENAME_VARIABLE_ID = internalConstants.RENAME_VARIABLE_ID;\nexport const DELETE_VARIABLE_ID = internalConstants.DELETE_VARIABLE_ID;\nexport const COLLAPSED_INPUT_NAME = constants.COLLAPSED_INPUT_NAME;\nexport const COLLAPSED_FIELD_NAME = constants.COLLAPSED_FIELD_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_CATEGORY_NAME: string = Variables.CATEGORY_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_DYNAMIC_CATEGORY_NAME: string =\n  VariablesDynamic.CATEGORY_NAME;\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n */\nexport const PROCEDURE_CATEGORY_NAME: string = Procedures.CATEGORY_NAME;\n\n// Context for why we need to monkey-patch in these functions (internal):\n//   https://docs.google.com/document/d/1MbO0LEA-pAyx1ErGLJnyUqTLrcYTo-5zga9qplnxeXo/edit?usp=sharing&resourcekey=0-5h_32-i-dHwHjf_9KYEVKg\n\n// clang-format off\nWorkspace.prototype.newBlock = function (\n  prototypeName: string,\n  opt_id?: string,\n): Block {\n  return new Block(this, prototypeName, opt_id);\n};\n\nWorkspaceSvg.prototype.newBlock = function (\n  prototypeName: string,\n  opt_id?: string,\n): BlockSvg {\n  return new BlockSvg(this, prototypeName, opt_id);\n};\n\nWorkspace.prototype.newComment = function (\n  id?: string,\n): comments.WorkspaceComment {\n  return new comments.WorkspaceComment(this, id);\n};\n\nWorkspaceSvg.prototype.newComment = function (\n  id?: string,\n): comments.RenderedWorkspaceComment {\n  return new comments.RenderedWorkspaceComment(this, id);\n};\n\nWorkspaceSvg.newTrashcan = function (workspace: WorkspaceSvg): Trashcan {\n  return new Trashcan(workspace);\n};\n\nMiniWorkspaceBubble.prototype.newWorkspaceSvg = function (\n  options: Options,\n): WorkspaceSvg {\n  return new WorkspaceSvg(options);\n};\n\nNames.prototype.populateProcedures = function (\n  this: Names,\n  workspace: Workspace,\n) {\n  const procedures = Procedures.allProcedures(workspace);\n  // Flatten the return vs no-return procedure lists.\n  const flattenedProcedures = procedures[0].concat(procedures[1]);\n  for (let i = 0; i < flattenedProcedures.length; i++) {\n    this.getName(flattenedProcedures[i][0], Names.NameType.PROCEDURE);\n  }\n};\n// clang-format on\n\n// Re-export submodules that no longer declareLegacyNamespace.\nexport {browserEvents};\nexport {ContextMenu};\nexport {ContextMenuItems};\nexport {Css};\nexport {Events};\nexport {Extensions};\nexport {Procedures};\nexport {Procedures as procedures};\nexport {ShortcutItems};\nexport {Themes};\nexport {Tooltip};\nexport {Touch};\nexport {Variables};\nexport {VariablesDynamic};\nexport {WidgetDiv};\nexport {Xml};\nexport {blockAnimations};\nexport {blockRendering};\nexport {bumpObjects};\nexport {clipboard};\nexport {common};\nexport {constants};\nexport {dialog};\nexport {fieldRegistry};\nexport {geras};\nexport {registry};\nexport {thrasos};\nexport {uiPosition};\nexport {utils};\nexport {zelos};\nexport {ASTNode};\nexport {BasicCursor};\nexport {Block};\nexport {BlocklyOptions};\nexport {BlockSvg};\nexport {Blocks};\nexport {bubbles};\nexport {CollapsibleToolboxCategory};\nexport {ComponentManager};\nexport {Connection};\nexport {ConnectionType};\nexport {ConnectionChecker};\nexport {ConnectionDB};\nexport {ContextMenuRegistry};\nexport {comments};\nexport {Cursor};\nexport {DeleteArea};\nexport {dragging};\nexport {DragTarget};\nexport const DropDownDiv = dropDownDiv;\nexport {Field, FieldConfig, FieldValidator, UnattachedFieldError};\nexport {\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n};\nexport {\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n};\nexport {FieldImage, FieldImageConfig, FieldImageFromJsonConfig};\nexport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig};\nexport {FieldLabelSerializable};\nexport {\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n};\nexport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n};\nexport {\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n};\nexport {Flyout};\nexport {FlyoutButton};\nexport {FlyoutMetricsManager};\nexport {CodeGenerator};\nexport {CodeGenerator as Generator}; // Deprecated name, October 2022.\nexport {Gesture};\nexport {Grid};\nexport {HorizontalFlyout};\nexport {IASTNodeLocation};\nexport {IASTNodeLocationSvg};\nexport {IASTNodeLocationWithBlock};\nexport {IAutoHideable};\nexport {IBoundedElement};\nexport {IBubble};\nexport {ICollapsibleToolboxItem};\nexport {IComponent};\nexport {IConnectionChecker};\nexport {IConnectionPreviewer};\nexport {IContextMenu};\nexport {icons};\nexport {ICopyable, isCopyable, ICopyData};\nexport {IDeletable, isDeletable};\nexport {IDeleteArea};\nexport {IDragTarget};\nexport {IDragger};\nexport {IDraggable, isDraggable, IDragStrategy};\nexport {IFlyout};\nexport {IHasBubble, hasBubble};\nexport {IIcon, isIcon};\nexport {IKeyboardAccessible};\nexport {IMetricsManager};\nexport {IMovable};\nexport {Input};\nexport {inputs};\nexport {InsertionMarkerManager};\nexport {InsertionMarkerPreviewer};\nexport {IObservable, isObservable};\nexport {IPaster, isPaster};\nexport {IPositionable};\nexport {IRegistrable};\nexport {IRenderedElement, isRenderedElement};\nexport {ISelectable, isSelectable};\nexport {ISelectableToolboxItem};\nexport {ISerializable, isSerializable};\nexport {IStyleable};\nexport {IToolbox};\nexport {IToolboxItem};\nexport {IVariableBackedParameterModel, isVariableBackedParameterModel};\nexport {Marker};\nexport {MarkerManager};\nexport {LayerManager};\nexport {Menu};\nexport {MenuItem};\nexport {MetricsManager};\nexport {Msg, setLocale};\nexport {Names};\nexport {Options};\nexport {RenderedConnection};\nexport {renderManagement};\nexport {Scrollbar};\nexport {ScrollbarPair};\nexport {ShortcutRegistry};\nexport {TabNavigateCursor};\nexport {Theme};\nexport {ThemeManager};\nexport {Toolbox};\nexport {ToolboxCategory};\nexport {ToolboxItem};\nexport {ToolboxSeparator};\nexport {Trashcan};\nexport {VariableMap};\nexport {VariableModel};\nexport {VerticalFlyout};\nexport {Workspace};\nexport {WorkspaceAudio};\nexport {WorkspaceDragger};\nexport {WorkspaceSvg};\nexport {ZoomControls};\nexport {config};\nexport {inject};\nexport {serialization};\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blocks\n\n/**\n * A block definition.  For now this very loose, but it can potentially\n * be refined e.g. by replacing this typedef with a class definition.\n */\nexport type BlockDefinition = AnyDuringMigration;\n\n/**\n * A mapping of block type names to block prototype objects.\n */\nexport const Blocks: {[key: string]: BlockDefinition} = Object.create(null);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for events fired as a result of actions in\n * Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Abstract\n\nimport * as common from '../common.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as eventUtils from './utils.js';\n\n/**\n * Abstract class for an event.\n */\nexport abstract class Abstract {\n  /**\n   * Whether or not the event was constructed without necessary parameters\n   * (to be populated by fromJson).\n   */\n  abstract isBlank: boolean;\n\n  /** The workspace identifier for this event. */\n  workspaceId?: string = undefined;\n\n  /**\n   * An ID for the group of events this block is associated with.\n   *\n   * Groups define events that should be treated as an single action from the\n   * user's perspective, and should be undone together.\n   */\n  group: string;\n\n  /** Whether this event is undoable or not. */\n  recordUndo: boolean;\n\n  /** Whether or not the event is a UI event. */\n  isUiEvent = false;\n\n  /** Type of this event. */\n  type = '';\n\n  constructor() {\n    this.group = eventUtils.getGroup();\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): AbstractEventJson {\n    return {\n      'type': this.type,\n      'group': this.group,\n    };\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Abstract (like all events), but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be\n   *     supertypes of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: AbstractEventJson,\n    workspace: Workspace,\n    event: any,\n  ): Abstract {\n    event.isBlank = false;\n    event.group = json['group'] || '';\n    event.workspaceId = workspace.id;\n    return event;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns True if null, false if something changed.\n   */\n  isNull(): boolean {\n    return false;\n  }\n\n  /**\n   * Run an event.\n   *\n   * @param _forward True if run forward, false if run backward (undo).\n   */\n  run(_forward: boolean) {\n    // Defined by subclasses. Cannot be abstract b/c UI events do /not/ define\n    // this.\n  }\n\n  /**\n   * Get workspace the event belongs to.\n   *\n   * @returns The workspace the event belongs to.\n   * @throws {Error} if workspace is null.\n   * @internal\n   */\n  getEventWorkspace_(): Workspace {\n    let workspace;\n    if (this.workspaceId) {\n      workspace = common.getWorkspaceById(this.workspaceId);\n    }\n    if (!workspace) {\n      throw Error(\n        'Workspace is null. Event must have been generated from real' +\n          ' Blockly events.',\n      );\n    }\n    return workspace;\n  }\n}\n\nexport interface AbstractEventJson {\n  type: string;\n  group: string;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.UiBase\n\nimport {Abstract as AbstractEvent} from './events_abstract.js';\n\n/**\n * Base class for a UI event.\n * UI events are events that don't need to be sent over the wire for multi-user\n * editing to work (e.g. scrolling the workspace, zooming, opening toolbox\n * categories).\n * UI events do not undo or redo.\n */\nexport class UiBase extends AbstractEvent {\n  override isBlank = true;\n  override workspaceId: string;\n\n  // UI events do not undo or redo.\n  override recordUndo = false;\n\n  /** Whether or not the event is a UI event. */\n  override isUiEvent = true;\n\n  /**\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_workspaceId?: string) {\n    super();\n\n    /** Whether or not the event is blank (to be populated by fromJson). */\n    this.isBlank = typeof opt_workspaceId === 'undefined';\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_workspaceId ? opt_workspaceId : '';\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of UI click in Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Click\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that some blockly element was clicked.\n */\nexport class Click extends UiBase {\n  /** The ID of the block that was clicked, if a block was clicked. */\n  blockId?: string;\n\n  /**\n   * The type of element that was clicked; one of 'block', 'workspace',\n   * or 'zoom_controls'.\n   */\n  targetType?: ClickTarget;\n  override type = eventUtils.CLICK;\n\n  /**\n   * @param opt_block The affected block. Null for click events that do not have\n   *     an associated block (i.e. workspace click). Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Not used if block is passed. Undefined for a blank event.\n   * @param opt_targetType The type of element targeted by this click event.\n   *     Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: Block | null,\n    opt_workspaceId?: string | null,\n    opt_targetType?: ClickTarget,\n  ) {\n    let workspaceId = opt_block ? opt_block.workspace.id : opt_workspaceId;\n    if (workspaceId === null) {\n      workspaceId = undefined;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : undefined;\n    this.targetType = opt_targetType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ClickJson {\n    const json = super.toJson() as ClickJson;\n    if (!this.targetType) {\n      throw new Error(\n        'The click target type is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['targetType'] = this.targetType;\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Click, but we can't specify that due to the fact that parameters to\n   *     static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ClickJson, workspace: Workspace, event?: any): Click {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new Click(),\n    ) as Click;\n    newEvent.targetType = json['targetType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum ClickTarget {\n  BLOCK = 'block',\n  WORKSPACE = 'workspace',\n  ZOOM_CONTROLS = 'zoom_controls',\n}\n\nexport interface ClickJson extends AbstractEventJson {\n  targetType: ClickTarget;\n  blockId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CLICK, Click);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.userAgent\n\n/** The raw useragent string. */\nlet rawUserAgent: string;\n\nlet isJavaFx: boolean;\n\nlet isWebKit: boolean;\n\nlet isGecko: boolean;\n\nlet isAndroid: boolean;\n\nlet isIPad: boolean;\n\nlet isIPhone: boolean;\n\nlet isMac: boolean;\n\nlet isTablet: boolean;\n\nlet isMobile: boolean;\n\n(function (raw) {\n  rawUserAgent = raw;\n  const rawUpper = rawUserAgent.toUpperCase();\n  /**\n   * Case-insensitive test of whether name is in the useragent string.\n   *\n   * @param name Name to test.\n   * @returns True if name is present.\n   */\n  function has(name: string): boolean {\n    return rawUpper.includes(name.toUpperCase());\n  }\n\n  // Browsers.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/browser.js\n  // Useragent for JavaFX:\n  // Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.44\n  //     (KHTML, like Gecko) JavaFX/8.0 Safari/537.44\n  isJavaFx = has('JavaFX');\n\n  // Engines.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/engine.js\n  isWebKit = has('WebKit');\n  isGecko = has('Gecko') && !isWebKit;\n\n  // Platforms.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/platform.js\n  // and\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/extra.js\n  isAndroid = has('Android');\n  const maxTouchPoints =\n    globalThis['navigator'] && globalThis['navigator']['maxTouchPoints'];\n  isIPad = has('iPad') || (has('Macintosh') && maxTouchPoints > 0);\n  isIPhone = has('iPhone') && !isIPad;\n  isMac = has('Macintosh');\n\n  // Devices.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/device.js\n  isTablet = isIPad || (isAndroid && !has('Mobile')) || has('Silk');\n  isMobile = !isTablet && (isIPhone || isAndroid);\n})((globalThis['navigator'] && globalThis['navigator']['userAgent']) || '');\n\nexport const raw: string = rawUserAgent;\n\nexport const JavaFx: boolean = isJavaFx;\n\nexport const GECKO: boolean = isGecko;\n\nexport const ANDROID: boolean = isAndroid;\n\nexport const IPAD: boolean = isIPad;\n\nexport const IPHONE: boolean = isIPhone;\n\nexport const MAC: boolean = isMac;\n\nexport const MOBILE: boolean = isMobile;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Manager for all items registered with the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ComponentManager\n\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IComponent} from './interfaces/i_component.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport * as arrayUtils from './utils/array.js';\n\nclass Capability<_T> {\n  static POSITIONABLE = new Capability<IPositionable>('positionable');\n  static DRAG_TARGET = new Capability<IDragTarget>('drag_target');\n  static DELETE_AREA = new Capability<IDeleteArea>('delete_area');\n  static AUTOHIDEABLE = new Capability<IAutoHideable>('autohideable');\n  private readonly name_: string;\n  /** @param name The name of the component capability. */\n  constructor(name: string) {\n    this.name_ = name;\n  }\n\n  /**\n   * Returns the name of the capability.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name_;\n  }\n}\n\n/**\n * Manager for all items registered with the workspace.\n */\nexport class ComponentManager {\n  static Capability = Capability;\n\n  /**\n   * A map of the components registered with the workspace, mapped to id.\n   */\n  private readonly componentData = new Map<string, ComponentDatum>();\n\n  /** A map of capabilities to component IDs. */\n  private readonly capabilityToComponentIds = new Map<string, string[]>();\n\n  /**\n   * Adds a component.\n   *\n   * @param componentInfo The data for the component to register.\n   * @param opt_allowOverrides True to prevent an error when overriding an\n   *     already registered item.\n   */\n  addComponent(componentInfo: ComponentDatum, opt_allowOverrides?: boolean) {\n    // Don't throw an error if opt_allowOverrides is true.\n    const id = componentInfo.component.id;\n    if (!opt_allowOverrides && this.componentData.has(id)) {\n      throw Error(\n        'Plugin \"' +\n          id +\n          '\" with capabilities \"' +\n          this.componentData.get(id)?.capabilities +\n          '\" already added.',\n      );\n    }\n    this.componentData.set(id, componentInfo);\n    const stringCapabilities = [];\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      stringCapabilities.push(capability);\n      if (!this.capabilityToComponentIds.has(capability)) {\n        this.capabilityToComponentIds.set(capability, [id]);\n      } else {\n        this.capabilityToComponentIds.get(capability)?.push(id);\n      }\n    }\n    this.componentData.get(id)!.capabilities = stringCapabilities;\n  }\n\n  /**\n   * Removes a component.\n   *\n   * @param id The ID of the component to remove.\n   */\n  removeComponent(id: string) {\n    const componentInfo = this.componentData.get(id);\n    if (!componentInfo) {\n      return;\n    }\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n    }\n    this.componentData.delete(id);\n  }\n\n  /**\n   * Adds a capability to a existing registered component.\n   *\n   * @param id The ID of the component to add the capability to.\n   * @param capability The capability to add.\n   */\n  addCapability<T>(id: string, capability: string | Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n        'Cannot add capability, \"' +\n          capability +\n          '\". Plugin \"' +\n          id +\n          '\" has not been added to the ComponentManager',\n      );\n    }\n    if (this.hasCapability(id, capability)) {\n      console.warn(\n        'Plugin \"' + id + 'already has capability \"' + capability + '\"',\n      );\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    this.componentData.get(id)?.capabilities.push(capability);\n    this.capabilityToComponentIds.get(capability)?.push(id);\n  }\n\n  /**\n   * Removes a capability from an existing registered component.\n   *\n   * @param id The ID of the component to remove the capability from.\n   * @param capability The capability to remove.\n   */\n  removeCapability<T>(id: string, capability: string | Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n        'Cannot remove capability, \"' +\n          capability +\n          '\". Plugin \"' +\n          id +\n          '\" has not been added to the ComponentManager',\n      );\n    }\n    if (!this.hasCapability(id, capability)) {\n      console.warn(\n        'Plugin \"' +\n          id +\n          'doesn\\'t have capability \"' +\n          capability +\n          '\" to remove',\n      );\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    arrayUtils.removeElem(this.componentData.get(id)!.capabilities, capability);\n    arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n  }\n\n  /**\n   * Returns whether the component with this id has the specified capability.\n   *\n   * @param id The ID of the component to check.\n   * @param capability The capability to check for.\n   * @returns Whether the component has the capability.\n   */\n  hasCapability<T>(id: string, capability: string | Capability<T>): boolean {\n    capability = `${capability}`.toLowerCase();\n    return (\n      this.componentData.has(id) &&\n      this.componentData.get(id)!.capabilities.includes(capability)\n    );\n  }\n\n  /**\n   * Gets the component with the given ID.\n   *\n   * @param id The ID of the component to get.\n   * @returns The component with the given name or undefined if not found.\n   */\n  getComponent(id: string): IComponent | undefined {\n    return this.componentData.get(id)?.component;\n  }\n\n  /**\n   * Gets all the components with the specified capability.\n   *\n   * @param capability The capability of the component.\n   * @param sorted Whether to return list ordered by weights.\n   * @returns The components that match the specified capability.\n   */\n  getComponents<T extends IComponent>(\n    capability: string | Capability<T>,\n    sorted: boolean,\n  ): T[] {\n    capability = `${capability}`.toLowerCase();\n    const componentIds = this.capabilityToComponentIds.get(capability);\n    if (!componentIds) {\n      return [];\n    }\n    const components: T[] = [];\n    if (sorted) {\n      const componentDataList: ComponentDatum[] = [];\n      componentIds.forEach((id) => {\n        componentDataList.push(this.componentData.get(id)!);\n      });\n      componentDataList.sort(function (a, b) {\n        return a.weight - b.weight;\n      });\n      componentDataList.forEach(function (componentDatum) {\n        components.push(componentDatum.component as T);\n      });\n    } else {\n      componentIds.forEach((id) => {\n        components.push(this.componentData.get(id)!.component as T);\n      });\n    }\n    return components;\n  }\n}\n\nexport namespace ComponentManager {\n  /** An object storing component information. */\n  export interface ComponentDatum {\n    component: IComponent;\n    capabilities: Array<string | Capability<IComponent>>;\n    weight: number;\n  }\n}\n\nexport type ComponentDatum = ComponentManager.ComponentDatum;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for coordinate manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Coordinate\n\n/**\n * Class for representing coordinates and positions.\n */\nexport class Coordinate {\n  /**\n   * @param x Left.\n   * @param y Top.\n   */\n  constructor(\n    public x: number,\n    public y: number,\n  ) {}\n\n  /**\n   * Creates a new copy of this coordinate.\n   *\n   * @returns A copy of this coordinate.\n   */\n  clone(): Coordinate {\n    return new Coordinate(this.x, this.y);\n  }\n\n  /**\n   * Scales this coordinate by the given scale factor.\n   *\n   * @param s The scale factor to use for both x and y dimensions.\n   * @returns This coordinate after scaling.\n   */\n  scale(s: number): Coordinate {\n    this.x *= s;\n    this.y *= s;\n    return this;\n  }\n\n  /**\n   * Translates this coordinate by the given offsets.\n   * respectively.\n   *\n   * @param tx The value to translate x by.\n   * @param ty The value to translate y by.\n   * @returns This coordinate after translating.\n   */\n  translate(tx: number, ty: number): Coordinate {\n    this.x += tx;\n    this.y += ty;\n    return this;\n  }\n\n  /**\n   * Compares coordinates for equality.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns True iff the coordinates are equal, or if both are null.\n   */\n  static equals(a?: Coordinate | null, b?: Coordinate | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.x === b.x && a.y === b.y;\n  }\n\n  /**\n   * Returns the distance between two coordinates.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns The distance between `a` and `b`.\n   */\n  static distance(a: Coordinate, b: Coordinate): number {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Returns the magnitude of a coordinate.\n   *\n   * @param a A Coordinate.\n   * @returns The distance between the origin and `a`.\n   */\n  static magnitude(a: Coordinate): number {\n    return Math.sqrt(a.x * a.x + a.y * a.y);\n  }\n\n  /**\n   * Returns the difference between two coordinates as a new\n   * Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the difference between `a` and `b`.\n   */\n  static difference(\n    a: Coordinate | SVGPoint,\n    b: Coordinate | SVGPoint,\n  ): Coordinate {\n    return new Coordinate(a.x - b.x, a.y - b.y);\n  }\n\n  /**\n   * Returns the sum of two coordinates as a new Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the sum of the two coordinates.\n   */\n  static sum(a: Coordinate | SVGPoint, b: Coordinate | SVGPoint): Coordinate {\n    return new Coordinate(a.x + b.x, a.y + b.y);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Defines the Svg class. Its constants enumerate\n * all SVG tag names used by Blockly.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Svg\n\n/**\n * A name with the type of the SVG element stored in the generic.\n */\nexport class Svg<_T> {\n  /** @internal */\n  static ANIMATE = new Svg<SVGAnimateElement>('animate');\n  /** @internal */\n  static CIRCLE = new Svg<SVGCircleElement>('circle');\n  /** @internal */\n  static CLIPPATH = new Svg<SVGClipPathElement>('clipPath');\n  /** @internal */\n  static DEFS = new Svg<SVGDefsElement>('defs');\n  /** @internal */\n  static FECOMPOSITE = new Svg<SVGFECompositeElement>('feComposite');\n  /** @internal */\n  static FECOMPONENTTRANSFER = new Svg<SVGFEComponentTransferElement>(\n    'feComponentTransfer',\n  );\n  /** @internal */\n  static FEFLOOD = new Svg<SVGFEFloodElement>('feFlood');\n  /** @internal */\n  static FEFUNCA = new Svg<SVGFEFuncAElement>('feFuncA');\n  /** @internal */\n  static FEGAUSSIANBLUR = new Svg<SVGFEGaussianBlurElement>('feGaussianBlur');\n  /** @internal */\n  static FEPOINTLIGHT = new Svg<SVGFEPointLightElement>('fePointLight');\n  /** @internal */\n  static FESPECULARLIGHTING = new Svg<SVGFESpecularLightingElement>(\n    'feSpecularLighting',\n  );\n  /** @internal */\n  static FILTER = new Svg<SVGFilterElement>('filter');\n  /** @internal */\n  static FOREIGNOBJECT = new Svg<SVGForeignObjectElement>('foreignObject');\n  /** @internal */\n  static G = new Svg<SVGGElement>('g');\n  /** @internal */\n  static IMAGE = new Svg<SVGImageElement>('image');\n  /** @internal */\n  static LINE = new Svg<SVGLineElement>('line');\n  /** @internal */\n  static PATH = new Svg<SVGPathElement>('path');\n  /** @internal */\n  static PATTERN = new Svg<SVGPatternElement>('pattern');\n  /** @internal */\n  static POLYGON = new Svg<SVGPolygonElement>('polygon');\n  /** @internal */\n  static RECT = new Svg<SVGRectElement>('rect');\n  /** @internal */\n  static SVG = new Svg<SVGSVGElement>('svg');\n  /** @internal */\n  static TEXT = new Svg<SVGTextElement>('text');\n  /** @internal */\n  static TSPAN = new Svg<SVGTSpanElement>('tspan');\n\n  /**\n   * @param tagName The SVG element tag name.\n   * @internal\n   */\n  constructor(private readonly tagName: string) {}\n\n  /**\n   * Returns the SVG element tag name.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.tagName;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for rectangle manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Rect\n\n/**\n * Class for representing rectangular regions.\n */\nexport class Rect {\n  /**\n   * @param top Top.\n   * @param bottom Bottom.\n   * @param left Left.\n   * @param right Right.\n   */\n  constructor(\n    public top: number,\n    public bottom: number,\n    public left: number,\n    public right: number,\n  ) {}\n\n  getHeight(): number {\n    return this.bottom - this.top;\n  }\n\n  getWidth(): number {\n    return this.right - this.left;\n  }\n\n  /**\n   * Tests whether this rectangle contains a x/y coordinate.\n   *\n   * @param x The x coordinate to test for containment.\n   * @param y The y coordinate to test for containment.\n   * @returns Whether this rectangle contains given coordinate.\n   */\n  contains(x: number, y: number): boolean {\n    return (\n      x >= this.left && x <= this.right && y >= this.top && y <= this.bottom\n    );\n  }\n\n  /**\n   * Tests whether this rectangle intersects the provided rectangle.\n   * Assumes that the coordinate system increases going down and left.\n   *\n   * @param other The other rectangle to check for intersection with.\n   * @returns Whether this rectangle intersects the provided rectangle.\n   */\n  intersects(other: Rect): boolean {\n    return !(\n      this.left > other.right ||\n      this.right < other.left ||\n      this.top > other.bottom ||\n      this.bottom < other.top\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for size calculation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Size\n\n/**\n * Class for representing sizes consisting of a width and height.\n */\nexport class Size {\n  /**\n   * @param width Width.\n   * @param height Height.\n   */\n  constructor(\n    public width: number,\n    public height: number,\n  ) {}\n\n  /**\n   * Compares sizes for equality.\n   *\n   * @param a A Size.\n   * @param b A Size.\n   * @returns True iff the sizes have equal widths and equal heights, or if both\n   *     are null.\n   */\n  static equals(a: Size | null, b: Size | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.width === b.width && a.height === b.height;\n  }\n\n  /**\n   * Returns a new size with the maximum width and height values out of both\n   * sizes.\n   */\n  static max(a: Size, b: Size): Size {\n    return new Size(Math.max(a.width, b.width), Math.max(a.height, b.height));\n  }\n\n  /**\n   * Returns a new size with the minimum width and height values out of both\n   * sizes.\n   */\n  static min(a: Size, b: Size): Size {\n    return new Size(Math.min(a.width, b.width), Math.min(a.height, b.height));\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a scrollbar.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Scrollbar\n\nimport * as browserEvents from './browser_events.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * A note on units: most of the numbers that are in CSS pixels are scaled if the\n * scrollbar is in a mutator.\n */\n\n/**\n * Class for a pure SVG scrollbar.\n * This technique offers a scrollbar that is guaranteed to work, but may not\n * look or behave like the system's scrollbars.\n */\nexport class Scrollbar {\n  /**\n   * Width of vertical scrollbar or height of horizontal scrollbar in CSS\n   * pixels. Scrollbars should be larger on touch devices.\n   */\n  static scrollbarThickness = Touch.TOUCH_ENABLED ? 25 : 15;\n\n  /**\n   * Default margin around the scrollbar (between the scrollbar and the edge of\n   * the viewport in pixels).\n   *\n   * @internal\n   */\n  static readonly DEFAULT_SCROLLBAR_MARGIN = 0.5;\n\n  /** Whether this scrollbar is part of a pair. */\n  private readonly pair: boolean;\n\n  /**\n   * Margin around the scrollbar (between the scrollbar and the edge of the\n   * viewport in pixels).\n   */\n  private readonly margin: number;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics: Metrics | null = null;\n\n  /**\n   * The ratio of handle position offset to workspace content displacement.\n   *\n   * @internal\n   */\n  ratio = 1;\n\n  /**\n   * The location of the origin of the workspace that the scrollbar is in,\n   * measured in CSS pixels relative to the injection div origin.  This is\n   * usually (0, 0).  When the scrollbar is in a flyout it may have a\n   * different origin.\n   */\n  private origin = new Coordinate(0, 0);\n\n  /**\n   * The position of the mouse along this scrollbar's major axis at the start\n   * of the most recent drag. Units are CSS pixels, with (0, 0) at the top\n   * left of the browser window. For a horizontal scrollbar this is the x\n   * coordinate of the mouse down event; for a vertical scrollbar it's the y\n   * coordinate of the mouse down event.\n   */\n  private startDragMouse = 0;\n\n  /**\n   * The length of the scrollbars (including the handle and the background),\n   * in CSS pixels. This is equivalent to scrollbar background length and the\n   * area within which the scrollbar handle can move.\n   */\n  private scrollbarLength = 0;\n\n  /** The length of the scrollbar handle in CSS pixels. */\n  private handleLength = 0;\n\n  /**\n   * The offset of the start of the handle from the scrollbar position, in CSS\n   * pixels.\n   */\n  private handlePosition = 0;\n\n  private startDragHandle = 0;\n\n  /** Whether the scrollbar handle is visible. */\n  private isHandleVisible = true;\n\n  /** Whether the workspace containing this scrollbar is visible. */\n  private containerVisible = true;\n\n  /** The transparent background behind the handle. */\n  private svgBackground: SVGRectElement;\n\n  /** The visible handle that can be dragged around. */\n  private svgHandle: SVGRectElement;\n\n  /** The outermost SVG element, which contains all parts of the scrollbar. */\n  private outerSvg: SVGSVGElement;\n\n  /**\n   * The upper left corner of the scrollbar's SVG group in CSS pixels relative\n   * to the scrollbar's origin.  This is usually relative to the injection div\n   * origin.\n   *\n   * @internal\n   */\n  position = new Coordinate(0, 0);\n\n  /**\n   * The DOM attribute that controls the length of the scrollbar. Different\n   * for horizontal and vertical scrollbars.\n   */\n  lengthAttribute_: string;\n\n  /**\n   * The DOM attribute that controls the position of the scrollbar.\n   * Different for horizontal and vertical scrollbars.\n   */\n  positionAttribute_: string;\n\n  /** Handler for mouse down events on the background of the scrollbar. */\n  onMouseDownBarWrapper_: browserEvents.Data;\n\n  /** Handler for mouse down events on the handle of the scrollbar. */\n  onMouseDownHandleWrapper_: browserEvents.Data;\n\n  /** Handler for mouse move events during scrollbar drags. */\n  onMouseUpWrapper_: browserEvents.Data | null = null;\n\n  /** Handler for mouse up events to end scrollbar drags. */\n  onMouseMoveWrapper_: browserEvents.Data | null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbar to.\n   * @param horizontal True if horizontal, false if vertical.\n   * @param opt_pair True if scrollbar is part of a horiz/vert pair.\n   * @param opt_class A class to be applied to this scrollbar.\n   * @param opt_margin The margin to apply to this scrollbar.\n   */\n  constructor(\n    private workspace: WorkspaceSvg,\n    private readonly horizontal: boolean,\n    opt_pair?: boolean,\n    opt_class?: string,\n    opt_margin?: number,\n  ) {\n    this.pair = opt_pair || false;\n\n    this.margin =\n      opt_margin !== undefined\n        ? opt_margin\n        : Scrollbar.DEFAULT_SCROLLBAR_MARGIN;\n\n    let className =\n      'blocklyScrollbar' + (this.horizontal ? 'Horizontal' : 'Vertical');\n    if (opt_class) {\n      className += ' ' + opt_class;\n    }\n\n    /* Create the following DOM:\n      <svg class=\"blocklyScrollbarHorizontal optionalClass\">\n        <g>\n          <rect class=\"blocklyScrollbarBackground\" />\n          <rect class=\"blocklyScrollbarHandle\" rx=\"8\" ry=\"8\" />\n        </g>\n      </svg>\n    */\n    this.outerSvg = dom.createSvgElement(Svg.SVG, {'class': className});\n    // Child group to hold the handle and background together.\n    const group = dom.createSvgElement(Svg.G, {}, this.outerSvg);\n\n    this.svgBackground = dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyScrollbarBackground'},\n      group,\n    );\n\n    const radius = Math.floor((Scrollbar.scrollbarThickness - 5) / 2);\n    this.svgHandle = dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyScrollbarHandle', 'rx': radius, 'ry': radius},\n      group,\n    );\n\n    this.workspace\n      .getThemeManager()\n      .subscribe(this.svgHandle, 'scrollbarColour', 'fill');\n    this.workspace\n      .getThemeManager()\n      .subscribe(this.svgHandle, 'scrollbarOpacity', 'fill-opacity');\n\n    // Add everything to the DOM.\n    dom.insertAfter(this.outerSvg, this.workspace.getParentSvg());\n\n    this.setInitialThickness();\n\n    if (horizontal) {\n      this.lengthAttribute_ = 'width';\n      this.positionAttribute_ = 'x';\n    } else {\n      this.lengthAttribute_ = 'height';\n      this.positionAttribute_ = 'y';\n    }\n\n    this.onMouseDownBarWrapper_ = browserEvents.conditionalBind(\n      this.svgBackground,\n      'pointerdown',\n      this,\n      this.onMouseDownBar,\n    );\n    this.onMouseDownHandleWrapper_ = browserEvents.conditionalBind(\n      this.svgHandle,\n      'pointerdown',\n      this,\n      this.onMouseDownHandle,\n    );\n  }\n\n  /**\n   * Set the size of the scrollbar DOM elements along the minor axis.\n   */\n  private setInitialThickness() {\n    const scrollbarThickness = Scrollbar.scrollbarThickness;\n    if (this.horizontal) {\n      this.svgBackground.setAttribute('height', String(scrollbarThickness));\n      this.outerSvg.setAttribute('height', String(scrollbarThickness));\n      this.svgHandle.setAttribute('height', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('y', '2.5');\n    } else {\n      this.svgBackground.setAttribute('width', String(scrollbarThickness));\n      this.outerSvg.setAttribute('width', String(scrollbarThickness));\n      this.svgHandle.setAttribute('width', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('x', '2.5');\n    }\n  }\n\n  /**\n   * Dispose of this scrollbar. Remove DOM elements, event listeners,\n   * and theme subscriptions.\n   */\n  dispose() {\n    this.cleanUp();\n    browserEvents.unbind(this.onMouseDownBarWrapper_);\n    browserEvents.unbind(this.onMouseDownHandleWrapper_);\n\n    dom.removeNode(this.outerSvg);\n    this.workspace.getThemeManager().unsubscribe(this.svgHandle);\n  }\n\n  /**\n   * Constrain the handle's length within the minimum (0) and maximum\n   * (scrollbar background) values allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandleLength(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      value = Math.min(value, this.scrollbarLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the length of the scrollbar's handle and change the SVG attribute\n   * accordingly.\n   *\n   * @param newLength The new scrollbar handle length in CSS pixels.\n   */\n  private setHandleLength(newLength: number) {\n    this.handleLength = newLength;\n    this.svgHandle.setAttribute(\n      this.lengthAttribute_,\n      String(this.handleLength),\n    );\n  }\n\n  /**\n   * Constrain the handle's position within the minimum (0) and maximum values\n   * allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandlePosition(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      // Handle length should never be greater than this.scrollbarLength_.\n      // If the viewSize is greater than or equal to the scrollSize, the\n      // handleLength will end up equal to this.scrollbarLength_.\n      value = Math.min(value, this.scrollbarLength - this.handleLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the offset of the scrollbar's handle from the scrollbar's position, and\n   * change the SVG attribute accordingly.\n   *\n   * @param newPosition The new scrollbar handle offset in CSS pixels.\n   */\n  setHandlePosition(newPosition: number) {\n    this.handlePosition = newPosition;\n    this.svgHandle.setAttribute(\n      this.positionAttribute_,\n      String(this.handlePosition),\n    );\n  }\n\n  /**\n   * Set the size of the scrollbar's background and change the SVG attribute\n   * accordingly.\n   *\n   * @param newSize The new scrollbar background length in CSS pixels.\n   */\n  private setScrollbarLength(newSize: number) {\n    this.scrollbarLength = newSize;\n    this.outerSvg.setAttribute(\n      this.lengthAttribute_,\n      String(this.scrollbarLength),\n    );\n    this.svgBackground.setAttribute(\n      this.lengthAttribute_,\n      String(this.scrollbarLength),\n    );\n  }\n\n  /**\n   * Set the position of the scrollbar's SVG group in CSS pixels relative to the\n   * scrollbar's origin.  This sets the scrollbar's location within the\n   * workspace.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   * @internal\n   */\n  setPosition(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n\n    const tempX = this.position.x + this.origin.x;\n    const tempY = this.position.y + this.origin.y;\n    const transform = 'translate(' + tempX + 'px,' + tempY + 'px)';\n    dom.setCssTransform(this.outerSvg, transform);\n  }\n\n  /**\n   * Recalculate the scrollbar's location and its length.\n   *\n   * @param opt_metrics A data structure of from the describing all the required\n   *     dimensions.  If not provided, it will be fetched from the host object.\n   */\n  resize(opt_metrics?: Metrics) {\n    // Determine the location, height and width of the host element.\n    let hostMetrics = opt_metrics;\n    if (!hostMetrics) {\n      hostMetrics = this.workspace.getMetrics();\n      if (!hostMetrics) {\n        // Host element is likely not visible.\n        return;\n      }\n    }\n\n    if (\n      this.oldHostMetrics &&\n      Scrollbar.metricsAreEquivalent(hostMetrics, this.oldHostMetrics)\n    ) {\n      return;\n    }\n\n    if (this.horizontal) {\n      this.resizeHorizontal(hostMetrics);\n    } else {\n      this.resizeVertical(hostMetrics);\n    }\n\n    this.oldHostMetrics = hostMetrics;\n\n    // Resizing may have caused some scrolling.\n    this.updateMetrics();\n  }\n\n  /**\n   * Returns whether the a resizeView is necessary by comparing the passed\n   * hostMetrics with cached old host metrics.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   * @returns Whether a resizeView is necessary.\n   */\n  private requiresViewResize(hostMetrics: Metrics): boolean {\n    if (!this.oldHostMetrics) {\n      return true;\n    }\n    return (\n      this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n      this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n      this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft ||\n      this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop\n    );\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeHorizontal(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewHorizontal(hostMetrics);\n    } else {\n      this.resizeContentHorizontal(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location on the screen and path\n   * length. This should be called when the layout or size of the window has\n   * changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewHorizontal(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewWidth - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    let xCoordinate = hostMetrics.absoluteLeft + this.margin;\n    if (this.pair && this.workspace.RTL) {\n      xCoordinate += Scrollbar.scrollbarThickness;\n    }\n\n    // Horizontal toolbar should always be just above the bottom of the\n    // workspace.\n    const yCoordinate =\n      hostMetrics.absoluteTop +\n      hostMetrics.viewHeight -\n      Scrollbar.scrollbarThickness -\n      this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentHorizontal(hostMetrics);\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentHorizontal(hostMetrics: Metrics) {\n    if (hostMetrics.viewWidth >= hostMetrics.scrollWidth) {\n      // viewWidth is often greater than scrollWidth in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n      (this.scrollbarLength * hostMetrics.viewWidth) / hostMetrics.scrollWidth;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewLeft === scrollLeft\n    //     then the offset should be 0\n    // If viewRight === scrollRight\n    //     then viewLeft = scrollLeft + scrollWidth - viewWidth\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollWidth - hostMetrics.viewWidth;\n    const contentDisplacement = hostMetrics.viewLeft - hostMetrics.scrollLeft;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeVertical(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewVertical(hostMetrics);\n    } else {\n      this.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewVertical(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewHeight - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    const xCoordinate = this.workspace.RTL\n      ? hostMetrics.absoluteLeft + this.margin\n      : hostMetrics.absoluteLeft +\n        hostMetrics.viewWidth -\n        Scrollbar.scrollbarThickness -\n        this.margin;\n\n    const yCoordinate = hostMetrics.absoluteTop + this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentVertical(hostMetrics);\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentVertical(hostMetrics: Metrics) {\n    if (hostMetrics.viewHeight >= hostMetrics.scrollHeight) {\n      // viewHeight is often greater than scrollHeight in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n      (this.scrollbarLength * hostMetrics.viewHeight) /\n      hostMetrics.scrollHeight;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewTop === scrollTop\n    //     then the offset should be 0\n    // If viewBottom === scrollBottom\n    //     then viewTop = scrollTop + scrollHeight - viewHeight\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollHeight - hostMetrics.viewHeight;\n    const contentDisplacement = hostMetrics.viewTop - hostMetrics.scrollTop;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Is the scrollbar visible.  Non-paired scrollbars disappear when they aren't\n   * needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isHandleVisible;\n  }\n\n  /**\n   * Set whether the scrollbar's container is visible and update\n   * display accordingly if visibility has changed.\n   *\n   * @param visible Whether the container is visible\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether the scrollbar is visible.\n   * Only applies to non-paired scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    // Ideally this would also apply to scrollbar pairs, but that's a bigger\n    // headache (due to interactions with the corner square), and the fact\n    // that telling the pair to resize itself would cause circular dependencies.\n    if (this.pair) {\n      throw Error('Unable to toggle visibility of paired scrollbars.');\n    }\n    this.setVisibleInternal(visible);\n  }\n\n  /**\n   * Set whether the scrollbar is visible. Bypasses checking whether this\n   * scrollbar is part of a pair so that it can be toggled by the scrollbar\n   * pair.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisibleInternal(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n    this.isHandleVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update visibility of scrollbar based on whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   * We cannot rely on the containing workspace being hidden to hide us\n   * because it is not necessarily our parent in the DOM.\n   */\n  updateDisplay_() {\n    let show = true;\n    // Check whether our parent/container is visible.\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (show) {\n      this.outerSvg.setAttribute('display', 'block');\n    } else {\n      this.outerSvg.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Scroll by one pageful.\n   * Called when scrollbar background is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownBar(e: MouseEvent) {\n    this.workspace.markFocused();\n    Touch.clearTouchIdentifier(); // This is really a click.\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    const mouseXY = browserEvents.mouseToSvg(\n      e,\n      this.workspace.getParentSvg(),\n      this.workspace.getInverseScreenCTM(),\n    );\n    const mouseLocation = this.horizontal ? mouseXY.x : mouseXY.y;\n\n    const handleXY = svgMath.getInjectionDivXY(this.svgHandle);\n    const handleStart = this.horizontal ? handleXY.x : handleXY.y;\n    let handlePosition = this.handlePosition;\n\n    const pageLength = this.handleLength * 0.95;\n    if (mouseLocation <= handleStart) {\n      // Decrease the scrollbar's value by a page.\n      handlePosition -= pageLength;\n    } else if (mouseLocation >= handleStart + this.handleLength) {\n      // Increase the scrollbar's value by a page.\n      handlePosition += pageLength;\n    }\n\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n\n    this.updateMetrics();\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Start a dragging operation.\n   * Called when scrollbar handle is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownHandle(e: PointerEvent) {\n    this.workspace.markFocused();\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    // Look up the current translation and record it.\n    this.startDragHandle = this.handlePosition;\n\n    // Record the current mouse position.\n    this.startDragMouse = this.horizontal ? e.clientX : e.clientY;\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onMouseUpHandle,\n    );\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onMouseMoveHandle,\n    );\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Drag the scrollbar's handle.\n   *\n   * @param e Mouse move event.\n   */\n  private onMouseMoveHandle(e: PointerEvent) {\n    const currentMouse = this.horizontal ? e.clientX : e.clientY;\n    const mouseDelta = currentMouse - this.startDragMouse;\n    const handlePosition = this.startDragHandle + mouseDelta;\n    // Position the bar.\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n    this.updateMetrics();\n  }\n\n  /** Release the scrollbar handle and reset state accordingly. */\n  private onMouseUpHandle() {\n    Touch.clearTouchIdentifier();\n    this.cleanUp();\n  }\n\n  /**\n   * Hide chaff and stop binding to mouseup and mousemove events.  Call this to\n   * wrap up loose ends associated with the scrollbar.\n   */\n  private cleanUp() {\n    this.workspace.hideChaff(true);\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Helper to calculate the ratio of handle position to scrollbar view size.\n   *\n   * @returns Ratio.\n   * @internal\n   */\n  getRatio_(): number {\n    const scrollHandleRange = this.scrollbarLength - this.handleLength;\n    let ratio = this.handlePosition / scrollHandleRange;\n    if (isNaN(ratio)) {\n      ratio = 0;\n    }\n    return ratio;\n  }\n\n  /**\n   * Updates workspace metrics based on new scroll ratio. Called when scrollbar\n   * is moved.\n   */\n  private updateMetrics() {\n    const ratio = this.getRatio_();\n    if (this.horizontal) {\n      this.workspace.setMetrics({x: ratio});\n    } else {\n      this.workspace.setMetrics({y: ratio});\n    }\n  }\n\n  /**\n   * Set the scrollbar handle's position.\n   *\n   * @param value The content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(value: number, updateMetrics?: boolean) {\n    this.setHandlePosition(this.constrainHandlePosition(value * this.ratio));\n    if (updateMetrics || updateMetrics === undefined) {\n      this.updateMetrics();\n    }\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   */\n  setOrigin(x: number, y: number) {\n    this.origin = new Coordinate(x, y);\n  }\n\n  /**\n   * @param first An object containing computed measurements of a workspace.\n   * @param second Another object containing computed measurements of a\n   *     workspace.\n   * @returns Whether the two sets of metrics are equivalent.\n   */\n  private static metricsAreEquivalent(\n    first: Metrics,\n    second: Metrics,\n  ): boolean {\n    return (\n      first.viewWidth === second.viewWidth &&\n      first.viewHeight === second.viewHeight &&\n      first.viewLeft === second.viewLeft &&\n      first.viewTop === second.viewTop &&\n      first.absoluteTop === second.absoluteTop &&\n      first.absoluteLeft === second.absoluteLeft &&\n      first.scrollWidth === second.scrollWidth &&\n      first.scrollHeight === second.scrollHeight &&\n      first.scrollLeft === second.scrollLeft &&\n      first.scrollTop === second.scrollTop\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains the path to a single png tat holds the images for the trashcan\n * as well as the zoom controls.\n */\nexport const SPRITE = {\n  width: 96,\n  height: 124,\n  url: 'sprites.png',\n};\n", "/**\n * @license\n * Copyright 2015 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a zoom icons.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ZoomControls\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport * as Css from './css.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport {SPRITE} from './sprites.js';\nimport * as Touch from './touch.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a zoom controls.\n */\nexport class ZoomControls implements IPositionable {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id = 'zoomControls';\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** The zoom in svg <g> element. */\n  private zoomInGroup: SVGGElement | null = null;\n\n  /** The zoom out svg <g> element. */\n  private zoomOutGroup: SVGGElement | null = null;\n\n  /** The zoom reset svg <g> element. */\n  private zoomResetGroup: SVGGElement | null = null;\n\n  /** Width of the zoom controls. */\n  private readonly WIDTH = 32;\n\n  /** Height of each zoom control. */\n  private readonly HEIGHT = 32;\n\n  /** Small spacing used between the zoom in and out control, in pixels. */\n  private readonly SMALL_SPACING = 2;\n\n  /**\n   * Large spacing used between the zoom in and reset control, in pixels.\n   */\n  private readonly LARGE_SPACING = 11;\n\n  /** Distance between zoom controls and bottom or top edge of workspace. */\n  private readonly MARGIN_VERTICAL = 20;\n\n  /** Distance between zoom controls and right or left edge of workspace. */\n  private readonly MARGIN_HORIZONTAL = 20;\n\n  /** The SVG group containing the zoom controls. */\n  private svgGroup: SVGElement | null = null;\n\n  /** Left coordinate of the zoom controls. */\n  private left = 0;\n\n  /** Top coordinate of the zoom controls. */\n  private top = 0;\n\n  /** Whether this has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Create the zoom controls.\n   *\n   * @returns The zoom controls SVG group.\n   */\n  createDom(): SVGElement {\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\n\n    // Each filter/pattern needs a unique ID for the case of multiple Blockly\n    // instances on a page.  Browser behaviour becomes undefined otherwise.\n    // https://neil.fraser.name/news/2015/11/01/\n    const rnd = String(Math.random()).substring(2);\n    this.createZoomOutSvg(rnd);\n    this.createZoomInSvg(rnd);\n    if (this.workspace.isMovable()) {\n      // If we zoom to the center and the workspace isn't movable we could\n      // loose blocks at the edges of the workspace.\n      this.createZoomResetSvg(rnd);\n    }\n    return this.svgGroup;\n  }\n\n  /** Initializes the zoom controls. */\n  init() {\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 2,\n      capabilities: [ComponentManager.Capability.POSITIONABLE],\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Disposes of this zoom controls.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('zoomControls');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null {\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const bottom = this.top + height;\n    const right = this.left + this.WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Positions the zoom controls.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\n      this.workspace,\n      metrics,\n    );\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const startRect = uiPosition.getStartPositionRect(\n      cornerPosition,\n      new Size(this.WIDTH, height),\n      this.MARGIN_HORIZONTAL,\n      this.MARGIN_VERTICAL,\n      metrics,\n      this.workspace,\n    );\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection =\n      verticalPosition === uiPosition.verticalPosition.TOP\n        ? uiPosition.bumpDirection.DOWN\n        : uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n      startRect,\n      this.MARGIN_VERTICAL,\n      bumpDirection,\n      savedPositions,\n    );\n\n    if (verticalPosition === uiPosition.verticalPosition.TOP) {\n      const zoomInTranslateY = this.SMALL_SPACING + this.HEIGHT;\n      this.zoomInGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomInTranslateY + ')',\n      );\n      if (this.zoomResetGroup) {\n        const zoomResetTranslateY =\n          zoomInTranslateY + this.LARGE_SPACING + this.HEIGHT;\n        this.zoomResetGroup.setAttribute(\n          'transform',\n          'translate(0, ' + zoomResetTranslateY + ')',\n        );\n      }\n    } else {\n      const zoomInTranslateY = this.zoomResetGroup\n        ? this.LARGE_SPACING + this.HEIGHT\n        : 0;\n      this.zoomInGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomInTranslateY + ')',\n      );\n      const zoomOutTranslateY =\n        zoomInTranslateY + this.SMALL_SPACING + this.HEIGHT;\n      this.zoomOutGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomOutTranslateY + ')',\n      );\n    }\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n      'transform',\n      'translate(' + this.left + ',' + this.top + ')',\n    );\n  }\n\n  /**\n   * Create the zoom in icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomOutSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomoutClipPath837493\">\n            <rect width=\"32\" height=\"32></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-64\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomoutClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomOutGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomOut'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoomoutClipPath' + rnd},\n      this.zoomOutGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': 32,\n        'height': 32,\n      },\n      clip,\n    );\n    const zoomoutSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'x': -64,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoomoutClipPath' + rnd + ')',\n      },\n      this.zoomOutGroup,\n    );\n    zoomoutSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach listener.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomOutGroup,\n        'pointerdown',\n        null,\n        this.zoom.bind(this, -1),\n      ),\n    );\n  }\n\n  /**\n   * Create the zoom out icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomInSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoominClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoominClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomInGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomIn'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoominClipPath' + rnd},\n      this.zoomInGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': 32,\n        'height': 32,\n      },\n      clip,\n    );\n    const zoominSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'x': -32,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoominClipPath' + rnd + ')',\n      },\n      this.zoomInGroup,\n    );\n    zoominSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach listener.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomInGroup,\n        'pointerdown',\n        null,\n        this.zoom.bind(this, 1),\n      ),\n    );\n  }\n\n  /**\n   * Handles a mouse down event on the zoom in or zoom out buttons on the\n   *    workspace.\n   *\n   * @param amount Amount of zooming. Negative amount values zoom out, and\n   *     positive amount values zoom in.\n   * @param e A mouse down event.\n   */\n  private zoom(amount: number, e: PointerEvent) {\n    this.workspace.markFocused();\n    this.workspace.zoomCenter(amount);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier(); // Don't block future drags.\n    e.stopPropagation(); // Don't start a workspace scroll.\n    e.preventDefault(); // Stop double-clicking from selecting text.\n  }\n\n  /**\n   * Create the zoom reset icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomResetSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomresetClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomresetClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomResetGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomReset'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoomresetClipPath' + rnd},\n      this.zoomResetGroup,\n    );\n    dom.createSvgElement(Svg.RECT, {'width': 32, 'height': 32}, clip);\n    const zoomresetSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoomresetClipPath' + rnd + ')',\n      },\n      this.zoomResetGroup,\n    );\n    zoomresetSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach event listeners.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomResetGroup,\n        'pointerdown',\n        null,\n        this.resetZoom.bind(this),\n      ),\n    );\n  }\n\n  /**\n   * Handles a mouse down event on the reset zoom button on the workspace.\n   *\n   * @param e A mouse down event.\n   */\n  private resetZoom(e: PointerEvent) {\n    this.workspace.markFocused();\n\n    // zoom is passed amount and computes the new scale using the formula:\n    // targetScale = currentScale * Math.pow(speed, amount)\n    const targetScale = this.workspace.options.zoomOptions.startScale;\n    const currentScale = this.workspace.scale;\n    const speed = this.workspace.options.zoomOptions.scaleSpeed;\n    // To compute amount:\n    // amount = log(speed, (targetScale / currentScale))\n    // Math.log computes natural logarithm (ln), to change the base, use\n    // formula: log(base, value) = ln(value) / ln(base)\n    const amount = Math.log(targetScale / currentScale) / Math.log(speed);\n    this.workspace.beginCanvasTransition();\n    this.workspace.zoomCenter(amount);\n    this.workspace.scrollCenter();\n\n    setTimeout(this.workspace.endCanvasTransition.bind(this.workspace), 500);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier(); // Don't block future drags.\n    e.stopPropagation(); // Don't start a workspace scroll.\n    e.preventDefault(); // Stop double-clicking from selecting text.\n  }\n\n  /** Fires a zoom control UI event. */\n  private fireZoomEvent() {\n    const uiEvent = new (eventUtils.get(eventUtils.CLICK))(\n      null,\n      this.workspace.id,\n      'zoom_controls',\n    );\n    eventUtils.fire(uiEvent);\n  }\n}\n\n/** CSS for zoom controls.  See css.js for use. */\nCss.register(`\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n`);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.constants\n\n/**\n * The language-neutral ID given to the collapsed input.\n */\nexport const COLLAPSED_INPUT_NAME = '_TEMP_COLLAPSED_INPUT';\n\n/**\n * The language-neutral ID given to the collapsed field.\n */\nexport const COLLAPSED_FIELD_NAME = '_TEMP_COLLAPSED_FIELD';\n\n/**\n * The language-neutral ID for when the reason why a block is disabled is\n * because the user manually disabled it, such as via the context menu.\n */\nexport const MANUALLY_DISABLED = 'MANUALLY_DISABLED';\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ICommentIcon} from '../interfaces/i_comment_icon.js';\nimport {IIcon} from '../interfaces/i_icon.js';\nimport {MutatorIcon} from './mutator_icon.js';\nimport {WarningIcon} from './warning_icon.js';\n\n/**\n * Defines the type of an icon, so that it can be retrieved from block.getIcon\n */\nexport class IconType<_T extends IIcon> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /** @returns the name of the type. */\n  toString(): string {\n    return this.name;\n  }\n\n  /** @returns true if this icon type is equivalent to the given icon type. */\n  equals(type: IconType<IIcon>): boolean {\n    return this.name === type.toString();\n  }\n\n  static MUTATOR = new IconType<MutatorIcon>('mutator');\n  static WARNING = new IconType<WarningIcon>('warning');\n  static COMMENT = new IconType<ICommentIcon>('comment');\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.inputTypes\n\nimport {ConnectionType} from '../connection_type.js';\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum inputTypes {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  VALUE = ConnectionType.INPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  STATEMENT = ConnectionType.NEXT_STATEMENT,\n  // A dummy input.  Used to add field(s) with no input.\n  DUMMY = 5,\n  // An unknown type of input defined by an external developer.\n  CUSTOM = 6,\n  // An input with no connections that is always the last input of a row. Any\n  // subsequent input will be rendered on the next row. Any newline character in\n  // a JSON block definition's message will be parsed as an end-row input.\n  END_ROW = 7,\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Msg\n\n/** A dictionary of localised messages. */\nexport const Msg: {[key: string]: string} = Object.create(null);\n\n/**\n * Sets the locale (i.e. the localized messages/block-text/etc) to the given\n * locale.\n *\n * This is not useful/necessary when loading from a script tag, because the\n * messages are automatically cluged into the Blockly.Msg object. But we provide\n * it in both the script-tag and non-script-tag contexts so that the tscompiler\n * can properly create our type definition files.\n *\n * @param locale An object defining the messages for a given language.\n */\nexport const setLocale = function (locale: {[key: string]: string}) {\n  Object.keys(locale).forEach(function (k) {\n    Msg[k] = locale[k];\n  });\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for a variable event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.VarBase\n\nimport type {VariableModel} from '../variable_model.js';\n\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Abstract class for a variable event.\n */\nexport class VarBase extends AbstractEvent {\n  override isBlank = true;\n  /** The ID of the variable this event references. */\n  varId?: string;\n\n  /**\n   * @param opt_variable The variable this event corresponds to.  Undefined for\n   *     a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super();\n    this.isBlank = typeof opt_variable === 'undefined';\n    if (!opt_variable) return;\n\n    this.varId = opt_variable.getId();\n    this.workspaceId = opt_variable.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarBaseJson {\n    const json = super.toJson() as VarBaseJson;\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varId'] = this.varId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarBase(),\n    ) as VarBase;\n    newEvent.varId = json['varId'];\n    return newEvent;\n  }\n}\n\nexport interface VarBaseJson extends AbstractEventJson {\n  varId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a variable creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.VarCreate\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a variable model has been created.\n */\nexport class VarCreate extends VarBase {\n  override type = eventUtils.VAR_CREATE;\n\n  /** The type of the variable that was created. */\n  varType?: string;\n\n  /** The name of the variable that was created. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The created variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarCreateJson {\n    const json = super.toJson() as VarCreateJson;\n    if (this.varType === undefined) {\n      throw new Error(\n        'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarCreate, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarCreate(),\n    ) as VarCreate;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    } else {\n      workspace.deleteVariableById(this.varId);\n    }\n  }\n}\n\nexport interface VarCreateJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_CREATE, VarCreate);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for the variable model.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VariableModel\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a variable model.\n * Holds information for the variable including name, ID, and type.\n *\n * @see {Blockly.FieldVariable}\n */\nexport class VariableModel {\n  type: string;\n  private readonly id_: string;\n\n  /**\n   * @param workspace The variable's workspace.\n   * @param name The name of the variable.  This is the user-visible name (e.g.\n   *     'my var' or ''), not the generated name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   */\n  constructor(\n    public workspace: Workspace,\n    public name: string,\n    opt_type?: string,\n    opt_id?: string,\n  ) {\n    /**\n     * The type of the variable, such as 'int' or 'sound_effect'. This may be\n     * used to build a list of variables of a specific type. By default this is\n     * the empty string '', which is a specific type.\n     *\n     * @see {Blockly.FieldVariable}\n     */\n    this.type = opt_type || '';\n\n    /**\n     * A unique ID for the variable. This should be defined at creation and\n     * not change, even if the name changes. In most cases this should be a\n     * UUID.\n     */\n    this.id_ = opt_id || idGenerator.genUid();\n  }\n\n  /** @returns The ID for the variable. */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * A custom compare function for the VariableModel objects.\n   *\n   * @param var1 First variable to compare.\n   * @param var2 Second variable to compare.\n   * @returns -1 if name of var1 is less than name of var2, 0 if equal, and 1 if\n   *     greater.\n   * @internal\n   */\n  static compareByName(var1: VariableModel, var2: VariableModel): number {\n    return var1.name.localeCompare(var2.name, undefined, {sensitivity: 'base'});\n  }\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Workspace} from '../workspace.js';\nimport {Size} from '../utils/size.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport * as eventUtils from '../events/utils.js';\nimport {CommentMove} from '../events/events_comment_move.js';\n\nexport class WorkspaceComment {\n  /** The unique identifier for this comment. */\n  public readonly id: string;\n\n  /** The text of the comment. */\n  private text = '';\n\n  /** The size of the comment in workspace units. */\n  private size = new Size(120, 100);\n\n  /** Whether the comment is collapsed or not. */\n  private collapsed = false;\n\n  /** Whether the comment is editable or not. */\n  private editable = true;\n\n  /** Whether the comment is movable or not. */\n  private movable = true;\n\n  /** Whether the comment is deletable or not. */\n  private deletable = true;\n\n  /** The location of the comment in workspace coordinates. */\n  protected location = new Coordinate(0, 0);\n\n  /** Whether this comment has been disposed or not. */\n  protected disposed = false;\n\n  /** Whether this comment is being disposed or not. */\n  protected disposing = false;\n\n  /**\n   * Constructs the comment.\n   *\n   * @param workspace The workspace to construct the comment in.\n   * @param id An optional ID to give to the comment. If not provided, one will\n   *     be generated.\n   */\n  constructor(\n    public readonly workspace: Workspace,\n    id?: string,\n  ) {\n    this.id = id && !workspace.getCommentById(id) ? id : idGenerator.genUid();\n\n    workspace.addTopComment(this);\n\n    this.fireCreateEvent();\n  }\n\n  private fireCreateEvent() {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_CREATE))(this));\n    }\n  }\n\n  private fireDeleteEvent() {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n  }\n\n  /** Fires a comment change event. */\n  private fireChangeEvent(oldText: string, newText: string) {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.COMMENT_CHANGE))(this, oldText, newText),\n      );\n    }\n  }\n\n  /** Fires a comment collapse event. */\n  private fireCollapseEvent(newCollapsed: boolean) {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.COMMENT_COLLAPSE))(this, newCollapsed),\n      );\n    }\n  }\n\n  /** Sets the text of the comment. */\n  setText(text: string) {\n    const oldText = this.text;\n    this.text = text;\n    this.fireChangeEvent(oldText, text);\n  }\n\n  /** Returns the text of the comment. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the comment's size in workspace units. */\n  setSize(size: Size) {\n    this.size = size;\n  }\n\n  /** Returns the comment's size in workspace units. */\n  getSize(): Size {\n    return this.size;\n  }\n\n  /** Sets whether the comment is collapsed or not. */\n  setCollapsed(collapsed: boolean) {\n    this.collapsed = collapsed;\n    this.fireCollapseEvent(collapsed);\n  }\n\n  /** Returns whether the comment is collapsed or not. */\n  isCollapsed(): boolean {\n    return this.collapsed;\n  }\n\n  /** Sets whether the comment is editable or not. */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n  }\n\n  /**\n   * Returns whether the comment is editable or not, respecting whether the\n   * workspace is read-only.\n   */\n  isEditable(): boolean {\n    return this.isOwnEditable() && !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Returns whether the comment is editable or not, only examining its own\n   * state and ignoring the state of the workspace.\n   */\n  isOwnEditable(): boolean {\n    return this.editable;\n  }\n\n  /** Sets whether the comment is movable or not. */\n  setMovable(movable: boolean) {\n    this.movable = movable;\n  }\n\n  /**\n   * Returns whether the comment is movable or not, respecting whether the\n   * workspace is read-only.\n   */\n  isMovable() {\n    return this.isOwnMovable() && !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Returns whether the comment is movable or not, only examining its own\n   * state and ignoring the state of the workspace.\n   */\n  isOwnMovable() {\n    return this.movable;\n  }\n\n  /** Sets whether the comment is deletable or not. */\n  setDeletable(deletable: boolean) {\n    this.deletable = deletable;\n  }\n\n  /**\n   * Returns whether the comment is deletable or not, respecting whether the\n   * workspace is read-only.\n   */\n  isDeletable(): boolean {\n    return this.isOwnDeletable() && !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Returns whether the comment is deletable or not, only examining its own\n   * state and ignoring the state of the workspace.\n   */\n  isOwnDeletable(): boolean {\n    return this.deletable;\n  }\n\n  /** Moves the comment to the given location in workspace coordinates. */\n  moveTo(location: Coordinate, reason?: string[] | undefined) {\n    const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n      this,\n    ) as CommentMove;\n    if (reason) event.setReason(reason);\n\n    this.location = location;\n\n    event.recordNew();\n    if (eventUtils.isEnabled()) eventUtils.fire(event);\n  }\n\n  /** Returns the position of the comment in workspace coordinates. */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.location;\n  }\n\n  /** Disposes of this comment. */\n  dispose() {\n    this.disposing = true;\n    this.fireDeleteEvent();\n    this.workspace.removeTopComment(this);\n    this.disposed = true;\n  }\n\n  /** Returns whether the comment has been disposed or not. */\n  isDisposed() {\n    return this.disposed;\n  }\n\n  /**\n   * Returns true if this comment view is currently being disposed or has\n   * already been disposed.\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The layer to place blocks on.\n *\n * @internal\n */\nexport const BLOCK = 50;\n\n/**\n * The layer to place bubbles on.\n *\n * @internal\n */\nexport const BUBBLE = 100;\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IRenderedElement} from '../interfaces/i_rendered_element.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as dom from '../utils/dom.js';\nimport {Svg} from '../utils/svg.js';\nimport * as layers from '../layers.js';\nimport * as css from '../css.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {Size} from '../utils/size.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as touch from '../touch.js';\n\nexport class CommentView implements IRenderedElement {\n  /** The root group element of the comment view. */\n  private svgRoot: SVGGElement;\n\n  /**\n   * The svg rect element that we use to create a hightlight around the comment.\n   */\n  private highlightRect: SVGRectElement;\n\n  /** The group containing all of the top bar elements. */\n  private topBarGroup: SVGGElement;\n\n  /** The rect background for the top bar. */\n  private topBarBackground: SVGRectElement;\n\n  /** The delete icon that goes in the top bar. */\n  private deleteIcon: SVGImageElement;\n\n  /** The foldout icon that goes in the top bar. */\n  private foldoutIcon: SVGImageElement;\n\n  /** The text element that goes in the top bar. */\n  private textPreview: SVGTextElement;\n\n  /** The actual text node in the text preview. */\n  private textPreviewNode: Text;\n\n  /** The resize handle element. */\n  private resizeHandle: SVGImageElement;\n\n  /** The foreignObject containing the HTML text area. */\n  private foreignObject: SVGForeignObjectElement;\n\n  /** The text area where the user can type. */\n  private textArea: HTMLTextAreaElement;\n\n  /** The current size of the comment in workspace units. */\n  private size: Size = new Size(120, 100);\n\n  /** Whether the comment is collapsed or not. */\n  private collapsed: boolean = false;\n\n  /** Whether the comment is editable or not. */\n  private editable: boolean = true;\n\n  /** The current location of the comment in workspace coordinates. */\n  private location: Coordinate = new Coordinate(0, 0);\n\n  /** The current text of the comment. Updates on  text area change. */\n  private text: string = '';\n\n  /** Listeners for changes to text. */\n  private textChangeListeners: Array<\n    (oldText: string, newText: string) => void\n  > = [];\n\n  /** Listeners for changes to size. */\n  private sizeChangeListeners: Array<(oldSize: Size, newSize: Size) => void> =\n    [];\n\n  /** Listeners for disposal. */\n  private disposeListeners: Array<() => void> = [];\n\n  /** Listeners for collapsing. */\n  private collapseChangeListeners: Array<(newCollapse: boolean) => void> = [];\n\n  /**\n   * Event data for the pointer up event on the resize handle. Used to\n   * unregister the listener.\n   */\n  private resizePointerUpListener: browserEvents.Data | null = null;\n\n  /**\n   * Event data for the pointer move event on the resize handle. Used to\n   * unregister the listener.\n   */\n  private resizePointerMoveListener: browserEvents.Data | null = null;\n\n  /** Whether this comment view is currently being disposed or not. */\n  private disposing = false;\n\n  /** Whether this comment view has been disposed or not. */\n  private disposed = false;\n\n  constructor(private readonly workspace: WorkspaceSvg) {\n    this.svgRoot = dom.createSvgElement(Svg.G, {\n      'class': 'blocklyComment blocklyEditable',\n    });\n\n    this.highlightRect = this.createHighlightRect(this.svgRoot);\n\n    ({\n      topBarGroup: this.topBarGroup,\n      topBarBackground: this.topBarBackground,\n      deleteIcon: this.deleteIcon,\n      foldoutIcon: this.foldoutIcon,\n      textPreview: this.textPreview,\n      textPreviewNode: this.textPreviewNode,\n    } = this.createTopBar(this.svgRoot, workspace));\n\n    ({foreignObject: this.foreignObject, textArea: this.textArea} =\n      this.createTextArea(this.svgRoot));\n\n    this.resizeHandle = this.createResizeHandle(this.svgRoot, workspace);\n\n    // TODO: Remove this comment before merging.\n    // I think we want comments to exist on the same layer as blocks.\n    workspace.getLayerManager()?.append(this, layers.BLOCK);\n\n    // Set size to the default size.\n    this.setSize(this.size);\n\n    // Set default transform (including inverted scale for RTL).\n    this.moveTo(new Coordinate(0, 0));\n  }\n\n  /**\n   * Creates the rect we use for highlighting the comment when it's selected.\n   */\n  private createHighlightRect(svgRoot: SVGGElement): SVGRectElement {\n    return dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyCommentHighlight'},\n      svgRoot,\n    );\n  }\n\n  /**\n   * Creates the top bar and the elements visually within it.\n   * Registers event listeners.\n   */\n  private createTopBar(\n    svgRoot: SVGGElement,\n    workspace: WorkspaceSvg,\n  ): {\n    topBarGroup: SVGGElement;\n    topBarBackground: SVGRectElement;\n    deleteIcon: SVGImageElement;\n    foldoutIcon: SVGImageElement;\n    textPreview: SVGTextElement;\n    textPreviewNode: Text;\n  } {\n    const topBarGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'class': 'blocklyCommentTopbar',\n      },\n      svgRoot,\n    );\n    const topBarBackground = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyCommentTopbarBackground',\n      },\n      topBarGroup,\n    );\n    // TODO: Before merging, does this mean to override an individual image,\n    // folks need to replace the whole media folder?\n    const deleteIcon = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyDeleteIcon',\n        'href': `${workspace.options.pathToMedia}delete-icon.svg`,\n      },\n      topBarGroup,\n    );\n    const foldoutIcon = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyFoldoutIcon',\n        'href': `${workspace.options.pathToMedia}foldout-icon.svg`,\n      },\n      topBarGroup,\n    );\n    const textPreview = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyCommentPreview blocklyCommentText blocklyText',\n      },\n      topBarGroup,\n    );\n    const textPreviewNode = document.createTextNode('');\n    textPreview.appendChild(textPreviewNode);\n\n    // TODO(toychest): Triggering this on pointerdown means that we can't start\n    //   drags on the foldout icon. We need to open up the gesture system\n    //   to fix this.\n    browserEvents.conditionalBind(\n      foldoutIcon,\n      'pointerdown',\n      this,\n      this.onFoldoutDown,\n    );\n    browserEvents.conditionalBind(\n      deleteIcon,\n      'pointerdown',\n      this,\n      this.onDeleteDown,\n    );\n\n    return {\n      topBarGroup,\n      topBarBackground,\n      deleteIcon,\n      foldoutIcon,\n      textPreview,\n      textPreviewNode,\n    };\n  }\n\n  /**\n   * Creates the text area where users can type. Registers event listeners.\n   */\n  private createTextArea(svgRoot: SVGGElement): {\n    foreignObject: SVGForeignObjectElement;\n    textArea: HTMLTextAreaElement;\n  } {\n    const foreignObject = dom.createSvgElement(\n      Svg.FOREIGNOBJECT,\n      {\n        'class': 'blocklyCommentForeignObject',\n      },\n      svgRoot,\n    );\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n    const textArea = document.createElementNS(\n      dom.HTML_NS,\n      'textarea',\n    ) as HTMLTextAreaElement;\n    dom.addClass(textArea, 'blocklyCommentText');\n    dom.addClass(textArea, 'blocklyTextarea');\n    dom.addClass(textArea, 'blocklyText');\n    body.appendChild(textArea);\n    foreignObject.appendChild(body);\n\n    browserEvents.conditionalBind(textArea, 'change', this, this.onTextChange);\n\n    return {foreignObject, textArea};\n  }\n\n  /** Creates the DOM elements for the comment resize handle. */\n  private createResizeHandle(\n    svgRoot: SVGGElement,\n    workspace: WorkspaceSvg,\n  ): SVGImageElement {\n    const resizeHandle = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyResizeHandle',\n        'href': `${workspace.options.pathToMedia}resize-handle.svg`,\n      },\n      svgRoot,\n    );\n\n    browserEvents.conditionalBind(\n      resizeHandle,\n      'pointerdown',\n      this,\n      this.onResizePointerDown,\n    );\n\n    return resizeHandle;\n  }\n\n  /** Returns the root SVG group element of the comment view. */\n  getSvgRoot(): SVGGElement {\n    return this.svgRoot;\n  }\n\n  /**\n   * Returns the current size of the comment in workspace units.\n   * Respects collapsing.\n   */\n  getSize(): Size {\n    return this.collapsed ? this.topBarBackground.getBBox() : this.size;\n  }\n\n  /**\n   * Sets the size of the comment in workspace units, and updates the view\n   * elements to reflect the new size.\n   */\n  setSize(size: Size) {\n    const topBarSize = this.topBarBackground.getBBox();\n    const deleteSize = this.deleteIcon.getBBox();\n    const foldoutSize = this.foldoutIcon.getBBox();\n    const textPreviewSize = this.textPreview.getBBox();\n    const resizeSize = this.resizeHandle.getBBox();\n\n    size = Size.max(\n      size,\n      this.calcMinSize(topBarSize, foldoutSize, deleteSize),\n    );\n    const oldSize = this.size;\n    this.size = size;\n\n    this.svgRoot.setAttribute('height', `${size.height}`);\n    this.svgRoot.setAttribute('width', `${size.width}`);\n\n    this.updateHighlightRect(size);\n    this.updateTopBarSize(size);\n    this.updateTextAreaSize(size, topBarSize);\n    this.updateDeleteIconPosition(size, topBarSize, deleteSize);\n    this.updateFoldoutIconPosition(topBarSize, foldoutSize);\n    this.updateTextPreviewSize(\n      size,\n      topBarSize,\n      textPreviewSize,\n      deleteSize,\n      resizeSize,\n    );\n    this.updateResizeHandlePosition(size, resizeSize);\n\n    this.onSizeChange(oldSize, this.size);\n  }\n\n  /**\n   * Calculates the minimum size for the uncollapsed comment based on text\n   * size and visible icons.\n   *\n   * The minimum width is based on the width of the truncated preview text.\n   *\n   * The minimum height is based on the height of the top bar.\n   */\n  private calcMinSize(\n    topBarSize: Size,\n    foldoutSize: Size,\n    deleteSize: Size,\n  ): Size {\n    this.updateTextPreview(this.textArea.value ?? '');\n    const textPreviewWidth = dom.getTextWidth(this.textPreview);\n\n    const foldoutMargin = this.calcFoldoutMargin(topBarSize, foldoutSize);\n    const deleteMargin = this.calcDeleteMargin(topBarSize, deleteSize);\n\n    let width = textPreviewWidth;\n    if (this.foldoutIcon.checkVisibility()) {\n      width += foldoutSize.width + foldoutMargin * 2;\n    } else if (textPreviewWidth) {\n      width += 4; // Arbitrary margin before text.\n    }\n    if (this.deleteIcon.checkVisibility()) {\n      width += deleteSize.width + deleteMargin * 2;\n    } else if (textPreviewWidth) {\n      width += 4; // Arbitrary margin after text.\n    }\n\n    // Arbitrary additional height.\n    const height = topBarSize.height + 20;\n\n    return new Size(width, height);\n  }\n\n  /** Calculates the margin that should exist around the delete icon. */\n  private calcDeleteMargin(topBarSize: Size, deleteSize: Size) {\n    return (topBarSize.height - deleteSize.height) / 2;\n  }\n\n  /** Calculates the margin that should exist around the foldout icon. */\n  private calcFoldoutMargin(topBarSize: Size, foldoutSize: Size) {\n    return (topBarSize.height - foldoutSize.height) / 2;\n  }\n\n  /** Updates the size of the highlight rect to reflect the new size. */\n  private updateHighlightRect(size: Size) {\n    this.highlightRect.setAttribute('height', `${size.height}`);\n    this.highlightRect.setAttribute('width', `${size.width}`);\n    if (this.workspace.RTL) {\n      this.highlightRect.setAttribute('x', `${-size.width}`);\n    }\n  }\n\n  /** Updates the size of the top bar to reflect the new size. */\n  private updateTopBarSize(size: Size) {\n    this.topBarBackground.setAttribute('width', `${size.width}`);\n  }\n\n  /** Updates the size of the text area elements to reflect the new size. */\n  private updateTextAreaSize(size: Size, topBarSize: Size) {\n    this.foreignObject.setAttribute(\n      'height',\n      `${size.height - topBarSize.height}`,\n    );\n    this.foreignObject.setAttribute('width', `${size.width}`);\n    this.foreignObject.setAttribute('y', `${topBarSize.height}`);\n    if (this.workspace.RTL) {\n      this.foreignObject.setAttribute('x', `${-size.width}`);\n    }\n  }\n\n  /**\n   * Updates the position of the delete icon elements to reflect the new size.\n   */\n  private updateDeleteIconPosition(\n    size: Size,\n    topBarSize: Size,\n    deleteSize: Size,\n  ) {\n    const deleteMargin = this.calcDeleteMargin(topBarSize, deleteSize);\n    this.deleteIcon.setAttribute('y', `${deleteMargin}`);\n    this.deleteIcon.setAttribute(\n      'x',\n      `${size.width - deleteSize.width - deleteMargin}`,\n    );\n  }\n\n  /**\n   * Updates the position of the foldout icon elements to reflect the new size.\n   */\n  private updateFoldoutIconPosition(topBarSize: Size, foldoutSize: Size) {\n    const foldoutMargin = this.calcFoldoutMargin(topBarSize, foldoutSize);\n    this.foldoutIcon.setAttribute('y', `${foldoutMargin}`);\n    this.foldoutIcon.setAttribute('x', `${foldoutMargin}`);\n  }\n\n  /**\n   * Updates the size and position of the text preview elements to reflect the new size.\n   */\n  private updateTextPreviewSize(\n    size: Size,\n    topBarSize: Size,\n    textPreviewSize: Size,\n    deleteSize: Size,\n    foldoutSize: Size,\n  ) {\n    const textPreviewMargin = (topBarSize.height - textPreviewSize.height) / 2;\n    const deleteMargin = this.calcDeleteMargin(topBarSize, deleteSize);\n    const foldoutMargin = this.calcFoldoutMargin(topBarSize, foldoutSize);\n\n    const textPreviewWidth =\n      size.width -\n      foldoutSize.width -\n      foldoutMargin * 2 -\n      deleteSize.width -\n      deleteMargin * 2;\n    this.textPreview.setAttribute(\n      'x',\n      `${\n        foldoutSize.width + foldoutMargin * 2 * (this.workspace.RTL ? -1 : 1)\n      }`,\n    );\n    this.textPreview.setAttribute(\n      'y',\n      `${textPreviewMargin + textPreviewSize.height / 2}`,\n    );\n    this.textPreview.setAttribute('width', `${textPreviewWidth}`);\n  }\n\n  /** Updates the position of the resize handle to reflect the new size. */\n  private updateResizeHandlePosition(size: Size, resizeSize: Size) {\n    this.resizeHandle.setAttribute('y', `${size.height - resizeSize.height}`);\n    this.resizeHandle.setAttribute('x', `${size.width - resizeSize.width}`);\n  }\n\n  /**\n   * Triggers listeners when the size of the comment changes, either\n   * progrmatically or manually by the user.\n   */\n  private onSizeChange(oldSize: Size, newSize: Size) {\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.sizeChangeListeners.length - 1; i >= 0; i--) {\n      this.sizeChangeListeners[i](oldSize, newSize);\n    }\n  }\n\n  /**\n   * Registers a callback that listens for size changes.\n   *\n   * @param listener Receives callbacks when the size of the comment changes.\n   *     The new and old size are in workspace units.\n   */\n  addSizeChangeListener(listener: (oldSize: Size, newSize: Size) => void) {\n    this.sizeChangeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of size change listeners. */\n  removeSizeChangeListener(listener: () => void) {\n    this.sizeChangeListeners.splice(\n      this.sizeChangeListeners.indexOf(listener),\n      1,\n    );\n  }\n\n  /**\n   * Handles starting an interaction with the resize handle to resize the\n   * comment.\n   */\n  private onResizePointerDown(e: PointerEvent) {\n    if (!this.isEditable()) return;\n\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    // TODO(#7926): Move this into a utils file.\n    this.workspace.startDrag(\n      e,\n      new Coordinate(\n        this.workspace.RTL ? -this.getSize().width : this.getSize().width,\n        this.getSize().height,\n      ),\n    );\n\n    this.resizePointerUpListener = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onResizePointerUp,\n    );\n    this.resizePointerMoveListener = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onResizePointerMove,\n    );\n\n    this.workspace.hideChaff();\n\n    e.stopPropagation();\n  }\n\n  /** Ends an interaction with the resize handle. */\n  private onResizePointerUp(_e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    if (this.resizePointerUpListener) {\n      browserEvents.unbind(this.resizePointerUpListener);\n      this.resizePointerUpListener = null;\n    }\n    if (this.resizePointerMoveListener) {\n      browserEvents.unbind(this.resizePointerMoveListener);\n      this.resizePointerMoveListener = null;\n    }\n  }\n\n  /** Resizes the comment in response to a drag on the resize handle. */\n  private onResizePointerMove(e: PointerEvent) {\n    // TODO(#7926): Move this into a utils file.\n    const delta = this.workspace.moveDrag(e);\n    this.setSize(new Size(this.workspace.RTL ? -delta.x : delta.x, delta.y));\n  }\n\n  /** Returns true if the comment is currently collapsed. */\n  isCollapsed(): boolean {\n    return this.collapsed;\n  }\n\n  /** Sets whether the comment is currently collapsed or not. */\n  setCollapsed(collapsed: boolean) {\n    this.collapsed = collapsed;\n    if (collapsed) {\n      dom.addClass(this.svgRoot, 'blocklyCollapsed');\n    } else {\n      dom.removeClass(this.svgRoot, 'blocklyCollapsed');\n    }\n    // Repositions resize handle and such.\n    this.setSize(this.size);\n    this.onCollapse();\n  }\n\n  /**\n   * Triggers listeners when the collapsed-ness of the comment changes, either\n   * progrmatically or manually by the user.\n   */\n  private onCollapse() {\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.collapseChangeListeners.length - 1; i >= 0; i--) {\n      this.collapseChangeListeners[i](this.collapsed);\n    }\n  }\n\n  /** Registers a callback that listens for collapsed-ness changes. */\n  addOnCollapseListener(listener: (newCollapse: boolean) => void) {\n    this.collapseChangeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of on collapse listeners. */\n  removeOnCollapseListener(listener: () => void) {\n    this.collapseChangeListeners.splice(\n      this.collapseChangeListeners.indexOf(listener),\n      1,\n    );\n  }\n\n  /**\n   * Toggles the collapsedness of the block when we receive a pointer down\n   * event on the foldout icon.\n   */\n  private onFoldoutDown(e: PointerEvent) {\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.setCollapsed(!this.collapsed);\n\n    this.workspace.hideChaff();\n\n    e.stopPropagation();\n  }\n\n  /** Returns true if the comment is currently editable. */\n  isEditable(): boolean {\n    return this.editable;\n  }\n\n  /** Sets the editability of the comment. */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n    if (this.editable) {\n      dom.addClass(this.svgRoot, 'blocklyEditable');\n      dom.removeClass(this.svgRoot, 'blocklyReadonly');\n      this.textArea.removeAttribute('readonly');\n    } else {\n      dom.removeClass(this.svgRoot, 'blocklyEditable');\n      dom.addClass(this.svgRoot, 'blocklyReadonly');\n      this.textArea.setAttribute('readonly', 'true');\n    }\n  }\n\n  /** Returns the current location of the comment in workspace coordinates. */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.location;\n  }\n\n  /**\n   * Moves the comment view to the given location.\n   *\n   * @param location The location to move to in workspace coordinates.\n   */\n  moveTo(location: Coordinate) {\n    this.location = location;\n    this.svgRoot.setAttribute(\n      'transform',\n      `translate(${location.x}, ${location.y})`,\n    );\n  }\n\n  /** Retursn the current text of the comment. */\n  getText() {\n    return this.text;\n  }\n\n  /** Sets the current text of the comment. */\n  setText(text: string) {\n    this.textArea.value = text;\n    this.onTextChange();\n  }\n\n  /** Registers a callback that listens for text changes. */\n  addTextChangeListener(listener: (oldText: string, newText: string) => void) {\n    this.textChangeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of text change listeners. */\n  removeTextChangeListener(listener: () => void) {\n    this.textChangeListeners.splice(\n      this.textChangeListeners.indexOf(listener),\n      1,\n    );\n  }\n\n  /**\n   * Triggers listeners when the text of the comment changes, either\n   * progrmatically or manually by the user.\n   */\n  private onTextChange() {\n    const oldText = this.text;\n    this.text = this.textArea.value;\n    this.updateTextPreview(this.text);\n    // Update size in case our minimum size increased.\n    this.setSize(this.size);\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.textChangeListeners.length - 1; i >= 0; i--) {\n      this.textChangeListeners[i](oldText, this.text);\n    }\n  }\n\n  /** Updates the preview text element to reflect the given text. */\n  private updateTextPreview(text: string) {\n    this.textPreviewNode.textContent = this.truncateText(text);\n  }\n\n  /** Truncates the text to fit within the top view. */\n  private truncateText(text: string): string {\n    return text.length >= 12 ? `${text.substring(0, 9)}...` : text;\n  }\n\n  /** Brings the workspace comment to the front of its layer. */\n  private bringToFront() {\n    const parent = this.svgRoot.parentNode;\n    const childNodes = parent!.childNodes;\n    // Avoid moving the comment if it's already at the bottom.\n    if (childNodes[childNodes.length - 1] !== this.svgRoot) {\n      parent!.appendChild(this.svgRoot);\n    }\n  }\n\n  /**\n   * Handles disposing of the comment when we get a pointer down event on the\n   * delete icon.\n   */\n  private onDeleteDown(e: PointerEvent) {\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.dispose();\n    e.stopPropagation();\n  }\n\n  /** Disposes of this comment view. */\n  dispose() {\n    this.disposing = true;\n    dom.removeNode(this.svgRoot);\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.disposeListeners.length - 1; i >= 0; i--) {\n      this.disposeListeners[i]();\n    }\n    this.disposed = true;\n  }\n\n  /** Returns whether this comment view has been disposed or not. */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * Returns true if this comment view is currently being disposed or has\n   * already been disposed.\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /** Registers a callback that listens for disposal of this view. */\n  addDisposeListener(listener: () => void) {\n    this.disposeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of disposal listeners. */\n  removeDisposeListener(listener: () => void) {\n    this.disposeListeners.splice(this.disposeListeners.indexOf(listener), 1);\n  }\n}\n\ncss.register(`\n.injectionDiv {\n  --commentFillColour: #FFFCC7;\n  --commentBorderColour: #F2E49B;\n}\n\n.blocklyComment .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 1px solid var(--commentBorderColour);\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n\n.blocklyReadonly.blocklyComment .blocklyTextarea {\n  cursor: inherit;\n}\n\n.blocklyDeleteIcon {\n  width: 20px;\n  height: 20px;\n  display: none;\n  cursor: pointer;\n}\n\n.blocklyFoldoutIcon {\n  width: 20px;\n  height: 20px;\n  transform-origin: 12px 12px;\n  cursor: pointer;\n}\n.blocklyResizeHandle {\n  width: 12px;\n  height: 12px;\n  cursor: se-resize;\n}\n.blocklyReadonly.blocklyComment .blocklyResizeHandle {\n  cursor: inherit;\n}\n\n.blocklyCommentTopbarBackground {\n  cursor: grab;\n  fill: var(--commentBorderColour);\n  height: 24px;\n}\n\n.blocklyComment .blocklyCommentPreview.blocklyText {\n  fill: #000;\n  dominant-baseline: middle;\n  visibility: hidden;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentPreview {\n  visibility: visible;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,\n.blocklyCollapsed.blocklyComment .blocklyResizeHandle {\n  display: none;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {\n  transform: rotate(-90deg);\n}\n\n.blocklyRTL .blocklyCommentTopbar {\n  transform: scale(-1, 1);\n}\n\n.blocklyRTL .blocklyCommentForeignObject {\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyCommentPreview {\n  /* Revert the scale and control RTL using direction instead. */\n  transform: scale(-1, 1);\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyResizeHandle {\n  transform: scale(-1, 1);\n  cursor: sw-resize;\n}\n\n.blocklyCommentHighlight {\n  fill: none;\n}\n\n.blocklySelected .blocklyCommentHighlight {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {\n  stroke: none;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n`);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IDragStrategy} from '../interfaces/i_draggable.js';\nimport {Coordinate} from '../utils.js';\nimport * as eventUtils from '../events/utils.js';\nimport * as layers from '../layers.js';\nimport {RenderedWorkspaceComment} from '../comments.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {CommentMove} from '../events/events_comment_move.js';\n\nexport class CommentDragStrategy implements IDragStrategy {\n  private startLoc: Coordinate | null = null;\n\n  private workspace: WorkspaceSvg;\n\n  constructor(private comment: RenderedWorkspaceComment) {\n    this.workspace = comment.workspace;\n  }\n\n  isMovable(): boolean {\n    return this.comment.isOwnMovable() && !this.workspace.options.readOnly;\n  }\n\n  startDrag(): void {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n    this.startLoc = this.comment.getRelativeToSurfaceXY();\n    this.workspace.setResizesEnabled(false);\n    this.workspace.getLayerManager()?.moveToDragLayer(this.comment);\n    this.comment.setDragging(true);\n  }\n\n  drag(newLoc: Coordinate): void {\n    this.comment.moveDuringDrag(newLoc);\n  }\n\n  endDrag(): void {\n    this.fireMoveEvent();\n\n    this.workspace\n      .getLayerManager()\n      ?.moveOffDragLayer(this.comment, layers.BLOCK);\n    this.comment.setDragging(false);\n\n    this.comment.snapToGrid();\n\n    this.workspace.setResizesEnabled(true);\n    eventUtils.setGroup(false);\n  }\n\n  private fireMoveEvent() {\n    if (this.comment.isDeadOrDying()) return;\n    const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n      this.comment,\n    ) as CommentMove;\n    event.setReason(['drag']);\n    event.oldCoordinate_ = this.startLoc!;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  revertDrag(): void {\n    if (this.startLoc) this.comment.moveDuringDrag(this.startLoc);\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.priorities\n\n/**\n * The priority for deserializing variables.\n */\nexport const VARIABLES = 100;\n\n/**\n * The priority for deserializing variable data.\n */\nexport const PROCEDURES = 75;\n\n/**\n * The priority for deserializing blocks.\n */\nexport const BLOCKS = 50;\n\n/** The priority for deserializing workspace comments. */\nexport const WORKSPACE_COMMENTS = 25;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.config\n\n/**\n * All the values that we expect developers to be able to change\n * before injecting Blockly.\n */\ninterface Config {\n  dragRadius: number;\n  flyoutDragRadius: number;\n  snapRadius: number;\n  currentConnectionPreference: number;\n  bumpDelay: number;\n  connectingSnapRadius: number;\n}\n\n/** Default snap radius. */\nconst DEFAULT_SNAP_RADIUS = 28;\n\n/**\n * Object holding all the values on Blockly that we expect developers to be\n * able to change.\n */\nexport const config: Config = {\n  /**\n   * Number of pixels the mouse must move before a drag starts.\n   *\n   */\n  dragRadius: 5,\n  /**\n   * Number of pixels the mouse must move before a drag/scroll starts from the\n   * flyout.  Because the drag-intention is determined when this is reached, it\n   * is larger than dragRadius so that the drag-direction is clearer.\n   *\n   */\n  flyoutDragRadius: 10,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   *\n   */\n  snapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   * This should be the same as the snap radius.\n   */\n  connectingSnapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * How much to prefer staying connected to the current connection over moving\n   * to a new connection.  The current previewed connection is considered to be\n   * this much closer to the matching connection on the block than it actually\n   * is.\n   *\n   */\n  currentConnectionPreference: 8,\n  /**\n   * Delay in ms between trigger and bumping unconnected block out of alignment.\n   *\n   */\n  bumpDelay: 250,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu similar to Closure's goog.ui.Menu\n *\n * @class\n */\n// Former goog.module ID: Blockly.Menu\n\nimport * as browserEvents from './browser_events.js';\nimport type {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\n\n/**\n * A basic menu class.\n */\nexport class Menu {\n  /**\n   * Array of menu items.\n   * (Nulls are never in the array, but typing the array as nullable prevents\n   * the compiler from objecting to .indexOf(null))\n   */\n  private readonly menuItems: MenuItem[] = [];\n\n  /**\n   * Coordinates of the mousedown event that caused this menu to open. Used to\n   * prevent the consequent mouseup event due to a simple click from\n   * activating a menu item immediately.\n   */\n  openingCoords: Coordinate | null = null;\n\n  /**\n   * This is the element that we will listen to the real focus events on.\n   * A value of null means no menu item is highlighted.\n   */\n  private highlightedItem: MenuItem | null = null;\n\n  /** Mouse over event data. */\n  private mouseOverHandler: browserEvents.Data | null = null;\n\n  /** Click event data. */\n  private clickHandler: browserEvents.Data | null = null;\n\n  /** Mouse enter event data. */\n  private mouseEnterHandler: browserEvents.Data | null = null;\n\n  /** Mouse leave event data. */\n  private mouseLeaveHandler: browserEvents.Data | null = null;\n\n  /** Key down event data. */\n  private onKeyDownHandler: browserEvents.Data | null = null;\n\n  /** The menu's root DOM element. */\n  private element: HTMLDivElement | null = null;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role | null = null;\n\n  /** Constructs a new Menu instance. */\n  constructor() {}\n\n  /**\n   * Add a new menu item to the bottom of this menu.\n   *\n   * @param menuItem Menu item to append.\n   * @internal\n   */\n  addChild(menuItem: MenuItem) {\n    this.menuItems.push(menuItem);\n  }\n\n  /**\n   * Creates the menu DOM.\n   *\n   * @param container Element upon which to append this menu.\n   * @returns The menu's root DOM element.\n   */\n  render(container: Element): HTMLDivElement {\n    const element = document.createElement('div');\n    // goog-menu is deprecated, use blocklyMenu.  May 2020.\n    element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\n    element.tabIndex = 0;\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    this.element = element;\n\n    // Add menu items.\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n      element.appendChild(menuItem.createDom());\n    }\n\n    // Add event handlers.\n    this.mouseOverHandler = browserEvents.conditionalBind(\n      element,\n      'pointerover',\n      this,\n      this.handleMouseOver,\n      true,\n    );\n    this.clickHandler = browserEvents.conditionalBind(\n      element,\n      'pointerup',\n      this,\n      this.handleClick,\n      true,\n    );\n    this.mouseEnterHandler = browserEvents.conditionalBind(\n      element,\n      'pointerenter',\n      this,\n      this.handleMouseEnter,\n      true,\n    );\n    this.mouseLeaveHandler = browserEvents.conditionalBind(\n      element,\n      'pointerleave',\n      this,\n      this.handleMouseLeave,\n      true,\n    );\n    this.onKeyDownHandler = browserEvents.conditionalBind(\n      element,\n      'keydown',\n      this,\n      this.handleKeyEvent,\n    );\n\n    container.appendChild(element);\n    return element;\n  }\n\n  /**\n   * Gets the menu's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): HTMLDivElement | null {\n    return this.element;\n  }\n\n  /**\n   * Focus the menu element.\n   *\n   * @internal\n   */\n  focus() {\n    const el = this.getElement();\n    if (el) {\n      el.focus({preventScroll: true});\n      dom.addClass(el, 'blocklyFocused');\n    }\n  }\n\n  /** Blur the menu element. */\n  private blur() {\n    const el = this.getElement();\n    if (el) {\n      el.blur();\n      dom.removeClass(el, 'blocklyFocused');\n    }\n  }\n\n  /**\n   * Set the menu accessibility role.\n   *\n   * @param roleName role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /** Dispose of this menu. */\n  dispose() {\n    // Remove event handlers.\n    if (this.mouseOverHandler) {\n      browserEvents.unbind(this.mouseOverHandler);\n      this.mouseOverHandler = null;\n    }\n    if (this.clickHandler) {\n      browserEvents.unbind(this.clickHandler);\n      this.clickHandler = null;\n    }\n    if (this.mouseEnterHandler) {\n      browserEvents.unbind(this.mouseEnterHandler);\n      this.mouseEnterHandler = null;\n    }\n    if (this.mouseLeaveHandler) {\n      browserEvents.unbind(this.mouseLeaveHandler);\n      this.mouseLeaveHandler = null;\n    }\n    if (this.onKeyDownHandler) {\n      browserEvents.unbind(this.onKeyDownHandler);\n      this.onKeyDownHandler = null;\n    }\n\n    // Remove menu items.\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n      menuItem.dispose();\n    }\n    this.element = null;\n  }\n\n  // Child component management.\n\n  /**\n   * Returns the child menu item that owns the given DOM element,\n   * or null if no such menu item is found.\n   *\n   * @param elem DOM element whose owner is to be returned.\n   * @returns Menu item for which the DOM element belongs to.\n   */\n  private getMenuItem(elem: Element): MenuItem | null {\n    const menuElem = this.getElement();\n    // Node might be the menu border (resulting in no associated menu item), or\n    // a menu item's div, or some element within the menu item.\n    // Walk up parents until one meets either the menu's root element, or\n    // a menu item's div.\n    let currentElement: Element | null = elem;\n    while (currentElement && currentElement !== menuElem) {\n      if (currentElement.classList.contains('blocklyMenuItem')) {\n        // Having found a menu item's div, locate that menu item in this menu.\n        for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n          if (menuItem.getElement() === currentElement) {\n            return menuItem;\n          }\n        }\n      }\n      currentElement = currentElement.parentElement;\n    }\n    return null;\n  }\n\n  // Highlight management.\n\n  /**\n   * Highlights the given menu item, or clears highlighting if null.\n   *\n   * @param item Item to highlight, or null.\n   * @internal\n   */\n  setHighlighted(item: MenuItem | null) {\n    const currentHighlighted = this.highlightedItem;\n    if (currentHighlighted) {\n      currentHighlighted.setHighlighted(false);\n      this.highlightedItem = null;\n    }\n    if (item) {\n      item.setHighlighted(true);\n      this.highlightedItem = item;\n      // Bring the highlighted item into view. This has no effect if the menu is\n      // not scrollable.\n      const el = this.getElement() as Element;\n      style.scrollIntoContainerView(item.getElement() as Element, el);\n\n      aria.setState(el, aria.State.ACTIVEDESCENDANT, item.getId());\n    }\n  }\n\n  /**\n   * Highlights the next highlightable item (or the first if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightNext() {\n    const index = this.highlightedItem\n      ? this.menuItems.indexOf(this.highlightedItem)\n      : -1;\n    this.highlightHelper(index, 1);\n  }\n\n  /**\n   * Highlights the previous highlightable item (or the last if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightPrevious() {\n    const index = this.highlightedItem\n      ? this.menuItems.indexOf(this.highlightedItem)\n      : -1;\n    this.highlightHelper(index < 0 ? this.menuItems.length : index, -1);\n  }\n\n  /** Highlights the first highlightable item. */\n  private highlightFirst() {\n    this.highlightHelper(-1, 1);\n  }\n\n  /** Highlights the last highlightable item. */\n  private highlightLast() {\n    this.highlightHelper(this.menuItems.length, -1);\n  }\n\n  /**\n   * Helper function that manages the details of moving the highlight among\n   * child menuitems in response to keyboard events.\n   *\n   * @param startIndex Start index.\n   * @param delta Step direction: 1 to go down, -1 to go up.\n   */\n  private highlightHelper(startIndex: number, delta: number) {\n    let index = startIndex + delta;\n    let menuItem;\n    while ((menuItem = this.menuItems[index])) {\n      if (menuItem.isEnabled()) {\n        this.setHighlighted(menuItem);\n        break;\n      }\n      index += delta;\n    }\n  }\n\n  // Mouse events.\n\n  /**\n   * Handles mouseover events. Highlight menuitems as the user hovers over them.\n   *\n   * @param e Mouse event to handle.\n   */\n  private handleMouseOver(e: PointerEvent) {\n    const menuItem = this.getMenuItem(e.target as Element);\n\n    if (menuItem) {\n      if (menuItem.isEnabled()) {\n        if (this.highlightedItem !== menuItem) {\n          this.setHighlighted(menuItem);\n        }\n      } else {\n        this.setHighlighted(null);\n      }\n    }\n  }\n\n  /**\n   * Handles click events. Pass the event onto the child menuitem to handle.\n   *\n   * @param e Click event to handle.\n   */\n  private handleClick(e: PointerEvent) {\n    const oldCoords = this.openingCoords;\n    // Clear out the saved opening coords immediately so they're not used twice.\n    this.openingCoords = null;\n    if (oldCoords && typeof e.clientX === 'number') {\n      const newCoords = new Coordinate(e.clientX, e.clientY);\n      if (Coordinate.distance(oldCoords, newCoords) < 1) {\n        // This menu was opened by a mousedown and we're handling the consequent\n        // click event. The coords haven't changed, meaning this was the same\n        // opening event. Don't do the usual behavior because the menu just\n        // popped up under the mouse and the user didn't mean to activate this\n        // item.\n        return;\n      }\n    }\n\n    const menuItem = this.getMenuItem(e.target as Element);\n    if (menuItem) {\n      menuItem.performAction();\n    }\n  }\n\n  /**\n   * Handles mouse enter events. Focus the element.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseEnter(_e: PointerEvent) {\n    this.focus();\n  }\n\n  /**\n   * Handles mouse leave events. Blur and clear highlight.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseLeave(_e: PointerEvent) {\n    if (this.getElement()) {\n      this.blur();\n      this.setHighlighted(null);\n    }\n  }\n\n  // Keyboard events.\n\n  /**\n   * Attempts to handle a keyboard event, if the menu item is enabled, by\n   * calling\n   * {@link Menu#handleKeyEventInternal_}.\n   *\n   * @param e Key event to handle.\n   */\n  private handleKeyEvent(e: Event) {\n    if (!this.menuItems.length) {\n      // Empty menu.\n      return;\n    }\n    const keyboardEvent = e as KeyboardEvent;\n    if (\n      keyboardEvent.shiftKey ||\n      keyboardEvent.ctrlKey ||\n      keyboardEvent.metaKey ||\n      keyboardEvent.altKey\n    ) {\n      // Do not handle the key event if any modifier key is pressed.\n      return;\n    }\n\n    const highlighted = this.highlightedItem;\n    switch (keyboardEvent.key) {\n      case 'Enter':\n      case ' ':\n        if (highlighted) {\n          highlighted.performAction();\n        }\n        break;\n\n      case 'ArrowUp':\n        this.highlightPrevious();\n        break;\n\n      case 'ArrowDown':\n        this.highlightNext();\n        break;\n\n      case 'PageUp':\n      case 'Home':\n        this.highlightFirst();\n        break;\n\n      case 'PageDown':\n      case 'End':\n        this.highlightLast();\n        break;\n\n      default:\n        // Not a key the menu is interested in.\n        return;\n    }\n    // The menu used this key, don't let it have secondary effects.\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Get the size of a rendered menu.\n   *\n   * @returns Object with width and height properties.\n   * @internal\n   */\n  getSize(): Size {\n    const menuDom = this.getElement() as HTMLDivElement;\n    const menuSize = style.getSize(menuDom);\n    // Recalculate height for the total content, not only box height.\n    menuSize.height = menuDom.scrollHeight;\n    return menuSize;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu item similar to Closure's goog.ui.MenuItem\n *\n * @class\n */\n// Former goog.module ID: Blockly.MenuItem\n\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\n\n/**\n * Class representing an item in a menu.\n */\nexport class MenuItem {\n  /** Is the menu item clickable, as opposed to greyed-out. */\n  private enabled = true;\n\n  /** The DOM element for the menu item. */\n  private element: HTMLDivElement | null = null;\n\n  /** Whether the menu item is rendered right-to-left. */\n  private rightToLeft = false;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role | null = null;\n\n  /** Is this menu item checkable. */\n  private checkable = false;\n\n  /** Is this menu item currently checked. */\n  private checked = false;\n\n  /** Is this menu item currently highlighted. */\n  private highlight = false;\n\n  /** Bound function to call when this menu item is clicked. */\n  private actionHandler: Function | null = null;\n\n  /**\n   * @param content Text caption to display as the content of the item, or a\n   *     HTML element to display.\n   * @param opt_value Data/model associated with the menu item.\n   */\n  constructor(\n    private readonly content: string | HTMLElement,\n    private readonly opt_value?: string,\n  ) {}\n\n  /**\n   * Creates the menuitem's DOM.\n   *\n   * @returns Completed DOM.\n   */\n  createDom(): Element {\n    const element = document.createElement('div');\n    element.id = idGenerator.getNextUniqueId();\n    this.element = element;\n\n    // Set class and style\n    // goog-menuitem* is deprecated, use blocklyMenuItem*.  May 2020.\n    element.className =\n      'blocklyMenuItem goog-menuitem ' +\n      (this.enabled ? '' : 'blocklyMenuItemDisabled goog-menuitem-disabled ') +\n      (this.checked ? 'blocklyMenuItemSelected goog-option-selected ' : '') +\n      (this.highlight\n        ? 'blocklyMenuItemHighlight goog-menuitem-highlight '\n        : '') +\n      (this.rightToLeft ? 'blocklyMenuItemRtl goog-menuitem-rtl ' : '');\n\n    const content = document.createElement('div');\n    content.className = 'blocklyMenuItemContent goog-menuitem-content';\n    // Add a checkbox for checkable menu items.\n    if (this.checkable) {\n      const checkbox = document.createElement('div');\n      checkbox.className = 'blocklyMenuItemCheckbox goog-menuitem-checkbox';\n      content.appendChild(checkbox);\n    }\n\n    let contentDom: Node = this.content as HTMLElement;\n    if (typeof this.content === 'string') {\n      contentDom = document.createTextNode(this.content);\n    }\n    content.appendChild(contentDom);\n    element.appendChild(content);\n\n    // Initialize ARIA role and state.\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    aria.setState(\n      element,\n      aria.State.SELECTED,\n      (this.checkable && this.checked) || false,\n    );\n    aria.setState(element, aria.State.DISABLED, !this.enabled);\n\n    return element;\n  }\n\n  /** Dispose of this menu item. */\n  dispose() {\n    this.element = null;\n  }\n\n  /**\n   * Gets the menu item's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): Element | null {\n    return this.element;\n  }\n\n  /**\n   * Gets the unique ID for this menu item.\n   *\n   * @returns Unique component ID.\n   * @internal\n   */\n  getId(): string {\n    return this.element!.id;\n  }\n\n  /**\n   * Gets the value associated with the menu item.\n   *\n   * @returns value Value associated with the menu item.\n   * @internal\n   */\n  getValue(): string | null {\n    return this.opt_value ?? null;\n  }\n\n  /**\n   * Set menu item's rendering direction.\n   *\n   * @param rtl True if RTL, false if LTR.\n   * @internal\n   */\n  setRightToLeft(rtl: boolean) {\n    this.rightToLeft = rtl;\n  }\n\n  /**\n   * Set the menu item's accessibility role.\n   *\n   * @param roleName Role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /**\n   * Sets the menu item to be checkable or not. Set to true for menu items\n   * that represent checkable options.\n   *\n   * @param checkable Whether the menu item is checkable.\n   * @internal\n   */\n  setCheckable(checkable: boolean) {\n    this.checkable = checkable;\n  }\n\n  /**\n   * Checks or unchecks the component.\n   *\n   * @param checked Whether to check or uncheck the component.\n   * @internal\n   */\n  setChecked(checked: boolean) {\n    this.checked = checked;\n  }\n\n  /**\n   * Highlights or unhighlights the component.\n   *\n   * @param highlight Whether to highlight or unhighlight the component.\n   * @internal\n   */\n  setHighlighted(highlight: boolean) {\n    this.highlight = highlight;\n\n    const el = this.getElement();\n    if (el && this.isEnabled()) {\n      // goog-menuitem-highlight is deprecated, use blocklyMenuItemHighlight.\n      // May 2020.\n      const name = 'blocklyMenuItemHighlight';\n      const nameDep = 'goog-menuitem-highlight';\n      if (highlight) {\n        dom.addClass(el, name);\n        dom.addClass(el, nameDep);\n      } else {\n        dom.removeClass(el, name);\n        dom.removeClass(el, nameDep);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the menu item is enabled, false otherwise.\n   *\n   * @returns Whether the menu item is enabled.\n   * @internal\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Enables or disables the menu item.\n   *\n   * @param enabled Whether to enable or disable the menu item.\n   * @internal\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Performs the appropriate action when the menu item is activated\n   * by the user.\n   *\n   * @internal\n   */\n  performAction() {\n    if (this.isEnabled() && this.actionHandler) {\n      this.actionHandler(this);\n    }\n  }\n\n  /**\n   * Set the handler that's called when the menu item is activated by the user.\n   * `obj` will be used as the 'this' object in the function when called.\n   *\n   * @param fn The handler.\n   * @param obj Used as the 'this' object in fn when called.\n   * @internal\n   */\n  onAction(fn: (p1: MenuItem) => void, obj: object) {\n    this.actionHandler = fn.bind(obj);\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.exceptions\n\nimport type {Block} from '../block.js';\nimport type {State} from './blocks.js';\n\nexport class DeserializationError extends Error {}\n\n/**\n * Represents an error where the serialized state is expected to provide a\n * block type, but it is not provided.\n *\n */\nexport class MissingBlockType extends DeserializationError {\n  /**\n   * @param state The state object which is missing the block type.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Expected to find a 'type' property, defining the block type`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a block that did\n * not have a connection that was defined in the serialized state.\n */\nexport class MissingConnection extends DeserializationError {\n  /**\n   * @param connection The name of the connection that is missing. E.g.\n   *     'IF0', or 'next'.\n   * @param block The block missing the connection.\n   * @param state The state object containing the bad connection.\n   * @internal\n   */\n  constructor(\n    connection: string,\n    public block: Block,\n    public state: State,\n  ) {\n    super(`The block ${block.toDevString()} is missing a(n) ${connection}\nconnection`);\n  }\n}\n\n/**\n * Represents an error where deserialization tried to connect two connections\n * that were not compatible.\n */\nexport class BadConnectionCheck extends DeserializationError {\n  /**\n   * @param reason The reason the connections were not compatible.\n   * @param childConnection The name of the incompatible child connection. E.g.\n   *     'output' or 'previous'.\n   * @param childBlock The child block that could not connect to its parent.\n   * @param childState The state object representing the child block.\n   * @internal\n   */\n  constructor(\n    reason: string,\n    childConnection: string,\n    public childBlock: Block,\n    public childState: State,\n  ) {\n    super(`The block ${childBlock.toDevString()} could not connect its\n${childConnection} to its parent, because: ${reason}`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a real block as it\n * was deserializing children of a shadow.\n * This is an error because it is an invariant of Blockly that shadow blocks\n * do not have real children.\n */\nexport class RealChildOfShadow extends DeserializationError {\n  /**\n   * @param state The state object representing the real block.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren`);\n  }\n}\n\nexport class UnregisteredIcon extends DeserializationError {\n  /**\n   * @param iconType The type of the unregistered icon we are attempting to\n   *     deserialize.\n   * @param block The block we are attempting to add the unregistered icon to.\n   * @param state The state object representing the block.\n   */\n  constructor(\n    iconType: string,\n    public block: Block,\n    public state: State,\n  ) {\n    super(\n      `Cannot add an icon of type '${iconType}' to the block ` +\n        `${block.toDevString()}, because there is no icon registered with ` +\n        `type '${iconType}'. Make sure that all of your icons have been ` +\n        `registered.`,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for all types of block events.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockBase\n\nimport type {Block} from '../block.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\n\n/**\n * Abstract class for any event related to blocks.\n */\nexport class BlockBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the block associated with this event. */\n  blockId?: string;\n\n  /**\n   * @param opt_block The block this event corresponds to.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_block?: Block) {\n    super();\n    this.isBlank = !opt_block;\n\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.workspaceId = opt_block.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockBaseJson {\n    const json = super.toJson() as BlockBaseJson;\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockBase(),\n    ) as BlockBase;\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport interface BlockBaseJson extends AbstractEventJson {\n  blockId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block change event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockChange\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {IconType} from '../icons/icon_types.js';\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\nimport {MANUALLY_DISABLED} from '../constants.js';\nimport * as registry from '../registry.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when some element of a block has changed (e.g.\n * field values, comments, etc).\n */\nexport class BlockChange extends BlockBase {\n  override type = eventUtils.BLOCK_CHANGE;\n  /**\n   * The element that changed; one of 'field', 'comment', 'collapsed',\n   * 'disabled', 'inline', or 'mutation'\n   */\n  element?: string;\n\n  /** The name of the field that changed, if this is a change to a field. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * If element is 'disabled', this is the language-neutral identifier of the\n   * reason why the block was or was not disabled.\n   */\n  private disabledReason?: string;\n\n  /**\n   * @param opt_block The changed block.  Undefined for a blank event.\n   * @param opt_element One of 'field', 'comment', 'disabled', etc.\n   * @param opt_name Name of input or field affected, or null.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n    opt_block?: Block,\n    opt_element?: string,\n    opt_name?: string | null,\n    opt_oldValue?: unknown,\n    opt_newValue?: unknown,\n  ) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.element = opt_element;\n    this.name = opt_name || undefined;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockChangeJson {\n    const json = super.toJson() as BlockChangeJson;\n    if (!this.element) {\n      throw new Error(\n        'The changed element is undefined. Either pass an ' +\n          'element to the constructor, or call fromJson',\n      );\n    }\n    json['element'] = this.element;\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    if (this.disabledReason) {\n      json['disabledReason'] = this.disabledReason;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockChange(),\n    ) as BlockChange;\n    newEvent.element = json['element'];\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    if (json['disabledReason'] !== undefined) {\n      newEvent.disabledReason = json['disabledReason'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Set the language-neutral identifier for the reason why the block was or was\n   * not disabled. This is only valid for events where element is 'disabled'.\n   * Defaults to 'MANUALLY_DISABLED'.\n   *\n   * @param disabledReason The identifier of the reason why the block was or was\n   *     not disabled.\n   */\n  setDisabledReason(disabledReason: string) {\n    if (this.element !== 'disabled') {\n      throw new Error(\n        'Cannot set the disabled reason for a BlockChange event if the ' +\n          'element is not \"disabled\".',\n      );\n    }\n    this.disabledReason = disabledReason;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson',\n      );\n    }\n    // Assume the block is rendered so that then we can check.\n    const icon = block.getIcon(IconType.MUTATOR);\n    if (icon && hasBubble(icon) && icon.bubbleIsVisible()) {\n      // Close the mutator (if open) since we don't want to update it.\n      icon.setBubbleVisible(false);\n    }\n    const value = forward ? this.newValue : this.oldValue;\n    switch (this.element) {\n      case 'field': {\n        const field = block.getField(this.name!);\n        if (field) {\n          field.setValue(value);\n        } else {\n          console.warn(\"Can't set non-existent field: \" + this.name);\n        }\n        break;\n      }\n      case 'comment':\n        block.setCommentText((value as string) || null);\n        break;\n      case 'collapsed':\n        block.setCollapsed(!!value);\n        break;\n      case 'disabled':\n        block.setDisabledReason(\n          !!value,\n          this.disabledReason ?? MANUALLY_DISABLED,\n        );\n        break;\n      case 'inline':\n        block.setInputsInline(!!value);\n        break;\n      case 'mutation': {\n        const oldState = BlockChange.getExtraBlockState_(block as BlockSvg);\n        if (block.loadExtraState) {\n          block.loadExtraState(JSON.parse((value as string) || '{}'));\n        } else if (block.domToMutation) {\n          block.domToMutation(\n            utilsXml.textToDom((value as string) || '<mutation/>'),\n          );\n        }\n        eventUtils.fire(\n          new BlockChange(block, 'mutation', null, oldState, value),\n        );\n        break;\n      }\n      default:\n        console.warn('Unknown change type: ' + this.element);\n    }\n  }\n\n  // TODO (#5397): Encapsulate this in the BlocklyMutationChange event when\n  //    refactoring change events.\n  /**\n   * Returns the extra state of the given block (either as XML or a JSO,\n   * depending on the block's definition).\n   *\n   * @param block The block to get the extra state of.\n   * @returns A stringified version of the extra state of the given block.\n   * @internal\n   */\n  static getExtraBlockState_(block: BlockSvg): string {\n    if (block.saveExtraState) {\n      const state = block.saveExtraState(true);\n      return state ? JSON.stringify(state) : '';\n    } else if (block.mutationToDom) {\n      const state = block.mutationToDom();\n      return state ? Xml.domToText(state) : '';\n    }\n    return '';\n  }\n}\n\nexport interface BlockChangeJson extends BlockBaseJson {\n  element: string;\n  name?: string;\n  newValue: unknown;\n  oldValue: unknown;\n  disabledReason?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CHANGE, BlockChange);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of managing markers and the cursor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.MarkerManager\n\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class to manage the multiple markers and the cursor on a workspace.\n */\nexport class MarkerManager {\n  /** The name of the local marker. */\n  static readonly LOCAL_MARKER = 'local_marker_1';\n\n  /** The cursor. */\n  private cursor_: Cursor | null = null;\n\n  /** The cursor's SVG element. */\n  private cursorSvg_: SVGElement | null = null;\n\n  /** The map of markers for the workspace. */\n  private markers = new Map<string, Marker>();\n\n  /** The marker's SVG element. */\n  private markerSvg_: SVGElement | null = null;\n\n  /**\n   * @param workspace The workspace for the marker manager.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Register the marker by adding it to the map of markers.\n   *\n   * @param id A unique identifier for the marker.\n   * @param marker The marker to register.\n   */\n  registerMarker(id: string, marker: Marker) {\n    if (this.markers.has(id)) {\n      this.unregisterMarker(id);\n    }\n    marker.setDrawer(\n      this.workspace.getRenderer().makeMarkerDrawer(this.workspace, marker),\n    );\n    this.setMarkerSvg(marker.getDrawer().createDom());\n    this.markers.set(id, marker);\n  }\n\n  /**\n   * Unregister the marker by removing it from the map of markers.\n   *\n   * @param id The ID of the marker to unregister.\n   */\n  unregisterMarker(id: string) {\n    const marker = this.markers.get(id);\n    if (marker) {\n      marker.dispose();\n      this.markers.delete(id);\n    } else {\n      throw Error(\n        'Marker with ID ' +\n          id +\n          ' does not exist. ' +\n          'Can only unregister markers that exist.',\n      );\n    }\n  }\n\n  /**\n   * Get the cursor for the workspace.\n   *\n   * @returns The cursor for this workspace.\n   */\n  getCursor(): Cursor | null {\n    return this.cursor_;\n  }\n\n  /**\n   * Get a single marker that corresponds to the given ID.\n   *\n   * @param id A unique identifier for the marker.\n   * @returns The marker that corresponds to the given ID, or null if none\n   *     exists.\n   */\n  getMarker(id: string): Marker | null {\n    return this.markers.get(id) || null;\n  }\n\n  /**\n   * Sets the cursor and initializes the drawer for use with keyboard\n   * navigation.\n   *\n   * @param cursor The cursor used to move around this workspace.\n   */\n  setCursor(cursor: Cursor) {\n    if (this.cursor_ && this.cursor_.getDrawer()) {\n      this.cursor_.getDrawer().dispose();\n    }\n    this.cursor_ = cursor;\n    if (this.cursor_) {\n      const drawer = this.workspace\n        .getRenderer()\n        .makeMarkerDrawer(this.workspace, this.cursor_);\n      this.cursor_.setDrawer(drawer);\n      this.setCursorSvg(this.cursor_.getDrawer().createDom());\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this workspace SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement | null) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    this.workspace.getBlockCanvas()!.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement | null) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (this.workspace.getBlockCanvas()) {\n      if (this.cursorSvg_) {\n        this.workspace\n          .getBlockCanvas()!\n          .insertBefore(markerSvg, this.cursorSvg_);\n      } else {\n        this.workspace.getBlockCanvas()!.appendChild(markerSvg);\n      }\n    }\n  }\n\n  /**\n   * Redraw the attached cursor SVG if needed.\n   *\n   * @internal\n   */\n  updateMarkers() {\n    if (this.workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      this.workspace.getCursor()!.draw();\n    }\n  }\n\n  /**\n   * Dispose of the marker manager.\n   * Go through and delete all markers associated with this marker manager.\n   *\n   * @internal\n   */\n  dispose() {\n    const markerIds = Object.keys(this.markers);\n    for (let i = 0, markerId; (markerId = markerIds[i]); i++) {\n      this.unregisterMarker(markerId);\n    }\n    this.markers.clear();\n    if (this.cursor_) {\n      this.cursor_.dispose();\n      this.cursor_ = null;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Field.  Used for editable titles, variables, etc.\n * This is an abstract class that defines the UI on the block.  Actual\n * instances would be FieldTextInput, FieldDropdown, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Field\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport type {IRegistrable} from './interfaces/i_registrable.js';\nimport {MarkerManager} from './marker_manager.js';\nimport type {ConstantProvider} from './renderers/common/constants.js';\nimport type {KeyboardShortcut} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {ISerializable} from './interfaces/i_serializable.js';\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldValidator<T = any> = (newValue: T) => T | null | undefined;\n\n/**\n * Abstract class for an editable field.\n *\n * @typeParam T - The value stored on the field.\n */\nexport abstract class Field<T = any>\n  implements\n    IASTNodeLocationSvg,\n    IASTNodeLocationWithBlock,\n    IKeyboardAccessible,\n    IRegistrable,\n    ISerializable\n{\n  /**\n   * To overwrite the default value which is set in **Field**, directly update\n   * the prototype.\n   *\n   * Example:\n   * `FieldImage.prototype.DEFAULT_VALUE = null;`\n   */\n  DEFAULT_VALUE: T | null = null;\n\n  /** Non-breaking space. */\n  static readonly NBSP = '\\u00A0';\n\n  /**\n   * A value used to signal when a field's constructor should *not* set the\n   * field's value or run configure_, and should allow a subclass to do that\n   * instead.\n   */\n  static readonly SKIP_SETUP = Symbol('SKIP_SETUP');\n\n  /**\n   * Name of field.  Unique within each block.\n   * Static labels are usually unnamed.\n   */\n  name?: string = undefined;\n  protected value_: T | null;\n\n  /** Validation function called when user edits an editable field. */\n  protected validator_: FieldValidator<T> | null = null;\n\n  /**\n   * Used to cache the field's tooltip value if setTooltip is called when the\n   * field is not yet initialized. Is *not* guaranteed to be accurate.\n   */\n  private tooltip_: Tooltip.TipInfo | null = null;\n  protected size_: Size;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the field.\n   * This is null if there is no cursor on the field.\n   */\n  private cursorSvg_: SVGElement | null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the field.\n   * This is null if there is no marker on the field.\n   */\n  private markerSvg_: SVGElement | null = null;\n\n  /** The rendered field's SVG group element. */\n  protected fieldGroup_: SVGGElement | null = null;\n\n  /** The rendered field's SVG border element. */\n  protected borderRect_: SVGRectElement | null = null;\n\n  /** The rendered field's SVG text element. */\n  protected textElement_: SVGTextElement | null = null;\n\n  /** The rendered field's text content element. */\n  protected textContent_: Text | null = null;\n\n  /** Mouse down event listener data. */\n  private mouseDownWrapper_: browserEvents.Data | null = null;\n\n  /** Constants associated with the source block's renderer. */\n  protected constants_: ConstantProvider | null = null;\n\n  /**\n   * Has this field been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** Maximum characters of text to display before adding an ellipsis. */\n  maxDisplayLength = 50;\n\n  /** Block this field is attached to.  Starts as null, then set in init. */\n  protected sourceBlock_: Block | null = null;\n\n  /** Does this block need to be re-rendered? */\n  protected isDirty_ = true;\n\n  /** Is the field visible, or hidden due to the block being collapsed? */\n  protected visible_ = true;\n\n  /**\n   * Can the field value be changed using the editor on an editable block?\n   */\n  protected enabled_ = true;\n\n  /** The element the click handler is bound to. */\n  protected clickTarget_: Element | null = null;\n\n  /**\n   * The prefix field.\n   *\n   * @internal\n   */\n  prefixField: string | null = null;\n\n  /**\n   * The suffix field.\n   *\n   * @internal\n   */\n  suffixField: string | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. They will also be saved by the serializer.\n   */\n  EDITABLE = true;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable. This is not the\n   * case by default so that SERIALIZABLE is backwards compatible.\n   */\n  SERIALIZABLE = false;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  CURSOR = '';\n\n  /**\n   * @param value The initial value of the field.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value & returns a validated value, or null to\n   *     abort the change.\n   * @param config A map of options used to configure the field.\n   *    Refer to the individual field's documentation for a list of properties\n   * this parameter supports.\n   */\n  constructor(\n    value: T | typeof Field.SKIP_SETUP,\n    validator?: FieldValidator<T> | null,\n    config?: FieldConfig,\n  ) {\n    /**\n     * A generic value possessed by the field.\n     * Should generally be non-null, only null when the field is created.\n     */\n    this.value_ =\n      'DEFAULT_VALUE' in new.target.prototype\n        ? new.target.prototype.DEFAULT_VALUE\n        : this.DEFAULT_VALUE;\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Process the configuration map passed to the field.\n   *\n   * @param config A map of options used to configure the field. See the\n   *     individual field's documentation for a list of properties this\n   *     parameter supports.\n   */\n  protected configure_(config: FieldConfig) {\n    // TODO (#2884): Possibly add CSS class config option.\n    // TODO (#2885): Possibly add cursor config option.\n    if (config.tooltip) {\n      this.setTooltip(parsing.replaceMessageReferences(config.tooltip));\n    }\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  setSourceBlock(block: Block) {\n    if (this.sourceBlock_) {\n      throw Error('Field already bound to a block');\n    }\n    this.sourceBlock_ = block;\n  }\n\n  /**\n   * Get the renderer constant provider.\n   *\n   * @returns The renderer constant provider.\n   */\n  getConstants(): ConstantProvider | null {\n    if (\n      !this.constants_ &&\n      this.sourceBlock_ &&\n      !this.sourceBlock_.isDeadOrDying() &&\n      this.sourceBlock_.workspace.rendered\n    ) {\n      this.constants_ = (this.sourceBlock_.workspace as WorkspaceSvg)\n        .getRenderer()\n        .getConstants();\n    }\n    return this.constants_;\n  }\n\n  /**\n   * Get the block this field is attached to.\n   *\n   * @returns The block containing this field.\n   * @throws An error if the source block is not defined.\n   */\n  getSourceBlock(): Block | null {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Initialize everything to render this field. Override\n   * methods initModel and initView rather than this method.\n   *\n   * @sealed\n   * @internal\n   */\n  init() {\n    if (this.fieldGroup_) {\n      // Field has already been initialized once.\n      return;\n    }\n    this.fieldGroup_ = dom.createSvgElement(Svg.G, {});\n    if (!this.isVisible()) {\n      this.fieldGroup_.style.display = 'none';\n    }\n    const sourceBlockSvg = this.sourceBlock_ as BlockSvg;\n    sourceBlockSvg.getSvgRoot().appendChild(this.fieldGroup_);\n    this.initView();\n    this.updateEditable();\n    this.setTooltip(this.tooltip_);\n    this.bindEvents_();\n    this.initModel();\n    this.applyColour();\n  }\n\n  /**\n   * Create the block UI for this field.\n   */\n  protected initView() {\n    this.createBorderRect_();\n    this.createTextElement_();\n  }\n\n  /**\n   * Initializes the model of the field after it has been installed on a block.\n   * No-op by default.\n   */\n  initModel() {}\n\n  /**\n   * Defines whether this field should take up the full block or not.\n   *\n   * Be cautious when overriding this function. It may not work as you expect /\n   * intend because the behavior was kind of hacked in. If you are thinking\n   * about overriding this function, post on the forum with your intended\n   * behavior to see if there's another approach.\n   */\n  protected isFullBlockField(): boolean {\n    return !this.borderRect_;\n  }\n\n  /**\n   * Create a field border rect element. Not to be overridden by subclasses.\n   * Instead modify the result of the function inside initView, or create a\n   * separate function to call.\n   */\n  protected createBorderRect_() {\n    this.borderRect_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'rx': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n        'ry': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n        'x': 0,\n        'y': 0,\n        'height': this.size_.height,\n        'width': this.size_.width,\n        'class': 'blocklyFieldRect',\n      },\n      this.fieldGroup_,\n    );\n  }\n\n  /**\n   * Create a field text element. Not to be overridden by subclasses. Instead\n   * modify the result of the function inside initView, or create a separate\n   * function to call.\n   */\n  protected createTextElement_() {\n    this.textElement_ = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyText',\n      },\n      this.fieldGroup_,\n    );\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.textElement_.setAttribute('dominant-baseline', 'central');\n    }\n    this.textContent_ = document.createTextNode('');\n    this.textElement_.appendChild(this.textContent_);\n  }\n\n  /**\n   * Bind events to the field. Can be overridden by subclasses if they need to\n   * do custom input handling.\n   */\n  protected bindEvents_() {\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    Tooltip.bindMouseEvents(clickTarget);\n    this.mouseDownWrapper_ = browserEvents.conditionalBind(\n      clickTarget,\n      'pointerdown',\n      this,\n      this.onMouseDown_,\n    );\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  fromXml(fieldElement: Element) {\n    // Any because gremlins live here. No touchie!\n    this.setValue(fieldElement.textContent as any);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  toXml(fieldElement: Element): Element {\n    // Any because gremlins live here. No touchie!\n    fieldElement.textContent = this.getValue() as any;\n    return fieldElement;\n  }\n\n  /**\n   * Saves this fields value as something which can be serialized to JSON.\n   * Should only be called by the serialization system.\n   *\n   * @param _doFullSerialization If true, this signals to the field that if it\n   *     normally just saves a reference to some state (eg variable fields) it\n   *     should instead serialize the full state of the thing being referenced.\n   *     See the\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#full_serialization_and_backing_data | field serialization docs}\n   *     for more information.\n   * @returns JSON serializable state.\n   * @internal\n   */\n  saveState(_doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(Field);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's state based on the given state value. Should only be\n   * called by the serialization system.\n   *\n   * @param state The state we want to apply to the field.\n   * @internal\n   */\n  loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Returns a stringified version of the XML state, if it should be used.\n   * Otherwise this returns null, to signal the field should use its own\n   * serialization.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @returns The stringified version of the XML state, or null.\n   */\n  protected saveLegacyState(callingClass: FieldProto): string | null {\n    if (\n      callingClass.prototype.saveState === this.saveState &&\n      callingClass.prototype.toXml !== this.toXml\n    ) {\n      const elem = utilsXml.createElement('field');\n      elem.setAttribute('name', this.name || '');\n      const text = utilsXml.domToText(this.toXml(elem));\n      return text.replace(\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\n        '',\n      );\n    }\n    // Either they called this on purpose from their saveState, or they have\n    // no implementations of either hook. Just do our thing.\n    return null;\n  }\n\n  /**\n   * Loads the given state using either the old XML hooks, if they should be\n   * used. Returns true to indicate loading has been handled, false otherwise.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @param state The state to apply to the field.\n   * @returns Whether the state was applied or not.\n   */\n  loadLegacyState(\n    callingClass: FieldProto,\n    state: AnyDuringMigration,\n  ): boolean {\n    if (\n      callingClass.prototype.loadState === this.loadState &&\n      callingClass.prototype.fromXml !== this.fromXml\n    ) {\n      this.fromXml(utilsXml.textToDom(state as string));\n      return true;\n    }\n    // Either they called this on purpose from their loadState, or they have\n    // no implementations of either hook. Just do our thing.\n    return false;\n  }\n\n  /**\n   * Dispose of all DOM objects and events belonging to this editable field.\n   *\n   * @internal\n   */\n  dispose() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hideIfOwner(this);\n\n    if (!this.getSourceBlock()?.isDeadOrDying()) {\n      dom.removeNode(this.fieldGroup_);\n    }\n\n    this.disposed = true;\n  }\n\n  /** Add or remove the UI indicating if this field is editable or not. */\n  updateEditable() {\n    const group = this.fieldGroup_;\n    const block = this.getSourceBlock();\n    if (!this.EDITABLE || !group || !block) {\n      return;\n    }\n    if (this.enabled_ && block.isEditable()) {\n      dom.addClass(group, 'blocklyEditableText');\n      dom.removeClass(group, 'blocklyNonEditableText');\n      group.style.cursor = this.CURSOR;\n    } else {\n      dom.addClass(group, 'blocklyNonEditableText');\n      dom.removeClass(group, 'blocklyEditableText');\n      group.style.cursor = '';\n    }\n  }\n\n  /**\n   * Set whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled_ = enabled;\n    this.updateEditable();\n  }\n\n  /**\n   * Check whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @returns Whether this field is enabled.\n   */\n  isEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Check whether this field defines the showEditor_ function.\n   *\n   * @returns Whether this field is clickable.\n   */\n  isClickable(): boolean {\n    return (\n      this.enabled_ &&\n      !!this.sourceBlock_ &&\n      this.sourceBlock_.isEditable() &&\n      this.showEditor_ !== Field.prototype.showEditor_\n    );\n  }\n\n  /**\n   * Check whether the field should be clickable while the block is in a flyout.\n   * The default is that fields are clickable in always-open flyouts such as the\n   * simple toolbox, but not in autoclosing flyouts such as the category toolbox.\n   * Subclasses may override this function to change this behavior. Note that\n   * `isClickable` must also return true for this to have any effect.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the field should be clickable while the block is in a flyout.\n   */\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\n    return !autoClosingFlyout;\n  }\n\n  /**\n   * Check whether this field is currently editable.  Some fields are never\n   * EDITABLE (e.g. text labels). Other fields may be EDITABLE but may exist on\n   * non-editable blocks or be currently disabled.\n   *\n   * @returns Whether this field is currently enabled, editable and on an\n   *     editable block.\n   */\n  isCurrentlyEditable(): boolean {\n    return (\n      this.enabled_ &&\n      this.EDITABLE &&\n      !!this.sourceBlock_ &&\n      this.sourceBlock_.isEditable()\n    );\n  }\n\n  /**\n   * Check whether this field should be serialized by the XML renderer.\n   * Handles the logic for backwards compatibility and incongruous states.\n   *\n   * @returns Whether this field should be serialized or not.\n   */\n  isSerializable(): boolean {\n    let isSerializable = false;\n    if (this.name) {\n      if (this.SERIALIZABLE) {\n        isSerializable = true;\n      } else if (this.EDITABLE) {\n        console.warn(\n          'Detected an editable field that was not serializable.' +\n            ' Please define SERIALIZABLE property as true on all editable custom' +\n            ' fields. Proceeding with serialization.',\n        );\n        isSerializable = true;\n      }\n    }\n    return isSerializable;\n  }\n\n  /**\n   * Gets whether this editable field is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible_;\n  }\n\n  /**\n   * Sets whether this editable field is visible or not. Should only be called\n   * by input.setVisible.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisible(visible: boolean) {\n    if (this.visible_ === visible) {\n      return;\n    }\n    this.visible_ = visible;\n    const root = this.fieldGroup_;\n    if (root) {\n      root.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Sets a new validation function for editable fields, or clears a previously\n   * set validator.\n   *\n   * The validator function takes in the new field value, and returns\n   * validated value. The validated value could be the input value, a modified\n   * version of the input value, or null to abort the change.\n   *\n   * If the function does not return anything (or returns undefined) the new\n   * value is accepted as valid. This is to allow for fields using the\n   * validated function as a field-level change event notification.\n   *\n   * @param handler The validator function or null to clear a previous\n   *     validator.\n   */\n  setValidator(handler: FieldValidator<T>) {\n    this.validator_ = handler;\n  }\n\n  /**\n   * Gets the validation function for editable fields, or null if not set.\n   *\n   * @returns Validation function, or null.\n   */\n  getValidator(): FieldValidator<T> | null {\n    return this.validator_;\n  }\n\n  /**\n   * Gets the group element for this editable field.\n   * Used for measuring the size and for positioning.\n   *\n   * @returns The group element.\n   */\n  getSvgRoot(): SVGGElement | null {\n    return this.fieldGroup_;\n  }\n\n  /**\n   * Gets the border rectangle element.\n   *\n   * @returns The border rectangle element.\n   * @throws An error if the border rectangle element is not defined.\n   */\n  protected getBorderRect(): SVGRectElement {\n    if (!this.borderRect_) {\n      throw new Error(`The border rectangle is ${this.borderRect_}.`);\n    }\n    return this.borderRect_;\n  }\n\n  /**\n   * Gets the text element.\n   *\n   * @returns The text element.\n   * @throws An error if the text element is not defined.\n   */\n  protected getTextElement(): SVGTextElement {\n    if (!this.textElement_) {\n      throw new Error(`The text element is ${this.textElement_}.`);\n    }\n    return this.textElement_;\n  }\n\n  /**\n   * Gets the text content.\n   *\n   * @returns The text content.\n   * @throws An error if the text content is not defined.\n   */\n  protected getTextContent(): Text {\n    if (!this.textContent_) {\n      throw new Error(`The text content is ${this.textContent_}.`);\n    }\n    return this.textContent_;\n  }\n\n  /**\n   * Updates the field to match the colour/style of the block.\n   *\n   * Non-abstract sub-classes may wish to implement this if the colour of the\n   * field depends on the colour of the block. It will automatically be called\n   * at relevant times, such as when the parent block or renderer changes.\n   *\n   * See {@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#matching_block_colours\n   * | the field documentation} for more information, or FieldDropdown for an\n   * example.\n   */\n  applyColour() {}\n\n  /**\n   * Used by getSize() to move/resize any DOM elements, and get the new size.\n   *\n   * All rendering that has an effect on the size/shape of the block should be\n   * done here, and should be triggered by getSize().\n   */\n  protected render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_();\n  }\n\n  /**\n   * Calls showEditor_ when the field is clicked if the field is clickable.\n   * Do not override.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @sealed\n   * @internal\n   */\n  showEditor(e?: Event) {\n    if (this.isClickable()) {\n      this.showEditor_(e);\n    }\n  }\n\n  /**\n   * A developer hook to create an editor for the field. This is no-op by\n   * default, and must be overriden to create an editor.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected showEditor_(_e?: Event): void {}\n  // NOP\n\n  /**\n   * A developer hook to reposition the WidgetDiv during a window resize. You\n   * need to define this hook if your field has a WidgetDiv that needs to\n   * reposition itself when the window is resized. For example, text input\n   * fields define this hook so that the input WidgetDiv can reposition itself\n   * on a window resize event. This is especially important when modal inputs\n   * have been disabled, as Android devices will fire a window resize event when\n   * the soft keyboard opens.\n   *\n   * If you want the WidgetDiv to hide itself instead of repositioning, return\n   * false. This is the default behavior.\n   *\n   * DropdownDivs already handle their own positioning logic, so you do not need\n   * to override this function if your field only has a DropdownDiv.\n   *\n   * @returns True if the field should be repositioned,\n   *    false if the WidgetDiv should hide itself instead.\n   */\n  repositionForWindowResize(): boolean {\n    return false;\n  }\n\n  /**\n   * Updates the size of the field based on the text.\n   *\n   * @param margin margin to use when positioning the text element.\n   */\n  protected updateSize_(margin?: number) {\n    const constants = this.getConstants();\n    const xOffset =\n      margin !== undefined\n        ? margin\n        : !this.isFullBlockField()\n          ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n          : 0;\n    let totalWidth = xOffset * 2;\n    let totalHeight = constants!.FIELD_TEXT_HEIGHT;\n\n    let contentWidth = 0;\n    if (this.textElement_) {\n      contentWidth = dom.getFastTextWidth(\n        this.textElement_,\n        constants!.FIELD_TEXT_FONTSIZE,\n        constants!.FIELD_TEXT_FONTWEIGHT,\n        constants!.FIELD_TEXT_FONTFAMILY,\n      );\n      totalWidth += contentWidth;\n    }\n    if (!this.isFullBlockField()) {\n      totalHeight = Math.max(totalHeight, constants!.FIELD_BORDER_RECT_HEIGHT);\n    }\n\n    this.size_.height = totalHeight;\n    this.size_.width = totalWidth;\n\n    this.positionTextElement_(xOffset, contentWidth);\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Position a field's text element after a size change.  This handles both LTR\n   * and RTL positioning.\n   *\n   * @param xOffset x offset to use when positioning the text element.\n   * @param contentWidth The content width.\n   */\n  protected positionTextElement_(xOffset: number, contentWidth: number) {\n    if (!this.textElement_) {\n      return;\n    }\n    const constants = this.getConstants();\n    const halfHeight = this.size_.height / 2;\n\n    this.textElement_.setAttribute(\n      'x',\n      String(\n        this.getSourceBlock()?.RTL\n          ? this.size_.width - contentWidth - xOffset\n          : xOffset,\n      ),\n    );\n    this.textElement_.setAttribute(\n      'y',\n      String(\n        constants!.FIELD_TEXT_BASELINE_CENTER\n          ? halfHeight\n          : halfHeight -\n              constants!.FIELD_TEXT_HEIGHT / 2 +\n              constants!.FIELD_TEXT_BASELINE,\n      ),\n    );\n  }\n\n  /** Position a field's border rect after a size change. */\n  protected positionBorderRect_() {\n    if (!this.borderRect_) {\n      return;\n    }\n    this.borderRect_.setAttribute('width', String(this.size_.width));\n    this.borderRect_.setAttribute('height', String(this.size_.height));\n    this.borderRect_.setAttribute(\n      'rx',\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\n    );\n    this.borderRect_.setAttribute(\n      'ry',\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\n    );\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  getSize(): Size {\n    if (!this.isVisible()) {\n      return new Size(0, 0);\n    }\n\n    if (this.isDirty_) {\n      this.render_();\n      this.isDirty_ = false;\n    } else if (this.visible_ && this.size_.width === 0) {\n      // If the field is not visible the width will be 0 as well, one of the\n      // problems with the old system.\n      this.render_();\n      // Don't issue a warning if the field is actually zero width.\n      if (this.size_.width !== 0) {\n        console.warn(\n          'Deprecated use of setting size_.width to 0 to rerender a' +\n            ' field. Set field.isDirty_ to true instead.',\n        );\n      }\n    }\n    return this.size_;\n  }\n\n  /**\n   * Returns the bounding box of the rendered field, accounting for workspace\n   * scaling.\n   *\n   * @returns An object with top, bottom, left, and right in pixels relative to\n   *     the top left corner of the page (window coordinates).\n   * @internal\n   */\n  getScaledBBox(): Rect {\n    let scaledWidth;\n    let scaledHeight;\n    let xy;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    if (this.isFullBlockField()) {\n      // Browsers are inconsistent in what they return for a bounding box.\n      // - Webkit / Blink: fill-box / object bounding box\n      // - Gecko: stroke-box\n      const bBox = (this.sourceBlock_ as BlockSvg).getHeightWidth();\n      const scale = (block.workspace as WorkspaceSvg).scale;\n      xy = this.getAbsoluteXY_();\n      scaledWidth = (bBox.width + 1) * scale;\n      scaledHeight = (bBox.height + 1) * scale;\n\n      if (userAgent.GECKO) {\n        xy.x += 1.5 * scale;\n        xy.y += 1.5 * scale;\n      } else {\n        xy.x -= 0.5 * scale;\n        xy.y -= 0.5 * scale;\n      }\n    } else {\n      const bBox = this.borderRect_!.getBoundingClientRect();\n      xy = style.getPageOffset(this.borderRect_!);\n      scaledWidth = bBox.width;\n      scaledHeight = bBox.height;\n    }\n    return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n  }\n\n  /**\n   * Notifies the field that it has changed locations.\n   *\n   * @param _ The location of this field's block's top-start corner\n   *     in workspace coordinates.\n   */\n  onLocationChange(_: Coordinate) {}\n\n  /**\n   * Get the text from this field to display on the block. May differ from\n   * `getText` due to ellipsis, and other formatting.\n   *\n   * @returns Text to display.\n   */\n  protected getDisplayText_(): string {\n    let text = this.getText();\n    if (!text) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    if (text.length > this.maxDisplayLength) {\n      // Truncate displayed string and add an ellipsis ('...').\n      text = text.substring(0, this.maxDisplayLength - 2) + '';\n    }\n    // Replace whitespace with non-breaking spaces so the text doesn't collapse.\n    text = text.replace(/\\s/g, Field.NBSP);\n    if (this.sourceBlock_ && this.sourceBlock_.RTL) {\n      // The SVG is LTR, force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    return text;\n  }\n\n  /**\n   * Get the text from this field.\n   * Override getText_ to provide a different behavior than simply casting the\n   * value to a string.\n   *\n   * @returns Current text.\n   * @sealed\n   */\n  getText(): string {\n    // this.getText_ was intended so that devs don't have to remember to call\n    // super when overriding how the text of the field is generated. (#2910)\n    const text = this.getText_();\n    if (text !== null) {\n      return String(text);\n    }\n    return String(this.getValue());\n  }\n\n  /**\n   * A developer hook to override the returned text of this field.\n   * Override if the text representation of the value of this field\n   * is not just a string cast of its value.\n   * Return null to resort to a string cast.\n   *\n   * @returns Current text or null.\n   */\n  protected getText_(): string | null {\n    return null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  markDirty() {\n    this.isDirty_ = true;\n    this.constants_ = null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  forceRerender() {\n    this.isDirty_ = true;\n    if (this.sourceBlock_ && this.sourceBlock_.rendered) {\n      (this.sourceBlock_ as BlockSvg).queueRender();\n    }\n  }\n\n  /**\n   * Used to change the value of the field. Handles validation and events.\n   * Subclasses should override doClassValidation_ and doValueUpdate_ rather\n   * than this method.\n   *\n   * @param newValue New value.\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\n   *     Should usually be true unless the change will be reported some other\n   *     way, e.g. an intermediate field change event.\n   * @sealed\n   */\n  setValue(newValue: AnyDuringMigration, fireChangeEvent = true) {\n    const doLogging = false;\n    if (newValue === null) {\n      doLogging && console.log('null, return');\n      // Not a valid value to check.\n      return;\n    }\n\n    const classValidation = this.doClassValidation_(newValue);\n    const classValue = this.processValidation_(\n      newValue,\n      classValidation,\n      fireChangeEvent,\n    );\n    if (classValue instanceof Error) {\n      doLogging && console.log('invalid class validation, return');\n      return;\n    }\n\n    const localValidation = this.getValidator()?.call(this, classValue);\n    const localValue = this.processValidation_(\n      classValue,\n      localValidation,\n      fireChangeEvent,\n    );\n    if (localValue instanceof Error) {\n      doLogging && console.log('invalid local validation, return');\n      return;\n    }\n\n    const source = this.sourceBlock_;\n    if (source && source.disposed) {\n      doLogging && console.log('source disposed, return');\n      return;\n    }\n\n    const oldValue = this.getValue();\n    if (oldValue === localValue) {\n      doLogging && console.log('same, doValueUpdate_, return');\n      this.doValueUpdate_(localValue);\n      return;\n    }\n\n    this.doValueUpdate_(localValue);\n    if (fireChangeEvent && source && eventUtils.isEnabled()) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          source,\n          'field',\n          this.name || null,\n          oldValue,\n          localValue,\n        ),\n      );\n    }\n    if (this.isDirty_) {\n      this.forceRerender();\n    }\n    doLogging && console.log(this.value_);\n  }\n\n  /**\n   * Process the result of validation.\n   *\n   * @param newValue New value.\n   * @param validatedValue Validated value.\n   * @param fireChangeEvent Whether to fire a change event if the value changes.\n   * @returns New value, or an Error object.\n   */\n  private processValidation_(\n    newValue: AnyDuringMigration,\n    validatedValue: T | null | undefined,\n    fireChangeEvent: boolean,\n  ): T | Error {\n    if (validatedValue === null) {\n      this.doValueInvalid_(newValue, fireChangeEvent);\n      if (this.isDirty_) {\n        this.forceRerender();\n      }\n      return Error();\n    }\n    return validatedValue === undefined ? (newValue as T) : validatedValue;\n  }\n\n  /**\n   * Get the current value of the field.\n   *\n   * @returns Current value.\n   */\n  getValue(): T | null {\n    return this.value_;\n  }\n\n  /**\n   * Validate the changes to a field's value before they are set. See\n   * **FieldDropdown** for an example of subclass implementation.\n   *\n   * **NOTE:** Validation returns one option between `T`, `null`, and\n   * `undefined`. **Field**'s implementation will never return `undefined`, but\n   * it is valid for a subclass to return `undefined` if the new value is\n   * compatible with `T`.\n   *\n   * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n   * @param newValue - The value to be validated.\n   * @returns One of three instructions for setting the new value: `T`, `null`,\n   * or `undefined`.\n   *\n   * - `T` to set this function's returned value instead of `newValue`.\n   *\n   * - `null` to invoke `doValueInvalid_` and not set a value.\n   *\n   * - `undefined` to set `newValue` as is.\n   */\n  protected doClassValidation_(newValue: T): T | null | undefined;\n  protected doClassValidation_(newValue?: AnyDuringMigration): T | null;\n  protected doClassValidation_(\n    newValue?: T | AnyDuringMigration,\n  ): T | null | undefined {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n\n    return newValue as T;\n  }\n\n  /**\n   * Used to update the value of a field. Can be overridden by subclasses to do\n   * custom storage of values/updating of external things.\n   *\n   * @param newValue The value to be saved.\n   */\n  protected doValueUpdate_(newValue: T) {\n    this.value_ = newValue;\n    this.isDirty_ = true;\n  }\n\n  /**\n   * Used to notify the field an invalid value was input. Can be overridden by\n   * subclasses, see FieldTextInput.\n   * No-op by default.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   * @param _fireChangeEvent Whether to fire a change event if the value changes.\n   */\n  protected doValueInvalid_(\n    _invalidValue: AnyDuringMigration,\n    _fireChangeEvent: boolean = true,\n  ) {}\n  // NOP\n\n  /**\n   * Handle a pointerdown event on a field.\n   *\n   * @param e Pointer down event.\n   */\n  protected onMouseDown_(e: PointerEvent) {\n    if (!this.sourceBlock_ || this.sourceBlock_.isDeadOrDying()) {\n      return;\n    }\n    const gesture = (this.sourceBlock_.workspace as WorkspaceSvg).getGesture(e);\n    if (gesture) {\n      gesture.setStartField(this);\n    }\n  }\n\n  /**\n   * Sets the tooltip for this field.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, a parent object whose tooltip will be used, or null to\n   *     display the tooltip of the parent block. To not display a tooltip pass\n   *     the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo | null) {\n    if (!newTip && newTip !== '') {\n      // If null or undefined.\n      newTip = this.sourceBlock_;\n    }\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      (clickTarget as AnyDuringMigration).tooltip = newTip;\n    } else {\n      // Field has not been initialized yet.\n      this.tooltip_ = newTip;\n    }\n  }\n\n  /**\n   * Returns the tooltip text for this field.\n   *\n   * @returns The tooltip text for this field.\n   */\n  getTooltip(): string {\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      return Tooltip.getTooltipOfObject(clickTarget);\n    }\n    // Field has not been initialized yet. Return stashed this.tooltip_ value.\n    return Tooltip.getTooltipOfObject({tooltip: this.tooltip_});\n  }\n\n  /**\n   * The element to bind the click handler to. If not set explicitly, defaults\n   * to the SVG root of the field. When this element is\n   * clicked on an editable field, the editor will open.\n   *\n   * @returns Element to bind click handler to.\n   */\n  protected getClickTarget_(): Element | null {\n    return this.clickTarget_ || this.getSvgRoot();\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this field.\n   * The origin (0,0) is the top-left corner of the page body.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  protected getAbsoluteXY_(): Coordinate {\n    return style.getPageOffset(this.getClickTarget_() as SVGRectElement);\n  }\n\n  /**\n   * Whether this field references any Blockly variables.  If true it may need\n   * to be handled differently during serialization and deserialization.\n   * Subclasses may override this.\n   *\n   * @returns True if this field has any variable references.\n   * @internal\n   */\n  referencesVariables(): boolean {\n    return false;\n  }\n\n  /**\n   * Refresh the variable name referenced by this field if this field references\n   * variables.\n   *\n   * @internal\n   */\n  refreshVariableName() {}\n  // NOP\n\n  /**\n   * Search through the list of inputs and their fields in order to find the\n   * parent input of a field.\n   *\n   * @returns The input that the field belongs to.\n   * @internal\n   */\n  getParentInput(): Input {\n    let parentInput = null;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const inputs = block.inputList;\n\n    for (let idx = 0; idx < block.inputList.length; idx++) {\n      const input = inputs[idx];\n      const fieldRows = input.fieldRow;\n      for (let j = 0; j < fieldRows.length; j++) {\n        if (fieldRows[j] === this) {\n          parentInput = input;\n          break;\n        }\n      }\n    }\n    return parentInput!;\n  }\n\n  /**\n   * Returns whether or not we should flip the field in RTL.\n   *\n   * @returns True if we should flip in RTL.\n   */\n  getFlipRtl(): boolean {\n    return false;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  isTabNavigable(): boolean {\n    return false;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /**\n   * Add the cursor SVG to this fields SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the field group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this fields SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the field group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(markerSvg);\n    this.markerSvg_ = markerSvg;\n  }\n\n  /**\n   * Redraw any attached marker or cursor svgs if needed.\n   *\n   * @internal\n   */\n  updateMarkers_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const workspace = block.workspace as WorkspaceSvg;\n    if (workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      workspace.getCursor()!.draw();\n    }\n    if (workspace.keyboardAccessibilityMode && this.markerSvg_) {\n      // TODO(#4592): Update all markers on the field.\n      workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n  }\n\n  /**\n   * Subclasses should reimplement this method to construct their Field\n   * subclass from a JSON arg object.\n   *\n   * It is an error to attempt to register a field subclass in the\n   * FieldRegistry if that subclass has not overridden this method.\n   *\n   * @param _options JSON configuration object with properties needed\n   *    to configure a specific field.\n   */\n  static fromJson(_options: FieldConfig): Field {\n    throw new Error(\n      `Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.`,\n    );\n  }\n}\n\n/**\n * Extra configuration options for the base field.\n */\nexport interface FieldConfig {\n  tooltip?: string;\n}\n\n/**\n * Represents an object that has all the prototype properties of the `Field`\n * class. This is necessary because constructors can change\n * in descendants, though they should contain all of Field's prototype methods.\n *\n * This type should only be used in places where we directly access the prototype\n * of a Field class or subclass.\n */\ntype FieldProto = Pick<typeof Field, 'prototype'>;\n\n/**\n * Represents an error where the field is trying to access its block or\n * information about its block before it has actually been attached to said\n * block.\n */\nexport class UnattachedFieldError extends Error {\n  /** @internal */\n  constructor() {\n    super(\n      'The field has not yet been attached to its input. ' +\n        'Call appendField to attach it.',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registry for context menu option items.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ContextMenuRegistry\n\nimport type {BlockSvg} from './block_svg.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for the registry of context menu items. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ContextMenuRegistry.registry.\n */\nexport class ContextMenuRegistry {\n  static registry: ContextMenuRegistry;\n  /** Registry of all registered RegistryItems, keyed by ID. */\n  private registry_ = new Map<string, RegistryItem>();\n\n  /** Resets the existing singleton instance of ContextMenuRegistry. */\n  constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry. */\n  reset() {\n    this.registry_.clear();\n  }\n\n  /**\n   * Registers a RegistryItem.\n   *\n   * @param item Context menu item to register.\n   * @throws {Error} if an item with the given ID already exists.\n   */\n  register(item: RegistryItem) {\n    if (this.registry_.has(item.id)) {\n      throw Error('Menu item with ID \"' + item.id + '\" is already registered.');\n    }\n    this.registry_.set(item.id, item);\n  }\n\n  /**\n   * Unregisters a RegistryItem with the given ID.\n   *\n   * @param id The ID of the RegistryItem to remove.\n   * @throws {Error} if an item with the given ID does not exist.\n   */\n  unregister(id: string) {\n    if (!this.registry_.has(id)) {\n      throw new Error('Menu item with ID \"' + id + '\" not found.');\n    }\n    this.registry_.delete(id);\n  }\n\n  /**\n   * @param id The ID of the RegistryItem to get.\n   * @returns RegistryItem or null if not found\n   */\n  getItem(id: string): RegistryItem | null {\n    return this.registry_.get(id) ?? null;\n  }\n\n  /**\n   * Gets the valid context menu options for the given scope type (e.g. block or\n   * workspace) and scope. Blocks are only shown if the preconditionFn shows\n   * they should not be hidden.\n   *\n   * @param scopeType Type of scope where menu should be shown (e.g. on a block\n   *     or on a workspace)\n   * @param scope Current scope of context menu (i.e., the exact workspace or\n   *     block being clicked on)\n   * @returns the list of ContextMenuOptions\n   */\n  getContextMenuOptions(\n    scopeType: ScopeType,\n    scope: Scope,\n  ): ContextMenuOption[] {\n    const menuOptions: ContextMenuOption[] = [];\n    for (const item of this.registry_.values()) {\n      if (scopeType === item.scopeType) {\n        const precondition = item.preconditionFn(scope);\n        if (precondition !== 'hidden') {\n          const displayText =\n            typeof item.displayText === 'function'\n              ? item.displayText(scope)\n              : item.displayText;\n          const menuOption: ContextMenuOption = {\n            text: displayText,\n            enabled: precondition === 'enabled',\n            callback: item.callback,\n            scope,\n            weight: item.weight,\n          };\n          menuOptions.push(menuOption);\n        }\n      }\n    }\n    menuOptions.sort(function (a, b) {\n      return a.weight - b.weight;\n    });\n    return menuOptions;\n  }\n}\n\nexport namespace ContextMenuRegistry {\n  /**\n   * Where this menu item should be rendered. If the menu item should be\n   * rendered in multiple scopes, e.g. on both a block and a workspace, it\n   * should be registered for each scope.\n   */\n  export enum ScopeType {\n    BLOCK = 'block',\n    WORKSPACE = 'workspace',\n    COMMENT = 'comment',\n  }\n\n  /**\n   * The actual workspace/block where the menu is being rendered. This is passed\n   * to callback and displayText functions that depend on this information.\n   */\n  export interface Scope {\n    block?: BlockSvg;\n    workspace?: WorkspaceSvg;\n    comment?: RenderedWorkspaceComment;\n  }\n\n  /**\n   * A menu item as entered in the registry.\n   */\n  export interface RegistryItem {\n    /**\n     * @param scope Object that provides a reference to the thing that had its\n     *     context menu opened.\n     * @param e The original event that triggered the context menu to open. Not\n     *     the event that triggered the click on the option.\n     */\n    callback: (scope: Scope, e: PointerEvent) => void;\n    scopeType: ScopeType;\n    displayText: ((p1: Scope) => string | HTMLElement) | string | HTMLElement;\n    preconditionFn: (p1: Scope) => string;\n    weight: number;\n    id: string;\n  }\n\n  /**\n   * A menu item as presented to contextmenu.js.\n   */\n  export interface ContextMenuOption {\n    text: string | HTMLElement;\n    enabled: boolean;\n    /**\n     * @param scope Object that provides a reference to the thing that had its\n     *     context menu opened.\n     * @param e The original event that triggered the context menu to open. Not\n     *     the event that triggered the click on the option.\n     */\n    callback: (scope: Scope, e: PointerEvent) => void;\n    scope: Scope;\n    weight: number;\n  }\n\n  /**\n   * A subset of ContextMenuOption corresponding to what was publicly\n   * documented.  ContextMenuOption should be preferred for new code.\n   */\n  export interface LegacyContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n  }\n\n  /**\n   * Singleton instance of this class. All interactions with this class should\n   * be done on this object.\n   */\n  ContextMenuRegistry.registry = new ContextMenuRegistry();\n}\n\nexport type ScopeType = ContextMenuRegistry.ScopeType;\nexport const ScopeType = ContextMenuRegistry.ScopeType;\nexport type Scope = ContextMenuRegistry.Scope;\nexport type RegistryItem = ContextMenuRegistry.RegistryItem;\nexport type ContextMenuOption = ContextMenuRegistry.ContextMenuOption;\nexport type LegacyContextMenuOption =\n  ContextMenuRegistry.LegacyContextMenuOption;\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {CommentView} from './comment_view.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {IBoundedElement} from '../interfaces/i_bounded_element.js';\nimport {IRenderedElement} from '../interfaces/i_rendered_element.js';\nimport * as dom from '../utils/dom.js';\nimport {IDraggable} from '../interfaces/i_draggable.js';\nimport {CommentDragStrategy} from '../dragging/comment_drag_strategy.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {ISelectable} from '../interfaces/i_selectable.js';\nimport {IDeletable} from '../interfaces/i_deletable.js';\nimport {ICopyable} from '../interfaces/i_copyable.js';\nimport * as commentSerialization from '../serialization/workspace_comments.js';\nimport {\n  WorkspaceCommentPaster,\n  WorkspaceCommentCopyData,\n} from '../clipboard/workspace_comment_paster.js';\nimport {IContextMenu} from '../interfaces/i_contextmenu.js';\nimport * as contextMenu from '../contextmenu.js';\nimport {ContextMenuRegistry} from '../contextmenu_registry.js';\n\nexport class RenderedWorkspaceComment\n  extends WorkspaceComment\n  implements\n    IBoundedElement,\n    IRenderedElement,\n    IDraggable,\n    ISelectable,\n    IDeletable,\n    ICopyable<WorkspaceCommentCopyData>,\n    IContextMenu\n{\n  /** The class encompassing the svg elements making up the workspace comment. */\n  private view: CommentView;\n\n  public readonly workspace: WorkspaceSvg;\n\n  private dragStrategy = new CommentDragStrategy(this);\n\n  /** Constructs the workspace comment, including the view. */\n  constructor(workspace: WorkspaceSvg, id?: string) {\n    super(workspace, id);\n\n    this.workspace = workspace;\n\n    this.view = new CommentView(workspace);\n    // Set the size to the default size as defined in the superclass.\n    this.view.setSize(this.getSize());\n    this.view.setEditable(this.isEditable());\n\n    this.addModelUpdateBindings();\n\n    browserEvents.conditionalBind(\n      this.view.getSvgRoot(),\n      'pointerdown',\n      this,\n      this.startGesture,\n    );\n    // Don't zoom with mousewheel; let it scroll instead.\n    browserEvents.conditionalBind(\n      this.view.getSvgRoot(),\n      'wheel',\n      this,\n      (e: Event) => {\n        e.stopPropagation();\n      },\n    );\n  }\n\n  /**\n   * Adds listeners to the view that updates the model (i.e. the superclass)\n   * when changes are made to the view.\n   */\n  private addModelUpdateBindings() {\n    this.view.addTextChangeListener(\n      (_, newText: string) => void super.setText(newText),\n    );\n    this.view.addSizeChangeListener(\n      (_, newSize: Size) => void super.setSize(newSize),\n    );\n    this.view.addOnCollapseListener(\n      () => void super.setCollapsed(this.view.isCollapsed()),\n    );\n    this.view.addDisposeListener(() => {\n      if (!this.isDeadOrDying()) this.dispose();\n    });\n  }\n\n  /** Sets the text of the comment. */\n  override setText(text: string): void {\n    // setText will trigger the change listener that updates\n    // the model aka superclass.\n    this.view.setText(text);\n  }\n\n  /** Sets the size of the comment. */\n  override setSize(size: Size) {\n    // setSize will trigger the change listener that updates\n    // the model aka superclass.\n    this.view.setSize(size);\n  }\n\n  /** Sets whether the comment is collapsed or not. */\n  override setCollapsed(collapsed: boolean) {\n    // setCollapsed will trigger the change listener that updates\n    // the model aka superclass.\n    this.view.setCollapsed(collapsed);\n  }\n\n  /** Sets whether the comment is editable or not. */\n  override setEditable(editable: boolean): void {\n    super.setEditable(editable);\n    // Use isEditable rather than isOwnEditable to account for workspace state.\n    this.view.setEditable(this.isEditable());\n  }\n\n  /** Returns the root SVG element of this comment. */\n  getSvgRoot(): SVGElement {\n    return this.view.getSvgRoot();\n  }\n\n  /**\n   * Returns the comment's size in workspace units.\n   * Does not respect collapsing.\n   */\n  getSize(): Size {\n    return super.getSize();\n  }\n\n  /**\n   * Returns the bounding rectangle of this comment in workspace coordinates.\n   * Respects collapsing.\n   */\n  getBoundingRectangle(): Rect {\n    const loc = this.getRelativeToSurfaceXY();\n    const size = this.view?.getSize() ?? this.getSize();\n    let left;\n    let right;\n    if (this.workspace.RTL) {\n      left = loc.x - size.width;\n      right = loc.x;\n    } else {\n      left = loc.x;\n      right = loc.x + size.width;\n    }\n    return new Rect(loc.y, loc.y + size.height, left, right);\n  }\n\n  /** Move the comment by the given amounts in workspace coordinates. */\n  moveBy(dx: number, dy: number, reason?: string[] | undefined): void {\n    const loc = this.getRelativeToSurfaceXY();\n    const newLoc = new Coordinate(loc.x + dx, loc.y + dy);\n    this.moveTo(newLoc, reason);\n  }\n\n  /** Moves the comment to the given location in workspace coordinates. */\n  override moveTo(location: Coordinate, reason?: string[] | undefined): void {\n    super.moveTo(location, reason);\n    this.view.moveTo(location);\n  }\n\n  /**\n   * Moves the comment during a drag. Doesn't fire move events.\n   *\n   * @internal\n   */\n  moveDuringDrag(location: Coordinate): void {\n    this.location = location;\n    this.view.moveTo(location);\n  }\n\n  /**\n   * Adds the dragging CSS class to this comment.\n   *\n   * @internal\n   */\n  setDragging(dragging: boolean): void {\n    if (dragging) {\n      dom.addClass(this.getSvgRoot(), 'blocklyDragging');\n    } else {\n      dom.removeClass(this.getSvgRoot(), 'blocklyDragging');\n    }\n  }\n\n  /** Disposes of the view. */\n  override dispose() {\n    this.disposing = true;\n    if (!this.view.isDeadOrDying()) this.view.dispose();\n    super.dispose();\n  }\n\n  /**\n   * Starts a gesture because we detected a pointer down on the comment\n   * (that wasn't otherwise gobbled up, e.g. by resizing).\n   */\n  private startGesture(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleCommentStart(e, this);\n      common.setSelected(this);\n    }\n  }\n\n  /** Visually indicates that this comment would be deleted if dropped. */\n  setDeleteStyle(wouldDelete: boolean): void {\n    if (wouldDelete) {\n      dom.addClass(this.getSvgRoot(), 'blocklyDraggingDelete');\n    } else {\n      dom.removeClass(this.getSvgRoot(), 'blocklyDraggingDelete');\n    }\n  }\n\n  /** Returns whether this comment is movable or not. */\n  isMovable(): boolean {\n    return this.dragStrategy.isMovable();\n  }\n\n  /** Starts a drag on the comment. */\n  startDrag(): void {\n    this.dragStrategy.startDrag();\n  }\n\n  /** Drags the comment to the given location. */\n  drag(newLoc: Coordinate): void {\n    this.dragStrategy.drag(newLoc);\n  }\n\n  /** Ends the drag on the comment. */\n  endDrag(): void {\n    this.dragStrategy.endDrag();\n  }\n\n  /** Moves the comment back to where it was at the start of a drag. */\n  revertDrag(): void {\n    this.dragStrategy.revertDrag();\n  }\n\n  /** Visually highlights the comment. */\n  select(): void {\n    dom.addClass(this.getSvgRoot(), 'blocklySelected');\n  }\n\n  /** Visually unhighlights the comment. */\n  unselect(): void {\n    dom.removeClass(this.getSvgRoot(), 'blocklySelected');\n  }\n\n  /**\n   * Returns a JSON serializable representation of this comment's state that\n   * can be used for pasting.\n   */\n  toCopyData(): WorkspaceCommentCopyData | null {\n    return {\n      paster: WorkspaceCommentPaster.TYPE,\n      commentState: commentSerialization.save(this, {\n        addCoordinates: true,\n      }),\n    };\n  }\n\n  /** Show a context menu for this comment. */\n  showContextMenu(e: PointerEvent): void {\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.COMMENT,\n      {comment: this},\n    );\n    contextMenu.show(e, menuOptions, this.workspace.RTL, this.workspace);\n  }\n\n  /** Snap this comment to the nearest grid point. */\n  snapToGrid(): void {\n    if (this.isDeadOrDying()) return;\n    const grid = this.workspace.getGrid();\n    if (!grid?.shouldSnap()) return;\n    const currentXY = this.getRelativeToSurfaceXY();\n    const alignedXY = grid.alignXY(currentXY);\n    if (alignedXY !== currentXY) {\n      this.moveTo(alignedXY, ['snap']);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockCreate\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * created.\n */\nexport class BlockCreate extends BlockBase {\n  override type = eventUtils.BLOCK_CREATE;\n\n  /** The XML representation of the created block(s). */\n  xml?: Element | DocumentFragment;\n\n  /** The JSON respresentation of the created block(s). */\n  json?: blocks.State;\n\n  /** All of the IDs of created blocks. */\n  ids?: string[];\n\n  /** @param opt_block The created block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.xml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n\n    this.json = blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockCreateJson {\n    const json = super.toJson() as BlockCreateJson;\n    if (!this.xml) {\n      throw new Error(\n        'The block XML is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['ids'] = this.ids;\n    json['json'] = this.json;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockCreate(),\n    ) as BlockCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.ids = json['ids'];\n    newEvent.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.json) {\n      throw new Error(\n        'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (allShadowBlocks(workspace, this.ids)) return;\n    if (forward) {\n      blocks.append(this.json, workspace);\n    } else {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn(\"Can't uncreate non-existent block: \" + id);\n        }\n      }\n    }\n  }\n}\n/**\n * Returns true if all blocks in the list are shadow blocks. If so, that means\n * the top-level block being created is a shadow block. This only happens when a\n * block that was covering up a shadow block is removed. We don't need to create\n * an additional block in that case because the original block still has its\n * shadow block.\n *\n * @param workspace Workspace to check for blocks\n * @param ids A list of block ids that were created in this event\n * @returns True if all block ids in the list are shadow blocks\n */\nconst allShadowBlocks = function (\n  workspace: Workspace,\n  ids: string[],\n): boolean {\n  const shadows = ids\n    .map((id) => workspace.getBlockById(id))\n    .filter((block) => block && block.isShadow());\n  return shadows.length === ids.length;\n};\n\nexport interface BlockCreateJson extends BlockBaseJson {\n  xml: string;\n  ids: string[];\n  json: object;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CREATE, BlockCreate);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a theme update.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ThemeChange\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that the workspace theme has changed.\n */\nexport class ThemeChange extends UiBase {\n  /** The name of the new theme that has been set. */\n  themeName?: string;\n\n  override type = eventUtils.THEME_CHANGE;\n\n  /**\n   * @param opt_themeName The theme name. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    event. Undefined for a blank event.\n   */\n  constructor(opt_themeName?: string, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.themeName = opt_themeName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ThemeChangeJson {\n    const json = super.toJson() as ThemeChangeJson;\n    if (!this.themeName) {\n      throw new Error(\n        'The theme name is undefined. Either pass a theme name to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['themeName'] = this.themeName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ThemeChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ThemeChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): ThemeChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ThemeChange(),\n    ) as ThemeChange;\n    newEvent.themeName = json['themeName'];\n    return newEvent;\n  }\n}\n\nexport interface ThemeChangeJson extends AbstractEventJson {\n  themeName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.THEME_CHANGE, ThemeChange);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a viewport change.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ViewportChange\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that the workspace surface's position or scale has\n * changed.\n *\n * Does not notify when the workspace itself resizes.\n */\nexport class ViewportChange extends UiBase {\n  /**\n   * Top edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewTop?: number;\n\n  /**\n   * The left edge of the visible portion of the workspace, relative to\n   * the workspace origin.\n   */\n  viewLeft?: number;\n\n  /** The scale of the workpace. */\n  scale?: number;\n\n  /** The previous scale of the workspace. */\n  oldScale?: number;\n\n  override type = eventUtils.VIEWPORT_CHANGE;\n\n  /**\n   * @param opt_top Top-edge of the visible portion of the workspace, relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_left Left-edge of the visible portion of the workspace relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_scale The scale of the workspace. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @param opt_oldScale The old scale of the workspace. Undefined for a blank\n   *     event.\n   */\n  constructor(\n    opt_top?: number,\n    opt_left?: number,\n    opt_scale?: number,\n    opt_workspaceId?: string,\n    opt_oldScale?: number,\n  ) {\n    super(opt_workspaceId);\n\n    this.viewTop = opt_top;\n    this.viewLeft = opt_left;\n    this.scale = opt_scale;\n    this.oldScale = opt_oldScale;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ViewportChangeJson {\n    const json = super.toJson() as ViewportChangeJson;\n    if (this.viewTop === undefined) {\n      throw new Error(\n        'The view top is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.viewLeft === undefined) {\n      throw new Error(\n        'The view left is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.scale === undefined) {\n      throw new Error(\n        'The scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.oldScale === undefined) {\n      throw new Error(\n        'The old scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['viewTop'] = this.viewTop;\n    json['viewLeft'] = this.viewLeft;\n    json['scale'] = this.scale;\n    json['oldScale'] = this.oldScale;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Viewport, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ViewportChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): ViewportChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ViewportChange(),\n    ) as ViewportChange;\n    newEvent.viewTop = json['viewTop'];\n    newEvent.viewLeft = json['viewLeft'];\n    newEvent.scale = json['scale'];\n    newEvent.oldScale = json['oldScale'];\n    return newEvent;\n  }\n}\n\nexport interface ViewportChangeJson extends AbstractEventJson {\n  viewTop: number;\n  viewLeft: number;\n  scale: number;\n  oldScale: number;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.VIEWPORT_CHANGE,\n  ViewportChange,\n);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ConnectionType\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum ConnectionType {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  INPUT_VALUE = 1,\n  // A left-facing value output.  E.g. 'random fraction'.\n  OUTPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  NEXT_STATEMENT,\n  // An up-facing block stack.  E.g. 'break out of loop'.\n  PREVIOUS_STATEMENT,\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A database of all the rendered connections that could\n *    possibly be connected to (i.e. not collapsed, etc).\n *    Sorted by y coordinate.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ConnectionDB\n\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\n\n/**\n * Database of connections.\n * Connections are stored in order of their vertical component.  This way\n * connections in an area may be looked up quickly using a binary search.\n */\nexport class ConnectionDB {\n  /** Array of connections sorted by y position in workspace units. */\n  private readonly connections: RenderedConnection[] = [];\n\n  /**\n   * @param connectionChecker The workspace's connection type checker, used to\n   *     decide if connections are valid during a drag.\n   */\n  constructor(private readonly connectionChecker: IConnectionChecker) {}\n\n  /**\n   * Add a connection to the database. Should not already exist in the database.\n   *\n   * @param connection The connection to be added.\n   * @param yPos The y position used to decide where to insert the connection.\n   * @internal\n   */\n  addConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.calculateIndexForYPos(yPos);\n    this.connections.splice(index, 0, connection);\n  }\n\n  /**\n   * Finds the index of the given connection.\n   *\n   * Starts by doing a binary search to find the approximate location, then\n   * linearly searches nearby for the exact connection.\n   *\n   * @param conn The connection to find.\n   * @param yPos The y position used to find the index of the connection.\n   * @returns The index of the connection, or -1 if the connection was not\n   *     found.\n   */\n  private findIndexOfConnection(\n    conn: RenderedConnection,\n    yPos: number,\n  ): number {\n    if (!this.connections.length) {\n      return -1;\n    }\n\n    const bestGuess = this.calculateIndexForYPos(yPos);\n    if (bestGuess >= this.connections.length) {\n      // Not in list\n      return -1;\n    }\n\n    yPos = conn.y;\n    // Walk forward and back on the y axis looking for the connection.\n    let pointer = bestGuess;\n    while (pointer >= 0 && this.connections[pointer].y === yPos) {\n      if (this.connections[pointer] === conn) {\n        return pointer;\n      }\n      pointer--;\n    }\n\n    pointer = bestGuess;\n    while (\n      pointer < this.connections.length &&\n      this.connections[pointer].y === yPos\n    ) {\n      if (this.connections[pointer] === conn) {\n        return pointer;\n      }\n      pointer++;\n    }\n    return -1;\n  }\n\n  /**\n   * Finds the correct index for the given y position.\n   *\n   * @param yPos The y position used to decide where to insert the connection.\n   * @returns The candidate index.\n   */\n  private calculateIndexForYPos(yPos: number): number {\n    if (!this.connections.length) {\n      return 0;\n    }\n    let pointerMin = 0;\n    let pointerMax = this.connections.length;\n    while (pointerMin < pointerMax) {\n      const pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n      if (this.connections[pointerMid].y < yPos) {\n        pointerMin = pointerMid + 1;\n      } else if (this.connections[pointerMid].y > yPos) {\n        pointerMax = pointerMid;\n      } else {\n        pointerMin = pointerMid;\n        break;\n      }\n    }\n    return pointerMin;\n  }\n\n  /**\n   * Remove a connection from the database.  Must already exist in DB.\n   *\n   * @param connection The connection to be removed.\n   * @param yPos The y position used to find the index of the connection.\n   * @throws {Error} If the connection cannot be found in the database.\n   */\n  removeConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.findIndexOfConnection(connection, yPos);\n    if (index === -1) {\n      throw Error('Unable to find connection in connectionDB.');\n    }\n    this.connections.splice(index, 1);\n  }\n\n  /**\n   * Find all nearby connections to the given connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param connection The connection whose neighbours should be returned.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns List of connections.\n   */\n  getNeighbours(\n    connection: RenderedConnection,\n    maxRadius: number,\n  ): RenderedConnection[] {\n    const db = this.connections;\n    const currentX = connection.x;\n    const currentY = connection.y;\n\n    // Binary search to find the closest y location.\n    let pointerMin = 0;\n    let pointerMax = db.length - 2;\n    let pointerMid = pointerMax;\n    while (pointerMin < pointerMid) {\n      if (db[pointerMid].y < currentY) {\n        pointerMin = pointerMid;\n      } else {\n        pointerMax = pointerMid;\n      }\n      pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n    }\n\n    const neighbours: RenderedConnection[] = [];\n    /**\n     * Computes if the current connection is within the allowed radius of\n     * another connection. This function is a closure and has access to outside\n     * variables.\n     *\n     * @param yIndex The other connection's index in the database.\n     * @returns True if the current connection's vertical distance from the\n     *     other connection is less than the allowed radius.\n     */\n    function checkConnection(yIndex: number): boolean {\n      const dx = currentX - db[yIndex].x;\n      const dy = currentY - db[yIndex].y;\n      const r = Math.sqrt(dx * dx + dy * dy);\n      if (r <= maxRadius) {\n        neighbours.push(db[yIndex]);\n      }\n      return dy < maxRadius;\n    }\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    pointerMin = pointerMid;\n    pointerMax = pointerMid;\n    if (db.length) {\n      while (pointerMin >= 0 && checkConnection(pointerMin)) {\n        pointerMin--;\n      }\n      do {\n        pointerMax++;\n      } while (pointerMax < db.length && checkConnection(pointerMax));\n    }\n\n    return neighbours;\n  }\n\n  /**\n   * Is the candidate connection close to the reference connection.\n   * Extremely fast; only looks at Y distance.\n   *\n   * @param index Index in database of candidate connection.\n   * @param baseY Reference connection's Y value.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns True if connection is in range.\n   */\n  private isInYRange(index: number, baseY: number, maxRadius: number): boolean {\n    return Math.abs(this.connections[index].y - baseY) <= maxRadius;\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   *\n   * @param conn The connection searching for a compatible mate.\n   * @param maxRadius The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  searchForClosest(\n    conn: RenderedConnection,\n    maxRadius: number,\n    dxy: Coordinate,\n  ): {connection: RenderedConnection | null; radius: number} {\n    if (!this.connections.length) {\n      // Don't bother.\n      return {connection: null, radius: maxRadius};\n    }\n\n    // Stash the values of x and y from before the drag.\n    const baseY = conn.y;\n    const baseX = conn.x;\n\n    conn.x = baseX + dxy.x;\n    conn.y = baseY + dxy.y;\n\n    // calculateIndexForYPos_ finds an index for insertion, which is always\n    // after any block with the same y index.  We want to search both forward\n    // and back, so search on both sides of the index.\n    const closestIndex = this.calculateIndexForYPos(conn.y);\n\n    let bestConnection = null;\n    let bestRadius = maxRadius;\n    let temp;\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    let pointerMin = closestIndex - 1;\n    while (pointerMin >= 0 && this.isInYRange(pointerMin, conn.y, maxRadius)) {\n      temp = this.connections[pointerMin];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMin--;\n    }\n\n    let pointerMax = closestIndex;\n    while (\n      pointerMax < this.connections.length &&\n      this.isInYRange(pointerMax, conn.y, maxRadius)\n    ) {\n      temp = this.connections[pointerMax];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMax++;\n    }\n\n    // Reset the values of x and y.\n    conn.x = baseX;\n    conn.y = baseY;\n    // If there were no valid connections, bestConnection will be null.\n    return {connection: bestConnection, radius: bestRadius};\n  }\n\n  /**\n   * Initialize a set of connection DBs for a workspace.\n   *\n   * @param checker The workspace's connection checker, used to decide if\n   *     connections are valid during a drag.\n   * @returns Array of databases.\n   */\n  static init(checker: IConnectionChecker): ConnectionDB[] {\n    // Create four databases, one for each connection type.\n    const dbList = [];\n    dbList[ConnectionType.INPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.OUTPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.NEXT_STATEMENT] = new ConnectionDB(checker);\n    dbList[ConnectionType.PREVIOUS_STATEMENT] = new ConnectionDB(checker);\n    return dbList;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a workspace visually.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceDragger\n\nimport * as common from './common.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a workspace dragger.  It moves the workspace around when it is\n * being dragged by a mouse or touch.\n *\n */\nexport class WorkspaceDragger {\n  private readonly horizontalScrollEnabled_: boolean;\n  private readonly verticalScrollEnabled_: boolean;\n  protected startScrollXY_: Coordinate;\n\n  /** @param workspace The workspace to drag. */\n  constructor(private workspace: WorkspaceSvg) {\n    /** Whether horizontal scroll is enabled. */\n    this.horizontalScrollEnabled_ = this.workspace.isMovableHorizontally();\n\n    /** Whether vertical scroll is enabled. */\n    this.verticalScrollEnabled_ = this.workspace.isMovableVertically();\n\n    /**\n     * The scroll position of the workspace at the beginning of the drag.\n     * Coordinate system: pixel coordinates.\n     */\n    this.startScrollXY_ = new Coordinate(workspace.scrollX, workspace.scrollY);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'WorkspaceSvg'.\n    this.workspace = null as AnyDuringMigration;\n  }\n\n  /**\n   * Start dragging the workspace.\n   *\n   * @internal\n   */\n  startDrag() {\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n  }\n\n  /**\n   * Finish dragging the workspace and put everything back where it belongs.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  endDrag(currentDragDeltaXY: Coordinate) {\n    // Make sure everything is up to date.\n    this.drag(currentDragDeltaXY);\n  }\n\n  /**\n   * Move the workspace based on the most recent mouse movements.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  drag(currentDragDeltaXY: Coordinate) {\n    const newXY = Coordinate.sum(this.startScrollXY_, currentDragDeltaXY);\n\n    if (this.horizontalScrollEnabled_ && this.verticalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, newXY.y);\n    } else if (this.horizontalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, this.workspace.scrollY);\n    } else if (this.verticalScrollEnabled_) {\n      this.workspace.scroll(this.workspace.scrollX, newXY.y);\n    } else {\n      throw new TypeError('Invalid state.');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an in-progress gesture, e.g. a drag,\n * tap, or pinch to zoom.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Gesture\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {IIcon} from './interfaces/i_icon.js';\nimport {IDragger} from './interfaces/i_dragger.js';\nimport * as registry from './registry.js';\nimport {IDraggable, isDraggable} from './interfaces/i_draggable.js';\nimport {RenderedWorkspaceComment} from './comments.js';\n\n/**\n * Note: In this file \"start\" refers to pointerdown\n * events.  \"End\" refers to pointerup events.\n */\n\n/** A multiplier used to convert the gesture scale to a zoom in delta. */\nconst ZOOM_IN_MULTIPLIER = 5;\n\n/** A multiplier used to convert the gesture scale to a zoom out delta. */\nconst ZOOM_OUT_MULTIPLIER = 6;\n\n/**\n * Class for one gesture.\n */\nexport class Gesture {\n  /**\n   * The position of the pointer when the gesture started.  Units are CSS\n   * pixels, with (0, 0) at the top left of the browser window (pointer event\n   * clientX/Y).\n   */\n  private mouseDownXY = new Coordinate(0, 0);\n  private currentDragDeltaXY: Coordinate;\n\n  /**\n   * The bubble that the gesture started on, or null if it did not start on a\n   * bubble.\n   */\n  private startBubble: IBubble | null = null;\n\n  /**\n   * The field that the gesture started on, or null if it did not start on a\n   * field.\n   */\n  private startField: Field | null = null;\n\n  /**\n   * The icon that the gesture started on, or null if it did not start on an\n   * icon.\n   */\n  private startIcon: IIcon | null = null;\n\n  /**\n   * The block that the gesture started on, or null if it did not start on a\n   * block.\n   */\n  private startBlock: BlockSvg | null = null;\n\n  /**\n   * The comment that the gesture started on, or null if it did not start on a\n   * comment.\n   */\n  private startComment: RenderedWorkspaceComment | null = null;\n\n  /**\n   * The block that this gesture targets.  If the gesture started on a\n   * shadow block, this is the first non-shadow parent of the block.  If the\n   * gesture started in the flyout, this is the root block of the block group\n   * that was clicked or dragged.\n   */\n  private targetBlock: BlockSvg | null = null;\n\n  /**\n   * The workspace that the gesture started on.  There may be multiple\n   * workspaces on a page; this is more accurate than using\n   * Blockly.common.getMainWorkspace().\n   */\n  protected startWorkspace_: WorkspaceSvg | null = null;\n\n  /**\n   * Whether the pointer has at any point moved out of the drag radius.\n   * A gesture that exceeds the drag radius is a drag even if it ends exactly\n   * at its start point.\n   */\n  private hasExceededDragRadius = false;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  private dragger: IDragger | null = null;\n\n  /**\n   * The object tracking a workspace or flyout workspace drag, or null if none\n   * is in progress.\n   */\n  private workspaceDragger: WorkspaceDragger | null = null;\n\n  /** Whether the gesture is dragging or not. */\n  private dragging: boolean = false;\n\n  /** The flyout a gesture started in, if any. */\n  private flyout: IFlyout | null = null;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private calledUpdateIsDragging = false;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private gestureHasStarted = false;\n\n  /** Boolean used internally to break a cycle in disposal. */\n  protected isEnding_ = false;\n\n  /** The event that most recently updated this gesture. */\n  private mostRecentEvent: PointerEvent;\n\n  /** Boolean for whether or not this gesture is a multi-touch gesture. */\n  private isMultiTouch_ = false;\n\n  /** A map of cached points used for tracking multi-touch gestures. */\n  private cachedPoints = new Map<string, Coordinate | null>();\n\n  /**\n   * This is the ratio between the starting distance between the touch points\n   * and the most recent distance between the touch points.\n   * Scales between 0 and 1 mean the most recent zoom was a zoom out.\n   * Scales above 1.0 mean the most recent zoom was a zoom in.\n   */\n  private previousScale = 0;\n\n  /** The starting distance between two touch points. */\n  private startDistance = 0;\n\n  /** Boolean for whether or not the workspace supports pinch-zoom. */\n  private isPinchZoomEnabled: boolean | null = null;\n\n  /**\n   * The owner of the dropdownDiv when this gesture first starts.\n   * Needed because we'll close the dropdown before fields get to\n   * act on their events, and some fields care about who owns\n   * the dropdown.\n   */\n  currentDropdownOwner: Field | null = null;\n\n  /**\n   * @param e The event that kicked off this gesture.\n   * @param creatorWorkspace The workspace that created this gesture and has a\n   *     reference to it.\n   */\n  constructor(\n    e: PointerEvent,\n    private readonly creatorWorkspace: WorkspaceSvg,\n  ) {\n    this.mostRecentEvent = e;\n\n    /**\n     * How far the pointer has moved during this drag, in pixel units.\n     * (0, 0) is at this.mouseDownXY_.\n     */\n    this.currentDragDeltaXY = new Coordinate(0, 0);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    Touch.clearTouchIdentifier();\n    Tooltip.unblock();\n    // Clear the owner's reference to this gesture.\n    this.creatorWorkspace.clearGesture();\n\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n\n    if (this.workspaceDragger) {\n      this.workspaceDragger.dispose();\n    }\n  }\n\n  /**\n   * Update internal state based on an event.\n   *\n   * @param e The most recent pointer event.\n   */\n  private updateFromEvent(e: PointerEvent) {\n    const currentXY = new Coordinate(e.clientX, e.clientY);\n    const changed = this.updateDragDelta(currentXY);\n    // Exceeded the drag radius for the first time.\n    if (changed) {\n      this.updateIsDragging(e);\n      Touch.longStop();\n    }\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * DO MATH to set currentDragDeltaXY_ based on the most recent pointer\n   * position.\n   *\n   * @param currentXY The most recent pointer position, in pixel units,\n   *     with (0, 0) at the window's top left corner.\n   * @returns True if the drag just exceeded the drag radius for the first time.\n   */\n  private updateDragDelta(currentXY: Coordinate): boolean {\n    this.currentDragDeltaXY = Coordinate.difference(\n      currentXY,\n      this.mouseDownXY,\n    );\n\n    if (!this.hasExceededDragRadius) {\n      const currentDragDelta = Coordinate.magnitude(this.currentDragDeltaXY);\n\n      // The flyout has a different drag radius from the rest of Blockly.\n      const limitRadius = this.flyout\n        ? config.flyoutDragRadius\n        : config.dragRadius;\n\n      this.hasExceededDragRadius = currentDragDelta > limitRadius;\n      return this.hasExceededDragRadius;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a block is being dragged from the\n   * flyout.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged from the flyout this function creates\n   * the new block on the main workspace and updates targetBlock_ and\n   * startWorkspace_.\n   *\n   * @returns True if a block is being dragged from the flyout.\n   */\n  private updateIsDraggingFromFlyout(): boolean {\n    if (!this.targetBlock || !this.flyout?.isBlockCreatable(this.targetBlock)) {\n      return false;\n    }\n    if (!this.flyout.targetWorkspace) {\n      throw new Error(`Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined`);\n    }\n    if (\n      !this.flyout.isScrollable() ||\n      this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)\n    ) {\n      this.startWorkspace_ = this.flyout.targetWorkspace;\n      this.startWorkspace_.updateScreenCalculationsIfScrolled();\n      // Start the event group now, so that the same event group is used for\n      // block creation and block dragging.\n      if (!eventUtils.getGroup()) {\n        eventUtils.setGroup(true);\n      }\n      // The start block is no longer relevant, because this is a drag.\n      this.startBlock = null;\n      this.targetBlock = this.flyout.createBlock(this.targetBlock);\n      common.setSelected(this.targetBlock);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Check whether to start a workspace drag. If a workspace is being dragged,\n   * create the necessary WorkspaceDragger and start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a workspace is being dragged this function creates the\n   * necessary WorkspaceDragger and starts the drag.\n   */\n  private updateIsDraggingWorkspace() {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot update dragging the workspace because the ' +\n          'start workspace is undefined',\n      );\n    }\n\n    const wsMovable = this.flyout\n      ? this.flyout.isScrollable()\n      : this.startWorkspace_ && this.startWorkspace_.isDraggable();\n    if (!wsMovable) return;\n\n    this.dragging = true;\n    this.workspaceDragger = new WorkspaceDragger(this.startWorkspace_);\n\n    this.workspaceDragger.startDrag();\n  }\n\n  /**\n   * Update this gesture to record whether anything is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture.\n   */\n  private updateIsDragging(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot update dragging because the start workspace is undefined',\n      );\n    }\n\n    if (this.calledUpdateIsDragging) {\n      throw Error('updateIsDragging_ should only be called once per gesture.');\n    }\n    this.calledUpdateIsDragging = true;\n\n    // If we drag a block out of the flyout, it updates `common.getSelected`\n    // to return the new block.\n    if (this.flyout) this.updateIsDraggingFromFlyout();\n\n    const selected = common.getSelected();\n    if (selected && isDraggable(selected) && selected.isMovable()) {\n      this.dragging = true;\n      this.dragger = this.createDragger(selected, this.startWorkspace_);\n      this.dragger.onDragStart(e);\n      this.dragger.onDrag(e, this.currentDragDeltaXY);\n    } else {\n      this.updateIsDraggingWorkspace();\n    }\n  }\n\n  private createDragger(\n    draggable: IDraggable,\n    workspace: WorkspaceSvg,\n  ): IDragger {\n    const DraggerClass = registry.getClassFromOptions(\n      registry.Type.BLOCK_DRAGGER,\n      this.creatorWorkspace.options,\n      true,\n    );\n    return new DraggerClass!(draggable, workspace);\n  }\n\n  /**\n   * Start a gesture: update the workspace to indicate that a gesture is in\n   * progress and bind pointermove and pointerup handlers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  doStart(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot start the touch gesture becauase the start ' +\n          'workspace is undefined',\n      );\n    }\n    this.isPinchZoomEnabled =\n      this.startWorkspace_.options.zoomOptions &&\n      this.startWorkspace_.options.zoomOptions.pinch;\n\n    if (browserEvents.isTargetInput(e)) {\n      this.cancel();\n      return;\n    }\n\n    this.gestureHasStarted = true;\n\n    blockAnimations.disconnectUiStop();\n\n    this.startWorkspace_.updateScreenCalculationsIfScrolled();\n    if (this.startWorkspace_.isMutator) {\n      // Mutator's coordinate system could be out of date because the bubble was\n      // dragged, the block was moved, the parent workspace zoomed, etc.\n      this.startWorkspace_.resize();\n    }\n\n    // Keep track of which field owns the dropdown before we close it.\n    this.currentDropdownOwner = dropDownDiv.getOwner();\n    // Hide chaff also hides the flyout, so don't do it if the click is in a\n    // flyout.\n    this.startWorkspace_.hideChaff(!!this.flyout);\n\n    this.startWorkspace_.markFocused();\n    this.mostRecentEvent = e;\n\n    Tooltip.block();\n\n    if (browserEvents.isRightButton(e)) {\n      this.handleRightClick(e);\n      return;\n    }\n\n    if (e.type.toLowerCase() === 'pointerdown' && e.pointerType !== 'mouse') {\n      Touch.longStart(e, this);\n    }\n\n    this.mouseDownXY = new Coordinate(e.clientX, e.clientY);\n\n    this.bindMouseEvents(e);\n\n    if (!this.isEnding_) {\n      this.handleTouchStart(e);\n    }\n  }\n\n  /**\n   * Bind gesture events.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  bindMouseEvents(e: PointerEvent) {\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointerdown',\n        null,\n        this.handleStart.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointermove',\n        null,\n        this.handleMove.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointerup',\n        null,\n        this.handleUp.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown event.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleStart(e: PointerEvent) {\n    if (this.isDragging()) {\n      // A drag has already started, so this can no longer be a pinch-zoom.\n      return;\n    }\n    this.handleTouchStart(e);\n\n    if (this.isMultiTouch()) {\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointermove event.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleMove(e: PointerEvent) {\n    if (\n      (this.isDragging() && Touch.shouldHandleEvent(e)) ||\n      !this.isMultiTouch()\n    ) {\n      this.updateFromEvent(e);\n      if (this.workspaceDragger) {\n        this.workspaceDragger.drag(this.currentDragDeltaXY);\n      } else if (this.dragger) {\n        this.dragger.onDrag(this.mostRecentEvent, this.currentDragDeltaXY);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    } else if (this.isMultiTouch()) {\n      this.handleTouchMove(e);\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointerup event.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleUp(e: PointerEvent) {\n    if (!this.isDragging()) {\n      this.handleTouchEnd(e);\n    }\n    if (!this.isMultiTouch() || this.isDragging()) {\n      if (!Touch.shouldHandleEvent(e)) {\n        return;\n      }\n      this.updateFromEvent(e);\n      Touch.longStop();\n\n      if (this.isEnding_) {\n        console.log('Trying to end a gesture recursively.');\n        return;\n      }\n      this.isEnding_ = true;\n      // The ordering of these checks is important: drags have higher priority\n      // than clicks.  Fields and icons have higher priority than blocks; blocks\n      // have higher priority than workspaces. The ordering within drags does\n      // not matter, because the three types of dragging are exclusive.\n      if (this.dragger) {\n        this.dragger.onDragEnd(e, this.currentDragDeltaXY);\n      } else if (this.workspaceDragger) {\n        this.workspaceDragger.endDrag(this.currentDragDeltaXY);\n      } else if (this.isBubbleClick()) {\n        // Do nothing, bubbles don't currently respond to clicks.\n      } else if (this.isCommentClick()) {\n        // Do nothing, comments don't currently respond to clicks.\n      } else if (this.isFieldClick()) {\n        this.doFieldClick();\n      } else if (this.isIconClick()) {\n        this.doIconClick();\n      } else if (this.isBlockClick()) {\n        this.doBlockClick();\n      } else if (this.isWorkspaceClick()) {\n        this.doWorkspaceClick(e);\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    } else {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    }\n  }\n\n  /**\n   * Handle a pointerdown event and keep track of current\n   * pointers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleTouchStart(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // store the pointerId in the current list of pointers\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n    const pointers = Array.from(this.cachedPoints.keys());\n    // If two pointers are down, store info\n    if (pointers.length === 2) {\n      const point0 = this.cachedPoints.get(pointers[0])!;\n      const point1 = this.cachedPoints.get(pointers[1])!;\n      this.startDistance = Coordinate.distance(point0, point1);\n      this.isMultiTouch_ = true;\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a pointermove event and zoom in/out if two pointers\n   * are on the screen.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleTouchMove(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // Update the cache\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n\n    if (this.isPinchZoomEnabled && this.cachedPoints.size === 2) {\n      this.handlePinch(e);\n    } else {\n      this.handleMove(e);\n    }\n  }\n\n  /**\n   * Handle pinch zoom gesture.\n   *\n   * @param e A pointermove event.\n   */\n  private handlePinch(e: PointerEvent) {\n    const pointers = Array.from(this.cachedPoints.keys());\n    // Calculate the distance between the two pointers\n    const point0 = this.cachedPoints.get(pointers[0])!;\n    const point1 = this.cachedPoints.get(pointers[1])!;\n    const moveDistance = Coordinate.distance(point0, point1);\n    const scale = moveDistance / this.startDistance;\n\n    if (this.previousScale > 0 && this.previousScale < Infinity) {\n      const gestureScale = scale - this.previousScale;\n      const delta =\n        gestureScale > 0\n          ? gestureScale * ZOOM_IN_MULTIPLIER\n          : gestureScale * ZOOM_OUT_MULTIPLIER;\n      if (!this.startWorkspace_) {\n        throw new Error(\n          'Cannot handle a pinch because the start workspace ' + 'is undefined',\n        );\n      }\n      const workspace = this.startWorkspace_;\n      const position = browserEvents.mouseToSvg(\n        e,\n        workspace.getParentSvg(),\n        workspace.getInverseScreenCTM(),\n      );\n      workspace.zoom(position.x, position.y, delta);\n    }\n    this.previousScale = scale;\n    e.preventDefault();\n  }\n\n  /**\n   * Handle a pointerup event and end the gesture.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleTouchEnd(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    if (this.cachedPoints.has(pointerId)) {\n      this.cachedPoints.delete(pointerId);\n    }\n    if (this.cachedPoints.size < 2) {\n      this.cachedPoints.clear();\n      this.previousScale = 0;\n    }\n  }\n\n  /**\n   * Helper function returning the current touch point coordinate.\n   *\n   * @param e A pointer event.\n   * @returns The current touch point coordinate\n   * @internal\n   */\n  getTouchPoint(e: PointerEvent): Coordinate | null {\n    if (!this.startWorkspace_) {\n      return null;\n    }\n    return new Coordinate(e.pageX, e.pageY);\n  }\n\n  /**\n   * Whether this gesture is part of a multi-touch gesture.\n   *\n   * @returns Whether this gesture is part of a multi-touch gesture.\n   * @internal\n   */\n  isMultiTouch(): boolean {\n    return this.isMultiTouch_;\n  }\n\n  /**\n   * Cancel an in-progress gesture.  If a workspace or block drag is in\n   * progress, end the drag at the most recent location.\n   *\n   * @internal\n   */\n  cancel() {\n    // Disposing of a block cancels in-progress drags, but dragging to a delete\n    // area disposes of a block and leads to recursive disposal. Break that\n    // cycle.\n    if (this.isEnding_) {\n      return;\n    }\n    Touch.longStop();\n    if (this.dragger) {\n      this.dragger.onDragEnd(this.mostRecentEvent, this.currentDragDeltaXY);\n    } else if (this.workspaceDragger) {\n      this.workspaceDragger.endDrag(this.currentDragDeltaXY);\n    }\n    this.dispose();\n  }\n\n  /**\n   * Handle a real or faked right-click event by showing a context menu.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleRightClick(e: PointerEvent) {\n    if (this.targetBlock) {\n      this.bringBlockToFront();\n      this.targetBlock.workspace.hideChaff(!!this.flyout);\n      this.targetBlock.showContextMenu(e);\n    } else if (this.startBubble) {\n      this.startBubble.showContextMenu(e);\n    } else if (this.startComment) {\n      this.startComment.workspace.hideChaff();\n      this.startComment.showContextMenu(e);\n    } else if (this.startWorkspace_ && !this.flyout) {\n      this.startWorkspace_.hideChaff();\n      this.startWorkspace_.showContextMenu(e);\n    }\n\n    // TODO: Handle right-click on a bubble.\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.dispose();\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace.\n   *\n   * @param e A pointerdown event.\n   * @param ws The workspace the event hit.\n   * @internal\n   */\n  handleWsStart(e: PointerEvent, ws: WorkspaceSvg) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleWsStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartWorkspace(ws);\n    this.mostRecentEvent = e;\n\n    if (!this.startBlock && !this.startBubble && !this.startComment) {\n      // Selection determines what things start drags. So to drag the workspace,\n      // we need to deselect anything that was previously selected.\n      common.setSelected(null);\n    }\n\n    this.doStart(e);\n  }\n\n  /**\n   * Fires a workspace click event.\n   *\n   * @param ws The workspace that a user clicks on.\n   */\n  private fireWorkspaceClick(ws: WorkspaceSvg) {\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.CLICK))(null, ws.id, 'workspace'),\n    );\n  }\n\n  /**\n   * Handle a pointerdown event on a flyout.\n   *\n   * @param e A pointerdown event.\n   * @param flyout The flyout the event hit.\n   * @internal\n   */\n  handleFlyoutStart(e: PointerEvent, flyout: IFlyout) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleFlyoutStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartFlyout(flyout);\n    this.handleWsStart(e, flyout.getWorkspace());\n  }\n\n  /**\n   * Handle a pointerdown event on a block.\n   *\n   * @param e A pointerdown event.\n   * @param block The block the event hit.\n   * @internal\n   */\n  handleBlockStart(e: PointerEvent, block: BlockSvg) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleBlockStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartBlock(block);\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a bubble.\n   *\n   * @param e A pointerdown event.\n   * @param bubble The bubble the event hit.\n   * @internal\n   */\n  handleBubbleStart(e: PointerEvent, bubble: IBubble) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleBubbleStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartBubble(bubble);\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace comment.\n   *\n   * @param e A pointerdown event.\n   * @param comment The comment the event hit.\n   * @internal\n   */\n  handleCommentStart(e: PointerEvent, comment: RenderedWorkspaceComment) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleCommentStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartComment(comment);\n    this.mostRecentEvent = e;\n  }\n\n  /* Begin functions defining what actions to take to execute clicks on each\n   * type of target.  Any developer wanting to add behaviour on clicks should\n   * modify only this code. */\n\n  /** Execute a field click. */\n  private doFieldClick() {\n    if (!this.startField) {\n      throw new Error(\n        'Cannot do a field click because the start field is undefined',\n      );\n    }\n\n    // Only show the editor if the field's editor wasn't already open\n    // right before this gesture started.\n    const dropdownAlreadyOpen = this.currentDropdownOwner === this.startField;\n    if (!dropdownAlreadyOpen) {\n      this.startField.showEditor(this.mostRecentEvent);\n    }\n    this.bringBlockToFront();\n  }\n\n  /** Execute an icon click. */\n  private doIconClick() {\n    if (!this.startIcon) {\n      throw new Error(\n        'Cannot do an icon click because the start icon is undefined',\n      );\n    }\n    this.bringBlockToFront();\n    this.startIcon.onClick();\n  }\n\n  /** Execute a block click. */\n  private doBlockClick() {\n    // Block click in an autoclosing flyout.\n    if (this.flyout && this.flyout.autoClose) {\n      if (!this.targetBlock) {\n        throw new Error(\n          'Cannot do a block click because the target block is ' + 'undefined',\n        );\n      }\n      if (this.targetBlock.isEnabled()) {\n        if (!eventUtils.getGroup()) {\n          eventUtils.setGroup(true);\n        }\n        const newBlock = this.flyout.createBlock(this.targetBlock);\n        newBlock.snapToGrid();\n        newBlock.bumpNeighbours();\n      }\n    } else {\n      if (!this.startWorkspace_) {\n        throw new Error(\n          'Cannot do a block click because the start workspace ' +\n            'is undefined',\n        );\n      }\n      // Clicks events are on the start block, even if it was a shadow.\n      const event = new (eventUtils.get(eventUtils.CLICK))(\n        this.startBlock,\n        this.startWorkspace_.id,\n        'block',\n      );\n      eventUtils.fire(event);\n    }\n    this.bringBlockToFront();\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Execute a workspace click. When in accessibility mode shift clicking will\n   * move the cursor.\n   *\n   * @param _e A pointerup event.\n   */\n  private doWorkspaceClick(_e: PointerEvent) {\n    const ws = this.creatorWorkspace;\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.fireWorkspaceClick(this.startWorkspace_ || ws);\n  }\n\n  /* End functions defining what actions to take to execute clicks on each type\n   * of target. */\n\n  // TODO (fenichel): Move bubbles to the front.\n\n  /**\n   * Move the dragged/clicked block to the front of the workspace so that it is\n   * not occluded by other blocks.\n   */\n  private bringBlockToFront() {\n    // Blocks in the flyout don't overlap, so skip the work.\n    if (this.targetBlock && !this.flyout) {\n      this.targetBlock.bringToFront();\n    }\n  }\n\n  /* Begin functions for populating a gesture at pointerdown. */\n\n  /**\n   * Record the field that a gesture started on.\n   *\n   * @param field The field the gesture started on.\n   * @internal\n   */\n  setStartField<T>(field: Field<T>) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.setStartField, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    if (!this.startField) {\n      this.startField = field as Field;\n    }\n  }\n\n  /**\n   * Record the icon that a gesture started on.\n   *\n   * @param icon The icon the gesture started on.\n   * @internal\n   */\n  setStartIcon(icon: IIcon) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.setStartIcon, ' +\n          'but the gesture had already been started.',\n      );\n    }\n\n    if (!this.startIcon) this.startIcon = icon;\n  }\n\n  /**\n   * Record the bubble that a gesture started on\n   *\n   * @param bubble The bubble the gesture started on.\n   * @internal\n   */\n  setStartBubble(bubble: IBubble) {\n    if (!this.startBubble) {\n      this.startBubble = bubble;\n    }\n  }\n\n  /**\n   * Record the comment that a gesture started on\n   *\n   * @param comment The comment the gesture started on.\n   * @internal\n   */\n  setStartComment(comment: RenderedWorkspaceComment) {\n    if (!this.startComment) {\n      this.startComment = comment;\n    }\n  }\n\n  /**\n   * Record the block that a gesture started on, and set the target block\n   * appropriately.\n   *\n   * @param block The block the gesture started on.\n   * @internal\n   */\n  setStartBlock(block: BlockSvg) {\n    // If the gesture already went through a bubble, don't set the start block.\n    if (!this.startBlock && !this.startBubble) {\n      this.startBlock = block;\n      common.setSelected(this.startBlock);\n      if (block.isInFlyout && block !== block.getRootBlock()) {\n        this.setTargetBlock(block.getRootBlock());\n      } else {\n        this.setTargetBlock(block);\n      }\n    }\n  }\n\n  /**\n   * Record the block that a gesture targets, meaning the block that will be\n   * dragged if this turns into a drag.  If this block is a shadow, that will be\n   * its first non-shadow parent.\n   *\n   * @param block The block the gesture targets.\n   */\n  private setTargetBlock(block: BlockSvg) {\n    if (block.isShadow()) {\n      // Non-null assertion is fine b/c it is an invariant that shadows always\n      // have parents.\n      this.setTargetBlock(block.getParent()!);\n    } else {\n      this.targetBlock = block;\n    }\n  }\n\n  /**\n   * Record the workspace that a gesture started on.\n   *\n   * @param ws The workspace the gesture started on.\n   */\n  private setStartWorkspace(ws: WorkspaceSvg) {\n    if (!this.startWorkspace_) {\n      this.startWorkspace_ = ws;\n    }\n  }\n\n  /**\n   * Record the flyout that a gesture started on.\n   *\n   * @param flyout The flyout the gesture started on.\n   */\n  private setStartFlyout(flyout: IFlyout) {\n    if (!this.flyout) {\n      this.flyout = flyout;\n    }\n  }\n\n  /* End functions for populating a gesture at pointerdown. */\n\n  /* Begin helper functions defining types of clicks.  Any developer wanting\n   * to change the definition of a click should modify only this code. */\n\n  /**\n   * Whether this gesture is a click on a bubble.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a bubble.\n   */\n  private isBubbleClick(): boolean {\n    // A bubble click starts on a bubble and never escapes the drag radius.\n    const hasStartBubble = !!this.startBubble;\n    return hasStartBubble && !this.hasExceededDragRadius;\n  }\n\n  private isCommentClick(): boolean {\n    return !!this.startComment && !this.hasExceededDragRadius;\n  }\n\n  /**\n   * Whether this gesture is a click on a block.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a block.\n   */\n  private isBlockClick(): boolean {\n    // A block click starts on a block, never escapes the drag radius, and is\n    // not a field click.\n    const hasStartBlock = !!this.startBlock;\n    return (\n      hasStartBlock &&\n      !this.hasExceededDragRadius &&\n      !this.isFieldClick() &&\n      !this.isIconClick()\n    );\n  }\n\n  /**\n   * Whether this gesture is a click on a field that should be handled.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a field.\n   */\n  private isFieldClick(): boolean {\n    if (!this.startField) return false;\n    return (\n      this.startField.isClickable() &&\n      !this.hasExceededDragRadius &&\n      (!this.flyout ||\n        this.startField.isClickableInFlyout(this.flyout.autoClose))\n    );\n  }\n\n  /** @returns Whether this gesture is a click on an icon that should be handled. */\n  private isIconClick(): boolean {\n    if (!this.startIcon) return false;\n    const handleInFlyout =\n      !this.flyout ||\n      !this.startIcon.isClickableInFlyout ||\n      this.startIcon.isClickableInFlyout(this.flyout.autoClose);\n    return !this.hasExceededDragRadius && handleInFlyout;\n  }\n\n  /**\n   * Whether this gesture is a click on a workspace.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   */\n  private isWorkspaceClick(): boolean {\n    const onlyTouchedWorkspace =\n      !this.startBlock && !this.startBubble && !this.startField;\n    return onlyTouchedWorkspace && !this.hasExceededDragRadius;\n  }\n\n  /* End helper functions defining types of clicks. */\n\n  /** Returns the current dragger if the gesture is a drag. */\n  getCurrentDragger(): WorkspaceDragger | IDragger | null {\n    return this.workspaceDragger ?? this.dragger ?? null;\n  }\n\n  /**\n   * Whether this gesture is a drag of either a workspace or block.\n   * This function is called externally to block actions that cannot be taken\n   * mid-drag (e.g. using the keyboard to delete the selected blocks).\n   *\n   * @returns True if this gesture is a drag of a workspace or block.\n   * @internal\n   */\n  isDragging(): boolean {\n    return this.dragging;\n  }\n\n  /**\n   * Whether this gesture has already been started.  In theory every pointerdown\n   * has a corresponding pointerup, but in reality it is possible to lose a\n   * pointerup, leaving an in-process gesture hanging.\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   * @internal\n   */\n  hasStarted(): boolean {\n    return this.gestureHasStarted;\n  }\n\n  /**\n   * Is a drag or other gesture currently in progress on any workspace?\n   *\n   * @returns True if gesture is occurring.\n   */\n  static inProgress(): boolean {\n    const workspaces = common.getAllWorkspaces();\n    for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\n      // Not actually necessarily a WorkspaceSvg, but it doesn't matter b/c\n      // we're just checking if the property exists. Theoretically we would\n      // want to use instanceof, but that causes a circular dependency.\n      if ((workspace as WorkspaceSvg).currentGesture_) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object for configuring and updating a workspace grid in\n * Blockly.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Grid\n\nimport * as dom from './utils/dom.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {Svg} from './utils/svg.js';\nimport {GridOptions} from './options.js';\n\n/**\n * Class for a workspace's grid.\n */\nexport class Grid {\n  private spacing: number;\n  private length: number;\n  private scale: number = 1;\n  private readonly line1: SVGElement;\n  private readonly line2: SVGElement;\n  private snapToGrid: boolean;\n\n  /**\n   * @param pattern The grid's SVG pattern, created during injection.\n   * @param options A dictionary of normalized options for the grid.\n   *     See grid documentation:\n   *     https://developers.google.com/blockly/guides/configure/web/grid\n   */\n  constructor(\n    private pattern: SVGElement,\n    options: GridOptions,\n  ) {\n    /** The spacing of the grid lines (in px). */\n    this.spacing = options['spacing'] ?? 0;\n\n    /** How long the grid lines should be (in px). */\n    this.length = options['length'] ?? 1;\n\n    /** The horizontal grid line, if it exists. */\n    this.line1 = pattern.firstChild as SVGElement;\n\n    /** The vertical grid line, if it exists. */\n    this.line2 = this.line1 && (this.line1.nextSibling as SVGElement);\n\n    /** Whether blocks should snap to the grid. */\n    this.snapToGrid = options['snap'] ?? false;\n  }\n\n  /**\n   * Sets the spacing between the centers of the grid lines.\n   *\n   * This does not trigger snapping to the newly spaced grid. If you want to\n   * snap blocks to the grid programmatically that needs to be triggered\n   * on individual top-level blocks. The next time a block is dragged and\n   * dropped it will snap to the grid if snapping to the grid is enabled.\n   */\n  setSpacing(spacing: number) {\n    this.spacing = spacing;\n    this.update(this.scale);\n  }\n\n  /**\n   * Get the spacing of the grid points (in px).\n   *\n   * @returns The spacing of the grid points.\n   */\n  getSpacing(): number {\n    return this.spacing;\n  }\n\n  /** Sets the length of the grid lines. */\n  setLength(length: number) {\n    this.length = length;\n    this.update(this.scale);\n  }\n\n  /** Get the length of the grid lines (in px). */\n  getLength(): number {\n    return this.length;\n  }\n\n  /**\n   * Sets whether blocks should snap to the grid or not.\n   *\n   * Setting this to true does not trigger snapping. If you want to snap blocks\n   * to the grid programmatically that needs to be triggered on individual\n   * top-level blocks. The next time a block is dragged and dropped it will\n   * snap to the grid.\n   */\n  setSnapToGrid(snap: boolean) {\n    this.snapToGrid = snap;\n  }\n\n  /**\n   * Whether blocks should snap to the grid.\n   *\n   * @returns True if blocks should snap, false otherwise.\n   */\n  shouldSnap(): boolean {\n    return this.snapToGrid;\n  }\n\n  /**\n   * Get the ID of the pattern element, which should be randomized to avoid\n   * conflicts with other Blockly instances on the page.\n   *\n   * @returns The pattern ID.\n   * @internal\n   */\n  getPatternId(): string {\n    return this.pattern.id;\n  }\n\n  /**\n   * Update the grid with a new scale.\n   *\n   * @param scale The new workspace scale.\n   * @internal\n   */\n  update(scale: number) {\n    this.scale = scale;\n    const safeSpacing = this.spacing * scale;\n\n    this.pattern.setAttribute('width', `${safeSpacing}`);\n    this.pattern.setAttribute('height', `${safeSpacing}`);\n\n    let half = Math.floor(this.spacing / 2) + 0.5;\n    let start = half - this.length / 2;\n    let end = half + this.length / 2;\n\n    half *= scale;\n    start *= scale;\n    end *= scale;\n\n    this.setLineAttributes(this.line1, scale, start, end, half, half);\n    this.setLineAttributes(this.line2, scale, half, half, start, end);\n  }\n\n  /**\n   * Set the attributes on one of the lines in the grid.  Use this to update the\n   * length and stroke width of the grid lines.\n   *\n   * @param line Which line to update.\n   * @param width The new stroke size (in px).\n   * @param x1 The new x start position of the line (in px).\n   * @param x2 The new x end position of the line (in px).\n   * @param y1 The new y start position of the line (in px).\n   * @param y2 The new y end position of the line (in px).\n   */\n  private setLineAttributes(\n    line: SVGElement,\n    width: number,\n    x1: number,\n    x2: number,\n    y1: number,\n    y2: number,\n  ) {\n    if (line) {\n      line.setAttribute('stroke-width', `${width}`);\n      line.setAttribute('x1', `${x1}`);\n      line.setAttribute('y1', `${y1}`);\n      line.setAttribute('x2', `${x2}`);\n      line.setAttribute('y2', `${y2}`);\n    }\n  }\n\n  /**\n   * Move the grid to a new x and y position, and make sure that change is\n   * visible.\n   *\n   * @param x The new x position of the grid (in px).\n   * @param y The new y position of the grid (in px).\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.pattern.setAttribute('x', `${x}`);\n    this.pattern.setAttribute('y', `${y}`);\n  }\n\n  /**\n   * Given a coordinate, return the nearest coordinate aligned to the grid.\n   *\n   * @param xy A workspace coordinate.\n   * @returns Workspace coordinate of nearest grid point.\n   *   If there's no change, return the same coordinate object.\n   */\n  alignXY(xy: Coordinate): Coordinate {\n    const spacing = this.getSpacing();\n    const half = spacing / 2;\n    const x = Math.round(Math.round((xy.x - half) / spacing) * spacing + half);\n    const y = Math.round(Math.round((xy.y - half) / spacing) * spacing + half);\n    if (x === xy.x && y === xy.y) {\n      // No change.\n      return xy;\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Create the DOM for the grid described by options.\n   *\n   * @param rnd A random ID to append to the pattern's ID.\n   * @param gridOptions The object containing grid configuration.\n   * @param defs The root SVG element for this workspace's defs.\n   * @returns The SVG element for the grid pattern.\n   * @internal\n   */\n  static createDom(\n    rnd: string,\n    gridOptions: GridOptions,\n    defs: SVGElement,\n  ): SVGElement {\n    /*\n          <pattern id=\"blocklyGridPattern837493\" patternUnits=\"userSpaceOnUse\">\n            <rect stroke=\"#888\" />\n            <rect stroke=\"#888\" />\n          </pattern>\n        */\n    const gridPattern = dom.createSvgElement(\n      Svg.PATTERN,\n      {'id': 'blocklyGridPattern' + rnd, 'patternUnits': 'userSpaceOnUse'},\n      defs,\n    );\n    // x1, y1, x1, x2 properties will be set later in update.\n    if ((gridOptions['length'] ?? 1) > 0 && (gridOptions['spacing'] ?? 0) > 0) {\n      dom.createSvgElement(\n        Svg.LINE,\n        {'stroke': gridOptions['colour']},\n        gridPattern,\n      );\n      if (gridOptions['length'] ?? 1 > 1) {\n        dom.createSvgElement(\n          Svg.LINE,\n          {'stroke': gridOptions['colour']},\n          gridPattern,\n        );\n      }\n    } else {\n      // Edge 16 doesn't handle empty patterns\n      dom.createSvgElement(Svg.LINE, {}, gridPattern);\n    }\n    return gridPattern;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a theme.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Theme\n\nimport * as registry from './registry.js';\nimport * as object from './utils/object.js';\n\nexport interface ITheme {\n  blockStyles?: {[key: string]: Partial<BlockStyle>};\n  categoryStyles?: {[key: string]: CategoryStyle};\n  componentStyles?: ComponentStyle;\n  fontStyle?: FontStyle;\n  startHats?: boolean;\n  base?: string | Theme;\n  name: string;\n}\n\n/**\n * Class for a theme.\n */\nexport class Theme implements ITheme {\n  /** @internal */\n  blockStyles: {[key: string]: BlockStyle};\n  /** @internal */\n  categoryStyles: {[key: string]: CategoryStyle};\n  /** @internal */\n  componentStyles: ComponentStyle;\n  /** @internal */\n  fontStyle: FontStyle;\n\n  /**\n   * Whether or not to add a 'hat' on top of all blocks with no previous or\n   * output connections.\n   *\n   * @internal\n   */\n  startHats?: boolean = false;\n\n  /**\n   * @param name Theme name.\n   * @param opt_blockStyles A map from style names (strings) to objects with\n   *     style attributes for blocks.\n   * @param opt_categoryStyles A map from style names (strings) to objects with\n   *     style attributes for categories.\n   * @param opt_componentStyles A map of Blockly component names to style value.\n   */\n  constructor(\n    public name: string,\n    opt_blockStyles?: {[key: string]: Partial<BlockStyle>},\n    opt_categoryStyles?: {[key: string]: CategoryStyle},\n    opt_componentStyles?: ComponentStyle,\n  ) {\n    /** The block styles map. */\n    this.blockStyles = opt_blockStyles || Object.create(null);\n\n    /** The category styles map. */\n    this.categoryStyles = opt_categoryStyles || Object.create(null);\n\n    /** The UI components styles map. */\n    this.componentStyles =\n      opt_componentStyles || (Object.create(null) as ComponentStyle);\n\n    /** The font style. */\n    this.fontStyle = Object.create(null) as FontStyle;\n\n    // Register the theme by name.\n    registry.register(registry.Type.THEME, name, this, true);\n  }\n\n  /**\n   * Gets the class name that identifies this theme.\n   *\n   * @returns The CSS class name.\n   * @internal\n   */\n  getClassName(): string {\n    return this.name + '-theme';\n  }\n\n  /**\n   * Overrides or adds a style to the blockStyles map.\n   *\n   * @param blockStyleName The name of the block style.\n   * @param blockStyle The block style.\n   */\n  setBlockStyle(blockStyleName: string, blockStyle: BlockStyle) {\n    this.blockStyles[blockStyleName] = blockStyle;\n  }\n\n  /**\n   * Overrides or adds a style to the categoryStyles map.\n   *\n   * @param categoryStyleName The name of the category style.\n   * @param categoryStyle The category style.\n   */\n  setCategoryStyle(categoryStyleName: string, categoryStyle: CategoryStyle) {\n    this.categoryStyles[categoryStyleName] = categoryStyle;\n  }\n\n  /**\n   * Gets the style for a given Blockly UI component.  If the style value is a\n   * string, we attempt to find the value of any named references.\n   *\n   * @param componentName The name of the component.\n   * @returns The style value.\n   */\n  getComponentStyle(componentName: string): string | null {\n    const style = (this.componentStyles as AnyDuringMigration)[componentName];\n    if (!style) {\n      return null;\n    }\n    if (typeof style === 'string') {\n      const recursiveStyle = this.getComponentStyle(style);\n      if (recursiveStyle) {\n        return recursiveStyle;\n      }\n    }\n    return `${style}`;\n  }\n\n  /**\n   * Configure a specific Blockly UI component with a style value.\n   *\n   * @param componentName The name of the component.\n   * @param styleValue The style value.\n   */\n  setComponentStyle(componentName: string, styleValue: AnyDuringMigration) {\n    (this.componentStyles as AnyDuringMigration)[componentName] = styleValue;\n  }\n\n  /**\n   * Configure a theme's font style.\n   *\n   * @param fontStyle The font style.\n   */\n  setFontStyle(fontStyle: FontStyle) {\n    this.fontStyle = fontStyle;\n  }\n\n  /**\n   * Configure a theme's start hats.\n   *\n   * @param startHats True if the theme enables start hats, false otherwise.\n   */\n  setStartHats(startHats: boolean) {\n    this.startHats = startHats;\n  }\n\n  /**\n   * Define a new Blockly theme.\n   *\n   * @param name The name of the theme.\n   * @param themeObj An object containing theme properties.\n   * @returns A new Blockly theme.\n   */\n  static defineTheme(name: string, themeObj: ITheme): Theme {\n    name = name.toLowerCase();\n    const theme = new Theme(name);\n    let base = themeObj['base'];\n    if (base) {\n      if (typeof base === 'string') {\n        base = registry.getObject(registry.Type.THEME, base) ?? undefined;\n      }\n      if (base instanceof Theme) {\n        object.deepMerge(theme, base);\n        theme.name = name;\n      }\n    }\n\n    object.deepMerge(theme.blockStyles, themeObj['blockStyles']);\n    object.deepMerge(theme.categoryStyles, themeObj['categoryStyles']);\n    object.deepMerge(theme.componentStyles, themeObj['componentStyles']);\n    object.deepMerge(theme.fontStyle, themeObj['fontStyle']);\n    if (themeObj['startHats'] !== null) {\n      theme.startHats = themeObj['startHats'];\n    }\n\n    return theme;\n  }\n}\n\nexport namespace Theme {\n  export interface BlockStyle {\n    colourPrimary: string;\n    colourSecondary: string;\n    colourTertiary: string;\n    hat: string;\n  }\n\n  export interface CategoryStyle {\n    colour: string;\n  }\n\n  export interface ComponentStyle {\n    workspaceBackgroundColour?: string;\n    toolboxBackgroundColour?: string;\n    toolboxForegroundColour?: string;\n    flyoutBackgroundColour?: string;\n    flyoutForegroundColour?: string;\n    flyoutOpacity?: number;\n    scrollbarColour?: string;\n    scrollbarOpacity?: number;\n    insertionMarkerColour?: string;\n    insertionMarkerOpacity?: number;\n    markerColour?: string;\n    cursorColour?: string;\n    selectedGlowColour?: string;\n    selectedGlowOpacity?: number;\n    replacementGlowColour?: string;\n    replacementGlowOpacity?: number;\n  }\n\n  export interface FontStyle {\n    family?: string;\n    weight?: string;\n    size?: number;\n  }\n}\n\nexport type BlockStyle = Theme.BlockStyle;\nexport type CategoryStyle = Theme.CategoryStyle;\nexport type ComponentStyle = Theme.ComponentStyle;\nexport type FontStyle = Theme.FontStyle;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes.Classic\n\nimport {Theme} from '../theme.js';\n\nconst defaultBlockStyles = {\n  'colour_blocks': {'colourPrimary': '20'},\n  'list_blocks': {'colourPrimary': '260'},\n  'logic_blocks': {'colourPrimary': '210'},\n  'loop_blocks': {'colourPrimary': '120'},\n  'math_blocks': {'colourPrimary': '230'},\n  'procedure_blocks': {'colourPrimary': '290'},\n  'text_blocks': {'colourPrimary': '160'},\n  'variable_blocks': {'colourPrimary': '330'},\n  'variable_dynamic_blocks': {'colourPrimary': '310'},\n  'hat_blocks': {'colourPrimary': '330', 'hat': 'cap'},\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '20'},\n  'list_category': {'colour': '260'},\n  'logic_category': {'colour': '210'},\n  'loop_category': {'colour': '120'},\n  'math_category': {'colour': '230'},\n  'procedure_category': {'colour': '290'},\n  'text_category': {'colour': '160'},\n  'variable_category': {'colour': '330'},\n  'variable_dynamic_category': {'colour': '310'},\n};\n\n/**\n * Classic theme.\n * Contains multi-coloured border to create shadow effect.\n */\nexport const Classic = new Theme('classic', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object that controls settings for the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Options\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as registry from './registry.js';\nimport {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Parse the user-specified options, using reasonable defaults where behaviour\n * is unspecified.\n */\nexport class Options {\n  RTL: boolean;\n  oneBasedIndex: boolean;\n  collapse: boolean;\n  comments: boolean;\n  disable: boolean;\n  readOnly: boolean;\n  maxBlocks: number;\n  maxInstances: {[key: string]: number} | null;\n  modalInputs: boolean;\n  pathToMedia: string;\n  hasCategories: boolean;\n  moveOptions: MoveOptions;\n  /** @deprecated  January 2019 */\n  hasScrollbars: boolean;\n  hasTrashcan: boolean;\n  maxTrashcanContents: number;\n  hasSounds: boolean;\n  hasCss: boolean;\n  horizontalLayout: boolean;\n  languageTree: toolbox.ToolboxInfo | null;\n  gridOptions: GridOptions;\n  zoomOptions: ZoomOptions;\n  toolboxPosition: toolbox.Position;\n  theme: Theme;\n  renderer: string;\n  rendererOverrides: {[rendererConstant: string]: any} | null;\n\n  /**\n   * The SVG element for the grid pattern.\n   * Created during injection.\n   */\n  gridPattern: SVGElement | null = null;\n  parentWorkspace: WorkspaceSvg | null;\n  plugins: {[key: string]: (new (...p1: any[]) => any) | string};\n\n  /**\n   * If set, sets the translation of the workspace to match the scrollbars.\n   * A function that\n   *     sets the translation of the workspace to match the scrollbars. The\n   *     argument Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  setMetrics?: (p1: {x?: number; y?: number}) => void = undefined;\n\n  /**\n   * A function that returns a metrics\n   *     object that describes the current workspace.\n   */\n  getMetrics?: () => Metrics = undefined;\n\n  /**\n   * @param options Dictionary of options.\n   *     Specification:\n   * https://developers.google.com/blockly/guides/get-started/web#configuration\n   */\n  constructor(options: BlocklyOptions) {\n    let toolboxJsonDef = null;\n    let hasCategories = false;\n    let hasTrashcan = false;\n    let hasCollapse = false;\n    let hasComments = false;\n    let hasDisable = false;\n    let hasSounds = false;\n    const readOnly = !!options['readOnly'];\n    if (!readOnly) {\n      toolboxJsonDef = toolbox.convertToolboxDefToJson(\n        options['toolbox'] ?? null,\n      );\n      hasCategories = toolbox.hasCategories(toolboxJsonDef);\n      const rawHasTrashcan = options['trashcan'];\n      hasTrashcan =\n        rawHasTrashcan === undefined ? hasCategories : rawHasTrashcan;\n      const rawHasCollapse = options['collapse'];\n      hasCollapse =\n        rawHasCollapse === undefined ? hasCategories : rawHasCollapse;\n      const rawHasComments = options['comments'];\n      hasComments =\n        rawHasComments === undefined ? hasCategories : rawHasComments;\n      const rawHasDisable = options['disable'];\n      hasDisable = rawHasDisable === undefined ? hasCategories : rawHasDisable;\n      const rawHasSounds = options['sounds'];\n      hasSounds = rawHasSounds === undefined ? true : rawHasSounds;\n    }\n\n    let maxTrashcanContents = options['maxTrashcanContents'];\n    if (hasTrashcan) {\n      if (maxTrashcanContents === undefined) {\n        maxTrashcanContents = 32;\n      }\n    } else {\n      maxTrashcanContents = 0;\n    }\n    const rtl = !!options['rtl'];\n    let horizontalLayout = options['horizontalLayout'];\n    if (horizontalLayout === undefined) {\n      horizontalLayout = false;\n    }\n    const toolboxAtStart = options['toolboxPosition'] !== 'end';\n\n    let toolboxPosition: toolbox.Position;\n    if (horizontalLayout) {\n      toolboxPosition = toolboxAtStart\n        ? toolbox.Position.TOP\n        : toolbox.Position.BOTTOM;\n    } else {\n      toolboxPosition =\n        toolboxAtStart === rtl ? toolbox.Position.RIGHT : toolbox.Position.LEFT;\n    }\n\n    let hasCss = options['css'];\n    if (hasCss === undefined) {\n      hasCss = true;\n    }\n    let pathToMedia = 'https://blockly-demo.appspot.com/static/media/';\n    if (options['media']) {\n      pathToMedia = options['media'].endsWith('/')\n        ? options['media']\n        : options['media'] + '/';\n    }\n    const rawOneBasedIndex = options['oneBasedIndex'];\n    const oneBasedIndex =\n      rawOneBasedIndex === undefined ? true : rawOneBasedIndex;\n    const renderer = options['renderer'] || 'geras';\n\n    const plugins = options['plugins'] || {};\n\n    let modalInputs = options['modalInputs'];\n    if (modalInputs === undefined) {\n      modalInputs = true;\n    }\n\n    this.RTL = rtl;\n    this.oneBasedIndex = oneBasedIndex;\n    this.collapse = hasCollapse;\n    this.comments = hasComments;\n    this.disable = hasDisable;\n    this.readOnly = readOnly;\n    this.maxBlocks = options['maxBlocks'] || Infinity;\n    this.maxInstances = options['maxInstances'] ?? null;\n    this.modalInputs = modalInputs;\n    this.pathToMedia = pathToMedia;\n    this.hasCategories = hasCategories;\n    this.moveOptions = Options.parseMoveOptions_(options, hasCategories);\n    this.hasScrollbars = !!this.moveOptions.scrollbars;\n    this.hasTrashcan = hasTrashcan;\n    this.maxTrashcanContents = maxTrashcanContents;\n    this.hasSounds = hasSounds;\n    this.hasCss = hasCss;\n    this.horizontalLayout = horizontalLayout;\n    this.languageTree = toolboxJsonDef;\n    this.gridOptions = Options.parseGridOptions_(options);\n    this.zoomOptions = Options.parseZoomOptions_(options);\n    this.toolboxPosition = toolboxPosition;\n    this.theme = Options.parseThemeOptions_(options);\n    this.renderer = renderer;\n    this.rendererOverrides = options['rendererOverrides'] ?? null;\n\n    /**\n     * The parent of the current workspace, or null if there is no parent\n     * workspace.  We can assert that this is of type WorkspaceSvg as opposed to\n     * Workspace as this is only used in a rendered workspace.\n     */\n    this.parentWorkspace = options['parentWorkspace'] ?? null;\n\n    /** Map of plugin type to name of registered plugin or plugin class. */\n    this.plugins = plugins;\n  }\n\n  /**\n   * Parse the user-specified move options, using reasonable defaults where\n   *    behaviour is unspecified.\n   *\n   * @param options Dictionary of options.\n   * @param hasCategories Whether the workspace has categories or not.\n   * @returns Normalized move options.\n   */\n  private static parseMoveOptions_(\n    options: BlocklyOptions,\n    hasCategories: boolean,\n  ): MoveOptions {\n    const move = options['move'] || {};\n    const moveOptions = {} as MoveOptions;\n    if (\n      move['scrollbars'] === undefined &&\n      options['scrollbars'] === undefined\n    ) {\n      moveOptions.scrollbars = hasCategories;\n    } else if (typeof move['scrollbars'] === 'object') {\n      moveOptions.scrollbars = {\n        'horizontal': !!move['scrollbars']['horizontal'],\n        'vertical': !!move['scrollbars']['vertical'],\n      };\n      // Convert scrollbars object to boolean if they have the same value.\n      // This allows us to easily check for whether any scrollbars exist using\n      // !!moveOptions.scrollbars.\n      if (\n        moveOptions.scrollbars.horizontal &&\n        moveOptions.scrollbars.vertical\n      ) {\n        moveOptions.scrollbars = true;\n      } else if (\n        !moveOptions.scrollbars.horizontal &&\n        !moveOptions.scrollbars.vertical\n      ) {\n        moveOptions.scrollbars = false;\n      }\n    } else {\n      moveOptions.scrollbars = !!move['scrollbars'] || !!options['scrollbars'];\n    }\n\n    if (!moveOptions.scrollbars || move['wheel'] === undefined) {\n      // Defaults to true if single-direction scroll is enabled.\n      moveOptions.wheel = typeof moveOptions.scrollbars === 'object';\n    } else {\n      moveOptions.wheel = !!move['wheel'];\n    }\n    if (!moveOptions.scrollbars) {\n      moveOptions.drag = false;\n    } else if (move['drag'] === undefined) {\n      // Defaults to true if scrollbars is true.\n      moveOptions.drag = true;\n    } else {\n      moveOptions.drag = !!move['drag'];\n    }\n    return moveOptions;\n  }\n\n  /**\n   * Parse the user-specified zoom options, using reasonable defaults where\n   * behaviour is unspecified.  See zoom documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/zoom\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized zoom options.\n   */\n  private static parseZoomOptions_(options: BlocklyOptions): ZoomOptions {\n    const zoom = options['zoom'] || {};\n    const zoomOptions = {} as ZoomOptions;\n    if (zoom['controls'] === undefined) {\n      zoomOptions.controls = false;\n    } else {\n      zoomOptions.controls = !!zoom['controls'];\n    }\n    if (zoom['wheel'] === undefined) {\n      zoomOptions.wheel = false;\n    } else {\n      zoomOptions.wheel = !!zoom['wheel'];\n    }\n    if (zoom['startScale'] === undefined) {\n      zoomOptions.startScale = 1;\n    } else {\n      zoomOptions.startScale = Number(zoom['startScale']);\n    }\n    if (zoom['maxScale'] === undefined) {\n      zoomOptions.maxScale = 3;\n    } else {\n      zoomOptions.maxScale = Number(zoom['maxScale']);\n    }\n    if (zoom['minScale'] === undefined) {\n      zoomOptions.minScale = 0.3;\n    } else {\n      zoomOptions.minScale = Number(zoom['minScale']);\n    }\n    if (zoom['scaleSpeed'] === undefined) {\n      zoomOptions.scaleSpeed = 1.2;\n    } else {\n      zoomOptions.scaleSpeed = Number(zoom['scaleSpeed']);\n    }\n    if (zoom['pinch'] === undefined) {\n      zoomOptions.pinch = zoomOptions.wheel || zoomOptions.controls;\n    } else {\n      zoomOptions.pinch = !!zoom['pinch'];\n    }\n    return zoomOptions;\n  }\n\n  /**\n   * Parse the user-specified grid options, using reasonable defaults where\n   * behaviour is unspecified. See grid documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/grid\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized grid options.\n   */\n  private static parseGridOptions_(options: BlocklyOptions): GridOptions {\n    const grid = options['grid'] || {};\n    const gridOptions = {} as GridOptions;\n    gridOptions.spacing = Number(grid['spacing']) || 0;\n    gridOptions.colour = grid['colour'] || '#888';\n    gridOptions.length =\n      grid['length'] === undefined ? 1 : Number(grid['length']);\n    gridOptions.snap = gridOptions.spacing > 0 && !!grid['snap'];\n    return gridOptions;\n  }\n\n  /**\n   * Parse the user-specified theme options, using the classic theme as a\n   * default. https://developers.google.com/blockly/guides/configure/web/themes\n   *\n   * @param options Dictionary of options.\n   * @returns A Blockly Theme.\n   */\n  private static parseThemeOptions_(options: BlocklyOptions): Theme {\n    const theme = options['theme'] || Classic;\n    if (typeof theme === 'string') {\n      return registry.getObject(registry.Type.THEME, theme) as Theme;\n    } else if (theme instanceof Theme) {\n      return theme;\n    }\n    return Theme.defineTheme(\n      theme.name || 'builtin' + idGenerator.getNextUniqueId(),\n      theme,\n    );\n  }\n}\n\nexport namespace Options {\n  export interface GridOptions {\n    colour: string;\n    length: number;\n    snap: boolean;\n    spacing: number;\n  }\n\n  export interface MoveOptions {\n    drag: boolean;\n    scrollbars: boolean | ScrollbarOptions;\n    wheel: boolean;\n  }\n\n  export interface ScrollbarOptions {\n    horizontal: boolean;\n    vertical: boolean;\n  }\n\n  export interface ZoomOptions {\n    controls: boolean;\n    maxScale: number;\n    minScale: number;\n    pinch: boolean;\n    scaleSpeed: number;\n    startScale: number;\n    wheel: boolean;\n  }\n}\n\nexport type GridOptions = Options.GridOptions;\nexport type MoveOptions = Options.MoveOptions;\nexport type ScrollbarOptions = Options.ScrollbarOptions;\nexport type ZoomOptions = Options.ZoomOptions;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling variable and procedure names.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Names\n\nimport {Msg} from './msg.js';\n// import * as Procedures from './procedures.js';\nimport type {VariableMap} from './variable_map.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a database of entity names (variables, procedures, etc).\n */\nexport class Names {\n  static DEVELOPER_VARIABLE_TYPE: NameType;\n  private readonly variablePrefix: string;\n\n  /** A set of reserved words. */\n  private readonly reservedWords: Set<string>;\n\n  /**\n   * A map from type (e.g. name, procedure) to maps from names to generated\n   * names.\n   */\n  private readonly db = new Map<string, Map<string, string>>();\n\n  /** A set of used names to avoid collisions. */\n  private readonly dbReverse = new Set<string>();\n\n  /**\n   * The variable map from the workspace, containing Blockly variable models.\n   */\n  private variableMap: VariableMap | null = null;\n\n  /**\n   * @param reservedWordsList A comma-separated string of words that are illegal\n   *     for use as names in a language (e.g. 'new,if,this,...').\n   * @param opt_variablePrefix Some languages need a '$' or a namespace before\n   *     all variable names (but not procedure names).\n   */\n  constructor(reservedWordsList: string, opt_variablePrefix?: string) {\n    /** The prefix to attach to variable names in generated code. */\n    this.variablePrefix = opt_variablePrefix || '';\n\n    this.reservedWords = new Set<string>(\n      reservedWordsList ? reservedWordsList.split(',') : [],\n    );\n  }\n\n  /**\n   * Empty the database and start from scratch.  The reserved words are kept.\n   */\n  reset() {\n    this.db.clear();\n    this.dbReverse.clear();\n    this.variableMap = null;\n  }\n\n  /**\n   * Set the variable map that maps from variable name to variable object.\n   *\n   * @param map The map to track.\n   */\n  setVariableMap(map: VariableMap) {\n    this.variableMap = map;\n  }\n\n  /**\n   * Get the name for a user-defined variable, based on its ID.\n   * This should only be used for variables of NameType VARIABLE.\n   *\n   * @param id The ID to look up in the variable map.\n   * @returns The name of the referenced variable, or null if there was no\n   *     variable map or the variable was not found in the map.\n   */\n  private getNameForUserVariable(id: string): string | null {\n    if (!this.variableMap) {\n      console.warn(\n        'Deprecated call to Names.prototype.getName without ' +\n          'defining a variable map. To fix, add the following code in your ' +\n          \"generator's init() function:\\n\" +\n          'Blockly.YourGeneratorName.nameDB_.setVariableMap(' +\n          'workspace.getVariableMap());',\n      );\n      return null;\n    }\n    const variable = this.variableMap.getVariableById(id);\n    if (variable) {\n      return variable.name;\n    }\n    return null;\n  }\n\n  /**\n   * Generate names for user variables, but only ones that are being used.\n   *\n   * @param workspace Workspace to generate variables from.\n   */\n  populateVariables(workspace: Workspace) {\n    const variables = Variables.allUsedVarModels(workspace);\n    for (let i = 0; i < variables.length; i++) {\n      this.getName(variables[i].getId(), NameType.VARIABLE);\n    }\n  }\n\n  /**\n   * Generate names for procedures.\n   *\n   * @param workspace Workspace to generate procedures from.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  populateProcedures(workspace: Workspace) {\n    throw new Error(\n      'The implementation of populateProcedures should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   *\n   * @param nameOrId The Blockly entity name (no constraints) or variable ID.\n   * @param type The type of the name in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getName(nameOrId: string, type: NameType | string): string {\n    let name = nameOrId;\n    if (type === NameType.VARIABLE) {\n      const varName = this.getNameForUserVariable(nameOrId);\n      if (varName) {\n        // Successful ID lookup.\n        name = varName;\n      }\n    }\n    const normalizedName = name.toLowerCase();\n\n    const isVar =\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n\n    const prefix = isVar ? this.variablePrefix : '';\n    if (!this.db.has(type)) {\n      this.db.set(type, new Map<string, string>());\n    }\n    const typeDb = this.db.get(type);\n    if (typeDb!.has(normalizedName)) {\n      return prefix + typeDb!.get(normalizedName);\n    }\n    const safeName = this.getDistinctName(name, type);\n    typeDb!.set(normalizedName, safeName.substr(prefix.length));\n    return safeName;\n  }\n\n  /**\n   * Return a list of all known user-created names of a specified name type.\n   *\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns A list of Blockly entity names (no constraints).\n   */\n  getUserNames(type: NameType | string): string[] {\n    const userNames = this.db.get(type)?.keys();\n    return userNames ? Array.from(userNames) : [];\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   * Ensure that this is a new name not overlapping any previously defined name.\n   * Also check against list of reserved words for the current language and\n   * ensure name doesn't collide.\n   *\n   * @param name The Blockly entity name (no constraints).\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getDistinctName(name: string, type: NameType | string): string {\n    let safeName = this.safeName(name);\n    let i: number | null = null;\n    while (\n      this.dbReverse.has(safeName + (i ?? '')) ||\n      this.reservedWords.has(safeName + (i ?? ''))\n    ) {\n      // Collision with existing name.  Create a unique name.\n      i = i ? i + 1 : 2;\n    }\n    safeName += i ?? '';\n    this.dbReverse.add(safeName);\n    const isVar =\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n    const prefix = isVar ? this.variablePrefix : '';\n    return prefix + safeName;\n  }\n\n  /**\n   * Given a proposed entity name, generate a name that conforms to the\n   * [_A-Za-z][_A-Za-z0-9]* format that most languages consider legal for\n   * variable and function names.\n   *\n   * @param name Potentially illegal entity name.\n   * @returns Safe entity name.\n   */\n  private safeName(name: string): string {\n    if (!name) {\n      name = Msg['UNNAMED_KEY'] || 'unnamed';\n    } else {\n      // Unfortunately names in non-latin characters will look like\n      // _E9_9F_B3_E4_B9_90 which is pretty meaningless.\n      // https://github.com/google/blockly/issues/1654\n      name = encodeURI(name.replace(/ /g, '_')).replace(/[^\\w]/g, '_');\n      // Most languages don't allow names with leading numbers.\n      if ('0123456789'.includes(name[0])) {\n        name = 'my_' + name;\n      }\n    }\n    return name;\n  }\n\n  /**\n   * Do the given two entity names refer to the same entity?\n   * Blockly names are case-insensitive.\n   *\n   * @param name1 First name.\n   * @param name2 Second name.\n   * @returns True if names are the same.\n   */\n  static equals(name1: string, name2: string): boolean {\n    // name1.localeCompare(name2) is slower.\n    return name1.toLowerCase() === name2.toLowerCase();\n  }\n}\n\nexport namespace Names {\n  /**\n   * Enum for the type of a name. Different name types may have different rules\n   * about collisions.\n   * When JavaScript (or most other languages) is generated, variable 'foo' and\n   * procedure 'foo' would collide.  However, Blockly has no such problems since\n   * variable get 'foo' and procedure call 'foo' are unambiguous.\n   * Therefore, Blockly keeps a separate name type to disambiguate.\n   * getName('foo', 'VARIABLE') = 'foo'\n   * getName('foo', 'PROCEDURE') = 'foo2'\n   *\n   */\n  export enum NameType {\n    DEVELOPER_VARIABLE = 'DEVELOPER_VARIABLE',\n    VARIABLE = 'VARIABLE',\n    PROCEDURE = 'PROCEDURE',\n  }\n}\n\nexport type NameType = Names.NameType;\nexport const NameType = Names.NameType;\n\n/**\n * Constant to separate developer variable names from user-defined variable\n * names when running generators.\n * A developer variable will be declared as a global in the generated code, but\n * will never be shown to the user in the workspace or stored in the variable\n * map.\n */\nNames.DEVELOPER_VARIABLE_TYPE = NameType.DEVELOPER_VARIABLE;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport type {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {isObservable} from './interfaces/i_observable.js';\n\nexport class ObservableProcedureMap\n  extends Map<string, IProcedureModel>\n  implements IProcedureMap\n{\n  /** @internal */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Adds the given procedure model to the procedure map.\n   */\n  override set(id: string, proc: IProcedureModel): this {\n    if (this.get(id) === proc) return this;\n    super.set(id, proc);\n    if (isObservable(proc)) proc.startPublishing();\n    return this;\n  }\n\n  /**\n   * Deletes the ProcedureModel with the given ID from the procedure map (if it\n   * exists).\n   */\n  override delete(id: string): boolean {\n    const proc = this.get(id);\n    const existed = super.delete(id);\n    if (!existed) return existed;\n    if (isObservable(proc)) proc.stopPublishing();\n    return existed;\n  }\n\n  /**\n   * Removes all ProcedureModels from the procedure map.\n   */\n  override clear() {\n    if (!this.size) return;\n    for (const id of this.keys()) {\n      this.delete(id);\n    }\n  }\n\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this {\n    return this.set(proc.getId(), proc);\n  }\n\n  /**\n   * Returns all of the procedures stored in this map.\n   */\n  getProcedures(): IProcedureModel[] {\n    return [...this.values()];\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as browserEvents from '../browser_events.js';\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\nimport type {IIcon} from '../interfaces/i_icon.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {IconType} from './icon_types.js';\nimport * as tooltip from '../tooltip.js';\n\n/**\n * The abstract icon class. Icons are visual elements that live in the top-start\n * corner of the block. Usually they provide more \"meta\" information about a\n * block (such as warnings or comments) as opposed to fields, which provide\n * \"actual\" information, related to how a block functions.\n */\nexport abstract class Icon implements IIcon {\n  /**\n   * The position of this icon relative to its blocks top-start,\n   * in workspace units.\n   */\n  protected offsetInBlock: Coordinate = new Coordinate(0, 0);\n\n  /** The position of this icon in workspace coordinates. */\n  protected workspaceLocation: Coordinate = new Coordinate(0, 0);\n\n  /** The root svg element visually representing this icon. */\n  protected svgRoot: SVGGElement | null = null;\n\n  /** The tooltip for this icon. */\n  protected tooltip: tooltip.TipInfo;\n\n  constructor(protected sourceBlock: Block) {\n    this.tooltip = sourceBlock;\n  }\n\n  getType(): IconType<IIcon> {\n    throw new Error('Icons must implement getType');\n  }\n\n  initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // The icon has already been initialized.\n\n    const svgBlock = this.sourceBlock as BlockSvg;\n    this.svgRoot = dom.createSvgElement(Svg.G, {'class': 'blocklyIconGroup'});\n    svgBlock.getSvgRoot().appendChild(this.svgRoot);\n    this.updateSvgRootOffset();\n    browserEvents.conditionalBind(\n      this.svgRoot,\n      'pointerdown',\n      this,\n      pointerdownListener,\n    );\n    (this.svgRoot as any).tooltip = this;\n    tooltip.bindMouseEvents(this.svgRoot);\n  }\n\n  dispose(): void {\n    tooltip.unbindMouseEvents(this.svgRoot);\n    dom.removeNode(this.svgRoot);\n  }\n\n  getWeight(): number {\n    return -1;\n  }\n\n  getSize(): Size {\n    return new Size(0, 0);\n  }\n\n  /**\n   * Sets the tooltip for this icon to the given value. Null to show the\n   * tooltip of the block.\n   */\n  setTooltip(tip: tooltip.TipInfo | null) {\n    this.tooltip = tip ?? this.sourceBlock;\n  }\n\n  /** Returns the tooltip for this icon. */\n  getTooltip(): tooltip.TipInfo {\n    return this.tooltip;\n  }\n\n  applyColour(): void {}\n\n  updateEditable(): void {}\n\n  updateCollapsed(): void {\n    if (!this.svgRoot) return;\n    if (this.sourceBlock.isCollapsed()) {\n      this.svgRoot.style.display = 'none';\n    } else {\n      this.svgRoot.style.display = 'block';\n    }\n    if (hasBubble(this)) {\n      this.setBubbleVisible(false);\n    }\n  }\n\n  hideForInsertionMarker(): void {\n    if (!this.svgRoot) return;\n    this.svgRoot.style.display = 'none';\n  }\n\n  isShownWhenCollapsed(): boolean {\n    return false;\n  }\n\n  setOffsetInBlock(offset: Coordinate): void {\n    this.offsetInBlock = offset;\n    this.updateSvgRootOffset();\n  }\n\n  private updateSvgRootOffset(): void {\n    this.svgRoot?.setAttribute(\n      'transform',\n      `translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`,\n    );\n  }\n\n  onLocationChange(blockOrigin: Coordinate): void {\n    this.workspaceLocation = Coordinate.sum(blockOrigin, this.offsetInBlock);\n  }\n\n  onClick(): void {}\n\n  /**\n   * Check whether the icon should be clickable while the block is in a flyout.\n   * The default is that icons are clickable in all flyouts (auto-closing or not).\n   * Subclasses may override this function to change this behavior.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the icon should be clickable while the block is in a flyout.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\n    return true;\n  }\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IDragStrategy} from '../interfaces/i_draggable.js';\nimport {Coordinate} from '../utils.js';\nimport * as eventUtils from '../events/utils.js';\nimport {IBubble, WorkspaceSvg} from '../blockly.js';\nimport * as layers from '../layers.js';\n\nexport class BubbleDragStrategy implements IDragStrategy {\n  private startLoc: Coordinate | null = null;\n\n  constructor(\n    private bubble: IBubble,\n    private workspace: WorkspaceSvg,\n  ) {}\n\n  isMovable(): boolean {\n    return true;\n  }\n\n  startDrag(): void {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n    this.startLoc = this.bubble.getRelativeToSurfaceXY();\n    this.workspace.setResizesEnabled(false);\n    this.workspace.getLayerManager()?.moveToDragLayer(this.bubble);\n    this.bubble.setDragging && this.bubble.setDragging(true);\n  }\n\n  drag(newLoc: Coordinate): void {\n    this.bubble.moveDuringDrag(newLoc);\n  }\n\n  endDrag(): void {\n    this.workspace.setResizesEnabled(true);\n    eventUtils.setGroup(false);\n\n    this.workspace\n      .getLayerManager()\n      ?.moveOffDragLayer(this.bubble, layers.BUBBLE);\n    this.bubble.setDragging(false);\n  }\n\n  revertDrag(): void {\n    if (this.startLoc) this.bubble.moveDuringDrag(this.startLoc);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as browserEvents from '../browser_events.js';\nimport {BubbleDragStrategy} from '../dragging/bubble_drag_strategy.js';\nimport {IBubble} from '../interfaces/i_bubble.js';\nimport {ContainerRegion} from '../metrics_manager.js';\nimport {Scrollbar} from '../scrollbar.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as math from '../utils/math.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as common from '../common.js';\nimport {ISelectable} from '../blockly.js';\nimport * as idGenerator from '../utils/idgenerator.js';\n\n/**\n * The abstract pop-up bubble class. This creates a UI that looks like a speech\n * bubble, where it has a \"tail\" that points to the block, and a \"head\" that\n * displays arbitrary svg elements.\n */\nexport abstract class Bubble implements IBubble, ISelectable {\n  /** The width of the border around the bubble. */\n  static readonly BORDER_WIDTH = 6;\n\n  /** Double the width of the border around the bubble. */\n  static readonly DOUBLE_BORDER = this.BORDER_WIDTH * 2;\n\n  /** The minimum size the bubble can have. */\n  static readonly MIN_SIZE = this.DOUBLE_BORDER;\n\n  /**\n   * The thickness of the base of the tail in relation to the size of the\n   * bubble. Higher numbers result in thinner tails.\n   */\n  static readonly TAIL_THICKNESS = 1;\n\n  /** The number of degrees that the tail bends counter-clockwise. */\n  static readonly TAIL_ANGLE = 20;\n\n  /**\n   * The sharpness of the tail's bend. Higher numbers result in smoother\n   * tails.\n   */\n  static readonly TAIL_BEND = 4;\n\n  /** Distance between arrow point and anchor point. */\n  static readonly ANCHOR_RADIUS = 8;\n\n  public id: string;\n\n  /** The SVG group containing all parts of the bubble. */\n  protected svgRoot: SVGGElement;\n\n  /** The SVG path for the arrow from the anchor to the bubble. */\n  private tail: SVGPathElement;\n\n  /** The SVG background rect for the main body of the bubble. */\n  private background: SVGRectElement;\n\n  /** The SVG group containing the contents of the bubble. */\n  protected contentContainer: SVGGElement;\n\n  /**\n   * The size of the bubble (including background and contents but not tail).\n   */\n  private size = new Size(0, 0);\n\n  /** The colour of the background of the bubble. */\n  private colour = '#ffffff';\n\n  /** True if the bubble has been disposed, false otherwise. */\n  public disposed = false;\n\n  /** The position of the top of the bubble relative to its anchor. */\n  private relativeTop = 0;\n\n  /** The position of the left of the bubble realtive to its anchor. */\n  private relativeLeft = 0;\n\n  private dragStrategy = new BubbleDragStrategy(this, this.workspace);\n\n  /**\n   * @param workspace The workspace this bubble belongs to.\n   * @param anchor The anchor location of the thing this bubble is attached to.\n   *     The tail of the bubble will point to this location.\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\n   *     when automatically positioning.\n   */\n  constructor(\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    this.id = idGenerator.getNextUniqueId();\n    this.svgRoot = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyBubble'},\n      workspace.getBubbleCanvas(),\n    );\n    const embossGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'filter': `url(#${\n          this.workspace.getRenderer().getConstants().embossFilterId\n        })`,\n      },\n      this.svgRoot,\n    );\n    this.tail = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyBubbleTail'},\n      embossGroup,\n    );\n    this.background = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyDraggable',\n        'x': 0,\n        'y': 0,\n        'rx': Bubble.BORDER_WIDTH,\n        'ry': Bubble.BORDER_WIDTH,\n      },\n      embossGroup,\n    );\n    this.contentContainer = dom.createSvgElement(Svg.G, {}, this.svgRoot);\n\n    browserEvents.conditionalBind(\n      this.background,\n      'pointerdown',\n      this,\n      this.onMouseDown,\n    );\n  }\n\n  /** Dispose of this bubble. */\n  dispose() {\n    dom.removeNode(this.svgRoot);\n    this.disposed = true;\n  }\n\n  /**\n   * Set the location the tail of this bubble points to.\n   *\n   * @param anchor The location the tail of this bubble points to.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  setAnchorLocation(anchor: Coordinate, relayout = false) {\n    this.anchor = anchor;\n    if (relayout) {\n      this.positionByRect(this.ownerRect);\n    } else {\n      this.positionRelativeToAnchor();\n    }\n    this.renderTail();\n  }\n\n  /** Sets the position of this bubble relative to its anchor. */\n  setPositionRelativeToAnchor(left: number, top: number) {\n    this.relativeLeft = left;\n    this.relativeTop = top;\n    this.positionRelativeToAnchor();\n    this.renderTail();\n  }\n\n  /** @returns the size of this bubble. */\n  protected getSize() {\n    return this.size;\n  }\n\n  /**\n   * Sets the size of this bubble, including the border.\n   *\n   * @param size Sets the size of this bubble, including the border.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  protected setSize(size: Size, relayout = false) {\n    size.width = Math.max(size.width, Bubble.MIN_SIZE);\n    size.height = Math.max(size.height, Bubble.MIN_SIZE);\n    this.size = size;\n\n    this.background.setAttribute('width', `${size.width}`);\n    this.background.setAttribute('height', `${size.height}`);\n\n    if (relayout) {\n      this.positionByRect(this.ownerRect);\n    } else {\n      this.positionRelativeToAnchor();\n    }\n    this.renderTail();\n  }\n\n  /** Returns the colour of the background and tail of this bubble. */\n  protected getColour(): string {\n    return this.colour;\n  }\n\n  /** Sets the colour of the background and tail of this bubble. */\n  public setColour(colour: string) {\n    this.colour = colour;\n    this.tail.setAttribute('fill', colour);\n    this.background.setAttribute('fill', colour);\n  }\n\n  /** Passes the pointer event off to the gesture system. */\n  private onMouseDown(e: PointerEvent) {\n    this.workspace.getGesture(e)?.handleBubbleStart(e, this);\n    common.setSelected(this);\n  }\n\n  /** Positions the bubble relative to its anchor. Does not render its tail. */\n  protected positionRelativeToAnchor() {\n    let left = this.anchor.x;\n    if (this.workspace.RTL) {\n      left -= this.relativeLeft + this.size.width;\n    } else {\n      left += this.relativeLeft;\n    }\n    const top = this.relativeTop + this.anchor.y;\n    this.moveTo(left, top);\n  }\n\n  /**\n   * Moves the bubble to the given coordinates.\n   *\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.svgRoot.setAttribute('transform', `translate(${x}, ${y})`);\n  }\n\n  /**\n   * Positions the bubble \"optimally\" so that the most of it is visible and\n   * it does not overlap the rect (if provided).\n   */\n  protected positionByRect(rect = new Rect(0, 0, 0, 0)) {\n    const viewMetrics = this.workspace.getMetricsManager().getViewMetrics(true);\n\n    const optimalLeft = this.getOptimalRelativeLeft(viewMetrics);\n    const optimalTop = this.getOptimalRelativeTop(viewMetrics);\n\n    const topPosition = {\n      x: optimalLeft,\n      y: (-this.size.height -\n        this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT) as number,\n    };\n    const startPosition = {x: -this.size.width - 30, y: optimalTop};\n    const endPosition = {x: rect.getWidth(), y: optimalTop};\n    const bottomPosition = {x: optimalLeft, y: rect.getHeight()};\n\n    const closerPosition =\n      rect.getWidth() < rect.getHeight() ? endPosition : bottomPosition;\n    const fartherPosition =\n      rect.getWidth() < rect.getHeight() ? bottomPosition : endPosition;\n\n    const topPositionOverlap = this.getOverlap(topPosition, viewMetrics);\n    const startPositionOverlap = this.getOverlap(startPosition, viewMetrics);\n    const closerPositionOverlap = this.getOverlap(closerPosition, viewMetrics);\n    const fartherPositionOverlap = this.getOverlap(\n      fartherPosition,\n      viewMetrics,\n    );\n\n    // Set the position to whichever position shows the most of the bubble,\n    // with tiebreaks going in the order: top > start > close > far.\n    const mostOverlap = Math.max(\n      topPositionOverlap,\n      startPositionOverlap,\n      closerPositionOverlap,\n      fartherPositionOverlap,\n    );\n    if (topPositionOverlap === mostOverlap) {\n      this.relativeLeft = topPosition.x;\n      this.relativeTop = topPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    if (startPositionOverlap === mostOverlap) {\n      this.relativeLeft = startPosition.x;\n      this.relativeTop = startPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    if (closerPositionOverlap === mostOverlap) {\n      this.relativeLeft = closerPosition.x;\n      this.relativeTop = closerPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    // TODO: I believe relativeLeft_ should actually be called relativeStart_\n    //  and then the math should be fixed to reflect this. (hopefully it'll\n    //  make it look simpler)\n    this.relativeLeft = fartherPosition.x;\n    this.relativeTop = fartherPosition.y;\n    this.positionRelativeToAnchor();\n  }\n\n  /**\n   * Calculate the what percentage of the bubble overlaps with the visible\n   * workspace (what percentage of the bubble is visible).\n   *\n   * @param relativeMin The position of the top-left corner of the bubble\n   *     relative to the anchor point.\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The percentage of the bubble that is visible.\n   */\n  private getOverlap(\n    relativeMin: {x: number; y: number},\n    viewMetrics: ContainerRegion,\n  ): number {\n    // The position of the top-left corner of the bubble in workspace units.\n    const bubbleMin = {\n      x: this.workspace.RTL\n        ? this.anchor.x - relativeMin.x - this.size.width\n        : relativeMin.x + this.anchor.x,\n      y: relativeMin.y + this.anchor.y,\n    };\n    // The position of the bottom-right corner of the bubble in workspace units.\n    const bubbleMax = {\n      x: bubbleMin.x + this.size.width,\n      y: bubbleMin.y + this.size.height,\n    };\n\n    // We could adjust these values to account for the scrollbars, but the\n    // bubbles should have been adjusted to not collide with them anyway, so\n    // giving the workspace a slightly larger \"bounding box\" shouldn't affect\n    // the calculation.\n\n    // The position of the top-left corner of the workspace.\n    const workspaceMin = {x: viewMetrics.left, y: viewMetrics.top};\n    // The position of the bottom-right corner of the workspace.\n    const workspaceMax = {\n      x: viewMetrics.left + viewMetrics.width,\n      y: viewMetrics.top + viewMetrics.height,\n    };\n\n    const overlapWidth =\n      Math.min(bubbleMax.x, workspaceMax.x) -\n      Math.max(bubbleMin.x, workspaceMin.x);\n    const overlapHeight =\n      Math.min(bubbleMax.y, workspaceMax.y) -\n      Math.max(bubbleMin.y, workspaceMin.y);\n    return Math.max(\n      0,\n      Math.min(\n        1,\n        (overlapWidth * overlapHeight) / (this.size.width * this.size.height),\n      ),\n    );\n  }\n\n  /**\n   * Calculate what the optimal horizontal position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal horizontal position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeLeft(viewMetrics: ContainerRegion): number {\n    // By default, show the bubble just a bit to the left of the anchor.\n    let relativeLeft = -this.size.width / 4;\n\n    // No amount of sliding left or right will give us better overlap.\n    if (this.size.width > viewMetrics.width) return relativeLeft;\n\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\n\n    if (this.workspace.RTL) {\n      // Bubble coordinates are flipped in RTL.\n      const bubbleRight = this.anchor.x - relativeLeft;\n      const bubbleLeft = bubbleRight - this.size.width;\n\n      if (bubbleLeft < workspaceRect.left) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = -(workspaceRect.left - this.anchor.x + this.size.width);\n      } else if (bubbleRight > workspaceRect.right) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = -(workspaceRect.right - this.anchor.x);\n      }\n    } else {\n      const bubbleLeft = relativeLeft + this.anchor.x;\n      const bubbleRight = bubbleLeft + this.size.width;\n\n      if (bubbleLeft < workspaceRect.left) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = workspaceRect.left - this.anchor.x;\n      } else if (bubbleRight > workspaceRect.right) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = workspaceRect.right - this.anchor.x - this.size.width;\n      }\n    }\n\n    return relativeLeft;\n  }\n\n  /**\n   * Calculate what the optimal vertical position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal vertical position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeTop(viewMetrics: ContainerRegion): number {\n    // By default, show the bubble just a bit higher than the anchor.\n    let relativeTop = -this.size.height / 4;\n\n    // No amount of sliding up or down will give us better overlap.\n    if (this.size.height > viewMetrics.height) return relativeTop;\n\n    const top = this.anchor.y + relativeTop;\n    const bottom = top + this.size.height;\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\n\n    if (top < workspaceRect.top) {\n      // Slide the bubble down until it is onscreen.\n      relativeTop = workspaceRect.top - this.anchor.y;\n    } else if (bottom > workspaceRect.bottom) {\n      // Slide the bubble up until it is onscreen.\n      relativeTop = workspaceRect.bottom - this.anchor.y - this.size.height;\n    }\n\n    return relativeTop;\n  }\n\n  /**\n   * @returns a rect defining the bounds of the workspace's view in workspace\n   * coordinates.\n   */\n  private getWorkspaceViewRect(viewMetrics: ContainerRegion): Rect {\n    const top = viewMetrics.top;\n    let bottom = viewMetrics.top + viewMetrics.height;\n    let left = viewMetrics.left;\n    let right = viewMetrics.left + viewMetrics.width;\n\n    bottom -= this.getScrollbarThickness();\n    if (this.workspace.RTL) {\n      left -= this.getScrollbarThickness();\n    } else {\n      right -= this.getScrollbarThickness();\n    }\n\n    return new Rect(top, bottom, left, right);\n  }\n\n  /** @returns the scrollbar thickness in workspace units. */\n  private getScrollbarThickness() {\n    return Scrollbar.scrollbarThickness / this.workspace.scale;\n  }\n\n  /** Draws the tail of the bubble. */\n  private renderTail() {\n    const steps = [];\n    // Find the relative coordinates of the center of the bubble.\n    const relBubbleX = this.size.width / 2;\n    const relBubbleY = this.size.height / 2;\n    // Find the relative coordinates of the center of the anchor.\n    let relAnchorX = -this.relativeLeft;\n    let relAnchorY = -this.relativeTop;\n    if (relBubbleX === relAnchorX && relBubbleY === relAnchorY) {\n      // Null case.  Bubble is directly on top of the anchor.\n      // Short circuit this rather than wade through divide by zeros.\n      steps.push('M ' + relBubbleX + ',' + relBubbleY);\n    } else {\n      // Compute the angle of the tail's line.\n      const rise = relAnchorY - relBubbleY;\n      let run = relAnchorX - relBubbleX;\n      if (this.workspace.RTL) {\n        run *= -1;\n      }\n      const hypotenuse = Math.sqrt(rise * rise + run * run);\n      let angle = Math.acos(run / hypotenuse);\n      if (rise < 0) {\n        angle = 2 * Math.PI - angle;\n      }\n      // Compute a line perpendicular to the tail.\n      let rightAngle = angle + Math.PI / 2;\n      if (rightAngle > Math.PI * 2) {\n        rightAngle -= Math.PI * 2;\n      }\n      const rightRise = Math.sin(rightAngle);\n      const rightRun = Math.cos(rightAngle);\n\n      // Calculate the thickness of the base of the tail.\n      let thickness =\n        (this.size.width + this.size.height) / Bubble.TAIL_THICKNESS;\n      thickness = Math.min(thickness, this.size.width, this.size.height) / 4;\n\n      // Back the tip of the tail off of the anchor.\n      const backoffRatio = 1 - Bubble.ANCHOR_RADIUS / hypotenuse;\n      relAnchorX = relBubbleX + backoffRatio * run;\n      relAnchorY = relBubbleY + backoffRatio * rise;\n\n      // Coordinates for the base of the tail.\n      const baseX1 = relBubbleX + thickness * rightRun;\n      const baseY1 = relBubbleY + thickness * rightRise;\n      const baseX2 = relBubbleX - thickness * rightRun;\n      const baseY2 = relBubbleY - thickness * rightRise;\n\n      // Distortion to curve the tail.\n      const radians = math.toRadians(\n        this.workspace.RTL ? -Bubble.TAIL_ANGLE : Bubble.TAIL_ANGLE,\n      );\n      let swirlAngle = angle + radians;\n      if (swirlAngle > Math.PI * 2) {\n        swirlAngle -= Math.PI * 2;\n      }\n      const swirlRise = (Math.sin(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\n      const swirlRun = (Math.cos(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\n\n      steps.push('M' + baseX1 + ',' + baseY1);\n      steps.push(\n        'C' +\n          (baseX1 + swirlRun) +\n          ',' +\n          (baseY1 + swirlRise) +\n          ' ' +\n          relAnchorX +\n          ',' +\n          relAnchorY +\n          ' ' +\n          relAnchorX +\n          ',' +\n          relAnchorY,\n      );\n      steps.push(\n        'C' +\n          relAnchorX +\n          ',' +\n          relAnchorY +\n          ' ' +\n          (baseX2 + swirlRun) +\n          ',' +\n          (baseY2 + swirlRise) +\n          ' ' +\n          baseX2 +\n          ',' +\n          baseY2,\n      );\n    }\n    steps.push('z');\n    this.tail?.setAttribute('d', steps.join(' '));\n  }\n  /**\n   * Move this bubble to the front of the visible workspace.\n   *\n   * @returns Whether or not the bubble has been moved.\n   * @internal\n   */\n  bringToFront(): boolean {\n    const svgGroup = this.svgRoot?.parentNode;\n    if (this.svgRoot && svgGroup?.lastChild !== this.svgRoot) {\n      svgGroup?.appendChild(this.svgRoot);\n      return true;\n    }\n    return false;\n  }\n\n  /** @internal */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(\n      this.workspace.RTL\n        ? -this.relativeLeft + this.anchor.x - this.size.width\n        : this.anchor.x + this.relativeLeft,\n      this.anchor.y + this.relativeTop,\n    );\n  }\n\n  /** @internal */\n  getSvgRoot(): SVGElement {\n    return this.svgRoot;\n  }\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    this.moveTo(newLoc.x, newLoc.y);\n    if (this.workspace.RTL) {\n      this.relativeLeft = this.anchor.x - newLoc.x - this.size.width;\n    } else {\n      this.relativeLeft = newLoc.x - this.anchor.x;\n    }\n    this.relativeTop = newLoc.y - this.anchor.y;\n    this.renderTail();\n  }\n\n  setDragging(_start: boolean) {\n    // NOOP in base class.\n  }\n\n  /** @internal */\n  setDeleteStyle(_enable: boolean) {\n    // NOOP in base class.\n  }\n\n  /** @internal */\n  isDeletable(): boolean {\n    return false;\n  }\n\n  /** @internal */\n  showContextMenu(_e: Event) {\n    // NOOP in base class.\n  }\n\n  /** Returns whether this bubble is movable or not. */\n  isMovable(): boolean {\n    return true;\n  }\n\n  /** Starts a drag on the bubble. */\n  startDrag(): void {\n    this.dragStrategy.startDrag();\n  }\n\n  /** Drags the bubble to the given location. */\n  drag(newLoc: Coordinate): void {\n    this.dragStrategy.drag(newLoc);\n  }\n\n  /** Ends the drag on the bubble. */\n  endDrag(): void {\n    this.dragStrategy.endDrag();\n  }\n\n  /** Moves the bubble back to where it was at the start of a drag. */\n  revertDrag(): void {\n    this.dragStrategy.revertDrag();\n  }\n\n  select(): void {\n    // Bubbles don't have any visual for being selected.\n  }\n\n  unselect(): void {\n    // Bubbles don't have any visual for being selected.\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Abstract as AbstractEvent} from '../events/events_abstract.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport {Bubble} from './bubble.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Options} from '../options.js';\nimport {Svg} from '../utils/svg.js';\nimport type {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * A bubble that contains a mini-workspace which can hold arbitrary blocks.\n * Used by the mutator icon.\n */\nexport class MiniWorkspaceBubble extends Bubble {\n  /**\n   * The minimum amount of change to the mini workspace view to trigger\n   * resizing the bubble.\n   */\n  private static readonly MINIMUM_VIEW_CHANGE = 10;\n\n  /**\n   * An arbitrary margin of whitespace to put around the blocks in the\n   * workspace.\n   */\n  private static readonly MARGIN = Bubble.DOUBLE_BORDER * 3;\n\n  /** The root svg element containing the workspace. */\n  private svgDialog: SVGElement;\n\n  /** The workspace that gets shown within this bubble. */\n  private miniWorkspace: WorkspaceSvg;\n\n  /**\n   * Should this bubble automatically reposition itself when it resizes?\n   * Becomes false after this bubble is first dragged.\n   */\n  private autoLayout = true;\n\n  /** @internal */\n  constructor(\n    workspaceOptions: BlocklyOptions,\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    const options = new Options(workspaceOptions);\n    this.validateWorkspaceOptions(options);\n\n    this.svgDialog = dom.createSvgElement(\n      Svg.SVG,\n      {\n        'x': Bubble.BORDER_WIDTH,\n        'y': Bubble.BORDER_WIDTH,\n      },\n      this.contentContainer,\n    );\n    workspaceOptions.parentWorkspace = this.workspace;\n    this.miniWorkspace = this.newWorkspaceSvg(new Options(workspaceOptions));\n    // TODO (#7422): Change this to `internalIsMiniWorkspace` or something. Not\n    //   all mini workspaces are necessarily mutators.\n    this.miniWorkspace.internalIsMutator = true;\n    const background = this.miniWorkspace.createDom('blocklyMutatorBackground');\n    this.svgDialog.appendChild(background);\n    if (options.languageTree) {\n      background.insertBefore(\n        this.miniWorkspace.addFlyout(Svg.G),\n        this.miniWorkspace.getCanvas(),\n      );\n      const flyout = this.miniWorkspace.getFlyout();\n      flyout?.init(this.miniWorkspace);\n      flyout?.show(options.languageTree);\n    }\n\n    this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));\n    this.miniWorkspace\n      .getFlyout()\n      ?.getWorkspace()\n      ?.addChangeListener(this.onWorkspaceChange.bind(this));\n    this.updateBubbleSize();\n  }\n\n  dispose() {\n    this.miniWorkspace.dispose();\n    super.dispose();\n  }\n\n  /** @internal */\n  getWorkspace(): WorkspaceSvg {\n    return this.miniWorkspace;\n  }\n\n  /** Adds a change listener to the mini workspace. */\n  addWorkspaceChangeListener(listener: (e: AbstractEvent) => void) {\n    this.miniWorkspace.addChangeListener(listener);\n  }\n\n  /**\n   * Validates the workspace options to make sure folks aren't trying to\n   * enable things the miniworkspace doesn't support.\n   */\n  private validateWorkspaceOptions(options: Options) {\n    if (options.hasCategories) {\n      throw new Error(\n        'The miniworkspace bubble does not support toolboxes with categories',\n      );\n    }\n    if (options.hasTrashcan) {\n      throw new Error('The miniworkspace bubble does not support trashcans');\n    }\n    if (\n      options.zoomOptions.controls ||\n      options.zoomOptions.wheel ||\n      options.zoomOptions.pinch\n    ) {\n      throw new Error('The miniworkspace bubble does not support zooming');\n    }\n    if (\n      options.moveOptions.scrollbars ||\n      options.moveOptions.wheel ||\n      options.moveOptions.drag\n    ) {\n      throw new Error(\n        'The miniworkspace bubble does not scrolling/moving the workspace',\n      );\n    }\n    if (options.horizontalLayout) {\n      throw new Error(\n        'The miniworkspace bubble does not support horizontal layouts',\n      );\n    }\n  }\n\n  private onWorkspaceChange() {\n    this.bumpBlocksIntoBounds();\n    this.updateBubbleSize();\n  }\n\n  /**\n   * Bumps blocks that are above the top or outside the start-side of the\n   * workspace back within the workspace.\n   *\n   * Blocks that are below the bottom or outside the end-side of the workspace\n   * are dealt with by resizing the workspace to show them.\n   */\n  private bumpBlocksIntoBounds() {\n    if (this.miniWorkspace.isDragging()) return;\n\n    const MARGIN = 20;\n\n    for (const block of this.miniWorkspace.getTopBlocks(false)) {\n      const blockXY = block.getRelativeToSurfaceXY();\n\n      // Bump any block that's above the top back inside.\n      if (blockXY.y < MARGIN) {\n        block.moveBy(0, MARGIN - blockXY.y);\n      }\n      // Bump any block overlapping the flyout back inside.\n      if (block.RTL) {\n        let right = -MARGIN;\n        const flyout = this.miniWorkspace.getFlyout();\n        if (flyout) {\n          right -= flyout.getWidth();\n        }\n        if (blockXY.x > right) {\n          block.moveBy(right - blockXY.x, 0);\n        }\n      } else if (blockXY.x < MARGIN) {\n        block.moveBy(MARGIN - blockXY.x, 0);\n      }\n    }\n  }\n\n  /**\n   * Updates the size of this bubble to account for the size of the\n   * mini workspace.\n   */\n  private updateBubbleSize() {\n    if (this.miniWorkspace.isDragging()) return;\n\n    const currSize = this.getSize();\n    const newSize = this.calculateWorkspaceSize();\n    if (\n      Math.abs(currSize.width - newSize.width) <\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE &&\n      Math.abs(currSize.height - newSize.height) <\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE\n    ) {\n      // Only resize if the size has noticeably changed.\n      return;\n    }\n    this.svgDialog.setAttribute('width', `${newSize.width}px`);\n    this.svgDialog.setAttribute('height', `${newSize.height}px`);\n    this.miniWorkspace.setCachedParentSvgSize(newSize.width, newSize.height);\n    if (this.miniWorkspace.RTL) {\n      // Scroll the workspace to always left-align.\n      this.miniWorkspace\n        .getCanvas()\n        .setAttribute('transform', `translate(${newSize.width}, 0)`);\n    }\n    this.setSize(\n      new Size(\n        newSize.width + Bubble.DOUBLE_BORDER,\n        newSize.height + Bubble.DOUBLE_BORDER,\n      ),\n      this.autoLayout,\n    );\n    this.miniWorkspace.resize();\n    this.miniWorkspace.recordDragTargets();\n  }\n\n  /**\n   * Calculates the size of the mini workspace for use in resizing the bubble.\n   */\n  private calculateWorkspaceSize(): Size {\n    const workspaceSize = this.miniWorkspace.getCanvas().getBBox();\n    let width = workspaceSize.width + MiniWorkspaceBubble.MARGIN;\n    let height = workspaceSize.height + MiniWorkspaceBubble.MARGIN;\n\n    const flyout = this.miniWorkspace.getFlyout();\n    if (flyout) {\n      const flyoutScrollMetrics = flyout\n        .getWorkspace()\n        .getMetricsManager()\n        .getScrollMetrics();\n      height = Math.max(height, flyoutScrollMetrics.height + 20);\n      width += flyout.getWidth();\n    }\n    return new Size(width, height);\n  }\n\n  /** Reapplies styles to all of the blocks in the mini workspace. */\n  updateBlockStyles() {\n    for (const block of this.miniWorkspace.getAllBlocks(false)) {\n      block.setStyle(block.getStyleName());\n    }\n\n    const flyoutWs = this.miniWorkspace.getFlyout()?.getWorkspace();\n    if (flyoutWs) {\n      for (const block of flyoutWs.getAllBlocks(false)) {\n        block.setStyle(block.getStyleName());\n      }\n    }\n  }\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate): void {\n    super.moveDuringDrag(newLoc);\n    this.autoLayout = false;\n  }\n\n  /** @internal */\n  moveTo(x: number, y: number): void {\n    super.moveTo(x, y);\n    this.miniWorkspace.recordDragTargets();\n  }\n\n  /** @internal */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  newWorkspaceSvg(options: Options): WorkspaceSvg {\n    throw new Error(\n      'The implementation of newWorkspaceSvg should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Mutator\n\nimport type {Abstract} from '../events/events_abstract.js';\nimport {BlockChange} from '../events/events_block_change.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport {Icon} from './icon.js';\nimport {MiniWorkspaceBubble} from '../bubbles/mini_workspace_bubble.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport {IconType} from './icon_types.js';\nimport * as renderManagement from '../render_management.js';\n\n/** The size of the mutator icon in workspace-scale units. */\nconst SIZE = 17;\n\n/**\n * The distance between the root block in the mini workspace and that\n * workspace's edges.\n */\nconst WORKSPACE_MARGIN = 16;\n\n/**\n * An icon that allows the user to change the shape of the block.\n *\n * For example, it could be used to add additional fields or inputs to\n * the block.\n */\nexport class MutatorIcon extends Icon implements IHasBubble {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.MUTATOR;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 1;\n\n  /** The bubble used to show the mini workspace to the user. */\n  private miniWorkspaceBubble: MiniWorkspaceBubble | null = null;\n\n  /** The root block in the mini workspace. */\n  private rootBlock: BlockSvg | null = null;\n\n  /** The PID tracking updating the workkspace in response to user events. */\n  private updateWorkspacePid: ReturnType<typeof setTimeout> | null = null;\n\n  /**\n   * The change listener in the main workspace that triggers the saveConnections\n   * method when anything in the main workspace changes.\n   *\n   * Only actually registered to listen for events while the mutator bubble is\n   * open.\n   */\n  private saveConnectionsListener: (() => void) | null = null;\n\n  constructor(\n    private readonly flyoutBlockTypes: string[],\n    protected readonly sourceBlock: BlockSvg,\n  ) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<MutatorIcon> {\n    return MutatorIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Square with rounded corners.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconShape',\n        'rx': '4',\n        'ry': '4',\n        'height': '16',\n        'width': '16',\n      },\n      this.svgRoot,\n    );\n    // Gear teeth.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd':\n          'm4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,' +\n          '0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,' +\n          '-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,' +\n          '-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,' +\n          '-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 ' +\n          '-0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,' +\n          '0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z',\n      },\n      this.svgRoot,\n    );\n    // Axle hole.\n    dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyIconShape', 'r': '2.7', 'cx': '8', 'cy': '8'},\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-mutator');\n  }\n\n  override dispose(): void {\n    super.dispose();\n    this.miniWorkspaceBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return MutatorIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    this.miniWorkspaceBubble?.setColour(this.sourceBlock.style.colourPrimary);\n    this.miniWorkspaceBubble?.updateBlockStyles();\n  }\n\n  override updateCollapsed(): void {\n    super.updateCollapsed();\n    if (this.sourceBlock.isCollapsed()) this.setBubbleVisible(false);\n  }\n\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    this.miniWorkspaceBubble?.setAnchorLocation(this.getAnchorLocation());\n  }\n\n  override onClick(): void {\n    super.onClick();\n    if (this.sourceBlock.isEditable()) {\n      this.setBubbleVisible(!this.bubbleIsVisible());\n    }\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  bubbleIsVisible(): boolean {\n    return !!this.miniWorkspaceBubble;\n  }\n\n  async setBubbleVisible(visible: boolean): Promise<void> {\n    if (this.bubbleIsVisible() === visible) return;\n\n    await renderManagement.finishQueuedRenders();\n\n    if (visible) {\n      this.miniWorkspaceBubble = new MiniWorkspaceBubble(\n        this.getMiniWorkspaceConfig(),\n        this.sourceBlock.workspace,\n        this.getAnchorLocation(),\n        this.getBubbleOwnerRect(),\n      );\n      this.applyColour();\n      this.createRootBlock();\n      this.addSaveConnectionsListener();\n      this.miniWorkspaceBubble?.addWorkspaceChangeListener(\n        this.createMiniWorkspaceChangeListener(),\n      );\n    } else {\n      this.miniWorkspaceBubble?.dispose();\n      this.miniWorkspaceBubble = null;\n      if (this.saveConnectionsListener) {\n        this.sourceBlock.workspace.removeChangeListener(\n          this.saveConnectionsListener,\n        );\n      }\n      this.saveConnectionsListener = null;\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'mutator',\n      ),\n    );\n  }\n\n  /** @returns the configuration the mini workspace should have. */\n  private getMiniWorkspaceConfig() {\n    const options: BlocklyOptions = {\n      'disable': false,\n      'media': this.sourceBlock.workspace.options.pathToMedia,\n      'rtl': this.sourceBlock.RTL,\n      'renderer': this.sourceBlock.workspace.options.renderer,\n      'rendererOverrides':\n        this.sourceBlock.workspace.options.rendererOverrides ?? undefined,\n    };\n\n    if (this.flyoutBlockTypes.length) {\n      options.toolbox = {\n        'kind': 'flyoutToolbox',\n        'contents': this.flyoutBlockTypes.map((type) => ({\n          'kind': 'block',\n          'type': type,\n        })),\n      };\n    }\n\n    return options;\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n\n  /** Decomposes the source block to create blocks in the mini workspace. */\n  private createRootBlock() {\n    if (!this.sourceBlock.decompose) {\n      throw new Error(\n        'Blocks with mutator icons must include a decompose method',\n      );\n    }\n    this.rootBlock = this.sourceBlock.decompose(\n      this.miniWorkspaceBubble!.getWorkspace(),\n    )!;\n\n    for (const child of this.rootBlock.getDescendants(false)) {\n      child.queueRender();\n    }\n\n    this.rootBlock.setMovable(false);\n    this.rootBlock.setDeletable(false);\n\n    const flyoutWidth =\n      this.miniWorkspaceBubble?.getWorkspace()?.getFlyout()?.getWidth() ?? 0;\n    this.rootBlock.moveBy(\n      this.rootBlock.RTL ? -(flyoutWidth + WORKSPACE_MARGIN) : WORKSPACE_MARGIN,\n      WORKSPACE_MARGIN,\n    );\n  }\n\n  /** Adds a listen to the source block that triggers saving connections. */\n  private addSaveConnectionsListener() {\n    if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\n    this.saveConnectionsListener = () => {\n      if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\n      this.sourceBlock.saveConnections(this.rootBlock);\n    };\n    this.saveConnectionsListener();\n    this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener);\n  }\n\n  /**\n   * Creates a change listener to add to the mini workspace which recomposes\n   * the block.\n   */\n  private createMiniWorkspaceChangeListener() {\n    return (e: Abstract) => {\n      if (!MutatorIcon.isIgnorableMutatorEvent(e) && !this.updateWorkspacePid) {\n        this.updateWorkspacePid = setTimeout(() => {\n          this.updateWorkspacePid = null;\n          this.recomposeSourceBlock();\n        }, 0);\n      }\n    };\n  }\n\n  /**\n   * Returns true if the given event is not one the mutator needs to\n   * care about.\n   *\n   * @internal\n   */\n  static isIgnorableMutatorEvent(e: Abstract) {\n    return (\n      e.isUiEvent ||\n      e.type === eventUtils.CREATE ||\n      (e.type === eventUtils.CHANGE &&\n        (e as BlockChange).element === 'disabled')\n    );\n  }\n\n  /** Recomposes the source block based on changes to the mini workspace. */\n  private recomposeSourceBlock() {\n    if (!this.rootBlock) return;\n    if (!this.sourceBlock.compose) {\n      throw new Error(\n        'Blocks with mutator icons must include a compose method',\n      );\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) eventUtils.setGroup(true);\n\n    const oldExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\n    this.sourceBlock.compose(this.rootBlock);\n    const newExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\n\n    if (oldExtraState !== newExtraState) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this.sourceBlock,\n          'mutation',\n          null,\n          oldExtraState,\n          newExtraState,\n        ),\n      );\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * @returns The workspace of the mini workspace bubble, if the bubble is\n   *     currently open.\n   */\n  getWorkspace(): WorkspaceSvg | undefined {\n    return this.miniWorkspaceBubble?.getWorkspace();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.KeyCodes\n\n/* eslint-disable @typescript-eslint/no-duplicate-enum-values */\n\n/**\n * Key codes for common characters.\n *\n * Copied from Closure's goog.events.KeyCodes\n *\n * This list is not localized and therefore some of the key codes are not\n * correct for non US keyboard layouts. See comments below.\n */\nexport enum KeyCodes {\n  WIN_KEY_FF_LINUX = 0,\n  MAC_ENTER = 3,\n  BACKSPACE = 8,\n  TAB = 9,\n  NUM_CENTER = 12, // NUMLOCK on FF/Safari Mac\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE = 19,\n  CAPS_LOCK = 20,\n  ESC = 27,\n  SPACE = 32,\n  PAGE_UP = 33, // also NUM_NORTH_EAST\n  PAGE_DOWN = 34, // also NUM_SOUTH_EAST\n  END = 35, // also NUM_SOUTH_WEST\n  HOME = 36, // also NUM_NORTH_WEST\n  LEFT = 37, // also NUM_WEST\n  UP = 38, // also NUM_NORTH\n  RIGHT = 39, // also NUM_EAST\n  DOWN = 40, // also NUM_SOUTH\n  PLUS_SIGN = 43, // NOT numpad plus\n  PRINT_SCREEN = 44,\n  INSERT = 45, // also NUM_INSERT\n  DELETE = 46, // also NUM_DELETE\n  ZERO = 48,\n  ONE = 49,\n  TWO = 50,\n  THREE = 51,\n  FOUR = 52,\n  FIVE = 53,\n  SIX = 54,\n  SEVEN = 55,\n  EIGHT = 56,\n  NINE = 57,\n  FF_SEMICOLON = 59, // Firefox (Gecko) fires this for semicolon instead of 186\n  FF_EQUALS = 61, // Firefox (Gecko) fires this for equals instead of 187\n  FF_DASH = 173, // Firefox (Gecko) fires this for dash instead of 189\n  // Firefox (Gecko) fires this for # on UK keyboards, rather than\n  // Shift+SINGLE_QUOTE.\n  FF_HASH = 163,\n  QUESTION_MARK = 63, // needs localization\n  AT_SIGN = 64,\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n  META = 91, // WIN_KEY_LEFT\n  WIN_KEY_RIGHT = 92,\n  CONTEXT_MENU = 93,\n  NUM_ZERO = 96,\n  NUM_ONE = 97,\n  NUM_TWO = 98,\n  NUM_THREE = 99,\n  NUM_FOUR = 100,\n  NUM_FIVE = 101,\n  NUM_SIX = 102,\n  NUM_SEVEN = 103,\n  NUM_EIGHT = 104,\n  NUM_NINE = 105,\n  NUM_MULTIPLY = 106,\n  NUM_PLUS = 107,\n  NUM_MINUS = 109,\n  NUM_PERIOD = 110,\n  NUM_DIVISION = 111,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  NUMLOCK = 144,\n  SCROLL_LOCK = 145,\n\n  // OS-specific media keys like volume controls and browser controls.\n  FIRST_MEDIA_KEY = 166,\n  LAST_MEDIA_KEY = 183,\n\n  SEMICOLON = 186, // needs localization\n  DASH = 189, // needs localization\n  EQUALS = 187, // needs localization\n  COMMA = 188, // needs localization\n  PERIOD = 190, // needs localization\n  SLASH = 191, // needs localization\n  APOSTROPHE = 192, // needs localization\n  TILDE = 192, // needs localization\n  SINGLE_QUOTE = 222, // needs localization\n  OPEN_SQUARE_BRACKET = 219, // needs localization\n  BACKSLASH = 220, // needs localization\n  CLOSE_SQUARE_BRACKET = 221, // needs localization\n  WIN_KEY = 224,\n  MAC_FF_META = 224, // Firefox (Gecko) fires this for the meta key instead of 91\n  MAC_WK_CMD_LEFT = 91, // WebKit Left Command key fired, same as META\n  MAC_WK_CMD_RIGHT = 93, // WebKit Right Command key fired, different from META\n  WIN_IME = 229,\n\n  // \"Reserved for future use\". Some programs (e.g. the SlingPlayer 2.4 ActiveX\n  // control) fire this as a hacky way to disable screensavers.\n  VK_NONAME = 252,\n\n  // We've seen users whose machines fire this keycode at regular one\n  // second intervals. The common thread among these users is that\n  // they're all using Dell Inspiron laptops, so we suspect that this\n  // indicates a hardware/bios problem.\n  // http://en.community.dell.com/support-forums/laptop/f/3518/p/19285957/19523128.aspx\n  PHANTOM = 255,\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils\n\nimport * as browserEvents from './browser_events.js';\nimport * as extensions from './extensions.js';\nimport * as aria from './utils/aria.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as colour from './utils/colour.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as math from './utils/math.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as object from './utils/object.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as stringUtils from './utils/string.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as xml from './utils/xml.js';\n\nexport {\n  aria,\n  arrayUtils as array,\n  browserEvents,\n  colour,\n  Coordinate,\n  deprecation,\n  dom,\n  extensions,\n  idGenerator,\n  KeyCodes,\n  math,\n  Metrics,\n  object,\n  parsing,\n  Rect,\n  Size,\n  stringUtils as string,\n  style,\n  Svg,\n  svgMath,\n  svgPaths,\n  toolbox,\n  userAgent,\n  xml,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubble.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * A bubble that displays non-editable text. Used by the warning icon.\n */\nexport class TextBubble extends Bubble {\n  private paragraph: SVGTextElement;\n\n  constructor(\n    private text: string,\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\n    this.updateBubbleSize();\n  }\n\n  /** @returns the current text of this text bubble. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the current text of this text bubble, and updates the display. */\n  setText(text: string) {\n    this.text = text;\n    dom.removeNode(this.paragraph);\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\n    this.updateBubbleSize();\n  }\n\n  /**\n   * Converts the given string into an svg containing that string,\n   * broken up by newlines.\n   */\n  private stringToSvg(text: string, container: SVGGElement) {\n    const paragraph = this.createParagraph(container);\n    const spans = this.createSpans(paragraph, text);\n    if (this.workspace.RTL)\n      this.rightAlignSpans(paragraph.getBBox().width, spans);\n    return paragraph;\n  }\n\n  /** Creates the paragraph container for this bubble's view's spans. */\n  private createParagraph(container: SVGGElement): SVGTextElement {\n    return dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\n        'y': Bubble.BORDER_WIDTH,\n      },\n      container,\n    );\n  }\n\n  /** Creates the spans visualizing the text of this bubble. */\n  private createSpans(parent: SVGTextElement, text: string): SVGTSpanElement[] {\n    return text.split('\\n').map((line) => {\n      const tspan = dom.createSvgElement(\n        Svg.TSPAN,\n        {'dy': '1em', 'x': Bubble.BORDER_WIDTH},\n        parent,\n      );\n      const textNode = document.createTextNode(line);\n      tspan.appendChild(textNode);\n      return tspan;\n    });\n  }\n\n  /** Right aligns the given spans. */\n  private rightAlignSpans(maxWidth: number, spans: SVGTSpanElement[]) {\n    for (const span of spans) {\n      span.setAttribute('text-anchor', 'end');\n      span.setAttribute('x', `${maxWidth + Bubble.BORDER_WIDTH}`);\n    }\n  }\n\n  /** Updates the size of this bubble to account for the size of the text. */\n  private updateBubbleSize() {\n    const bbox = this.paragraph.getBBox();\n    this.setSize(\n      new Size(\n        bbox.width + Bubble.BORDER_WIDTH * 2,\n        bbox.height + Bubble.BORDER_WIDTH * 2,\n      ),\n      true,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubble.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as Css from '../css.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport * as touch from '../touch.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {browserEvents} from '../utils.js';\n\n/**\n * A bubble that displays editable text. It can also be resized by the user.\n * Used by the comment icon.\n */\nexport class TextInputBubble extends Bubble {\n  /** The root of the elements specific to the text element. */\n  private inputRoot: SVGForeignObjectElement;\n\n  /** The text input area element. */\n  private textArea: HTMLTextAreaElement;\n\n  /** The group containing the lines indicating the bubble is resizable. */\n  private resizeGroup: SVGGElement;\n\n  /**\n   * Event data associated with the listener for pointer up events on the\n   * resize group.\n   */\n  private resizePointerUpListener: browserEvents.Data | null = null;\n\n  /**\n   * Event data associated with the listener for pointer move events on the\n   * resize group.\n   */\n  private resizePointerMoveListener: browserEvents.Data | null = null;\n\n  /** Functions listening for changes to the text of this bubble. */\n  private textChangeListeners: (() => void)[] = [];\n\n  /** Functions listening for changes to the size of this bubble. */\n  private sizeChangeListeners: (() => void)[] = [];\n\n  /** The text of this bubble. */\n  private text = '';\n\n  /** The default size of this bubble, including borders. */\n  private readonly DEFAULT_SIZE = new Size(\n    160 + Bubble.DOUBLE_BORDER,\n    80 + Bubble.DOUBLE_BORDER,\n  );\n\n  /** The minimum size of this bubble, including borders. */\n  private readonly MIN_SIZE = new Size(\n    45 + Bubble.DOUBLE_BORDER,\n    20 + Bubble.DOUBLE_BORDER,\n  );\n\n  /**\n   * @param workspace The workspace this bubble belongs to.\n   * @param anchor The anchor location of the thing this bubble is attached to.\n   *     The tail of the bubble will point to this location.\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\n   *     when automatically positioning.\n   */\n  constructor(\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    dom.addClass(this.svgRoot, 'blocklyTextInputBubble');\n    ({inputRoot: this.inputRoot, textArea: this.textArea} = this.createEditor(\n      this.contentContainer,\n    ));\n    this.resizeGroup = this.createResizeHandle(this.svgRoot, workspace);\n    this.setSize(this.DEFAULT_SIZE, true);\n  }\n\n  /** @returns the text of this bubble. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the text of this bubble. Calls change listeners. */\n  setText(text: string) {\n    this.text = text;\n    this.textArea.value = text;\n    this.onTextChange();\n  }\n\n  /** Adds a change listener to be notified when this bubble's text changes. */\n  addTextChangeListener(listener: () => void) {\n    this.textChangeListeners.push(listener);\n  }\n\n  /** Adds a change listener to be notified when this bubble's size changes. */\n  addSizeChangeListener(listener: () => void) {\n    this.sizeChangeListeners.push(listener);\n  }\n\n  /** Creates the editor UI for this bubble. */\n  private createEditor(container: SVGGElement): {\n    inputRoot: SVGForeignObjectElement;\n    textArea: HTMLTextAreaElement;\n  } {\n    const inputRoot = dom.createSvgElement(\n      Svg.FOREIGNOBJECT,\n      {\n        'x': Bubble.BORDER_WIDTH,\n        'y': Bubble.BORDER_WIDTH,\n      },\n      container,\n    );\n\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n\n    const textArea = document.createElementNS(\n      dom.HTML_NS,\n      'textarea',\n    ) as HTMLTextAreaElement;\n    textArea.className = 'blocklyTextarea blocklyText';\n    textArea.setAttribute('dir', this.workspace.RTL ? 'RTL' : 'LTR');\n\n    body.appendChild(textArea);\n    inputRoot.appendChild(body);\n\n    this.bindTextAreaEvents(textArea);\n    setTimeout(() => {\n      textArea.focus();\n    }, 0);\n\n    return {inputRoot, textArea};\n  }\n\n  /** Binds events to the text area element. */\n  private bindTextAreaEvents(textArea: HTMLTextAreaElement) {\n    // Don't zoom with mousewheel; let it scroll instead.\n    browserEvents.conditionalBind(textArea, 'wheel', this, (e: Event) => {\n      e.stopPropagation();\n    });\n\n    browserEvents.conditionalBind(\n      textArea,\n      'focus',\n      this,\n      this.onStartEdit,\n      true,\n    );\n    browserEvents.conditionalBind(textArea, 'change', this, this.onTextChange);\n  }\n\n  /** Creates the resize handler elements and binds events to them. */\n  private createResizeHandle(\n    container: SVGGElement,\n    workspace: WorkspaceSvg,\n  ): SVGGElement {\n    const resizeHandle = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyResizeHandle',\n        'href': `${workspace.options.pathToMedia}resize-handle.svg`,\n      },\n      container,\n    );\n\n    browserEvents.conditionalBind(\n      resizeHandle,\n      'pointerdown',\n      this,\n      this.onResizePointerDown,\n    );\n\n    return resizeHandle;\n  }\n\n  /**\n   * Sets the size of this bubble, including the border.\n   *\n   * @param size Sets the size of this bubble, including the border.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  setSize(size: Size, relayout = false) {\n    size.width = Math.max(size.width, this.MIN_SIZE.width);\n    size.height = Math.max(size.height, this.MIN_SIZE.height);\n\n    const widthMinusBorder = size.width - Bubble.DOUBLE_BORDER;\n    const heightMinusBorder = size.height - Bubble.DOUBLE_BORDER;\n    this.inputRoot.setAttribute('width', `${widthMinusBorder}`);\n    this.inputRoot.setAttribute('height', `${heightMinusBorder}`);\n\n    this.resizeGroup.setAttribute('y', `${heightMinusBorder}`);\n    if (this.workspace.RTL) {\n      this.resizeGroup.setAttribute('x', `${-Bubble.DOUBLE_BORDER}`);\n    } else {\n      this.resizeGroup.setAttribute('x', `${widthMinusBorder}`);\n    }\n\n    super.setSize(size, relayout);\n    this.onSizeChange();\n  }\n\n  /** @returns the size of this bubble. */\n  getSize(): Size {\n    // Overriden to be public.\n    return super.getSize();\n  }\n\n  /** Handles mouse down events on the resize target. */\n  private onResizePointerDown(e: PointerEvent) {\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.workspace.startDrag(\n      e,\n      new Coordinate(\n        this.workspace.RTL ? -this.getSize().width : this.getSize().width,\n        this.getSize().height,\n      ),\n    );\n\n    this.resizePointerUpListener = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onResizePointerUp,\n    );\n    this.resizePointerMoveListener = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onResizePointerMove,\n    );\n    this.workspace.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /** Handles pointer up events on the resize target. */\n  private onResizePointerUp(_e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    if (this.resizePointerUpListener) {\n      browserEvents.unbind(this.resizePointerUpListener);\n      this.resizePointerUpListener = null;\n    }\n    if (this.resizePointerMoveListener) {\n      browserEvents.unbind(this.resizePointerMoveListener);\n      this.resizePointerMoveListener = null;\n    }\n  }\n\n  /** Handles pointer move events on the resize target. */\n  private onResizePointerMove(e: PointerEvent) {\n    const delta = this.workspace.moveDrag(e);\n    this.setSize(\n      new Size(this.workspace.RTL ? -delta.x : delta.x, delta.y),\n      false,\n    );\n    this.onSizeChange();\n  }\n\n  /**\n   * Handles starting an edit of the text area. Brings the bubble to the front.\n   */\n  private onStartEdit() {\n    if (this.bringToFront()) {\n      // Since the act of moving this node within the DOM causes a loss of\n      // focus, we need to reapply the focus.\n      this.textArea.focus();\n    }\n  }\n\n  /** Handles a text change event for the text area. Calls event listeners. */\n  private onTextChange() {\n    this.text = this.textArea.value;\n    for (const listener of this.textChangeListeners) {\n      listener();\n    }\n  }\n\n  /** Handles a size change event for the text area. Calls event listeners. */\n  private onSizeChange() {\n    for (const listener of this.sizeChangeListeners) {\n      listener();\n    }\n  }\n}\n\nCss.register(`\n.blocklyTextInputBubble .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 0;\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n`);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Comment\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {IconType} from './icon_types.js';\nimport {Coordinate} from '../utils.js';\nimport * as dom from '../utils/dom.js';\nimport * as eventUtils from '../events/utils.js';\nimport {Icon} from './icon.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport type {ISerializable} from '../interfaces/i_serializable.js';\nimport {Rect} from '../utils/rect.js';\nimport * as registry from './registry.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {TextBubble} from '../bubbles/text_bubble.js';\nimport {TextInputBubble} from '../bubbles/textinput_bubble.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport * as renderManagement from '../render_management.js';\n\n/** The size of the comment icon in workspace-scale units. */\nconst SIZE = 17;\n\n/** The default width in workspace-scale units of the text input bubble. */\nconst DEFAULT_BUBBLE_WIDTH = 160;\n\n/** The default height in workspace-scale units of the text input bubble. */\nconst DEFAULT_BUBBLE_HEIGHT = 80;\n\n/**\n * An icon which allows the user to add comment text to a block.\n */\nexport class CommentIcon extends Icon implements IHasBubble, ISerializable {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.COMMENT;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 3;\n\n  /** The bubble used to show editable text to the user. */\n  private textInputBubble: TextInputBubble | null = null;\n\n  /** The bubble used to show non-editable text to the user. */\n  private textBubble: TextBubble | null = null;\n\n  /** The text of this comment. */\n  private text = '';\n\n  /** The size of this comment (which is applied to the editable bubble). */\n  private bubbleSize = new Size(DEFAULT_BUBBLE_WIDTH, DEFAULT_BUBBLE_HEIGHT);\n\n  /**\n   * The visibility of the bubble for this comment.\n   *\n   * This is used to track what the visibile state /should/ be, not necessarily\n   * what it currently /is/. E.g. sometimes this will be true, but the block\n   * hasn't been rendered yet, so the bubble will not currently be visible.\n   */\n  private bubbleVisiblity = false;\n\n  constructor(protected readonly sourceBlock: Block) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<CommentIcon> {\n    return CommentIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Circle.\n    dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'},\n      this.svgRoot,\n    );\n    // Can't use a real '?' text character since different browsers and\n    // operating systems render it differently. Body of question mark.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd':\n          'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\n          '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\n          '-1.201,0.998 -1.201,1.528 -1.204,2.19z',\n      },\n      this.svgRoot,\n    );\n    // Dot of question mark.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '6.8',\n        'y': '10.78',\n        'height': '2',\n        'width': '2',\n      },\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-comment');\n  }\n\n  override dispose() {\n    super.dispose();\n    this.textInputBubble?.dispose();\n    this.textBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return CommentIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    const colour = (this.sourceBlock as BlockSvg).style.colourPrimary;\n    this.textInputBubble?.setColour(colour);\n    this.textBubble?.setColour(colour);\n  }\n\n  /**\n   * Updates the state of the bubble (editable / noneditable) to reflect the\n   * state of the bubble if the bubble is currently shown.\n   */\n  override async updateEditable(): Promise<void> {\n    super.updateEditable();\n    if (this.bubbleIsVisible()) {\n      // Close and reopen the bubble to display the correct UI.\n      await this.setBubbleVisible(false);\n      await this.setBubbleVisible(true);\n    }\n  }\n\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    const anchorLocation = this.getAnchorLocation();\n    this.textInputBubble?.setAnchorLocation(anchorLocation);\n    this.textBubble?.setAnchorLocation(anchorLocation);\n  }\n\n  /** Sets the text of this comment. Updates any bubbles if they are visible. */\n  setText(text: string) {\n    const oldText = this.text;\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this.sourceBlock,\n        'comment',\n        null,\n        oldText,\n        text,\n      ),\n    );\n    this.text = text;\n    this.textInputBubble?.setText(this.text);\n    this.textBubble?.setText(this.text);\n  }\n\n  /** Returns the text of this comment. */\n  getText(): string {\n    return this.text;\n  }\n\n  /**\n   * Sets the size of the editable bubble for this comment. Resizes the\n   * bubble if it is visible.\n   */\n  setBubbleSize(size: Size) {\n    this.bubbleSize = size;\n    this.textInputBubble?.setSize(this.bubbleSize, true);\n  }\n\n  /** @returns the size of the editable bubble for this comment. */\n  getBubbleSize(): Size {\n    return this.bubbleSize;\n  }\n\n  /**\n   * @returns the state of the comment as a JSON serializable value if the\n   * comment has text. Otherwise returns null.\n   */\n  saveState(): CommentState | null {\n    if (this.text) {\n      return {\n        'text': this.text,\n        'pinned': this.bubbleIsVisible(),\n        'height': this.bubbleSize.height,\n        'width': this.bubbleSize.width,\n      };\n    }\n    return null;\n  }\n\n  /** Applies the given state to this comment. */\n  loadState(state: CommentState) {\n    this.text = state['text'] ?? '';\n    this.bubbleSize = new Size(\n      state['width'] ?? DEFAULT_BUBBLE_WIDTH,\n      state['height'] ?? DEFAULT_BUBBLE_HEIGHT,\n    );\n    this.bubbleVisiblity = state['pinned'] ?? false;\n    this.setBubbleVisible(this.bubbleVisiblity);\n  }\n\n  override onClick(): void {\n    super.onClick();\n    this.setBubbleVisible(!this.bubbleIsVisible());\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  /**\n   * Updates the text of this comment in response to changes in the text of\n   * the input bubble.\n   */\n  onTextChange(): void {\n    if (!this.textInputBubble) return;\n\n    const newText = this.textInputBubble.getText();\n    if (this.text === newText) return;\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this.sourceBlock,\n        'comment',\n        null,\n        this.text,\n        newText,\n      ),\n    );\n    this.text = newText;\n  }\n\n  /**\n   * Updates the size of this icon in response to changes in the size of the\n   * input bubble.\n   */\n  onSizeChange(): void {\n    if (this.textInputBubble) {\n      this.bubbleSize = this.textInputBubble.getSize();\n    }\n  }\n\n  bubbleIsVisible(): boolean {\n    return this.bubbleVisiblity;\n  }\n\n  async setBubbleVisible(visible: boolean): Promise<void> {\n    if (this.bubbleVisiblity === visible) return;\n    this.bubbleVisiblity = visible;\n\n    await renderManagement.finishQueuedRenders();\n\n    if (\n      !this.sourceBlock.rendered ||\n      this.sourceBlock.isInFlyout ||\n      this.sourceBlock.isInsertionMarker()\n    )\n      return;\n\n    if (visible) {\n      if (this.sourceBlock.isEditable()) {\n        this.showEditableBubble();\n      } else {\n        this.showNonEditableBubble();\n      }\n      this.applyColour();\n    } else {\n      this.hideBubble();\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'comment',\n      ),\n    );\n  }\n\n  /**\n   * Shows the editable text bubble for this comment, and adds change listeners\n   * to update the state of this icon in response to changes in the bubble.\n   */\n  private showEditableBubble() {\n    this.textInputBubble = new TextInputBubble(\n      this.sourceBlock.workspace as WorkspaceSvg,\n      this.getAnchorLocation(),\n      this.getBubbleOwnerRect(),\n    );\n    this.textInputBubble.setText(this.getText());\n    this.textInputBubble.setSize(this.bubbleSize, true);\n    this.textInputBubble.addTextChangeListener(() => this.onTextChange());\n    this.textInputBubble.addSizeChangeListener(() => this.onSizeChange());\n  }\n\n  /** Shows the non editable text bubble for this comment. */\n  private showNonEditableBubble() {\n    this.textBubble = new TextBubble(\n      this.getText(),\n      this.sourceBlock.workspace as WorkspaceSvg,\n      this.getAnchorLocation(),\n      this.getBubbleOwnerRect(),\n    );\n  }\n\n  /** Hides any open bubbles owned by this comment. */\n  private hideBubble() {\n    this.textInputBubble?.dispose();\n    this.textInputBubble = null;\n    this.textBubble?.dispose();\n    this.textBubble = null;\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = (this.sourceBlock as BlockSvg).getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n}\n\n/** The save state format for a comment icon. */\nexport interface CommentState {\n  /** The text of the comment. */\n  text?: string;\n\n  /** True if the comment is open, false otherwise. */\n  pinned?: boolean;\n\n  /** The height of the comment bubble. */\n  height?: number;\n\n  /** The width of the comment bubble. */\n  width?: number;\n}\n\nregistry.register(CommentIcon.TYPE, CommentIcon);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Warning\n\nimport type {BlockSvg} from '../block_svg.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as eventUtils from '../events/utils.js';\nimport {Icon} from './icon.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils.js';\nimport {Svg} from '../utils/svg.js';\nimport {TextBubble} from '../bubbles/text_bubble.js';\nimport {IconType} from './icon_types.js';\nimport * as renderManagement from '../render_management.js';\n\n/** The size of the warning icon in workspace-scale units. */\nconst SIZE = 17;\n\n/**\n * An icon that warns the user that something is wrong with their block.\n *\n * For example, this could be used to warn them about incorrect field values,\n * or incorrect placement of the block (putting it somewhere it doesn't belong).\n */\nexport class WarningIcon extends Icon implements IHasBubble {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.WARNING;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 2;\n\n  /** A map of warning IDs to warning text. */\n  private textMap: Map<string, string> = new Map();\n\n  /** The bubble used to display the warnings to the user. */\n  private textBubble: TextBubble | null = null;\n\n  /** @internal */\n  constructor(protected readonly sourceBlock: BlockSvg) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<WarningIcon> {\n    return WarningIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Triangle with rounded corners.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconShape',\n        'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z',\n      },\n      this.svgRoot,\n    );\n    // Can't use a real '!' text character since different browsers and\n    // operating systems render it differently. Body of exclamation point.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z',\n      },\n      this.svgRoot,\n    );\n    // Dot of exclamation point.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '7',\n        'y': '11',\n        'height': '2',\n        'width': '2',\n      },\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-warning');\n  }\n\n  override dispose() {\n    super.dispose();\n    this.textBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return WarningIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    this.textBubble?.setColour(this.sourceBlock.style.colourPrimary);\n  }\n\n  override updateCollapsed(): void {\n    // We are shown when collapsed, so do nothing! I.e. skip the default\n    // behavior of hiding.\n  }\n\n  /** Tells blockly that this icon is shown when the block is collapsed. */\n  override isShownWhenCollapsed(): boolean {\n    return true;\n  }\n\n  /** Updates the location of the icon's bubble if it is open. */\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    this.textBubble?.setAnchorLocation(this.getAnchorLocation());\n  }\n\n  /**\n   * Adds a warning message to this warning icon.\n   *\n   * @param text The text of the message to add.\n   * @param id The id of the message to add.\n   * @internal\n   */\n  addMessage(text: string, id: string): this {\n    if (this.textMap.get(id) === text) return this;\n\n    if (text) {\n      this.textMap.set(id, text);\n    } else {\n      this.textMap.delete(id);\n    }\n\n    this.textBubble?.setText(this.getText());\n    return this;\n  }\n\n  /**\n   * @returns the display text for this icon. Includes all warning messages\n   *     concatenated together with newlines.\n   * @internal\n   */\n  getText(): string {\n    return [...this.textMap.values()].join('\\n');\n  }\n\n  /** Toggles the visibility of the bubble. */\n  override onClick(): void {\n    super.onClick();\n    this.setBubbleVisible(!this.bubbleIsVisible());\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  bubbleIsVisible(): boolean {\n    return !!this.textBubble;\n  }\n\n  async setBubbleVisible(visible: boolean): Promise<void> {\n    if (this.bubbleIsVisible() === visible) return;\n\n    await renderManagement.finishQueuedRenders();\n\n    if (visible) {\n      this.textBubble = new TextBubble(\n        this.getText(),\n        this.sourceBlock.workspace,\n        this.getAnchorLocation(),\n        this.getBubbleOwnerRect(),\n      );\n      this.applyColour();\n    } else {\n      this.textBubble?.dispose();\n      this.textBubble = null;\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'warning',\n      ),\n    );\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IIcon} from '../interfaces/i_icon.js';\n\n/**\n * Thrown when you add more than one icon of the same type to a block.\n */\nexport class DuplicateIconType extends Error {\n  /**\n   * @internal\n   */\n  constructor(public icon: IIcon) {\n    super(\n      `Tried to append an icon of type ${icon.getType()} when an icon of ` +\n        `that type already exists on the block. ` +\n        `Use getIcon to access the existing icon.`,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Icon} from './icons/icon.js';\nimport {CommentIcon, CommentState} from './icons/comment_icon.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport {WarningIcon} from './icons/warning_icon.js';\nimport {IconType} from './icons/icon_types.js';\nimport * as exceptions from './icons/exceptions.js';\nimport * as registry from './icons/registry.js';\n\nexport {\n  Icon,\n  CommentIcon,\n  CommentState,\n  MutatorIcon,\n  WarningIcon,\n  IconType,\n  exceptions,\n  registry,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Types\n\nimport type {Measurable} from './base.js';\nimport type {Row} from './row.js';\n\n/**\n * Types of rendering elements.\n */\nclass TypesContainer {\n  [index: string]: number | Function;\n\n  NONE = 0; // None\n  FIELD = 1 << 0; // Field.\n  HAT = 1 << 1; // Hat.\n  ICON = 1 << 2; // Icon.\n  SPACER = 1 << 3; // Spacer.\n  BETWEEN_ROW_SPACER = 1 << 4; // Between Row Spacer.\n  IN_ROW_SPACER = 1 << 5; // In Row Spacer.\n  EXTERNAL_VALUE_INPUT = 1 << 6; // External Value Input.\n  INPUT = 1 << 7; // Input.\n  INLINE_INPUT = 1 << 8; // Inline Input.\n  STATEMENT_INPUT = 1 << 9; // Statement Input.\n  CONNECTION = 1 << 10; // Connection.\n  PREVIOUS_CONNECTION = 1 << 11; // Previous Connection.\n  NEXT_CONNECTION = 1 << 12; // Next Connection.\n  OUTPUT_CONNECTION = 1 << 13; // Output Connection.\n  CORNER = 1 << 14; // Corner.\n  LEFT_SQUARE_CORNER = 1 << 15; // Square Corner.\n  LEFT_ROUND_CORNER = 1 << 16; // Round Corner.\n  RIGHT_SQUARE_CORNER = 1 << 17; // Right Square Corner.\n  RIGHT_ROUND_CORNER = 1 << 18; // Right Round Corner.\n  JAGGED_EDGE = 1 << 19; // Jagged Edge.\n  ROW = 1 << 20; // Row.\n  TOP_ROW = 1 << 21; // Top Row.\n  BOTTOM_ROW = 1 << 22; // Bottom Row.\n  INPUT_ROW = 1 << 23; // Input Row.\n\n  /**\n   * A Left Corner Union Type.\n   */\n  LEFT_CORNER = this.LEFT_SQUARE_CORNER | this.LEFT_ROUND_CORNER;\n\n  /**\n   * A Right Corner Union Type.\n   */\n  RIGHT_CORNER = this.RIGHT_SQUARE_CORNER | this.RIGHT_ROUND_CORNER;\n\n  /**\n   * Next flag value to use for custom rendering element types.\n   * This must be updated to reflect the next enum flag value\n   * to use if additional elements are added to\n   * `Types`.\n   */\n  nextTypeValue_ = 1 << 24;\n\n  /**\n   * Get the enum flag value of an existing type or register a new type.\n   *\n   * @param type The name of the type.\n   * @returns The enum flag value associated with that type.\n   */\n  getType(type: string): number {\n    if (!Object.prototype.hasOwnProperty.call(this, type)) {\n      this[type] = this.nextTypeValue_;\n      this.nextTypeValue_ <<= 1;\n    }\n    return this[type] as number;\n  }\n\n  /**\n   * Whether a measurable stores information about a field.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a field.\n   */\n  isField(elem: Measurable): number {\n    return elem.type & this.FIELD;\n  }\n\n  /**\n   * Whether a measurable stores information about a hat.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a hat.\n   */\n  isHat(elem: Measurable): number {\n    return elem.type & this.HAT;\n  }\n\n  /**\n   * Whether a measurable stores information about an icon.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an icon.\n   */\n  isIcon(elem: Measurable): number {\n    return elem.type & this.ICON;\n  }\n\n  /**\n   * Whether a measurable stores information about a spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a spacer.\n   */\n  isSpacer(elem: Measurable | Row): number {\n    return elem.type & this.SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an in-row spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an in-row spacer.\n   */\n  isInRowSpacer(elem: Measurable): number {\n    return elem.type & this.IN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an input.\n   */\n  isInput(elem: Measurable): number {\n    return elem.type & this.INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an external input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an external input.\n   */\n  isExternalInput(elem: Measurable): number {\n    return elem.type & this.EXTERNAL_VALUE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an inline input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an inline input.\n   */\n  isInlineInput(elem: Measurable): number {\n    return elem.type & this.INLINE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a statement input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a statement input.\n   */\n  isStatementInput(elem: Measurable): number {\n    return elem.type & this.STATEMENT_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous connection.\n   */\n  isPreviousConnection(elem: Measurable): number {\n    return elem.type & this.PREVIOUS_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a next connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a next connection.\n   */\n  isNextConnection(elem: Measurable): number {\n    return elem.type & this.NEXT_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous or next\n   * connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous or next\n   *     connection.\n   */\n  isPreviousOrNextConnection(elem: Measurable): number {\n    return elem.type & (this.PREVIOUS_CONNECTION | this.NEXT_CONNECTION);\n  }\n\n  /**\n   * Whether a measurable stores information about a left round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left round corner.\n   */\n  isLeftRoundedCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right round corner.\n   */\n  isRightRoundedCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a left square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left square corner.\n   */\n  isLeftSquareCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right square corner.\n   */\n  isRightSquareCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a corner.\n   */\n  isCorner(elem: Measurable): number {\n    return elem.type & this.CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a jagged edge.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a jagged edge.\n   */\n  isJaggedEdge(elem: Measurable): number {\n    return elem.type & this.JAGGED_EDGE;\n  }\n\n  /**\n   * Whether a measurable stores information about a row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a row.\n   */\n  isRow(row: Row): number {\n    return row.type & this.ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a between-row spacer.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a between-row spacer.\n   */\n  isBetweenRowSpacer(row: Row): number {\n    return row.type & this.BETWEEN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about a top row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top row.\n   */\n  isTopRow(row: Row): number {\n    return row.type & this.TOP_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a bottom row.\n   */\n  isBottomRow(row: Row): number {\n    return row.type & this.BOTTOM_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a top or bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top or bottom row.\n   */\n  isTopOrBottomRow(row: Row): number {\n    return row.type & (this.TOP_ROW | this.BOTTOM_ROW);\n  }\n\n  /**\n   * Whether a measurable stores information about an input row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about an input row.\n   */\n  isInputRow(row: Row): number {\n    return row.type & this.INPUT_ROW;\n  }\n}\n\nexport const Types = new TypesContainer();\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Measurable\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Types} from './types.js';\n\n/**\n * The base class to represent a part of a block that takes up space during\n * rendering.  The constructor for each non-spacer Measurable records the size\n * of the block element (e.g. field, statement input).\n */\nexport class Measurable {\n  width = 0;\n\n  height = 0;\n  type: number;\n  xPos = 0;\n\n  centerline = 0;\n  notchOffset: number;\n\n  /** The renderer's constant provider. */\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    this.constants_ = constants;\n\n    this.type = Types.NONE;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Row\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {Measurable} from './base.js';\nimport type {InRowSpacer} from './in_row_spacer.js';\nimport type {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object representing a single row on a rendered block and all of its\n * subcomponents.\n */\nexport class Row {\n  type: number;\n\n  /**\n   * An array of elements contained in this row.\n   */\n  elements: Measurable[] = [];\n\n  /**\n   * The height of the row.\n   */\n  height = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the right.\n   * Does not include child blocks unless they are inline.\n   */\n  width = 0;\n\n  /**\n   * The minimum height of the row.\n   */\n  minHeight = 0;\n\n  /**\n   * The minimum width of the row, from the left edge of the block to the\n   * right. Does not include child blocks unless they are inline.\n   */\n  minWidth = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the edge of the\n   * block or any connected child blocks.\n   */\n  widthWithConnectedBlocks = 0;\n\n  /**\n   * The Y position of the row relative to the origin of the block's svg\n   * group.\n   */\n  yPos = 0;\n\n  /**\n   * The X position of the row relative to the origin of the block's svg\n   * group.\n   */\n  xPos = 0;\n\n  /**\n   * Whether the row has any external inputs.\n   */\n  hasExternalInput = false;\n\n  /**\n   * Whether the row has any statement inputs.\n   */\n  hasStatement = false;\n\n  /**\n   * Where the left edge of all of the statement inputs on the block should\n   * be. This makes sure that statement inputs which are proceded by fields\n   * of varius widths are all aligned.\n   */\n  statementEdge = 0;\n\n  /**\n   * Whether the row has any inline inputs.\n   */\n  hasInlineInput = false;\n\n  /**\n   * Whether the row has any dummy inputs or end-row inputs.\n   */\n  hasDummyInput = false;\n\n  /**\n   * Whether the row has a jagged edge.\n   */\n  hasJaggedEdge = false;\n  notchOffset: number;\n\n  /**\n   * Alignment of the row.\n   */\n  align: number | null = null;\n\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constants_ = constants;\n\n    /** The type of this rendering object. */\n    this.type = Types.ROW;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n\n  /**\n   * Get the last input on this row, if it has one.\n   *\n   * @returns The last input on the row, or null.\n   */\n  getLastInput(): InputConnection | null {\n    // TODO: Consider moving this to InputRow, if possible.\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isInput(elem)) {\n        return elem as InputConnection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  measure() {\n    throw Error('Unexpected attempt to measure a base Row.');\n  }\n\n  /**\n   * Determines whether this row should start with an element spacer.\n   *\n   * @returns Whether the row should start with a spacer.\n   */\n  startsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Determines whether this row should end with an element spacer.\n   *\n   * @returns Whether the row should end with a spacer.\n   */\n  endsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Convenience method to get the first spacer element on this row.\n   *\n   * @returns The first spacer element on this row.\n   */\n  getFirstSpacer(): InRowSpacer | null {\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Convenience method to get the last spacer element on this row.\n   *\n   * @returns The last spacer element on this row.\n   */\n  getLastSpacer(): InRowSpacer | null {\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.BottomRow\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {NextConnection} from './next_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the bottom row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends Row {\n  /**\n   * Whether this row has a next connection.\n   */\n  hasNextConnection = false;\n\n  /**\n   * The next connection on the row, if any.\n   */\n  connection: NextConnection | null = null;\n\n  /**\n   * The amount that the bottom of the block extends below the horizontal\n   * edge, e.g. because of a next connection.  Must be non-negative (see\n   * #2820).\n   */\n  descenderHeight = 0;\n\n  /**\n   * The Y position of the bottom edge of the block, relative to the origin\n   * of the block rendering.\n   */\n  baseline = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.BOTTOM_ROW;\n  }\n\n  /**\n   * Returns whether or not the bottom row has a left square corner.\n   *\n   * @param block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    return !!block.outputConnection || !!block.getNextBlock();\n  }\n\n  /**\n   * Returns whether or not the bottom row has a right square corner.\n   *\n   * @param _block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let descenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        // Note: this assumes that next connections have *only* descenderHeight,\n        // with no height above the baseline.\n        if (Types.isNextConnection(elem)) {\n          descenderHeight = Math.max(descenderHeight, elem.height);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + descenderHeight;\n    this.descenderHeight = descenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Connection\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider, Shape} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent a connection and the space that it takes up on\n * the block.\n */\nexport class Connection extends Measurable {\n  shape: Shape;\n  isDynamicShape: boolean;\n  highlighted: boolean;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public connectionModel: RenderedConnection,\n  ) {\n    super(constants);\n\n    this.type |= Types.CONNECTION;\n\n    this.shape = this.constants_.shapeFor(connectionModel);\n    this.isDynamicShape = 'isDynamic' in this.shape && this.shape.isDynamic;\n\n    this.highlighted = connectionModel.isHighlighted();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InputConnection\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../inputs/input.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent an input that takes up space on a block\n * during rendering.\n */\nexport class InputConnection extends Connection {\n  align: number;\n  connectedBlock: BlockSvg | null;\n  connectedBlockWidth: number;\n  connectedBlockHeight: number;\n  connectionOffsetX = 0;\n  connectionOffsetY = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The input to measure and store information for.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public input: Input,\n  ) {\n    super(constants, input.connection as RenderedConnection);\n\n    this.type |= Types.INPUT;\n\n    this.align = input.align;\n\n    this.connectedBlock =\n      input.connection && input.connection.targetBlock()\n        ? (input.connection.targetBlock() as BlockSvg)\n        : null;\n\n    if (this.connectedBlock) {\n      const bBox = this.connectedBlock.getHeightWidth();\n      this.connectedBlockWidth = bBox.width;\n      this.connectedBlockHeight = bBox.height;\n    } else {\n      this.connectedBlockWidth = 0;\n      this.connectedBlockHeight = 0;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.ExternalValueInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an external value input\n * takes up during rendering\n */\nexport class ExternalValueInput extends InputConnection {\n  override height = 0;\n  override width: number;\n  override connectionOffsetY: number;\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The external value input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.EXTERNAL_VALUE_INPUT;\n    if (!this.connectedBlock) {\n      this.height = this.shape.height as number;\n    } else {\n      this.height =\n        this.connectedBlockHeight -\n        this.constants_.TAB_OFFSET_FROM_TOP -\n        this.constants_.MEDIUM_PADDING;\n    }\n\n    this.width =\n      (this.shape.width as number) +\n      this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionHeight = this.shape.height as number;\n\n    this.connectionWidth = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Field\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Field as BlocklyField} from '../../field.js';\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a field takes up during\n * rendering\n */\nexport class Field extends Measurable {\n  isEditable: boolean;\n  flipRtl: boolean;\n  override height: number;\n  override width: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param field The field to measure and store information for.\n   * @param parentInput The parent input for the field.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public field: BlocklyField,\n    public parentInput: Input,\n  ) {\n    super(constants);\n\n    this.isEditable = field.EDITABLE;\n\n    this.flipRtl = field.getFlipRtl();\n    this.type |= Types.FIELD;\n\n    const size = this.field.getSize();\n\n    this.height = size.height;\n\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Hat\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a hat takes up during\n * rendering.\n */\nexport class Hat extends Measurable {\n  ascenderHeight: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.HAT;\n\n    this.height = this.constants_.START_HAT.height;\n    this.width = this.constants_.START_HAT.width;\n\n    this.ascenderHeight = this.height;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Icon\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {IIcon as BlocklyIcon} from '../../interfaces/i_icon.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an icon takes up during\n * rendering.\n */\nexport class Icon extends Measurable {\n  flipRtl = false;\n\n  /**\n   * An object containing information about the space an icon takes up during\n   * rendering.\n   *\n   * @param constants The rendering constants provider.\n   * @param icon The icon to measure and store information for.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public icon: BlocklyIcon,\n  ) {\n    super(constants);\n\n    this.type |= Types.ICON;\n\n    const size = icon.getSize();\n    this.height = size.height;\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InRowSpacer\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a spacer between two elements on a\n * row.\n */\nexport class InRowSpacer extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param width The width of the spacer.\n   */\n  constructor(constants: ConstantProvider, width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.IN_ROW_SPACER;\n    this.width = width;\n    this.height = this.constants_.SPACER_DEFAULT_HEIGHT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InlineInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends InputConnection {\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.INLINE_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_INLINE_INPUT_HEIGHT;\n      this.width = this.constants_.EMPTY_INLINE_INPUT_PADDING;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width = this.connectedBlockWidth;\n      this.height = this.connectedBlockHeight;\n    }\n\n    this.connectionHeight = !this.isDynamicShape\n      ? (this.shape.height as number)\n      : (this.shape.height as (p1: number) => number)(this.height);\n\n    this.connectionWidth = !this.isDynamicShape\n      ? (this.shape.width as number)\n      : (this.shape.width as (p1: number) => number)(this.height);\n    if (!this.connectedBlock) {\n      this.width += this.connectionWidth * (this.isDynamicShape ? 2 : 1);\n    }\n\n    this.connectionOffsetY =\n      'connectionOffsetY' in this.shape\n        ? this.shape.connectionOffsetY(this.connectionHeight)\n        : this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionOffsetX =\n      'connectionOffsetX' in this.shape\n        ? this.shape.connectionOffsetX(this.connectionWidth)\n        : 0;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.StatementInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering\n */\nexport class StatementInput extends InputConnection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.STATEMENT_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height =\n        this.connectedBlockHeight + this.constants_.STATEMENT_BOTTOM_SPACER;\n    }\n    this.width =\n      this.constants_.STATEMENT_INPUT_NOTCH_OFFSET +\n      (this.shape.width as number);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InputRow\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {ExternalValueInput} from './external_value_input.js';\nimport {InputConnection} from './input_connection.js';\nimport {Row} from './row.js';\nimport {StatementInput} from './statement_input.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a row that holds one or more inputs.\n */\nexport class InputRow extends Row {\n  /**\n   * The total width of all blocks connected to this row.\n   */\n  connectedBlockWidths = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.INPUT_ROW;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  override measure() {\n    this.width = this.minWidth;\n    this.height = this.minHeight;\n    let connectedBlockWidths = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      this.width += elem.width;\n      if (Types.isInput(elem) && elem instanceof InputConnection) {\n        if (Types.isStatementInput(elem) && elem instanceof StatementInput) {\n          connectedBlockWidths += elem.connectedBlockWidth;\n        } else if (\n          Types.isExternalInput(elem) &&\n          elem instanceof ExternalValueInput &&\n          elem.connectedBlockWidth !== 0\n        ) {\n          connectedBlockWidths +=\n            elem.connectedBlockWidth - elem.connectionWidth;\n        }\n      }\n      if (!Types.isSpacer(elem)) {\n        this.height = Math.max(this.height, elem.height);\n      }\n    }\n    this.connectedBlockWidths = connectedBlockWidths;\n    this.widthWithConnectedBlocks = this.width + connectedBlockWidths;\n  }\n\n  override endsWithElemSpacer() {\n    return !this.hasExternalInput && !this.hasStatement;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.JaggedEdge\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space the jagged edge of a\n * collapsed block takes up during rendering.\n */\nexport class JaggedEdge extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.JAGGED_EDGE;\n    this.height = this.constants_.JAGGED_TEETH.height;\n    this.width = this.constants_.JAGGED_TEETH.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.NextConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a next connection takes\n * up during rendering.\n */\nexport class NextConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.NEXT_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.OutputConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an output connection takes\n * up during rendering.\n */\nexport class OutputConnection extends Connection {\n  startX: number;\n  connectionOffsetY: number;\n  connectionOffsetX = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.OUTPUT_CONNECTION;\n\n    this.height = !this.isDynamicShape ? (this.shape.height as number) : 0;\n    this.width = !this.isDynamicShape ? (this.shape.width as number) : 0;\n\n    this.startX = this.width;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.PreviousConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a previous connection takes\n * up during rendering.\n */\nexport class PreviousConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.PREVIOUS_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.RoundCorner\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a rounded corner takes up\n * during rendering.\n */\nexport class RoundCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n      (!opt_position || opt_position === 'left'\n        ? Types.LEFT_ROUND_CORNER\n        : Types.RIGHT_ROUND_CORNER) | Types.CORNER;\n    this.width = this.constants_.CORNER_RADIUS;\n    // The rounded corner extends into the next row by 4 so we only take the\n    // height that is aligned with this row.\n    this.height = this.constants_.CORNER_RADIUS / 2;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.SpacerRow\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InRowSpacer} from './in_row_spacer.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a spacer between two rows.\n */\nexport class SpacerRow extends Row {\n  followsStatement = false;\n\n  precedesStatement = false;\n\n  override widthWithConnectedBlocks = 0;\n  override elements: InRowSpacer[];\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param height The height of the spacer.\n   * @param width The width of the spacer.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public override height: number,\n    public override width: number,\n  ) {\n    super(constants);\n    this.type |= Types.SPACER | Types.BETWEEN_ROW_SPACER;\n\n    this.elements = [new InRowSpacer(this.constants_, width)];\n  }\n\n  override measure() {}\n}\n// NOP.  Width and height were set at creation.\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.SquareCorner\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a square corner takes up\n * during rendering.\n */\nexport class SquareCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n      (!opt_position || opt_position === 'left'\n        ? Types.LEFT_SQUARE_CORNER\n        : Types.RIGHT_SQUARE_CORNER) | Types.CORNER;\n    this.height = this.constants_.NO_PADDING;\n    this.width = this.constants_.NO_PADDING;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.TopRow\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Hat} from './hat.js';\nimport type {PreviousConnection} from './previous_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends Row {\n  /**\n   * The starting point for drawing the row, in the y direction.\n   * This allows us to draw hats and similar shapes that don't start at the\n   * origin. Must be non-negative (see #2820).\n   */\n  capline = 0;\n\n  /** How much the row extends up above its capline. */\n  ascenderHeight = 0;\n\n  /** Whether the block has a previous connection. */\n  hasPreviousConnection = false;\n\n  /** The previous connection on the block, if any. */\n  connection: PreviousConnection | null = null;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n\n    this.type |= Types.TOP_ROW;\n  }\n\n  /**\n   * Returns whether or not the top row has a left square corner.\n   *\n   * @param block The block whose top row this represents.\n   * @returns Whether or not the top row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    const hasHat =\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n      !block.outputConnection &&\n      !block.previousConnection;\n    const prevBlock = block.getPreviousBlock();\n\n    return (\n      !!block.outputConnection ||\n      hasHat ||\n      (prevBlock ? prevBlock.getNextBlock() === block : false)\n    );\n  }\n\n  /**\n   * Returns whether or not the top row has a right square corner.\n   *\n   * @param _block The block whose top row this represents.\n   * @returns Whether or not the top row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let ascenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        if (Types.isHat(elem) && elem instanceof Hat) {\n          ascenderHeight = Math.max(ascenderHeight, elem.ascenderHeight);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + ascenderHeight;\n    this.ascenderHeight = ascenderHeight;\n    this.capline = this.ascenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Coordinate} from '../../utils.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport type {Icon} from '../measurables/icon.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {PreviousConnection} from '../measurables/previous_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {isDynamicShape, isNotch, isPuzzleTab} from './constants.js';\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport {ConnectionType} from '../../connection_type.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer {\n  block_: BlockSvg;\n  info_: RenderInfo;\n  topLeft_: Coordinate;\n  outlinePath_ = '';\n  inlinePath_ = '';\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    this.block_ = block;\n    this.info_ = info;\n    this.topLeft_ = block.getRelativeToSurfaceXY();\n\n    /** The renderer's constant provider. */\n    this.constants_ = info.getRenderer().getConstants();\n  }\n\n  /**\n   * Draw the block to the workspace. Here \"drawing\" means setting SVG path\n   * elements and moving fields, icons, and connections on the screen.\n   *\n   * The pieces of the paths are pushed into arrays of \"steps\", which are then\n   * joined with spaces and set directly on the block.  This guarantees that\n   * the steps are separated by spaces for improved readability, but isn't\n   * required.\n   */\n  draw() {\n    this.drawOutline_();\n    this.drawInternals_();\n    this.updateConnectionHighlights();\n\n    this.block_.pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      this.block_.pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  /**\n   * Save sizing information back to the block\n   * Most of the rendering information can be thrown away at the end of the\n   * render. Anything that needs to be kept around should be set in this\n   * function.\n   */\n  protected recordSizeOnBlock_() {\n    // This is used when the block is reporting its size to anyone else.\n    // The dark path adds to the size of the block in both X and Y.\n    this.block_.height = this.info_.height;\n    this.block_.width = this.info_.widthWithChildren;\n  }\n\n  /** Create the outline of the block.  This is a single continuous path. */\n  protected drawOutline_() {\n    this.drawTop_();\n    for (let r = 1; r < this.info_.rows.length - 1; r++) {\n      const row = this.info_.rows[r];\n      if (row.hasJaggedEdge) {\n        this.drawJaggedEdge_(row);\n      } else if (row.hasStatement) {\n        this.drawStatementInput_(row);\n      } else if (row.hasExternalInput) {\n        this.drawValueInput_(row);\n      } else {\n        this.drawRightSideRow_(row);\n      }\n    }\n    this.drawBottom_();\n    this.drawLeft_();\n  }\n\n  /**\n   * Add steps for the top corner of the block, taking into account\n   * details such as hats and rounded corners.\n   */\n  protected drawTop_() {\n    const topRow = this.info_.topRow;\n    const elements = topRow.elements;\n\n    this.positionPreviousConnection_();\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    for (let i = 0, elem; (elem = elements[i]); i++) {\n      if (Types.isLeftRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topRight;\n      } else if (\n        Types.isPreviousConnection(elem) &&\n        elem instanceof Connection\n      ) {\n        this.outlinePath_ += (\n          (elem as PreviousConnection).shape as Notch\n        ).pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.outlinePath_ += this.constants_.START_HAT.path;\n      } else if (Types.isSpacer(elem)) {\n        this.outlinePath_ += svgPaths.lineOnAxis('h', elem.width);\n      }\n    }\n    // No branch for a square corner, because it's a no-op.\n    this.outlinePath_ += svgPaths.lineOnAxis('v', topRow.height);\n  }\n\n  /**\n   * Add steps for the jagged edge of a row on a collapsed block.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawJaggedEdge_(row: Row) {\n    const remainder = row.height - this.constants_.JAGGED_TEETH.height;\n    this.outlinePath_ +=\n      this.constants_.JAGGED_TEETH.path + svgPaths.lineOnAxis('v', remainder);\n  }\n\n  /**\n   * Add steps for an external value input, rendered as a notch in the side\n   * of the block.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawValueInput_(row: Row) {\n    const input = row.getLastInput() as ExternalValueInput | InlineInput;\n    this.positionExternalValueConnection_(row);\n\n    const pathDown = isDynamicShape(input.shape)\n      ? input.shape.pathDown(input.height)\n      : (input.shape as PuzzleTab).pathDown;\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', input.xPos + input.width) +\n      pathDown +\n      svgPaths.lineOnAxis('v', row.height - input.connectionHeight);\n  }\n\n  /**\n   * Add steps for a statement input.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawStatementInput_(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as Notch).width;\n\n    const innerTopLeftCorner =\n      (input.shape as Notch).pathRight +\n      svgPaths.lineOnAxis(\n        'h',\n        -(input.notchOffset - this.constants_.INSIDE_CORNERS.width),\n      ) +\n      this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', x) +\n      innerTopLeftCorner +\n      svgPaths.lineOnAxis('v', innerHeight) +\n      this.constants_.INSIDE_CORNERS.pathBottom +\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawRightSideRow_(row: Row) {\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps for the bottom edge of a block, possibly including a notch\n   * for the next connection.\n   */\n  protected drawBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    const elems = bottomRow.elements;\n    this.positionNextConnection_();\n\n    let rightCornerYOffset = 0;\n    let outlinePath = '';\n    for (let i = elems.length - 1, elem; (elem = elems[i]); i--) {\n      if (Types.isNextConnection(elem) && elem instanceof Connection) {\n        outlinePath += (elem.shape as Notch).pathRight;\n      } else if (Types.isLeftSquareCorner(elem)) {\n        outlinePath += svgPaths.lineOnAxis('H', bottomRow.xPos);\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomRight;\n        rightCornerYOffset = this.constants_.OUTSIDE_CORNERS.rightHeight;\n      } else if (Types.isSpacer(elem)) {\n        outlinePath += svgPaths.lineOnAxis('h', elem.width * -1);\n      }\n    }\n\n    this.outlinePath_ += svgPaths.lineOnAxis(\n      'V',\n      bottomRow.baseline - rightCornerYOffset,\n    );\n    this.outlinePath_ += outlinePath;\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected drawLeft_() {\n    const outputConnection = this.info_.outputConnection;\n    this.positionOutputConnection_();\n\n    if (outputConnection) {\n      const tabBottom =\n        outputConnection.connectionOffsetY + outputConnection.height;\n      const pathUp = isDynamicShape(outputConnection.shape)\n        ? outputConnection.shape.pathUp(outputConnection.height)\n        : (outputConnection.shape as PuzzleTab).pathUp;\n\n      // Draw a line up to the bottom of the tab.\n      this.outlinePath_ += svgPaths.lineOnAxis('V', tabBottom) + pathUp;\n    }\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /**\n   * Draw the internals of the block: inline inputs, fields, and icons.  These\n   * do not depend on the outer path for placement.\n   */\n  protected drawInternals_() {\n    for (let i = 0, row; (row = this.info_.rows[i]); i++) {\n      for (let j = 0, elem; (elem = row.elements[j]); j++) {\n        if (Types.isInlineInput(elem)) {\n          this.drawInlineInput_(elem as InlineInput);\n        } else if (Types.isIcon(elem) || Types.isField(elem)) {\n          this.layoutField_(elem as Field | Icon);\n        }\n      }\n    }\n  }\n\n  /**\n   * Push a field or icon's new position to its SVG root.\n   *\n   * @param fieldInfo The rendering information for the field or icon.\n   */\n  protected layoutField_(fieldInfo: Icon | Field) {\n    const yPos = fieldInfo.centerline - fieldInfo.height / 2;\n    let xPos = fieldInfo.xPos;\n    let scale = '';\n    if (this.info_.RTL) {\n      xPos = -(xPos + fieldInfo.width);\n      if (fieldInfo.flipRtl) {\n        xPos += fieldInfo.width;\n        scale = 'scale(-1 1)';\n      }\n    }\n\n    if (Types.isIcon(fieldInfo)) {\n      const icon = (fieldInfo as Icon).icon;\n      icon.setOffsetInBlock(new Coordinate(xPos, yPos));\n      if (this.info_.isInsertionMarker) {\n        icon.hideForInsertionMarker();\n      }\n    } else {\n      const svgGroup = (fieldInfo as Field).field.getSvgRoot()!;\n      svgGroup.setAttribute(\n        'transform',\n        'translate(' + xPos + ',' + yPos + ')' + scale,\n      );\n      if (this.info_.isInsertionMarker) {\n        svgGroup.setAttribute('display', 'none');\n      }\n    }\n  }\n\n  /**\n   * Add steps for an inline input.\n   *\n   * @param input The information about the input to render.\n   */\n  protected drawInlineInput_(input: InlineInput) {\n    const width = input.width;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionTop = input.connectionOffsetY;\n    const connectionBottom = input.connectionHeight + connectionTop;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    this.inlinePath_ +=\n      svgPaths.moveTo(connectionRight, yPos) +\n      svgPaths.lineOnAxis('v', connectionTop) +\n      (input.shape as PuzzleTab).pathDown +\n      svgPaths.lineOnAxis('v', height - connectionBottom) +\n      svgPaths.lineOnAxis('h', width - input.connectionWidth) +\n      svgPaths.lineOnAxis('v', -height) +\n      'z';\n\n    this.positionInlineInputConnection_(input);\n  }\n\n  /**\n   * Position the connection on an inline value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param input The information about the input that the connection is on.\n   */\n  protected positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX = input.xPos + input.connectionWidth + input.connectionOffsetX;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        yPos + input.connectionOffsetY,\n      );\n    }\n  }\n\n  /**\n   * Position the connection on a statement input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /**\n   * Position the connection on an external value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /** Position the previous connection on a block. */\n  protected positionPreviousConnection_() {\n    const topRow = this.info_.topRow;\n    if (topRow.connection) {\n      const x = topRow.xPos + topRow.notchOffset;\n      const connX = this.info_.RTL ? -x : x;\n      topRow.connection.connectionModel.setOffsetInBlock(connX, 0);\n    }\n  }\n\n  /** Position the next connection on a block. */\n  protected positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos; // Already contains info about startX.\n      const connX = this.info_.RTL ? -x : x;\n      connInfo.connectionModel.setOffsetInBlock(connX, bottomRow.baseline);\n    }\n  }\n\n  /** Position the output connection on a block. */\n  protected positionOutputConnection_() {\n    if (this.info_.outputConnection) {\n      const x =\n        this.info_.startX + this.info_.outputConnection.connectionOffsetX;\n      const connX = this.info_.RTL ? -x : x;\n      this.block_.outputConnection.setOffsetInBlock(\n        connX,\n        this.info_.outputConnection.connectionOffsetY,\n      );\n    }\n  }\n\n  /**\n   * Updates the path object to reflect which connections on the block are\n   * highlighted.\n   */\n  protected updateConnectionHighlights() {\n    for (const row of this.info_.rows) {\n      for (const elem of row.elements) {\n        if (!(elem instanceof Connection)) continue;\n\n        if (elem.highlighted) {\n          this.drawConnectionHighlightPath(elem);\n        } else {\n          this.block_.pathObject.removeConnectionHighlight?.(\n            elem.connectionModel,\n          );\n        }\n      }\n    }\n  }\n\n  /** Returns a path to highlight the given connection. */\n  drawConnectionHighlightPath(measurable: Connection) {\n    const conn = measurable.connectionModel;\n    let path = '';\n    if (\n      conn.type === ConnectionType.INPUT_VALUE ||\n      conn.type === ConnectionType.OUTPUT_VALUE\n    ) {\n      path = this.getExpressionConnectionHighlightPath(measurable);\n    } else {\n      path = this.getStatementConnectionHighlightPath(measurable);\n    }\n    const block = conn.getSourceBlock();\n    block.pathObject.addConnectionHighlight?.(\n      conn,\n      path,\n      conn.getOffsetInBlock(),\n      block.RTL,\n    );\n  }\n\n  /**\n   * Returns a path to highlight the given conneciton, assuming it is an\n   * input or output connection.\n   */\n  private getExpressionConnectionHighlightPath(connection: Connection): string {\n    let connPath = '';\n    if (isDynamicShape(connection.shape)) {\n      connPath = connection.shape.pathDown(connection.height);\n    } else if (isPuzzleTab(connection.shape)) {\n      connPath = connection.shape.pathDown;\n    }\n\n    // We are assuming that there is room for the tab offset above and below\n    // the tab.\n    const yLen = this.constants_.TAB_OFFSET_FROM_TOP;\n    return (\n      svgPaths.moveBy(0, -yLen) +\n      svgPaths.lineOnAxis('v', yLen) +\n      connPath +\n      svgPaths.lineOnAxis('v', yLen)\n    );\n  }\n\n  /**\n   * Returns a path to highlight the given conneciton, assuming it is a\n   * next or previous connection.\n   */\n  private getStatementConnectionHighlightPath(connection: Connection): string {\n    if (!isNotch(connection.shape)) {\n      throw new Error('Statement connections should have notch shapes');\n    }\n\n    const xLen =\n      this.constants_.NOTCH_OFFSET_LEFT - this.constants_.CORNER_RADIUS;\n    return (\n      svgPaths.moveBy(-xLen, 0) +\n      svgPaths.lineOnAxis('h', xLen) +\n      connection.shape.pathLeft +\n      svgPaths.lineOnAxis('h', xLen)\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Enum for alignment of inputs.\n */\nexport enum Align {\n  LEFT = -1,\n  CENTRE = 0,\n  RIGHT = 1,\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, non-serializable text field.  Used for titles,\n *    labels, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldLabel\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, non-serializable text field.\n */\nexport class FieldLabel extends Field<string> {\n  /** The HTML class name to use for this field. */\n  private class: string | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /** Text labels should not truncate. */\n  override maxDisplayLength = Infinity;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    textClass?: string,\n    config?: FieldLabelConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.class = textClass || null;\n    }\n    this.setValue(value);\n  }\n\n  protected override configure_(config: FieldLabelConfig) {\n    super.configure_(config);\n    if (config.class) this.class = config.class;\n  }\n\n  /**\n   * Create block UI for this label.\n   */\n  override initView() {\n    this.createTextElement_();\n    if (this.class) {\n      dom.addClass(this.getTextElement(), this.class);\n    }\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Set the CSS class applied to the field's textElement_.\n   *\n   * @param cssClass The new CSS class name, or null to remove.\n   */\n  setClass(cssClass: string | null) {\n    if (this.textElement_) {\n      if (this.class) {\n        dom.removeClass(this.textElement_, this.class);\n      }\n      if (cssClass) {\n        dom.addClass(this.textElement_, cssClass);\n      }\n    }\n    this.class = cssClass;\n  }\n\n  /**\n   * Construct a FieldLabel from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldLabelFromJsonConfig): FieldLabel {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabel if that class doesn't override\n    // the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label', FieldLabel);\n\nFieldLabel.prototype.DEFAULT_VALUE = '';\n\n// clang-format off\n// Clang does not like the 'class' keyword being used as a property.\n/**\n * Config options for the label field.\n */\nexport interface FieldLabelConfig extends FieldConfig {\n  class?: string;\n}\n// clang-format on\n\n/**\n * fromJson config options for the label field.\n */\nexport interface FieldLabelFromJsonConfig extends FieldLabelConfig {\n  text?: string;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an input (value, statement, or dummy).\n *\n * @class\n */\n// Former goog.module ID: Blockly.Input\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../field_label.js';\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport type {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport * as fieldRegistry from '../field_registry.js';\nimport type {RenderedConnection} from '../rendered_connection.js';\nimport {inputTypes} from './input_types.js';\nimport {Align} from './align.js';\n\n/** Class for an input with optional fields. */\nexport class Input {\n  fieldRow: Field[] = [];\n  /** Alignment of input's fields (left, right or centre). */\n  align = Align.LEFT;\n\n  /** Is the input visible? */\n  private visible = true;\n\n  public readonly type: inputTypes = inputTypes.CUSTOM;\n\n  public connection: Connection | null = null;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param sourceBlock The block containing this input.\n   */\n  constructor(\n    public name: string,\n    private sourceBlock: Block,\n  ) {}\n\n  /**\n   * Get the source block for this input.\n   *\n   * @returns The block this input is part of.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock;\n  }\n\n  /**\n   * Add a field (or label from string), and all prefix and suffix fields, to\n   * the end of the input's field row.\n   *\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The input being append to (to allow chaining).\n   */\n  appendField<T>(field: string | Field<T>, opt_name?: string): Input {\n    this.insertFieldAt(this.fieldRow.length, field, opt_name);\n    return this;\n  }\n\n  /**\n   * Inserts a field (or label from string), and all prefix and suffix fields,\n   * at the location of the input's field row.\n   *\n   * @param index The index at which to insert field.\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The index following the last inserted field.\n   */\n  insertFieldAt<T>(\n    index: number,\n    field: string | Field<T>,\n    opt_name?: string,\n  ): number {\n    if (index < 0 || index > this.fieldRow.length) {\n      throw Error('index ' + index + ' out of bounds.');\n    }\n    // Falsy field values don't generate a field, unless the field is an empty\n    // string and named.\n    if (!field && !(field === '' && opt_name)) {\n      return index;\n    }\n\n    // Generate a FieldLabel when given a plain text field.\n    if (typeof field === 'string') {\n      field = fieldRegistry.fromJson({\n        type: 'field_label',\n        text: field,\n      })!;\n    }\n\n    field.setSourceBlock(this.sourceBlock);\n    if (this.sourceBlock.initialized) this.initField(field);\n    field.name = opt_name;\n    field.setVisible(this.isVisible());\n\n    if (field.prefixField) {\n      // Add any prefix.\n      index = this.insertFieldAt(index, field.prefixField);\n    }\n    // Add the field to the field row.\n    this.fieldRow.splice(index, 0, field as Field);\n    index++;\n    if (field.suffixField) {\n      // Add any suffix.\n      index = this.insertFieldAt(index, field.suffixField);\n    }\n\n    if (this.sourceBlock.rendered) {\n      (this.sourceBlock as BlockSvg).queueRender();\n    }\n    return index;\n  }\n\n  /**\n   * Remove a field from this input.\n   *\n   * @param name The name of the field.\n   * @param opt_quiet True to prevent an error if field is not present.\n   * @returns True if operation succeeds, false if field is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the field is not present and opt_quiet is false.\n   */\n  removeField(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\n      if (field.name === name) {\n        field.dispose();\n        this.fieldRow.splice(i, 1);\n        if (this.sourceBlock.rendered) {\n          (this.sourceBlock as BlockSvg).queueRender();\n        }\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Field \"' + name + '\" not found.');\n  }\n\n  /**\n   * Gets whether this input is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Sets whether this input is visible or not.\n   * Should only be used to collapse/uncollapse a block.\n   *\n   * @param visible True if visible.\n   * @returns List of blocks to render.\n   * @internal\n   */\n  setVisible(visible: boolean): BlockSvg[] {\n    // Note: Currently there are only unit tests for block.setCollapsed()\n    // because this function is package. If this function goes back to being a\n    // public API tests (lots of tests) should be added.\n    let renderList: AnyDuringMigration[] = [];\n    if (this.visible === visible) {\n      return renderList;\n    }\n    this.visible = visible;\n\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\n      field.setVisible(visible);\n    }\n    if (this.connection) {\n      const renderedConnection = this.connection as RenderedConnection;\n      // Has a connection.\n      if (visible) {\n        renderList = renderedConnection.startTrackingAll();\n      } else {\n        renderedConnection.stopTrackingAll();\n      }\n      const child = renderedConnection.targetBlock();\n      if (child) {\n        child.getSvgRoot().style.display = visible ? 'block' : 'none';\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Mark all fields on this input as dirty.\n   *\n   * @internal\n   */\n  markDirty() {\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\n      field.markDirty();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types.  Null if all\n   *     types are compatible.\n   * @returns The input being modified (to allow chaining).\n   */\n  setCheck(check: string | string[] | null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setCheck(check);\n    return this;\n  }\n\n  /**\n   * Change the alignment of the connection's field(s).\n   *\n   * @param align One of the values of Align.  In RTL mode directions\n   *     are reversed, and Align.RIGHT aligns to the left.\n   * @returns The input being modified (to allow chaining).\n   */\n  setAlign(align: Align): Input {\n    this.align = align;\n    if (this.sourceBlock.rendered) {\n      const sourceBlock = this.sourceBlock as BlockSvg;\n      sourceBlock.queueRender();\n    }\n    return this;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadow DOM representation of a block or null.\n   * @returns The input being modified (to allow chaining).\n   */\n  setShadowDom(shadow: Element | null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setShadowDom(shadow);\n    return this;\n  }\n\n  /**\n   * Returns the XML representation of the connection's shadow block.\n   *\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(): Element | null {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    return this.connection.getShadowDom();\n  }\n\n  /** Initialize the fields on this input. */\n  init() {\n    for (const field of this.fieldRow) {\n      field.init();\n    }\n  }\n\n  /**\n   * Initializes the fields on this input for a headless block.\n   *\n   * @internal\n   */\n  public initModel() {\n    for (const field of this.fieldRow) {\n      field.initModel();\n    }\n  }\n\n  /** Initializes the given field. */\n  private initField(field: Field) {\n    if (this.sourceBlock.rendered) {\n      field.init();\n    } else {\n      field.initModel();\n    }\n  }\n\n  /**\n   * Sever all links to this input.\n   */\n  dispose() {\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\n      field.dispose();\n    }\n    if (this.connection) {\n      this.connection.dispose();\n    }\n  }\n\n  /**\n   * Constructs a connection based on the type of this input's source block.\n   * Properly handles constructing headless connections for headless blocks\n   * and rendered connections for rendered blocks.\n   *\n   * @returns a connection of the given type, which is either a headless\n   *     or rendered connection, based on the type of this input's source block.\n   */\n  protected makeConnection(type: ConnectionType): Connection {\n    return this.sourceBlock.makeConnection_(type);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with no connection. */\nexport class DummyInput extends Input {\n  readonly type = inputTypes.DUMMY;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    super(name, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/**\n * Represents an input on a block that is always the last input in the row. Any\n * following input will be rendered on the next row even if the block has inline\n * inputs. Any newline character in a JSON block definition's message will\n * automatically be parsed as an end-row input.\n */\nexport class EndRowInput extends Input {\n  readonly type = inputTypes.END_ROW;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    super(name, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with a statement connection. */\nexport class StatementInput extends Input {\n  readonly type = inputTypes.STATEMENT;\n\n  public connection: Connection;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    // Errors are maintained for people not using typescript.\n    if (!name) throw new Error('Statement inputs must have a non-empty name');\n\n    super(name, block);\n    this.connection = this.makeConnection(ConnectionType.NEXT_STATEMENT);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with a value connection. */\nexport class ValueInput extends Input {\n  readonly type = inputTypes.VALUE;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    // Errors are maintained for people not using typescript.\n    if (!name) throw new Error('Value inputs must have a non-empty name');\n    super(name, block);\n    this.connection = this.makeConnection(ConnectionType.INPUT_VALUE);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Input} from '../../inputs/input.js';\nimport {Align} from '../../inputs/align.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput as StatementInputMeasurable} from '../measurables/statement_input.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport {ValueInput} from '../../inputs/value_input.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {Renderer} from './renderer.js';\nimport {Connection} from '../measurables/connection.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo {\n  block_: BlockSvg;\n  protected constants_: ConstantProvider;\n  outputConnection: OutputConnection | null;\n  isInline: boolean;\n  isCollapsed: boolean;\n  isInsertionMarker: boolean;\n  RTL: boolean;\n\n  /** The block renderer in use. */\n  protected readonly renderer_!: Renderer;\n\n  /** The height of the rendered block, including child blocks. */\n  height = 0;\n\n  /** The width of the rendered block, including child blocks. */\n  widthWithChildren = 0;\n\n  /**\n   * The width of the rendered block, excluding child blocks.  This is the\n   * right edge of the block when rendered LTR.\n   */\n  width = 0;\n  statementEdge = 0;\n\n  /** An array of Row objects containing sizing information. */\n  rows: Row[] = [];\n\n  /** An array of input rows on the block. */\n  inputRows: InputRow[] = [];\n\n  topRow: TopRow;\n  bottomRow: BottomRow;\n\n  // The position of the start point for drawing, relative to the block's\n  // location.\n  startX = 0;\n  startY = 0;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    this.renderer_ = renderer;\n\n    this.block_ = block;\n\n    /** The renderer's constant provider. */\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * A measurable representing the output connection if the block has one.\n     * Otherwise null.\n     */\n    this.outputConnection = block.outputConnection\n      ? new OutputConnection(this.constants_, block.outputConnection)\n      : null;\n\n    /**\n     * Whether the block should be rendered as a single line, either because\n     * it's inline or because it has been collapsed.\n     */\n    this.isInline = block.getInputsInline() && !block.isCollapsed();\n\n    /** Whether the block is collapsed. */\n    this.isCollapsed = block.isCollapsed();\n\n    /**\n     * Whether the block is an insertion marker.  Insertion markers are the same\n     * shape as normal blocks, but don't show fields.\n     */\n    this.isInsertionMarker = block.isInsertionMarker();\n\n    /** True if the block should be rendered right-to-left. */\n    this.RTL = block.RTL;\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  /**\n   * Populate this object with all sizing information needed to draw the block.\n   *\n   * This measure pass does not propagate changes to the block (although fields\n   * may choose to rerender when getSize() is called).  However, calling it\n   * repeatedly may be expensive.\n   */\n  measure() {\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  /**\n   * Create rows of Measurable objects representing all renderable parts of the\n   * block.\n   */\n  protected createRows_() {\n    this.populateTopRow_();\n    this.rows.push(this.topRow);\n    let activeRow = new InputRow(this.constants_);\n    this.inputRows.push(activeRow);\n\n    // Icons always go on the first row, before anything else.\n    const icons = this.block_.getIcons();\n    for (let i = 0, icon; (icon = icons[i]); i++) {\n      const iconInfo = new Icon(this.constants_, icon);\n      if (!this.isCollapsed || icon.isShownWhenCollapsed()) {\n        activeRow.elements.push(iconInfo);\n      }\n    }\n\n    let lastInput = undefined;\n    // Loop across all of the inputs on the block, creating objects for anything\n    // that needs to be rendered and breaking the block up into visual rows.\n    for (let i = 0, input; (input = this.block_.inputList[i]); i++) {\n      if (!input.isVisible()) {\n        continue;\n      }\n      if (this.shouldStartNewRow_(input, lastInput)) {\n        // Finish this row and create a new one.\n        this.rows.push(activeRow);\n        activeRow = new InputRow(this.constants_);\n        this.inputRows.push(activeRow);\n      }\n\n      // All of the fields in an input go on the same row.\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        activeRow.elements.push(new Field(this.constants_, field, input));\n      }\n      this.addInput_(input, activeRow);\n      lastInput = input;\n    }\n\n    if (this.isCollapsed) {\n      activeRow.hasJaggedEdge = true;\n      activeRow.elements.push(new JaggedEdge(this.constants_));\n    }\n\n    if (activeRow.elements.length || activeRow.hasDummyInput) {\n      this.rows.push(activeRow);\n    }\n    this.populateBottomRow_();\n    this.rows.push(this.bottomRow);\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the top row.\n   */\n  protected populateTopRow_() {\n    const hasPrevious = !!this.block_.previousConnection;\n    const hasHat =\n      (this.block_.hat\n        ? this.block_.hat === 'cap'\n        : this.constants_.ADD_START_HATS) &&\n      !this.outputConnection &&\n      !hasPrevious;\n\n    let cornerClass = this.topRow.hasLeftSquareCorner(this.block_)\n      ? SquareCorner\n      : RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_));\n\n    if (hasHat) {\n      const hat = new Hat(this.constants_);\n      this.topRow.elements.push(hat);\n      this.topRow.capline = hat.ascenderHeight;\n    } else if (hasPrevious) {\n      this.topRow.hasPreviousConnection = true;\n      this.topRow.connection = new PreviousConnection(\n        this.constants_,\n        this.block_.previousConnection as RenderedConnection,\n      );\n      this.topRow.elements.push(this.topRow.connection);\n    }\n\n    const precedesStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[0] instanceof StatementInput;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (precedesStatement && !this.block_.isCollapsed()) {\n      this.topRow.minHeight =\n        this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.topRow.minHeight = this.constants_.TOP_ROW_MIN_HEIGHT;\n    }\n\n    cornerClass = this.topRow.hasRightSquareCorner(this.block_)\n      ? SquareCorner\n      : RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_, 'right'));\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the bottom row.\n   */\n  protected populateBottomRow_() {\n    this.bottomRow.hasNextConnection = !!this.block_.nextConnection;\n\n    const followsStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\n        StatementInput;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (followsStatement) {\n      this.bottomRow.minHeight =\n        this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.bottomRow.minHeight = this.constants_.BOTTOM_ROW_MIN_HEIGHT;\n    }\n\n    const leftSquareCorner = this.bottomRow.hasLeftSquareCorner(this.block_);\n\n    if (leftSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_));\n    }\n\n    if (this.bottomRow.hasNextConnection) {\n      this.bottomRow.connection = new NextConnection(\n        this.constants_,\n        this.block_.nextConnection as RenderedConnection,\n      );\n      this.bottomRow.elements.push(this.bottomRow.connection);\n    }\n\n    const rightSquareCorner = this.bottomRow.hasRightSquareCorner(this.block_);\n\n    if (rightSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_, 'right'));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_, 'right'));\n    }\n  }\n\n  /**\n   * Add an input element to the active row, if needed, and record the type of\n   * the input on the row.\n   *\n   * @param input The input to record information about.\n   * @param activeRow The row that is currently being populated.\n   */\n  protected addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input instanceof ValueInput) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input instanceof StatementInput) {\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n    } else if (input instanceof ValueInput) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\n      // Dummy and end-row inputs have no visual representation, but the\n      // information is still important.\n      activeRow.minHeight = Math.max(\n        activeRow.minHeight,\n        input.getSourceBlock() && input.getSourceBlock()!.isShadow()\n          ? this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT\n          : this.constants_.DUMMY_INPUT_MIN_HEIGHT,\n      );\n      activeRow.hasDummyInput = true;\n    }\n    if (activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  /**\n   * Decide whether to start a new row between the two Blockly.Inputs.\n   *\n   * @param currInput The current input.\n   * @param prevInput The previous input.\n   * @returns True if the current input should be rendered on a new row.\n   */\n  protected shouldStartNewRow_(currInput: Input, prevInput?: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!prevInput) {\n      return false;\n    }\n    // If the previous input was an end-row input, then any following input\n    // should always be rendered on the next row.\n    if (prevInput instanceof EndRowInput) {\n      return true;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (\n      currInput instanceof StatementInput ||\n      prevInput instanceof StatementInput\n    ) {\n      return true;\n    }\n    // Value inputs, dummy inputs, and any input following an external value\n    // input get a new row if inputs are not inlined.\n    if (\n      currInput instanceof ValueInput ||\n      currInput instanceof DummyInput ||\n      prevInput instanceof ValueInput\n    ) {\n      return !this.isInline;\n    }\n    return false;\n  }\n\n  /** Add horizontal spacing between and around elements within each row. */\n  protected addElemSpacing_() {\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        // There's a spacer after the last element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null),\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * Calculate the width of a spacer element in a row based on the previous and\n   * next elements in that row.  For instance, extra padding is added between\n   * two editable fields.\n   *\n   * @param prev The element before the spacer.\n   * @param next The element after the spacer.\n   * @returns The size of the spacing between the two elements.\n   */\n  protected getInRowSpacing_(\n    prev: Measurable | null,\n    next: Measurable | null,\n  ): number {\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Between inputs and the end of the row.\n    if (prev && Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a square corner and a previous or next connection\n    if (prev && Types.isLeftSquareCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Figure out where the right edge of the block and right edge of statement\n   * inputs should be placed.\n   */\n  protected computeBounds_() {\n    let widestStatementRowFields = 0;\n    let blockWidth = 0;\n    let widestRowWithConnectedBlocks = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.measure();\n      blockWidth = Math.max(blockWidth, row.width);\n      if (row.hasStatement) {\n        const statementInput = row.getLastInput();\n        const innerWidth = row.width - (statementInput?.width ?? 0);\n        widestStatementRowFields = Math.max(\n          widestStatementRowFields,\n          innerWidth,\n        );\n      }\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n    }\n\n    this.statementEdge = widestStatementRowFields;\n    this.width = blockWidth;\n\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        row.statementEdge = this.statementEdge;\n      }\n    }\n\n    this.widthWithChildren = Math.max(blockWidth, widestRowWithConnectedBlocks);\n\n    if (this.outputConnection) {\n      this.startX = this.outputConnection.width;\n      this.width += this.outputConnection.width;\n      this.widthWithChildren += this.outputConnection.width;\n    }\n  }\n\n  /**\n   * Extra spacing may be necessary to make sure that the right sides of all\n   * rows line up.  This can only be calculated after a first pass to calculate\n   * the sizes of all rows.\n   */\n  protected alignRowElements_() {\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        this.alignStatementRow_(row as InputRow);\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = this.getDesiredRowWidth_(row);\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        if (Types.isTopOrBottomRow(row)) {\n          row.widthWithConnectedBlocks = row.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Calculate the desired width of an input row.\n   *\n   * @param _row The input row.\n   * @returns The desired width of the input row.\n   */\n  protected getDesiredRowWidth_(_row: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Modify the given row to add the given amount of padding around its fields.\n   * The exact location of the padding is based on the alignment property of the\n   * last input in the field.\n   *\n   * @param row The row to add padding to.\n   * @param missingSpace How much padding to add.\n   */\n  protected addAlignmentPadding_(row: Row, missingSpace: number) {\n    const firstSpacer = row.getFirstSpacer();\n    const lastSpacer = row.getLastSpacer();\n    if (row.hasExternalInput || row.hasStatement) {\n      row.widthWithConnectedBlocks += missingSpace;\n    }\n\n    // Decide where the extra padding goes.\n    if (row.align === Align.LEFT && lastSpacer) {\n      // Add padding to the end of the row.\n      lastSpacer.width += missingSpace;\n    } else if (row.align === Align.CENTRE && firstSpacer && lastSpacer) {\n      // Split the padding between the beginning and end of the row.\n      firstSpacer.width += missingSpace / 2;\n      lastSpacer.width += missingSpace / 2;\n    } else if (row.align === Align.RIGHT && firstSpacer) {\n      // Add padding at the beginning of the row.\n      firstSpacer.width += missingSpace;\n    } else if (lastSpacer) {\n      // Default to left-aligning.\n      lastSpacer.width += missingSpace;\n    } else {\n      return;\n    }\n    row.width += missingSpace;\n  }\n\n  /**\n   * Align the elements of a statement row based on computed bounds.\n   * Unlike other types of rows, statement rows add space in multiple places.\n   *\n   * @param row The statement row to resize.\n   */\n  protected alignStatementRow_(row: InputRow) {\n    const statementInput = row.getLastInput();\n    if (!statementInput) return;\n    let currentWidth = row.width - statementInput.width;\n    let desiredWidth = this.statementEdge;\n    // Add padding before the statement input.\n    const missingSpace = desiredWidth - currentWidth;\n    if (missingSpace > 0) {\n      this.addAlignmentPadding_(row, missingSpace);\n    }\n    // Also widen the statement input to reach to the right side of the\n    // block. Note that this does not add padding.\n    currentWidth = row.width;\n    desiredWidth = this.getDesiredRowWidth_(row);\n    statementInput.width += desiredWidth - currentWidth;\n    statementInput.height = Math.max(statementInput.height, row.height);\n    row.width += desiredWidth - currentWidth;\n    row.widthWithConnectedBlocks = Math.max(\n      row.width,\n      this.statementEdge + row.connectedBlockWidths,\n    );\n  }\n\n  /** Add spacers between rows and set their sizes. */\n  protected addRowSpacing_() {\n    const oldRows = this.rows;\n    this.rows = [];\n\n    for (let r = 0; r < oldRows.length; r++) {\n      this.rows.push(oldRows[r]);\n      if (r !== oldRows.length - 1) {\n        this.rows.push(this.makeSpacerRow_(oldRows[r], oldRows[r + 1]));\n      }\n    }\n  }\n\n  /**\n   * Create a spacer row to go between prev and next, and set its size.\n   *\n   * @param prev The previous row.\n   * @param next The next row.\n   * @returns The newly created spacer row.\n   */\n  protected makeSpacerRow_(prev: Row, next: Row): SpacerRow {\n    const height = this.getSpacerRowHeight_(prev, next);\n    const width = this.getSpacerRowWidth_(prev, next);\n    const spacer = new SpacerRow(this.constants_, height, width);\n    if (prev.hasStatement) {\n      spacer.followsStatement = true;\n    }\n    if (next.hasStatement) {\n      spacer.precedesStatement = true;\n    }\n    return spacer;\n  }\n\n  /**\n   * Calculate the width of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired width of the spacer row between these two rows.\n   */\n  protected getSpacerRowWidth_(_prev: Row, _next: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Calculate the height of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired height of the spacer row between these two rows.\n   */\n  protected getSpacerRowHeight_(_prev: Row, _next: Row): number {\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Calculate the centerline of an element in a rendered row.\n   * This base implementation puts the centerline at the middle of the row\n   * vertically, with no special cases.  You will likely need extra logic to\n   * handle (at minimum) top and bottom rows.\n   *\n   * @param row The row containing the element.\n   * @param elem The element to place.\n   * @returns The desired centerline of the given element, as an offset from the\n   *     top left of the block.\n   */\n  protected getElemCenterline_(row: Row, elem: Measurable): number {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n    return row.yPos + row.height / 2;\n  }\n\n  /**\n   * Record final position information on elements on the given row, for use in\n   * drawing.  At minimum this records xPos and centerline on each element.\n   *\n   * @param row The row containing the elements.\n   */\n  protected recordElemPositions_(row: Row) {\n    let xCursor = row.xPos;\n    for (let j = 0, elem; (elem = row.elements[j]); j++) {\n      // Now that row heights are finalized, make spacers use the row height.\n      if (Types.isSpacer(elem)) {\n        elem.height = row.height;\n      }\n      elem.xPos = xCursor;\n      elem.centerline = this.getElemCenterline_(row, elem);\n      xCursor += elem.width;\n    }\n  }\n\n  /**\n   * Make any final changes to the rendering information object.  In particular,\n   * store the y position of each row, and record the height of the full block.\n   */\n  protected finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width,\n        );\n      }\n    }\n\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n  }\n\n  /** Returns the connection measurable associated with the given connection. */\n  getMeasureableForConnection(conn: RenderedConnection): Connection | null {\n    if (this.outputConnection?.connectionModel === conn) {\n      return this.outputConnection;\n    }\n\n    for (const row of this.rows) {\n      for (const elem of row.elements) {\n        if (elem instanceof Connection && elem.connectionModel === conn) {\n          return elem;\n        }\n      }\n    }\n\n    return null;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block delete event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockDelete\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * deleted.\n */\nexport class BlockDelete extends BlockBase {\n  /** The XML representation of the deleted block(s). */\n  oldXml?: Element | DocumentFragment;\n\n  /** The JSON respresentation of the deleted block(s). */\n  oldJson?: blocks.State;\n\n  /** All of the IDs of deleted blocks. */\n  ids?: string[];\n\n  /** True if the deleted block was a shadow block, false otherwise. */\n  wasShadow?: boolean;\n\n  override type = eventUtils.BLOCK_DELETE;\n\n  /** @param opt_block The deleted block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.getParent()) {\n      throw Error('Connected blocks cannot be deleted.');\n    }\n    if (opt_block.isShadow()) {\n      // Respawning shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.oldXml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n    this.wasShadow = opt_block.isShadow();\n    this.oldJson = blocks.save(opt_block, {\n      addCoordinates: true,\n    }) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDeleteJson {\n    const json = super.toJson() as BlockDeleteJson;\n    if (!this.oldXml) {\n      throw new Error(\n        'The old block XML is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.wasShadow === undefined) {\n      throw new Error(\n        'Whether the block was a shadow is undefined. Either ' +\n          'pass a block to the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldJson) {\n      throw new Error(\n        'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    json['oldXml'] = Xml.domToText(this.oldXml);\n    json['ids'] = this.ids;\n    json['wasShadow'] = this.wasShadow;\n    json['oldJson'] = this.oldJson;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockDelete(),\n    ) as BlockDelete;\n    newEvent.oldXml = utilsXml.textToDom(json['oldXml']);\n    newEvent.ids = json['ids'];\n    newEvent.wasShadow =\n      json['wasShadow'] || newEvent.oldXml.tagName.toLowerCase() === 'shadow';\n    newEvent.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldJson) {\n      throw new Error(\n        'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn(\"Can't delete non-existent block: \" + id);\n        }\n      }\n    } else {\n      blocks.append(this.oldJson, workspace);\n    }\n  }\n}\n\nexport interface BlockDeleteJson extends BlockBaseJson {\n  oldXml: string;\n  ids: string[];\n  wasShadow: boolean;\n  oldJson: blocks.State;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.DELETE, BlockDelete);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing one block.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Block\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_delete.js';\n\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport {DuplicateIconType} from './icons/exceptions.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockChange} from './events/events_block_change.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as eventUtils from './events/utils.js';\nimport * as Extensions from './extensions.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Input} from './inputs/input.js';\nimport {Align} from './inputs/align.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {type IIcon} from './interfaces/i_icon.js';\nimport {isCommentIcon} from './interfaces/i_comment_icon.js';\nimport type {MutatorIcon} from './icons/mutator_icon.js';\nimport * as Tooltip from './tooltip.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as parsing from './utils/parsing.js';\nimport * as registry from './registry.js';\nimport {Size} from './utils/size.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport {DummyInput} from './inputs/dummy_input.js';\nimport {EndRowInput} from './inputs/end_row_input.js';\nimport {ValueInput} from './inputs/value_input.js';\nimport {StatementInput} from './inputs/statement_input.js';\nimport {IconType} from './icons/icon_types.js';\n\n/**\n * Class for one block.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class Block implements IASTNodeLocation {\n  /**\n   * An optional callback method to use whenever the block's parent workspace\n   * changes. This is usually only called from the constructor, the block type\n   * initializer function, or an extension initializer function.\n   */\n  onchange?: ((p1: Abstract) => void) | null;\n\n  /** The language-neutral ID given to the collapsed input. */\n  static readonly COLLAPSED_INPUT_NAME: string = constants.COLLAPSED_INPUT_NAME;\n\n  /** The language-neutral ID given to the collapsed field. */\n  static readonly COLLAPSED_FIELD_NAME: string = constants.COLLAPSED_FIELD_NAME;\n\n  /**\n   * Optional text data that round-trips between blocks and XML.\n   * Has no effect. May be used by 3rd parties for meta information.\n   */\n  data: string | null = null;\n\n  /**\n   * Has this block been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /**\n   * Colour of the block as HSV hue value (0-360)\n   * This may be null if the block colour was not set via a hue number.\n   */\n  private hue_: number | null = null;\n\n  /** Colour of the block in '#RRGGBB' format. */\n  protected colour_ = '#000000';\n\n  /** Name of the block style. */\n  protected styleName_ = '';\n\n  /** An optional method called during initialization. */\n  init?: () => void;\n\n  /** An optional method called during disposal. */\n  destroy?: () => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * mutation state to XML. This must be coupled with defining\n   * `domToMutation`.\n   */\n  mutationToDom?: (...p1: AnyDuringMigration[]) => Element;\n\n  /**\n   * An optional deserialization method for defining how to deserialize the\n   * mutation state from XML. This must be coupled with defining\n   * `mutationToDom`.\n   */\n  domToMutation?: (p1: Element) => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * block's extra state (eg mutation state) to something JSON compatible.\n   * This must be coupled with defining `loadExtraState`.\n   *\n   * @param doFullSerialization Whether or not to serialize the full state of\n   *     the extra state (rather than possibly saving a reference to some\n   *     state). This is used during copy-paste. See the\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/extensions#full_serialization_and_backing_data | block serialization docs}\n   *     for more information.\n   */\n  saveExtraState?: (doFullSerialization?: boolean) => AnyDuringMigration;\n\n  /**\n   * An optional serialization method for defining how to deserialize the\n   * block's extra state (eg mutation state) from something JSON compatible.\n   * This must be coupled with defining `saveExtraState`.\n   */\n  loadExtraState?: (p1: AnyDuringMigration) => void;\n\n  /**\n   * An optional property for suppressing adding STATEMENT_PREFIX and\n   * STATEMENT_SUFFIX to generated code.\n   */\n  suppressPrefixSuffix: boolean | null = false;\n\n  /**\n   * An optional property for declaring developer variables.  Return a list of\n   * variable names for use by generators.  Developer variables are never\n   * shown to the user, but are declared as global variables in the generated\n   * code.\n   */\n  getDeveloperVariables?: () => string[];\n\n  /**\n   * An optional function that reconfigures the block based on the contents of\n   * the mutator dialog.\n   */\n  compose?: (p1: Block) => void;\n\n  /**\n   * An optional function that populates the mutator's dialog with\n   * this block's components.\n   */\n  decompose?: (p1: Workspace) => Block;\n  id: string;\n  outputConnection: Connection | null = null;\n  nextConnection: Connection | null = null;\n  previousConnection: Connection | null = null;\n  inputList: Input[] = [];\n  inputsInline?: boolean;\n  icons: IIcon[] = [];\n  private disabledReasons = new Set<string>();\n  tooltip: Tooltip.TipInfo = '';\n  contextMenu = true;\n\n  protected parentBlock_: this | null = null;\n\n  protected childBlocks_: this[] = [];\n\n  private deletable_ = true;\n\n  private movable_ = true;\n\n  private editable_ = true;\n\n  private isShadow_ = false;\n\n  protected collapsed_ = false;\n  protected outputShape_: number | null = null;\n\n  /**\n   * Is the current block currently in the process of being disposed?\n   */\n  protected disposing = false;\n\n  /**\n   * Has this block been fully initialized? E.g. all fields initailized.\n   *\n   * @internal\n   */\n  initialized = false;\n\n  private readonly xy_: Coordinate;\n  isInFlyout: boolean;\n  isInMutator: boolean;\n  RTL: boolean;\n\n  /** True if this block is an insertion marker. */\n  protected isInsertionMarker_ = false;\n\n  /** Name of the type of hat. */\n  hat?: string;\n\n  /** Is this block a BlockSVG? */\n  readonly rendered: boolean = false;\n\n  /**\n   * String for block help, or function that returns a URL. Null for no help.\n   */\n  helpUrl: string | Function | null = null;\n\n  /** A bound callback function to use when the parent workspace changes. */\n  private onchangeWrapper_: ((p1: Abstract) => void) | null = null;\n\n  /**\n   * A count of statement inputs on the block.\n   *\n   * @internal\n   */\n  statementInputCount = 0;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  type!: string;\n  // Record initial inline state.\n  inputsInlineDefault?: boolean;\n  workspace: Workspace;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @throws When the prototypeName is not valid or not allowed.\n   */\n  constructor(workspace: Workspace, prototypeName: string, opt_id?: string) {\n    this.workspace = workspace;\n\n    this.id =\n      opt_id && !workspace.getBlockById(opt_id) ? opt_id : idGenerator.genUid();\n    workspace.setBlockById(this.id, this);\n\n    /**\n     * The block's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n    this.isInFlyout = workspace.isFlyout;\n    this.isInMutator = workspace.isMutator;\n\n    this.RTL = workspace.RTL;\n\n    // Copy the type-specific functions and data from the prototype.\n    if (prototypeName) {\n      this.type = prototypeName;\n      const prototype = Blocks[prototypeName];\n      if (!prototype || typeof prototype !== 'object') {\n        throw TypeError('Invalid block definition for type: ' + prototypeName);\n      }\n      Object.assign(this, prototype);\n    }\n\n    workspace.addTopBlock(this);\n    workspace.addTypedBlock(this);\n\n    if (new.target === Block) {\n      this.doInit_();\n    }\n  }\n\n  /** Calls the init() function and handles associated event firing, etc. */\n  protected doInit_() {\n    // All events fired should be part of the same group.\n    // Any events fired during init should not be undoable,\n    // so that block creation is atomic.\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    const initialUndoFlag = eventUtils.getRecordUndo();\n\n    try {\n      // Call an initialization function, if it exists.\n      if (typeof this.init === 'function') {\n        eventUtils.setRecordUndo(false);\n        this.init();\n        eventUtils.setRecordUndo(initialUndoFlag);\n      }\n\n      // Fire a create event.\n      if (eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(this));\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n      // In case init threw, recordUndo flag should still be reset.\n      eventUtils.setRecordUndo(initialUndoFlag);\n    }\n    this.inputsInlineDefault = this.inputsInline;\n\n    // Bind an onchange function, if it exists.\n    if (typeof this.onchange === 'function') {\n      this.setOnChange(this.onchange);\n    }\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   */\n  dispose(healStack = false) {\n    this.disposing = true;\n\n    // Dispose of this change listener before unplugging.\n    // Technically not necessary due to the event firing delay.\n    // But future-proofing.\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    this.unplug(healStack);\n    if (eventUtils.isEnabled()) {\n      // Constructing the delete event is costly. Only perform if necessary.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_DELETE))(this));\n    }\n    this.workspace.removeTopBlock(this);\n    this.disposeInternal();\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does not fire events, unplug the block, etc.\n   */\n  protected disposeInternal() {\n    this.disposing = true;\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    this.workspace.removeTypedBlock(this);\n    this.workspace.removeBlockById(this.id);\n\n    if (typeof this.destroy === 'function') this.destroy();\n\n    this.childBlocks_.forEach((c) => c.disposeInternal());\n    this.inputList.forEach((i) => i.dispose());\n    this.inputList.length = 0;\n    this.getConnections_(true).forEach((c) => c.dispose());\n    this.disposed = true;\n  }\n\n  /**\n   * Returns true if the block is either in the process of being disposed, or\n   * is disposed.\n   *\n   * @internal\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /**\n   * Call initModel on all fields on the block.\n   * May be called more than once.\n   * Either initModel or initSvg must be called after creating a block and\n   * before the first interaction with it.  Interactions include UI actions\n   * (e.g. clicking and dragging) and firing events (e.g. create, delete, and\n   * change).\n   */\n  initModel() {\n    if (this.initialized) return;\n    for (const input of this.inputList) {\n      input.initModel();\n    }\n    this.initialized = true;\n  }\n\n  /**\n   * Unplug this block from its superior block.  If this block is a statement,\n   * optionally reconnect the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  unplug(opt_healStack?: boolean) {\n    if (this.outputConnection) {\n      this.unplugFromRow_(opt_healStack);\n    }\n    if (this.previousConnection) {\n      this.unplugFromStack_(opt_healStack);\n    }\n  }\n\n  /**\n   * Unplug this block's output from an input on another block.  Optionally\n   * reconnect the block's parent to the only child block, if possible.\n   *\n   * @param opt_healStack Disconnect right-side block and connect to left-side\n   *     block.  Defaults to false.\n   */\n  private unplugFromRow_(opt_healStack?: boolean) {\n    let parentConnection = null;\n    if (this.outputConnection?.isConnected()) {\n      parentConnection = this.outputConnection.targetConnection;\n      // Disconnect from any superior block.\n      this.outputConnection.disconnect();\n    }\n\n    // Return early in obvious cases.\n    if (!parentConnection || !opt_healStack) {\n      return;\n    }\n\n    const thisConnection = this.getOnlyValueConnection_();\n    if (\n      !thisConnection ||\n      !thisConnection.isConnected() ||\n      thisConnection.targetBlock()!.isShadow()\n    ) {\n      // Too many or too few possible connections on this block, or there's\n      // nothing on the other side of this connection.\n      return;\n    }\n\n    const childConnection = thisConnection.targetConnection;\n    // Disconnect the child block.\n    childConnection?.disconnect();\n    // Connect child to the parent if possible, otherwise bump away.\n    if (\n      this.workspace.connectionChecker.canConnect(\n        childConnection,\n        parentConnection,\n        false,\n      )\n    ) {\n      parentConnection.connect(childConnection!);\n    } else {\n      childConnection?.onFailedConnect(parentConnection);\n    }\n  }\n\n  /**\n   * Returns the connection on the value input that is connected to another\n   * block. When an insertion marker is connected to a connection with a block\n   * already attached, the connected block is attached to the insertion marker.\n   * Since only one block can be displaced and attached to the insertion marker\n   * this should only ever return one connection.\n   *\n   * @returns The connection on the value input, or null.\n   */\n  private getOnlyValueConnection_(): Connection | null {\n    let connection = null;\n    for (let i = 0; i < this.inputList.length; i++) {\n      const thisConnection = this.inputList[i].connection;\n      if (\n        thisConnection &&\n        thisConnection.type === ConnectionType.INPUT_VALUE &&\n        thisConnection.targetConnection\n      ) {\n        if (connection) {\n          return null; // More than one value input found.\n        }\n        connection = thisConnection;\n      }\n    }\n    return connection;\n  }\n\n  /**\n   * Unplug this statement block from its superior block.  Optionally reconnect\n   * the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  private unplugFromStack_(opt_healStack?: boolean) {\n    let previousTarget = null;\n    if (this.previousConnection?.isConnected()) {\n      // Remember the connection that any next statements need to connect to.\n      previousTarget = this.previousConnection.targetConnection;\n      // Detach this block from the parent's tree.\n      this.previousConnection.disconnect();\n    }\n    const nextBlock = this.getNextBlock();\n    if (opt_healStack && nextBlock && !nextBlock.isShadow()) {\n      // Disconnect the next statement.\n      const nextTarget = this.nextConnection?.targetConnection ?? null;\n      nextTarget?.disconnect();\n      if (\n        previousTarget &&\n        this.workspace.connectionChecker.canConnect(\n          previousTarget,\n          nextTarget,\n          false,\n        )\n      ) {\n        // Attach the next statement to the previous statement.\n        previousTarget.connect(nextTarget!);\n      }\n    }\n  }\n\n  /**\n   * Returns all connections originating from this block.\n   *\n   * @param _all If true, return all connections even hidden ones.\n   * @returns Array of connections.\n   * @internal\n   */\n  getConnections_(_all: boolean): Connection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection) {\n        myConnections.push(input.connection);\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  lastConnectionInStack(ignoreShadows: boolean): Connection | null {\n    let nextConnection = this.nextConnection;\n    while (nextConnection) {\n      const nextBlock = nextConnection.targetBlock();\n      if (!nextBlock || (ignoreShadows && nextBlock.isShadow())) {\n        return nextConnection;\n      }\n      nextConnection = nextBlock.nextConnection;\n    }\n    return null;\n  }\n\n  /**\n   * Bump unconnected blocks out of alignment.  Two blocks which aren't actually\n   * connected should not coincidentally line up on screen.\n   */\n  bumpNeighbours() {}\n\n  /**\n   * Return the parent block or null if this block is at the top level. The\n   * parent block is either the block connected to the previous connection (for\n   * a statement block) or the block connected to the output connection (for a\n   * value block).\n   *\n   * @returns The block (if any) that holds the current block.\n   */\n  getParent(): this | null {\n    return this.parentBlock_;\n  }\n\n  /**\n   * Return the input that connects to the specified block.\n   *\n   * @param block A block connected to an input on this block.\n   * @returns The input (if any) that connects to the specified block.\n   */\n  getInputWithBlock(block: Block): Input | null {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection && input.connection.targetBlock() === block) {\n        return input;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the parent block that surrounds the current block, or null if this\n   * block has no surrounding block.  A parent block might just be the previous\n   * statement, whereas the surrounding block is an if statement, while loop,\n   * etc.\n   *\n   * @returns The block (if any) that surrounds the current block.\n   */\n  getSurroundParent(): this | null {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    let prevBlock;\n    do {\n      prevBlock = block;\n      block = block.getParent();\n      if (!block) {\n        // Ran off the top.\n        return null;\n      }\n    } while (block.getNextBlock() === prevBlock);\n    // This block is an enclosing parent, not just a statement in a stack.\n    return block;\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  getNextBlock(): Block | null {\n    return this.nextConnection && this.nextConnection.targetBlock();\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  getPreviousBlock(): Block | null {\n    return this.previousConnection && this.previousConnection.targetBlock();\n  }\n\n  /**\n   * Return the top-most block in this block's tree.\n   * This will return itself if this block is at the top level.\n   *\n   * @returns The root block.\n   */\n  getRootBlock(): this {\n    let rootBlock: this;\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    do {\n      rootBlock = block;\n      block = rootBlock.parentBlock_;\n    } while (block);\n    return rootBlock;\n  }\n\n  /**\n   * Walk up from the given block up through the stack of blocks to find\n   * the top block of the sub stack. If we are nested in a statement input only\n   * find the top-most nested block. Do not go all the way to the root block.\n   *\n   * @returns The top block in a stack.\n   * @internal\n   */\n  getTopStackBlock(): this {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block = this;\n    let previous;\n    do {\n      previous = block.getPreviousBlock();\n      // AnyDuringMigration because:  Type 'Block' is not assignable to type\n      // 'this'.\n    } while (\n      previous &&\n      previous.getNextBlock() === block &&\n      (block = previous as AnyDuringMigration)\n    );\n    return block;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getChildren(ordered: boolean): Block[] {\n    if (!ordered) {\n      return this.childBlocks_;\n    }\n    const blocks = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          blocks.push(child);\n        }\n      }\n    }\n    const next = this.getNextBlock();\n    if (next) {\n      blocks.push(next);\n    }\n    return blocks;\n  }\n\n  /**\n   * Set parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  setParent(newParent: this | null) {\n    if (newParent === this.parentBlock_) {\n      return;\n    }\n\n    // Check that block is connected to new parent if new parent is not null and\n    //    that block is not connected to superior one if new parent is null.\n    const targetBlock =\n      (this.previousConnection && this.previousConnection.targetBlock()) ||\n      (this.outputConnection && this.outputConnection.targetBlock());\n    const isConnected = !!targetBlock;\n\n    if (isConnected && newParent && targetBlock !== newParent) {\n      throw Error('Block connected to superior one that is not new parent.');\n    } else if (!isConnected && newParent) {\n      throw Error('Block not connected to new parent.');\n    } else if (isConnected && !newParent) {\n      throw Error(\n        'Cannot set parent to null while block is still connected to' +\n          ' superior block.',\n      );\n    }\n\n    // This block hasn't actually moved on-screen, so there's no need to\n    // update\n    //     its connection locations.\n    if (this.parentBlock_) {\n      // Remove this block from the old parent's child list.\n      arrayUtils.removeElem(this.parentBlock_.childBlocks_, this);\n    } else {\n      // New parent must be non-null so remove this block from the workspace's\n      //     list of top-most blocks.\n      this.workspace.removeTopBlock(this);\n    }\n\n    this.parentBlock_ = newParent;\n    if (newParent) {\n      // Add this block to the new parent's child list.\n      newParent.childBlocks_.push(this);\n    } else {\n      this.workspace.addTopBlock(this);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly or indirectly nested inside this one.\n   * Includes this block in the list.\n   * Includes value and statement inputs, as well as any following statements.\n   * Excludes any connection on an output tab or any preceding statements.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Flattened array of blocks.\n   */\n  getDescendants(ordered: boolean): this[] {\n    const blocks = [this];\n    const childBlocks = this.getChildren(ordered);\n    for (let child, i = 0; (child = childBlocks[i]); i++) {\n      // AnyDuringMigration because:  Argument of type 'Block[]' is not\n      // assignable to parameter of type 'this[]'.\n      blocks.push(...(child.getDescendants(ordered) as AnyDuringMigration));\n    }\n    return blocks;\n  }\n\n  /**\n   * Get whether this block is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean {\n    return (\n      this.deletable_ &&\n      !this.isShadow_ &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own deletable property is true or false.\n   *\n   * @returns True if the block's deletable property is true, false otherwise.\n   */\n  isOwnDeletable(): boolean {\n    return this.deletable_;\n  }\n\n  /**\n   * Set whether this block is deletable or not.\n   *\n   * @param deletable True if deletable.\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable_ = deletable;\n  }\n\n  /**\n   * Get whether this block is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return (\n      this.movable_ &&\n      !this.isShadow_ &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own movable property is true or false.\n   *\n   * @returns True if the block's movable property is true, false otherwise.\n   * @internal\n   */\n  isOwnMovable(): boolean {\n    return this.movable_;\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  setMovable(movable: boolean) {\n    this.movable_ = movable;\n  }\n\n  /**\n   * Get whether is block is duplicatable or not. If duplicating this block and\n   * descendants will put this block over the workspace's capacity this block is\n   * not duplicatable. If duplicating this block and descendants will put any\n   * type over their maxInstances this block is not duplicatable.\n   *\n   * @returns True if duplicatable.\n   */\n  isDuplicatable(): boolean {\n    if (!this.workspace.hasBlockLimits()) {\n      return true;\n    }\n    return this.workspace.isCapacityAvailable(\n      common.getBlockTypeCounts(this, true),\n    );\n  }\n\n  /**\n   * Get whether this block is a shadow block or not.\n   *\n   * @returns True if a shadow.\n   */\n  isShadow(): boolean {\n    return this.isShadow_;\n  }\n\n  /**\n   * Set whether this block is a shadow block or not.\n   * This method is internal and should not be called by users of Blockly. To\n   * create shadow blocks programmatically call connection.setShadowState\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  setShadow(shadow: boolean) {\n    this.isShadow_ = shadow;\n  }\n\n  /**\n   * Get whether this block is an insertion marker block or not.\n   *\n   * @returns True if an insertion marker.\n   */\n  isInsertionMarker(): boolean {\n    return this.isInsertionMarker_;\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  setInsertionMarker(insertionMarker: boolean) {\n    this.isInsertionMarker_ = insertionMarker;\n  }\n\n  /**\n   * Get whether this block is editable or not.\n   *\n   * @returns True if editable.\n   * @internal\n   */\n  isEditable(): boolean {\n    return (\n      this.editable_ &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own editable property is true or false.\n   *\n   * @returns True if the block's editable property is true, false otherwise.\n   */\n  isOwnEditable(): boolean {\n    return this.editable_;\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable_ = editable;\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        field.updateEditable();\n      }\n    }\n  }\n\n  /**\n   * Returns if this block has been disposed of / deleted.\n   *\n   * @returns True if this block has been disposed of / deleted.\n   */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * @returns True if this block is a value block with a single editable field.\n   * @internal\n   */\n  isSimpleReporter(): boolean {\n    if (!this.outputConnection) return false;\n\n    for (const input of this.inputList) {\n      if (input.connection || input.fieldRow.length > 1) return false;\n    }\n    return true;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  getMatchingConnection(\n    otherBlock: Block,\n    conn: Connection,\n  ): Connection | null {\n    const connections = this.getConnections_(true);\n    const otherConnections = otherBlock.getConnections_(true);\n    if (connections.length !== otherConnections.length) {\n      throw Error('Connection lists did not match in length.');\n    }\n    for (let i = 0; i < otherConnections.length; i++) {\n      if (otherConnections[i] === conn) {\n        return connections[i];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the URL of this block's help page.\n   *\n   * @param url URL string for block help, or function that returns a URL.  Null\n   *     for no help.\n   */\n  setHelpUrl(url: string | Function) {\n    this.helpUrl = url;\n  }\n\n  /**\n   * Sets the tooltip for this block.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, or a parent object whose tooltip will be used. To not\n   *     display a tooltip pass the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo) {\n    this.tooltip = newTip;\n  }\n\n  /**\n   * Returns the tooltip text for this block.\n   *\n   * @returns The tooltip text for this block.\n   */\n  getTooltip(): string {\n    return Tooltip.getTooltipOfObject(this);\n  }\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColour(): string {\n    return this.colour_;\n  }\n\n  /**\n   * Get the name of the block style.\n   *\n   * @returns Name of the block style.\n   */\n  getStyleName(): string {\n    return this.styleName_;\n  }\n\n  /**\n   * Get the HSV hue value of a block.  Null if hue not set.\n   *\n   * @returns Hue value (0-360).\n   */\n  getHue(): number | null {\n    return this.hue_;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   */\n  setColour(colour: number | string) {\n    const parsed = parsing.parseBlockColour(colour);\n    this.hue_ = parsed.hue;\n    this.colour_ = parsed.hex;\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   */\n  setStyle(blockStyleName: string) {\n    this.styleName_ = blockStyleName;\n  }\n\n  /**\n   * Sets a callback function to use whenever the block's parent workspace\n   * changes, replacing any prior onchange handler. This is usually only called\n   * from the constructor, the block type initializer function, or an extension\n   * initializer function.\n   *\n   * @param onchangeFn The callback to call when the block's workspace changes.\n   * @throws {Error} if onchangeFn is not falsey and not a function.\n   */\n  setOnChange(onchangeFn: (p1: Abstract) => void) {\n    if (onchangeFn && typeof onchangeFn !== 'function') {\n      throw Error('onchange must be a function.');\n    }\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n    this.onchange = onchangeFn;\n    this.onchangeWrapper_ = onchangeFn.bind(this);\n    this.workspace.addChangeListener(this.onchangeWrapper_);\n  }\n\n  /**\n   * Returns the named field from a block.\n   *\n   * @param name The name of the field.\n   * @returns Named field, or null if field does not exist.\n   */\n  getField(name: string): Field | null {\n    if (typeof name !== 'string') {\n      throw TypeError(\n        'Block.prototype.getField expects a string ' +\n          'with the field name but received ' +\n          (name === undefined ? 'nothing' : name + ' of type ' + typeof name) +\n          ' instead',\n      );\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.name === name) {\n          return field;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable ids.\n   */\n  getVars(): string[] {\n    const vars: string[] = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables()) {\n          // NOTE: This only applies to `FieldVariable`, a `Field<string>`\n          vars.push(field.getValue() as string);\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable models.\n   * @internal\n   */\n  getVarModels(): VariableModel[] {\n    const vars = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables()) {\n          const model = this.workspace.getVariableById(\n            field.getValue() as string,\n          );\n          // Check if the variable actually exists (and isn't just a potential\n          // variable).\n          if (model) {\n            vars.push(model);\n          }\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Notification that a variable is renaming but keeping the same ID.  If the\n   * variable is in use on this block, rerender to show the new name.\n   *\n   * @param variable The variable being renamed.\n   * @internal\n   */\n  updateVarName(variable: VariableModel) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (\n          field.referencesVariables() &&\n          variable.getId() === field.getValue()\n        ) {\n          field.refreshVariableName();\n        }\n      }\n    }\n  }\n\n  /**\n   * Notification that a variable is renaming.\n   * If the ID matches one of this block's variables, rename it.\n   *\n   * @param oldId ID of variable to rename.\n   * @param newId ID of new variable.  May be the same as oldId, but with an\n   *     updated name.\n   */\n  renameVarById(oldId: string, newId: string) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables() && oldId === field.getValue()) {\n          field.setValue(newId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns the language-neutral value of the given field.\n   *\n   * @param name The name of the field.\n   * @returns Value of the field or null if field does not exist.\n   */\n  getFieldValue(name: string): AnyDuringMigration {\n    const field = this.getField(name);\n    if (field) {\n      return field.getValue();\n    }\n    return null;\n  }\n\n  /**\n   * Sets the value of the given field for this block.\n   *\n   * @param newValue The value to set.\n   * @param name The name of the field to set the value of.\n   */\n  setFieldValue(newValue: AnyDuringMigration, name: string) {\n    const field = this.getField(name);\n    if (!field) {\n      throw Error('Field \"' + name + '\" not found.');\n    }\n    field.setValue(newValue);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setPreviousStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.previousConnection) {\n        this.previousConnection = this.makeConnection_(\n          ConnectionType.PREVIOUS_STATEMENT,\n        );\n      }\n      this.previousConnection.setCheck(opt_check);\n    } else {\n      if (this.previousConnection) {\n        if (this.previousConnection.isConnected()) {\n          throw Error(\n            'Must disconnect previous statement before removing ' +\n              'connection.',\n          );\n        }\n        this.previousConnection.dispose();\n        this.previousConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setNextStatement(newBoolean: boolean, opt_check?: string | string[] | null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.nextConnection) {\n        this.nextConnection = this.makeConnection_(\n          ConnectionType.NEXT_STATEMENT,\n        );\n      }\n      this.nextConnection.setCheck(opt_check);\n    } else {\n      if (this.nextConnection) {\n        if (this.nextConnection.isConnected()) {\n          throw Error(\n            'Must disconnect next statement before removing ' + 'connection.',\n          );\n        }\n        this.nextConnection.dispose();\n        this.nextConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  setOutput(newBoolean: boolean, opt_check?: string | string[] | null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.outputConnection) {\n        this.outputConnection = this.makeConnection_(\n          ConnectionType.OUTPUT_VALUE,\n        );\n      }\n      this.outputConnection.setCheck(opt_check);\n    } else {\n      if (this.outputConnection) {\n        if (this.outputConnection.isConnected()) {\n          throw Error(\n            'Must disconnect output value before removing connection.',\n          );\n        }\n        this.outputConnection.dispose();\n        this.outputConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  setInputsInline(newBoolean: boolean) {\n    if (this.inputsInline !== newBoolean) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this,\n          'inline',\n          null,\n          this.inputsInline,\n          newBoolean,\n        ),\n      );\n      this.inputsInline = newBoolean;\n    }\n  }\n\n  /**\n   * Get whether value inputs are arranged horizontally or vertically.\n   *\n   * @returns True if inputs are horizontal.\n   */\n  getInputsInline(): boolean {\n    if (this.inputsInline !== undefined) {\n      // Set explicitly.\n      return this.inputsInline;\n    }\n    // Not defined explicitly.  Figure out what would look best.\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (\n        this.inputList[i - 1] instanceof DummyInput &&\n        this.inputList[i] instanceof DummyInput\n      ) {\n        // Two dummy inputs in a row.  Don't inline them.\n        return false;\n      }\n    }\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (\n        this.inputList[i - 1] instanceof ValueInput &&\n        this.inputList[i] instanceof DummyInput\n      ) {\n        // Dummy input after a value input.  Inline them.\n        return true;\n      }\n    }\n    for (let i = 0; i < this.inputList.length; i++) {\n      if (this.inputList[i] instanceof EndRowInput) {\n        // A row-end input is present. Inline value inputs.\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Set the block's output shape.\n   *\n   * @param outputShape Value representing an output shape.\n   */\n  setOutputShape(outputShape: number | null) {\n    this.outputShape_ = outputShape;\n  }\n\n  /**\n   * Get the block's output shape.\n   *\n   * @returns Value representing output shape if one exists.\n   */\n  getOutputShape(): number | null {\n    return this.outputShape_;\n  }\n\n  /**\n   * Get whether this block is enabled or not. A block is considered enabled\n   * if there aren't any reasons why it would be disabled. A block may still\n   * be disabled for other reasons even if the user attempts to manually\n   * enable it, such as when the block is in an invalid location.\n   *\n   * @returns True if enabled.\n   */\n  isEnabled(): boolean {\n    return this.disabledReasons.size === 0;\n  }\n\n  /** @deprecated v11 - Get whether the block is manually disabled. */\n  private get disabled(): boolean {\n    deprecation.warn(\n      'disabled',\n      'v11',\n      'v12',\n      'the isEnabled or hasDisabledReason methods of Block',\n    );\n    return this.hasDisabledReason(constants.MANUALLY_DISABLED);\n  }\n\n  /** @deprecated v11 - Set whether the block is manually disabled. */\n  private set disabled(value: boolean) {\n    deprecation.warn(\n      'disabled',\n      'v11',\n      'v12',\n      'the setDisabledReason method of Block',\n    );\n    this.setDisabledReason(value, constants.MANUALLY_DISABLED);\n  }\n\n  /**\n   * @deprecated v11 - Set whether the block is manually enabled or disabled.\n   * The user can toggle whether a block is disabled from a context menu\n   * option. A block may still be disabled for other reasons even if the user\n   * attempts to manually enable it, such as when the block is in an invalid\n   * location. This method is deprecated and setDisabledReason should be used\n   * instead.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    deprecation.warn(\n      'setEnabled',\n      'v11',\n      'v12',\n      'the setDisabledReason method of Block',\n    );\n    this.setDisabledReason(!enabled, constants.MANUALLY_DISABLED);\n  }\n\n  /**\n   * Add or remove a reason why the block might be disabled. If a block has\n   * any reasons to be disabled, then the block itself will be considered\n   * disabled. A block could be disabled for multiple independent reasons\n   * simultaneously, such as when the user manually disables it, or the block\n   * is invalid.\n   *\n   * @param disabled If true, then the block should be considered disabled for\n   *     at least the provided reason, otherwise the block is no longer disabled\n   *     for that reason.\n   * @param reason A language-neutral identifier for a reason why the block\n   *     could be disabled. Call this method again with the same identifier to\n   *     update whether the block is currently disabled for this reason.\n   */\n  setDisabledReason(disabled: boolean, reason: string): void {\n    if (this.disabledReasons.has(reason) !== disabled) {\n      if (disabled) {\n        this.disabledReasons.add(reason);\n      } else {\n        this.disabledReasons.delete(reason);\n      }\n      const blockChangeEvent = new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this,\n        'disabled',\n        /* name= */ null,\n        /* oldValue= */ !disabled,\n        /* newValue= */ disabled,\n      ) as BlockChange;\n      blockChangeEvent.setDisabledReason(reason);\n      eventUtils.fire(blockChangeEvent);\n    }\n  }\n\n  /**\n   * Get whether the block is disabled or not due to parents.\n   * The block's own disabled property is not considered.\n   *\n   * @returns True if disabled.\n   */\n  getInheritedDisabled(): boolean {\n    let ancestor = this.getSurroundParent();\n    while (ancestor) {\n      if (!ancestor.isEnabled()) {\n        return true;\n      }\n      ancestor = ancestor.getSurroundParent();\n    }\n    // Ran off the top.\n    return false;\n  }\n\n  /**\n   * Get whether the block is currently disabled for the provided reason.\n   *\n   * @param reason A language-neutral identifier for a reason why the block\n   *     could be disabled.\n   * @returns Whether the block is disabled for the provided reason.\n   */\n  hasDisabledReason(reason: string): boolean {\n    return this.disabledReasons.has(reason);\n  }\n\n  /**\n   * Get a set of reasons why the block is currently disabled, if any. If the\n   * block is enabled, this set will be empty.\n   *\n   * @returns The set of reasons why the block is disabled, if any.\n   */\n  getDisabledReasons(): ReadonlySet<string> {\n    return this.disabledReasons;\n  }\n\n  /**\n   * Get whether the block is collapsed or not.\n   *\n   * @returns True if collapsed.\n   */\n  isCollapsed(): boolean {\n    return this.collapsed_;\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ !== collapsed) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this,\n          'collapsed',\n          null,\n          this.collapsed_,\n          collapsed,\n        ),\n      );\n      this.collapsed_ = collapsed;\n    }\n  }\n\n  /**\n   * Create a human-readable text representation of this block and any children.\n   *\n   * @param opt_maxLength Truncate the string to this length.\n   * @param opt_emptyToken The placeholder string used to denote an empty input.\n   *     If not specified, '?' is used.\n   * @returns Text of block.\n   */\n  toString(opt_maxLength?: number, opt_emptyToken?: string): string {\n    const tokens = this.toTokens(opt_emptyToken);\n\n    // Run through our tokens array and simplify expression to remove\n    // parentheses around single field blocks.\n    // E.g. ['repeat', '(', '10', ')', 'times', 'do', '?']\n    for (let i = 2; i < tokens.length; i++) {\n      if (tokens[i - 2] === '(' && tokens[i] === ')') {\n        tokens[i - 2] = tokens[i - 1];\n        tokens.splice(i - 1, 2);\n      }\n    }\n\n    // Join the text array, removing the spaces around added parentheses.\n    let prev = '';\n    let text: string = tokens.reduce((acc, curr) => {\n      const val = acc + (prev === '(' || curr === ')' ? '' : ' ') + curr;\n      prev = curr[curr.length - 1];\n      return val;\n    }, '');\n\n    text = text.trim() || '???';\n    if (opt_maxLength) {\n      // TODO: Improve truncation so that text from this block is given\n      // priority. E.g. \"1+2+3+4+5+6+7+8+9=0\" should be \"...6+7+8+9=0\", not\n      // \"1+2+3+4+5...\". E.g. \"1+2+3+4+5=6+7+8+9+0\" should be \"...4+5=6+7...\".\n      if (text.length > opt_maxLength) {\n        text = text.substring(0, opt_maxLength - 3) + '...';\n      }\n    }\n    return text;\n  }\n\n  /**\n   * Converts this block into string tokens.\n   *\n   * @param emptyToken The token to use in place of an empty input.\n   *     Defaults to '?'.\n   * @returns The array of string tokens representing this block.\n   */\n  private toTokens(emptyToken = '?'): string[] {\n    const tokens = [];\n    /**\n     * Whether or not to add parentheses around an input.\n     *\n     * @param connection The connection.\n     * @returns True if we should add parentheses around the input.\n     */\n    function shouldAddParentheses(connection: Connection): boolean {\n      let checks = connection.getCheck();\n      if (!checks && connection.targetConnection) {\n        checks = connection.targetConnection.getCheck();\n      }\n      return (\n        !!checks && (checks.includes('Boolean') || checks.includes('Number'))\n      );\n    }\n\n    for (const input of this.inputList) {\n      if (input.name == constants.COLLAPSED_INPUT_NAME) {\n        continue;\n      }\n      for (const field of input.fieldRow) {\n        tokens.push(field.getText());\n      }\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          const shouldAddParens = shouldAddParentheses(input.connection);\n          if (shouldAddParens) tokens.push('(');\n          tokens.push(...child.toTokens(emptyToken));\n          if (shouldAddParens) tokens.push(')');\n        } else {\n          tokens.push(emptyToken);\n        }\n      }\n    }\n    return tokens;\n  }\n\n  /**\n   * Appends a value input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendValueInput(name: string): Input {\n    return this.appendInput(new ValueInput(name, this));\n  }\n\n  /**\n   * Appends a statement input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendStatementInput(name: string): Input {\n    this.statementInputCount++;\n    return this.appendInput(new StatementInput(name, this));\n  }\n\n  /**\n   * Appends a dummy input row.\n   *\n   * @param name Optional language-neutral identifier which may used to find\n   *     this input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendDummyInput(name = ''): Input {\n    return this.appendInput(new DummyInput(name, this));\n  }\n\n  /**\n   * Appends an input that ends the row.\n   *\n   * @param name Optional language-neutral identifier which may used to find\n   *     this input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendEndRowInput(name = ''): Input {\n    return this.appendInput(new EndRowInput(name, this));\n  }\n\n  /**\n   * Appends the given input row.\n   *\n   * Allows for custom inputs to be appended to the block.\n   */\n  appendInput(input: Input): Input {\n    this.inputList.push(input);\n    return input;\n  }\n\n  /**\n   * Appends an input with the given input type and name to the block after\n   * constructing it from the registry.\n   *\n   * @param type The name the input is registered under in the registry.\n   * @param name The name the input will have within the block.\n   * @returns The constucted input, or null if there was no constructor\n   *     associated with the type.\n   */\n  private appendInputFromRegistry(type: string, name: string): Input | null {\n    const inputConstructor = registry.getClass(\n      registry.Type.INPUT,\n      type,\n      false,\n    );\n    if (!inputConstructor) return null;\n    return this.appendInput(new inputConstructor(name, this));\n  }\n\n  /**\n   * Initialize this block using a cross-platform, internationalization-friendly\n   * JSON description.\n   *\n   * @param json Structured data describing the block.\n   */\n  jsonInit(json: AnyDuringMigration) {\n    const warningPrefix = json['type'] ? 'Block \"' + json['type'] + '\": ' : '';\n\n    // Validate inputs.\n    if (json['output'] && json['previousStatement']) {\n      throw Error(\n        warningPrefix + 'Must not have both an output and a previousStatement.',\n      );\n    }\n\n    // Validate that each arg has a corresponding message\n    let n = 0;\n    while (json['args' + n]) {\n      if (json['message' + n] === undefined) {\n        throw Error(\n          warningPrefix +\n            `args${n} must have a corresponding message (message${n}).`,\n        );\n      }\n      n++;\n    }\n\n    // Set basic properties of block.\n    // Makes styles backward compatible with old way of defining hat style.\n    if (json['style'] && json['style'].hat) {\n      this.hat = json['style'].hat;\n      // Must set to null so it doesn't error when checking for style and\n      // colour.\n      json['style'] = null;\n    }\n\n    if (json['style'] && json['colour']) {\n      throw Error(warningPrefix + 'Must not have both a colour and a style.');\n    } else if (json['style']) {\n      this.jsonInitStyle_(json, warningPrefix);\n    } else {\n      this.jsonInitColour_(json, warningPrefix);\n    }\n\n    // Interpolate the message blocks.\n    let i = 0;\n    while (json['message' + i] !== undefined) {\n      this.interpolate_(\n        json['message' + i],\n        json['args' + i] || [],\n        // Backwards compatibility: lastDummyAlign aliases implicitAlign.\n        json['implicitAlign' + i] || json['lastDummyAlign' + i],\n        warningPrefix,\n      );\n      i++;\n    }\n\n    if (json['inputsInline'] !== undefined) {\n      eventUtils.disable();\n      this.setInputsInline(json['inputsInline']);\n      eventUtils.enable();\n    }\n\n    // Set output and previous/next connections.\n    if (json['output'] !== undefined) {\n      this.setOutput(true, json['output']);\n    }\n    if (json['outputShape'] !== undefined) {\n      this.setOutputShape(json['outputShape']);\n    }\n    if (json['previousStatement'] !== undefined) {\n      this.setPreviousStatement(true, json['previousStatement']);\n    }\n    if (json['nextStatement'] !== undefined) {\n      this.setNextStatement(true, json['nextStatement']);\n    }\n    if (json['tooltip'] !== undefined) {\n      const rawValue = json['tooltip'];\n      const localizedText = parsing.replaceMessageReferences(rawValue);\n      this.setTooltip(localizedText);\n    }\n    if (json['enableContextMenu'] !== undefined) {\n      this.contextMenu = !!json['enableContextMenu'];\n    }\n    if (json['suppressPrefixSuffix'] !== undefined) {\n      this.suppressPrefixSuffix = !!json['suppressPrefixSuffix'];\n    }\n    if (json['helpUrl'] !== undefined) {\n      const rawValue = json['helpUrl'];\n      const localizedValue = parsing.replaceMessageReferences(rawValue);\n      this.setHelpUrl(localizedValue);\n    }\n    if (typeof json['extensions'] === 'string') {\n      console.warn(\n        warningPrefix +\n          \"JSON attribute 'extensions' should be an array of\" +\n          \" strings. Found raw string in JSON for '\" +\n          json['type'] +\n          \"' block.\",\n      );\n      json['extensions'] = [json['extensions']]; // Correct and continue.\n    }\n\n    // Add the mutator to the block.\n    if (json['mutator'] !== undefined) {\n      Extensions.apply(json['mutator'], this, true);\n    }\n\n    const extensionNames = json['extensions'];\n    if (Array.isArray(extensionNames)) {\n      for (let j = 0; j < extensionNames.length; j++) {\n        Extensions.apply(extensionNames[j], this, false);\n      }\n    }\n  }\n\n  /**\n   * Initialize the colour of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitColour_(json: AnyDuringMigration, warningPrefix: string) {\n    if ('colour' in json) {\n      if (json['colour'] === undefined) {\n        console.warn(warningPrefix + 'Undefined colour value.');\n      } else {\n        const rawValue = json['colour'];\n        try {\n          this.setColour(rawValue);\n        } catch (e) {\n          console.warn(warningPrefix + 'Illegal colour value: ', rawValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the style of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitStyle_(json: AnyDuringMigration, warningPrefix: string) {\n    const blockStyleName = json['style'];\n    try {\n      this.setStyle(blockStyleName);\n    } catch (styleError) {\n      console.warn(warningPrefix + 'Style does not exist: ', blockStyleName);\n    }\n  }\n\n  /**\n   * Add key/values from mixinObj to this block object. By default, this method\n   * will check that the keys in mixinObj will not overwrite existing values in\n   * the block, including prototype values. This provides some insurance against\n   * mixin / extension incompatibilities with future block features. This check\n   * can be disabled by passing true as the second argument.\n   *\n   * @param mixinObj The key/values pairs to add to this block object.\n   * @param opt_disableCheck Option flag to disable overwrite checks.\n   */\n  mixin(mixinObj: AnyDuringMigration, opt_disableCheck?: boolean) {\n    if (\n      opt_disableCheck !== undefined &&\n      typeof opt_disableCheck !== 'boolean'\n    ) {\n      throw Error('opt_disableCheck must be a boolean if provided');\n    }\n    if (!opt_disableCheck) {\n      const overwrites = [];\n      for (const key in mixinObj) {\n        if ((this as AnyDuringMigration)[key] !== undefined) {\n          overwrites.push(key);\n        }\n      }\n      if (overwrites.length) {\n        throw Error(\n          'Mixin will overwrite block members: ' + JSON.stringify(overwrites),\n        );\n      }\n    }\n    Object.assign(this, mixinObj);\n  }\n\n  /**\n   * Interpolate a message description onto the block.\n   *\n   * @param message Text contains interpolation tokens (%1, %2, ...) that match\n   *     with fields or inputs defined in the args array.\n   * @param args Array of arguments to be interpolated.\n   * @param implicitAlign If an implicit input is added at the end or in place\n   *     of newline tokens, how should it be aligned?\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private interpolate_(\n    message: string,\n    args: AnyDuringMigration[],\n    implicitAlign: string | undefined,\n    warningPrefix: string,\n  ) {\n    const tokens = parsing.tokenizeInterpolation(message);\n    this.validateTokens_(tokens, args.length);\n    const elements = this.interpolateArguments_(tokens, args, implicitAlign);\n\n    // An array of [field, fieldName] tuples.\n    const fieldStack = [];\n    for (let i = 0, element; (element = elements[i]); i++) {\n      if (this.isInputKeyword_(element['type'])) {\n        const input = this.inputFromJson_(element, warningPrefix);\n        // Should never be null, but just in case.\n        if (input) {\n          for (let j = 0, tuple; (tuple = fieldStack[j]); j++) {\n            input.appendField(tuple[0], tuple[1]);\n          }\n          fieldStack.length = 0;\n        }\n      } else {\n        // All other types, including ones starting with 'input_' get routed\n        // here.\n        const field = this.fieldFromJson_(element);\n        if (field) {\n          fieldStack.push([field, element['name']]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validates that the tokens are within the correct bounds, with no\n   * duplicates, and that all of the arguments are referred to. Throws errors if\n   * any of these things are not true.\n   *\n   * @param tokens An array of tokens to validate\n   * @param argsCount The number of args that need to be referred to.\n   */\n  private validateTokens_(tokens: Array<string | number>, argsCount: number) {\n    const visitedArgsHash = [];\n    let visitedArgsCount = 0;\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n      if (typeof token !== 'number') {\n        continue;\n      }\n      if (token < 1 || token > argsCount) {\n        throw Error(\n          'Block \"' +\n            this.type +\n            '\": ' +\n            'Message index %' +\n            token +\n            ' out of range.',\n        );\n      }\n      if (visitedArgsHash[token]) {\n        throw Error(\n          'Block \"' +\n            this.type +\n            '\": ' +\n            'Message index %' +\n            token +\n            ' duplicated.',\n        );\n      }\n      visitedArgsHash[token] = true;\n      visitedArgsCount++;\n    }\n    if (visitedArgsCount !== argsCount) {\n      throw Error(\n        'Block \"' +\n          this.type +\n          '\": ' +\n          'Message does not reference all ' +\n          argsCount +\n          ' arg(s).',\n      );\n    }\n  }\n\n  /**\n   * Inserts args in place of numerical tokens. String args are converted to\n   * JSON that defines a label field. Newline characters are converted to\n   * end-row inputs, and if necessary an extra dummy input is added to the end\n   * of the elements.\n   *\n   * @param tokens The tokens to interpolate\n   * @param args The arguments to insert.\n   * @param implicitAlign The alignment to use for any implicitly added end-row\n   *     or dummy inputs, if necessary.\n   * @returns The JSON definitions of field and inputs to add to the block.\n   */\n  private interpolateArguments_(\n    tokens: Array<string | number>,\n    args: Array<AnyDuringMigration | string>,\n    implicitAlign: string | undefined,\n  ): AnyDuringMigration[] {\n    const elements = [];\n    for (let i = 0; i < tokens.length; i++) {\n      let element = tokens[i];\n      if (typeof element === 'number') {\n        element = args[element - 1];\n      }\n      // Args can be strings, which is why this isn't elseif.\n      if (typeof element === 'string') {\n        if (element === '\\n') {\n          // Convert newline tokens to end-row inputs.\n          const newlineInput = {'type': 'input_end_row'};\n          if (implicitAlign) {\n            (newlineInput as AnyDuringMigration)['align'] = implicitAlign;\n          }\n          element = newlineInput as AnyDuringMigration;\n        } else {\n          // AnyDuringMigration because:  Type '{ text: string; type: string; }\n          // | null' is not assignable to type 'string | number'.\n          element = this.stringToFieldJson_(element) as AnyDuringMigration;\n          if (!element) {\n            continue;\n          }\n        }\n      }\n      elements.push(element);\n    }\n\n    const length = elements.length;\n    if (\n      length &&\n      !this.isInputKeyword_(\n        (elements as AnyDuringMigration)[length - 1]['type'],\n      )\n    ) {\n      const dummyInput = {'type': 'input_dummy'};\n      if (implicitAlign) {\n        (dummyInput as AnyDuringMigration)['align'] = implicitAlign;\n      }\n      elements.push(dummyInput);\n    }\n\n    return elements;\n  }\n\n  /**\n   * Creates a field from the JSON definition of a field. If a field with the\n   * given type cannot be found, this attempts to create a different field using\n   * the 'alt' property of the JSON definition (if it exists).\n   *\n   * @param element The element to try to turn into a field.\n   * @returns The field defined by the JSON, or null if one couldn't be created.\n   */\n  private fieldFromJson_(element: {\n    alt?: string;\n    type: string;\n    text?: string;\n  }): Field | null {\n    const field = fieldRegistry.fromJson(element);\n    if (!field && element['alt']) {\n      if (typeof element['alt'] === 'string') {\n        const json = this.stringToFieldJson_(element['alt']);\n        return json ? this.fieldFromJson_(json) : null;\n      }\n      return this.fieldFromJson_(element['alt']);\n    }\n    return field;\n  }\n\n  /**\n   * Creates an input from the JSON definition of an input. Sets the input's\n   * check and alignment if they are provided.\n   *\n   * @param element The JSON to turn into an input.\n   * @param warningPrefix The prefix to add to warnings to help the developer\n   *     debug.\n   * @returns The input that has been created, or null if one could not be\n   *     created for some reason (should never happen).\n   */\n  private inputFromJson_(\n    element: AnyDuringMigration,\n    warningPrefix: string,\n  ): Input | null {\n    const alignmentLookup = {\n      'LEFT': Align.LEFT,\n      'RIGHT': Align.RIGHT,\n      'CENTRE': Align.CENTRE,\n      'CENTER': Align.CENTRE,\n    };\n\n    let input = null;\n    switch (element['type']) {\n      case 'input_value':\n        input = this.appendValueInput(element['name']);\n        break;\n      case 'input_statement':\n        input = this.appendStatementInput(element['name']);\n        break;\n      case 'input_dummy':\n        input = this.appendDummyInput(element['name']);\n        break;\n      case 'input_end_row':\n        input = this.appendEndRowInput(element['name']);\n        break;\n      default: {\n        input = this.appendInputFromRegistry(element['type'], element['name']);\n        break;\n      }\n    }\n    // Should never be hit because of interpolate_'s checks, but just in case.\n    if (!input) {\n      return null;\n    }\n\n    if (element['check']) {\n      input.setCheck(element['check']);\n    }\n    if (element['align']) {\n      const alignment = (alignmentLookup as AnyDuringMigration)[\n        element['align'].toUpperCase()\n      ];\n      if (alignment === undefined) {\n        console.warn(warningPrefix + 'Illegal align value: ', element['align']);\n      } else {\n        input.setAlign(alignment);\n      }\n    }\n    return input;\n  }\n\n  /**\n   * Returns true if the given string matches one of the input keywords.\n   *\n   * @param str The string to check.\n   * @returns True if the given string matches one of the input keywords, false\n   *     otherwise.\n   */\n  private isInputKeyword_(str: string): boolean {\n    return (\n      str === 'input_value' ||\n      str === 'input_statement' ||\n      str === 'input_dummy' ||\n      str === 'input_end_row' ||\n      registry.hasItem(registry.Type.INPUT, str)\n    );\n  }\n\n  /**\n   * Turns a string into the JSON definition of a label field. If the string\n   * becomes an empty string when trimmed, this returns null.\n   *\n   * @param str String to turn into the JSON definition of a label field.\n   * @returns The JSON definition or null.\n   */\n  private stringToFieldJson_(str: string): {text: string; type: string} | null {\n    str = str.trim();\n    if (str) {\n      return {\n        'type': 'field_label',\n        'text': str,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Move a named input to a different location on this block.\n   *\n   * @param name The name of the input to move.\n   * @param refName Name of input that should be after the moved input, or null\n   *     to be the input at the end.\n   */\n  moveInputBefore(name: string, refName: string | null) {\n    if (name === refName) {\n      return;\n    }\n    // Find both inputs.\n    let inputIndex = -1;\n    let refIndex = refName ? -1 : this.inputList.length;\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        inputIndex = i;\n        if (refIndex !== -1) {\n          break;\n        }\n      } else if (refName && input.name === refName) {\n        refIndex = i;\n        if (inputIndex !== -1) {\n          break;\n        }\n      }\n    }\n    if (inputIndex === -1) {\n      throw Error('Named input \"' + name + '\" not found.');\n    }\n    if (refIndex === -1) {\n      throw Error('Reference input \"' + refName + '\" not found.');\n    }\n    this.moveNumberedInputBefore(inputIndex, refIndex);\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    // Validate arguments.\n    if (inputIndex === refIndex) {\n      throw Error(\"Can't move input to itself.\");\n    }\n    if (inputIndex >= this.inputList.length) {\n      throw RangeError('Input index ' + inputIndex + ' out of bounds.');\n    }\n    if (refIndex > this.inputList.length) {\n      throw RangeError('Reference input ' + refIndex + ' out of bounds.');\n    }\n    // Remove input.\n    const input = this.inputList[inputIndex];\n    this.inputList.splice(inputIndex, 1);\n    if (inputIndex < refIndex) {\n      refIndex--;\n    }\n    // Reinsert input.\n    this.inputList.splice(refIndex, 0, input);\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent an error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  removeInput(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        if (input instanceof StatementInput) this.statementInputCount--;\n        input.dispose();\n        this.inputList.splice(i, 1);\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Input not found: ' + name);\n  }\n\n  /**\n   * Fetches the named input object.\n   *\n   * @param name The name of the input.\n   * @returns The input object, or null if input does not exist.\n   */\n  getInput(name: string): Input | null {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        return input;\n      }\n    }\n    // This input does not exist.\n    return null;\n  }\n\n  /**\n   * Fetches the block attached to the named input.\n   *\n   * @param name The name of the input.\n   * @returns The attached value block, or null if the input is either\n   *     disconnected or if the input does not exist.\n   */\n  getInputTargetBlock(name: string): Block | null {\n    const input = this.getInput(name);\n    return input && input.connection && input.connection.targetBlock();\n  }\n\n  /**\n   * Returns the comment on this block (or null if there is no comment).\n   *\n   * @returns Block's comment.\n   */\n  getCommentText(): string | null {\n    const comment = this.getIcon(IconType.COMMENT);\n    return comment?.getText() ?? null;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  setCommentText(text: string | null) {\n    const comment = this.getIcon(IconType.COMMENT);\n    const oldText = comment?.getText() ?? null;\n    if (oldText === text) return;\n    if (text !== null) {\n      let comment = this.getIcon(IconType.COMMENT);\n      if (!comment) {\n        const commentConstructor = registry.getClass(\n          registry.Type.ICON,\n          IconType.COMMENT.toString(),\n          false,\n        );\n        if (!commentConstructor) {\n          throw new Error(\n            'No comment icon class is registered, so a comment cannot be set',\n          );\n        }\n        const icon = new commentConstructor(this);\n        if (!isCommentIcon(icon)) {\n          throw new Error(\n            'The class registered as a comment icon does not conform to the ' +\n              'ICommentIcon interface',\n          );\n        }\n        comment = this.addIcon(icon);\n      }\n      eventUtils.disable();\n      comment.setText(text);\n      eventUtils.enable();\n    } else {\n      this.removeIcon(IconType.COMMENT);\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this,\n        'comment',\n        null,\n        oldText,\n        text,\n      ),\n    );\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param _text The text, or null to delete.\n   * @param _opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  setWarningText(_text: string | null, _opt_id?: string) {\n    // NOOP.\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param _mutator A mutator dialog instance or null to remove.\n   */\n  setMutator(_mutator: MutatorIcon) {\n    // NOOP.\n  }\n\n  /** Adds the given icon to the block. */\n  addIcon<T extends IIcon>(icon: T): T {\n    if (this.hasIcon(icon.getType())) throw new DuplicateIconType(icon);\n    this.icons.push(icon);\n    this.icons.sort((a, b) => a.getWeight() - b.getWeight());\n    return icon;\n  }\n\n  /**\n   * Removes the icon whose getType matches the given type iconType from the\n   * block.\n   *\n   * @param type The type of the icon to remove from the block.\n   * @returns True if an icon with the given type was found, false otherwise.\n   */\n  removeIcon(type: IconType<IIcon>): boolean {\n    if (!this.hasIcon(type)) return false;\n    this.getIcon(type)?.dispose();\n    this.icons = this.icons.filter((icon) => !icon.getType().equals(type));\n    return true;\n  }\n\n  /**\n   * @returns True if an icon with the given type exists on the block,\n   *     false otherwise.\n   */\n  hasIcon(type: IconType<IIcon>): boolean {\n    return this.icons.some((icon) => icon.getType().equals(type));\n  }\n\n  /**\n   * @param type The type of the icon to retrieve. Prefer passing an `IconType`\n   *     for proper type checking when using typescript.\n   * @returns The icon with the given type if it exists on the block, undefined\n   *     otherwise.\n   */\n  getIcon<T extends IIcon>(type: IconType<T> | string): T | undefined {\n    if (type instanceof IconType) {\n      return this.icons.find((icon) => icon.getType().equals(type)) as T;\n    } else {\n      return this.icons.find((icon) => icon.getType().toString() === type) as T;\n    }\n  }\n\n  /** @returns An array of the icons attached to this block. */\n  getIcons(): IIcon[] {\n    return [...this.icons];\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.xy_;\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  moveBy(dx: number, dy: number, reason?: string[]) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent');\n    }\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n      this,\n    ) as BlockMove;\n    reason && event.setReason(reason);\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   * @internal\n   */\n  makeConnection_(type: ConnectionType): Connection {\n    return new Connection(this, type);\n  }\n\n  /**\n   * Recursively checks whether all statement and value inputs are filled with\n   * blocks. Also checks all following statement blocks in this stack.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    // Account for the shadow block filledness toggle.\n    if (opt_shadowBlocksAreFilled === undefined) {\n      opt_shadowBlocksAreFilled = true;\n    }\n    if (!opt_shadowBlocksAreFilled && this.isShadow()) {\n      return false;\n    }\n\n    // Recursively check each input block of the current block.\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (!input.connection) {\n        continue;\n      }\n      const target = input.connection.targetBlock();\n      if (!target || !target.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n\n    // Recursively check the next block after the current block.\n    const next = this.getNextBlock();\n    if (next) {\n      return next.allInputsFilled(opt_shadowBlocksAreFilled);\n    }\n\n    return true;\n  }\n\n  /**\n   * This method returns a string describing this Block in developer terms (type\n   * name and ID; English only).\n   *\n   * Intended to on be used in console logs and errors. If you need a string\n   * that uses the user's native language (including block text, field values,\n   * and child blocks), use [toString()]{@link Block#toString}.\n   *\n   * @returns The description.\n   */\n  toDevString(): string {\n    let msg = this.type ? '\"' + this.type + '\" block' : 'Block';\n    if (this.id) {\n      msg += ' (id=\"' + this.id + '\")';\n    }\n    return msg;\n  }\n}\n\nexport namespace Block {\n  export interface CommentModel {\n    text: string | null;\n    pinned: boolean;\n    size: Size;\n  }\n}\n\nexport type CommentModel = Block.CommentModel;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a button in the flyout.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FlyoutButton\n\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {IASTNodeLocationSvg} from './blockly.js';\n\n/**\n * Class for a button or label in the flyout.\n */\nexport class FlyoutButton implements IASTNodeLocationSvg {\n  /** The horizontal margin around the text in the button. */\n  static TEXT_MARGIN_X = 5;\n\n  /** The vertical margin around the text in the button. */\n  static TEXT_MARGIN_Y = 2;\n\n  /** The radius of the flyout button's borders. */\n  static BORDER_RADIUS = 4;\n\n  private readonly text: string;\n  private readonly position: Coordinate;\n  private readonly callbackKey: string;\n  private readonly cssClass: string | null;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper: browserEvents.Data | null = null;\n  info: toolbox.ButtonOrLabelInfo;\n\n  /** The width of the button's rect. */\n  width = 0;\n\n  /** The height of the button's rect. */\n  height = 0;\n\n  /** The root SVG group for the button or label. */\n  private svgGroup: SVGGElement | null = null;\n\n  /** The SVG element with the text of the label or button. */\n  private svgText: SVGTextElement | null = null;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the button.\n   * This is null if there is no cursor on the button.\n   */\n  cursorSvg: SVGElement | null = null;\n\n  /**\n   * @param workspace The workspace in which to place this button.\n   * @param targetWorkspace The flyout's target workspace.\n   * @param json The JSON specifying the label/button.\n   * @param isFlyoutLabel Whether this button should be styled as a label.\n   * @internal\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    private readonly targetWorkspace: WorkspaceSvg,\n    json: toolbox.ButtonOrLabelInfo,\n    private readonly isFlyoutLabel: boolean,\n  ) {\n    this.text = json['text'];\n\n    this.position = new Coordinate(0, 0);\n\n    /** The key to the function called when this button is clicked. */\n    this.callbackKey =\n      (json as AnyDuringMigration)[\n        'callbackKey'\n      ] /* Check the lower case version\n                                                   too to satisfy IE */ ||\n      (json as AnyDuringMigration)['callbackkey'];\n\n    /** If specified, a CSS class to add to this button. */\n    this.cssClass = (json as AnyDuringMigration)['web-class'] || null;\n\n    /** The JSON specifying the label / button. */\n    this.info = json;\n  }\n\n  /**\n   * Create the button elements.\n   *\n   * @returns The button's SVG group.\n   */\n  createDom(): SVGElement {\n    let cssClass = this.isFlyoutLabel\n      ? 'blocklyFlyoutLabel'\n      : 'blocklyFlyoutButton';\n    if (this.cssClass) {\n      cssClass += ' ' + this.cssClass;\n    }\n\n    this.svgGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': cssClass},\n      this.workspace.getCanvas(),\n    );\n\n    let shadow;\n    if (!this.isFlyoutLabel) {\n      // Shadow rectangle (light source does not mirror in RTL).\n      shadow = dom.createSvgElement(\n        Svg.RECT,\n        {\n          'class': 'blocklyFlyoutButtonShadow',\n          'rx': FlyoutButton.BORDER_RADIUS,\n          'ry': FlyoutButton.BORDER_RADIUS,\n          'x': 1,\n          'y': 1,\n        },\n        this.svgGroup!,\n      );\n    }\n    // Background rectangle.\n    const rect = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': this.isFlyoutLabel\n          ? 'blocklyFlyoutLabelBackground'\n          : 'blocklyFlyoutButtonBackground',\n        'rx': FlyoutButton.BORDER_RADIUS,\n        'ry': FlyoutButton.BORDER_RADIUS,\n      },\n      this.svgGroup!,\n    );\n\n    const svgText = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': this.isFlyoutLabel ? 'blocklyFlyoutLabelText' : 'blocklyText',\n        'x': 0,\n        'y': 0,\n        'text-anchor': 'middle',\n      },\n      this.svgGroup!,\n    );\n    let text = parsing.replaceMessageReferences(this.text);\n    if (this.workspace.RTL) {\n      // Force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    svgText.textContent = text;\n    if (this.isFlyoutLabel) {\n      this.svgText = svgText;\n      this.workspace\n        .getThemeManager()\n        .subscribe(this.svgText, 'flyoutForegroundColour', 'fill');\n    }\n\n    const fontSize = style.getComputedStyle(svgText, 'fontSize');\n    const fontWeight = style.getComputedStyle(svgText, 'fontWeight');\n    const fontFamily = style.getComputedStyle(svgText, 'fontFamily');\n    this.width = dom.getFastTextWidthWithSizeString(\n      svgText,\n      fontSize,\n      fontWeight,\n      fontFamily,\n    );\n    const fontMetrics = dom.measureFontMetrics(\n      text,\n      fontSize,\n      fontWeight,\n      fontFamily,\n    );\n    this.height = fontMetrics.height;\n\n    if (!this.isFlyoutLabel) {\n      this.width += 2 * FlyoutButton.TEXT_MARGIN_X;\n      this.height += 2 * FlyoutButton.TEXT_MARGIN_Y;\n      shadow?.setAttribute('width', String(this.width));\n      shadow?.setAttribute('height', String(this.height));\n    }\n    rect.setAttribute('width', String(this.width));\n    rect.setAttribute('height', String(this.height));\n\n    svgText.setAttribute('x', String(this.width / 2));\n    svgText.setAttribute(\n      'y',\n      String(this.height / 2 - fontMetrics.height / 2 + fontMetrics.baseline),\n    );\n\n    this.updateTransform();\n\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'EventTarget'.\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\n      this.svgGroup as AnyDuringMigration,\n      'pointerup',\n      this,\n      this.onMouseUp,\n    );\n    return this.svgGroup!;\n  }\n\n  /** Correctly position the flyout button and make it visible. */\n  show() {\n    this.updateTransform();\n    this.svgGroup!.setAttribute('display', 'block');\n  }\n\n  /** Update SVG attributes to match internal state. */\n  private updateTransform() {\n    this.svgGroup!.setAttribute(\n      'transform',\n      'translate(' + this.position.x + ',' + this.position.y + ')',\n    );\n  }\n\n  /**\n   * Move the button to the given x, y coordinates.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   */\n  moveTo(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n    this.updateTransform();\n  }\n\n  /** @returns Whether or not the button is a label. */\n  isLabel(): boolean {\n    return this.isFlyoutLabel;\n  }\n\n  /**\n   * Location of the button.\n   *\n   * @returns x, y coordinates.\n   * @internal\n   */\n  getPosition(): Coordinate {\n    return this.position;\n  }\n\n  /** @returns Text of the button. */\n  getButtonText(): string {\n    return this.text;\n  }\n\n  /**\n   * Get the button's target workspace.\n   *\n   * @returns The target workspace of the flyout where this button resides.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /**\n   * Get the button's workspace.\n   *\n   * @returns The workspace in which to place this button.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace;\n  }\n\n  /** Dispose of this button. */\n  dispose() {\n    if (this.onMouseUpWrapper) {\n      browserEvents.unbind(this.onMouseUpWrapper);\n    }\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.svgText) {\n      this.workspace.getThemeManager().unsubscribe(this.svgText);\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this buttons's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the button SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n    if (this.svgGroup) {\n      this.svgGroup.appendChild(cursorSvg);\n      this.cursorSvg = cursorSvg;\n    }\n  }\n\n  /**\n   * Required by IASTNodeLocationSvg, but not used. A marker cannot be set on a\n   * button. If the 'mark' shortcut is used on a button, its associated callback\n   * function is triggered.\n   */\n  setMarkerSvg() {\n    throw new Error('Attempted to set a marker on a button.');\n  }\n\n  /**\n   * Do something when the button is clicked.\n   *\n   * @param e Pointer up event.\n   */\n  private onMouseUp(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.cancel();\n    }\n\n    if (this.isFlyoutLabel && this.callbackKey) {\n      console.warn(\n        'Labels should not have callbacks. Label text: ' + this.text,\n      );\n    } else if (\n      !this.isFlyoutLabel &&\n      !(\n        this.callbackKey &&\n        this.targetWorkspace.getButtonCallback(this.callbackKey)\n      )\n    ) {\n      console.warn('Buttons should have callbacks. Button text: ' + this.text);\n    } else if (!this.isFlyoutLabel) {\n      const callback = this.targetWorkspace.getButtonCallback(this.callbackKey);\n      if (callback) {\n        callback(this);\n      }\n    }\n  }\n}\n\n/** CSS for buttons and labels. See css.js for use. */\nCss.register(`\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n`);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a marker move.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.MarkerMove\n\nimport type {Block} from '../block.js';\nimport {ASTNode} from '../keyboard_nav/ast_node.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners that a marker (used for keyboard navigation) has\n * moved.\n */\nexport class MarkerMove extends UiBase {\n  /** The ID of the block the marker is now on, if any. */\n  blockId?: string;\n\n  /** The old node the marker used to be on, if any. */\n  oldNode?: ASTNode;\n\n  /** The new node the marker is now on. */\n  newNode?: ASTNode;\n\n  /**\n   * True if this is a cursor event, false otherwise.\n   * For information about cursors vs markers see {@link\n   * https://blocklycodelabs.dev/codelabs/keyboard-navigation/index.html?index=..%2F..index#1}.\n   */\n  isCursor?: boolean;\n\n  override type = eventUtils.MARKER_MOVE;\n\n  /**\n   * @param opt_block The affected block. Null if current node is of type\n   *     workspace. Undefined for a blank event.\n   * @param isCursor Whether this is a cursor event. Undefined for a blank\n   *     event.\n   * @param opt_oldNode The old node the marker used to be on.\n   *    Undefined for a blank event.\n   * @param opt_newNode The new node the marker is now on.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: Block | null,\n    isCursor?: boolean,\n    opt_oldNode?: ASTNode | null,\n    opt_newNode?: ASTNode,\n  ) {\n    let workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    if (opt_newNode && opt_newNode.getType() === ASTNode.types.WORKSPACE) {\n      workspaceId = (opt_newNode.getLocation() as Workspace).id;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block?.id;\n    this.oldNode = opt_oldNode || undefined;\n    this.newNode = opt_newNode;\n    this.isCursor = isCursor;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): MarkerMoveJson {\n    const json = super.toJson() as MarkerMoveJson;\n    if (this.isCursor === undefined) {\n      throw new Error(\n        'Whether this is a cursor event or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson',\n      );\n    }\n    if (!this.newNode) {\n      throw new Error(\n        'The new node is undefined. Either pass a node to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isCursor'] = this.isCursor;\n    json['blockId'] = this.blockId;\n    json['oldNode'] = this.oldNode;\n    json['newNode'] = this.newNode;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of MarkerMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: MarkerMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): MarkerMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new MarkerMove(),\n    ) as MarkerMove;\n    newEvent.isCursor = json['isCursor'];\n    newEvent.blockId = json['blockId'];\n    newEvent.oldNode = json['oldNode'];\n    newEvent.newNode = json['newNode'];\n    return newEvent;\n  }\n}\n\nexport interface MarkerMoveJson extends AbstractEventJson {\n  isCursor: boolean;\n  blockId?: string;\n  oldNode?: ASTNode;\n  newNode: ASTNode;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MARKER_MOVE, MarkerMove);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.MarkerSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../../events/events_marker_move.js';\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport * as eventUtils from '../../events/utils.js';\nimport type {Field} from '../../field.js';\nimport type {IASTNodeLocationSvg} from '../../interfaces/i_ast_node_location_svg.js';\nimport {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\nimport {FlyoutButton} from '../../flyout_button.js';\n\n/** The name of the CSS class for a cursor. */\nconst CURSOR_CLASS = 'blocklyCursor';\n\n/** The name of the CSS class for a marker. */\nconst MARKER_CLASS = 'blocklyMarker';\n\n/**\n * What we multiply the height by to get the height of the marker.\n * Only used for the block and block connections.\n */\nconst HEIGHT_MULTIPLIER = 3 / 4;\n\n/**\n * Class for a marker, containing methods for graphically rendering a marker as\n * SVG.\n */\nexport class MarkerSvg {\n  /**\n   * The workspace, field, or block that the marker SVG element should be\n   * attached to.\n   */\n  private parent: IASTNodeLocationSvg | null = null;\n\n  /** The current SVG element for the marker. */\n  currentMarkerSvg: SVGElement | null = null;\n  colour_: string;\n\n  /** The root SVG group containing the marker. */\n  protected markerSvg_: SVGGElement | null = null;\n  protected svgGroup_: SVGGElement | null = null;\n\n  protected markerBlock_: SVGPathElement | null = null;\n\n  protected markerInput_: SVGPathElement | null = null;\n  protected markerSvgLine_: SVGRectElement | null = null;\n\n  protected markerSvgRect_: SVGRectElement | null = null;\n\n  /** The constants necessary to draw the marker. */\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    constants: ConstantProvider,\n    private readonly marker: Marker,\n  ) {\n    this.constants_ = constants;\n\n    const defaultColour = this.isCursor()\n      ? this.constants_.CURSOR_COLOUR\n      : this.constants_.MARKER_COLOUR;\n\n    /** The colour of the marker. */\n    this.colour_ = marker.colour || defaultColour;\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node.\n   */\n  getSvgRoot(): SVGElement | null {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the marker.\n   *\n   * @returns The marker to draw for.\n   */\n  getMarker(): Marker {\n    return this.marker;\n  }\n\n  /**\n   * True if the marker should be drawn as a cursor, false otherwise.\n   * A cursor is drawn as a flashing line. A marker is drawn as a solid line.\n   *\n   * @returns True if the marker is a cursor, false otherwise.\n   */\n  isCursor(): boolean {\n    return this.marker.type === 'cursor';\n  }\n\n  /**\n   * Create the DOM element for the marker.\n   *\n   * @returns The marker controls SVG group.\n   */\n  createDom(): SVGElement {\n    const className = this.isCursor() ? CURSOR_CLASS : MARKER_CLASS;\n\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': className});\n\n    this.createDomInternal_();\n    return this.svgGroup_;\n  }\n\n  /**\n   * Attaches the SVG root of the marker to the SVG group of the parent.\n   *\n   * @param newParent The workspace, field, or block that the marker SVG element\n   *     should be attached to.\n   */\n  protected setParent_(newParent: IASTNodeLocationSvg) {\n    if (!this.isCursor()) {\n      if (this.parent) {\n        this.parent.setMarkerSvg(null);\n      }\n      newParent.setMarkerSvg(this.getSvgRoot());\n    } else {\n      if (this.parent) {\n        this.parent.setCursorSvg(null);\n      }\n      newParent.setCursorSvg(this.getSvgRoot());\n    }\n    this.parent = newParent;\n  }\n\n  /**\n   * Update the marker.\n   *\n   * @param oldNode The previous node the marker was on or null.\n   * @param curNode The node that we want to draw the marker for.\n   */\n  draw(oldNode: ASTNode, curNode: ASTNode) {\n    if (!curNode) {\n      this.hide();\n      return;\n    }\n\n    this.constants_ = this.workspace.getRenderer().getConstants();\n\n    const defaultColour = this.isCursor()\n      ? this.constants_.CURSOR_COLOUR\n      : this.constants_.MARKER_COLOUR;\n    this.colour_ = this.marker.colour || defaultColour;\n    this.applyColour_(curNode);\n\n    this.showAtLocation_(curNode);\n\n    this.fireMarkerEvent(oldNode, curNode);\n\n    // Ensures the marker will be visible immediately after the move.\n    const animate = this.currentMarkerSvg!.childNodes[0];\n    if (animate !== undefined) {\n      (animate as SVGAnimationElement).beginElement &&\n        (animate as SVGAnimationElement).beginElement();\n    }\n  }\n\n  /**\n   * Update the marker's visible state based on the type of curNode..\n   *\n   * @param curNode The node that we want to draw the marker for.\n   */\n  protected showAtLocation_(curNode: ASTNode) {\n    const curNodeAsConnection = curNode.getLocation() as Connection;\n    const connectionType = curNodeAsConnection.type;\n    if (curNode.getType() === ASTNode.types.BLOCK) {\n      this.showWithBlock_(curNode);\n    } else if (curNode.getType() === ASTNode.types.OUTPUT) {\n      this.showWithOutput_(curNode);\n    } else if (connectionType === ConnectionType.INPUT_VALUE) {\n      this.showWithInput_(curNode);\n    } else if (connectionType === ConnectionType.NEXT_STATEMENT) {\n      this.showWithNext_(curNode);\n    } else if (curNode.getType() === ASTNode.types.PREVIOUS) {\n      this.showWithPrevious_(curNode);\n    } else if (curNode.getType() === ASTNode.types.FIELD) {\n      this.showWithField_(curNode);\n    } else if (curNode.getType() === ASTNode.types.WORKSPACE) {\n      this.showWithCoordinates_(curNode);\n    } else if (curNode.getType() === ASTNode.types.STACK) {\n      this.showWithStack_(curNode);\n    } else if (curNode.getType() === ASTNode.types.BUTTON) {\n      this.showWithButton_(curNode);\n    }\n  }\n\n  /**************************\n   * Display\n   **************************/\n\n  /**\n   * Show the marker as a combination of the previous connection and block,\n   * the output connection and block, or just the block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithBlockPrevOutput(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const width = block.width;\n    const height = block.height;\n    const markerHeight = height * HEIGHT_MULTIPLIER;\n    const markerOffset = this.constants_.CURSOR_BLOCK_PADDING;\n\n    if (block.previousConnection) {\n      const connectionShape = this.constants_.shapeFor(\n        block.previousConnection,\n      ) as Notch;\n      this.positionPrevious_(\n        width,\n        markerOffset,\n        markerHeight,\n        connectionShape,\n      );\n    } else if (block.outputConnection) {\n      const connectionShape = this.constants_.shapeFor(\n        block.outputConnection,\n      ) as PuzzleTab;\n      this.positionOutput_(width, height, connectionShape);\n    } else {\n      this.positionBlock_(width, markerOffset, markerHeight);\n    }\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithBlock_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for a previous connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithPrevious_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithOutput_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for a workspace coordinate.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithCoordinates_(curNode: ASTNode) {\n    const wsCoordinate = curNode.getWsCoordinate();\n    let x = wsCoordinate.x;\n    const y = wsCoordinate.y;\n\n    if (this.workspace.RTL) {\n      x -= this.constants_.CURSOR_WS_WIDTH;\n    }\n\n    this.positionLine_(x, y, this.constants_.CURSOR_WS_WIDTH);\n    this.setParent_(this.workspace);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a field.\n   * This is a box around the field.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithField_(curNode: ASTNode) {\n    const field = curNode.getLocation() as Field;\n    const width = field.getSize().width;\n    const height = field.getSize().height;\n\n    this.positionRect_(0, 0, width, height);\n    this.setParent_(field);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for an input.\n   * This is a puzzle piece.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithInput_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const sourceBlock = connection.getSourceBlock();\n\n    this.positionInput_(connection);\n    this.setParent_(sourceBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a next connection.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithNext_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const targetBlock = connection.getSourceBlock();\n    let x = 0;\n    const y = connection.getOffsetInBlock().y;\n    const width = targetBlock.getHeightWidth().width;\n    if (this.workspace.RTL) {\n      x = -width;\n    }\n    this.positionLine_(x, y, width);\n    this.setParent_(targetBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a stack.\n   * This is a box with extra padding around the entire stack of blocks.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithStack_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a flyout button.\n   * This is a box with extra padding around the button.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithButton_(curNode: ASTNode) {\n    const button = curNode.getLocation() as FlyoutButton;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = {height: button.height, width: button.width};\n\n    // Add padding so that being on a button looks similar to being on a stack.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(button);\n    this.showCurrent_();\n  }\n\n  /** Show the current marker. */\n  protected showCurrent_() {\n    this.hide();\n    if (this.currentMarkerSvg) {\n      this.currentMarkerSvg.style.display = '';\n    }\n  }\n\n  /**************************\n   * Position\n   **************************/\n\n  /**\n   * Position the marker for a block.\n   * Displays an outline of the top half of a rectangle around a block.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The extra padding for around the block.\n   * @param markerHeight The height of the marker.\n   */\n  protected positionBlock_(\n    width: number,\n    markerOffset: number,\n    markerHeight: number,\n  ) {\n    const markerPath =\n      svgPaths.moveBy(-markerOffset, markerHeight) +\n      svgPaths.lineOnAxis('V', -markerOffset) +\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n      svgPaths.lineOnAxis('V', markerHeight);\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the marker',\n      );\n    }\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for an input connection.\n   * Displays a filled in puzzle piece.\n   *\n   * @param connection The connection to position marker around.\n   */\n  protected positionInput_(connection: RenderedConnection) {\n    const x = connection.getOffsetInBlock().x;\n    const y = connection.getOffsetInBlock().y;\n\n    const path =\n      svgPaths.moveTo(0, 0) +\n      (this.constants_.shapeFor(connection) as PuzzleTab).pathDown;\n\n    this.markerInput_!.setAttribute('d', path);\n    this.markerInput_!.setAttribute(\n      'transform',\n      'translate(' +\n        x +\n        ',' +\n        y +\n        ')' +\n        (this.workspace.RTL ? ' scale(-1 1)' : ''),\n    );\n    this.currentMarkerSvg = this.markerInput_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a horizontal line.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   */\n  protected positionLine_(x: number, y: number, width: number) {\n    if (!this.markerSvgLine_) {\n      throw new Error('createDom should be called before positioning the line');\n    }\n    this.markerSvgLine_.setAttribute('x', `${x}`);\n    this.markerSvgLine_.setAttribute('y', `${y}`);\n    this.markerSvgLine_.setAttribute('width', `${width}`);\n    this.currentMarkerSvg = this.markerSvgLine_;\n  }\n\n  /**\n   * Position the marker for an output connection.\n   * Displays a puzzle outline and the top and bottom path.\n   *\n   * @param width The width of the block.\n   * @param height The height of the block.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionOutput_(\n    width: number,\n    height: number,\n    connectionShape: PuzzleTab,\n  ) {\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the output',\n      );\n    }\n    const markerPath =\n      svgPaths.moveBy(width, 0) +\n      svgPaths.lineOnAxis('h', -(width - connectionShape.width)) +\n      svgPaths.lineOnAxis('v', this.constants_.TAB_OFFSET_FROM_TOP) +\n      connectionShape.pathDown +\n      svgPaths.lineOnAxis('V', height) +\n      svgPaths.lineOnAxis('H', width);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for a previous connection.\n   * Displays a half rectangle with a notch in the top to represent the previous\n   * connection.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The offset of the marker from around the block.\n   * @param markerHeight The height of the marker.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionPrevious_(\n    width: number,\n    markerOffset: number,\n    markerHeight: number,\n    connectionShape: Notch,\n  ) {\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the previous connection marker',\n      );\n    }\n    const markerPath =\n      svgPaths.moveBy(-markerOffset, markerHeight) +\n      svgPaths.lineOnAxis('V', -markerOffset) +\n      svgPaths.lineOnAxis('H', this.constants_.NOTCH_OFFSET_LEFT) +\n      connectionShape.pathLeft +\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n      svgPaths.lineOnAxis('V', markerHeight);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a filled in rectangle.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   * @param height The new height, in workspace units.\n   */\n  protected positionRect_(x: number, y: number, width: number, height: number) {\n    if (!this.markerSvgRect_) {\n      throw new Error('createDom should be called before positioning the rect');\n    }\n    this.markerSvgRect_.setAttribute('x', `${x}`);\n    this.markerSvgRect_.setAttribute('y', `${y}`);\n    this.markerSvgRect_.setAttribute('width', `${width}`);\n    this.markerSvgRect_.setAttribute('height', `${height}`);\n    this.currentMarkerSvg = this.markerSvgRect_;\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   *\n   * @param markerSvg The marker that we want to flip.\n   */\n  private flipRtl(markerSvg: SVGElement) {\n    markerSvg.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /** Hide the marker. */\n  hide() {\n    if (\n      !this.markerSvgLine_ ||\n      !this.markerSvgRect_ ||\n      !this.markerInput_ ||\n      !this.markerBlock_\n    ) {\n      throw new Error('createDom should be called before hiding the marker');\n    }\n    this.markerSvgLine_.style.display = 'none';\n    this.markerSvgRect_.style.display = 'none';\n    this.markerInput_.style.display = 'none';\n    this.markerBlock_.style.display = 'none';\n  }\n\n  /**\n   * Fire event for the marker or marker.\n   *\n   * @param oldNode The old node the marker used to be on.\n   * @param curNode The new node the marker is currently on.\n   */\n  private fireMarkerEvent(oldNode: ASTNode, curNode: ASTNode) {\n    const curBlock = curNode.getSourceBlock();\n    const event = new (eventUtils.get(eventUtils.MARKER_MOVE))(\n      curBlock,\n      this.isCursor(),\n      oldNode,\n      curNode,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get the properties to make a marker blink.\n   *\n   * @returns The object holding attributes to make the marker blink.\n   */\n  protected getBlinkProperties_(): {[key: string]: string} {\n    return {\n      'attributeType': 'XML',\n      'attributeName': 'fill',\n      'dur': '1s',\n      'values': this.colour_ + ';transparent;transparent;',\n      'repeatCount': 'indefinite',\n    };\n  }\n\n  /**\n   * Create the marker SVG.\n   *\n   * @returns The SVG node created.\n   */\n  protected createDomInternal_(): Element {\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\"\n        repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n\n    this.markerSvg_ = dom.createSvgElement(\n      Svg.G,\n      {\n        'width': this.constants_.CURSOR_WS_WIDTH,\n        'height': this.constants_.WS_CURSOR_HEIGHT,\n      },\n      this.svgGroup_,\n    );\n\n    // A horizontal line used to represent a workspace coordinate or next\n    // connection.\n    this.markerSvgLine_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': this.constants_.CURSOR_WS_WIDTH,\n        'height': this.constants_.WS_CURSOR_HEIGHT,\n      },\n      this.markerSvg_,\n    );\n\n    // A filled in rectangle used to represent a stack.\n    this.markerSvgRect_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyVerticalMarker',\n        'rx': 10,\n        'ry': 10,\n      },\n      this.markerSvg_,\n    );\n\n    // A filled in puzzle piece used to represent an input value.\n    this.markerInput_ = dom.createSvgElement(\n      Svg.PATH,\n      {'transform': ''},\n      this.markerSvg_,\n    );\n\n    // A path used to represent a previous connection and a block, an output\n    // connection and a block, or a block.\n    this.markerBlock_ = dom.createSvgElement(\n      Svg.PATH,\n      {\n        'transform': '',\n        'fill': 'none',\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n      },\n      this.markerSvg_,\n    );\n\n    this.hide();\n\n    // Markers and stack markers don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerSvgLine_);\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerInput_);\n      dom.createSvgElement(\n        Svg.ANIMATE,\n        {...blinkProperties, attributeName: 'stroke'},\n        this.markerBlock_,\n      );\n    }\n\n    return this.markerSvg_;\n  }\n\n  /**\n   * Apply the marker's colour.\n   *\n   * @param _curNode The node that we want to draw the marker for.\n   */\n  protected applyColour_(_curNode: ASTNode) {\n    if (\n      !this.markerSvgLine_ ||\n      !this.markerSvgRect_ ||\n      !this.markerInput_ ||\n      !this.markerBlock_\n    ) {\n      throw new Error(\n        'createDom should be called before applying color to the markerj',\n      );\n    }\n    this.markerSvgLine_.setAttribute('fill', this.colour_);\n    this.markerSvgRect_.setAttribute('stroke', this.colour_);\n    this.markerInput_.setAttribute('fill', this.colour_);\n    this.markerBlock_.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerSvgLine_.firstElementChild!.setAttribute('values', values);\n      this.markerInput_.firstElementChild!.setAttribute('values', values);\n      this.markerBlock_.firstElementChild!.setAttribute('values', values);\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport {Coordinate} from '../../utils/coordinate.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {IPathObject} from './i_path_object.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject implements IPathObject {\n  svgRoot: SVGElement;\n  svgPath: SVGElement;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement | null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement | null = null;\n\n  constants: ConstantProvider;\n  style: BlockStyle;\n\n  /** Highlight paths associated with connections. */\n  private connectionHighlights = new WeakMap<RenderedConnection, SVGElement>();\n\n  /** Locations of connection highlights. */\n  private highlightOffsets = new WeakMap<RenderedConnection, Coordinate>();\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    constants: ConstantProvider,\n  ) {\n    this.constants = constants;\n    this.style = style;\n    this.svgRoot = root;\n\n    /** The primary path of the block. */\n    this.svgPath = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyPath'},\n      this.svgRoot,\n    );\n  }\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string) {\n    this.svgPath.setAttribute('d', pathString);\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    this.svgRoot.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (this.cursorSvg) {\n      this.svgRoot.insertBefore(markerSvg, this.cursorSvg);\n    } else {\n      this.svgRoot.appendChild(markerSvg);\n    }\n    this.markerSvg = markerSvg;\n  }\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg) {\n    this.svgPath.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPath.setAttribute('fill', this.style.colourPrimary);\n\n    this.updateShadow_(block.isShadow());\n    this.updateDisabled_(!block.isEnabled() || block.getInheritedDisabled());\n  }\n\n  /**\n   * Set the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n  }\n\n  /**\n   * Add or remove the given CSS class on the path object's root SVG element.\n   *\n   * @param className The name of the class to add or remove\n   * @param add True if the class should be added.  False if it should be\n   *     removed.\n   */\n  protected setClass_(className: string, add: boolean) {\n    if (!className) {\n      return;\n    }\n    if (add) {\n      dom.addClass(this.svgRoot, className);\n    } else {\n      dom.removeClass(this.svgRoot, className);\n    }\n  }\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param enable True if highlighted.\n   */\n  updateHighlighted(enable: boolean) {\n    if (enable) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.embossFilterId + ')',\n      );\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a shadow state.\n   *\n   * @param shadow True if the block is a shadow block.\n   */\n  protected updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a disabled state.\n   *\n   * @param disabled True if disabled.\n   */\n  protected updateDisabled_(disabled: boolean) {\n    this.setClass_('blocklyDisabled', disabled);\n    if (disabled) {\n      this.svgPath.setAttribute(\n        'fill',\n        'url(#' + this.constants.disabledPatternId + ')',\n      );\n    }\n  }\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enable: boolean) {\n    this.setClass_('blocklyDraggingDelete', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enable: boolean) {\n    this.setClass_('blocklyInsertionMarker', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enable: boolean) {\n    this.setClass_('blocklyDraggable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be replaced.  If a shadow block, it will disappear.\n   * Otherwise it will bump.\n   *\n   * @param enable True if styling should be added.\n   */\n  updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be connected to the input.\n   *\n   * @param _conn The connection on the input to highlight.\n   * @param _enable True if styling should be added.\n   */\n  updateShapeForInputHighlight(_conn: Connection, _enable: boolean) {\n    // NOOP\n  }\n\n  /** Adds the given path as a connection highlight for the given connection. */\n  addConnectionHighlight(\n    connection: RenderedConnection,\n    connectionPath: string,\n    offset: Coordinate,\n    rtl: boolean,\n  ) {\n    if (this.connectionHighlights.has(connection)) {\n      if (this.currentHighlightMatchesNew(connection, connectionPath, offset)) {\n        return;\n      }\n      this.removeConnectionHighlight(connection);\n    }\n\n    const highlight = dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyHighlightedConnectionPath',\n        'd': connectionPath,\n        'transform':\n          `translate(${offset.x}, ${offset.y})` + (rtl ? ' scale(-1 1)' : ''),\n      },\n      this.svgRoot,\n    );\n    this.connectionHighlights.set(connection, highlight);\n  }\n\n  private currentHighlightMatchesNew(\n    connection: RenderedConnection,\n    newPath: string,\n    newOffset: Coordinate,\n  ): boolean {\n    const currPath = this.connectionHighlights\n      .get(connection)\n      ?.getAttribute('d');\n    const currOffset = this.highlightOffsets.get(connection);\n    return currPath === newPath && Coordinate.equals(currOffset, newOffset);\n  }\n\n  /**\n   * Removes any highlight associated with the given connection, if it exists.\n   */\n  removeConnectionHighlight(connection: RenderedConnection) {\n    const highlight = this.connectionHighlights.get(connection);\n    if (!highlight) return;\n    dom.removeNode(highlight);\n    this.connectionHighlights.delete(connection);\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class that controls updates to connections during drags.\n *\n * @class\n */\n// Former goog.module ID: Blockly.InsertionMarkerManager\n\nimport {finishQueuedRenders} from './render_management.js';\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as renderManagement from './render_management.js';\n\n/** Represents a nearby valid connection. */\ninterface CandidateConnection {\n  /**\n   * A nearby valid connection that is compatible with local.\n   * This is not on any of the blocks that are being dragged.\n   */\n  closest: RenderedConnection;\n  /**\n   * A connection on the dragging stack that is compatible with closest. This is\n   * on the top block that is being dragged or the last block in the dragging\n   * stack.\n   */\n  local: RenderedConnection;\n  radius: number;\n}\n\n/**\n * Class that controls updates to connections during drags.  It is primarily\n * responsible for finding the closest eligible connection and highlighting or\n * unhighlighting it as needed during a drag.\n *\n * @deprecated v10 - Use an IConnectionPreviewer instead.\n */\nexport class InsertionMarkerManager {\n  /**\n   * The top block in the stack being dragged.\n   * Does not change during a drag.\n   */\n  private readonly topBlock: BlockSvg;\n\n  /**\n   * The workspace on which these connections are being dragged.\n   * Does not change during a drag.\n   */\n  private readonly workspace: WorkspaceSvg;\n\n  /**\n   * The last connection on the stack, if it's not the last connection on the\n   * first block.\n   * Set in initAvailableConnections, if at all.\n   */\n  private lastOnStack: RenderedConnection | null = null;\n\n  /**\n   * The insertion marker corresponding to the last block in the stack, if\n   * that's not the same as the first block in the stack.\n   * Set in initAvailableConnections, if at all\n   */\n  private lastMarker: BlockSvg | null = null;\n\n  /**\n   * The insertion marker that shows up between blocks to show where a block\n   * would go if dropped immediately.\n   */\n  private firstMarker: BlockSvg;\n\n  /**\n   * Information about the connection that would be made if the dragging block\n   * were released immediately. Updated on every mouse move.\n   */\n  private activeCandidate: CandidateConnection | null = null;\n\n  /**\n   * Whether the block would be deleted if it were dropped immediately.\n   * Updated on every mouse move.\n   *\n   * @internal\n   */\n  public wouldDeleteBlock = false;\n\n  /**\n   * Connection on the insertion marker block that corresponds to\n   * the active candidate's local connection on the currently dragged block.\n   */\n  private markerConnection: RenderedConnection | null = null;\n\n  /** The block that currently has an input being highlighted, or null. */\n  private highlightedBlock: BlockSvg | null = null;\n\n  /** The block being faded to indicate replacement, or null. */\n  private fadedBlock: BlockSvg | null = null;\n\n  /**\n   * The connections on the dragging blocks that are available to connect to\n   * other blocks.  This includes all open connections on the top block, as\n   * well as the last connection on the block stack.\n   */\n  private availableConnections: RenderedConnection[];\n\n  /** @param block The top block in the stack being dragged. */\n  constructor(block: BlockSvg) {\n    common.setSelected(block);\n    this.topBlock = block;\n\n    this.workspace = block.workspace;\n\n    this.firstMarker = this.createMarkerBlock(this.topBlock);\n\n    this.availableConnections = this.initAvailableConnections();\n\n    if (this.lastOnStack) {\n      this.lastMarker = this.createMarkerBlock(\n        this.lastOnStack.getSourceBlock(),\n      );\n    }\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.availableConnections.length = 0;\n    this.disposeInsertionMarker(this.firstMarker);\n    this.disposeInsertionMarker(this.lastMarker);\n  }\n\n  /**\n   * Update the available connections for the top block. These connections can\n   * change if a block is unplugged and the stack is healed.\n   *\n   * @internal\n   */\n  updateAvailableConnections() {\n    this.availableConnections = this.initAvailableConnections();\n  }\n\n  /**\n   * Return whether the block would be connected if dropped immediately, based\n   * on information from the most recent move event.\n   *\n   * @returns True if the block would be connected if dropped immediately.\n   * @internal\n   */\n  wouldConnectBlock(): boolean {\n    return !!this.activeCandidate;\n  }\n\n  /**\n   * Connect to the closest connection and render the results.\n   * This should be called at the end of a drag.\n   *\n   * @internal\n   */\n  applyConnections() {\n    if (!this.activeCandidate) return;\n    eventUtils.disable();\n    this.hidePreview();\n    eventUtils.enable();\n    const {local, closest} = this.activeCandidate;\n    local.connect(closest);\n    const inferiorConnection = local.isSuperior() ? closest : local;\n    const rootBlock = this.topBlock.getRootBlock();\n\n    finishQueuedRenders().then(() => {\n      blockAnimations.connectionUiEffect(inferiorConnection.getSourceBlock());\n      // bringToFront is incredibly expensive. Delay until the next frame.\n      setTimeout(() => {\n        rootBlock.bringToFront();\n      }, 0);\n    });\n  }\n\n  /**\n   * Update connections based on the most recent move location.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @param dragTarget The drag target that the block is currently over.\n   * @internal\n   */\n  update(dxy: Coordinate, dragTarget: IDragTarget | null) {\n    const newCandidate = this.getCandidate(dxy);\n\n    this.wouldDeleteBlock = this.shouldDelete(!!newCandidate, dragTarget);\n\n    const shouldUpdate =\n      this.wouldDeleteBlock || this.shouldUpdatePreviews(newCandidate, dxy);\n\n    if (shouldUpdate) {\n      // Don't fire events for insertion marker creation or movement.\n      eventUtils.disable();\n      this.maybeHidePreview(newCandidate);\n      this.maybeShowPreview(newCandidate);\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Create an insertion marker that represents the given block.\n   *\n   * @param sourceBlock The block that the insertion marker will represent.\n   * @returns The insertion marker that represents the given block.\n   */\n  private createMarkerBlock(sourceBlock: BlockSvg): BlockSvg {\n    eventUtils.disable();\n    let result: BlockSvg;\n    try {\n      const blockJson = blocks.save(sourceBlock, {\n        addCoordinates: false,\n        addInputBlocks: false,\n        addNextBlocks: false,\n        doFullSerialization: false,\n      });\n\n      if (!blockJson) {\n        throw new Error(\n          `Failed to serialize source block. ${sourceBlock.toDevString()}`,\n        );\n      }\n\n      result = blocks.append(blockJson, this.workspace) as BlockSvg;\n\n      // Turn shadow blocks that are created programmatically during\n      // initalization to insertion markers too.\n      for (const block of result.getDescendants(false)) {\n        block.setInsertionMarker(true);\n      }\n\n      result.initSvg();\n      result.getSvgRoot().setAttribute('visibility', 'hidden');\n    } finally {\n      eventUtils.enable();\n    }\n\n    return result;\n  }\n\n  /**\n   * Populate the list of available connections on this block stack. If the\n   * stack has more than one block, this function will also update lastOnStack.\n   *\n   * @returns A list of available connections.\n   */\n  private initAvailableConnections(): RenderedConnection[] {\n    const available = this.topBlock.getConnections_(false);\n    // Also check the last connection on this stack\n    const lastOnStack = this.topBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== this.topBlock.nextConnection) {\n      available.push(lastOnStack);\n      this.lastOnStack = lastOnStack;\n    }\n    return available;\n  }\n\n  /**\n   * Whether the previews (insertion marker and replacement marker) should be\n   * updated based on the closest candidate and the current drag distance.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns Whether the preview should be updated.\n   */\n  private shouldUpdatePreviews(\n    newCandidate: CandidateConnection | null,\n    dxy: Coordinate,\n  ): boolean {\n    // Only need to update if we were showing a preview before.\n    if (!newCandidate) return !!this.activeCandidate;\n\n    // We weren't showing a preview before, but we should now.\n    if (!this.activeCandidate) return true;\n\n    // We're already showing an insertion marker.\n    // Decide whether the new connection has higher priority.\n    const {local: activeLocal, closest: activeClosest} = this.activeCandidate;\n    if (\n      activeClosest === newCandidate.closest &&\n      activeLocal === newCandidate.local\n    ) {\n      // The connection was the same as the current connection.\n      return false;\n    }\n\n    const xDiff = activeLocal.x + dxy.x - activeClosest.x;\n    const yDiff = activeLocal.y + dxy.y - activeClosest.y;\n    const curDistance = Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n    // Slightly prefer the existing preview over a new preview.\n    return (\n      newCandidate.radius < curDistance - config.currentConnectionPreference\n    );\n  }\n\n  /**\n   * Find the nearest valid connection, which may be the same as the current\n   * closest connection.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns An object containing a local connection, a closest connection, and\n   *     a radius.\n   */\n  private getCandidate(dxy: Coordinate): CandidateConnection | null {\n    // It's possible that a block has added or removed connections during a\n    // drag, (e.g. in a drag/move event handler), so let's update the available\n    // connections. Note that this will be called on every move while dragging,\n    // so it might cause slowness, especially if the block stack is large.  If\n    // so, maybe it could be made more efficient. Also note that we won't update\n    // the connections if we've already connected the insertion marker to a\n    // block.\n    if (!this.markerConnection || !this.markerConnection.isConnected()) {\n      this.updateAvailableConnections();\n    }\n\n    let radius = this.getStartRadius();\n    let candidate = null;\n    for (let i = 0; i < this.availableConnections.length; i++) {\n      const myConnection = this.availableConnections[i];\n      const neighbour = myConnection.closest(radius, dxy);\n      if (neighbour.connection) {\n        candidate = {\n          closest: neighbour.connection,\n          local: myConnection,\n          radius: neighbour.radius,\n        };\n        radius = neighbour.radius;\n      }\n    }\n    return candidate;\n  }\n\n  /**\n   * Decide the radius at which to start searching for the closest connection.\n   *\n   * @returns The radius at which to start the search for the closest\n   *     connection.\n   */\n  private getStartRadius(): number {\n    // If there is already a connection highlighted,\n    // increase the radius we check for making new connections.\n    // When a connection is highlighted, blocks move around when the\n    // insertion marker is created, which could cause the connection became out\n    // of range. By increasing radiusConnection when a connection already\n    // exists, we never \"lose\" the connection from the offset.\n    return this.activeCandidate\n      ? config.connectingSnapRadius\n      : config.snapRadius;\n  }\n\n  /**\n   * Whether ending the drag would delete the block.\n   *\n   * @param newCandidate Whether there is a candidate connection that the\n   *     block could connect to if the drag ended immediately.\n   * @param dragTarget The drag target that the block is currently over.\n   * @returns Whether dropping the block immediately would delete the block.\n   */\n  private shouldDelete(\n    newCandidate: boolean,\n    dragTarget: IDragTarget | null,\n  ): boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n        dragTarget.id,\n        ComponentManager.Capability.DELETE_AREA,\n      );\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea).wouldDelete(this.topBlock);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Show an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the beginning of this function, this.activeConnection should be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeShowPreview(newCandidate: CandidateConnection | null) {\n    if (this.wouldDeleteBlock) return; // Nope, don't add a marker.\n    if (!newCandidate) return; // Nothing to connect to.\n\n    const closest = newCandidate.closest;\n\n    // Something went wrong and we're trying to connect to an invalid\n    // connection.\n    if (\n      closest === this.activeCandidate?.closest ||\n      closest.getSourceBlock().isInsertionMarker()\n    ) {\n      console.log('Trying to connect to an insertion marker');\n      return;\n    }\n    this.activeCandidate = newCandidate;\n    // Add an insertion marker or replacement marker.\n    this.showPreview(this.activeCandidate);\n  }\n\n  /**\n   * A preview should be shown.  This function figures out if it should be a\n   * block highlight or an insertion marker, and shows the appropriate one.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showPreview(activeCandidate: CandidateConnection) {\n    const renderer = this.workspace.getRenderer();\n    const method = renderer.getConnectionPreviewMethod(\n      activeCandidate.closest,\n      activeCandidate.local,\n      this.topBlock,\n    );\n\n    switch (method) {\n      case InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:\n        this.showInsertionInputOutline(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:\n        this.showInsertionMarker(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:\n        this.showReplacementFade(activeCandidate);\n        break;\n    }\n\n    // Optionally highlight the actual connection, as a nod to previous\n    // behaviour.\n    if (renderer.shouldHighlightConnection(activeCandidate.closest)) {\n      activeCandidate.closest.highlight();\n    }\n  }\n\n  /**\n   * Hide an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the end of this function, this.activeCandidate will be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeHidePreview(newCandidate: CandidateConnection | null) {\n    // If there's no new preview, remove the old one but don't bother deleting\n    // it. We might need it later, and this saves disposing of it and recreating\n    // it.\n    if (!newCandidate) {\n      this.hidePreview();\n    } else {\n      if (this.activeCandidate) {\n        const closestChanged =\n          this.activeCandidate.closest !== newCandidate.closest;\n        const localChanged = this.activeCandidate.local !== newCandidate.local;\n\n        // If there's a new preview and there was a preview before, and either\n        // connection has changed, remove the old preview.\n        // Also hide if we had a preview before but now we're going to delete\n        // instead.\n        if (closestChanged || localChanged || this.wouldDeleteBlock) {\n          this.hidePreview();\n        }\n      }\n    }\n\n    // Either way, clear out old state.\n    this.markerConnection = null;\n    this.activeCandidate = null;\n  }\n\n  /**\n   * A preview should be hidden. Loop through all possible preview modes\n   * and hide everything.\n   */\n  private hidePreview() {\n    const closest = this.activeCandidate?.closest;\n    if (\n      closest &&\n      closest.targetBlock() &&\n      this.workspace.getRenderer().shouldHighlightConnection(closest)\n    ) {\n      closest.unhighlight();\n    }\n    this.hideReplacementFade();\n    this.hideInsertionInputOutline();\n    this.hideInsertionMarker();\n  }\n\n  /**\n   * Shows an insertion marker connected to the appropriate blocks (based on\n   * manager state).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionMarker(activeCandidate: CandidateConnection) {\n    const {local, closest} = activeCandidate;\n\n    const isLastInStack = this.lastOnStack && local === this.lastOnStack;\n    let insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\n    if (!insertionMarker) {\n      throw new Error(\n        'Cannot show the insertion marker because there is no insertion ' +\n          'marker block',\n      );\n    }\n    let imConn;\n    try {\n      imConn = insertionMarker.getMatchingConnection(\n        local.getSourceBlock(),\n        local,\n      );\n    } catch (e) {\n      // It's possible that the number of connections on the local block has\n      // changed since the insertion marker was originally created.  Let's\n      // recreate the insertion marker and try again. In theory we could\n      // probably recreate the marker block (e.g. in getCandidate_), which is\n      // called more often during the drag, but creating a block that often\n      // might be too slow, so we only do it if necessary.\n      if (isLastInStack && this.lastOnStack) {\n        this.disposeInsertionMarker(this.lastMarker);\n        this.lastMarker = this.createMarkerBlock(\n          this.lastOnStack.getSourceBlock(),\n        );\n        insertionMarker = this.lastMarker;\n      } else {\n        this.disposeInsertionMarker(this.firstMarker);\n        this.firstMarker = this.createMarkerBlock(this.topBlock);\n        insertionMarker = this.firstMarker;\n      }\n\n      if (!insertionMarker) {\n        throw new Error(\n          'Cannot show the insertion marker because there is no insertion ' +\n            'marker block',\n        );\n      }\n      imConn = insertionMarker.getMatchingConnection(\n        local.getSourceBlock(),\n        local,\n      );\n    }\n\n    if (!imConn) {\n      throw new Error(\n        'Cannot show the insertion marker because there is no ' +\n          'associated connection',\n      );\n    }\n\n    if (imConn === this.markerConnection) {\n      throw new Error(\n        \"Made it to showInsertionMarker_ even though the marker isn't \" +\n          'changing',\n      );\n    }\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    insertionMarker.queueRender();\n    renderManagement.triggerQueuedRenders();\n\n    // Connect() also renders the insertion marker.\n    imConn.connect(closest);\n\n    const originalOffsetToTarget = {\n      x: closest.x - imConn.x,\n      y: closest.y - imConn.y,\n    };\n    const originalOffsetInBlock = imConn.getOffsetInBlock().clone();\n    const imConnConst = imConn;\n    renderManagement.finishQueuedRenders().then(() => {\n      // Position so that the existing block doesn't move.\n      insertionMarker?.positionNearConnection(\n        imConnConst,\n        originalOffsetToTarget,\n        originalOffsetInBlock,\n      );\n      insertionMarker?.getSvgRoot().setAttribute('visibility', 'visible');\n    });\n\n    this.markerConnection = imConn;\n  }\n\n  /**\n   * Disconnects and hides the current insertion marker. Should return the\n   * blocks to their original state.\n   */\n  private hideInsertionMarker() {\n    if (!this.markerConnection) return;\n\n    const markerConn = this.markerConnection;\n    const imBlock = markerConn.getSourceBlock();\n    const markerPrev = imBlock.previousConnection;\n    const markerOutput = imBlock.outputConnection;\n\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\n      // If we are the top block, unplugging doesn't do anything.\n      // The marker connection may not have a target block if we are hiding\n      // as part of applying connections.\n      markerConn.targetBlock()?.unplug(false);\n    } else {\n      imBlock.unplug(true);\n    }\n\n    if (markerConn.targetConnection) {\n      throw Error(\n        'markerConnection still connected at the end of ' +\n          'disconnectInsertionMarker',\n      );\n    }\n\n    this.markerConnection = null;\n    const svg = imBlock.getSvgRoot();\n    if (svg) {\n      svg.setAttribute('visibility', 'hidden');\n    }\n  }\n\n  /**\n   * Shows an outline around the input the closest connection belongs to.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionInputOutline(activeCandidate: CandidateConnection) {\n    const closest = activeCandidate.closest;\n    this.highlightedBlock = closest.getSourceBlock();\n    this.highlightedBlock.highlightShapeForInput(closest, true);\n  }\n\n  /** Hides any visible input outlines. */\n  private hideInsertionInputOutline() {\n    if (!this.highlightedBlock) return;\n\n    if (!this.activeCandidate) {\n      throw new Error(\n        'Cannot hide the insertion marker outline because ' +\n          'there is no active candidate',\n      );\n    }\n    this.highlightedBlock.highlightShapeForInput(\n      this.activeCandidate.closest,\n      false,\n    );\n    this.highlightedBlock = null;\n  }\n\n  /**\n   * Shows a replacement fade affect on the closest connection's target block\n   * (the block that is currently connected to it).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showReplacementFade(activeCandidate: CandidateConnection) {\n    this.fadedBlock = activeCandidate.closest.targetBlock();\n    if (!this.fadedBlock) {\n      throw new Error(\n        'Cannot show the replacement fade because the ' +\n          'closest connection does not have a target block',\n      );\n    }\n    this.fadedBlock.fadeForReplacement(true);\n  }\n\n  /**\n   * Hides/Removes any visible fade affects.\n   */\n  private hideReplacementFade() {\n    if (!this.fadedBlock) return;\n\n    this.fadedBlock.fadeForReplacement(false);\n    this.fadedBlock = null;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    const result = [];\n    if (this.firstMarker) {\n      result.push(this.firstMarker);\n    }\n    if (this.lastMarker) {\n      result.push(this.lastMarker);\n    }\n    return result;\n  }\n\n  /**\n   * Safely disposes of an insertion marker.\n   */\n  private disposeInsertionMarker(marker: BlockSvg | null) {\n    if (marker) {\n      eventUtils.disable();\n      try {\n        marker.dispose();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n  }\n}\n\nexport namespace InsertionMarkerManager {\n  /**\n   * An enum describing different kinds of previews the InsertionMarkerManager\n   * could display.\n   */\n  export enum PREVIEW_TYPE {\n    INSERTION_MARKER = 0,\n    INPUT_OUTLINE = 1,\n    REPLACEMENT_FADE = 2,\n  }\n}\n\nexport type PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\nexport const PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Renderer\n\nimport type {Block} from '../../block.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {\n  InsertionMarkerManager,\n  PreviewType,\n} from '../../insertion_marker_manager.js';\nimport type {IRegistrable} from '../../interfaces/i_registrable.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\n/**\n * The base class for a block renderer.\n */\nexport class Renderer implements IRegistrable {\n  /** The renderer's constant provider. */\n  protected constants_!: ConstantProvider;\n\n  protected name: string;\n\n  /**\n   * Rendering constant overrides, passed in through options.\n   */\n  protected overrides: object | null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Gets the class name that identifies this renderer.\n   *\n   * @returns The CSS class name.\n   */\n  getClassName(): string {\n    return this.name + '-renderer';\n  }\n\n  /**\n   * Initialize the renderer.\n   *\n   * @param theme The workspace theme object.\n   * @param opt_rendererOverrides Rendering constant overrides.\n   */\n  init(\n    theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\n  ) {\n    this.constants_ = this.makeConstants_();\n    if (opt_rendererOverrides) {\n      this.overrides = opt_rendererOverrides;\n      Object.assign(this.constants_, opt_rendererOverrides);\n    }\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs.\n   * If you need to create additional DOM elements, override the\n   * {@link ConstantProvider#createDom} method instead.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   * @internal\n   */\n  createDom(svg: SVGElement, theme: Theme) {\n    this.constants_.createDom(\n      svg,\n      this.name + '-' + theme.name,\n      '.' + this.getClassName() + '.' + theme.getClassName(),\n    );\n  }\n\n  /**\n   * Refresh the renderer after a theme change.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   */\n  refreshDom(svg: SVGElement, theme: Theme) {\n    const previousConstants = this.getConstants();\n    previousConstants.dispose();\n    this.constants_ = this.makeConstants_();\n    if (this.overrides) {\n      Object.assign(this.constants_, this.overrides);\n    }\n    // Ensure the constant provider's random identifier does not change.\n    this.constants_.randomIdentifier = previousConstants.randomIdentifier;\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n    this.createDom(svg, theme);\n  }\n\n  /**\n   * Dispose of this renderer.\n   * Delete all DOM elements that this renderer and its constants created.\n   */\n  dispose() {\n    if (this.constants_) {\n      this.constants_.dispose();\n    }\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected makeDrawer_(block: BlockSvg, info: RenderInfo): Drawer {\n    return new Drawer(block, info);\n  }\n\n  /**\n   * Create a new instance of the renderer's marker drawer.\n   *\n   * @param workspace The workspace the marker belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  makePathObject(root: SVGElement, style: BlockStyle): IPathObject {\n    return new PathObject(root, style, this.constants_);\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * Determine whether or not to highlight a connection.\n   *\n   * @param _conn The connection to determine whether or not to highlight.\n   * @returns True if we should highlight the connection.\n   */\n  shouldHighlightConnection(_conn: Connection): boolean {\n    return true;\n  }\n\n  /**\n   * Checks if an orphaned block can connect to the \"end\" of the topBlock's\n   * block-clump. If the clump is a row the end is the last input. If the clump\n   * is a stack, the end is the last next connection. If the clump is neither,\n   * then this returns false.\n   *\n   * @param topBlock The top block of the block clump we want to try and connect\n   *     to.\n   * @param orphanBlock The orphan block that wants to find a home.\n   * @param localType The type of the connection being dragged.\n   * @returns Whether there is a home for the orphan or not.\n   */\n  protected orphanCanConnectAtEnd(\n    topBlock: BlockSvg,\n    orphanBlock: BlockSvg,\n    localType: number,\n  ): boolean {\n    const orphanConnection =\n      localType === ConnectionType.OUTPUT_VALUE\n        ? orphanBlock.outputConnection\n        : orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n      topBlock as Block,\n      orphanConnection as Connection,\n    );\n  }\n\n  /**\n   * Chooses a connection preview method based on the available connection, the\n   * current dragged connection, and the block being dragged.\n   *\n   * @param closest The available connection.\n   * @param local The connection currently being dragged.\n   * @param topBlock The block currently being dragged.\n   * @returns The preview type to display.\n   *\n   * @deprecated v10 - This function is no longer respected. A custom\n   *    IConnectionPreviewer may be able to fulfill the functionality.\n   */\n  getConnectionPreviewMethod(\n    closest: RenderedConnection,\n    local: RenderedConnection,\n    topBlock: BlockSvg,\n  ): PreviewType {\n    deprecation.warn(\n      'getConnectionPreviewMethod',\n      'v10',\n      'v12',\n      'an IConnectionPreviewer, if it fulfills your use case.',\n    );\n    if (\n      local.type === ConnectionType.OUTPUT_VALUE ||\n      local.type === ConnectionType.PREVIOUS_STATEMENT\n    ) {\n      if (\n        !closest.isConnected() ||\n        this.orphanCanConnectAtEnd(\n          topBlock,\n          closest.targetBlock() as BlockSvg,\n          local.type,\n        )\n      ) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n      }\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n  }\n\n  /**\n   * Render the block.\n   *\n   * @param block The block to render.\n   * @internal\n   */\n  render(block: BlockSvg) {\n    const info = this.makeRenderInfo_(block);\n    info.measure();\n    this.makeDrawer_(block, info).draw();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of storing and updating a workspace theme\n *     and UI components.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ThemeManager\n\nimport type {Theme} from './theme.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as dom from './utils/dom.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for storing and updating a workspace's theme and UI components.\n */\nexport class ThemeManager {\n  /** A list of workspaces that are subscribed to this theme. */\n  private subscribedWorkspaces_: Workspace[] = [];\n  private componentDB = new Map<string, Component[]>();\n\n  /**\n   * @param workspace The main workspace.\n   * @param theme The workspace theme.\n   * @internal\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    private theme: Theme,\n  ) {}\n\n  /**\n   * Get the workspace theme.\n   *\n   * @returns The workspace theme.\n   * @internal\n   */\n  getTheme(): Theme {\n    return this.theme;\n  }\n\n  /**\n   * Set the workspace theme, and refresh the workspace and all components.\n   *\n   * @param theme The workspace theme.\n   * @internal\n   */\n  setTheme(theme: Theme) {\n    const prevTheme = this.theme;\n    this.theme = theme;\n    // Set the theme name onto the injection div.\n    const injectionDiv = this.workspace.getInjectionDiv();\n    if (injectionDiv) {\n      if (prevTheme) {\n        const oldClassName = prevTheme.getClassName();\n        if (oldClassName) {\n          dom.removeClass(injectionDiv, oldClassName);\n        }\n      }\n      const newClassName = this.theme.getClassName();\n      if (newClassName) {\n        dom.addClass(injectionDiv, newClassName);\n      }\n    }\n\n    // Refresh all subscribed workspaces.\n    for (\n      let i = 0, workspace;\n      (workspace = this.subscribedWorkspaces_[i]);\n      i++\n    ) {\n      (workspace as WorkspaceSvg).refreshTheme();\n    }\n\n    // Refresh all registered Blockly UI components.\n    for (const [key, componentList] of this.componentDB) {\n      for (const component of componentList) {\n        const element = component.element;\n        const propertyName = component.propertyName;\n        const style = this.theme && this.theme.getComponentStyle(key);\n        element.style.setProperty(propertyName, style || '');\n      }\n    }\n\n    for (const workspace of this.subscribedWorkspaces_) {\n      (workspace as WorkspaceSvg).hideChaff();\n    }\n  }\n\n  /**\n   * Subscribe a workspace to changes to the selected theme.  If a new theme is\n   * set, the workspace is called to refresh its blocks.\n   *\n   * @param workspace The workspace to subscribe.\n   * @internal\n   */\n  subscribeWorkspace(workspace: Workspace) {\n    this.subscribedWorkspaces_.push(workspace);\n  }\n\n  /**\n   * Unsubscribe a workspace to changes to the selected theme.\n   *\n   * @param workspace The workspace to unsubscribe.\n   * @internal\n   */\n  unsubscribeWorkspace(workspace: Workspace) {\n    if (!arrayUtils.removeElem(this.subscribedWorkspaces_, workspace)) {\n      throw Error(\n        \"Cannot unsubscribe a workspace that hasn't been subscribed.\",\n      );\n    }\n  }\n\n  /**\n   * Subscribe an element to changes to the selected theme.  If a new theme is\n   * selected, the element's style is refreshed with the new theme's style.\n   *\n   * @param element The element to subscribe.\n   * @param componentName The name used to identify the component. This must be\n   *     the same name used to configure the style in the Theme object.\n   * @param propertyName The inline style property name to update.\n   * @internal\n   */\n  subscribe(\n    element: HTMLElement | SVGElement,\n    componentName: string,\n    propertyName: string,\n  ) {\n    if (!this.componentDB.has(componentName)) {\n      this.componentDB.set(componentName, []);\n    }\n\n    // Add the element to our component map.\n    this.componentDB.get(componentName)!.push({element, propertyName});\n\n    // Initialize the element with its corresponding theme style.\n    const style = this.theme && this.theme.getComponentStyle(componentName);\n    element.style.setProperty(propertyName, style || '');\n  }\n\n  /**\n   * Unsubscribe an element to changes to the selected theme.\n   *\n   * @param element The element to unsubscribe.\n   * @internal\n   */\n  unsubscribe(element: HTMLElement | SVGElement) {\n    if (!element) {\n      return;\n    }\n    // Go through all component, and remove any references to this element.\n    for (const [componentName, elements] of this.componentDB) {\n      for (let i = elements.length - 1; i >= 0; i--) {\n        if (elements[i].element === element) {\n          elements.splice(i, 1);\n        }\n      }\n      // Clean up the component map entry if the list is empty.\n      if (!elements.length) {\n        this.componentDB.delete(componentName);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this theme manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.subscribedWorkspaces_.length = 0;\n    this.componentDB.clear();\n  }\n}\n\nexport namespace ThemeManager {\n  /** The type for a Blockly UI Component. */\n  export interface Component {\n    element: HTMLElement | SVGElement;\n    propertyName: string;\n  }\n}\n\nexport type Component = ThemeManager.Component;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.internalConstants\n\nimport {ConnectionType} from './connection_type.js';\n\n/**\n * Number of characters to truncate a collapsed block to.\n *\n * @internal\n */\nexport const COLLAPSE_CHARS = 30;\n\n/**\n * Lookup table for determining the opposite type of a connection.\n *\n * @internal\n */\nexport const OPPOSITE_TYPE: number[] = [];\nOPPOSITE_TYPE[ConnectionType.INPUT_VALUE] = ConnectionType.OUTPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.OUTPUT_VALUE] = ConnectionType.INPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.NEXT_STATEMENT] =\n  ConnectionType.PREVIOUS_STATEMENT;\nOPPOSITE_TYPE[ConnectionType.PREVIOUS_STATEMENT] =\n  ConnectionType.NEXT_STATEMENT;\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Rename\n * variable...' and if selected, should trigger the prompt to rename a variable.\n *\n * @internal\n */\nexport const RENAME_VARIABLE_ID = 'RENAME_VARIABLE_ID';\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Delete the \"%1\"\n * variable' and if selected, should trigger the prompt to delete a variable.\n *\n * @internal\n */\nexport const DELETE_VARIABLE_ID = 'DELETE_VARIABLE_ID';\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that encapsulates logic for checking whether a\n * potential connection is safe and valid.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ConnectionChecker\n\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n/**\n * Class for connection type checking logic.\n */\nexport class ConnectionChecker implements IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): boolean {\n    return (\n      this.canConnectWithReason(a, b, isDragging, opt_distance) ===\n      Connection.CAN_CONNECT\n    );\n  }\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): number {\n    const safety = this.doSafetyChecks(a, b);\n    if (safety !== Connection.CAN_CONNECT) {\n      return safety;\n    }\n\n    // If the safety checks passed, both connections are non-null.\n    const connOne = a!;\n    const connTwo = b!;\n    if (!this.doTypeChecks(connOne, connTwo)) {\n      return Connection.REASON_CHECKS_FAILED;\n    }\n\n    if (\n      isDragging &&\n      !this.doDragChecks(\n        a as RenderedConnection,\n        b as RenderedConnection,\n        opt_distance || 0,\n      )\n    ) {\n      return Connection.REASON_DRAG_CHECKS_FAILED;\n    }\n\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(\n    errorCode: number,\n    a: Connection | null,\n    b: Connection | null,\n  ): string {\n    switch (errorCode) {\n      case Connection.REASON_SELF_CONNECTION:\n        return 'Attempted to connect a block to itself.';\n      case Connection.REASON_DIFFERENT_WORKSPACES:\n        // Usually this means one block has been deleted.\n        return 'Blocks not on same workspace.';\n      case Connection.REASON_WRONG_TYPE:\n        return 'Attempt to connect incompatible types.';\n      case Connection.REASON_TARGET_NULL:\n        return 'Target connection is null.';\n      case Connection.REASON_CHECKS_FAILED: {\n        const connOne = a!;\n        const connTwo = b!;\n        let msg = 'Connection checks failed. ';\n        msg +=\n          connOne +\n          ' expected ' +\n          connOne.getCheck() +\n          ', found ' +\n          connTwo.getCheck();\n        return msg;\n      }\n      case Connection.REASON_SHADOW_PARENT:\n        return 'Connecting non-shadow to shadow block.';\n      case Connection.REASON_DRAG_CHECKS_FAILED:\n        return 'Drag checks failed.';\n      case Connection.REASON_PREVIOUS_AND_OUTPUT:\n        return 'Block would have an output and a previous connection.';\n      default:\n        return 'Unknown connection failure: this should never happen!';\n    }\n  }\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection | null, b: Connection | null): number {\n    if (!a || !b) {\n      return Connection.REASON_TARGET_NULL;\n    }\n    let superiorBlock;\n    let inferiorBlock;\n    let superiorConnection;\n    let inferiorConnection;\n    if (a.isSuperior()) {\n      superiorBlock = a.getSourceBlock();\n      inferiorBlock = b.getSourceBlock();\n      superiorConnection = a;\n      inferiorConnection = b;\n    } else {\n      inferiorBlock = a.getSourceBlock();\n      superiorBlock = b.getSourceBlock();\n      inferiorConnection = a;\n      superiorConnection = b;\n    }\n    if (superiorBlock === inferiorBlock) {\n      return Connection.REASON_SELF_CONNECTION;\n    } else if (\n      inferiorConnection.type !==\n      internalConstants.OPPOSITE_TYPE[superiorConnection.type]\n    ) {\n      return Connection.REASON_WRONG_TYPE;\n    } else if (superiorBlock.workspace !== inferiorBlock.workspace) {\n      return Connection.REASON_DIFFERENT_WORKSPACES;\n    } else if (superiorBlock.isShadow() && !inferiorBlock.isShadow()) {\n      return Connection.REASON_SHADOW_PARENT;\n    } else if (\n      inferiorConnection.type === ConnectionType.OUTPUT_VALUE &&\n      inferiorBlock.previousConnection &&\n      inferiorBlock.previousConnection.isConnected()\n    ) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    } else if (\n      inferiorConnection.type === ConnectionType.PREVIOUS_STATEMENT &&\n      inferiorBlock.outputConnection &&\n      inferiorBlock.outputConnection.isConnected()\n    ) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    }\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean {\n    const checkArrayOne = a.getCheck();\n    const checkArrayTwo = b.getCheck();\n\n    if (!checkArrayOne || !checkArrayTwo) {\n      // One or both sides are promiscuous enough that anything will fit.\n      return true;\n    }\n    // Find any intersection in the check lists.\n    for (let i = 0; i < checkArrayOne.length; i++) {\n      if (checkArrayTwo.includes(checkArrayOne[i])) {\n        return true;\n      }\n    }\n    // No intersection.\n    return false;\n  }\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare (on the block that's being dragged).\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(\n    a: RenderedConnection,\n    b: RenderedConnection,\n    distance: number,\n  ): boolean {\n    if (a.distanceFrom(b) > distance) {\n      return false;\n    }\n\n    // Don't consider insertion markers.\n    if (b.getSourceBlock().isInsertionMarker()) {\n      return false;\n    }\n\n    switch (b.type) {\n      case ConnectionType.PREVIOUS_STATEMENT:\n        return this.canConnectToPrevious_(a, b);\n      case ConnectionType.OUTPUT_VALUE: {\n        // Don't offer to connect an already connected left (male) value plug to\n        // an available right (female) value plug.\n        if (\n          (b.isConnected() && !b.targetBlock()!.isInsertionMarker()) ||\n          a.isConnected()\n        ) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.INPUT_VALUE: {\n        // Offering to connect the left (male) of a value block to an already\n        // connected value pair is ok, we'll splice it in.\n        // However, don't offer to splice into an immovable block.\n        if (\n          b.isConnected() &&\n          !b.targetBlock()!.isMovable() &&\n          !b.targetBlock()!.isShadow()\n        ) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.NEXT_STATEMENT: {\n        // Don't let a block with no next connection bump other blocks out of\n        // the stack.  But covering up a shadow block or stack of shadow blocks\n        // is fine.  Similarly, replacing a terminal statement with another\n        // terminal statement is allowed.\n        if (\n          b.isConnected() &&\n          !a.getSourceBlock().nextConnection &&\n          !b.targetBlock()!.isShadow() &&\n          b.targetBlock()!.nextConnection\n        ) {\n          return false;\n        }\n\n        // Don't offer to splice into a stack where the connected block is\n        // immovable, unless the block is a shadow block.\n        if (\n          b.targetBlock() &&\n          !b.targetBlock()!.isMovable() &&\n          !b.targetBlock()!.isShadow()\n        ) {\n          return false;\n        }\n        break;\n      }\n      default:\n        // Unexpected connection type.\n        return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.includes(b)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Helper function for drag checking.\n   *\n   * @param a The connection to check, which must be a statement input or next\n   *     connection.\n   * @param b A nearby connection to check, which must be a previous connection.\n   * @returns True if the connection is allowed, false otherwise.\n   */\n  protected canConnectToPrevious_(a: Connection, b: Connection): boolean {\n    if (a.targetConnection) {\n      // This connection is already occupied.\n      // A next connection will never disconnect itself mid-drag.\n      return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.includes(b)) {\n      return false;\n    }\n\n    if (!b.targetConnection) {\n      return true;\n    }\n\n    const targetBlock = b.targetBlock();\n    // If it is connected to a real block, game over.\n    if (!targetBlock!.isInsertionMarker()) {\n      return false;\n    }\n    // If it's connected to an insertion marker but that insertion marker\n    // is the first block in a stack, it's still fine.  If that insertion\n    // marker is in the middle of a stack, it won't work.\n    return !targetBlock!.getPreviousBlock();\n  }\n}\n\nregistry.register(\n  registry.Type.CONNECTION_CHECKER,\n  registry.DEFAULT,\n  ConnectionChecker,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.VarDelete\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a variable model has been deleted.\n *\n * @class\n */\nexport class VarDelete extends VarBase {\n  override type = eventUtils.VAR_DELETE;\n  /** The type of the variable that was deleted. */\n  varType?: string;\n  /** The name of the variable that was deleted. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The deleted variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarDeleteJson {\n    const json = super.toJson() as VarDeleteJson;\n    if (this.varType === undefined) {\n      throw new Error(\n        'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarDelete, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarDelete(),\n    ) as VarDelete;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.deleteVariableById(this.varId);\n    } else {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    }\n  }\n}\n\nexport interface VarDeleteJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_DELETE, VarDelete);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.VarRename\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a variable model was renamed.\n *\n * @class\n */\nexport class VarRename extends VarBase {\n  override type = eventUtils.VAR_RENAME;\n\n  /** The previous name of the variable. */\n  oldName?: string;\n\n  /** The new name of the variable. */\n  newName?: string;\n\n  /**\n   * @param opt_variable The renamed variable. Undefined for a blank event.\n   * @param newName The new name the variable will be changed to.\n   */\n  constructor(opt_variable?: VariableModel, newName?: string) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.oldName = opt_variable.name;\n    this.newName = typeof newName === 'undefined' ? '' : newName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarRenameJson {\n    const json = super.toJson() as VarRenameJson;\n    if (!this.oldName) {\n      throw new Error(\n        'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newName) {\n      throw new Error(\n        'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['oldName'] = this.oldName;\n    json['newName'] = this.newName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarRename, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarRenameJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarRename {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarRename(),\n    ) as VarRename;\n    newEvent.oldName = json['oldName'];\n    newEvent.newName = json['newName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable rename event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldName) {\n      throw new Error(\n        'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newName) {\n      throw new Error(\n        'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.renameVariableById(this.varId, this.newName);\n    } else {\n      workspace.renameVariableById(this.varId, this.oldName);\n    }\n  }\n}\n\nexport interface VarRenameJson extends VarBaseJson {\n  oldName: string;\n  newName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_RENAME, VarRename);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a map of variables and their types.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VariableMap\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_delete.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_rename.js';\n\nimport type {Block} from './block.js';\nimport * as dialog from './dialog.js';\nimport * as eventUtils from './events/utils.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a variable map.  This contains a dictionary data structure with\n * variable types as keys and lists of variables as values.  The list of\n * variables are the type indicated by the key.\n */\nexport class VariableMap {\n  /**\n   * A map from variable type to list of variable names.  The lists contain\n   * all of the named variables in the workspace, including variables that are\n   * not currently in use.\n   */\n  private variableMap = new Map<string, VariableModel[]>();\n\n  /** @param workspace The workspace this map belongs to. */\n  constructor(public workspace: Workspace) {}\n\n  /** Clear the variable map.  Fires events for every deletion. */\n  clear() {\n    for (const variables of this.variableMap.values()) {\n      while (variables.length > 0) {\n        this.deleteVariable(variables[0]);\n      }\n    }\n    if (this.variableMap.size !== 0) {\n      throw Error('Non-empty variable map');\n    }\n  }\n\n  /* Begin functions for renaming variables. */\n  /**\n   * Rename the given variable by updating its name in the variable map.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @internal\n   */\n  renameVariable(variable: VariableModel, newName: string) {\n    if (variable.name === newName) return;\n    const type = variable.type;\n    const conflictVar = this.getVariable(newName, type);\n    const blocks = this.workspace.getAllBlocks(false);\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      // The IDs may match if the rename is a simple case change (name1 ->\n      // Name1).\n      if (!conflictVar || conflictVar.getId() === variable.getId()) {\n        this.renameVariableAndUses_(variable, newName, blocks);\n      } else {\n        this.renameVariableWithConflict_(\n          variable,\n          newName,\n          conflictVar,\n          blocks,\n        );\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    const variable = this.getVariableById(id);\n    if (!variable) {\n      throw Error(\"Tried to rename a variable that didn't exist. ID: \" + id);\n    }\n\n    this.renameVariable(variable, newName);\n  }\n\n  /**\n   * Update the name of the given variable and refresh all references to it.\n   * The new name must not conflict with any existing variable names.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableAndUses_(\n    variable: VariableModel,\n    newName: string,\n    blocks: Block[],\n  ) {\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.VAR_RENAME))(variable, newName),\n    );\n    variable.name = newName;\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].updateVarName(variable);\n    }\n  }\n\n  /**\n   * Update the name of the given variable to the same name as an existing\n   * variable.  The two variables are coalesced into a single variable with the\n   * ID of the existing variable that was already using newName. Refresh all\n   * references to the variable.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param conflictVar The variable that was already using newName.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableWithConflict_(\n    variable: VariableModel,\n    newName: string,\n    conflictVar: VariableModel,\n    blocks: Block[],\n  ) {\n    const type = variable.type;\n    const oldCase = conflictVar.name;\n\n    if (newName !== oldCase) {\n      // Simple rename to change the case and update references.\n      this.renameVariableAndUses_(conflictVar, newName, blocks);\n    }\n\n    // These blocks now refer to a different variable.\n    // These will fire change events.\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].renameVarById(variable.getId(), conflictVar.getId());\n    }\n    // Finally delete the original variable, which is now unreferenced.\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\n    // And remove it from the list.\n    arrayUtils.removeElem(this.variableMap.get(type)!, variable);\n  }\n\n  /* End functions for renaming variables. */\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    let variable = this.getVariable(name, opt_type);\n    if (variable) {\n      if (opt_id && variable.getId() !== opt_id) {\n        throw Error(\n          'Variable \"' +\n            name +\n            '\" is already in use and its id is \"' +\n            variable.getId() +\n            '\" which conflicts with the passed in ' +\n            'id, \"' +\n            opt_id +\n            '\".',\n        );\n      }\n      // The variable already exists and has the same ID.\n      return variable;\n    }\n    if (opt_id && this.getVariableById(opt_id)) {\n      throw Error('Variable id, \"' + opt_id + '\", is already in use.');\n    }\n    const id = opt_id || idGenerator.genUid();\n    const type = opt_type || '';\n    variable = new VariableModel(this.workspace, name, type, id);\n\n    const variables = this.variableMap.get(type) || [];\n    variables.push(variable);\n    // Delete the list of variables of this type, and re-add it so that\n    // the most recent addition is at the end.\n    // This is used so the toolbox's set block is set to the most recent\n    // variable.\n    this.variableMap.delete(type);\n    this.variableMap.set(type, variables);\n\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_CREATE))(variable));\n\n    return variable;\n  }\n\n  /* Begin functions for variable deletion. */\n  /**\n   * Delete a variable.\n   *\n   * @param variable Variable to delete.\n   */\n  deleteVariable(variable: VariableModel) {\n    const variableId = variable.getId();\n    const variableList = this.variableMap.get(variable.type);\n    if (variableList) {\n      for (let i = 0; i < variableList.length; i++) {\n        const tempVar = variableList[i];\n        if (tempVar.getId() === variableId) {\n          variableList.splice(i, 1);\n          eventUtils.fire(\n            new (eventUtils.get(eventUtils.VAR_DELETE))(variable),\n          );\n          if (variableList.length === 0) {\n            this.variableMap.delete(variable.type);\n          }\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    const variable = this.getVariableById(id);\n    if (variable) {\n      // Check whether this variable is a function parameter before deleting.\n      const variableName = variable.name;\n      const uses = this.getVariableUsesById(id);\n      for (let i = 0, block; (block = uses[i]); i++) {\n        if (\n          block.type === 'procedures_defnoreturn' ||\n          block.type === 'procedures_defreturn'\n        ) {\n          const procedureName = String(block.getFieldValue('NAME'));\n          const deleteText = Msg['CANNOT_DELETE_VARIABLE_PROCEDURE']\n            .replace('%1', variableName)\n            .replace('%2', procedureName);\n          dialog.alert(deleteText);\n          return;\n        }\n      }\n\n      if (uses.length > 1) {\n        // Confirm before deleting multiple blocks.\n        const confirmText = Msg['DELETE_VARIABLE_CONFIRMATION']\n          .replace('%1', String(uses.length))\n          .replace('%2', variableName);\n        dialog.confirm(confirmText, (ok) => {\n          if (ok && variable) {\n            this.deleteVariableInternal(variable, uses);\n          }\n        });\n      } else {\n        // No confirmation necessary for a single block.\n        this.deleteVariableInternal(variable, uses);\n      }\n    } else {\n      console.warn(\"Can't delete non-existent variable: \" + id);\n    }\n  }\n\n  /**\n   * Deletes a variable and all of its uses from this workspace without asking\n   * the user for confirmation.\n   *\n   * @param variable Variable to delete.\n   * @param uses An array of uses of the variable.\n   * @internal\n   */\n  deleteVariableInternal(variable: VariableModel, uses: Block[]) {\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      for (let i = 0; i < uses.length; i++) {\n        uses[i].dispose(true);\n      }\n      this.deleteVariable(variable);\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n  /* End functions for variable deletion. */\n  /**\n   * Find the variable by the given name and type and return it.  Return null if\n   *     it is not found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name, or null if it was not found.\n   */\n  getVariable(name: string, opt_type?: string | null): VariableModel | null {\n    const type = opt_type || '';\n    const list = this.variableMap.get(type);\n    if (list) {\n      for (let j = 0, variable; (variable = list[j]); j++) {\n        if (Names.equals(variable.name, name)) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find the variable by the given ID and return it.  Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel | null {\n    for (const variables of this.variableMap.values()) {\n      for (const variable of variables) {\n        if (variable.getId() === id) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get a list containing all of the variables of a specified type. If type is\n   *     null, return list of variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string | null): VariableModel[] {\n    type = type || '';\n    const variableList = this.variableMap.get(type);\n    if (variableList) {\n      return variableList.slice();\n    }\n    return [];\n  }\n\n  /**\n   * Return all variable and potential variable types.  This list always\n   * contains the empty string.\n   *\n   * @param ws The workspace used to look for potential variables. This can be\n   *     different than the workspace stored on this object if the passed in ws\n   *     is a flyout workspace.\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(ws: Workspace | null): string[] {\n    const variableTypes = new Set<string>(this.variableMap.keys());\n    if (ws && ws.getPotentialVariableMap()) {\n      for (const key of ws.getPotentialVariableMap()!.variableMap.keys()) {\n        variableTypes.add(key);\n      }\n    }\n    if (!variableTypes.has('')) {\n      variableTypes.add('');\n    }\n    return Array.from(variableTypes.values());\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    let allVariables: VariableModel[] = [];\n    for (const variables of this.variableMap.values()) {\n      allVariables = allVariables.concat(variables);\n    }\n    return allVariables;\n  }\n\n  /**\n   * Returns all of the variable names of all types.\n   *\n   * @returns All of the variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return Array.from(this.variableMap.values())\n      .flat()\n      .map((variable) => variable.name);\n  }\n\n  /**\n   * Find all the uses of a named variable.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    const uses = [];\n    const blocks = this.workspace.getAllBlocks(false);\n    // Iterate through every block and check the name.\n    for (let i = 0; i < blocks.length; i++) {\n      const blockVariables = blocks[i].getVarModels();\n      if (blockVariables) {\n        for (let j = 0; j < blockVariables.length; j++) {\n          if (blockVariables[j].getId() === id) {\n            uses.push(blocks[i]);\n          }\n        }\n      }\n    }\n    return uses;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Workspace\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './connection_checker.js';\n\nimport type {Block} from './block.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport * as common from './common.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {Options} from './options.js';\nimport * as registry from './registry.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as math from './utils/math.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport type {VariableModel} from './variable_model.js';\nimport {WorkspaceComment} from './comments/workspace_comment.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\n\n/**\n * Class for a workspace.  This is a data structure that contains blocks.\n * There is no UI, and can be created headlessly.\n */\nexport class Workspace implements IASTNodeLocation {\n  /**\n   * Angle away from the horizontal to sweep for blocks.  Order of execution is\n   * generally top to bottom, but a small angle changes the scan to give a bit\n   * of a left to right bias (reversed in RTL).  Units are in degrees. See:\n   * https://tvtropes.org/pmwiki/pmwiki.php/Main/DiagonalBilling\n   */\n  static SCAN_ANGLE = 3;\n  id: string;\n  options: Options;\n  RTL: boolean;\n  horizontalLayout: boolean;\n  toolboxPosition: toolbox.Position;\n\n  /**\n   * Returns `true` if the workspace is visible and `false` if it's headless.\n   */\n  rendered = false;\n\n  /**\n   * Is this workspace the surface for a flyout?\n   *\n   * @internal\n   */\n  internalIsFlyout = false;\n\n  /** Is this workspace the surface for a flyout? */\n  get isFlyout(): boolean {\n    return this.internalIsFlyout;\n  }\n\n  /**\n   * Is this workspace the surface for a mutator?\n   *\n   * @internal\n   */\n  internalIsMutator = false;\n\n  /** Is this workspace the surface for a mutator? */\n  get isMutator(): boolean {\n    return this.internalIsMutator;\n  }\n\n  /**\n   * Returns `true` if the workspace is currently in the process of a bulk\n   * clear.\n   *\n   * @internal\n   */\n  isClearing = false;\n\n  /**\n   * Maximum number of undo events in stack. `0` turns off undo, `Infinity`\n   * sets it to unlimited.\n   */\n  MAX_UNDO = 1024;\n\n  /** Set of databases for rapid lookup of connection locations. */\n  connectionDBList: ConnectionDB[] = [];\n  connectionChecker: IConnectionChecker;\n\n  private readonly topBlocks: Block[] = [];\n  private readonly topComments: WorkspaceComment[] = [];\n  private readonly commentDB = new Map<string, WorkspaceComment>();\n  private readonly listeners: Function[] = [];\n  protected undoStack_: Abstract[] = [];\n  protected redoStack_: Abstract[] = [];\n  private readonly blockDB = new Map<string, Block>();\n  private readonly typedBlocksDB = new Map<string, Block[]>();\n  private variableMap: VariableMap;\n  private procedureMap: IProcedureMap = new ObservableProcedureMap();\n\n  /**\n   * Blocks in the flyout can refer to variables that don't exist in the main\n   * workspace.  For instance, the \"get item in list\" block refers to an\n   * \"item\" variable regardless of whether the variable has been created yet.\n   * A FieldVariable must always refer to a VariableModel.  We reconcile\n   * these by tracking \"potential\" variables in the flyout.  These variables\n   * become real when references to them are dragged into the main workspace.\n   */\n  private potentialVariableMap: VariableMap | null = null;\n\n  /** @param opt_options Dictionary of options. */\n  constructor(opt_options?: Options) {\n    this.id = idGenerator.genUid();\n    common.registerWorkspace(this);\n    this.options = opt_options || new Options({} as BlocklyOptions);\n    this.RTL = !!this.options.RTL;\n    this.horizontalLayout = !!this.options.horizontalLayout;\n    this.toolboxPosition = this.options.toolboxPosition;\n\n    const connectionCheckerClass = registry.getClassFromOptions(\n      registry.Type.CONNECTION_CHECKER,\n      this.options,\n      true,\n    );\n    /**\n     * An object that encapsulates logic for safety, type, and dragging checks.\n     */\n    this.connectionChecker = new connectionCheckerClass!(this);\n\n    /**\n     * A map from variable type to list of variable names.  The lists contain\n     * all of the named variables in the workspace, including variables that are\n     * not currently in use.\n     */\n    this.variableMap = new VariableMap(this);\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.listeners.length = 0;\n    this.clear();\n    // Remove from workspace database.\n    common.unregisterWorkpace(this);\n  }\n\n  /**\n   * Compare function for sorting objects (blocks, comments, etc) by position;\n   *    top to bottom (with slight LTR or RTL bias).\n   *\n   * @param a The first object to compare.\n   * @param b The second object to compare.\n   * @returns The comparison value. This tells Array.sort() how to change object\n   *     a's index.\n   */\n  private sortObjects_(\n    a: Block | WorkspaceComment,\n    b: Block | WorkspaceComment,\n  ): number {\n    const offset =\n      Math.sin(math.toRadians(Workspace.SCAN_ANGLE)) * (this.RTL ? -1 : 1);\n    const aXY = a.getRelativeToSurfaceXY();\n    const bXY = b.getRelativeToSurfaceXY();\n    return aXY.y + offset * aXY.x - (bXY.y + offset * bXY.x);\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  addTopBlock(block: Block) {\n    this.topBlocks.push(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  removeTopBlock(block: Block) {\n    if (!arrayUtils.removeElem(this.topBlocks, block)) {\n      throw Error(\"Block not present in workspace's list of top-most blocks.\");\n    }\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  getTopBlocks(ordered = false): Block[] {\n    // Copy the topBlocks list.\n    const blocks = new Array<Block>().concat(this.topBlocks);\n    if (ordered && blocks.length > 1) {\n      blocks.sort(this.sortObjects_.bind(this));\n    }\n    return blocks;\n  }\n\n  /**\n   * Add a block to the list of blocks keyed by type.\n   *\n   * @param block Block to add.\n   */\n  addTypedBlock(block: Block) {\n    if (!this.typedBlocksDB.has(block.type)) {\n      this.typedBlocksDB.set(block.type, []);\n    }\n    this.typedBlocksDB.get(block.type)!.push(block);\n  }\n\n  /**\n   * Remove a block from the list of blocks keyed by type.\n   *\n   * @param block Block to remove.\n   */\n  removeTypedBlock(block: Block) {\n    arrayUtils.removeElem(this.typedBlocksDB.get(block.type)!, block);\n    if (!this.typedBlocksDB.get(block.type)!.length) {\n      this.typedBlocksDB.delete(block.type);\n    }\n  }\n\n  /**\n   * Finds the blocks with the associated type and returns them. Blocks are\n   * optionally sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param type The type of block to search for.\n   * @param ordered Sort the list if true.\n   * @returns The blocks of the given type.\n   */\n  getBlocksByType(type: string, ordered = false): Block[] {\n    if (!this.typedBlocksDB.has(type)) {\n      return [];\n    }\n    const blocks = this.typedBlocksDB.get(type)!.slice(0);\n    if (ordered && blocks && blocks.length > 1) {\n      blocks.sort(this.sortObjects_.bind(this));\n    }\n\n    return blocks.filter(function (block: Block) {\n      return !block.isInsertionMarker();\n    });\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   * @internal\n   */\n  addTopComment(comment: WorkspaceComment) {\n    this.topComments.push(comment);\n\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    if (this.commentDB.has(comment.id)) {\n      console.warn(\n        'Overriding an existing comment on this workspace, with id \"' +\n          comment.id +\n          '\"',\n      );\n    }\n    this.commentDB.set(comment.id, comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   * @internal\n   */\n  removeTopComment(comment: WorkspaceComment) {\n    if (!arrayUtils.removeElem(this.topComments, comment)) {\n      throw Error(\n        \"Comment not present in workspace's list of top-most \" + 'comments.',\n      );\n    }\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    this.commentDB.delete(comment.id);\n  }\n\n  /**\n   * Finds the top-level comments and returns them.  Comments are optionally\n   * sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level comment objects.\n   * @internal\n   */\n  getTopComments(ordered = false): WorkspaceComment[] {\n    // Copy the topComments list.\n    const comments = new Array<WorkspaceComment>().concat(this.topComments);\n    if (ordered && comments.length > 1) {\n      comments.sort(this.sortObjects_.bind(this));\n    }\n    return comments;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getAllBlocks(ordered = false): Block[] {\n    let blocks: Block[];\n    if (ordered) {\n      // Slow, but ordered.\n      const topBlocks = this.getTopBlocks(true);\n      blocks = [];\n      for (let i = 0; i < topBlocks.length; i++) {\n        blocks.push(...topBlocks[i].getDescendants(true));\n      }\n    } else {\n      // Fast, but in no particular order.\n      blocks = this.getTopBlocks(false);\n      for (let i = 0; i < blocks.length; i++) {\n        blocks.push(...blocks[i].getChildren(false));\n      }\n    }\n\n    // Insertion markers exist on the workspace for rendering reasons, but\n    // aren't \"real\" blocks from a developer perspective.\n    const filtered = blocks.filter(function (block) {\n      return !block.isInsertionMarker();\n    });\n\n    return filtered;\n  }\n\n  /** Dispose of all blocks and comments in workspace. */\n  clear() {\n    this.isClearing = true;\n    try {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      while (this.topBlocks.length) {\n        this.topBlocks[0].dispose(false);\n      }\n      while (this.topComments.length) {\n        this.topComments[this.topComments.length - 1].dispose();\n      }\n      eventUtils.setGroup(existingGroup);\n      this.variableMap.clear();\n      if (this.potentialVariableMap) {\n        this.potentialVariableMap.clear();\n      }\n    } finally {\n      this.isClearing = false;\n    }\n  }\n\n  /* Begin functions that are just pass-throughs to the variable map. */\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    this.variableMap.renameVariableById(id, newName);\n  }\n\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    return this.variableMap.createVariable(name, opt_type, opt_id);\n  }\n\n  /**\n   * Find all the uses of the given variable, which is identified by ID.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    return this.variableMap.getVariableUsesById(id);\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    this.variableMap.deleteVariableById(id);\n  }\n\n  /**\n   * Find the variable by the given name and return it. Return null if not\n   * found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name.\n   */\n  getVariable(name: string, opt_type?: string): VariableModel | null {\n    // TODO (#1559): Possibly delete this function after resolving #1559.\n    return this.variableMap.getVariable(name, opt_type);\n  }\n\n  /**\n   * Find the variable by the given ID and return it. Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel | null {\n    return this.variableMap.getVariableById(id);\n  }\n\n  /**\n   * Find the variable with the specified type. If type is null, return list of\n   *     variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string | null): VariableModel[] {\n    return this.variableMap.getVariablesOfType(type);\n  }\n\n  /**\n   * Return all variable types.\n   *\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(): string[] {\n    return this.variableMap.getVariableTypes(this);\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    return this.variableMap.getAllVariables();\n  }\n\n  /**\n   * Returns all variable names of all types.\n   *\n   * @returns List of all variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return this.variableMap.getAllVariableNames();\n  }\n  /* End functions that are just pass-throughs to the variable map. */\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   * Not relevant for a headless workspace.\n   *\n   * @returns Width.\n   */\n  getWidth(): number {\n    return 0;\n  }\n\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  newBlock(prototypeName: string, opt_id?: string): Block {\n    throw new Error(\n      'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Obtain a newly created comment.\n   *\n   * @param id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created comment.\n   */\n  newComment(id?: string): WorkspaceComment {\n    throw new Error(\n      'The implementation of newComment should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n  /* eslint-enable */\n\n  /**\n   * The number of blocks that may be added to the workspace before reaching\n   *     the maxBlocks.\n   *\n   * @returns Number of blocks left.\n   */\n  remainingCapacity(): number {\n    if (isNaN(this.options.maxBlocks)) {\n      return Infinity;\n    }\n\n    return this.options.maxBlocks - this.getAllBlocks(false).length;\n  }\n\n  /**\n   * The number of blocks of the given type that may be added to the workspace\n   *    before reaching the maxInstances allowed for that type.\n   *\n   * @param type Type of block to return capacity for.\n   * @returns Number of blocks of type left.\n   */\n  remainingCapacityOfType(type: string): number {\n    if (!this.options.maxInstances) {\n      return Infinity;\n    }\n\n    const maxInstanceOfType =\n      this.options.maxInstances[type] !== undefined\n        ? this.options.maxInstances[type]\n        : Infinity;\n\n    return maxInstanceOfType - this.getBlocksByType(type, false).length;\n  }\n\n  /**\n   * Check if there is remaining capacity for blocks of the given counts to be\n   *    created. If the total number of blocks represented by the map is more\n   * than the total remaining capacity, it returns false. If a type count is\n   * more than the remaining capacity for that type, it returns false.\n   *\n   * @param typeCountsMap A map of types to counts (usually representing blocks\n   *     to be created).\n   * @returns True if there is capacity for the given map, false otherwise.\n   */\n  isCapacityAvailable(typeCountsMap: {[key: string]: number}): boolean {\n    if (!this.hasBlockLimits()) {\n      return true;\n    }\n    let copyableBlocksCount = 0;\n    for (const type in typeCountsMap) {\n      if (typeCountsMap[type] > this.remainingCapacityOfType(type)) {\n        return false;\n      }\n      copyableBlocksCount += typeCountsMap[type];\n    }\n    if (copyableBlocksCount > this.remainingCapacity()) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Checks if the workspace has any limits on the maximum number of blocks,\n   *    or the maximum number of blocks of specific types.\n   *\n   * @returns True if it has block limits, false otherwise.\n   */\n  hasBlockLimits(): boolean {\n    return this.options.maxBlocks !== Infinity || !!this.options.maxInstances;\n  }\n\n  /**\n   * Gets the undo stack for workplace.\n   *\n   * @returns undo stack\n   * @internal\n   */\n  getUndoStack(): Abstract[] {\n    return this.undoStack_;\n  }\n\n  /**\n   * Gets the redo stack for workplace.\n   *\n   * @returns redo stack\n   * @internal\n   */\n  getRedoStack(): Abstract[] {\n    return this.redoStack_;\n  }\n\n  /**\n   * Undo or redo the previous action.\n   *\n   * @param redo False if undo, true if redo.\n   */\n  undo(redo: boolean) {\n    const inputStack = redo ? this.redoStack_ : this.undoStack_;\n    const outputStack = redo ? this.undoStack_ : this.redoStack_;\n    const inputEvent = inputStack.pop();\n    if (!inputEvent) {\n      return;\n    }\n    let events = [inputEvent];\n    // Do another undo/redo if the next one is of the same group.\n    while (\n      inputStack.length &&\n      inputEvent.group &&\n      inputEvent.group === inputStack[inputStack.length - 1].group\n    ) {\n      const event = inputStack.pop();\n      if (!event) continue;\n      events.push(event);\n    }\n    // Push these popped events on the opposite stack.\n    for (let i = 0; i < events.length; i++) {\n      const event = events[i];\n      outputStack.push(event);\n    }\n    events = eventUtils.filter(events, redo);\n    eventUtils.setRecordUndo(false);\n    try {\n      for (let i = 0; i < events.length; i++) {\n        const event = events[i];\n        event.run(redo);\n      }\n    } finally {\n      eventUtils.setRecordUndo(true);\n    }\n  }\n\n  /** Clear the undo/redo stacks. */\n  clearUndo() {\n    this.undoStack_.length = 0;\n    this.redoStack_.length = 0;\n    // Stop any events already in the firing queue from being undoable.\n    eventUtils.clearPendingUndo();\n  }\n\n  /**\n   * When something in this workspace changes, call a function.\n   * Note that there may be a few recent events already on the stack.  Thus the\n   * new change listener might be called with events that occurred a few\n   * milliseconds before the change listener was added.\n   *\n   * @param func Function to call.\n   * @returns Obsolete return value, ignore.\n   */\n  addChangeListener(func: (e: Abstract) => void): Function {\n    this.listeners.push(func);\n    return func;\n  }\n\n  /**\n   * Stop listening for this workspace's changes.\n   *\n   * @param func Function to stop calling.\n   */\n  removeChangeListener(func: Function) {\n    arrayUtils.removeElem(this.listeners, func);\n  }\n\n  /**\n   * Fire a change event.\n   *\n   * @param event Event to fire.\n   */\n  fireChangeListener(event: Abstract) {\n    if (event.recordUndo) {\n      this.undoStack_.push(event);\n      this.redoStack_.length = 0;\n      while (this.undoStack_.length > this.MAX_UNDO && this.MAX_UNDO >= 0) {\n        this.undoStack_.shift();\n      }\n    }\n    for (let i = 0; i < this.listeners.length; i++) {\n      const func = this.listeners[i];\n      func(event);\n    }\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  getBlockById(id: string): Block | null {\n    return this.blockDB.get(id) || null;\n  }\n\n  /**\n   * Set a block on this workspace with the specified ID.\n   *\n   * @param id ID of block to set.\n   * @param block The block to set.\n   * @internal\n   */\n  setBlockById(id: string, block: Block) {\n    this.blockDB.set(id, block);\n  }\n\n  /**\n   * Delete a block off this workspace with the specified ID.\n   *\n   * @param id ID of block to delete.\n   * @internal\n   */\n  removeBlockById(id: string) {\n    this.blockDB.delete(id);\n  }\n\n  /**\n   * Find the comment on this workspace with the specified ID.\n   *\n   * @param id ID of comment to find.\n   * @returns The sought after comment, or null if not found.\n   * @internal\n   */\n  getCommentById(id: string): WorkspaceComment | null {\n    return this.commentDB.get(id) ?? null;\n  }\n\n  /**\n   * Checks whether all value and statement inputs in the workspace are filled\n   * with blocks.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    const blocks = this.getTopBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      const block = blocks[i];\n      if (!block.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Return the variable map that contains \"potential\" variables.\n   * These exist in the flyout but not in the workspace.\n   *\n   * @returns The potential variable map.\n   * @internal\n   */\n  getPotentialVariableMap(): VariableMap | null {\n    return this.potentialVariableMap;\n  }\n\n  /**\n   * Create and store the potential variable map for this workspace.\n   *\n   * @internal\n   */\n  createPotentialVariableMap() {\n    this.potentialVariableMap = new VariableMap(this);\n  }\n\n  /**\n   * Return the map of all variables on the workspace.\n   *\n   * @returns The variable map.\n   */\n  getVariableMap(): VariableMap {\n    return this.variableMap;\n  }\n\n  /**\n   * Set the map of all variables on the workspace.\n   *\n   * @param variableMap The variable map.\n   * @internal\n   */\n  setVariableMap(variableMap: VariableMap) {\n    this.variableMap = variableMap;\n  }\n\n  /** Returns the map of all procedures on the workpace. */\n  getProcedureMap(): IProcedureMap {\n    return this.procedureMap;\n  }\n\n  /**\n   * Returns the root workspace of this workspace if the workspace has\n   * parent(s).\n   *\n   * E.g. workspaces in flyouts and mini workspace bubbles have parent\n   * workspaces.\n   */\n  getRootWorkspace(): Workspace | null {\n    let outerWs = null;\n    const parent = this.options.parentWorkspace;\n    // If we were in a flyout in a mutator, need to go up two levels to find\n    // the actual parent.\n    if (this.isFlyout) {\n      if (parent && parent.options) {\n        outerWs = parent.options.parentWorkspace;\n      }\n    } else if (parent) {\n      outerWs = parent;\n    }\n    return outerWs;\n  }\n\n  /**\n   * Find the workspace with the specified ID.\n   *\n   * @param id ID of workspace to find.\n   * @returns The sought after workspace or null if not found.\n   */\n  static getById(id: string): Workspace | null {\n    return common.getWorkspaceById(id);\n  }\n\n  /**\n   * Find all workspaces.\n   *\n   * @returns Array of workspaces.\n   */\n  static getAll(): Workspace[] {\n    return common.getAllWorkspaces();\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of loading, storing, and playing audio for a\n *     workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceAudio\n\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Prevent a sound from playing if another sound preceded it within this many\n * milliseconds.\n */\nconst SOUND_LIMIT = 100;\n\n/**\n * Class for loading, storing, and playing audio for a workspace.\n */\nexport class WorkspaceAudio {\n  /** Database of pre-loaded sounds. */\n  private sounds = new Map<string, HTMLAudioElement>();\n\n  /** Time that the last sound was played. */\n  private lastSound_: Date | null = null;\n\n  /** Whether the audio is muted or not. */\n  private muted: boolean = false;\n\n  /**\n   * @param parentWorkspace The parent of the workspace this audio object\n   *     belongs to, or null.\n   */\n  constructor(private parentWorkspace: WorkspaceSvg) {}\n\n  /**\n   * Dispose of this audio manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.sounds.clear();\n  }\n\n  /**\n   * Load an audio file.  Cache it, ready for instantaneous playing.\n   *\n   * @param filenames List of file types in decreasing order of preference (i.e.\n   *     increasing size).  E.g. ['media/go.mp3', 'media/go.wav'] Filenames\n   *     include path from Blockly's root.  File extensions matter.\n   * @param name Name of sound.\n   */\n  load(filenames: string[], name: string) {\n    if (!filenames.length) {\n      return;\n    }\n    let audioTest;\n    try {\n      audioTest = new globalThis['Audio']();\n    } catch (e) {\n      // No browser support for Audio.\n      // IE can throw an error even if the Audio object exists.\n      return;\n    }\n    let sound;\n    for (let i = 0; i < filenames.length; i++) {\n      const filename = filenames[i];\n      const ext = filename.match(/\\.(\\w+)$/);\n      if (ext && audioTest.canPlayType('audio/' + ext[1])) {\n        // Found an audio format we can play.\n        sound = new globalThis['Audio'](filename);\n        break;\n      }\n    }\n    if (sound) {\n      this.sounds.set(name, sound);\n    }\n  }\n\n  /**\n   * Preload all the audio files so that they play quickly when asked for.\n   *\n   * @internal\n   */\n  preload() {\n    for (const sound of this.sounds.values()) {\n      sound.volume = 0.01;\n      const playPromise = sound.play();\n      // Edge does not return a promise, so we need to check.\n      if (playPromise !== undefined) {\n        // If we don't wait for the play request to complete before calling\n        // pause() we will get an exception: (DOMException: The play() request\n        // was interrupted) See more:\n        // https://developers.google.com/web/updates/2017/06/play-request-was-interrupted\n        playPromise.then(sound.pause).catch(\n          // Play without user interaction was prevented.\n          function () {},\n        );\n      } else {\n        sound.pause();\n      }\n\n      // iOS can only process one sound at a time.  Trying to load more than one\n      // corrupts the earlier ones.  Just load one and leave the others\n      // uncached.\n      if (userAgent.IPAD || userAgent.IPHONE) {\n        break;\n      }\n    }\n  }\n\n  /**\n   * Play a named sound at specified volume.  If volume is not specified,\n   * use full volume (1).\n   *\n   * @param name Name of sound.\n   * @param opt_volume Volume of sound (0-1).\n   */\n  play(name: string, opt_volume?: number) {\n    if (this.muted) {\n      return;\n    }\n    const sound = this.sounds.get(name);\n    if (sound) {\n      // Don't play one sound on top of another.\n      const now = new Date();\n      if (\n        this.lastSound_ !== null &&\n        now.getTime() - this.lastSound_.getTime() < SOUND_LIMIT\n      ) {\n        return;\n      }\n      this.lastSound_ = now;\n      let mySound;\n      if (userAgent.IPAD || userAgent.ANDROID) {\n        // Creating a new audio node causes lag in Android and iPad.  Android\n        // refetches the file from the server, iPad uses a singleton audio\n        // node which must be deleted and recreated for each new audio tag.\n        mySound = sound;\n      } else {\n        mySound = sound.cloneNode() as HTMLAudioElement;\n      }\n      mySound.volume = opt_volume === undefined ? 1 : opt_volume;\n      mySound.play();\n    } else if (this.parentWorkspace) {\n      // Maybe a workspace on a lower level knows about this sound.\n      this.parentWorkspace.getAudioManager().play(name, opt_volume);\n    }\n  }\n\n  /**\n   * @param muted If true, mute sounds. Otherwise, play them.\n   */\n  setMuted(muted: boolean) {\n    this.muted = muted;\n  }\n\n  /**\n   * @returns Whether the audio is currently muted or not.\n   */\n  getMuted(): boolean {\n    return this.muted;\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport {IRenderedElement} from './interfaces/i_rendered_element.js';\nimport * as layerNums from './layers.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n/** @internal */\nexport class LayerManager {\n  /** The layer elements being dragged are appended to. */\n  private dragLayer: SVGGElement | undefined;\n  /** The layer elements being animated are appended to. */\n  private animationLayer: SVGGElement | undefined;\n  /** The layers elements not being dragged are appended to.  */\n  private layers = new Map<number, SVGGElement>();\n\n  /** @internal */\n  constructor(private workspace: WorkspaceSvg) {\n    const injectionDiv = workspace.getInjectionDiv();\n    // `getInjectionDiv` is actually nullable. We hit this if the workspace\n    // is part of a flyout and the workspace the flyout is attached to hasn't\n    // been appended yet.\n    if (injectionDiv) {\n      this.dragLayer = this.createDragLayer(injectionDiv);\n      this.animationLayer = this.createAnimationLayer(injectionDiv);\n    }\n\n    // We construct these manually so we can add the css class for backwards\n    // compatibility.\n    const blockLayer = this.createLayer(layerNums.BLOCK);\n    dom.addClass(blockLayer, 'blocklyBlockCanvas');\n    const bubbleLayer = this.createLayer(layerNums.BUBBLE);\n    dom.addClass(bubbleLayer, 'blocklyBubbleCanvas');\n  }\n\n  private createDragLayer(injectionDiv: Element) {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'class': 'blocklyBlockDragSurface',\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n    });\n    injectionDiv.append(svg);\n    return dom.createSvgElement(Svg.G, {}, svg);\n  }\n\n  private createAnimationLayer(injectionDiv: Element) {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'class': 'blocklyAnimationLayer',\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n    });\n    injectionDiv.append(svg);\n    return dom.createSvgElement(Svg.G, {}, svg);\n  }\n\n  /**\n   * Appends the element to the animation layer. The animation layer doesn't\n   * move when the workspace moves, so e.g. delete animations don't move\n   * when a block delete triggers a workspace resize.\n   *\n   * @internal\n   */\n  appendToAnimationLayer(elem: IRenderedElement) {\n    const currentTransform = this.dragLayer?.getAttribute('transform');\n    // Only update the current transform when appending, so animations don't\n    // move if the workspace moves.\n    if (currentTransform) {\n      this.animationLayer?.setAttribute('transform', currentTransform);\n    }\n    this.animationLayer?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Translates layers when the workspace is dragged or zoomed.\n   *\n   * @internal\n   */\n  translateLayers(newCoord: Coordinate, newScale: number) {\n    const translation = `translate(${newCoord.x}, ${newCoord.y}) scale(${newScale})`;\n    this.dragLayer?.setAttribute('transform', translation);\n    for (const [_, layer] of this.layers) {\n      layer.setAttribute('transform', translation);\n    }\n  }\n\n  /**\n   * Moves the given element to the drag layer, which exists on top of all other\n   * layers, and the drag surface.\n   *\n   * @internal\n   */\n  moveToDragLayer(elem: IRenderedElement) {\n    this.dragLayer?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Moves the given element off of the drag layer.\n   *\n   * @internal\n   */\n  moveOffDragLayer(elem: IRenderedElement, layerNum: number) {\n    this.append(elem, layerNum);\n  }\n\n  /**\n   * Appends the given element to a layer. If the layer does not exist, it is\n   * created.\n   *\n   * @internal\n   */\n  append(elem: IRenderedElement, layerNum: number) {\n    if (!this.layers.has(layerNum)) {\n      this.createLayer(layerNum);\n    }\n    this.layers.get(layerNum)?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Creates a layer and inserts it at the proper place given the layer number.\n   *\n   * More positive layers exist later in the dom and are rendered ontop of\n   * less positive layers. Layers are added to the layer map as a side effect.\n   */\n  private createLayer(layerNum: number): SVGGElement {\n    const parent = this.workspace.getSvgGroup();\n    const layer = dom.createSvgElement(Svg.G, {});\n\n    let inserted = false;\n    const sortedLayers = [...this.layers].sort((a, b) => a[0] - b[0]);\n    for (const [num, sib] of sortedLayers) {\n      if (layerNum < num) {\n        parent.insertBefore(layer, sib);\n        inserted = true;\n        break;\n      }\n    }\n    if (!inserted) {\n      parent.appendChild(layer);\n    }\n    this.layers.set(layerNum, layer);\n    return layer;\n  }\n\n  /**\n   * Returns true if the given element is a layer managed by the layer manager.\n   * False otherwise.\n   *\n   * @internal\n   */\n  hasLayer(elem: SVGElement) {\n    return (\n      elem === this.dragLayer ||\n      new Set(this.layers.values()).has(elem as SVGGElement)\n    );\n  }\n\n  /**\n   * We need to be able to access this layer explicitly for backwards\n   * compatibility.\n   *\n   * @internal\n   */\n  getBlockLayer(): SVGGElement {\n    return this.layers.get(layerNums.BLOCK)!;\n  }\n\n  /**\n   * We need to be able to access this layer explicitly for backwards\n   * compatibility.\n   *\n   * @internal\n   */\n  getBubbleLayer(): SVGGElement {\n    return this.layers.get(layerNums.BUBBLE)!;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of trashcan flyout open and close.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.TrashcanOpen\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when the trashcan is opening or closing.\n */\nexport class TrashcanOpen extends UiBase {\n  /**\n   * True if the trashcan is currently opening (previously closed).\n   * False if it is currently closing (previously open).\n   */\n  isOpen?: boolean;\n  override type = eventUtils.TRASHCAN_OPEN;\n\n  /**\n   * @param opt_isOpen Whether the trashcan flyout is opening (false if\n   *     opening). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_isOpen?: boolean, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.isOpen = opt_isOpen;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): TrashcanOpenJson {\n    const json = super.toJson() as TrashcanOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n        'Whether this is already open or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson',\n      );\n    }\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of TrashcanOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: TrashcanOpenJson,\n    workspace: Workspace,\n    event?: any,\n  ): TrashcanOpen {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new TrashcanOpen(),\n    ) as TrashcanOpen;\n    newEvent.isOpen = json['isOpen'];\n    return newEvent;\n  }\n}\n\nexport interface TrashcanOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.TRASHCAN_OPEN, TrashcanOpen);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of element select action.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Selected\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Class for a selected event.\n * Notifies listeners that a new element has been selected.\n */\nexport class Selected extends UiBase {\n  /** The id of the last selected selectable element. */\n  oldElementId?: string;\n\n  /**\n   * The id of the newly selected selectable element,\n   * or undefined if unselected.\n   */\n  newElementId?: string;\n\n  override type = eventUtils.SELECTED;\n\n  /**\n   * @param opt_oldElementId The ID of the previously selected element. Null if\n   *     no element last selected. Undefined for a blank event.\n   * @param opt_newElementId The ID of the selected element. Null if no element\n   *     currently selected (deselect). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Null if no element previously selected. Undefined for a blank event.\n   */\n  constructor(\n    opt_oldElementId?: string | null,\n    opt_newElementId?: string | null,\n    opt_workspaceId?: string,\n  ) {\n    super(opt_workspaceId);\n\n    this.oldElementId = opt_oldElementId ?? undefined;\n    this.newElementId = opt_newElementId ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): SelectedJson {\n    const json = super.toJson() as SelectedJson;\n    json['oldElementId'] = this.oldElementId;\n    json['newElementId'] = this.newElementId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Selected, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: SelectedJson,\n    workspace: Workspace,\n    event?: any,\n  ): Selected {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new Selected(),\n    ) as Selected;\n    newEvent.oldElementId = json['oldElementId'];\n    newEvent.newElementId = json['newElementId'];\n    return newEvent;\n  }\n}\n\nexport interface SelectedJson extends AbstractEventJson {\n  oldElementId?: string;\n  newElementId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.SELECTED, Selected);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a marker.\n * Used primarily for keyboard navigation to show a marked location.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Marker\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {MarkerSvg} from '../renderers/common/marker_svg.js';\n\nimport type {ASTNode} from './ast_node.js';\n\n/**\n * Class for a marker.\n * This is used in keyboard navigation to save a location in the Blockly AST.\n */\nexport class Marker {\n  /** The colour of the marker. */\n  colour: string | null = null;\n\n  /** The current location of the marker. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'ASTNode'.\n  private curNode: ASTNode = null as AnyDuringMigration;\n\n  /**\n   * The object in charge of drawing the visual representation of the current\n   * node.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'MarkerSvg'.\n  private drawer: MarkerSvg = null as AnyDuringMigration;\n\n  /** The type of the marker. */\n  type = 'marker';\n\n  /** Constructs a new Marker instance. */\n  constructor() {}\n\n  /**\n   * Sets the object in charge of drawing the marker.\n   *\n   * @param drawer The object in charge of drawing the marker.\n   */\n  setDrawer(drawer: MarkerSvg) {\n    this.drawer = drawer;\n  }\n\n  /**\n   * Get the current drawer for the marker.\n   *\n   * @returns The object in charge of drawing the marker.\n   */\n  getDrawer(): MarkerSvg {\n    return this.drawer;\n  }\n\n  /**\n   * Gets the current location of the marker.\n   *\n   * @returns The current field, connection, or block the marker is on.\n   */\n  getCurNode(): ASTNode {\n    return this.curNode;\n  }\n\n  /**\n   * Set the location of the marker and call the update method.\n   * Setting isStack to true will only work if the newLocation is the top most\n   * output or previous connection on a stack.\n   *\n   * @param newNode The new location of the marker.\n   */\n  setCurNode(newNode: ASTNode) {\n    const oldNode = this.curNode;\n    this.curNode = newNode;\n    if (this.drawer) {\n      this.drawer.draw(oldNode, this.curNode);\n    }\n  }\n\n  /**\n   * Redraw the current marker.\n   *\n   * @internal\n   */\n  draw() {\n    if (this.drawer) {\n      this.drawer.draw(this.curNode, this.curNode);\n    }\n  }\n\n  /** Hide the marker SVG. */\n  hide() {\n    if (this.drawer) {\n      this.drawer.hide();\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.getDrawer()) {\n      this.getDrawer().dispose();\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor.\n * Used primarily for keyboard navigation.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Cursor\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Marker} from './marker.js';\n\n/**\n * Class for a cursor.\n * A cursor controls how a user navigates the Blockly AST.\n */\nexport class Cursor extends Marker {\n  override type = 'cursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next connection, field, or block.\n   *\n   * @returns The next element, or null if the current node is not set or there\n   *     is no next value.\n   */\n  next(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n\n    let newNode = curNode.next();\n    while (\n      newNode &&\n      newNode.next() &&\n      (newNode.getType() === ASTNode.types.NEXT ||\n        newNode.getType() === ASTNode.types.BLOCK)\n    ) {\n      newNode = newNode.next();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the in connection or field.\n   *\n   * @returns The in element, or null if the current node is not set or there is\n   *     no in value.\n   */\n  in(): ASTNode | null {\n    let curNode: ASTNode | null = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    // If we are on a previous or output connection, go to the block level\n    // before performing next operation.\n    if (\n      curNode.getType() === ASTNode.types.PREVIOUS ||\n      curNode.getType() === ASTNode.types.OUTPUT\n    ) {\n      curNode = curNode.next();\n    }\n    const newNode = curNode?.in() ?? null;\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the previous connection, field, or block.\n   *\n   * @returns The previous element, or null if the current node is not set or\n   *     there is no previous value.\n   */\n  prev(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.prev();\n\n    while (\n      newNode &&\n      newNode.prev() &&\n      (newNode.getType() === ASTNode.types.NEXT ||\n        newNode.getType() === ASTNode.types.BLOCK)\n    ) {\n      newNode = newNode.prev();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the out connection, field, or block.\n   *\n   * @returns The out element, or null if the current node is not set or there\n   *     is no out value.\n   */\n  out(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.out();\n\n    if (newNode && newNode.getType() === ASTNode.types.BLOCK) {\n      newNode = newNode.prev() || newNode;\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n}\n\nregistry.register(registry.Type.CURSOR, registry.DEFAULT, Cursor);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a basic cursor.\n * Used to demo switching between different cursors.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BasicCursor\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Cursor} from './cursor.js';\n\n/**\n * Class for a basic cursor.\n * This will allow the user to get to all nodes in the AST by hitting next or\n * previous.\n */\nexport class BasicCursor extends Cursor {\n  /** Name used for registering a basic cursor. */\n  static readonly registrationName = 'basicCursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next node in the pre order traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override next(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getNextNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * in will also allow the user to get to the next node in the pre order\n   * traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override in(): ASTNode | null {\n    return this.next();\n  }\n\n  /**\n   * Find the previous node in the pre order traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override prev(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getPreviousNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * out will allow the user to get to the previous node in the pre order\n   * traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override out(): ASTNode | null {\n    return this.prev();\n  }\n\n  /**\n   * Uses pre order traversal to navigate the Blockly AST. This will allow\n   * a user to easily navigate the entire Blockly AST without having to go in\n   * and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The next node in the traversal.\n   */\n  protected getNextNode_(\n    node: ASTNode | null,\n    isValid: (p1: ASTNode | null) => boolean,\n  ): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    const newNode = node.in() || node.next();\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getNextNode_(newNode, isValid);\n    }\n    const siblingOrParent = this.findSiblingOrParent(node.out());\n    if (isValid(siblingOrParent)) {\n      return siblingOrParent;\n    } else if (siblingOrParent) {\n      return this.getNextNode_(siblingOrParent, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Reverses the pre order traversal in order to find the previous node. This\n   * will allow a user to easily navigate the entire Blockly AST without having\n   * to go in and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The previous node in the traversal or null if no previous node\n   *     exists.\n   */\n  protected getPreviousNode_(\n    node: ASTNode | null,\n    isValid: (p1: ASTNode | null) => boolean,\n  ): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    let newNode: ASTNode | null = node.prev();\n\n    if (newNode) {\n      newNode = this.getRightMostChild(newNode);\n    } else {\n      newNode = node.out();\n    }\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getPreviousNode_(newNode, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Decides what nodes to traverse and which ones to skip. Currently, it\n   * skips output, stack and workspace nodes.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  protected validNode_(node: ASTNode | null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (\n      type === ASTNode.types.OUTPUT ||\n      type === ASTNode.types.INPUT ||\n      type === ASTNode.types.FIELD ||\n      type === ASTNode.types.NEXT ||\n      type === ASTNode.types.PREVIOUS ||\n      type === ASTNode.types.WORKSPACE\n    ) {\n      isValid = true;\n    }\n    return isValid;\n  }\n\n  /**\n   * From the given node find either the next valid sibling or parent.\n   *\n   * @param node The current position in the AST.\n   * @returns The parent AST node or null if there are no valid parents.\n   */\n  private findSiblingOrParent(node: ASTNode | null): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    const nextNode = node.next();\n    if (nextNode) {\n      return nextNode;\n    }\n    return this.findSiblingOrParent(node.out());\n  }\n\n  /**\n   * Get the right most child of a node.\n   *\n   * @param node The node to find the right most child of.\n   * @returns The right most child of the given node, or the node if no child\n   *     exists.\n   */\n  private getRightMostChild(node: ASTNode | null): ASTNode | null {\n    if (!node!.in()) {\n      return node;\n    }\n    let newNode = node!.in();\n    while (newNode && newNode.next()) {\n      newNode = newNode.next();\n    }\n    return this.getRightMostChild(newNode);\n  }\n}\n\nregistry.register(\n  registry.Type.CURSOR,\n  BasicCursor.registrationName,\n  BasicCursor,\n);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor that is used to navigate\n * between tab navigable fields.\n *\n * @class\n */\n// Former goog.module ID: Blockly.TabNavigateCursor\n\nimport type {Field} from '../field.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {BasicCursor} from './basic_cursor.js';\n\n/**\n * A cursor for navigating between tab navigable fields.\n */\nexport class TabNavigateCursor extends BasicCursor {\n  /**\n   * Skip all nodes except for tab navigable fields.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  override validNode_(node: ASTNode | null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (node) {\n      const location = node.getLocation() as Field;\n      if (\n        type === ASTNode.types.FIELD &&\n        location &&\n        location.isTabNavigable() &&\n        location.isClickable()\n      ) {\n        isValid = true;\n      }\n    }\n    return isValid;\n  }\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.RenderedConnection\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as eventUtils from './events/utils.js';\nimport {hasBubble} from './interfaces/i_has_bubble.js';\nimport * as internalConstants from './internal_constants.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n/** Maximum randomness in workspace units for bumping a block. */\nconst BUMP_RANDOMNESS = 10;\n\n/**\n * Class for a connection between blocks that may be rendered on screen.\n */\nexport class RenderedConnection extends Connection {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  sourceBlock_!: BlockSvg;\n  private readonly db: ConnectionDB;\n  private readonly dbOpposite: ConnectionDB;\n  private readonly offsetInBlock: Coordinate;\n  private trackedState: TrackedState;\n  private highlighted: boolean = false;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  override targetConnection: RenderedConnection | null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: BlockSvg, type: number) {\n    super(source, type);\n\n    /**\n     * Connection database for connections of this type on the current\n     * workspace.\n     */\n    this.db = source.workspace.connectionDBList[type];\n\n    /**\n     * Connection database for connections compatible with this type on the\n     * current workspace.\n     */\n    this.dbOpposite =\n      source.workspace.connectionDBList[internalConstants.OPPOSITE_TYPE[type]];\n\n    /** Workspace units, (0, 0) is top left of block. */\n    this.offsetInBlock = new Coordinate(0, 0);\n\n    /** Describes the state of this connection's tracked-ness. */\n    this.trackedState = RenderedConnection.TrackedState.WILL_TRACK;\n  }\n\n  /**\n   * Dispose of this connection. Remove it from the database (if it is\n   * tracked) and call the super-function to deal with connected blocks.\n   *\n   * @internal\n   */\n  override dispose() {\n    super.dispose();\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\n      this.db.removeConnection(this, this.y);\n    }\n    this.sourceBlock_.pathObject.removeConnectionHighlight?.(this);\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  override getSourceBlock(): BlockSvg {\n    return super.getSourceBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  override targetBlock(): BlockSvg | null {\n    return super.targetBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the distance between this connection and another connection in\n   * workspace units.\n   *\n   * @param otherConnection The other connection to measure the distance to.\n   * @returns The distance between connections, in workspace units.\n   */\n  distanceFrom(otherConnection: Connection): number {\n    const xDiff = this.x - otherConnection.x;\n    const yDiff = this.y - otherConnection.y;\n    return Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n  }\n\n  /**\n   * Move the block(s) belonging to the connection to a point where they don't\n   * visually interfere with the specified connection.\n   *\n   * @param staticConnection The connection to move away from.\n   * @internal\n   */\n  bumpAwayFrom(staticConnection: RenderedConnection) {\n    if (this.sourceBlock_.workspace.isDragging()) {\n      // Don't move blocks around while the user is doing the same.\n      return;\n    }\n    // Move the root block.\n    let rootBlock = this.sourceBlock_.getRootBlock();\n    if (rootBlock.isInFlyout) {\n      // Don't move blocks around in a flyout.\n      return;\n    }\n    let reverse = false;\n    if (!rootBlock.isMovable()) {\n      // Can't bump an uneditable block away.\n      // Check to see if the other block is movable.\n      rootBlock = staticConnection.getSourceBlock().getRootBlock();\n      if (!rootBlock.isMovable()) {\n        return;\n      }\n      // Swap the connections and move the 'static' connection instead.\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      staticConnection = this;\n      reverse = true;\n    }\n    // Raise it to the top for extra visibility.\n    const selected = common.getSelected() == rootBlock;\n    selected || rootBlock.addSelect();\n    let dx =\n      staticConnection.x +\n      config.snapRadius +\n      Math.floor(Math.random() * BUMP_RANDOMNESS) -\n      this.x;\n    let dy =\n      staticConnection.y +\n      config.snapRadius +\n      Math.floor(Math.random() * BUMP_RANDOMNESS) -\n      this.y;\n    if (reverse) {\n      // When reversing a bump due to an uneditable block, bump up.\n      dy = -dy;\n    }\n    if (rootBlock.RTL) {\n      dx =\n        staticConnection.x -\n        config.snapRadius -\n        Math.floor(Math.random() * BUMP_RANDOMNESS) -\n        this.x;\n    }\n    rootBlock.moveBy(dx, dy, ['bump']);\n    selected || rootBlock.removeSelect();\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param x New absolute x coordinate, in workspace coordinates.\n   * @param y New absolute y coordinate, in workspace coordinates.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveTo(x: number, y: number): boolean {\n    // TODO(#6922): Readd this optimization.\n    // const moved = this.x !== x || this.y !== y;\n    const moved = true;\n    let updated = false;\n\n    if (this.trackedState === RenderedConnection.TrackedState.WILL_TRACK) {\n      this.db.addConnection(this, y);\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\n      updated = true;\n    } else if (\n      this.trackedState === RenderedConnection.TrackedState.TRACKED &&\n      moved\n    ) {\n      this.db.removeConnection(this, this.y);\n      this.db.addConnection(this, y);\n      updated = true;\n    }\n\n    this.x = x;\n    this.y = y;\n\n    return updated;\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param dx Change to x coordinate, in workspace units.\n   * @param dy Change to y coordinate, in workspace units.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveBy(dx: number, dy: number): boolean {\n    return this.moveTo(this.x + dx, this.y + dy);\n  }\n\n  /**\n   * Move this connection to the location given by its offset within the block\n   * and the location of the block's top left corner.\n   *\n   * @param blockTL The location of the top left corner of the block, in\n   *     workspace coordinates.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveToOffset(blockTL: Coordinate): boolean {\n    return this.moveTo(\n      blockTL.x + this.offsetInBlock.x,\n      blockTL.y + this.offsetInBlock.y,\n    );\n  }\n\n  /**\n   * Set the offset of this connection relative to the top left of its block.\n   *\n   * @param x The new relative x, in workspace units.\n   * @param y The new relative y, in workspace units.\n   */\n  setOffsetInBlock(x: number, y: number) {\n    this.offsetInBlock.x = x;\n    this.offsetInBlock.y = y;\n  }\n\n  /**\n   * Get the offset of this connection relative to the top left of its block.\n   *\n   * @returns The offset of the connection.\n   */\n  getOffsetInBlock(): Coordinate {\n    return this.offsetInBlock;\n  }\n\n  /**\n   * Moves the blocks on either side of this connection right next to\n   * each other, based on their local offsets, not global positions.\n   *\n   * @internal\n   */\n  tightenEfficiently() {\n    const target = this.targetConnection;\n    const block = this.targetBlock();\n    if (!target || !block) return;\n    const offset = Coordinate.difference(\n      this.offsetInBlock,\n      target.offsetInBlock,\n    );\n    block.translate(offset.x, offset.y);\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   * All parameters are in workspace units.\n   *\n   * @param maxLimit The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  closest(\n    maxLimit: number,\n    dxy: Coordinate,\n  ): {connection: RenderedConnection | null; radius: number} {\n    return this.dbOpposite.searchForClosest(this, maxLimit, dxy);\n  }\n\n  /** Add highlighting around this connection. */\n  highlight() {\n    this.highlighted = true;\n    this.getSourceBlock().queueRender();\n  }\n\n  /** Remove the highlighting around this connection. */\n  unhighlight() {\n    this.highlighted = false;\n    this.getSourceBlock().queueRender();\n  }\n\n  /** Returns true if this connection is highlighted, false otherwise. */\n  isHighlighted(): boolean {\n    return this.highlighted;\n  }\n\n  /**\n   * Set whether this connections is tracked in the database or not.\n   *\n   * @param doTracking If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setTracking(doTracking: boolean) {\n    if (\n      (doTracking &&\n        this.trackedState === RenderedConnection.TrackedState.TRACKED) ||\n      (!doTracking &&\n        this.trackedState === RenderedConnection.TrackedState.UNTRACKED)\n    ) {\n      return;\n    }\n    if (this.sourceBlock_.isInFlyout) {\n      // Don't bother maintaining a database of connections in a flyout.\n      return;\n    }\n    if (doTracking) {\n      this.db.addConnection(this, this.y);\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\n      return;\n    }\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\n      this.db.removeConnection(this, this.y);\n    }\n    this.trackedState = RenderedConnection.TrackedState.UNTRACKED;\n  }\n\n  /**\n   * Stop tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * collapsed.\n   *\n   * Also closes down-stream icons/bubbles.\n   *\n   * @internal\n   */\n  stopTrackingAll() {\n    this.setTracking(false);\n    if (this.targetConnection) {\n      const blocks = this.targetBlock()!.getDescendants(false);\n      for (let i = 0; i < blocks.length; i++) {\n        const block = blocks[i];\n        // Stop tracking connections of all children.\n        const connections = block.getConnections_(true);\n        for (let j = 0; j < connections.length; j++) {\n          connections[j].setTracking(false);\n        }\n        // Close all bubbles of all children.\n        for (const icon of block.getIcons()) {\n          if (hasBubble(icon)) icon.setBubbleVisible(false);\n        }\n      }\n    }\n  }\n\n  /**\n   * Start tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * expanded.\n   *\n   * @returns List of blocks to render.\n   */\n  startTrackingAll(): Block[] {\n    this.setTracking(true);\n    // All blocks that are not tracked must start tracking before any\n    // rendering takes place, since rendering requires knowing the dimensions\n    // of lower blocks. Also, since rendering a block renders all its parents,\n    // we only need to render the leaf nodes.\n    let renderList: Block[] = [];\n    if (\n      this.type !== ConnectionType.INPUT_VALUE &&\n      this.type !== ConnectionType.NEXT_STATEMENT\n    ) {\n      // Only spider down.\n      return renderList;\n    }\n    const block = this.targetBlock();\n    if (block) {\n      let connections;\n      if (block.isCollapsed()) {\n        // This block should only be partially revealed since it is collapsed.\n        connections = [];\n        block.outputConnection && connections.push(block.outputConnection);\n        block.nextConnection && connections.push(block.nextConnection);\n        block.previousConnection && connections.push(block.previousConnection);\n      } else {\n        // Show all connections of this block.\n        connections = block.getConnections_(true);\n      }\n      for (let i = 0; i < connections.length; i++) {\n        renderList.push(...connections[i].startTrackingAll());\n      }\n      if (!renderList.length) {\n        // Leaf block.\n        renderList = [block];\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Behaviour after a connection attempt fails.\n   * Bumps this connection away from the other connection. Called when an\n   * attempted connection fails.\n   *\n   * @param otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  override onFailedConnect(otherConnection: Connection) {\n    const block = this.getSourceBlock();\n    if (eventUtils.getRecordUndo()) {\n      const group = eventUtils.getGroup();\n      setTimeout(\n        function (this: RenderedConnection) {\n          if (!block.isDisposed() && !block.getParent()) {\n            eventUtils.setGroup(group);\n            this.bumpAwayFrom(otherConnection as RenderedConnection);\n            eventUtils.setGroup(false);\n          }\n        }.bind(this),\n        config.bumpDelay,\n      );\n    }\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  override disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n      this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) return;\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) eventUtils.setGroup(true);\n\n    const parent = parentConnection.getSourceBlock() as BlockSvg;\n    const child = childConnection.getSourceBlock() as BlockSvg;\n    super.disconnectInternal(setParent);\n\n    parent.queueRender();\n    child.updateDisabled();\n    child.queueRender();\n    // Reset visibility, since the child is now a top block.\n    child.getSvgRoot().style.display = 'block';\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   * Render/rerender blocks as needed.\n   */\n  protected override respawnShadow_() {\n    super.respawnShadow_();\n    const blockShadow = this.targetBlock();\n    if (!blockShadow) {\n      return;\n    }\n    blockShadow.initSvg();\n    blockShadow.queueRender();\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param maxLimit The maximum radius to another connection, in workspace\n   *     units.\n   * @returns List of connections.\n   * @internal\n   */\n  override neighbours(maxLimit: number): RenderedConnection[] {\n    return this.dbOpposite.getNeighbours(this, maxLimit);\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.  Rerender blocks as needed.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected override connect_(childConnection: Connection) {\n    super.connect_(childConnection);\n\n    const renderedChildConnection = childConnection as RenderedConnection;\n\n    const parentBlock = this.getSourceBlock();\n    const childBlock = renderedChildConnection.getSourceBlock();\n\n    parentBlock.updateDisabled();\n    childBlock.updateDisabled();\n    childBlock.queueRender();\n\n    // The input the child block is connected to (if any).\n    const parentInput = parentBlock.getInputWithBlock(childBlock);\n    if (parentInput) {\n      const visible = parentInput.isVisible();\n      childBlock.getSvgRoot().style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected override onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (\n      this.isConnected() &&\n      (!this.targetConnection ||\n        !this.getConnectionChecker().canConnect(\n          this,\n          this.targetConnection,\n          false,\n        ))\n    ) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   * Rerender blocks as needed.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  override setCheck(check: string | string[] | null): RenderedConnection {\n    super.setCheck(check);\n    this.sourceBlock_.queueRender();\n    return this;\n  }\n}\n\nexport namespace RenderedConnection {\n  /**\n   * Enum for different kinds of tracked states.\n   *\n   * WILL_TRACK means that this connection will add itself to\n   * the db on the next moveTo call it receives.\n   *\n   * UNTRACKED means that this connection will not add\n   * itself to the database until setTracking(true) is explicitly called.\n   *\n   * TRACKED means that this connection is currently being tracked.\n   */\n  export enum TrackedState {\n    WILL_TRACK = -1,\n    UNTRACKED = 0,\n    TRACKED = 1,\n  }\n}\n\nexport type TrackedState = RenderedConnection.TrackedState;\nexport const TrackedState = RenderedConnection.TrackedState;\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {IDragStrategy} from '../interfaces/i_draggable.js';\nimport {Coordinate} from '../utils.js';\nimport * as eventUtils from '../events/utils.js';\nimport {BlockSvg} from '../block_svg.js';\nimport {RenderedConnection} from '../rendered_connection.js';\nimport * as dom from '../utils/dom.js';\nimport * as blockAnimation from '../block_animations.js';\nimport {ConnectionType} from '../connection_type.js';\nimport * as bumpObjects from '../bump_objects.js';\nimport * as registry from '../registry.js';\nimport {IConnectionPreviewer} from '../interfaces/i_connection_previewer.js';\nimport {Connection} from '../connection.js';\nimport type {Block} from '../block.js';\nimport {config} from '../config.js';\nimport type {BlockMove} from '../events/events_block_move.js';\nimport {finishQueuedRenders} from '../render_management.js';\nimport * as layers from '../layers.js';\n\n/** Represents a nearby valid connection. */\ninterface ConnectionCandidate {\n  /** A connection on the dragging stack that is compatible with neighbour. */\n  local: RenderedConnection;\n\n  /** A nearby connection that is compatible with local. */\n  neighbour: RenderedConnection;\n\n  /** The distance between the local connection and the neighbour connection. */\n  distance: number;\n}\n\nexport class BlockDragStrategy implements IDragStrategy {\n  private workspace: WorkspaceSvg;\n\n  /** The parent block at the start of the drag. */\n  private startParentConn: RenderedConnection | null = null;\n\n  /**\n   * The child block at the start of the drag. Only gets set if\n   * `healStack` is true.\n   */\n  private startChildConn: RenderedConnection | null = null;\n\n  private startLoc: Coordinate | null = null;\n\n  private connectionCandidate: ConnectionCandidate | null = null;\n\n  private connectionPreviewer: IConnectionPreviewer | null = null;\n\n  private dragging = false;\n\n  /**\n   * If this is a shadow block, the offset between this block and the parent\n   * block, to add to the drag location. In workspace units.\n   */\n  private dragOffset = new Coordinate(0, 0);\n\n  constructor(private block: BlockSvg) {\n    this.workspace = block.workspace;\n  }\n\n  /** Returns true if the block is currently movable. False otherwise. */\n  isMovable(): boolean {\n    if (this.block.isShadow()) {\n      return this.block.getParent()?.isMovable() ?? false;\n    }\n\n    return (\n      this.block.isOwnMovable() &&\n      !this.block.isDeadOrDying() &&\n      !this.workspace.options.readOnly &&\n      // We never drag blocks in the flyout, only create new blocks that are\n      // dragged.\n      !this.block.isInFlyout\n    );\n  }\n\n  /**\n   * Handles any setup for starting the drag, including disconnecting the block\n   * from any parent blocks.\n   */\n  startDrag(e?: PointerEvent): void {\n    if (this.block.isShadow()) {\n      this.startDraggingShadow(e);\n      return;\n    }\n\n    this.dragging = true;\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n    this.fireDragStartEvent();\n\n    this.startLoc = this.block.getRelativeToSurfaceXY();\n\n    this.connectionCandidate = null;\n    const previewerConstructor = registry.getClassFromOptions(\n      registry.Type.CONNECTION_PREVIEWER,\n      this.workspace.options,\n    );\n    this.connectionPreviewer = new previewerConstructor!(this.block);\n\n    // During a drag there may be a lot of rerenders, but not field changes.\n    // Turn the cache on so we don't do spurious remeasures during the drag.\n    dom.startTextWidthCache();\n    this.workspace.setResizesEnabled(false);\n    blockAnimation.disconnectUiStop();\n\n    const healStack = !!e && (e.altKey || e.ctrlKey || e.metaKey);\n\n    if (this.shouldDisconnect(healStack)) {\n      this.disconnectBlock(healStack);\n    }\n    this.block.setDragging(true);\n    this.workspace.getLayerManager()?.moveToDragLayer(this.block);\n  }\n\n  /** Starts a drag on a shadow, recording the drag offset. */\n  private startDraggingShadow(e?: PointerEvent) {\n    const parent = this.block.getParent();\n    if (!parent) {\n      throw new Error(\n        'Tried to drag a shadow block with no parent. ' +\n          'Shadow blocks should always have parents.',\n      );\n    }\n    this.dragOffset = Coordinate.difference(\n      parent.getRelativeToSurfaceXY(),\n      this.block.getRelativeToSurfaceXY(),\n    );\n    parent.startDrag(e);\n  }\n\n  /**\n   * Whether or not we should disconnect the block when a drag is started.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @returns True to disconnect the block, false otherwise.\n   */\n  private shouldDisconnect(healStack: boolean): boolean {\n    return !!(\n      this.block.getParent() ||\n      (healStack &&\n        this.block.nextConnection &&\n        this.block.nextConnection.targetBlock())\n    );\n  }\n\n  /**\n   * Disconnects the block from any parents. If `healStack` is true and this is\n   * a stack block, we also disconnect from any next blocks and attempt to\n   * attach them to any parent.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   */\n  private disconnectBlock(healStack: boolean) {\n    this.startParentConn =\n      this.block.outputConnection?.targetConnection ??\n      this.block.previousConnection?.targetConnection;\n    if (healStack) {\n      this.startChildConn = this.block.nextConnection?.targetConnection;\n    }\n\n    this.block.unplug(healStack);\n    blockAnimation.disconnectUiEffect(this.block);\n  }\n\n  /** Fire a UI event at the start of a block drag. */\n  private fireDragStartEvent() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n      this.block,\n      true,\n      this.block.getDescendants(false),\n    );\n    eventUtils.fire(event);\n  }\n\n  /** Fire a UI event at the end of a block drag. */\n  private fireDragEndEvent() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n      this.block,\n      false,\n      this.block.getDescendants(false),\n    );\n    eventUtils.fire(event);\n  }\n\n  /** Fire a move event at the end of a block drag. */\n  private fireMoveEvent() {\n    if (this.block.isDeadOrDying()) return;\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n      this.block,\n    ) as BlockMove;\n    event.setReason(['drag']);\n    event.oldCoordinate = this.startLoc!;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /** Moves the block and updates any connection previews. */\n  drag(newLoc: Coordinate): void {\n    if (this.block.isShadow()) {\n      this.block.getParent()?.drag(Coordinate.sum(newLoc, this.dragOffset));\n      return;\n    }\n\n    this.block.moveDuringDrag(newLoc);\n    this.updateConnectionPreview(\n      this.block,\n      Coordinate.difference(newLoc, this.startLoc!),\n    );\n  }\n\n  /**\n   * @param draggingBlock The block being dragged.\n   * @param delta How far the pointer has moved from the position\n   *     at the start of the drag, in workspace units.\n   */\n  private updateConnectionPreview(draggingBlock: BlockSvg, delta: Coordinate) {\n    const currCandidate = this.connectionCandidate;\n    const newCandidate = this.getConnectionCandidate(draggingBlock, delta);\n    if (!newCandidate) {\n      this.connectionPreviewer!.hidePreview();\n      this.connectionCandidate = null;\n      return;\n    }\n    const candidate =\n      currCandidate &&\n      this.currCandidateIsBetter(currCandidate, delta, newCandidate)\n        ? currCandidate\n        : newCandidate;\n    this.connectionCandidate = candidate;\n\n    const {local, neighbour} = candidate;\n    const localIsOutputOrPrevious =\n      local.type === ConnectionType.OUTPUT_VALUE ||\n      local.type === ConnectionType.PREVIOUS_STATEMENT;\n    const neighbourIsConnectedToRealBlock =\n      neighbour.isConnected() && !neighbour.targetBlock()!.isInsertionMarker();\n    if (\n      localIsOutputOrPrevious &&\n      neighbourIsConnectedToRealBlock &&\n      !this.orphanCanConnectAtEnd(\n        draggingBlock,\n        neighbour.targetBlock()!,\n        local.type,\n      )\n    ) {\n      this.connectionPreviewer!.previewReplacement(\n        local,\n        neighbour,\n        neighbour.targetBlock()!,\n      );\n      return;\n    }\n    this.connectionPreviewer!.previewConnection(local, neighbour);\n  }\n\n  /**\n   * Returns true if the given orphan block can connect at the end of the\n   * top block's stack or row, false otherwise.\n   */\n  private orphanCanConnectAtEnd(\n    topBlock: BlockSvg,\n    orphanBlock: BlockSvg,\n    localType: number,\n  ): boolean {\n    const orphanConnection =\n      localType === ConnectionType.OUTPUT_VALUE\n        ? orphanBlock.outputConnection\n        : orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n      topBlock as Block,\n      orphanConnection as Connection,\n    );\n  }\n\n  /**\n   * Returns true if the current candidate is better than the new candidate.\n   *\n   * We slightly prefer the current candidate even if it is farther away.\n   */\n  private currCandidateIsBetter(\n    currCandiate: ConnectionCandidate,\n    delta: Coordinate,\n    newCandidate: ConnectionCandidate,\n  ): boolean {\n    const {local: currLocal, neighbour: currNeighbour} = currCandiate;\n    const localPos = new Coordinate(currLocal.x, currLocal.y);\n    const neighbourPos = new Coordinate(currNeighbour.x, currNeighbour.y);\n    const currDistance = Coordinate.distance(\n      Coordinate.sum(localPos, delta),\n      neighbourPos,\n    );\n    return (\n      newCandidate.distance > currDistance - config.currentConnectionPreference\n    );\n  }\n\n  /**\n   * Returns the closest valid candidate connection, if one can be found.\n   *\n   * Valid neighbour connections are within the configured start radius, with a\n   * compatible type (input, output, etc) and connection check.\n   */\n  private getConnectionCandidate(\n    draggingBlock: BlockSvg,\n    delta: Coordinate,\n  ): ConnectionCandidate | null {\n    const localConns = this.getLocalConnections(draggingBlock);\n    let radius = this.connectionCandidate\n      ? config.connectingSnapRadius\n      : config.snapRadius;\n    let candidate = null;\n\n    for (const conn of localConns) {\n      const {connection: neighbour, radius: rad} = conn.closest(radius, delta);\n      if (neighbour) {\n        candidate = {\n          local: conn,\n          neighbour: neighbour,\n          distance: rad,\n        };\n        radius = rad;\n      }\n    }\n\n    return candidate;\n  }\n\n  /**\n   * Returns all of the connections we might connect to blocks on the workspace.\n   *\n   * Includes any connections on the dragging block, and any last next\n   * connection on the stack (if one exists).\n   */\n  private getLocalConnections(draggingBlock: BlockSvg): RenderedConnection[] {\n    const available = draggingBlock.getConnections_(false);\n    const lastOnStack = draggingBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== draggingBlock.nextConnection) {\n      available.push(lastOnStack);\n    }\n    return available;\n  }\n\n  /**\n   * Cleans up any state at the end of the drag. Applies any pending\n   * connections.\n   */\n  endDrag(e?: PointerEvent): void {\n    if (this.block.isShadow()) {\n      this.block.getParent()?.endDrag(e);\n      return;\n    }\n\n    this.fireDragEndEvent();\n    this.fireMoveEvent();\n\n    dom.stopTextWidthCache();\n\n    blockAnimation.disconnectUiStop();\n    this.connectionPreviewer!.hidePreview();\n\n    if (!this.block.isDeadOrDying() && this.dragging) {\n      // These are expensive and don't need to be done if we're deleting, or\n      // if we've already stopped dragging because we moved back to the start.\n      this.workspace\n        .getLayerManager()\n        ?.moveOffDragLayer(this.block, layers.BLOCK);\n      this.block.setDragging(false);\n    }\n\n    if (this.connectionCandidate) {\n      // Applying connections also rerenders the relevant blocks.\n      this.applyConnections(this.connectionCandidate);\n    } else {\n      this.block.queueRender();\n    }\n    this.block.snapToGrid();\n\n    // Must dispose after connections are applied to not break the dynamic\n    // connections plugin. See #7859\n    this.connectionPreviewer!.dispose();\n    this.workspace.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /** Connects the given candidate connections. */\n  private applyConnections(candidate: ConnectionCandidate) {\n    const {local, neighbour} = candidate;\n    local.connect(neighbour);\n\n    const inferiorConnection = local.isSuperior() ? neighbour : local;\n    const rootBlock = this.block.getRootBlock();\n\n    finishQueuedRenders().then(() => {\n      blockAnimation.connectionUiEffect(inferiorConnection.getSourceBlock());\n      // bringToFront is incredibly expensive. Delay until the next frame.\n      setTimeout(() => {\n        rootBlock.bringToFront();\n      }, 0);\n    });\n  }\n\n  /**\n   * Moves the block back to where it was at the beginning of the drag,\n   * including reconnecting connections.\n   */\n  revertDrag(): void {\n    if (this.block.isShadow()) {\n      this.block.getParent()?.revertDrag();\n      return;\n    }\n\n    this.startChildConn?.connect(this.block.nextConnection);\n    if (this.startParentConn) {\n      switch (this.startParentConn.type) {\n        case ConnectionType.INPUT_VALUE:\n          this.startParentConn.connect(this.block.outputConnection);\n          break;\n        case ConnectionType.NEXT_STATEMENT:\n          this.startParentConn.connect(this.block.previousConnection);\n      }\n    } else {\n      this.block.moveTo(this.startLoc!, ['drag']);\n      this.workspace\n        .getLayerManager()\n        ?.moveOffDragLayer(this.block, layers.BLOCK);\n      // Blocks dragged directly from a flyout may need to be bumped into\n      // bounds.\n      bumpObjects.bumpIntoBounds(\n        this.workspace,\n        this.workspace.getMetricsManager().getScrollMetrics(true),\n        this.block,\n      );\n    }\n\n    this.startChildConn = null;\n    this.startParentConn = null;\n\n    this.connectionPreviewer!.hidePreview();\n    this.connectionCandidate = null;\n\n    this.block.setDragging(false);\n    this.dragging = false;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BlockSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {\n  ContextMenuOption,\n  ContextMenuRegistry,\n  LegacyContextMenuOption,\n} from './contextmenu_registry.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {FieldLabel} from './field_label.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {IDragStrategy, IDraggable} from './interfaces/i_draggable.js';\nimport {IIcon} from './interfaces/i_icon.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Msg} from './msg.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport type {IPathObject} from './renderers/common/i_path_object.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {BlockStyle} from './theme.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {WarningIcon} from './icons/warning_icon.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as renderManagement from './render_management.js';\nimport {IconType} from './icons/icon_types.js';\nimport {BlockCopyData, BlockPaster} from './clipboard/block_paster.js';\nimport {BlockDragStrategy} from './dragging/block_drag_strategy.js';\nimport {IDeletable} from './blockly.js';\nimport {FlyoutItemInfo} from './utils/toolbox.js';\n\n/**\n * Class for a block's SVG representation.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class BlockSvg\n  extends Block\n  implements\n    IASTNodeLocationSvg,\n    IBoundedElement,\n    ICopyable<BlockCopyData>,\n    IDraggable,\n    IDeletable\n{\n  /**\n   * Constant for identifying rows that are to be rendered inline.\n   * Don't collide with Blockly.inputTypes.\n   */\n  static readonly INLINE = -1;\n\n  /**\n   * ID to give the \"collapsed warnings\" warning. Allows us to remove the\n   * \"collapsed warnings\" warning without removing any warnings that belong to\n   * the block.\n   */\n  static readonly COLLAPSED_WARNING_ID = 'TEMP_COLLAPSED_WARNING_';\n  override decompose?: (p1: Workspace) => BlockSvg;\n  // override compose?: ((p1: BlockSvg) => void)|null;\n  saveConnections?: (p1: BlockSvg) => void;\n  customContextMenu?: (\n    p1: Array<ContextMenuOption | LegacyContextMenuOption>,\n  ) => void;\n\n  /**\n   * Height of this block, not including any statement blocks above or below.\n   * Height is in workspace units.\n   */\n  height = 0;\n\n  /**\n   * Width of this block, including any connected value blocks.\n   * Width is in workspace units.\n   */\n  width = 0;\n\n  /**\n   * Map from IDs for warnings text to PIDs of functions to apply them.\n   * Used to be able to maintain multiple warnings.\n   */\n  private warningTextDb = new Map<string, ReturnType<typeof setTimeout>>();\n\n  /** Block's mutator icon (if any). */\n  mutator: MutatorIcon | null = null;\n\n  private svgGroup_: SVGGElement;\n  style: BlockStyle;\n  /** @internal */\n  pathObject: IPathObject;\n\n  /** Is this block a BlockSVG? */\n  override readonly rendered = true;\n\n  private visuallyDisabled = false;\n\n  /**\n   * Is this block currently rendering? Used to stop recursive render calls\n   * from actually triggering a re-render.\n   */\n  private renderIsInProgress_ = false;\n\n  /** Whether mousedown events have been bound yet. */\n  private eventsInit_ = false;\n\n  override workspace: WorkspaceSvg;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override outputConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override nextConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override previousConnection!: RenderedConnection;\n\n  private translation = '';\n\n  /** Whether this block is currently being dragged. */\n  private dragging = false;\n\n  /**\n   * The location of the top left of this block (in workspace coordinates)\n   * relative to either its parent block, or the workspace origin if it has no\n   * parent.\n   *\n   * @internal\n   */\n  relativeCoords = new Coordinate(0, 0);\n\n  private dragStrategy: IDragStrategy = new BlockDragStrategy(this);\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(workspace: WorkspaceSvg, prototypeName: string, opt_id?: string) {\n    super(workspace, prototypeName, opt_id);\n    if (!workspace.rendered) {\n      throw TypeError('Cannot create a rendered block in a headless workspace');\n    }\n    this.workspace = workspace;\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {});\n\n    /** A block style object. */\n    this.style = workspace.getRenderer().getConstants().getBlockStyle(null);\n\n    /** The renderer's path object. */\n    this.pathObject = workspace\n      .getRenderer()\n      .makePathObject(this.svgGroup_, this.style);\n\n    const svgPath = this.pathObject.svgPath;\n    (svgPath as any).tooltip = this;\n    Tooltip.bindMouseEvents(svgPath);\n\n    // Expose this block's ID on its top-level SVG group.\n    this.svgGroup_.setAttribute('data-id', this.id);\n\n    this.doInit_();\n  }\n\n  /**\n   * Create and initialize the SVG representation of the block.\n   * May be called more than once.\n   */\n  initSvg() {\n    if (this.initialized) return;\n    for (const input of this.inputList) {\n      input.init();\n    }\n    for (const icon of this.getIcons()) {\n      icon.initView(this.createIconPointerDownListener(icon));\n      icon.updateEditable();\n    }\n    this.applyColour();\n    this.pathObject.updateMovable(this.isMovable() || this.isInFlyout);\n    const svg = this.getSvgRoot();\n    if (!this.workspace.options.readOnly && svg) {\n      browserEvents.conditionalBind(\n        svg,\n        'pointerdown',\n        this,\n        this.onMouseDown_,\n      );\n    }\n\n    if (!svg.parentNode) {\n      this.workspace.getCanvas().appendChild(svg);\n    }\n    this.initialized = true;\n  }\n\n  /**\n   * Get the secondary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourSecondary(): string | undefined {\n    return this.style.colourSecondary;\n  }\n\n  /**\n   * Get the tertiary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourTertiary(): string | undefined {\n    return this.style.colourTertiary;\n  }\n\n  /** Selects this block. Highlights the block visually. */\n  select() {\n    if (this.isShadow()) {\n      this.getParent()?.select();\n      return;\n    }\n    this.addSelect();\n  }\n\n  /** Unselects this block. Unhighlights the blockv visually.   */\n  unselect() {\n    if (this.isShadow()) {\n      this.getParent()?.unselect();\n      return;\n    }\n    this.removeSelect();\n  }\n\n  /**\n   * Sets the parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  override setParent(newParent: this | null) {\n    const oldParent = this.parentBlock_;\n    if (newParent === oldParent) {\n      return;\n    }\n\n    dom.startTextWidthCache();\n    super.setParent(newParent);\n    dom.stopTextWidthCache();\n\n    const svgRoot = this.getSvgRoot();\n\n    // Bail early if workspace is clearing, or we aren't rendered.\n    // We won't need to reattach ourselves anywhere.\n    if (this.workspace.isClearing || !svgRoot) {\n      return;\n    }\n\n    const oldXY = this.getRelativeToSurfaceXY();\n    if (newParent) {\n      (newParent as BlockSvg).getSvgRoot().appendChild(svgRoot);\n    } else if (oldParent) {\n      // If we are losing a parent, we want to move our DOM element to the\n      // root of the workspace.\n      const draggingBlock = this.workspace\n        .getCanvas()\n        .querySelector('.blocklyDragging');\n      if (draggingBlock) {\n        this.workspace.getCanvas().insertBefore(svgRoot, draggingBlock);\n      } else {\n        this.workspace.getCanvas().appendChild(svgRoot);\n      }\n      this.translate(oldXY.x, oldXY.y);\n    }\n\n    this.applyColour();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   * If the block is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    const layerManger = this.workspace.getLayerManager();\n    if (!layerManger) {\n      throw new Error(\n        'Cannot calculate position because the workspace has not been appended',\n      );\n    }\n    let x = 0;\n    let y = 0;\n\n    let element: SVGElement = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this block and every parent.\n        const xy = svgMath.getRelativeXY(element);\n        x += xy.x;\n        y += xy.y;\n        element = element.parentNode as SVGElement;\n      } while (element && !layerManger.hasLayer(element));\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  override moveBy(dx: number, dy: number, reason?: string[]) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent');\n    }\n    const eventsEnabled = eventUtils.isEnabled();\n    let event: BlockMove | null = null;\n    if (eventsEnabled) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE)!)(this) as BlockMove;\n      reason && event.setReason(reason);\n    }\n\n    const delta = new Coordinate(dx, dy);\n    const currLoc = this.getRelativeToSurfaceXY();\n    const newLoc = Coordinate.sum(currLoc, delta);\n    this.translate(newLoc.x, newLoc.y);\n    this.updateComponentLocations(newLoc);\n\n    if (eventsEnabled && event) {\n      event!.recordNew();\n      eventUtils.fire(event);\n    }\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a block by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   */\n  translate(x: number, y: number) {\n    this.translation = `translate(${x}, ${y})`;\n    this.relativeCoords = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n  }\n\n  /**\n   * Returns the SVG translation of this block.\n   *\n   * @internal\n   */\n  getTranslation(): string {\n    return this.translation;\n  }\n\n  /**\n   * Move a block to a position.\n   *\n   * @param xy The position to move to in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  moveTo(xy: Coordinate, reason?: string[]) {\n    const curXY = this.getRelativeToSurfaceXY();\n    this.moveBy(xy.x - curXY.x, xy.y - curXY.y, reason);\n  }\n\n  /**\n   * Move this block during a drag.\n   * This block must be a top-level block.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    this.translate(newLoc.x, newLoc.y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n    this.updateComponentLocations(newLoc);\n  }\n\n  /** Snap this block to the nearest grid point. */\n  snapToGrid() {\n    if (this.isDeadOrDying()) return;\n    if (this.getParent()) return;\n    if (this.isInFlyout) return;\n    const grid = this.workspace.getGrid();\n    if (!grid?.shouldSnap()) return;\n    const currentXY = this.getRelativeToSurfaceXY();\n    const alignedXY = grid.alignXY(currentXY);\n    if (alignedXY !== currentXY) {\n      this.moveTo(alignedXY, ['snap']);\n    }\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * block and any blocks stacked below it.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const blockBounds = this.getHeightWidth();\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - blockBounds.width;\n      right = blockXY.x;\n    } else {\n      left = blockXY.x;\n      right = blockXY.x + blockBounds.width;\n    }\n    return new Rect(blockXY.y, blockXY.y + blockBounds.height, left, right);\n  }\n\n  /**\n   * Notify every input on this block to mark its fields as dirty.\n   * A dirty field is a field that needs to be re-rendered.\n   */\n  markDirty() {\n    this.pathObject.constants = this.workspace.getRenderer().getConstants();\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      input.markDirty();\n    }\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  override setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ === collapsed) {\n      return;\n    }\n    super.setCollapsed(collapsed);\n    this.updateCollapsed_();\n  }\n\n  /**\n   * Makes sure that when the block is collapsed, it is rendered correctly\n   * for that state.\n   */\n  private updateCollapsed_() {\n    const collapsed = this.isCollapsed();\n    const collapsedInputName = constants.COLLAPSED_INPUT_NAME;\n    const collapsedFieldName = constants.COLLAPSED_FIELD_NAME;\n\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name !== collapsedInputName) {\n        input.setVisible(!collapsed);\n      }\n    }\n\n    for (const icon of this.getIcons()) {\n      icon.updateCollapsed();\n    }\n\n    if (!collapsed) {\n      this.updateDisabled();\n      this.removeInput(collapsedInputName);\n      return;\n    }\n\n    const text = this.toString(internalConstants.COLLAPSE_CHARS);\n    const field = this.getField(collapsedFieldName);\n    if (field) {\n      field.setValue(text);\n      return;\n    }\n    const input =\n      this.getInput(collapsedInputName) ||\n      this.appendDummyInput(collapsedInputName);\n    input.appendField(new FieldLabel(text), collapsedFieldName);\n  }\n\n  /**\n   * Open the next (or previous) FieldTextInput.\n   *\n   * @param start Current field.\n   * @param forward If true go forward, otherwise backward.\n   */\n  tab(start: Field, forward: boolean) {\n    const tabCursor = new TabNavigateCursor();\n    tabCursor.setCurNode(ASTNode.createFieldNode(start)!);\n    const currentNode = tabCursor.getCurNode();\n\n    if (forward) {\n      tabCursor.next();\n    } else {\n      tabCursor.prev();\n    }\n\n    const nextNode = tabCursor.getCurNode();\n    if (nextNode && nextNode !== currentNode) {\n      const nextField = nextNode.getLocation() as Field;\n      nextField.showEditor();\n\n      // Also move the cursor if we're in keyboard nav mode.\n      if (this.workspace.keyboardAccessibilityMode) {\n        this.workspace.getCursor()!.setCurNode(nextNode);\n      }\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBlockStart(e, this);\n    }\n  }\n\n  /**\n   * Load the block's help page in a new window.\n   *\n   * @internal\n   */\n  showHelp() {\n    const url =\n      typeof this.helpUrl === 'function' ? this.helpUrl() : this.helpUrl;\n    if (url) {\n      window.open(url);\n    }\n  }\n\n  /**\n   * Generate the context menu for this block.\n   *\n   * @returns Context menu options or null if no menu.\n   */\n  protected generateContextMenu(): Array<\n    ContextMenuOption | LegacyContextMenuOption\n  > | null {\n    if (this.workspace.options.readOnly || !this.contextMenu) {\n      return null;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.BLOCK,\n      {block: this},\n    );\n\n    // Allow the block to add or modify menuOptions.\n    if (this.customContextMenu) {\n      this.customContextMenu(menuOptions);\n    }\n\n    return menuOptions;\n  }\n\n  /**\n   * Show the context menu for this block.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: PointerEvent) {\n    const menuOptions = this.generateContextMenu();\n\n    if (menuOptions && menuOptions.length) {\n      ContextMenu.show(e, menuOptions, this.RTL, this.workspace);\n      ContextMenu.setCurrentBlock(this);\n    }\n  }\n\n  /**\n   * Updates the locations of any parts of the block that need to know where\n   * they are (e.g. connections, icons).\n   *\n   * @param blockOrigin The top-left of this block in workspace coordinates.\n   * @internal\n   */\n  updateComponentLocations(blockOrigin: Coordinate) {\n    if (!this.dragging) this.updateConnectionLocations(blockOrigin);\n    this.updateIconLocations(blockOrigin);\n    this.updateFieldLocations(blockOrigin);\n\n    for (const child of this.getChildren(false)) {\n      child.updateComponentLocations(\n        Coordinate.sum(blockOrigin, child.relativeCoords),\n      );\n    }\n  }\n\n  private updateConnectionLocations(blockOrigin: Coordinate) {\n    for (const conn of this.getConnections_(false)) {\n      conn.moveToOffset(blockOrigin);\n    }\n  }\n\n  private updateIconLocations(blockOrigin: Coordinate) {\n    for (const icon of this.getIcons()) {\n      icon.onLocationChange(blockOrigin);\n    }\n  }\n\n  private updateFieldLocations(blockOrigin: Coordinate) {\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.onLocationChange(blockOrigin);\n      }\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    this.dragging = adding;\n    if (adding) {\n      this.translation = '';\n      common.draggingConnections.push(...this.getConnections_(true));\n      dom.addClass(this.svgGroup_, 'blocklyDragging');\n    } else {\n      common.draggingConnections.length = 0;\n      dom.removeClass(this.svgGroup_, 'blocklyDragging');\n    }\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).setDragging(adding);\n    }\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.pathObject.updateMovable(movable);\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].updateEditable();\n    }\n  }\n\n  /**\n   * Sets whether this block is a shadow block or not.\n   * This method is internal and should not be called by users of Blockly. To\n   * create shadow blocks programmatically call connection.setShadowState\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  override setShadow(shadow: boolean) {\n    super.setShadow(shadow);\n    this.applyColour();\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  override setInsertionMarker(insertionMarker: boolean) {\n    if (this.isInsertionMarker_ === insertionMarker) {\n      return; // No change.\n    }\n    this.isInsertionMarker_ = insertionMarker;\n    if (this.isInsertionMarker_) {\n      this.setColour(\n        this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR,\n      );\n      this.pathObject.updateInsertionMarker(true);\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   */\n  getSvgRoot(): SVGGElement {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @param animate If true, show a disposal animation and sound.\n   */\n  override dispose(healStack?: boolean, animate?: boolean) {\n    this.disposing = true;\n\n    Tooltip.dispose();\n    ContextMenu.hide();\n\n    if (animate) {\n      this.unplug(healStack);\n      blockAnimations.disposeUiEffect(this);\n    }\n\n    super.dispose(!!healStack);\n    dom.removeNode(this.svgGroup_);\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does trigger UI effects, remove nodes, etc.\n   */\n  override disposeInternal() {\n    this.disposing = true;\n    super.disposeInternal();\n\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    [...this.warningTextDb.values()].forEach((n) => clearTimeout(n));\n    this.warningTextDb.clear();\n\n    this.getIcons().forEach((i) => i.dispose());\n  }\n\n  /**\n   * Delete a block and hide chaff when doing so. The block will not be deleted\n   * if it's in a flyout. This is called from the context menu and keyboard\n   * shortcuts as the full delete action. If you are disposing of a block from\n   * the workspace and don't need to perform flyout checks, handle event\n   * grouping, or hide chaff, then use `block.dispose()` directly.\n   */\n  checkAndDelete() {\n    if (this.workspace.isFlyout) {\n      return;\n    }\n    eventUtils.setGroup(true);\n    this.workspace.hideChaff();\n    if (this.outputConnection) {\n      // Do not attempt to heal rows\n      // (https://github.com/google/blockly/issues/4832)\n      this.dispose(false, true);\n    } else {\n      this.dispose(/* heal */ true, true);\n    }\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Encode a block for copying.\n   *\n   * @returns Copy metadata, or null if the block is an insertion marker.\n   */\n  toCopyData(): BlockCopyData | null {\n    if (this.isInsertionMarker_) {\n      return null;\n    }\n    return {\n      paster: BlockPaster.TYPE,\n      blockState: blocks.save(this, {\n        addCoordinates: true,\n        addNextBlocks: false,\n      }) as blocks.State,\n      typeCounts: common.getBlockTypeCounts(this, true),\n    };\n  }\n\n  /**\n   * Updates the colour of the block to match the block's state.\n   *\n   * @internal\n   */\n  applyColour() {\n    this.pathObject.applyColour(this);\n\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].applyColour();\n    }\n\n    for (let x = 0, input; (input = this.inputList[x]); x++) {\n      for (let y = 0, field; (field = input.fieldRow[y]); y++) {\n        field.applyColour();\n      }\n    }\n  }\n\n  /**\n   * Updates the colour of the block (and children) to match the current\n   * disabled state.\n   *\n   * @internal\n   */\n  updateDisabled() {\n    const disabled = !this.isEnabled() || this.getInheritedDisabled();\n\n    if (this.visuallyDisabled === disabled) {\n      this.getNextBlock()?.updateDisabled();\n      return;\n    }\n\n    this.applyColour();\n    this.visuallyDisabled = disabled;\n    for (const child of this.getChildren(false)) {\n      child.updateDisabled();\n    }\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param text The text, or null to delete.\n   * @param id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  override setWarningText(text: string | null, id: string = '') {\n    if (!id) {\n      // Kill all previous pending processes, this edit supersedes them all.\n      for (const timeout of this.warningTextDb.values()) {\n        clearTimeout(timeout);\n      }\n      this.warningTextDb.clear();\n    } else if (this.warningTextDb.has(id)) {\n      // Only queue up the latest change.  Kill any earlier pending process.\n      clearTimeout(this.warningTextDb.get(id)!);\n      this.warningTextDb.delete(id);\n    }\n    if (this.workspace.isDragging()) {\n      // Don't change the warning text during a drag.\n      // Wait until the drag finishes.\n      this.warningTextDb.set(\n        id,\n        setTimeout(() => {\n          if (!this.isDeadOrDying()) {\n            this.warningTextDb.delete(id);\n            this.setWarningText(text, id);\n          }\n        }, 100),\n      );\n      return;\n    }\n    if (this.isInFlyout) {\n      text = null;\n    }\n\n    const icon = this.getIcon(WarningIcon.TYPE) as WarningIcon | undefined;\n    if (text) {\n      // Bubble up to add a warning on top-most collapsed block.\n      // TODO(#6020): This warning is never removed.\n      let parent = this.getSurroundParent();\n      let collapsedParent = null;\n      while (parent) {\n        if (parent.isCollapsed()) {\n          collapsedParent = parent;\n        }\n        parent = parent.getSurroundParent();\n      }\n      if (collapsedParent) {\n        collapsedParent.setWarningText(\n          Msg['COLLAPSED_WARNINGS_WARNING'],\n          BlockSvg.COLLAPSED_WARNING_ID,\n        );\n      }\n\n      if (icon) {\n        (icon as WarningIcon).addMessage(text, id);\n      } else {\n        this.addIcon(new WarningIcon(this).addMessage(text, id));\n      }\n    } else if (icon) {\n      // Dispose all warnings if no ID is given.\n      if (!id) {\n        this.removeIcon(WarningIcon.TYPE);\n      } else {\n        // Remove just this warning id's message.\n        icon.addMessage('', id);\n        // Then remove the entire icon if there is no longer any text.\n        if (!icon.getText()) this.removeIcon(WarningIcon.TYPE);\n      }\n    }\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param mutator A mutator dialog instance or null to remove.\n   */\n  override setMutator(mutator: MutatorIcon | null) {\n    this.removeIcon(MutatorIcon.TYPE);\n    if (mutator) this.addIcon(mutator);\n  }\n\n  override addIcon<T extends IIcon>(icon: T): T {\n    super.addIcon(icon);\n\n    if (icon instanceof MutatorIcon) this.mutator = icon;\n\n    icon.initView(this.createIconPointerDownListener(icon));\n    icon.applyColour();\n    icon.updateEditable();\n    this.queueRender();\n\n    return icon;\n  }\n\n  /**\n   * Creates a pointer down event listener for the icon to append to its\n   * root svg.\n   */\n  private createIconPointerDownListener(icon: IIcon) {\n    return (e: PointerEvent) => {\n      if (this.isDeadOrDying()) return;\n      const gesture = this.workspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartIcon(icon);\n      }\n    };\n  }\n\n  override removeIcon(type: IconType<IIcon>): boolean {\n    const removed = super.removeIcon(type);\n\n    if (type.equals(MutatorIcon.TYPE)) this.mutator = null;\n\n    this.queueRender();\n\n    return removed;\n  }\n\n  /**\n   * @deprecated v11 - Set whether the block is manually enabled or disabled.\n   * The user can toggle whether a block is disabled from a context menu\n   * option. A block may still be disabled for other reasons even if the user\n   * attempts to manually enable it, such as when the block is in an invalid\n   * location. This method is deprecated and setDisabledReason should be used\n   * instead.\n   *\n   * @param enabled True if enabled.\n   */\n  override setEnabled(enabled: boolean) {\n    deprecation.warn(\n      'setEnabled',\n      'v11',\n      'v12',\n      'the setDisabledReason method of BlockSvg',\n    );\n    const wasEnabled = this.isEnabled();\n    super.setEnabled(enabled);\n    if (this.isEnabled() !== wasEnabled && !this.getInheritedDisabled()) {\n      this.updateDisabled();\n    }\n  }\n\n  /**\n   * Add or remove a reason why the block might be disabled. If a block has\n   * any reasons to be disabled, then the block itself will be considered\n   * disabled. A block could be disabled for multiple independent reasons\n   * simultaneously, such as when the user manually disables it, or the block\n   * is invalid.\n   *\n   * @param disabled If true, then the block should be considered disabled for\n   *     at least the provided reason, otherwise the block is no longer disabled\n   *     for that reason.\n   * @param reason A language-neutral identifier for a reason why the block\n   *     could be disabled. Call this method again with the same identifier to\n   *     update whether the block is currently disabled for this reason.\n   */\n  override setDisabledReason(disabled: boolean, reason: string): void {\n    const wasEnabled = this.isEnabled();\n    super.setDisabledReason(disabled, reason);\n    if (this.isEnabled() !== wasEnabled && !this.getInheritedDisabled()) {\n      this.updateDisabled();\n    }\n  }\n\n  /**\n   * Set whether the block is highlighted or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  setHighlighted(highlighted: boolean) {\n    this.pathObject.updateHighlighted(highlighted);\n  }\n\n  /**\n   * Adds the visual \"select\" effect to the block, but does not actually select\n   * it or fire an event.\n   *\n   * @see BlockSvg#select\n   */\n  addSelect() {\n    this.pathObject.updateSelected(true);\n  }\n\n  /**\n   * Removes the visual \"select\" effect from the block, but does not actually\n   * unselect it or fire an event.\n   *\n   * @see BlockSvg#unselect\n   */\n  removeSelect() {\n    this.pathObject.updateSelected(false);\n  }\n\n  /**\n   * Update the cursor over this block by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    this.pathObject.updateDraggingDelete(enable);\n  }\n\n  // Overrides of functions on Blockly.Block that take into account whether the\n  // block has been rendered.\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  override getColour(): string {\n    return this.style.colourPrimary;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value, or #RRGGBB string.\n   */\n  override setColour(colour: number | string) {\n    super.setColour(colour);\n    const styleObj = this.workspace\n      .getRenderer()\n      .getConstants()\n      .getBlockStyleForColour(this.colour_);\n\n    this.pathObject.setStyle(styleObj.style);\n    this.style = styleObj.style;\n    this.styleName_ = styleObj.name;\n\n    this.applyColour();\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   * @throws {Error} if the block style does not exist.\n   */\n  override setStyle(blockStyleName: string) {\n    const blockStyle = this.workspace\n      .getRenderer()\n      .getConstants()\n      .getBlockStyle(blockStyleName);\n    this.styleName_ = blockStyleName;\n\n    if (blockStyle) {\n      this.hat = blockStyle.hat;\n      this.pathObject.setStyle(blockStyle);\n      // Set colour to match Block.\n      this.colour_ = blockStyle.colourPrimary;\n      this.style = blockStyle;\n\n      this.applyColour();\n    } else {\n      throw Error('Invalid style name: ' + blockStyleName);\n    }\n  }\n\n  /**\n   * Move this block to the front of the visible workspace.\n   * <g> tags do not respect z-index so SVG renders them in the\n   * order that they are in the DOM.  By placing this block first within the\n   * block group's <g>, it will render on top of any other blocks.\n   *\n   * @param blockOnly: True to only move this block to the front without\n   *     adjusting its parents.\n   * @internal\n   */\n  bringToFront(blockOnly = false) {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    if (block.isDeadOrDying()) {\n      return;\n    }\n    do {\n      const root = block.getSvgRoot();\n      const parent = root.parentNode;\n      const childNodes = parent!.childNodes;\n      // Avoid moving the block if it's already at the bottom.\n      if (childNodes[childNodes.length - 1] !== root) {\n        parent!.appendChild(root);\n      }\n      if (blockOnly) break;\n      block = block.getParent();\n    } while (block);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setPreviousStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setPreviousStatement(newBoolean, opt_check);\n    this.queueRender();\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setNextStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setNextStatement(newBoolean, opt_check);\n    this.queueRender();\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  override setOutput(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setOutput(newBoolean, opt_check);\n    this.queueRender();\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  override setInputsInline(newBoolean: boolean) {\n    super.setInputsInline(newBoolean);\n    this.queueRender();\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  override removeInput(name: string, opt_quiet?: boolean): boolean {\n    const removed = super.removeInput(name, opt_quiet);\n    this.queueRender();\n    return removed;\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  override moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    super.moveNumberedInputBefore(inputIndex, refIndex);\n    this.queueRender();\n  }\n\n  /** @override */\n  override appendInput(input: Input): Input {\n    super.appendInput(input);\n    this.queueRender();\n    return input;\n  }\n\n  /**\n   * Sets whether this block's connections are tracked in the database or not.\n   *\n   * Used by the deserializer to be more efficient. Setting a connection's\n   * tracked_ value to false keeps it from adding itself to the db when it\n   * gets its first moveTo call, saving expensive ops for later.\n   *\n   * @param track If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setConnectionTracking(track: boolean) {\n    if (this.previousConnection) {\n      this.previousConnection.setTracking(track);\n    }\n    if (this.outputConnection) {\n      this.outputConnection.setTracking(track);\n    }\n    if (this.nextConnection) {\n      this.nextConnection.setTracking(track);\n      const child = this.nextConnection.targetBlock();\n      if (child) {\n        child.setConnectionTracking(track);\n      }\n    }\n\n    if (this.collapsed_) {\n      // When track is true, we don't want to start tracking collapsed\n      // connections. When track is false, we're already not tracking\n      // collapsed connections, so no need to update.\n      return;\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.setTracking(track);\n\n        // Pass tracking on down the chain.\n        const block = conn.targetBlock();\n        if (block) {\n          block.setConnectionTracking(track);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns connections originating from this block.\n   *\n   * @param all If true, return all connections even hidden ones.\n   *     Otherwise, for a collapsed block don't return inputs connections.\n   * @returns Array of connections.\n   * @internal\n   */\n  override getConnections_(all: boolean): RenderedConnection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    if (all || !this.collapsed_) {\n      for (let i = 0, input; (input = this.inputList[i]); i++) {\n        if (input.connection) {\n          myConnections.push(input.connection as RenderedConnection);\n        }\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  override lastConnectionInStack(\n    ignoreShadows: boolean,\n  ): RenderedConnection | null {\n    return super.lastConnectionInStack(ignoreShadows) as RenderedConnection;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  override getMatchingConnection(\n    otherBlock: Block,\n    conn: Connection,\n  ): RenderedConnection | null {\n    return super.getMatchingConnection(otherBlock, conn) as RenderedConnection;\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   * @internal\n   */\n  override makeConnection_(type: ConnectionType): RenderedConnection {\n    return new RenderedConnection(this, type);\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  override getNextBlock(): BlockSvg | null {\n    return super.getNextBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  override getPreviousBlock(): BlockSvg | null {\n    return super.getPreviousBlock() as BlockSvg;\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   *\n   * Two blocks which aren't actually connected should not coincidentally line\n   * up on screen, because that creates confusion for end-users.\n   */\n  override bumpNeighbours() {\n    const root = this.getRootBlock();\n    if (\n      this.isDeadOrDying() ||\n      this.workspace.isDragging() ||\n      root.isInFlyout\n    ) {\n      return;\n    }\n\n    function neighbourIsInStack(neighbour: RenderedConnection) {\n      return neighbour.getSourceBlock().getRootBlock() === root;\n    }\n\n    for (const conn of this.getConnections_(false)) {\n      if (conn.isSuperior()) {\n        // Recurse down the block stack.\n        conn.targetBlock()?.bumpNeighbours();\n      }\n\n      for (const neighbour of conn.neighbours(config.snapRadius)) {\n        if (neighbourIsInStack(neighbour)) continue;\n        if (conn.isConnected() && neighbour.isConnected()) continue;\n\n        if (conn.isSuperior()) {\n          neighbour.bumpAwayFrom(conn);\n        } else {\n          conn.bumpAwayFrom(neighbour);\n        }\n      }\n    }\n  }\n\n  /**\n   * Snap to grid, and then bump neighbouring blocks away at the end of the next\n   * render.\n   */\n  scheduleSnapAndBump() {\n    this.snapToGrid();\n    this.bumpNeighbours();\n  }\n\n  /**\n   * Position a block so that it doesn't move the target block when connected.\n   * The block to position is usually either the first block in a dragged stack\n   * or an insertion marker.\n   *\n   * @param sourceConnection The connection on the moving block's stack.\n   * @param originalOffsetToTarget The connection original offset to the target connection\n   * @param originalOffsetInBlock The connection original offset in its block\n   * @internal\n   */\n  positionNearConnection(\n    sourceConnection: RenderedConnection,\n    originalOffsetToTarget: {x: number; y: number},\n    originalOffsetInBlock: Coordinate,\n  ) {\n    // We only need to position the new block if it's before the existing one,\n    // otherwise its position is set by the previous block.\n    if (\n      sourceConnection.type === ConnectionType.NEXT_STATEMENT ||\n      sourceConnection.type === ConnectionType.INPUT_VALUE\n    ) {\n      // First move the block to match the orginal target connection position\n      let dx = originalOffsetToTarget.x;\n      let dy = originalOffsetToTarget.y;\n      // Then adjust its position according to the connection resize\n      dx += originalOffsetInBlock.x - sourceConnection.getOffsetInBlock().x;\n      dy += originalOffsetInBlock.y - sourceConnection.getOffsetInBlock().y;\n\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getChildren(ordered: boolean): BlockSvg[] {\n    return super.getChildren(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Triggers a rerender after a delay to allow for batching.\n   *\n   * @returns A promise that resolves after the currently queued renders have\n   *     been completed. Used for triggering other behavior that relies on\n   *     updated size/position location for the block.\n   * @internal\n   */\n  queueRender(): Promise<void> {\n    return renderManagement.queueRender(this);\n  }\n\n  /**\n   * Immediately lays out and reflows a block based on its contents and\n   * settings.\n   */\n  render() {\n    this.queueRender();\n    renderManagement.triggerQueuedRenders();\n  }\n\n  /**\n   * Renders this block in a way that's compatible with the more efficient\n   * render management system.\n   *\n   * @internal\n   */\n  renderEfficiently() {\n    dom.startTextWidthCache();\n\n    if (this.isCollapsed()) {\n      this.updateCollapsed_();\n    }\n\n    if (!this.isEnabled()) {\n      this.updateDisabled();\n    }\n\n    this.workspace.getRenderer().render(this);\n    this.tightenChildrenEfficiently();\n\n    dom.stopTextWidthCache();\n    this.updateMarkers_();\n  }\n\n  /**\n   * Tightens all children of this block so they are snuggly rendered against\n   * their parent connections.\n   *\n   * Does not update connection locations, so that they can be updated more\n   * efficiently by the render management system.\n   *\n   * @internal\n   */\n  tightenChildrenEfficiently() {\n    for (const input of this.inputList) {\n      const conn = input.connection as RenderedConnection;\n      if (conn) conn.tightenEfficiently();\n    }\n    if (this.nextConnection) this.nextConnection.tightenEfficiently();\n  }\n\n  /** Redraw any attached marker or cursor svgs if needed. */\n  protected updateMarkers_() {\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.cursorSvg) {\n      this.workspace.getCursor()!.draw();\n    }\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.markerSvg) {\n      // TODO(#4592): Update all markers on the block.\n      this.workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.updateMarkers_();\n      }\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.pathObject.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.pathObject.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this block\n   * and any blocks stacked below it.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number; width: number} {\n    let height = this.height;\n    let width = this.width;\n    // Recursively add size of subsequent blocks.\n    const nextBlock = this.getNextBlock();\n    if (nextBlock) {\n      const nextHeightWidth = nextBlock.getHeightWidth();\n      const tabHeight = this.workspace\n        .getRenderer()\n        .getConstants().NOTCH_HEIGHT;\n      height += nextHeightWidth.height - tabHeight;\n      width = Math.max(width, nextHeightWidth.width);\n    }\n    return {height, width};\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped, this block\n   * will be replaced.  If a shadow block, it will disappear.  Otherwise it will\n   * bump.\n   *\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  fadeForReplacement(add: boolean) {\n    // TODO (7204): Remove these internal methods.\n    (this.pathObject as AnyDuringMigration).updateReplacementFade(add);\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped it will connect\n   * to this input.\n   *\n   * @param conn The connection on the input to highlight.\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  highlightShapeForInput(conn: RenderedConnection, add: boolean) {\n    // TODO (7204): Remove these internal methods.\n    (this.pathObject as AnyDuringMigration).updateShapeForInputHighlight(\n      conn,\n      add,\n    );\n  }\n\n  /** Sets the drag strategy for this block. */\n  setDragStrategy(dragStrategy: IDragStrategy) {\n    this.dragStrategy = dragStrategy;\n  }\n\n  /** Returns whether this block is movable or not. */\n  override isMovable(): boolean {\n    return this.dragStrategy.isMovable();\n  }\n\n  /** Starts a drag on the block. */\n  startDrag(e?: PointerEvent): void {\n    this.dragStrategy.startDrag(e);\n  }\n\n  /** Drags the block to the given location. */\n  drag(newLoc: Coordinate, e?: PointerEvent): void {\n    this.dragStrategy.drag(newLoc, e);\n  }\n\n  /** Ends the drag on the block. */\n  endDrag(e?: PointerEvent): void {\n    this.dragStrategy.endDrag(e);\n  }\n\n  /** Moves the block back to where it was at the start of a drag. */\n  revertDrag(): void {\n    this.dragStrategy.revertDrag();\n  }\n\n  /**\n   * Returns a representation of this block that can be displayed in a flyout.\n   */\n  toFlyoutInfo(): FlyoutItemInfo[] {\n    const json: FlyoutItemInfo = {\n      kind: 'BLOCK',\n      ...blocks.save(this),\n    };\n\n    const toRemove = new Set(['id', 'height', 'width', 'pinned', 'enabled']);\n\n    // Traverse the JSON recursively.\n    const traverseJson = function (json: {[key: string]: unknown}) {\n      for (const key in json) {\n        if (toRemove.has(key)) {\n          delete json[key];\n        } else if (typeof json[key] === 'object') {\n          traverseJson(json[key] as {[key: string]: unknown});\n        }\n      }\n    };\n\n    traverseJson(json as unknown as {[key: string]: unknown});\n    return [json];\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component with custom behaviour when a\n * block or bubble is dragged over or dropped on top of it.\n *\n * @class\n */\n// Former goog.module ID: Blockly.DragTarget\n\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {Rect} from './utils/rect.js';\n\n/**\n * Abstract class for a component with custom behaviour when a block or bubble\n * is dragged over or dropped on top of it.\n */\nexport class DragTarget implements IDragTarget {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  id!: string;\n\n  /**\n   * Constructor for DragTarget. It exists to add the id property and should not\n   * be called directly, only by a subclass.\n   */\n  constructor() {}\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(_dragElement: IDraggable) {\n    // no-op\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(_dragElement: IDraggable) {\n    // no-op\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(_dragElement: IDraggable) {\n    // no-op\n  }\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDrop(_dragElement: IDraggable) {\n    // no-op\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to the Blockly injection div.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect | null {\n    return null;\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(_dragElement: IDraggable): boolean {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component that can delete a block or\n * bubble that is dropped on top of it.\n *\n * @class\n */\n// Former goog.module ID: Blockly.DeleteArea\n\nimport {BlockSvg} from './block_svg.js';\nimport {DragTarget} from './drag_target.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport {isDeletable} from './interfaces/i_deletable.js';\n\n/**\n * Abstract class for a component that can delete a block or bubble that is\n * dropped on top of it.\n */\nexport class DeleteArea extends DragTarget implements IDeleteArea {\n  /**\n   * Whether the last block or bubble dragged over this delete area would be\n   * deleted if dropped on this component.\n   * This property is not updated after the block or bubble is deleted.\n   */\n  protected wouldDelete_ = false;\n\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override id!: string;\n\n  /**\n   * Constructor for DeleteArea. Should not be called directly, only by a\n   * subclass.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable): boolean {\n    if (element instanceof BlockSvg) {\n      const block = element;\n      const couldDeleteBlock = !block.getParent() && block.isDeletable();\n      this.updateWouldDelete_(couldDeleteBlock);\n    } else {\n      this.updateWouldDelete_(isDeletable(element) && element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected updateWouldDelete_(wouldDelete: boolean) {\n    this.wouldDelete_ = wouldDelete;\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a trash can icon.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Trashcan\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_trashcan_open.js';\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockDelete} from './events/events_block_delete.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as registry from './registry.js';\nimport type * as blocks from './serialization/blocks.js';\nimport {SPRITE} from './sprites.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport {BlockInfo} from './utils/toolbox.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a trash can.\n */\nexport class Trashcan\n  extends DeleteArea\n  implements IAutoHideable, IPositionable\n{\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'trashcan';\n\n  /**\n   * A list of JSON (stored as strings) representing blocks in the trashcan.\n   */\n  private readonly contents: string[] = [];\n\n  /**\n   * The trashcan flyout.\n   *\n   * @internal\n   */\n  flyout: IFlyout | null = null;\n\n  /** Current open/close state of the lid. */\n  isLidOpen = false;\n\n  /**\n   * The minimum openness of the lid. Used to indicate if the trashcan\n   * contains blocks.\n   */\n  private minOpenness = 0;\n\n  /** The SVG group containing the trash can. */\n  private svgGroup: SVGElement | null = null;\n\n  /** The SVG image element of the trash can lid. */\n  private svgLid: SVGElement | null = null;\n\n  /** Task ID of opening/closing animation. */\n  private lidTask: ReturnType<typeof setTimeout> | null = null;\n\n  /** Current state of lid opening (0.0 = closed, 1.0 = open). */\n  private lidOpen = 0;\n\n  /** Left coordinate of the trash can. */\n  private left = 0;\n\n  /** Top coordinate of the trash can. */\n  private top = 0;\n\n  /** Whether this trash can has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private workspace: WorkspaceSvg) {\n    super();\n\n    if (this.workspace.options.maxTrashcanContents <= 0) {\n      return;\n    }\n\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Options({\n      'scrollbars': true,\n      'parentWorkspace': this.workspace,\n      'rtl': this.workspace.RTL,\n      'oneBasedIndex': this.workspace.options.oneBasedIndex,\n      'renderer': this.workspace.options.renderer,\n      'rendererOverrides': this.workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    // Create vertical or horizontal flyout.\n    if (this.workspace.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace.toolboxPosition === toolbox.Position.TOP\n          ? toolbox.Position.BOTTOM\n          : toolbox.Position.TOP;\n      const HorizontalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.workspace.options,\n        true,\n      );\n      this.flyout = new HorizontalFlyout!(flyoutWorkspaceOptions);\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace.toolboxPosition === toolbox.Position.RIGHT\n          ? toolbox.Position.LEFT\n          : toolbox.Position.RIGHT;\n      const VerticalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.workspace.options,\n        true,\n      );\n      this.flyout = new VerticalFlyout!(flyoutWorkspaceOptions);\n    }\n    this.workspace.addChangeListener(this.onDelete.bind(this));\n  }\n\n  /**\n   * Create the trash can elements.\n   *\n   * @returns The trash can's SVG group.\n   */\n  createDom(): SVGElement {\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyTrash\">\n          <clippath id=\"blocklyTrashBodyClipPath837493\">\n            <rect width=\"47\" height=\"45\" y=\"15\"></rect>\n          </clippath>\n          <image width=\"64\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashBodyClipPath837493)\"></image>\n          <clippath id=\"blocklyTrashLidClipPath837493\">\n            <rect width=\"47\" height=\"15\"></rect>\n          </clippath>\n          <image width=\"84\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashLidClipPath837493)\"></image>\n        </g>\n        */\n    this.svgGroup = dom.createSvgElement(Svg.G, {'class': 'blocklyTrash'});\n    let clip;\n    const rnd = String(Math.random()).substring(2);\n    clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyTrashBodyClipPath' + rnd},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': WIDTH, 'height': BODY_HEIGHT, 'y': LID_HEIGHT},\n      clip,\n    );\n    const body = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'x': -SPRITE_LEFT,\n        'height': SPRITE.height,\n        'y': -SPRITE_TOP,\n        'clip-path': 'url(#blocklyTrashBodyClipPath' + rnd + ')',\n      },\n      this.svgGroup,\n    );\n    body.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyTrashLidClipPath' + rnd},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': WIDTH, 'height': LID_HEIGHT},\n      clip,\n    );\n    this.svgLid = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'x': -SPRITE_LEFT,\n        'height': SPRITE.height,\n        'y': -SPRITE_TOP,\n        'clip-path': 'url(#blocklyTrashLidClipPath' + rnd + ')',\n      },\n      this.svgGroup,\n    );\n    this.svgLid.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // bindEventWithChecks_ quashes events too aggressively. See:\n    // https://groups.google.com/forum/#!topic/blockly/QF4yB9Wx00s\n    // Using bindEventWithChecks_ for blocking mousedown causes issue in mobile.\n    // See #4303\n    browserEvents.bind(\n      this.svgGroup,\n      'pointerdown',\n      this,\n      this.blockMouseDownWhenOpenable,\n    );\n    browserEvents.bind(this.svgGroup, 'pointerup', this, this.click);\n    // Bind to body instead of this.svgGroup so that we don't get lid jitters\n    browserEvents.bind(body, 'pointerover', this, this.mouseOver);\n    browserEvents.bind(body, 'pointerout', this, this.mouseOut);\n    this.animateLid();\n    return this.svgGroup;\n  }\n\n  /** Initializes the trash can. */\n  init() {\n    if (this.workspace.options.maxTrashcanContents > 0) {\n      dom.insertAfter(\n        this.flyout!.createDom(Svg.SVG)!,\n        this.workspace.getParentSvg(),\n      );\n      this.flyout!.init(this.workspace);\n    }\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n        ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initialized = true;\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Dispose of this trash can.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('trashcan');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.lidTask) {\n      clearTimeout(this.lidTask);\n    }\n  }\n\n  /**\n   * Whether the trashcan has contents.\n   *\n   * @returns True if the trashcan has contents.\n   */\n  private hasContents(): boolean {\n    return !!this.contents.length;\n  }\n\n  /**\n   * Returns true if the trashcan contents-flyout is currently open.\n   *\n   * @returns True if the trashcan contents-flyout is currently open.\n   */\n  contentsIsOpen(): boolean {\n    return !!this.flyout && this.flyout.isVisible();\n  }\n\n  /** Opens the trashcan flyout. */\n  openFlyout() {\n    if (this.contentsIsOpen()) {\n      return;\n    }\n    const contents = this.contents.map(function (string) {\n      return JSON.parse(string);\n    });\n    // Trashcans with lots of blocks can take a second to render.\n    const blocklyStyle = this.workspace.getParentSvg().style;\n    blocklyStyle.cursor = 'wait';\n    setTimeout(() => {\n      this.flyout?.show(contents);\n      blocklyStyle.cursor = '';\n      this.workspace.scrollbar?.setVisible(false);\n    }, 10);\n    this.fireUiEvent(true);\n  }\n\n  /** Closes the trashcan flyout. */\n  closeFlyout() {\n    if (!this.contentsIsOpen()) {\n      return;\n    }\n    this.flyout?.hide();\n    this.workspace.scrollbar?.setVisible(true);\n    this.fireUiEvent(false);\n    this.workspace.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    // For now the trashcan flyout always autocloses because it overlays the\n    // trashcan UI (no trashcan to click to close it).\n    if (!onlyClosePopups && this.flyout) {\n      this.closeFlyout();\n    }\n  }\n\n  /**\n   * Empties the trashcan's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  emptyContents() {\n    if (!this.hasContents()) {\n      return;\n    }\n    this.contents.length = 0;\n    this.setMinOpenness(0);\n    this.closeFlyout();\n  }\n\n  /**\n   * Positions the trashcan.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\n      this.workspace,\n      metrics,\n    );\n\n    const height = BODY_HEIGHT + LID_HEIGHT;\n    const startRect = uiPosition.getStartPositionRect(\n      cornerPosition,\n      new Size(WIDTH, height),\n      MARGIN_HORIZONTAL,\n      MARGIN_VERTICAL,\n      metrics,\n      this.workspace,\n    );\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection =\n      verticalPosition === uiPosition.verticalPosition.TOP\n        ? uiPosition.bumpDirection.DOWN\n        : uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n      startRect,\n      MARGIN_VERTICAL,\n      bumpDirection,\n      savedPositions,\n    );\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n      'transform',\n      'translate(' + this.left + ',' + this.top + ')',\n    );\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null {\n    const bottom = this.top + BODY_HEIGHT + LID_HEIGHT;\n    const right = this.left + WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup) {\n      return null;\n    }\n\n    const trashRect = this.svgGroup.getBoundingClientRect();\n    const top = trashRect.top + SPRITE_TOP - MARGIN_HOTSPOT;\n    const bottom = top + LID_HEIGHT + BODY_HEIGHT + 2 * MARGIN_HOTSPOT;\n    const left = trashRect.left + SPRITE_LEFT - MARGIN_HOTSPOT;\n    const right = left + WIDTH + 2 * MARGIN_HOTSPOT;\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragOver(_dragElement: IDraggable) {\n    this.setLidOpen(this.wouldDelete_);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    setTimeout(this.setLidOpen.bind(this, false), 100);\n  }\n\n  /**\n   * Flip the lid open or shut.\n   *\n   * @param state True if open.\n   * @internal\n   */\n  setLidOpen(state: boolean) {\n    if (this.isLidOpen === state) {\n      return;\n    }\n    if (this.lidTask) {\n      clearTimeout(this.lidTask);\n    }\n    this.isLidOpen = state;\n    this.animateLid();\n  }\n\n  /** Rotate the lid open or closed by one step.  Then wait and recurse. */\n  private animateLid() {\n    const frames = ANIMATION_FRAMES;\n\n    const delta = 1 / (frames + 1);\n    this.lidOpen += this.isLidOpen ? delta : -delta;\n    this.lidOpen = Math.min(Math.max(this.lidOpen, this.minOpenness), 1);\n\n    this.setLidAngle(this.lidOpen * MAX_LID_ANGLE);\n\n    // Linear interpolation between min and max.\n    const opacity = OPACITY_MIN + this.lidOpen * (OPACITY_MAX - OPACITY_MIN);\n    if (this.svgGroup) {\n      this.svgGroup.style.opacity = `${opacity}`;\n    }\n\n    if (this.lidOpen > this.minOpenness && this.lidOpen < 1) {\n      this.lidTask = setTimeout(\n        this.animateLid.bind(this),\n        ANIMATION_LENGTH / frames,\n      );\n    }\n  }\n\n  /**\n   * Set the angle of the trashcan's lid.\n   *\n   * @param lidAngle The angle at which to set the lid.\n   */\n  private setLidAngle(lidAngle: number) {\n    const openAtRight =\n      this.workspace.toolboxPosition === toolbox.Position.RIGHT ||\n      (this.workspace.horizontalLayout && this.workspace.RTL);\n    this.svgLid?.setAttribute(\n      'transform',\n      'rotate(' +\n        (openAtRight ? -lidAngle : lidAngle) +\n        ',' +\n        (openAtRight ? 4 : WIDTH - 4) +\n        ',' +\n        (LID_HEIGHT - 2) +\n        ')',\n    );\n  }\n\n  /**\n   * Sets the minimum openness of the trashcan lid. If the lid is currently\n   * closed, this will update lid's position.\n   *\n   * @param newMin The new minimum openness of the lid. Should be between 0\n   *     and 1.\n   */\n  private setMinOpenness(newMin: number) {\n    this.minOpenness = newMin;\n    if (!this.isLidOpen) {\n      this.setLidAngle(newMin * MAX_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Flip the lid shut.\n   * Called externally after a drag.\n   */\n  closeLid() {\n    this.setLidOpen(false);\n  }\n\n  /** Inspect the contents of the trash. */\n  click() {\n    if (!this.hasContents() || this.workspace.isDragging()) {\n      return;\n    }\n    this.openFlyout();\n  }\n\n  /**\n   * Fires a UI event for trashcan flyout open or close.\n   *\n   * @param trashcanOpen Whether the flyout is opening.\n   */\n  private fireUiEvent(trashcanOpen: boolean) {\n    const uiEvent = new (eventUtils.get(eventUtils.TRASHCAN_OPEN))(\n      trashcanOpen,\n      this.workspace.id,\n    );\n    eventUtils.fire(uiEvent);\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the trashcan has blocks.\n   *\n   * @param e A mouse down event.\n   */\n  private blockMouseDownWhenOpenable(e: PointerEvent) {\n    if (!this.contentsIsOpen() && this.hasContents()) {\n      // Don't start a workspace scroll.\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Indicate that the trashcan can be clicked (by opening it) if it has blocks.\n   */\n  private mouseOver() {\n    if (this.hasContents()) {\n      this.setLidOpen(true);\n    }\n  }\n\n  /**\n   * Close the lid of the trashcan if it was open (Vis. it was indicating it had\n   *    blocks).\n   */\n  private mouseOut() {\n    // No need to do a .hasBlocks check here because if it doesn't the trashcan\n    // won't be open in the first place, and setOpen won't run.\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handle a BLOCK_DELETE event. Adds deleted blocks oldXml to the content\n   * array.\n   *\n   * @param event Workspace event.\n   */\n  private onDelete(event: Abstract) {\n    if (\n      this.workspace.options.maxTrashcanContents <= 0 ||\n      event.type !== eventUtils.BLOCK_DELETE\n    ) {\n      return;\n    }\n    const deleteEvent = event as BlockDelete;\n    if (event.type === eventUtils.BLOCK_DELETE && !deleteEvent.wasShadow) {\n      if (!deleteEvent.oldJson) {\n        throw new Error('Encountered a delete event without proper oldJson');\n      }\n      const cleanedJson = JSON.stringify(\n        this.cleanBlockJson(deleteEvent.oldJson),\n      );\n      if (this.contents.includes(cleanedJson)) {\n        return;\n      }\n      this.contents.unshift(cleanedJson);\n      while (\n        this.contents.length > this.workspace.options.maxTrashcanContents\n      ) {\n        this.contents.pop();\n      }\n\n      this.setMinOpenness(HAS_BLOCKS_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Converts JSON representing a block into text that can be stored in the\n   * content array.\n   *\n   * @param json A JSON representation of a block's state.\n   * @returns A BlockInfo object corresponding to the JSON, cleaned of all\n   *     unnecessary attributes.\n   */\n  private cleanBlockJson(json: blocks.State): BlockInfo {\n    // Create a deep copy.\n    json = JSON.parse(JSON.stringify(json)) as blocks.State;\n\n    /**\n     * Reshape JSON into a nicer format.\n     *\n     * @param json The JSON to clean.\n     */\n    function cleanRec(json: blocks.State) {\n      if (!json) {\n        return;\n      }\n\n      delete json['id'];\n      delete json['x'];\n      delete json['y'];\n      delete json['enabled'];\n      delete json['disabledReasons'];\n\n      if (json['icons'] && json['icons']['comment']) {\n        const comment = json['icons']['comment'];\n        delete comment['height'];\n        delete comment['width'];\n        delete comment['pinned'];\n      }\n\n      const inputs = json['inputs'];\n      for (const name in inputs) {\n        const input = inputs[name];\n        const block = input['block'];\n        const shadow = input['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n      if (json['next']) {\n        const next = json['next'];\n        const block = next['block'];\n        const shadow = next['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n    }\n\n    cleanRec(json);\n\n    const blockInfo: BlockInfo = {\n      'kind': 'BLOCK',\n      ...json,\n    };\n    return blockInfo;\n  }\n}\n\n/** Width of both the trash can and lid images. */\nconst WIDTH = 47;\n\n/** Height of the trashcan image (minus lid). */\nconst BODY_HEIGHT = 44;\n\n/** Height of the lid image. */\nconst LID_HEIGHT = 16;\n\n/** Distance between trashcan and bottom or top edge of workspace. */\nconst MARGIN_VERTICAL = 20;\n\n/** Distance between trashcan and right or left edge of workspace. */\nconst MARGIN_HORIZONTAL = 20;\n\n/** Extent of hotspot on all sides beyond the size of the image. */\nconst MARGIN_HOTSPOT = 10;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_LEFT = 0;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_TOP = 32;\n\n/**\n * The openness of the lid when the trashcan contains blocks.\n *    (0.0 = closed, 1.0 = open)\n */\nconst HAS_BLOCKS_LID_ANGLE = 0.1;\n\n/** The length of the lid open/close animation in milliseconds. */\nconst ANIMATION_LENGTH = 80;\n\n/** The number of frames in the animation. */\nconst ANIMATION_FRAMES = 4;\n\n/** The minimum (resting) opacity of the trashcan and lid. */\nconst OPACITY_MIN = 0.4;\n\n/** The maximum (hovered) opacity of the trashcan and lid. */\nconst OPACITY_MAX = 0.8;\n\n/**\n * The maximum angle the trashcan lid can opens to. At the end of the open\n * animation the lid will be open to this angle.\n */\nconst MAX_LID_ANGLE = 45;\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The namespace used to keep track of keyboard shortcuts and the\n * key codes used to execute those shortcuts.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ShortcutRegistry\n\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as object from './utils/object.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for the registry of keyboard shortcuts. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ShortcutRegistry.registry.\n */\nexport class ShortcutRegistry {\n  static readonly registry = new ShortcutRegistry();\n\n  /** Registry of all keyboard shortcuts, keyed by name of shortcut. */\n  private shortcuts = new Map<string, KeyboardShortcut>();\n\n  /** Map of key codes to an array of shortcut names. */\n  private keyMap = new Map<string, string[]>();\n\n  /** Resets the existing ShortcutRegistry singleton. */\n  private constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry and keyMap. */\n  reset() {\n    this.shortcuts.clear();\n    this.keyMap.clear();\n  }\n\n  /**\n   * Registers a keyboard shortcut.\n   *\n   * @param shortcut The shortcut for this key code.\n   * @param opt_allowOverrides True to prevent a warning when overriding an\n   *     already registered item.\n   * @throws {Error} if a shortcut with the same name already exists.\n   */\n  register(shortcut: KeyboardShortcut, opt_allowOverrides?: boolean) {\n    const registeredShortcut = this.shortcuts.get(shortcut.name);\n    if (registeredShortcut && !opt_allowOverrides) {\n      throw new Error(`Shortcut named \"${shortcut.name}\" already exists.`);\n    }\n    this.shortcuts.set(shortcut.name, shortcut);\n\n    const keyCodes = shortcut.keyCodes;\n    if (keyCodes && keyCodes.length > 0) {\n      for (let i = 0; i < keyCodes.length; i++) {\n        this.addKeyMapping(\n          keyCodes[i],\n          shortcut.name,\n          !!shortcut.allowCollision,\n        );\n      }\n    }\n  }\n\n  /**\n   * Unregisters a keyboard shortcut registered with the given key code. This\n   * will also remove any key mappings that reference this shortcut.\n   *\n   * @param shortcutName The name of the shortcut to unregister.\n   * @returns True if an item was unregistered, false otherwise.\n   */\n  unregister(shortcutName: string): boolean {\n    const shortcut = this.shortcuts.get(shortcutName);\n\n    if (!shortcut) {\n      console.warn(`Keyboard shortcut named \"${shortcutName}\" not found.`);\n      return false;\n    }\n\n    this.removeAllKeyMappings(shortcutName);\n\n    this.shortcuts.delete(shortcutName);\n    return true;\n  }\n\n  /**\n   * Adds a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_allowCollision True to prevent an error when adding a shortcut\n   *     to a key that is already mapped to a shortcut.\n   * @throws {Error} if the given key code is already mapped to a shortcut.\n   */\n  addKeyMapping(\n    keyCode: string | number | KeyCodes,\n    shortcutName: string,\n    opt_allowCollision?: boolean,\n  ) {\n    keyCode = `${keyCode}`;\n    const shortcutNames = this.keyMap.get(keyCode);\n    if (shortcutNames && !opt_allowCollision) {\n      throw new Error(\n        `Shortcut named \"${shortcutName}\" collides with shortcuts \"${shortcutNames}\"`,\n      );\n    } else if (shortcutNames && opt_allowCollision) {\n      shortcutNames.unshift(shortcutName);\n    } else {\n      this.keyMap.set(keyCode, [shortcutName]);\n    }\n  }\n\n  /**\n   * Removes a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_quiet True to not console warn when there is no shortcut to\n   *     remove.\n   * @returns True if a key mapping was removed, false otherwise.\n   */\n  removeKeyMapping(\n    keyCode: string,\n    shortcutName: string,\n    opt_quiet?: boolean,\n  ): boolean {\n    const shortcutNames = this.keyMap.get(keyCode);\n\n    if (!shortcutNames) {\n      if (!opt_quiet) {\n        console.warn(\n          `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\n        );\n      }\n      return false;\n    }\n\n    const shortcutIdx = shortcutNames.indexOf(shortcutName);\n    if (shortcutIdx > -1) {\n      shortcutNames.splice(shortcutIdx, 1);\n      if (shortcutNames.length === 0) {\n        this.keyMap.delete(keyCode);\n      }\n      return true;\n    }\n    if (!opt_quiet) {\n      console.warn(\n        `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\n      );\n    }\n    return false;\n  }\n\n  /**\n   * Removes all the key mappings for a shortcut with the given name.\n   * Useful when changing the default key mappings and the key codes registered\n   * to the shortcut are unknown.\n   *\n   * @param shortcutName The name of the shortcut to remove from the key map.\n   */\n  removeAllKeyMappings(shortcutName: string) {\n    for (const keyCode of this.keyMap.keys()) {\n      this.removeKeyMapping(keyCode, shortcutName, true);\n    }\n  }\n\n  /**\n   * Sets the key map. Setting the key map will override any default key\n   * mappings.\n   *\n   * @param newKeyMap The object with key code to shortcut names.\n   */\n  setKeyMap(newKeyMap: {[key: string]: string[]}) {\n    this.keyMap.clear();\n    for (const key in newKeyMap) {\n      this.keyMap.set(key, newKeyMap[key]);\n    }\n  }\n\n  /**\n   * Gets the current key map.\n   *\n   * @returns The object holding key codes to ShortcutRegistry.KeyboardShortcut.\n   */\n  getKeyMap(): {[key: string]: string[]} {\n    const legacyKeyMap: {[key: string]: string[]} = Object.create(null);\n    for (const [key, value] of this.keyMap) {\n      legacyKeyMap[key] = value;\n    }\n    return legacyKeyMap;\n  }\n\n  /**\n   * Gets the registry of keyboard shortcuts.\n   *\n   * @returns The registry of keyboard shortcuts.\n   */\n  getRegistry(): {[key: string]: KeyboardShortcut} {\n    const legacyRegistry: {[key: string]: KeyboardShortcut} =\n      Object.create(null);\n    for (const [key, value] of this.shortcuts) {\n      legacyRegistry[key] = value;\n    }\n    return object.deepMerge(Object.create(null), legacyRegistry);\n  }\n\n  /**\n   * Handles key down events.\n   *\n   * @param workspace The main workspace where the event was captured.\n   * @param e The key down event.\n   * @returns True if the event was handled, false otherwise.\n   */\n  onKeyDown(workspace: WorkspaceSvg, e: KeyboardEvent): boolean {\n    const key = this.serializeKeyEvent_(e);\n    const shortcutNames = this.getShortcutNamesByKeyCode(key);\n    if (!shortcutNames) {\n      return false;\n    }\n    for (let i = 0, shortcutName; (shortcutName = shortcutNames[i]); i++) {\n      const shortcut = this.shortcuts.get(shortcutName);\n      if (!shortcut?.preconditionFn || shortcut?.preconditionFn(workspace)) {\n        // If the key has been handled, stop processing shortcuts.\n        if (shortcut?.callback && shortcut?.callback(workspace, e, shortcut)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Gets the shortcuts registered to the given key code.\n   *\n   * @param keyCode The serialized key code.\n   * @returns The list of shortcuts to call when the given keyCode is used.\n   *     Undefined if no shortcuts exist.\n   */\n  getShortcutNamesByKeyCode(keyCode: string): string[] | undefined {\n    return this.keyMap.get(keyCode) || [];\n  }\n\n  /**\n   * Gets the serialized key codes that the shortcut with the given name is\n   * registered under.\n   *\n   * @param shortcutName The name of the shortcut.\n   * @returns An array with all the key codes the shortcut is registered under.\n   */\n  getKeyCodesByShortcutName(shortcutName: string): string[] {\n    const keys = [];\n    for (const [keyCode, shortcuts] of this.keyMap) {\n      const shortcutIdx = shortcuts.indexOf(shortcutName);\n      if (shortcutIdx > -1) {\n        keys.push(keyCode);\n      }\n    }\n    return keys;\n  }\n\n  /**\n   * Serializes a key event.\n   *\n   * @param e A key down event.\n   * @returns The serialized key code for the given event.\n   */\n  private serializeKeyEvent_(e: KeyboardEvent): string {\n    let serializedKey = '';\n    for (const modifier in ShortcutRegistry.modifierKeys) {\n      if (e.getModifierState(modifier)) {\n        if (serializedKey !== '') {\n          serializedKey += '+';\n        }\n        serializedKey += modifier;\n      }\n    }\n    if (serializedKey !== '' && e.keyCode) {\n      serializedKey += '+' + e.keyCode;\n    } else if (e.keyCode) {\n      serializedKey = String(e.keyCode);\n    }\n    return serializedKey;\n  }\n\n  /**\n   * Checks whether any of the given modifiers are not valid.\n   *\n   * @param modifiers List of modifiers to be used with the key.\n   * @throws {Error} if the modifier is not in the valid modifiers list.\n   */\n  private checkModifiers_(modifiers: KeyCodes[]) {\n    for (let i = 0, modifier; (modifier = modifiers[i]); i++) {\n      if (!(modifier in ShortcutRegistry.modifierKeys)) {\n        throw new Error(modifier + ' is not a valid modifier key.');\n      }\n    }\n  }\n\n  /**\n   * Creates the serialized key code that will be used in the key map.\n   *\n   * @param keyCode Number code representing the key.\n   * @param modifiers List of modifier key codes to be used with the key. All\n   *     valid modifiers can be found in the ShortcutRegistry.modifierKeys.\n   * @returns The serialized key code for the given modifiers and key.\n   */\n  createSerializedKey(keyCode: number, modifiers: KeyCodes[] | null): string {\n    let serializedKey = '';\n\n    if (modifiers) {\n      this.checkModifiers_(modifiers);\n      for (const modifier in ShortcutRegistry.modifierKeys) {\n        const modifierKeyCode = (\n          ShortcutRegistry.modifierKeys as AnyDuringMigration\n        )[modifier];\n        if (modifiers.includes(modifierKeyCode)) {\n          if (serializedKey !== '') {\n            serializedKey += '+';\n          }\n          serializedKey += modifier;\n        }\n      }\n    }\n\n    if (serializedKey !== '' && keyCode) {\n      serializedKey += '+' + keyCode;\n    } else if (keyCode) {\n      serializedKey = `${keyCode}`;\n    }\n    return serializedKey;\n  }\n}\n\nexport namespace ShortcutRegistry {\n  export interface KeyboardShortcut {\n    callback?: (p1: WorkspaceSvg, p2: Event, p3: KeyboardShortcut) => boolean;\n    name: string;\n    preconditionFn?: (p1: WorkspaceSvg) => boolean;\n    metadata?: object;\n    keyCodes?: (number | string)[];\n    allowCollision?: boolean;\n  }\n\n  /** Supported modifiers. */\n  export enum modifierKeys {\n    Shift = KeyCodes.SHIFT,\n    Control = KeyCodes.CTRL,\n    Alt = KeyCodes.ALT,\n    Meta = KeyCodes.META,\n  }\n}\n\nexport type KeyboardShortcut = ShortcutRegistry.KeyboardShortcut;\n// No need to export ShorcutRegistry.modifierKeys from the module at this time\n// because (1) it wasn't automatically converted by the automatic migration\n// script, (2) the name doesn't follow the styleguide.\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.variables\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n/**\n * Represents the state of a given variable.\n */\nexport interface State {\n  name: string;\n  id: string;\n  type: string | undefined;\n}\n\n/**\n * Serializer for saving and loading variable state.\n */\nexport class VariableSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing variables. */\n    this.priority = priorities.VARIABLES;\n  }\n\n  /**\n   * Serializes the variables of the given workspace.\n   *\n   * @param workspace The workspace to save the variables of.\n   * @returns The state of the workspace's variables, or null if there are no\n   *     variables.\n   */\n  save(workspace: Workspace): State[] | null {\n    const variableStates = [];\n    for (const variable of workspace.getAllVariables()) {\n      const state = {\n        'name': variable.name,\n        'id': variable.getId(),\n      };\n      if (variable.type) {\n        (state as AnyDuringMigration)['type'] = variable.type;\n      }\n      variableStates.push(state);\n    }\n    // AnyDuringMigration because:  Type '{ name: string; id: string; }[] |\n    // null' is not assignable to type 'State[] | null'.\n    return (\n      variableStates.length ? variableStates : null\n    ) as AnyDuringMigration;\n  }\n\n  /**\n   * Deserializes the variable defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the variables to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const varState of state) {\n      workspace.createVariable(\n        varState['name'],\n        varState['type'],\n        varState['id'],\n      );\n    }\n  }\n\n  /**\n   * Disposes of any variables that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the variables of.\n   */\n  clear(workspace: Workspace) {\n    workspace.getVariableMap().clear();\n  }\n}\n\nserializationRegistry.register('variables', new VariableSerializer());\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Serialization methods.\n */\n// Former goog.module ID: Blockly.serialization\n\nimport * as blocks from './serialization/blocks.js';\nimport * as exceptions from './serialization/exceptions.js';\nimport * as priorities from './serialization/priorities.js';\nimport * as procedures from './serialization/procedures.js';\nimport * as registry from './serialization/registry.js';\nimport * as variables from './serialization/variables.js';\nimport * as workspaces from './serialization/workspaces.js';\nimport * as workspaceComments from './serialization/workspace_comments.js';\nimport {ISerializer} from './interfaces/i_serializer.js';\n\nexport {\n  blocks,\n  exceptions,\n  priorities,\n  procedures,\n  registry,\n  variables,\n  workspaces,\n  workspaceComments,\n  ISerializer,\n};\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a pair of scrollbars.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ScrollbarPair\n\nimport * as eventUtils from './events/utils.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a pair of scrollbars.  Horizontal and vertical.\n */\nexport class ScrollbarPair {\n  hScroll: Scrollbar | null = null;\n  vScroll: Scrollbar | null = null;\n  corner_: SVGRectElement | null = null;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics_: Metrics | null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbars to.\n   * @param addHorizontal Whether to add a horizontal scrollbar.\n   *    Defaults to true.\n   * @param addVertical Whether to add a vertical scrollbar. Defaults to true.\n   * @param opt_class A class to be applied to these scrollbars.\n   * @param opt_margin The margin to apply to these scrollbars.\n   */\n  constructor(\n    private workspace: WorkspaceSvg,\n    addHorizontal?: boolean,\n    addVertical?: boolean,\n    opt_class?: string,\n    opt_margin?: number,\n  ) {\n    addHorizontal = addHorizontal === undefined ? true : addHorizontal;\n    addVertical = addVertical === undefined ? true : addVertical;\n    const isPair = addHorizontal && addVertical;\n\n    if (addHorizontal) {\n      this.hScroll = new Scrollbar(\n        workspace,\n        true,\n        isPair,\n        opt_class,\n        opt_margin,\n      );\n    }\n    if (addVertical) {\n      this.vScroll = new Scrollbar(\n        workspace,\n        false,\n        isPair,\n        opt_class,\n        opt_margin,\n      );\n    }\n\n    if (isPair) {\n      this.corner_ = dom.createSvgElement(Svg.RECT, {\n        'height': Scrollbar.scrollbarThickness,\n        'width': Scrollbar.scrollbarThickness,\n        'class': 'blocklyScrollbarBackground',\n      });\n      dom.insertAfter(this.corner_, workspace.getBubbleCanvas());\n    }\n  }\n\n  /**\n   * Dispose of this pair of scrollbars.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    dom.removeNode(this.corner_);\n    this.corner_ = null;\n    this.oldHostMetrics_ = null;\n    if (this.hScroll) {\n      this.hScroll.dispose();\n      this.hScroll = null;\n    }\n    if (this.vScroll) {\n      this.vScroll.dispose();\n      this.vScroll = null;\n    }\n  }\n\n  /**\n   * Recalculate both of the scrollbars' locations and lengths.\n   * Also reposition the corner rectangle.\n   */\n  resize() {\n    // Look up the host metrics once, and use for both scrollbars.\n    const hostMetrics = this.workspace.getMetrics();\n    if (!hostMetrics) {\n      // Host element is likely not visible.\n      return;\n    }\n\n    // Only change the scrollbars if there has been a change in metrics.\n    let resizeH = false;\n    let resizeV = false;\n    if (\n      !this.oldHostMetrics_ ||\n      this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n      this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n      this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop ||\n      this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft\n    ) {\n      // The window has been resized or repositioned.\n      resizeH = true;\n      resizeV = true;\n    } else {\n      // Has the content been resized or moved?\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.scrollWidth !== hostMetrics.scrollWidth ||\n        this.oldHostMetrics_.viewLeft !== hostMetrics.viewLeft ||\n        this.oldHostMetrics_.scrollLeft !== hostMetrics.scrollLeft\n      ) {\n        resizeH = true;\n      }\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.scrollHeight !== hostMetrics.scrollHeight ||\n        this.oldHostMetrics_.viewTop !== hostMetrics.viewTop ||\n        this.oldHostMetrics_.scrollTop !== hostMetrics.scrollTop\n      ) {\n        resizeV = true;\n      }\n    }\n\n    if (resizeH || resizeV) {\n      try {\n        eventUtils.disable();\n        if (this.hScroll && resizeH) {\n          this.hScroll.resize(hostMetrics);\n        }\n        if (this.vScroll && resizeV) {\n          this.vScroll.resize(hostMetrics);\n        }\n      } finally {\n        eventUtils.enable();\n      }\n      this.workspace.maybeFireViewportChangeEvent();\n    }\n\n    if (this.hScroll && this.vScroll) {\n      // Reposition the corner square.\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft\n      ) {\n        this.corner_?.setAttribute('x', String(this.vScroll.position.x));\n      }\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop\n      ) {\n        this.corner_?.setAttribute('y', String(this.hScroll.position.y));\n      }\n    }\n\n    // Cache the current metrics to potentially short-cut the next resize event.\n    this.oldHostMetrics_ = hostMetrics;\n  }\n\n  /**\n   * Returns whether scrolling horizontally is enabled.\n   *\n   * @returns True if horizontal scroll is enabled.\n   */\n  canScrollHorizontally(): boolean {\n    return !!this.hScroll;\n  }\n\n  /**\n   * Returns whether scrolling vertically is enabled.\n   *\n   * @returns True if vertical scroll is enabled.\n   */\n  canScrollVertically(): boolean {\n    return !!this.vScroll;\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   * @internal\n   */\n  setOrigin(x: number, y: number) {\n    if (this.hScroll) {\n      this.hScroll.setOrigin(x, y);\n    }\n    if (this.vScroll) {\n      this.vScroll.setOrigin(x, y);\n    }\n  }\n\n  /**\n   * Set the handles of both scrollbars.\n   *\n   * @param x The horizontal content displacement, relative to the view in\n   *     pixels.\n   * @param y The vertical content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(x: number, y: number, updateMetrics: boolean) {\n    // This function is equivalent to:\n    //   this.hScroll.set(x);\n    //   this.vScroll.set(y);\n    // However, that calls setMetrics twice which causes a chain of\n    // getAttribute->setAttribute->getAttribute resulting in an extra layout\n    // pass. Combining them speeds up rendering.\n    if (this.hScroll) {\n      this.hScroll.set(x, false);\n    }\n    if (this.vScroll) {\n      this.vScroll.set(y, false);\n    }\n\n    if (updateMetrics || updateMetrics === undefined) {\n      // Update metrics.\n      const xyRatio: {x?: number; y?: number} = {};\n      if (this.hScroll) {\n        xyRatio.x = this.hScroll.getRatio_();\n      }\n      if (this.vScroll) {\n        xyRatio.y = this.vScroll.getRatio_();\n      }\n      this.workspace.setMetrics(xyRatio);\n    }\n  }\n\n  /**\n   * Set the handle of the horizontal scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param x Horizontal scroll value.\n   */\n  setX(x: number) {\n    if (this.hScroll) {\n      this.hScroll.set(x, true);\n    }\n  }\n\n  /**\n   * Set the handle of the vertical scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param y Vertical scroll value.\n   */\n  setY(y: number) {\n    if (this.vScroll) {\n      this.vScroll.set(y, true);\n    }\n  }\n\n  /**\n   * Set whether this scrollbar's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    if (this.hScroll) {\n      this.hScroll.setContainerVisible(visible);\n    }\n    if (this.vScroll) {\n      this.vScroll.setContainerVisible(visible);\n    }\n  }\n\n  /**\n   * If any of the scrollbars are visible. Non-paired scrollbars may disappear\n   * when they aren't needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    let isVisible = false;\n    if (this.hScroll) {\n      isVisible = this.hScroll.isVisible();\n    }\n    if (this.vScroll) {\n      isVisible = isVisible || this.vScroll.isVisible();\n    }\n    return isVisible;\n  }\n\n  /**\n   * Sets the visibility of any existing scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    if (this.hScroll) this.hScroll.setVisibleInternal(visible);\n    if (this.vScroll) this.vScroll.setVisibleInternal(visible);\n  }\n\n  /**\n   * Recalculates the scrollbars' locations within their path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContent(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeContentHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculates the scrollbars' locations on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeView(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeViewHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeViewVertical(hostMetrics);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports workspace metrics.\n *\n * @class\n */\n// Former goog.module ID: Blockly.MetricsManager\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport * as registry from './registry.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Size} from './utils/size.js';\nimport * as toolboxUtils from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * The manager for all workspace metrics calculations.\n */\nexport class MetricsManager implements IMetricsManager {\n  /** The workspace to calculate metrics for. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace to calculate metrics for. */\n  constructor(workspace: WorkspaceSvg) {\n    this.workspace_ = workspace;\n  }\n\n  /**\n   * Gets the dimensions of the given workspace component, in pixel coordinates.\n   *\n   * @param elem The element to get the dimensions of, or null.  It should be a\n   *     toolbox or flyout, and should implement getWidth() and getHeight().\n   * @returns An object containing width and height attributes, which will both\n   *     be zero if elem did not exist.\n   */\n  protected getDimensionsPx_(elem: IToolbox | null | IFlyout): Size {\n    let width = 0;\n    let height = 0;\n    if (elem) {\n      width = elem.getWidth();\n      height = elem.getHeight();\n    }\n    return new Size(width, height);\n  }\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics {\n    const flyoutDimensions = this.getDimensionsPx_(\n      this.workspace_.getFlyout(opt_own),\n    );\n    return {\n      width: flyoutDimensions.width,\n      height: flyoutDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link MetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics {\n    const toolboxDimensions = this.getDimensionsPx_(\n      this.workspace_.getToolbox(),\n    );\n\n    return {\n      width: toolboxDimensions.width,\n      height: toolboxDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size {\n    return this.workspace_.getCachedParentSvgSize();\n  }\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics {\n    let absoluteLeft = 0;\n    let absoluteTop = 0;\n\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics();\n    const respectToolbox = !!this.workspace_.getToolbox();\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\n    const toolboxPosition = respectToolbox\n      ? toolboxMetrics.position\n      : flyoutMetrics.position;\n\n    const atLeft = toolboxPosition === toolboxUtils.Position.LEFT;\n    const atTop = toolboxPosition === toolboxUtils.Position.TOP;\n    if (atLeft) {\n      if (respectToolbox) absoluteLeft += toolboxMetrics.width;\n      if (respectFlyout) absoluteLeft += flyoutMetrics.width;\n    }\n    if (atTop) {\n      if (respectToolbox) absoluteTop += toolboxMetrics.height;\n      if (respectFlyout) absoluteTop += flyoutMetrics.height;\n    }\n\n    return {\n      top: absoluteTop,\n      left: absoluteLeft,\n    };\n  }\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const svgMetrics = this.getSvgMetrics();\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics();\n    const respectToolbox = !!this.workspace_.getToolbox();\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\n    const toolboxPosition = respectToolbox\n      ? toolboxMetrics.position\n      : flyoutMetrics.position;\n\n    const horizToolbox =\n      toolboxPosition === toolboxUtils.Position.TOP ||\n      toolboxPosition === toolboxUtils.Position.BOTTOM;\n    const vertToolbox =\n      toolboxPosition === toolboxUtils.Position.LEFT ||\n      toolboxPosition === toolboxUtils.Position.RIGHT;\n    if (horizToolbox) {\n      if (respectToolbox) svgMetrics.height -= toolboxMetrics.height;\n      if (respectFlyout) svgMetrics.height -= flyoutMetrics.height;\n    }\n    if (vertToolbox) {\n      if (respectToolbox) svgMetrics.width -= toolboxMetrics.width;\n      if (respectFlyout) svgMetrics.width -= flyoutMetrics.width;\n    }\n    return {\n      height: svgMetrics.height / scale,\n      width: svgMetrics.width / scale,\n      top: -this.workspace_.scrollY / scale,\n      left: -this.workspace_.scrollX / scale,\n    };\n  }\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n    // Block bounding box is in workspace coordinates.\n    const blockBox = this.workspace_.getBlocksBoundingBox();\n\n    return {\n      height: (blockBox.bottom - blockBox.top) * scale,\n      width: (blockBox.right - blockBox.left) * scale,\n      top: blockBox.top * scale,\n      left: blockBox.left * scale,\n    };\n  }\n\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean {\n    // This exists for optimization of bump logic.\n    return (\n      !this.workspace_.isMovableHorizontally() ||\n      !this.workspace_.isMovableVertically()\n    );\n  }\n\n  /**\n   * Computes the fixed edges of the scroll area.\n   *\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @returns The fixed edges of the scroll area.\n   */\n  protected getComputedFixedEdges_(\n    opt_viewMetrics?: ContainerRegion,\n  ): FixedEdges {\n    if (!this.hasFixedEdges()) {\n      // Return early if there are no edges.\n      return {};\n    }\n\n    const hScrollEnabled = this.workspace_.isMovableHorizontally();\n    const vScrollEnabled = this.workspace_.isMovableVertically();\n\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n\n    const edges = {} as FixedEdges;\n    if (!vScrollEnabled) {\n      edges.top = viewMetrics.top;\n      edges.bottom = viewMetrics.top + viewMetrics.height;\n    }\n    if (!hScrollEnabled) {\n      edges.left = viewMetrics.left;\n      edges.right = viewMetrics.left + viewMetrics.width;\n    }\n    return edges;\n  }\n\n  /**\n   * Returns the content area with added padding.\n   *\n   * @param viewMetrics The view metrics.\n   * @param contentMetrics The content metrics.\n   * @returns The padded content area.\n   */\n  protected getPaddedContent_(\n    viewMetrics: ContainerRegion,\n    contentMetrics: ContainerRegion,\n  ): {top: number; bottom: number; left: number; right: number} {\n    const contentBottom = contentMetrics.top + contentMetrics.height;\n    const contentRight = contentMetrics.left + contentMetrics.width;\n\n    const viewWidth = viewMetrics.width;\n    const viewHeight = viewMetrics.height;\n    const halfWidth = viewWidth / 2;\n    const halfHeight = viewHeight / 2;\n\n    // Add a padding around the content that is at least half a screen wide.\n    // Ensure padding is wide enough that blocks can scroll over entire screen.\n    const top = Math.min(\n      contentMetrics.top - halfHeight,\n      contentBottom - viewHeight,\n    );\n    const left = Math.min(\n      contentMetrics.left - halfWidth,\n      contentRight - viewWidth,\n    );\n    const bottom = Math.max(\n      contentBottom + halfHeight,\n      contentMetrics.top + viewHeight,\n    );\n    const right = Math.max(\n      contentRight + halfWidth,\n      contentMetrics.left + viewWidth,\n    );\n\n    return {top, bottom, left, right};\n  }\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container.\n   */\n  getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const fixedEdges = this.getComputedFixedEdges_(viewMetrics);\n\n    // Add padding around content.\n    const paddedContent = this.getPaddedContent_(viewMetrics, contentMetrics);\n\n    // Use combination of fixed bounds and padded content to make scroll area.\n    const top =\n      fixedEdges.top !== undefined ? fixedEdges.top : paddedContent.top;\n    const left =\n      fixedEdges.left !== undefined ? fixedEdges.left : paddedContent.left;\n    const bottom =\n      fixedEdges.bottom !== undefined\n        ? fixedEdges.bottom\n        : paddedContent.bottom;\n    const right =\n      fixedEdges.right !== undefined ? fixedEdges.right : paddedContent.right;\n\n    return {\n      top: top / scale,\n      left: left / scale,\n      width: (right - left) / scale,\n      height: (bottom - top) / scale,\n    };\n  }\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics {\n    return {\n      viewMetrics: this.getViewMetrics(),\n      absoluteMetrics: this.getAbsoluteMetrics(),\n      toolboxMetrics: this.getToolboxMetrics(),\n    };\n  }\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .scrollHeight: Height of the scroll area.\n   * .scrollWidth: Width of the scroll area.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .scrollTop: Top-edge of the scroll area, relative to the workspace origin.\n   * .scrollLeft: Left-edge of the scroll area relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics {\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const svgMetrics = this.getSvgMetrics();\n    const absoluteMetrics = this.getAbsoluteMetrics();\n    const viewMetrics = this.getViewMetrics();\n    const contentMetrics = this.getContentMetrics();\n    const scrollMetrics = this.getScrollMetrics(\n      false,\n      viewMetrics,\n      contentMetrics,\n    );\n\n    return {\n      contentHeight: contentMetrics.height,\n      contentWidth: contentMetrics.width,\n      contentTop: contentMetrics.top,\n      contentLeft: contentMetrics.left,\n\n      scrollHeight: scrollMetrics.height,\n      scrollWidth: scrollMetrics.width,\n      scrollTop: scrollMetrics.top,\n      scrollLeft: scrollMetrics.left,\n\n      viewHeight: viewMetrics.height,\n      viewWidth: viewMetrics.width,\n      viewTop: viewMetrics.top,\n      viewLeft: viewMetrics.left,\n\n      absoluteTop: absoluteMetrics.top,\n      absoluteLeft: absoluteMetrics.left,\n\n      svgHeight: svgMetrics.height,\n      svgWidth: svgMetrics.width,\n\n      toolboxWidth: toolboxMetrics.width,\n      toolboxHeight: toolboxMetrics.height,\n      toolboxPosition: toolboxMetrics.position,\n\n      flyoutWidth: flyoutMetrics.width,\n      flyoutHeight: flyoutMetrics.height,\n    };\n  }\n}\n\nexport namespace MetricsManager {\n  /**\n   * Describes the width, height and location of the toolbox on the main\n   * workspace.\n   */\n  export interface ToolboxMetrics {\n    width: number;\n    height: number;\n    position: toolboxUtils.Position;\n  }\n\n  /** Describes where the viewport starts in relation to the workspace SVG. */\n  export interface AbsoluteMetrics {\n    left: number;\n    top: number;\n  }\n\n  /**\n   * All the measurements needed to describe the size and location of a\n   * container.\n   */\n  export interface ContainerRegion {\n    height: number;\n    width: number;\n    top: number;\n    left: number;\n  }\n\n  /** Describes fixed edges of the workspace. */\n  export interface FixedEdges {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }\n\n  /** Common metrics used for UI elements. */\n  export interface UiMetrics {\n    viewMetrics: ContainerRegion;\n    absoluteMetrics: AbsoluteMetrics;\n    toolboxMetrics: ToolboxMetrics;\n  }\n}\n\nexport type ToolboxMetrics = MetricsManager.ToolboxMetrics;\nexport type AbsoluteMetrics = MetricsManager.AbsoluteMetrics;\nexport type ContainerRegion = MetricsManager.ContainerRegion;\nexport type FixedEdges = MetricsManager.FixedEdges;\nexport type UiMetrics = MetricsManager.UiMetrics;\n\nregistry.register(\n  registry.Type.METRICS_MANAGER,\n  registry.DEFAULT,\n  MetricsManager,\n);\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file The entrypoint for blockly_compressed.js.  Provides various\n * backwards-compatibility hacks.  Not used when loading in\n * uncompressed mode.\n */\n\n// Former goog.module ID: Blockly.main\n\nimport * as Msg from './msg.js';\n\n// If Blockly is compiled with ADVANCED_COMPILATION and/or loaded as a\n// CJS or ES module there will not be a Blockly global variable\n// created.  This can cause problems because a very common way of\n// loading translations is to use a <script> tag to load one of\n// the generated msg/*.js files, which consists of lines like:\n//\n// Blockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\n// Blockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\n//\n// This obviously only works if Blockly.Msg is the Msg export from the\n// Blockly.Msg module - so make sure it is, but only if there is not\n// yet a Blockly global variable.\nif (!('Blockly' in globalThis)) {\n  (globalThis as any)['Blockly'] = {'Msg': Msg};\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.ConstantProvider\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Theme} from '../../theme.js';\nimport * as utilsColour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport type {Shape} from '../common/constants.js';\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n  rightWidth: number;\n  rightHeight: number;\n  pathTopRight: string;\n  pathBottomRight: string;\n}\n\n/**\n * An object that provides constants for rendering blocks in Zelos mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  GRID_UNIT = 4;\n  STATEMENT_INPUT_SPACER_MIN_WIDTH: number;\n\n  override CURSOR_COLOUR = '#ffa200';\n\n  /**\n   * Radius of the cursor for input and output connections.\n   */\n  CURSOR_RADIUS = 5;\n\n  override JAGGED_TEETH_HEIGHT = 0;\n\n  override JAGGED_TEETH_WIDTH = 0;\n  override START_HAT_HEIGHT = 22;\n\n  override START_HAT_WIDTH = 96;\n\n  override SHAPES = {HEXAGONAL: 1, ROUND: 2, SQUARE: 3, PUZZLE: 4, NOTCH: 5};\n\n  /**\n   * Map of output/input shapes and the amount they should cause a block to be\n   * padded. Outer key is the outer shape, inner key is the inner shape.\n   * When a block with the outer shape contains an input block with the inner\n   * shape on its left or right edge, the block elements are aligned such that\n   * the padding specified is reached.\n   */\n  SHAPE_IN_SHAPE_PADDING: {[key: number]: {[key: number]: number}} = {\n    1: {\n      // Outer shape: hexagon.\n      0: 5 * this.GRID_UNIT, // Field in hexagon.\n      1: 2 * this.GRID_UNIT, // Hexagon in hexagon.\n      2: 5 * this.GRID_UNIT, // Round in hexagon.\n      3: 5 * this.GRID_UNIT, // Square in hexagon.\n    },\n    2: {\n      // Outer shape: round.\n      0: 3 * this.GRID_UNIT, // Field in round.\n      1: 3 * this.GRID_UNIT, // Hexagon in round.\n      2: 1 * this.GRID_UNIT, // Round in round.\n      3: 2 * this.GRID_UNIT, // Square in round.\n    },\n    3: {\n      // Outer shape: square.\n      0: 2 * this.GRID_UNIT, // Field in square.\n      1: 2 * this.GRID_UNIT, // Hexagon in square.\n      2: 2 * this.GRID_UNIT, // Round in square.\n      3: 2 * this.GRID_UNIT, // Square in square.\n    },\n  };\n\n  override FULL_BLOCK_FIELDS = true;\n\n  override FIELD_TEXT_FONTWEIGHT = 'bold';\n\n  override FIELD_TEXT_FONTFAMILY =\n    '\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';\n\n  override FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = true;\n\n  override FIELD_DROPDOWN_COLOURED_DIV = true;\n\n  override FIELD_DROPDOWN_SVG_ARROW = true;\n  override FIELD_TEXTINPUT_BOX_SHADOW = true;\n\n  override FIELD_COLOUR_FULL_BLOCK = true;\n  MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH: number;\n\n  /** The selected glow colour. */\n  SELECTED_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  SELECTED_GLOW_SIZE = 0.5;\n\n  /** The replacement glow colour. */\n  REPLACEMENT_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  REPLACEMENT_GLOW_SIZE = 2;\n\n  /**\n   * The ID of the selected glow filter, or the empty string if no filter is\n   * set.\n   */\n  selectedGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a selected glow, or null if not set.\n   */\n  private selectedGlowFilter: SVGElement | null = null;\n\n  /**\n   * The ID of the replacement glow filter, or the empty string if no filter\n   * is set.\n   */\n  replacementGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a replacement glow, or null if not set.\n   */\n  private replacementGlowFilter: SVGElement | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a boolean\n   * reporter block. Null before init is called.\n   */\n  HEXAGONAL: Shape | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a number or\n   * string reporter block. Null before init is called.\n   */\n  ROUNDED: Shape | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a\n   * rectangular reporter block. Null before init is called.\n   */\n  SQUARED: Shape | null = null;\n\n  constructor() {\n    super();\n\n    this.SMALL_PADDING = this.GRID_UNIT;\n\n    this.MEDIUM_PADDING = 2 * this.GRID_UNIT;\n\n    this.MEDIUM_LARGE_PADDING = 3 * this.GRID_UNIT;\n\n    this.LARGE_PADDING = 4 * this.GRID_UNIT;\n\n    this.CORNER_RADIUS = 1 * this.GRID_UNIT;\n\n    this.NOTCH_WIDTH = 9 * this.GRID_UNIT;\n\n    this.NOTCH_HEIGHT = 2 * this.GRID_UNIT;\n\n    this.NOTCH_OFFSET_LEFT = 3 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    this.MIN_BLOCK_WIDTH = 2 * this.GRID_UNIT;\n\n    this.MIN_BLOCK_HEIGHT = 12 * this.GRID_UNIT;\n\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.TOP_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    this.BOTTOM_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT;\n\n    /** Minimum statement input spacer width. */\n    this.STATEMENT_INPUT_SPACER_MIN_WIDTH = 40 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_PADDING_LEFT = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_PADDING = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_MIN_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.CURSOR_WS_WIDTH = 20 * this.GRID_UNIT;\n\n    this.FIELD_TEXT_FONTSIZE = 3 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_RADIUS = this.CORNER_RADIUS;\n\n    this.FIELD_BORDER_RECT_X_PADDING = 2 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_Y_PADDING = 1.625 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    this.FIELD_COLOUR_DEFAULT_WIDTH = 6 * this.GRID_UNIT;\n\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_CHECKBOX_X_OFFSET = 1 * this.GRID_UNIT;\n\n    /** The maximum width of a dynamic connection shape. */\n    this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH = 12 * this.GRID_UNIT;\n  }\n\n  override setFontConstants_(theme: Theme) {\n    super.setFontConstants_(theme);\n\n    this.FIELD_BORDER_RECT_HEIGHT =\n      this.FIELD_TEXT_HEIGHT + this.FIELD_BORDER_RECT_Y_PADDING * 2;\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n  }\n\n  override init() {\n    super.init();\n    this.HEXAGONAL = this.makeHexagonal();\n    this.ROUNDED = this.makeRounded();\n    this.SQUARED = this.makeSquared();\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET =\n      this.NOTCH_OFFSET_LEFT +\n      (this.INSIDE_CORNERS as InsideCorners).rightWidth;\n  }\n\n  override setDynamicProperties_(theme: Theme) {\n    super.setDynamicProperties_(theme);\n\n    this.SELECTED_GLOW_COLOUR =\n      theme.getComponentStyle('selectedGlowColour') ||\n      this.SELECTED_GLOW_COLOUR;\n    const selectedGlowSize = Number(\n      theme.getComponentStyle('selectedGlowSize'),\n    );\n    this.SELECTED_GLOW_SIZE =\n      selectedGlowSize && !isNaN(selectedGlowSize)\n        ? selectedGlowSize\n        : this.SELECTED_GLOW_SIZE;\n    this.REPLACEMENT_GLOW_COLOUR =\n      theme.getComponentStyle('replacementGlowColour') ||\n      this.REPLACEMENT_GLOW_COLOUR;\n    const replacementGlowSize = Number(\n      theme.getComponentStyle('replacementGlowSize'),\n    );\n    this.REPLACEMENT_GLOW_SIZE =\n      replacementGlowSize && !isNaN(replacementGlowSize)\n        ? replacementGlowSize\n        : this.REPLACEMENT_GLOW_SIZE;\n  }\n\n  override dispose() {\n    super.dispose();\n    if (this.selectedGlowFilter) {\n      dom.removeNode(this.selectedGlowFilter);\n    }\n    if (this.replacementGlowFilter) {\n      dom.removeNode(this.replacementGlowFilter);\n    }\n  }\n\n  override makeStartHat() {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(25, -height),\n      svgPaths.point(71, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * Create sizing and path information about a hexagonal shape.\n   *\n   * @returns An object containing sizing and path information about a hexagonal\n   *     shape for connections.\n   */\n  protected makeHexagonal(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n\n    /**\n     * Make the main path for the hexagonal connection shape out of two lines.\n     * The lines are defined with relative positions and require the block\n     * height. The 'up' and 'down' versions of the paths are the same, but the Y\n     * sign flips.  The 'left' and 'right' versions of the path are also the\n     * same, but the X sign flips.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const halfHeight = height / 2;\n      const width = halfHeight > maxWidth ? maxWidth : halfHeight;\n      const forward = up ? -1 : 1;\n      const direction = right ? -1 : 1;\n      const dy = (forward * height) / 2;\n      return (\n        svgPaths.lineTo(-direction * width, dy) +\n        svgPaths.lineTo(direction * width, dy)\n      );\n    }\n\n    return {\n      type: this.SHAPES.HEXAGONAL,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a rounded shape.\n   *\n   * @returns An object containing sizing and path information about a rounded\n   *     shape for connections.\n   */\n  protected makeRounded(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n    const maxHeight = maxWidth * 2;\n\n    /**\n     * Make the main path for the rounded connection shape out of two arcs and\n     * a line that joins them.  The arcs are defined with relative positions.\n     * Usually, the height of the block is split between the two arcs. In the\n     * case where the height of the block exceeds the maximum height, a line is\n     * drawn in between the two arcs. The 'up' and 'down' versions of the paths\n     * are the same, but the Y sign flips.  The 'up' and 'right' versions of the\n     * path flip the sweep-flag which moves the arc at negative angles.\n     *\n     * @param blockHeight The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(\n      blockHeight: number,\n      up: boolean,\n      right: boolean,\n    ): string {\n      const remainingHeight =\n        blockHeight > maxHeight ? blockHeight - maxHeight : 0;\n      const height = blockHeight > maxHeight ? maxHeight : blockHeight;\n      const radius = height / 2;\n      const sweep = right === up ? '0' : '1';\n      return (\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? 1 : -1) * radius, (up ? -1 : 1) * radius),\n        ) +\n        svgPaths.lineOnAxis('v', (up ? -1 : 1) * remainingHeight) +\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? -1 : 1) * radius, (up ? -1 : 1) * radius),\n        )\n      );\n    }\n\n    return {\n      type: this.SHAPES.ROUND,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a squared shape.\n   *\n   * @returns An object containing sizing and path information about a squared\n   *     shape for connections.\n   */\n  protected makeSquared(): Shape {\n    const radius = this.CORNER_RADIUS;\n\n    /**\n     * Make the main path for the squared connection shape out of two corners\n     * and a single line in-between (a and v). These are defined in relative\n     * positions and require the height of the block.\n     * The 'left' and 'right' versions of the paths are the same, but the Y sign\n     * flips.  The 'up' and 'down' versions of the path determine where the\n     * corner point is placed and in turn the direction of the corners.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a squared connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const innerHeight = height - radius * 2;\n      const sweep = right === up ? '0' : '1';\n      return (\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? 1 : -1) * radius, (up ? -1 : 1) * radius),\n        ) +\n        svgPaths.lineOnAxis('v', (up ? -1 : 1) * innerHeight) +\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? -1 : 1) * radius, (up ? -1 : 1) * radius),\n        )\n      );\n    }\n\n    return {\n      type: this.SHAPES.SQUARE,\n      isDynamic: true,\n      width(_height: number): number {\n        return radius;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  override shapeFor(connection: RenderedConnection): Shape {\n    let checks = connection.getCheck();\n    if (!checks && connection.targetConnection) {\n      checks = connection.targetConnection.getCheck();\n    }\n    let outputShape;\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        outputShape = connection.getSourceBlock().getOutputShape();\n        // If the block has an output shape set, use that instead.\n        if (outputShape !== null) {\n          switch (outputShape) {\n            case this.SHAPES.HEXAGONAL:\n              return this.HEXAGONAL!;\n            case this.SHAPES.ROUND:\n              return this.ROUNDED!;\n            case this.SHAPES.SQUARE:\n              return this.SQUARED!;\n          }\n        }\n        // Includes doesn't work in IE.\n        if (checks && checks.includes('Boolean')) {\n          return this.HEXAGONAL!;\n        }\n        if (checks && checks.includes('Number')) {\n          return this.ROUNDED!;\n        }\n        if (checks && checks.includes('String')) {\n          return this.ROUNDED!;\n        }\n        return this.ROUNDED!;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH!;\n      default:\n        throw Error('Unknown type');\n    }\n  }\n\n  override makeNotch() {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n\n    const innerWidth = width / 3;\n    const curveWidth = innerWidth / 3;\n\n    const halfHeight = height / 2;\n    const quarterHeight = halfHeight / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return (\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 2, 0),\n          svgPaths.point((dir * curveWidth * 3) / 4, quarterHeight / 2),\n          svgPaths.point(dir * curveWidth, quarterHeight),\n        ]) +\n        svgPaths.line([svgPaths.point(dir * curveWidth, halfHeight)]) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 4, quarterHeight / 2),\n          svgPaths.point((dir * curveWidth) / 2, quarterHeight),\n          svgPaths.point(dir * curveWidth, quarterHeight),\n        ]) +\n        svgPaths.lineOnAxis('h', dir * innerWidth) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 2, 0),\n          svgPaths.point((dir * curveWidth * 3) / 4, -(quarterHeight / 2)),\n          svgPaths.point(dir * curveWidth, -quarterHeight),\n        ]) +\n        svgPaths.line([svgPaths.point(dir * curveWidth, -halfHeight)]) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 4, -(quarterHeight / 2)),\n          svgPaths.point((dir * curveWidth) / 2, -quarterHeight),\n          svgPaths.point(dir * curveWidth, -quarterHeight),\n        ])\n      );\n    }\n\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  override makeInsideCorners() {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerTopRightCorner = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerBottomLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    const innerBottomRightCorner = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n      rightWidth: radius,\n      rightHeight: radius,\n      pathTopRight: innerTopRightCorner,\n      pathBottomRight: innerBottomRightCorner,\n    };\n  }\n\n  override generateSecondaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.15) || colour;\n  }\n\n  override generateTertiaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.25) || colour;\n  }\n\n  override createDom(svg: SVGElement, tagName: string, selector: string) {\n    super.createDom(svg, tagName, selector);\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const selectedGlowFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {\n        'id': 'blocklySelectedGlowFilter' + this.randomIdentifier,\n        'height': '160%',\n        'width': '180%',\n        'y': '-30%',\n        'x': '-40%',\n      },\n      defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceGraphic', 'stdDeviation': this.SELECTED_GLOW_SIZE},\n      selectedGlowFilter,\n    );\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const selectedComponentTransfer = dom.createSvgElement(\n      Svg.FECOMPONENTTRANSFER,\n      {'result': 'outBlur'},\n      selectedGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEFUNCA,\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n      selectedComponentTransfer,\n    );\n    // Color the highlight\n    dom.createSvgElement(\n      Svg.FEFLOOD,\n      {\n        'flood-color': this.SELECTED_GLOW_COLOUR,\n        'flood-opacity': 1,\n        'result': 'outColor',\n      },\n      selectedGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'outColor',\n        'in2': 'outBlur',\n        'operator': 'in',\n        'result': 'outGlow',\n      },\n      selectedGlowFilter,\n    );\n    this.selectedGlowFilterId = selectedGlowFilter.id;\n    this.selectedGlowFilter = selectedGlowFilter;\n\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const replacementGlowFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {\n        'id': 'blocklyReplacementGlowFilter' + this.randomIdentifier,\n        'height': '160%',\n        'width': '180%',\n        'y': '-30%',\n        'x': '-40%',\n      },\n      defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceGraphic', 'stdDeviation': this.REPLACEMENT_GLOW_SIZE},\n      replacementGlowFilter,\n    );\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const replacementComponentTransfer = dom.createSvgElement(\n      Svg.FECOMPONENTTRANSFER,\n      {'result': 'outBlur'},\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEFUNCA,\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n      replacementComponentTransfer,\n    );\n    // Color the highlight\n    dom.createSvgElement(\n      Svg.FEFLOOD,\n      {\n        'flood-color': this.REPLACEMENT_GLOW_COLOUR,\n        'flood-opacity': 1,\n        'result': 'outColor',\n      },\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'outColor',\n        'in2': 'outBlur',\n        'operator': 'in',\n        'result': 'outGlow',\n      },\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'SourceGraphic',\n        'in2': 'outGlow',\n        'operator': 'over',\n      },\n      replacementGlowFilter,\n    );\n    this.replacementGlowFilterId = replacementGlowFilter.id;\n    this.replacementGlowFilter = replacementGlowFilter;\n  }\n\n  override getCSS_(selector: string) {\n    return [\n      /* eslint-disable indent */\n      // Text.\n      `${selector} .blocklyText,`,\n      `${selector} .blocklyFlyoutLabelText {`,\n      `font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}` +\n        `pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      `${selector} .blocklyTextInputBubble textarea {`,\n      `font-weight: normal;`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n      `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,\n      `${selector} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,\n      `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text,`,\n      `${selector} .blocklyNonEditableText>g>text,`,\n      `${selector} .blocklyEditableText>g>text {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>rect,`,\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>.blocklyPath {`,\n      `stroke: #fff;`,\n      `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `color: #575E75;`,\n      `}`,\n\n      // Dropdown field.\n      `${selector} .blocklyDropdownText {`,\n      `fill: #fff !important;`,\n      `}`,\n\n      // Widget and Dropdown Div\n      `${selector}.blocklyWidgetDiv .goog-menuitem,`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem-content {`,\n      `color: #fff;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n      `stroke: ${this.SELECTED_GLOW_COLOUR};`,\n      `}`,\n\n      // Disabled outline paths.\n      `${selector} .blocklyDisabled > .blocklyOutlinePath {`,\n      `fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n/* eslint-enable indent */\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {BaseShape, DynamicShape, Notch} from '../common/constants.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {InsideCorners} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {StatementInput} from './measurables/inputs.js';\nimport type {PathObject} from './path_object.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer extends BaseDrawer {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override info_!: RenderInfo;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n\n  override draw() {\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.beginDrawing();\n    this.drawOutline_();\n    this.drawInternals_();\n    this.updateConnectionHighlights();\n\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n    if (this.info_.outputConnection) {\n      // Store the output connection shape type for parent blocks to use during\n      // rendering.\n      pathObject.outputShapeType = this.info_.outputConnection.shape.type;\n    }\n    pathObject.endDrawing();\n  }\n\n  override drawOutline_() {\n    if (\n      this.info_.outputConnection &&\n      this.info_.outputConnection.isDynamicShape &&\n      !this.info_.hasStatementInput &&\n      !this.info_.bottomRow.hasNextConnection\n    ) {\n      this.drawFlatTop_();\n      this.drawRightDynamicConnection_();\n      this.drawFlatBottom_();\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawOutline_();\n    }\n  }\n\n  override drawLeft_() {\n    if (\n      this.info_.outputConnection &&\n      this.info_.outputConnection.isDynamicShape\n    ) {\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawLeft_();\n    }\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected override drawRightSideRow_(row: Row) {\n    if (row.height <= 0) {\n      return;\n    }\n    if (Types.isSpacer(row)) {\n      const spacerRow = row as SpacerRow;\n      const precedesStatement = spacerRow.precedesStatement;\n      const followsStatement = spacerRow.followsStatement;\n      if (precedesStatement || followsStatement) {\n        const insideCorners = this.constants_.INSIDE_CORNERS as InsideCorners;\n        const cornerHeight = insideCorners.rightHeight;\n        const remainingHeight =\n          spacerRow.height - (precedesStatement ? cornerHeight : 0);\n        const bottomRightPath = followsStatement\n          ? insideCorners.pathBottomRight\n          : '';\n        const verticalPath =\n          remainingHeight > 0\n            ? svgPaths.lineOnAxis('V', spacerRow.yPos + remainingHeight)\n            : '';\n        const topRightPath = precedesStatement\n          ? insideCorners.pathTopRight\n          : '';\n        // Put all of the partial paths together.\n        this.outlinePath_ += bottomRightPath + verticalPath + topRightPath;\n        return;\n      }\n    }\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps to draw the right side of an output with a dynamic connection.\n   */\n  protected drawRightDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n        `Cannot draw the output connection of a block that doesn't have one`,\n      );\n    }\n    this.outlinePath_ += (\n      this.info_.outputConnection.shape as DynamicShape\n    ).pathRightDown(this.info_.outputConnection.height);\n  }\n\n  /**\n   * Add steps to draw the left side of an output with a dynamic connection.\n   */\n  protected drawLeftDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n        `Cannot draw the output connection of a block that doesn't have one`,\n      );\n    }\n    this.positionOutputConnection_();\n\n    this.outlinePath_ += (\n      this.info_.outputConnection.shape as DynamicShape\n    ).pathUp(this.info_.outputConnection.height);\n\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /** Add steps to draw a flat top row. */\n  protected drawFlatTop_() {\n    const topRow = this.info_.topRow;\n    this.positionPreviousConnection_();\n\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    this.outlinePath_ += svgPaths.lineOnAxis('h', topRow.width);\n  }\n\n  /** Add steps to draw a flat bottom row. */\n  protected drawFlatBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    this.positionNextConnection_();\n\n    this.outlinePath_ += svgPaths.lineOnAxis('V', bottomRow.baseline);\n    this.outlinePath_ += svgPaths.lineOnAxis('h', -bottomRow.width);\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.positionInlineInputConnection_(input);\n\n    const inputName = input.input.name;\n    if (input.connectedBlock || this.info_.isInsertionMarker) {\n      return;\n    }\n\n    const yPos = input.centerline - input.height / 2;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    const path =\n      svgPaths.moveTo(connectionRight, yPos) + this.getInlineInputPath(input);\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setOutlinePath(inputName, path);\n  }\n\n  private getInlineInputPath(input: InlineInput) {\n    const width = input.width - input.connectionWidth * 2;\n    const height = input.height;\n\n    return (\n      svgPaths.lineOnAxis('h', width) +\n      (input.shape as DynamicShape).pathRightDown(height) +\n      svgPaths.lineOnAxis('h', -width) +\n      (input.shape as DynamicShape).pathUp(height) +\n      'z'\n    );\n  }\n\n  override drawStatementInput_(row: Row) {\n    const input = row.getLastInput() as StatementInput;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as BaseShape).width;\n\n    const insideCorners = this.constants_.INSIDE_CORNERS;\n    const innerTopLeftCorner =\n      (input.shape as Notch).pathRight +\n      svgPaths.lineOnAxis('h', -(input.notchOffset - insideCorners.width)) +\n      insideCorners.pathTop;\n\n    const innerHeight = row.height - 2 * insideCorners.height;\n\n    const innerBottomLeftCorner =\n      insideCorners.pathBottom +\n      svgPaths.lineOnAxis('h', input.notchOffset - insideCorners.width) +\n      (input.connectedBottomNextConnection\n        ? ''\n        : (input.shape as Notch).pathLeft);\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', x) +\n      innerTopLeftCorner +\n      svgPaths.lineOnAxis('v', innerHeight) +\n      innerBottomLeftCorner +\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /** Returns a path to highlight the given connection. */\n  drawConnectionHighlightPath(measurable: Connection) {\n    const conn = measurable.connectionModel;\n    if (\n      conn.type === ConnectionType.NEXT_STATEMENT ||\n      conn.type === ConnectionType.PREVIOUS_STATEMENT ||\n      (conn.type === ConnectionType.OUTPUT_VALUE && !measurable.isDynamicShape)\n    ) {\n      super.drawConnectionHighlightPath(measurable);\n      return;\n    }\n\n    let path = '';\n    if (conn.type === ConnectionType.INPUT_VALUE) {\n      const input = measurable as InlineInput;\n      const xPos = input.connectionWidth;\n      const yPos = -input.height / 2;\n      path = svgPaths.moveTo(xPos, yPos) + this.getInlineInputPath(input);\n    } else {\n      // Dynamic output.\n      const output = measurable as OutputConnection;\n      const xPos = output.width;\n      const yPos = -output.height / 2;\n      path =\n        svgPaths.moveTo(xPos, yPos) +\n        (output.shape as DynamicShape).pathDown(output.height);\n    }\n    const block = conn.getSourceBlock();\n    block.pathObject.addConnectionHighlight?.(\n      conn,\n      path,\n      conn.getOffsetInBlock(),\n      block.RTL,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Image field.  Used for pictures, icons, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldImage\n\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an image on a block.\n */\nexport class FieldImage extends Field<string> {\n  /**\n   * Vertical padding below the image, which is included in the reported height\n   * of the field.\n   */\n  private static readonly Y_PADDING = 1;\n  protected override size_: Size;\n  protected readonly imageHeight: number;\n\n  /** The function to be called when this field is clicked. */\n  private clickHandler: ((p1: FieldImage) => void) | null = null;\n\n  /** The rendered field's image element. */\n  protected imageElement: SVGImageElement | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override readonly EDITABLE = false;\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Image fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Whether to flip this image in RTL. */\n  private flipRtl = false;\n\n  /** Alt text of this image. */\n  private altText = '';\n\n  /**\n   * @param src The URL of the image.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param width Width of the image.\n   * @param height Height of the image.\n   * @param alt Optional alt text for when block is collapsed.\n   * @param onClick Optional function to be called when the image is\n   *     clicked. If onClick is defined, alt must also be defined.\n   * @param flipRtl Whether to flip the icon in RTL.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/image#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    src: string | typeof Field.SKIP_SETUP,\n    width: string | number,\n    height: string | number,\n    alt?: string,\n    onClick?: (p1: FieldImage) => void,\n    flipRtl?: boolean,\n    config?: FieldImageConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    const imageHeight = Number(parsing.replaceMessageReferences(height));\n    const imageWidth = Number(parsing.replaceMessageReferences(width));\n    if (isNaN(imageHeight) || isNaN(imageWidth)) {\n      throw Error(\n        'Height and width values of an image field must cast to' + ' numbers.',\n      );\n    }\n    if (imageHeight <= 0 || imageWidth <= 0) {\n      throw Error(\n        'Height and width values of an image field must be greater' +\n          ' than 0.',\n      );\n    }\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(imageWidth, imageHeight + FieldImage.Y_PADDING);\n\n    /**\n     * Store the image height, since it is different from the field height.\n     */\n    this.imageHeight = imageHeight;\n\n    if (typeof onClick === 'function') {\n      this.clickHandler = onClick;\n    }\n\n    if (src === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.flipRtl = !!flipRtl;\n      this.altText = parsing.replaceMessageReferences(alt) || '';\n    }\n    this.setValue(parsing.replaceMessageReferences(src));\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldImageConfig) {\n    super.configure_(config);\n    if (config.flipRtl) this.flipRtl = config.flipRtl;\n    if (config.alt) {\n      this.altText = parsing.replaceMessageReferences(config.alt);\n    }\n  }\n\n  /**\n   * Create the block UI for this image.\n   */\n  override initView() {\n    this.imageElement = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'height': this.imageHeight + 'px',\n        'width': this.size_.width + 'px',\n        'alt': this.altText,\n      },\n      this.fieldGroup_,\n    );\n    this.imageElement.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.value_ as string,\n    );\n\n    if (this.clickHandler) {\n      this.imageElement.style.cursor = 'pointer';\n    }\n  }\n\n  override updateSize_() {}\n  // NOP\n\n  /**\n   * Ensure that the input value (the source URL) is a string.\n   *\n   * @param newValue The input value.\n   * @returns A string, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): string | null {\n    if (typeof newValue !== 'string') {\n      return null;\n    }\n    return newValue;\n  }\n\n  /**\n   * Update the value of this image field, and update the displayed image.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    this.value_ = newValue;\n    if (this.imageElement) {\n      this.imageElement.setAttributeNS(dom.XLINK_NS, 'xlink:href', this.value_);\n    }\n  }\n\n  /**\n   * Get whether to flip this image in RTL\n   *\n   * @returns True if we should flip in RTL.\n   */\n  override getFlipRtl(): boolean {\n    return this.flipRtl;\n  }\n\n  /**\n   * Set the alt text of this image.\n   *\n   * @param alt New alt text.\n   */\n  setAlt(alt: string | null) {\n    if (alt === this.altText) {\n      return;\n    }\n    this.altText = alt || '';\n    if (this.imageElement) {\n      this.imageElement.setAttribute('alt', this.altText);\n    }\n  }\n\n  /**\n   * If field click is called, and click handler defined,\n   * call the handler.\n   */\n  protected override showEditor_() {\n    if (this.clickHandler) {\n      this.clickHandler(this);\n    }\n  }\n\n  /**\n   * Set the function that is called when this image  is clicked.\n   *\n   * @param func The function that is called when the image is clicked, or null\n   *     to remove.\n   */\n  setOnClickHandler(func: ((p1: FieldImage) => void) | null) {\n    this.clickHandler = func;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.\n   * Return the image alt text instead.\n   *\n   * @returns The image alt text.\n   */\n  protected override getText_(): string | null {\n    return this.altText;\n  }\n\n  /**\n   * Construct a FieldImage from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (src, width, height, alt, and\n   *     flipRtl).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldImageFromJsonConfig): FieldImage {\n    if (!options.src || !options.width || !options.height) {\n      throw new Error(\n        'src, width, and height values for an image field are' +\n          'required. The width and height must be non-zero.',\n      );\n    }\n    // `this` might be a subclass of FieldImage if that class doesn't override\n    // the static fromJson method.\n    return new this(\n      options.src,\n      options.width,\n      options.height,\n      undefined,\n      undefined,\n      undefined,\n      options,\n    );\n  }\n}\n\nfieldRegistry.register('field_image', FieldImage);\n\nFieldImage.prototype.DEFAULT_VALUE = '';\n\n/**\n * Config options for the image field.\n */\nexport interface FieldImageConfig extends FieldConfig {\n  flipRtl?: boolean;\n  alt?: string;\n}\n\n/**\n * fromJson config options for the image field.\n */\nexport interface FieldImageFromJsonConfig extends FieldImageConfig {\n  src?: string;\n  width?: number;\n  height?: number;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldInput\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {BlockSvg} from './block_svg.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dialog from './dialog.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {Size} from './utils/size.js';\n\n/**\n * Supported types for FieldInput subclasses.\n *\n * @internal\n */\ntype InputTypes = string | number;\n\n/**\n * Abstract class for an editable input field.\n *\n * @typeParam T - The value stored on the field.\n * @internal\n */\nexport abstract class FieldInput<T extends InputTypes> extends Field<\n  string | T\n> {\n  /**\n   * Pixel size of input border radius.\n   * Should match blocklyText's border-radius in CSS.\n   */\n  static BORDERRADIUS = 4;\n\n  /** Allow browser to spellcheck this field. */\n  protected spellcheck_ = true;\n\n  /** The HTML input element. */\n  protected htmlInput_: HTMLInputElement | null = null;\n\n  /** True if the field's value is currently being edited via the UI. */\n  protected isBeingEdited_ = false;\n\n  /**\n   * True if the value currently displayed in the field's editory UI is valid.\n   */\n  protected isTextValid_ = false;\n\n  /**\n   * The intial value of the field when the user opened an editor to change its\n   * value. When the editor is disposed, an event will be fired that uses this\n   * as the event's oldValue.\n   */\n  protected valueWhenEditorWasOpened_: string | T | null = null;\n\n  /** Key down event data. */\n  private onKeyDownWrapper_: browserEvents.Data | null = null;\n\n  /** Key input event data. */\n  private onKeyInputWrapper_: browserEvents.Data | null = null;\n\n  /**\n   * Whether the field should consider the whole parent block to be its click\n   * target.\n   */\n  fullBlockClickTarget_: boolean = false;\n\n  /** The workspace that this field belongs to. */\n  protected workspace_: WorkspaceSvg | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'text';\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldInputValidator<T> | null,\n    config?: FieldInputConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  protected override configure_(config: FieldInputConfig) {\n    super.configure_(config);\n    if (config.spellcheck !== undefined) {\n      this.spellcheck_ = config.spellcheck;\n    }\n  }\n\n  override initView() {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n    super.initView();\n\n    if (this.isFullBlockField()) {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n  }\n\n  protected override isFullBlockField(): boolean {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n\n    // Side effect for backwards compatibility.\n    this.fullBlockClickTarget_ =\n      !!this.getConstants()?.FULL_BLOCK_FIELDS && block.isSimpleReporter();\n    return this.fullBlockClickTarget_;\n  }\n\n  /**\n   * Called by setValue if the text input is not valid. If the field is\n   * currently being edited it reverts value of the field to the previous\n   * value while allowing the display text to be handled by the htmlInput_.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   *     This is not used by the text input because its display value is stored\n   *     on the htmlInput_.\n   * @param fireChangeEvent Whether to fire a change event if the value changes.\n   */\n  protected override doValueInvalid_(\n    _invalidValue: AnyDuringMigration,\n    fireChangeEvent: boolean = true,\n  ) {\n    if (this.isBeingEdited_) {\n      this.isDirty_ = true;\n      this.isTextValid_ = false;\n      const oldValue = this.value_;\n      // Revert value when the text becomes invalid.\n      this.value_ = this.valueWhenEditorWasOpened_;\n      if (\n        this.sourceBlock_ &&\n        eventUtils.isEnabled() &&\n        this.value_ !== oldValue &&\n        fireChangeEvent\n      ) {\n        eventUtils.fire(\n          new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n            this.sourceBlock_,\n            'field',\n            this.name || null,\n            oldValue,\n            this.value_,\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_).\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string | T) {\n    this.isDirty_ = true;\n    this.isTextValid_ = true;\n    this.value_ = newValue;\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   */\n  override applyColour() {\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n\n    if (!this.getConstants()!.FULL_BLOCK_FIELDS) return;\n    if (!this.fieldGroup_) return;\n\n    if (!this.isFullBlockField() && this.borderRect_) {\n      this.borderRect_!.style.display = 'block';\n      this.borderRect_.setAttribute('stroke', block.style.colourTertiary);\n    } else {\n      this.borderRect_!.style.display = 'none';\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      block.pathObject.svgPath.setAttribute(\n        'fill',\n        this.getConstants()!.FIELD_BORDER_RECT_COLOUR,\n      );\n    }\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  override getSize(): Size {\n    if (this.getConstants()?.FULL_BLOCK_FIELDS) {\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      // Full block fields have more control of the block than they should\n      // (i.e. updating fill colour). Whenever we get the size, the field may\n      // no longer be a full-block field, so we need to rerender.\n      this.render_();\n      this.isDirty_ = false;\n    }\n    return super.getSize();\n  }\n\n  /**\n   * Notifies the field that it has changed locations. Moves the widget div to\n   * be in the correct place if it is open.\n   */\n  onLocationChange(): void {\n    if (this.isBeingEdited_) this.resizeEditor_();\n  }\n\n  /**\n   * Updates the colour of the htmlInput given the current validity of the\n   * field's value.\n   *\n   * Also updates the colour of the block to reflect whether this is a full\n   * block field or not.\n   */\n  protected override render_() {\n    super.render_();\n    // This logic is done in render_ rather than doValueInvalid_ or\n    // doValueUpdate_ so that the code is more centralized.\n    if (this.isBeingEdited_) {\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n    // In general, do *not* let fields control the color of blocks. Having the\n    // field control the color is unexpected, and could have performance\n    // impacts.\n    // Whenever we render, the field may no longer be a full-block-field so\n    // we need to update the colour.\n    if (this.getConstants()!.FULL_BLOCK_FIELDS) block.applyColour();\n  }\n\n  /**\n   * Set whether this field is spellchecked by the browser.\n   *\n   * @param check True if checked.\n   */\n  setSpellcheck(check: boolean) {\n    if (check === this.spellcheck_) {\n      return;\n    }\n    this.spellcheck_ = check;\n    if (this.htmlInput_) {\n      // AnyDuringMigration because:  Argument of type 'boolean' is not\n      // assignable to parameter of type 'string'.\n      this.htmlInput_.setAttribute(\n        'spellcheck',\n        this.spellcheck_ as AnyDuringMigration,\n      );\n    }\n  }\n\n  /**\n   * Show an editor for the field.\n   * Shows the inline free-text editor on top of the text by default.\n   * Shows a prompt editor for mobile browsers if the modalInputs option is\n   * enabled.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  protected override showEditor_(_e?: Event, quietInput = false) {\n    this.workspace_ = (this.sourceBlock_ as BlockSvg).workspace;\n    if (\n      !quietInput &&\n      this.workspace_.options.modalInputs &&\n      (userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD)\n    ) {\n      this.showPromptEditor_();\n    } else {\n      this.showInlineEditor_(quietInput);\n    }\n  }\n\n  /**\n   * Create and show a text input editor that is a prompt (usually a popup).\n   * Mobile browsers may have issues with in-line textareas (focus and\n   * keyboards).\n   */\n  private showPromptEditor_() {\n    dialog.prompt(\n      Msg['CHANGE_VALUE_TITLE'],\n      this.getText(),\n      (text: string | null) => {\n        // Text is null if user pressed cancel button.\n        if (text !== null) {\n          this.setValue(this.getValueFromEditorText_(text));\n        }\n        this.onFinishEditing_(this.value_);\n      },\n    );\n  }\n\n  /**\n   * Create and show a text input editor that sits directly over the text input.\n   *\n   * @param quietInput True if editor should be created without focus.\n   */\n  private showInlineEditor_(quietInput: boolean) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    WidgetDiv.show(\n      this,\n      block.RTL,\n      this.widgetDispose_.bind(this),\n      this.workspace_,\n    );\n    this.htmlInput_ = this.widgetCreate_() as HTMLInputElement;\n    this.isBeingEdited_ = true;\n    this.valueWhenEditorWasOpened_ = this.value_;\n\n    if (!quietInput) {\n      (this.htmlInput_ as HTMLElement).focus({\n        preventScroll: true,\n      });\n      this.htmlInput_.select();\n    }\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected widgetCreate_(): HTMLInputElement | HTMLTextAreaElement {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    eventUtils.setGroup(true);\n    const div = WidgetDiv.getDiv();\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.addClass(clickTarget, 'editing');\n\n    const htmlInput = document.createElement('input');\n    htmlInput.className = 'blocklyHtmlInput';\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    htmlInput.setAttribute(\n      'spellcheck',\n      this.spellcheck_ as AnyDuringMigration,\n    );\n    const scale = this.workspace_!.getScale();\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    let borderRadius = FieldInput.BORDERRADIUS * scale + 'px';\n\n    if (this.isFullBlockField()) {\n      const bBox = this.getScaledBBox();\n\n      // Override border radius.\n      borderRadius = (bBox.bottom - bBox.top) / 2 + 'px';\n      // Pull stroke colour from the existing shadow block\n      const strokeColour = block.getParent()\n        ? (block.getParent() as BlockSvg).style.colourTertiary\n        : (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      htmlInput.style.border = 1 * scale + 'px solid ' + strokeColour;\n      div!.style.borderRadius = borderRadius;\n      div!.style.transition = 'box-shadow 0.25s ease 0s';\n      if (this.getConstants()!.FIELD_TEXTINPUT_BOX_SHADOW) {\n        div!.style.boxShadow =\n          'rgba(255, 255, 255, 0.3) 0 0 0 ' + 4 * scale + 'px';\n      }\n    }\n    htmlInput.style.borderRadius = borderRadius;\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\n\n    this.resizeEditor_();\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Closes the editor, saves the results, and disposes of any events or\n   * DOM-references belonging to the editor.\n   */\n  protected widgetDispose_() {\n    // Non-disposal related things that we do when the editor closes.\n    this.isBeingEdited_ = false;\n    this.isTextValid_ = true;\n    // Make sure the field's node matches the field's internal value.\n    this.forceRerender();\n    this.onFinishEditing_(this.value_);\n\n    if (\n      this.sourceBlock_ &&\n      eventUtils.isEnabled() &&\n      this.valueWhenEditorWasOpened_ !== null &&\n      this.valueWhenEditorWasOpened_ !== this.value_\n    ) {\n      // When closing a field input widget, fire an event indicating that the\n      // user has completed a sequence of changes. The value may have changed\n      // multiple times while the editor was open, but this will fire an event\n      // containing the value when the editor was opened as well as the new one.\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this.sourceBlock_,\n          'field',\n          this.name || null,\n          this.valueWhenEditorWasOpened_,\n          this.value_,\n        ),\n      );\n      this.valueWhenEditorWasOpened_ = null;\n    }\n\n    eventUtils.setGroup(false);\n\n    // Actual disposal.\n    this.unbindInputEvents_();\n    const style = WidgetDiv.getDiv()!.style;\n    style.width = 'auto';\n    style.height = 'auto';\n    style.fontSize = '';\n    style.transition = '';\n    style.boxShadow = '';\n    this.htmlInput_ = null;\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.removeClass(clickTarget, 'editing');\n  }\n\n  /**\n   * A callback triggered when the user is done editing the field via the UI.\n   *\n   * @param _value The new value of the field.\n   */\n  onFinishEditing_(_value: AnyDuringMigration) {}\n\n  /**\n   * Bind handlers for user input on the text input field's editor.\n   *\n   * @param htmlInput The htmlInput to which event handlers will be bound.\n   */\n  protected bindInputEvents_(htmlInput: HTMLElement) {\n    // Trap Enter without IME and Esc to hide.\n    this.onKeyDownWrapper_ = browserEvents.conditionalBind(\n      htmlInput,\n      'keydown',\n      this,\n      this.onHtmlInputKeyDown_,\n    );\n    // Resize after every input change.\n    this.onKeyInputWrapper_ = browserEvents.conditionalBind(\n      htmlInput,\n      'input',\n      this,\n      this.onHtmlInputChange_,\n    );\n  }\n\n  /** Unbind handlers for user input and workspace size changes. */\n  protected unbindInputEvents_() {\n    if (this.onKeyDownWrapper_) {\n      browserEvents.unbind(this.onKeyDownWrapper_);\n      this.onKeyDownWrapper_ = null;\n    }\n    if (this.onKeyInputWrapper_) {\n      browserEvents.unbind(this.onKeyInputWrapper_);\n      this.onKeyInputWrapper_ = null;\n    }\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected onHtmlInputKeyDown_(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      WidgetDiv.hideIfOwner(this);\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Escape') {\n      this.setValue(\n        this.htmlInput_!.getAttribute('data-untyped-default-value'),\n        false,\n      );\n      WidgetDiv.hideIfOwner(this);\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Tab') {\n      WidgetDiv.hideIfOwner(this);\n      dropDownDiv.hideWithoutAnimation();\n      (this.sourceBlock_ as BlockSvg).tab(this, !e.shiftKey);\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a change to the editor.\n   *\n   * @param _e Keyboard event.\n   */\n  private onHtmlInputChange_(_e: Event) {\n    // Intermediate value changes from user input are not confirmed until the\n    // user closes the editor, and may be numerous. Inhibit reporting these as\n    // normal block change events, and instead report them as special\n    // intermediate changes that do not get recorded in undo history.\n    const oldValue = this.value_;\n    // Change the field's value without firing the normal change event.\n    this.setValue(\n      this.getValueFromEditorText_(this.htmlInput_!.value),\n      /* fireChangeEvent= */ false,\n    );\n    if (\n      this.sourceBlock_ &&\n      eventUtils.isEnabled() &&\n      this.value_ !== oldValue\n    ) {\n      // Fire a special event indicating that the value changed but the change\n      // isn't complete yet and normal field change listeners can wait.\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE))(\n          this.sourceBlock_,\n          this.name || null,\n          oldValue,\n          this.value_,\n        ),\n      );\n    }\n  }\n\n  /**\n   * Set the HTML input value and the field's internal value. The difference\n   * between this and `setValue` is that this also updates the HTML input\n   * value whilst editing.\n   *\n   * @param newValue New value.\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\n   *     Should usually be true unless the change will be reported some other\n   *     way, e.g. an intermediate field change event.\n   */\n  protected setEditorValue_(\n    newValue: AnyDuringMigration,\n    fireChangeEvent = true,\n  ) {\n    this.isDirty_ = true;\n    if (this.isBeingEdited_) {\n      // In the case this method is passed an invalid value, we still\n      // pass it through the transformation method `getEditorText` to deal\n      // with. Otherwise, the internal field's state will be inconsistent\n      // with what's shown to the user.\n      this.htmlInput_!.value = this.getEditorText_(newValue);\n    }\n    this.setValue(newValue, fireChangeEvent);\n  }\n\n  /** Resize the editor to fit the text. */\n  protected resizeEditor_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const div = WidgetDiv.getDiv();\n    const bBox = this.getScaledBBox();\n    div!.style.width = bBox.right - bBox.left + 'px';\n    div!.style.height = bBox.bottom - bBox.top + 'px';\n\n    // In RTL mode block fields and LTR input fields the left edge moves,\n    // whereas the right edge is fixed.  Reposition the editor.\n    const x = block.RTL ? bBox.right - div!.offsetWidth : bBox.left;\n    const xy = new Coordinate(x, bBox.top);\n\n    div!.style.left = xy.x + 'px';\n    div!.style.top = xy.y + 'px';\n  }\n\n  /**\n   * Handles repositioning the WidgetDiv used for input fields when the\n   * workspace is resized. Will bump the block into the viewport and update the\n   * position of the text input if necessary.\n   *\n   * @returns True for rendered workspaces, as we never want to hide the widget\n   *     div.\n   */\n  override repositionForWindowResize(): boolean {\n    const block = this.getSourceBlock();\n    // This shouldn't be possible. We should never have a WidgetDiv if not using\n    // rendered blocks.\n    if (!(block instanceof BlockSvg)) return false;\n\n    const bumped = bumpObjects.bumpIntoBounds(\n      this.workspace_!,\n      this.workspace_!.getMetricsManager().getViewMetrics(true),\n      block,\n    );\n\n    if (!bumped) this.resizeEditor_();\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  override isTabNavigable(): boolean {\n    return true;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation. When we're currently editing, return the current HTML value\n   * instead. Otherwise, return null which tells the field to use the default\n   * behaviour (which is a string cast of the field's value).\n   *\n   * @returns The HTML value if we're editing, otherwise null.\n   */\n  protected override getText_(): string | null {\n    if (this.isBeingEdited_ && this.htmlInput_) {\n      // We are currently editing, return the HTML input value instead.\n      return this.htmlInput_.value;\n    }\n    return null;\n  }\n\n  /**\n   * Transform the provided value into a text to show in the HTML input.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getValueFromEditorText_`.\n   *\n   * @param value The value stored in this field.\n   * @returns The text to show on the HTML input.\n   */\n  protected getEditorText_(value: AnyDuringMigration): string {\n    return `${value}`;\n  }\n\n  /**\n   * Transform the text received from the HTML input into a value to store\n   * in this field.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getEditorText_`.\n   *\n   * @param text Text received from the HTML input.\n   * @returns The value to store.\n   */\n  protected getValueFromEditorText_(text: string): AnyDuringMigration {\n    return text;\n  }\n}\n\n/**\n * Config options for the input field.\n *\n * @internal\n */\nexport interface FieldInputConfig extends FieldConfig {\n  spellcheck?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n * @internal\n */\nexport type FieldInputValidator<T extends InputTypes> = FieldValidator<\n  string | T\n>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldTextInput\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {Field} from './field.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for an editable text field.\n */\nexport class FieldTextInput extends FieldInput<string> {\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldTextInputValidator | null,\n    config?: FieldTextInputConfig,\n  ) {\n    super(value, validator, config);\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Construct a FieldTextInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldTextInputFromJsonConfig,\n  ): FieldTextInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldTextInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_input', FieldTextInput);\n\nFieldTextInput.prototype.DEFAULT_VALUE = '';\n\n/**\n *  Config options for the text input field.\n */\nexport type FieldTextInputConfig = FieldInputConfig;\n\n/**\n * fromJson config options for the text input field.\n */\nexport interface FieldTextInputFromJsonConfig extends FieldTextInputConfig {\n  text?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldTextInputValidator = FieldInputValidator<string>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.BottomRow\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {BottomRow as BaseBottomRow} from '../../../renderers/measurables/bottom_row.js';\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the top row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends BaseBottomRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return (\n      !!block.outputConnection &&\n      !block.statementInputCount &&\n      !block.nextConnection\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.StatementInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  connectedBottomNextConnection = false;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n\n    if (this.connectedBlock) {\n      // Find the bottom-most connected block in the stack.\n      let block = this.connectedBlock;\n      let nextBlock;\n      while ((nextBlock = block.getNextBlock())) {\n        block = nextBlock;\n      }\n      if (!block.nextConnection) {\n        this.height = this.connectedBlockHeight;\n        this.connectedBottomNextConnection = true;\n      }\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.RightConnectionShape\n\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {Measurable} from '../../../renderers/measurables/base.js';\nimport {Types} from '../../../renderers/measurables/types.js';\n\n/**\n * An object containing information about the space a right connection shape\n * takes up during rendering.\n */\nexport class RightConnectionShape extends Measurable {\n  // Size is dynamic\n  override height = 0;\n  override width = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.getType('RIGHT_CONNECTION');\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.TopRow\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {TopRow as BaseTopRow} from '../../../renderers/measurables/top_row.js';\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends BaseTopRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    const hasHat =\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n      !block.outputConnection &&\n      !block.previousConnection;\n    return !!block.outputConnection || hasHat;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return (\n      !!block.outputConnection &&\n      !block.statementInputCount &&\n      !block.nextConnection\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {FieldImage} from '../../field_image.js';\nimport {FieldLabel} from '../../field_label.js';\nimport {FieldTextInput} from '../../field_textinput.js';\nimport {Input} from '../../inputs/input.js';\nimport {Align} from '../../inputs/align.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\nimport {ValueInput} from '../../inputs/value_input.js';\n\nimport type {ConstantProvider, InsideCorners} from './constants.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput as StatementInputMeasurable} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport type {PathObject} from './path_object.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  override topRow: TopRow;\n  override bottomRow: BottomRow;\n  override constants_: ConstantProvider;\n  override renderer_: Renderer;\n\n  override isInline = true;\n  isMultiRow: boolean;\n  hasStatementInput: boolean;\n  rightSide: RightConnectionShape | null;\n  private readonly rightAlignedDummyInputs: WeakMap<Row, Input>;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n\n    this.renderer_ = renderer;\n\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n\n    /**\n     * Whether the block should be rendered as a multi-line block, either\n     * because it's not inline or because it has been collapsed.\n     */\n    this.isMultiRow = !block.getInputsInline() || block.isCollapsed();\n\n    /**\n     * Whether or not the block has a statement input in one of its rows.\n     */\n    this.hasStatementInput = block.statementInputCount > 0;\n\n    /**\n     * An object with rendering information about the right connection shape.\n     */\n    this.rightSide = this.outputConnection\n      ? new RightConnectionShape(this.constants_)\n      : null;\n\n    /**\n     * A map of rows to right aligned dummy inputs within those rows. Used to\n     * add padding between left and right aligned inputs.\n     */\n    this.rightAlignedDummyInputs = new WeakMap();\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_ as Renderer;\n  }\n\n  override measure() {\n    // Modifying parent measure method to add `adjustXPosition_`.\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.adjustXPosition_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  override shouldStartNewRow_(currInput: Input, prevInput: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!prevInput) {\n      return false;\n    }\n    // If the previous input was an end-row input, then any following input\n    // should always be rendered on the next row.\n    if (prevInput instanceof EndRowInput) {\n      return true;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (\n      currInput instanceof StatementInput ||\n      prevInput instanceof StatementInput\n    ) {\n      return true;\n    }\n    // Value, dummy, and end-row inputs get new row if inputs are not inlined.\n    if (\n      currInput instanceof ValueInput ||\n      currInput instanceof DummyInput ||\n      currInput instanceof EndRowInput\n    ) {\n      return !this.isInline || this.isMultiRow;\n    }\n    return false;\n  }\n\n  override getDesiredRowWidth_(row: Row): number {\n    if (row.hasStatement) {\n      const rightCornerWidth =\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightWidth || 0;\n      return this.width - this.startX - rightCornerWidth;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override getInRowSpacing_(\n    prev: Measurable | null,\n    next: Measurable | null,\n  ): number {\n    if (!prev || !next) {\n      // No need for padding at the beginning or end of the row if the\n      // output shape is dynamic.\n      if (\n        this.outputConnection &&\n        this.outputConnection.isDynamicShape &&\n        !this.hasStatementInput &&\n        !this.bottomRow.hasNextConnection\n      ) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n    // Spacing between a square corner and a hat.\n    if (prev && Types.isLeftSquareCorner(prev) && next && Types.isHat(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row): number {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    const followsStatement = Types.isInputRow(prev) && prev.hasStatement;\n    const precedesStatement = Types.isInputRow(next) && next.hasStatement;\n    if (precedesStatement || followsStatement) {\n      const cornerHeight =\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight || 0;\n      const height = Math.max(this.constants_.NOTCH_HEIGHT, cornerHeight);\n      return precedesStatement && followsStatement\n        ? Math.max(height, this.constants_.DUMMY_INPUT_MIN_HEIGHT)\n        : height;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev)) {\n      const topRow = prev as TopRow;\n      if (\n        !topRow.hasPreviousConnection &&\n        (!this.outputConnection || this.hasStatementInput)\n      ) {\n        return Math.abs(\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\n        );\n      }\n      return this.constants_.NO_PADDING;\n    }\n    if (Types.isBottomRow(next)) {\n      const bottomRow = next as BottomRow;\n      if (!this.outputConnection) {\n        const topHeight =\n          Math.max(\n            this.topRow.minHeight,\n            Math.max(\n              this.constants_.NOTCH_HEIGHT,\n              this.constants_.CORNER_RADIUS,\n            ),\n          ) - this.constants_.CORNER_RADIUS;\n        return topHeight;\n      } else if (!bottomRow.hasNextConnection && this.hasStatementInput) {\n        return Math.abs(\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\n        );\n      }\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowWidth_(prev: Row, next: Row): number {\n    const width = this.width - this.startX;\n    if (\n      (Types.isInputRow(prev) && prev.hasStatement) ||\n      (Types.isInputRow(next) && next.hasStatement)\n    ) {\n      return Math.max(width, this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH);\n    }\n    return width;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable): number {\n    if (\n      row.hasStatement &&\n      !Types.isSpacer(elem) &&\n      !Types.isStatementInput(elem)\n    ) {\n      return row.yPos + this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT / 2;\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      if (\n        connectedBlock &&\n        connectedBlock.outputConnection &&\n        connectedBlock.nextConnection\n      ) {\n        return row.yPos + connectedBlock.height / 2;\n      }\n    }\n    return super.getElemCenterline_(row, elem);\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // If we have two dummy inputs on the same row, one aligned left and the\n    // other right, keep track of the right aligned dummy input so we can add\n    // padding later. An end-row input after a dummy input also counts.\n    if (\n      (input instanceof DummyInput || input instanceof EndRowInput) &&\n      activeRow.hasDummyInput &&\n      activeRow.align === Align.LEFT &&\n      input.align === Align.RIGHT\n    ) {\n      this.rightAlignedDummyInputs.set(activeRow, input);\n    } else if (input instanceof StatementInput) {\n      // Handle statements without next connections correctly.\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n\n      if (activeRow.align === null) {\n        activeRow.align = input.align;\n      }\n      return;\n    }\n    super.addInput_(input, activeRow);\n  }\n\n  override addAlignmentPadding_(row: Row, missingSpace: number) {\n    if (this.rightAlignedDummyInputs.get(row)) {\n      let alignmentDivider;\n      for (let i = 0; i < row.elements.length; i++) {\n        const elem = row.elements[i];\n        if (Types.isSpacer(elem)) {\n          alignmentDivider = elem;\n        }\n        if (\n          Types.isField(elem) &&\n          elem instanceof Field &&\n          elem.parentInput === this.rightAlignedDummyInputs.get(row)\n        ) {\n          break;\n        }\n      }\n      if (alignmentDivider) {\n        alignmentDivider.width += missingSpace;\n        row.width += missingSpace;\n        return;\n      }\n    }\n    super.addAlignmentPadding_(row, missingSpace);\n  }\n\n  /**\n   * Adjust the x position of fields to bump all non-label fields in the first\n   * row past the notch position.  This must be called before `computeBounds`\n   * is called.\n   */\n  protected adjustXPosition_() {\n    const notchTotalWidth =\n      this.constants_.NOTCH_OFFSET_LEFT + this.constants_.NOTCH_WIDTH;\n    let minXPos = notchTotalWidth;\n    // Run through every input row on the block and only apply bump logic to the\n    // first input row (if the block has prev connection) and every input row\n    // that has a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const hasPrevNotch =\n        i === 2\n          ? !!this.topRow.hasPreviousConnection\n          : !!prevSpacer.followsStatement;\n      const hasNextNotch =\n        i + 2 >= this.rows.length - 1\n          ? !!this.bottomRow.hasNextConnection\n          : !!nextSpacer.precedesStatement;\n\n      if (Types.isInputRow(row) && row.hasStatement) {\n        row.measure();\n        minXPos =\n          row.width - (row.getLastInput()?.width ?? 0) + notchTotalWidth;\n      } else if (\n        hasPrevNotch &&\n        (i === 2 || hasNextNotch) &&\n        Types.isInputRow(row) &&\n        !row.hasStatement\n      ) {\n        let xCursor = row.xPos;\n        let prevInRowSpacer = null;\n        for (let j = 0; j < row.elements.length; j++) {\n          const elem = row.elements[j];\n          if (Types.isSpacer(elem)) {\n            prevInRowSpacer = elem;\n          }\n          if (prevInRowSpacer && (Types.isField(elem) || Types.isInput(elem))) {\n            if (\n              xCursor < minXPos &&\n              !(\n                Types.isField(elem) &&\n                elem instanceof Field &&\n                (elem.field instanceof FieldLabel ||\n                  elem.field instanceof FieldImage)\n              )\n            ) {\n              const difference = minXPos - xCursor;\n              prevInRowSpacer.width += difference;\n            }\n          }\n          xCursor += elem.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Finalize the output connection info.  In particular, set the height of the\n   * output connection to match that of the block.  For the right side, add a\n   * right connection shape element and have it match the dimensions of the\n   * output connection.\n   */\n  protected finalizeOutputConnection_() {\n    // Dynamic output connections depend on the height of the block.\n    if (!this.outputConnection || !this.outputConnection.isDynamicShape) {\n      return;\n    }\n    const outputConnectionShape = this.outputConnection.shape;\n    if (\n      !('isDynamic' in outputConnectionShape && outputConnectionShape.isDynamic)\n    ) {\n      return;\n    }\n\n    let yCursor = 0;\n    // Determine the block height.\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      yCursor += row.height;\n    }\n    this.height = yCursor;\n\n    // Adjust the height of the output connection.\n    const blockHeight = this.bottomRow.hasNextConnection\n      ? this.height - this.bottomRow.descenderHeight\n      : this.height;\n    const connectionHeight = outputConnectionShape.height(blockHeight);\n    const connectionWidth = outputConnectionShape.width(blockHeight);\n\n    this.outputConnection.height = connectionHeight;\n    this.outputConnection.width = connectionWidth;\n    this.outputConnection.startX = connectionWidth;\n    this.outputConnection.connectionOffsetY =\n      outputConnectionShape.connectionOffsetY(connectionHeight);\n    this.outputConnection.connectionOffsetX =\n      outputConnectionShape.connectionOffsetX(connectionWidth);\n\n    // Add the right connection measurable.\n    // Don't add it if we have a value-to-statement or a value-to-stack block.\n    let rightConnectionWidth = 0;\n    if (!this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n      rightConnectionWidth = connectionWidth;\n      this.rightSide!.height = connectionHeight;\n      this.rightSide!.width = rightConnectionWidth;\n      this.rightSide!.centerline = connectionHeight / 2;\n      this.rightSide!.xPos = this.width + rightConnectionWidth;\n    }\n    this.startX = connectionWidth;\n    this.width += connectionWidth + rightConnectionWidth;\n    this.widthWithChildren += connectionWidth + rightConnectionWidth;\n  }\n\n  /**\n   * Finalize horizontal alignment of elements on the block.  In particular,\n   * reduce the implicit spacing created by the left and right output connection\n   * shapes by adding setting negative spacing onto the leftmost and rightmost\n   * spacers.\n   */\n  protected finalizeHorizontalAlignment_() {\n    if (\n      !this.outputConnection ||\n      this.hasStatementInput ||\n      this.bottomRow.hasNextConnection\n    ) {\n      return;\n    }\n    let totalNegativeSpacing = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (!Types.isInputRow(row)) {\n        continue;\n      }\n      const firstElem = row.elements[1];\n      const lastElem = row.elements[row.elements.length - 2];\n      let leftNegPadding = this.getNegativeSpacing_(firstElem);\n      let rightNegPadding = this.getNegativeSpacing_(lastElem);\n      totalNegativeSpacing = leftNegPadding + rightNegPadding;\n      const minBlockWidth =\n        this.constants_.MIN_BLOCK_WIDTH + this.outputConnection.width * 2;\n      if (this.width - totalNegativeSpacing < minBlockWidth) {\n        // Maintain a minimum block width, split negative spacing between left\n        // and right edge.\n        totalNegativeSpacing = this.width - minBlockWidth;\n        leftNegPadding = totalNegativeSpacing / 2;\n        rightNegPadding = totalNegativeSpacing / 2;\n      }\n      // Add a negative spacer on the start and end of the block.\n      row.elements.unshift(new InRowSpacer(this.constants_, -leftNegPadding));\n      row.elements.push(new InRowSpacer(this.constants_, -rightNegPadding));\n    }\n    if (totalNegativeSpacing) {\n      this.width -= totalNegativeSpacing;\n      this.widthWithChildren -= totalNegativeSpacing;\n      this.rightSide!.xPos -= totalNegativeSpacing;\n      for (let i = 0; i < this.rows.length; i++) {\n        const row = this.rows[i];\n        if (Types.isTopOrBottomRow(row)) {\n          row.elements[1].width -= totalNegativeSpacing;\n        }\n        row.width -= totalNegativeSpacing;\n        row.widthWithConnectedBlocks -= totalNegativeSpacing;\n      }\n    }\n  }\n\n  /**\n   * Calculate the spacing to reduce the left and right edges by based on the\n   * outer and inner connection shape.\n   *\n   * @param elem The first or last element on a block.\n   * @returns The amount of spacing to reduce the first or last spacer.\n   */\n  protected getNegativeSpacing_(elem: Measurable): number {\n    if (!elem || !this.outputConnection) {\n      return 0;\n    }\n    const connectionWidth = this.outputConnection.width;\n    const outerShape = this.outputConnection.shape.type;\n    const constants = this.constants_;\n    if (this.inputRows.length > 1) {\n      switch (outerShape) {\n        case constants.SHAPES.ROUND: {\n          // Special case for multi-row round reporter blocks.\n          const maxWidth = this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n          const width = this.height / 2 > maxWidth ? maxWidth : this.height / 2;\n          const topPadding = this.constants_.SMALL_PADDING;\n          const roundPadding =\n            width * (1 - Math.sin(Math.acos((width - topPadding) / width)));\n          return connectionWidth - roundPadding;\n        }\n        default:\n          return 0;\n      }\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      const innerShape = connectedBlock\n        ? (connectedBlock.pathObject as PathObject).outputShapeType\n        : elem.shape.type;\n      if (innerShape == null) {\n        return 0;\n      }\n      // Special case for value to stack / value to statement blocks.\n      if (\n        connectedBlock &&\n        connectedBlock.outputConnection &&\n        (connectedBlock.statementInputCount || connectedBlock.nextConnection)\n      ) {\n        return 0;\n      }\n      // Special case for hexagonal output.\n      if (\n        outerShape === constants.SHAPES.HEXAGONAL &&\n        outerShape !== innerShape\n      ) {\n        return 0;\n      }\n      return (\n        connectionWidth -\n        this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][innerShape]\n      );\n    } else if (Types.isField(elem) && elem instanceof Field) {\n      // Special case for text inputs.\n      if (\n        outerShape === constants.SHAPES.ROUND &&\n        elem.field instanceof FieldTextInput\n      ) {\n        return connectionWidth - 2.75 * constants.GRID_UNIT;\n      }\n      return (\n        connectionWidth - this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][0]\n      );\n    } else if (Types.isIcon(elem)) {\n      return this.constants_.SMALL_PADDING;\n    }\n    return 0;\n  }\n\n  /**\n   * Finalize vertical alignment of rows on a block.  In particular, reduce the\n   * implicit spacing when a non-shadow block is connected to any of an input\n   * row's inline inputs.\n   */\n  protected finalizeVerticalAlignment_() {\n    if (this.outputConnection) {\n      return;\n    }\n    // Run through every input row on the block and only apply tight nesting\n    // logic to input rows that have a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const firstRow = i === 2;\n      const hasPrevNotch = firstRow\n        ? !!this.topRow.hasPreviousConnection\n        : !!prevSpacer.followsStatement;\n      const hasNextNotch =\n        i + 2 >= this.rows.length - 1\n          ? !!this.bottomRow.hasNextConnection\n          : !!nextSpacer.precedesStatement;\n\n      if (hasPrevNotch) {\n        const elem = row.elements[1];\n        const hasSingleTextOrImageField =\n          row.elements.length === 3 &&\n          elem instanceof Field &&\n          (elem.field instanceof FieldLabel ||\n            elem.field instanceof FieldImage);\n        if (!firstRow && hasSingleTextOrImageField) {\n          // Remove some padding if we have a single image or text field.\n          prevSpacer.height -= this.constants_.SMALL_PADDING;\n          nextSpacer.height -= this.constants_.SMALL_PADDING;\n          row.height -= this.constants_.MEDIUM_PADDING;\n        } else if (!firstRow && !hasNextNotch) {\n          // Add a small padding so the notch doesn't clash with inputs/fields.\n          prevSpacer.height += this.constants_.SMALL_PADDING;\n        } else if (hasNextNotch) {\n          // Determine if the input row has non-shadow connected blocks.\n          let hasNonShadowConnectedBlocks = false;\n          const minVerticalTightNestingHeight = 40;\n          for (let j = 0; j < row.elements.length; j++) {\n            const elem = row.elements[j];\n            if (\n              elem instanceof InputConnection &&\n              Types.isInlineInput(elem) &&\n              elem.connectedBlock &&\n              !elem.connectedBlock.isShadow() &&\n              elem.connectedBlock.getHeightWidth().height >=\n                minVerticalTightNestingHeight\n            ) {\n              hasNonShadowConnectedBlocks = true;\n              break;\n            }\n          }\n          // Apply tight-nesting if we have both a prev and next notch and the\n          // block has non-shadow connected blocks.\n          if (hasNonShadowConnectedBlocks) {\n            prevSpacer.height -= this.constants_.SMALL_PADDING;\n            nextSpacer.height -= this.constants_.SMALL_PADDING;\n          }\n        }\n      }\n    }\n  }\n\n  override finalize_() {\n    this.finalizeOutputConnection_();\n    this.finalizeHorizontalAlignment_();\n    this.finalizeVerticalAlignment_();\n    super.finalize_();\n\n    if (this.rightSide) {\n      this.widthWithChildren += this.rightSide.width;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.MarkerSvg\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport {MarkerSvg as BaseMarkerSvg} from '../common/marker_svg.js';\n\nimport type {ConstantProvider as ZelosConstantProvider} from './constants.js';\n\n/**\n * Class to draw a marker.\n */\nexport class MarkerSvg extends BaseMarkerSvg {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  constants_!: ZelosConstantProvider;\n\n  private markerCircle: SVGCircleElement | null = null;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n    workspace: WorkspaceSvg,\n    constants: BaseConstantProvider,\n    marker: Marker,\n  ) {\n    super(workspace, constants, marker);\n  }\n\n  /**\n   * Position and display the marker for an input or an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithInputOutput(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const connection = curNode.getLocation() as RenderedConnection;\n    const offsetInBlock = connection.getOffsetInBlock();\n\n    this.positionCircle(offsetInBlock.x, offsetInBlock.y);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  override showWithOutput_(curNode: ASTNode) {\n    this.showWithInputOutput(curNode);\n  }\n\n  override showWithInput_(curNode: ASTNode) {\n    this.showWithInputOutput(curNode);\n  }\n\n  /**\n   * Draw a rectangle around the block.\n   *\n   * @param curNode The current node of the marker.\n   */\n  override showWithBlock_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    this.positionRect_(0, 0, heightWidth.width, heightWidth.height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position the circle we use for input and output connections.\n   *\n   * @param x The x position of the circle.\n   * @param y The y position of the circle.\n   */\n  private positionCircle(x: number, y: number) {\n    this.markerCircle?.setAttribute('cx', `${x}`);\n    this.markerCircle?.setAttribute('cy', `${y}`);\n    this.currentMarkerSvg = this.markerCircle;\n  }\n\n  override hide() {\n    super.hide();\n    if (this.markerCircle) {\n      this.markerCircle.style.display = 'none';\n    }\n  }\n\n  override createDomInternal_() {\n    /* clang-format off */\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\" repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n    /* clang-format on */\n    super.createDomInternal_();\n\n    this.markerCircle = dom.createSvgElement(\n      Svg.CIRCLE,\n      {\n        'r': this.constants_.CURSOR_RADIUS,\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n      },\n      this.markerSvg_,\n    );\n    this.hide();\n\n    // Markers and stack cursors don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerCircle!);\n    }\n\n    return this.markerSvg_!;\n  }\n\n  override applyColour_(curNode: ASTNode) {\n    super.applyColour_(curNode);\n\n    this.markerCircle?.setAttribute('fill', this.colour_);\n    this.markerCircle?.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerCircle?.firstElementChild!.setAttribute('values', values);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  /** The selected path of the block. */\n  private svgPathSelected: SVGElement | null = null;\n\n  /** The outline paths on the block. */\n  private readonly outlines = new Map<string, SVGElement>();\n\n  /**\n   * A set used to determine which outlines were used during a draw pass.  The\n   * set is initialized with a reference to all the outlines in\n   * `this.outlines`. Every time we use an outline during the draw pass, the\n   * reference is removed from this set.\n   */\n  private remainingOutlines = new Set<string>();\n\n  /**\n   * The type of block's output connection shape.  This is set when a block\n   * with an output connection is drawn.\n   */\n  outputShapeType: number | null = null;\n\n  public override constants: ConstantProvider;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    constants: ConstantProvider,\n  ) {\n    super(root, style, constants);\n\n    this.constants = constants;\n  }\n\n  override setPath(pathString: string) {\n    super.setPath(pathString);\n    if (this.svgPathSelected) {\n      this.svgPathSelected.setAttribute('d', pathString);\n    }\n  }\n\n  override applyColour(block: BlockSvg) {\n    super.applyColour(block);\n    // Set shadow stroke colour.\n    const parent = block.getParent();\n    if (block.isShadow() && parent) {\n      this.svgPath.setAttribute('stroke', parent.style.colourTertiary);\n    }\n\n    // Apply colour to outlines.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('fill', this.style.colourTertiary);\n    }\n  }\n\n  override flipRTL() {\n    super.flipRTL();\n    // Mirror each input outline path.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('transform', 'scale(-1 1)');\n    }\n  }\n\n  override updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n    if (enable) {\n      if (!this.svgPathSelected) {\n        this.svgPathSelected = this.svgPath.cloneNode(true) as SVGElement;\n        this.svgPathSelected.setAttribute('fill', 'none');\n        this.svgPathSelected.setAttribute(\n          'filter',\n          'url(#' + this.constants.selectedGlowFilterId + ')',\n        );\n        this.svgRoot.appendChild(this.svgPathSelected);\n      }\n    } else {\n      if (this.svgPathSelected) {\n        this.svgRoot.removeChild(this.svgPathSelected);\n        this.svgPathSelected = null;\n      }\n    }\n  }\n\n  override updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n    if (enable) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.replacementGlowFilterId + ')',\n      );\n    } else {\n      this.svgPath.removeAttribute('filter');\n    }\n  }\n\n  override updateShapeForInputHighlight(conn: Connection, enable: boolean) {\n    const name = conn.getParentInput()!.name;\n    const outlinePath = this.getOutlinePath(name);\n    if (!outlinePath) {\n      return;\n    }\n    if (enable) {\n      outlinePath.setAttribute(\n        'filter',\n        'url(#' + this.constants.replacementGlowFilterId + ')',\n      );\n    } else {\n      outlinePath.removeAttribute('filter');\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is about to draw the block.\n   */\n  beginDrawing() {\n    this.remainingOutlines.clear();\n    for (const key of this.outlines.keys()) {\n      this.remainingOutlines.add(key);\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is done drawing.\n   */\n  endDrawing() {\n    // Go through all remaining outlines that were not used this draw pass, and\n    // remove them.\n    if (this.remainingOutlines.size) {\n      for (const key of this.remainingOutlines) {\n        this.removeOutlinePath(key);\n      }\n    }\n    this.remainingOutlines.clear();\n  }\n\n  /**\n   * Set the path generated by the renderer for an outline path on the\n   * respective outline path SVG element.\n   *\n   * @param name The input name.\n   * @param pathString The path.\n   */\n  setOutlinePath(name: string, pathString: string) {\n    const outline = this.getOutlinePath(name);\n    outline.setAttribute('d', pathString);\n    outline.setAttribute('fill', this.style.colourTertiary);\n  }\n\n  /**\n   * Create's an outline path for the specified input.\n   *\n   * @param name The input name.\n   * @returns The SVG outline path.\n   */\n  private getOutlinePath(name: string): SVGElement {\n    if (!this.outlines.has(name)) {\n      this.outlines.set(\n        name,\n        dom.createSvgElement(\n          Svg.PATH,\n          {\n            'class': 'blocklyOutlinePath', // IE doesn't like paths without the\n            // data definition, set empty\n            // default\n            'd': '',\n          },\n          this.svgRoot,\n        ),\n      );\n    }\n    this.remainingOutlines.delete(name);\n    return this.outlines.get(name)!;\n  }\n\n  /**\n   * Remove an outline path that is associated with the specified input.\n   *\n   * @param name The input name.\n   */\n  private removeOutlinePath(name: string) {\n    this.outlines.get(name)?.parentNode?.removeChild(this.outlines.get(name)!);\n    this.outlines.delete(name);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager} from '../../insertion_marker_manager.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\n/**\n * The zelos renderer. This renderer emulates Scratch-style and MakeCode-style\n * rendering.\n *\n * Zelos is the ancient Greek spirit of rivalry and emulation.\n */\nexport class Renderer extends BaseRenderer {\n  protected override constants_!: ConstantProvider;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n\n  /**\n   * Create a new instance of the renderer's cursor drawer.\n   *\n   * @param workspace The workspace the cursor belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  override makeMarkerDrawer(\n    workspace: WorkspaceSvg,\n    marker: Marker,\n  ): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  override getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * @deprecated v10 - This function is no longer respected. A custom\n   *    IConnectionPreviewer may be able to fulfill the functionality.\n   */\n  override getConnectionPreviewMethod(\n    closest: RenderedConnection,\n    local: RenderedConnection,\n    topBlock: BlockSvg,\n  ) {\n    deprecation.warn(\n      'getConnectionPreviewMethod',\n      'v10',\n      'v12',\n      'an IConnectionPreviewer, if it fulfills your use case.',\n    );\n    if (local.type === ConnectionType.OUTPUT_VALUE) {\n      if (!closest.isConnected()) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE;\n      }\n      // TODO: Returning this is a total hack, because we don't want to show\n      //   a replacement fade, we want to show an outline affect.\n      //   Sadly zelos does not support showing an outline around filled\n      //   inputs, so we have to pretend like the connected block is getting\n      //   replaced.\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return super.getConnectionPreviewMethod(closest, local, topBlock);\n  }\n}\n\nblockRendering.register('zelos', Renderer);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from './block_svg.js';\nimport {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as eventUtils from './events/utils.js';\nimport * as renderManagement from './render_management.js';\nimport * as registry from './registry.js';\nimport {Renderer as ZelosRenderer} from './renderers/zelos/renderer.js';\nimport {ConnectionType} from './connection_type.js';\n\nexport class InsertionMarkerPreviewer implements IConnectionPreviewer {\n  private readonly workspace: WorkspaceSvg;\n\n  private fadedBlock: BlockSvg | null = null;\n\n  private markerConn: RenderedConnection | null = null;\n\n  private draggedConn: RenderedConnection | null = null;\n\n  private staticConn: RenderedConnection | null = null;\n\n  constructor(draggedBlock: BlockSvg) {\n    this.workspace = draggedBlock.workspace;\n  }\n\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, replacing the replacedBlock (currently connected to the\n   * staticCon).\n   *\n   * @param draggedConn The connection on the block stack being dragged.\n   * @param staticConn The connection not being dragged that we are\n   *     connecting to.\n   * @param replacedBlock The block currently connected to the staticCon that\n   *     is being replaced.\n   */\n  previewReplacement(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n    replacedBlock: BlockSvg,\n  ) {\n    eventUtils.disable();\n    try {\n      this.hidePreview();\n      this.fadedBlock = replacedBlock;\n      replacedBlock.fadeForReplacement(true);\n      if (this.workspace.getRenderer().shouldHighlightConnection(staticConn)) {\n        staticConn.highlight();\n        this.staticConn = staticConn;\n      }\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, and no block is being relaced.\n   *\n   * @param draggedConn The connection on the block stack being dragged.\n   * @param staticConn The connection not being dragged that we are\n   *     connecting to.\n   */\n  previewConnection(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ) {\n    if (draggedConn === this.draggedConn && staticConn === this.staticConn) {\n      return;\n    }\n\n    eventUtils.disable();\n    try {\n      this.hidePreview();\n\n      // TODO(7898): Instead of special casing, we should change the dragger to\n      //   track the change in distance between the dragged connection and the\n      //   static connection, so that it doesn't disconnect  unless that\n      //   (+ a bit) has been exceeded.\n      if (this.shouldUseMarkerPreview(draggedConn, staticConn)) {\n        this.markerConn = this.previewMarker(draggedConn, staticConn);\n      }\n\n      if (this.workspace.getRenderer().shouldHighlightConnection(staticConn)) {\n        staticConn.highlight();\n      }\n\n      this.draggedConn = draggedConn;\n      this.staticConn = staticConn;\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  private shouldUseMarkerPreview(\n    _draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ): boolean {\n    return (\n      staticConn.type === ConnectionType.PREVIOUS_STATEMENT ||\n      staticConn.type === ConnectionType.NEXT_STATEMENT ||\n      !(this.workspace.getRenderer() instanceof ZelosRenderer)\n    );\n  }\n\n  private previewMarker(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ): RenderedConnection | null {\n    const dragged = draggedConn.getSourceBlock();\n    const marker = this.createInsertionMarker(dragged);\n    const markerConn = this.getMatchingConnection(dragged, marker, draggedConn);\n    if (!markerConn) return null;\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    marker.queueRender();\n    renderManagement.triggerQueuedRenders();\n\n    // Connect() also renders the insertion marker.\n    markerConn.connect(staticConn);\n\n    const originalOffsetToTarget = {\n      x: staticConn.x - markerConn.x,\n      y: staticConn.y - markerConn.y,\n    };\n    const originalOffsetInBlock = markerConn.getOffsetInBlock().clone();\n    renderManagement.finishQueuedRenders().then(() => {\n      if (marker.isDeadOrDying()) return;\n      eventUtils.disable();\n      try {\n        // Position so that the existing block doesn't move.\n        marker?.positionNearConnection(\n          markerConn,\n          originalOffsetToTarget,\n          originalOffsetInBlock,\n        );\n        marker?.getSvgRoot().setAttribute('visibility', 'visible');\n      } finally {\n        eventUtils.enable();\n      }\n    });\n    return markerConn;\n  }\n\n  private createInsertionMarker(origBlock: BlockSvg) {\n    const blockJson = blocks.save(origBlock, {\n      addCoordinates: false,\n      addInputBlocks: false,\n      addNextBlocks: false,\n      doFullSerialization: false,\n    });\n\n    if (!blockJson) {\n      throw new Error(\n        `Failed to serialize source block. ${origBlock.toDevString()}`,\n      );\n    }\n\n    const result = blocks.append(blockJson, this.workspace) as BlockSvg;\n\n    // Turn shadow blocks that are created programmatically during\n    // initalization to insertion markers too.\n    for (const block of result.getDescendants(false)) {\n      block.setInsertionMarker(true);\n    }\n\n    result.initSvg();\n    result.getSvgRoot().setAttribute('visibility', 'hidden');\n    return result;\n  }\n\n  /**\n   * Gets the connection on the marker block that matches the original\n   * connection on the original block.\n   *\n   * @param orig The original block.\n   * @param marker The marker block (where we want to find the matching\n   *     connection).\n   * @param origConn The original connection.\n   */\n  private getMatchingConnection(\n    orig: BlockSvg,\n    marker: BlockSvg,\n    origConn: RenderedConnection,\n  ): RenderedConnection | null {\n    const origConns = orig.getConnections_(true);\n    const markerConns = marker.getConnections_(true);\n    if (origConns.length !== markerConns.length) return null;\n    for (let i = 0; i < origConns.length; i++) {\n      if (origConns[i] === origConn) {\n        return markerConns[i];\n      }\n    }\n    return null;\n  }\n\n  /** Hide any previews that are currently displayed. */\n  hidePreview() {\n    eventUtils.disable();\n    try {\n      if (this.staticConn) {\n        this.staticConn.unhighlight();\n        this.staticConn = null;\n      }\n      if (this.fadedBlock) {\n        this.fadedBlock.fadeForReplacement(false);\n        this.fadedBlock = null;\n      }\n      if (this.markerConn) {\n        this.hideInsertionMarker(this.markerConn);\n        this.markerConn = null;\n        this.draggedConn = null;\n      }\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  private hideInsertionMarker(markerConn: RenderedConnection) {\n    const marker = markerConn.getSourceBlock();\n    const markerPrev = marker.previousConnection;\n    const markerOutput = marker.outputConnection;\n\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\n      // If we are the top block, unplugging doesn't do anything.\n      // The marker connection may not have a target block if we are hiding\n      // as part of applying connections.\n      markerConn.targetBlock()?.unplug(false);\n    } else {\n      marker.unplug(true);\n    }\n\n    marker.dispose();\n  }\n\n  /** Dispose of any references held by this connection previewer. */\n  dispose() {\n    this.hidePreview();\n  }\n}\n\nregistry.register(\n  registry.Type.CONNECTION_PREVIEWER,\n  registry.DEFAULT,\n  InsertionMarkerPreviewer,\n);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Align} from './inputs/align.js';\nimport {Input} from './inputs/input.js';\nimport {DummyInput} from './inputs/dummy_input.js';\nimport {EndRowInput} from './inputs/end_row_input.js';\nimport {StatementInput} from './inputs/statement_input.js';\nimport {ValueInput} from './inputs/value_input.js';\nimport {inputTypes} from './inputs/input_types.js';\n\nexport {\n  Align,\n  Input,\n  DummyInput,\n  EndRowInput,\n  StatementInput,\n  ValueInput,\n  inputTypes,\n};\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for generating executable code from\n * Blockly code.\n *\n * @class\n */\n// Former goog.module ID: Blockly.CodeGenerator\n\nimport type {Block} from './block.js';\nimport * as common from './common.js';\nimport {Names, NameType} from './names.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Deprecated, no-longer used type declaration for per-block-type generator\n * functions.\n *\n * @deprecated\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/generating-code}\n * @param block The Block instance to generate code for.\n * @param genearator The CodeGenerator calling the function.\n * @returns A string containing the generated code (for statement blocks),\n *     or a [code, precedence] tuple (for value/expression blocks), or\n *     null if no code should be emitted for block.\n */\nexport type BlockGenerator = (\n  block: Block,\n  generator: CodeGenerator,\n) => [string, number] | string | null;\n\n/**\n * Class for a code generator that translates the blocks into a language.\n */\nexport class CodeGenerator {\n  name_: string;\n\n  /**\n   * A dictionary of block generator functions, keyed by block type.\n   * Each block generator function takes two parameters:\n   *\n   * - the Block to generate code for, and\n   * - the calling CodeGenerator (or subclass) instance, so the\n   *   function can call methods defined below (e.g. blockToCode) or\n   *   on the relevant subclass (e.g. JavascripGenerator),\n   *\n   * and returns:\n   *\n   * - a [code, precedence] tuple (for value/expression blocks), or\n   * - a string containing the generated code (for statement blocks), or\n   * - null if no code should be emitted for block.\n   */\n  forBlock: Record<\n    string,\n    (block: Block, generator: this) => [string, number] | string | null\n  > = Object.create(null);\n\n  /**\n   * This is used as a placeholder in functions defined using\n   * CodeGenerator.provideFunction_.  It must not be legal code that could\n   * legitimately appear in a function definition (or comment), and it must\n   * not confuse the regular expression parser.\n   */\n  FUNCTION_NAME_PLACEHOLDER_ = '{leCUI8hutHZI4480Dc}';\n  FUNCTION_NAME_PLACEHOLDER_REGEXP_: RegExp;\n\n  /**\n   * Arbitrary code to inject into locations that risk causing infinite loops.\n   * Any instances of '%1' will be replaced by the block ID that failed.\n   * E.g. `  checkTimeout(%1);\\n`\n   */\n  INFINITE_LOOP_TRAP: string | null = null;\n\n  /**\n   * Arbitrary code to inject before every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_PREFIX: string | null = null;\n\n  /**\n   * Arbitrary code to inject after every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_SUFFIX: string | null = null;\n\n  /**\n   * The method of indenting.  Defaults to two spaces, but language generators\n   * may override this to increase indent or change to tabs.\n   */\n  INDENT = '  ';\n\n  /**\n   * Maximum length for a comment before wrapping.  Does not account for\n   * indenting level.\n   */\n  COMMENT_WRAP = 60;\n\n  /** List of outer-inner pairings that do NOT require parentheses. */\n  ORDER_OVERRIDES: number[][] = [];\n\n  /**\n   * Whether the init method has been called.\n   * Generators that set this flag to false after creation and true in init\n   * will cause blockToCode to emit a warning if the generator has not been\n   * initialized. If this flag is untouched, it will have no effect.\n   */\n  isInitialized: boolean | null = null;\n\n  /** Comma-separated list of reserved words. */\n  protected RESERVED_WORDS_ = '';\n\n  /** A dictionary of definitions to be printed before the code. */\n  protected definitions_: {[key: string]: string} = Object.create(null);\n\n  /**\n   * A dictionary mapping desired function names in definitions_ to actual\n   * function names (to avoid collisions with user functions).\n   */\n  protected functionNames_: {[key: string]: string} = Object.create(null);\n\n  /** A database of variable and procedure names. */\n  nameDB_?: Names = undefined;\n\n  /** @param name Language name of this generator. */\n  constructor(name: string) {\n    this.name_ = name;\n\n    this.FUNCTION_NAME_PLACEHOLDER_REGEXP_ = new RegExp(\n      this.FUNCTION_NAME_PLACEHOLDER_,\n      'g',\n    );\n  }\n\n  /**\n   * Generate code for all blocks in the workspace to the specified language.\n   *\n   * @param workspace Workspace to generate code from.\n   * @returns Generated code.\n   */\n  workspaceToCode(workspace?: Workspace): string {\n    if (!workspace) {\n      // Backwards compatibility from before there could be multiple workspaces.\n      console.warn(\n        'No workspace specified in workspaceToCode call.  Guessing.',\n      );\n      workspace = common.getMainWorkspace();\n    }\n    const code = [];\n    this.init(workspace);\n    const blocks = workspace.getTopBlocks(true);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      let line = this.blockToCode(block);\n      if (Array.isArray(line)) {\n        // Value blocks return tuples of code and operator order.\n        // Top-level blocks don't care about operator order.\n        line = line[0];\n      }\n      if (line) {\n        if (block.outputConnection) {\n          // This block is a naked value.  Ask the language's code generator if\n          // it wants to append a semicolon, or something.\n          line = this.scrubNakedValue(line);\n          if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n            line = this.injectId(this.STATEMENT_PREFIX, block) + line;\n          }\n          if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n            line = line + this.injectId(this.STATEMENT_SUFFIX, block);\n          }\n        }\n        code.push(line);\n      }\n    }\n    // Blank line between each section.\n    let codeString = code.join('\\n');\n    codeString = this.finish(codeString);\n    // Final scrubbing of whitespace.\n    codeString = codeString.replace(/^\\s+\\n/, '');\n    codeString = codeString.replace(/\\n\\s+$/, '\\n');\n    codeString = codeString.replace(/[ \\t]+\\n/g, '\\n');\n    return codeString;\n  }\n\n  /**\n   * Prepend a common prefix onto each line of code.\n   * Intended for indenting code or adding comment markers.\n   *\n   * @param text The lines of code.\n   * @param prefix The common prefix.\n   * @returns The prefixed lines of code.\n   */\n  prefixLines(text: string, prefix: string): string {\n    return prefix + text.replace(/(?!\\n$)\\n/g, '\\n' + prefix);\n  }\n\n  /**\n   * Recursively spider a tree of blocks, returning all their comments.\n   *\n   * @param block The block from which to start spidering.\n   * @returns Concatenated list of comments.\n   */\n  allNestedComments(block: Block): string {\n    const comments = [];\n    const blocks = block.getDescendants(true);\n    for (let i = 0; i < blocks.length; i++) {\n      const comment = blocks[i].getCommentText();\n      if (comment) {\n        comments.push(comment);\n      }\n    }\n    // Append an empty string to create a trailing line break when joined.\n    if (comments.length) {\n      comments.push('');\n    }\n    return comments.join('\\n');\n  }\n\n  /**\n   * Generate code for the specified block (and attached blocks).\n   * The generator must be initialized before calling this function.\n   *\n   * @param block The block to generate code for.\n   * @param opt_thisOnly True to generate code for only this statement.\n   * @returns For statement blocks, the generated code.\n   *     For value blocks, an array containing the generated code and an\n   * operator order value.  Returns '' if block is null.\n   */\n  blockToCode(\n    block: Block | null,\n    opt_thisOnly?: boolean,\n  ): string | [string, number] {\n    if (this.isInitialized === false) {\n      console.warn(\n        'CodeGenerator init was not called before blockToCode was called.',\n      );\n    }\n    if (!block) {\n      return '';\n    }\n    if (!block.isEnabled()) {\n      // Skip past this block if it is disabled.\n      return opt_thisOnly ? '' : this.blockToCode(block.getNextBlock());\n    }\n    if (block.isInsertionMarker()) {\n      // Skip past insertion markers.\n      return opt_thisOnly ? '' : this.blockToCode(block.getChildren(false)[0]);\n    }\n\n    // Look up block generator function in dictionary - but fall back\n    // to looking up on this if not found, for backwards compatibility.\n    const func = this.forBlock[block.type];\n    if (typeof func !== 'function') {\n      throw Error(\n        `${this.name_} generator does not know how to generate code ` +\n          `for block type \"${block.type}\".`,\n      );\n    }\n    // First argument to func.call is the value of 'this' in the generator.\n    // Prior to 24 September 2013 'this' was the only way to access the block.\n    // The current preferred method of accessing the block is through the second\n    // argument to func.call, which becomes the first parameter to the\n    // generator.\n    let code = func.call(block, block, this);\n    if (Array.isArray(code)) {\n      // Value blocks return tuples of code and operator order.\n      if (!block.outputConnection) {\n        throw TypeError('Expecting string from statement block: ' + block.type);\n      }\n      return [this.scrub_(block, code[0], opt_thisOnly), code[1]];\n    } else if (typeof code === 'string') {\n      if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n        code = this.injectId(this.STATEMENT_PREFIX, block) + code;\n      }\n      if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n        code = code + this.injectId(this.STATEMENT_SUFFIX, block);\n      }\n      return this.scrub_(block, code, opt_thisOnly);\n    } else if (code === null) {\n      // Block has handled code generation itself.\n      return '';\n    }\n    throw SyntaxError('Invalid code generated: ' + code);\n  }\n\n  /**\n   * Generate code representing the specified value input.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @param outerOrder The maximum binding strength (minimum order value) of any\n   *     operators adjacent to \"block\".\n   * @returns Generated code or '' if no blocks are connected or the specified\n   *     input does not exist.\n   */\n  valueToCode(block: Block, name: string, outerOrder: number): string {\n    if (isNaN(outerOrder)) {\n      throw TypeError('Expecting valid order from block: ' + block.type);\n    }\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock && !block.getInput(name)) {\n      throw ReferenceError(`Input \"${name}\" doesn't exist on \"${block.type}\"`);\n    }\n    if (!targetBlock) {\n      return '';\n    }\n    const tuple = this.blockToCode(targetBlock);\n    if (tuple === '') {\n      // Disabled block.\n      return '';\n    }\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (!Array.isArray(tuple)) {\n      throw TypeError(\n        `Expecting tuple from value block: ${targetBlock.type} See ` +\n          `developers.google.com/blockly/guides/create-custom-blocks/generating-code ` +\n          `for more information`,\n      );\n    }\n    let code = tuple[0];\n    const innerOrder = tuple[1];\n    if (isNaN(innerOrder)) {\n      throw TypeError(\n        'Expecting valid order from value block: ' + targetBlock.type,\n      );\n    }\n    if (!code) {\n      return '';\n    }\n\n    // Add parentheses if needed.\n    let parensNeeded = false;\n    const outerOrderClass = Math.floor(outerOrder);\n    const innerOrderClass = Math.floor(innerOrder);\n    if (outerOrderClass <= innerOrderClass) {\n      if (\n        outerOrderClass === innerOrderClass &&\n        (outerOrderClass === 0 || outerOrderClass === 99)\n      ) {\n        // Don't generate parens around NONE-NONE and ATOMIC-ATOMIC pairs.\n        // 0 is the atomic order, 99 is the none order.  No parentheses needed.\n        // In all known languages multiple such code blocks are not order\n        // sensitive.  In fact in Python ('a' 'b') 'c' would fail.\n      } else {\n        // The operators outside this code are stronger than the operators\n        // inside this code.  To prevent the code from being pulled apart,\n        // wrap the code in parentheses.\n        parensNeeded = true;\n        // Check for special exceptions.\n        for (let i = 0; i < this.ORDER_OVERRIDES.length; i++) {\n          if (\n            this.ORDER_OVERRIDES[i][0] === outerOrder &&\n            this.ORDER_OVERRIDES[i][1] === innerOrder\n          ) {\n            parensNeeded = false;\n            break;\n          }\n        }\n      }\n    }\n    if (parensNeeded) {\n      // Technically, this should be handled on a language-by-language basis.\n      // However all known (sane) languages use parentheses for grouping.\n      code = '(' + code + ')';\n    }\n    return code;\n  }\n\n  /**\n   * Generate a code string representing the blocks attached to the named\n   * statement input. Indent the code.\n   * This is mainly used in generators. When trying to generate code to evaluate\n   * look at using workspaceToCode or blockToCode.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @returns Generated code or '' if no blocks are connected.\n   */\n  statementToCode(block: Block, name: string): string {\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock && !block.getInput(name)) {\n      throw ReferenceError(`Input \"${name}\" doesn't exist on \"${block.type}\"`);\n    }\n    let code = this.blockToCode(targetBlock);\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (typeof code !== 'string') {\n      throw TypeError(\n        'Expecting code from statement block: ' +\n          (targetBlock && targetBlock.type),\n      );\n    }\n    if (code) {\n      code = this.prefixLines(code, this.INDENT);\n    }\n    return code;\n  }\n\n  /**\n   * Add an infinite loop trap to the contents of a loop.\n   * Add statement suffix at the start of the loop block (right after the loop\n   * statement executes), and a statement prefix to the end of the loop block\n   * (right before the loop statement executes).\n   *\n   * @param branch Code for loop contents.\n   * @param block Enclosing block.\n   * @returns Loop contents, with infinite loop trap added.\n   */\n  addLoopTrap(branch: string, block: Block): string {\n    if (this.INFINITE_LOOP_TRAP) {\n      branch =\n        this.prefixLines(\n          this.injectId(this.INFINITE_LOOP_TRAP, block),\n          this.INDENT,\n        ) + branch;\n    }\n    if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n      branch =\n        this.prefixLines(\n          this.injectId(this.STATEMENT_SUFFIX, block),\n          this.INDENT,\n        ) + branch;\n    }\n    if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n      branch =\n        branch +\n        this.prefixLines(\n          this.injectId(this.STATEMENT_PREFIX, block),\n          this.INDENT,\n        );\n    }\n    return branch;\n  }\n\n  /**\n   * Inject a block ID into a message to replace '%1'.\n   * Used for STATEMENT_PREFIX, STATEMENT_SUFFIX, and INFINITE_LOOP_TRAP.\n   *\n   * @param msg Code snippet with '%1'.\n   * @param block Block which has an ID.\n   * @returns Code snippet with ID.\n   */\n  injectId(msg: string, block: Block): string {\n    const id = block.id.replace(/\\$/g, '$$$$'); // Issue 251.\n    return msg.replace(/%1/g, \"'\" + id + \"'\");\n  }\n\n  /**\n   * Add one or more words to the list of reserved words for this language.\n   *\n   * @param words Comma-separated list of words to add to the list.\n   *     No spaces.  Duplicates are ok.\n   */\n  addReservedWords(words: string) {\n    this.RESERVED_WORDS_ += words + ',';\n  }\n\n  /**\n   * Define a developer-defined function (not a user-defined procedure) to be\n   * included in the generated code.  Used for creating private helper\n   * functions. The first time this is called with a given desiredName, the code\n   * is saved and an actual name is generated.  Subsequent calls with the same\n   * desiredName have no effect but have the same return value.\n   *\n   * It is up to the caller to make sure the same desiredName is not\n   * used for different helper functions (e.g. use \"colourRandom\" and\n   * \"listRandom\", not \"random\").  There is no danger of colliding with reserved\n   * words, or user-defined variable or procedure names.\n   *\n   * The code gets output when CodeGenerator.finish() is called.\n   *\n   * @param desiredName The desired name of the function (e.g. mathIsPrime).\n   * @param code A list of statements or one multi-line code string.  Use '  '\n   *     for indents (they will be replaced).\n   * @returns The actual name of the new function.  This may differ from\n   *     desiredName if the former has already been taken by the user.\n   */\n  provideFunction_(desiredName: string, code: string[] | string): string {\n    if (!this.definitions_[desiredName]) {\n      const functionName = this.nameDB_!.getDistinctName(\n        desiredName,\n        NameType.PROCEDURE,\n      );\n      this.functionNames_[desiredName] = functionName;\n      if (Array.isArray(code)) {\n        code = code.join('\\n');\n      }\n      let codeText = code\n        .trim()\n        .replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_, functionName);\n      // Change all '  ' indents into the desired indent.\n      // To avoid an infinite loop of replacements, change all indents to '\\0'\n      // character first, then replace them all with the indent.\n      // We are assuming that no provided functions contain a literal null char.\n      let oldCodeText;\n      while (oldCodeText !== codeText) {\n        oldCodeText = codeText;\n        codeText = codeText.replace(/^(( {2})*) {2}/gm, '$1\\0');\n      }\n      codeText = codeText.replace(/\\0/g, this.INDENT);\n      this.definitions_[desiredName] = codeText;\n    }\n    return this.functionNames_[desiredName];\n  }\n\n  /**\n   * Gets a unique, legal name for a user-defined variable.\n   * Before calling this method, the `nameDB_` property of the class\n   * must have been initialized already. This is typically done in\n   * the `init` function of the code generator class.\n   *\n   * @param nameOrId The ID of the variable to get a name for,\n   *    or the proposed name for a variable not associated with an id.\n   * @returns A unique, legal name for the variable.\n   */\n  getVariableName(nameOrId: string): string {\n    return this.getName(nameOrId, NameType.VARIABLE);\n  }\n\n  /**\n   * Gets a unique, legal name for a user-defined procedure.\n   * Before calling this method, the `nameDB_` property of the class\n   * must have been initialized already. This is typically done in\n   * the `init` function of the code generator class.\n   *\n   * @param name The proposed name for a procedure.\n   * @returns A unique, legal name for the procedure.\n   */\n  getProcedureName(name: string): string {\n    return this.getName(name, NameType.PROCEDURE);\n  }\n\n  private getName(nameOrId: string, type: NameType): string {\n    if (!this.nameDB_) {\n      throw new Error(\n        'Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.',\n      );\n    }\n    return this.nameDB_.getName(nameOrId, type);\n  }\n\n  /**\n   * Hook for code to run before code generation starts.\n   * Subclasses may override this, e.g. to initialise the database of variable\n   * names.\n   *\n   * @param _workspace Workspace to generate code from.\n   */\n  init(_workspace: Workspace) {\n    // Optionally override\n    // Create a dictionary of definitions to be printed before the code.\n    this.definitions_ = Object.create(null);\n    // Create a dictionary mapping desired developer-defined function names in\n    // definitions_ to actual function names (to avoid collisions with\n    // user-defined procedures).\n    this.functionNames_ = Object.create(null);\n  }\n\n  /**\n   * Common tasks for generating code from blocks.  This is called from\n   * blockToCode and is called on every block, not just top level blocks.\n   * Subclasses may override this, e.g. to generate code for statements\n   * following the block, or to handle comments for the specified block and any\n   * connected value blocks.\n   *\n   * @param _block The current block.\n   * @param code The code created for this block.\n   * @param _opt_thisOnly True to generate code for only this statement.\n   * @returns Code with comments and subsequent blocks added.\n   */\n  scrub_(_block: Block, code: string, _opt_thisOnly?: boolean): string {\n    // Optionally override\n    return code;\n  }\n\n  /**\n   * Hook for code to run at end of code generation.\n   * Subclasses may override this, e.g. to prepend the generated code with\n   * import statements or variable definitions.\n   *\n   * @param code Generated code.\n   * @returns Completed code.\n   */\n  finish(code: string): string {\n    // Optionally override\n    // Clean up temporary data.\n    this.definitions_ = Object.create(null);\n    this.functionNames_ = Object.create(null);\n    return code;\n  }\n\n  /**\n   * Naked values are top-level blocks with outputs that aren't plugged into\n   * anything.\n   * Subclasses may override this, e.g. if their language does not allow\n   * naked values.\n   *\n   * @param line Line of generated code.\n   * @returns Legal line of code.\n   */\n  scrubNakedValue(line: string): string {\n    // Optionally override\n    return line;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports flyout workspace metrics.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FlyoutMetricsManager\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport {ContainerRegion, MetricsManager} from './metrics_manager.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Calculates metrics for a flyout's workspace.\n * The metrics are mainly used to size scrollbars for the flyout.\n */\nexport class FlyoutMetricsManager extends MetricsManager {\n  /** The flyout that owns the workspace to calculate metrics for. */\n  protected flyout_: IFlyout;\n\n  /**\n   * @param workspace The flyout's workspace.\n   * @param flyout The flyout.\n   */\n  constructor(workspace: WorkspaceSvg, flyout: IFlyout) {\n    super(workspace);\n    this.flyout_ = flyout;\n  }\n\n  /**\n   * Gets the bounding box of the blocks on the flyout's workspace.\n   * This is in workspace coordinates.\n   *\n   * @returns The bounding box of the blocks on the workspace.\n   */\n  private getBoundingBox_():\n    | SVGRect\n    | {height: number; y: number; width: number; x: number} {\n    let blockBoundingBox;\n    try {\n      blockBoundingBox = this.workspace_.getCanvas().getBBox();\n    } catch (e) {\n      // Firefox has trouble with hidden elements (Bug 528969).\n      // 2021 Update: It looks like this was fixed around Firefox 77 released in\n      // 2020.\n      blockBoundingBox = {height: 0, y: 0, width: 0, x: 0};\n    }\n    return blockBoundingBox;\n  }\n\n  override getContentMetrics(opt_getWorkspaceCoordinates?: boolean) {\n    // The bounding box is in workspace coordinates.\n    const blockBoundingBox = this.getBoundingBox_();\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n\n    return {\n      height: blockBoundingBox.height * scale,\n      width: blockBoundingBox.width * scale,\n      top: blockBoundingBox.y * scale,\n      left: blockBoundingBox.x * scale,\n    };\n  }\n\n  override getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ) {\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const margin = this.flyout_.MARGIN * this.workspace_.scale;\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n\n    // The left padding isn't just the margin. Some blocks are also offset by\n    // tabWidth so that value and statement blocks line up.\n    // The contentMetrics.left value is equivalent to the variable left padding.\n    const leftPadding = contentMetrics.left;\n\n    return {\n      height: (contentMetrics.height + 2 * margin) / scale,\n      width: (contentMetrics.width + leftPadding + margin) / scale,\n      top: 0,\n      left: 0,\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Flyout tray containing blocks which may be created.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Flyout\n\nimport type {Abstract as AbstractEvent} from './events/events_abstract.js';\nimport type {Block} from './block.js';\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as eventUtils from './events/utils.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport {MANUALLY_DISABLED} from './constants.js';\nimport type {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as Variables from './variables.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Xml from './xml.js';\nimport * as renderManagement from './render_management.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\n\nenum FlyoutItemType {\n  BLOCK = 'block',\n  BUTTON = 'button',\n}\n\n/**\n * The language-neutral ID for when the reason why a block is disabled is\n * because the workspace is at block capacity.\n */\nconst WORKSPACE_AT_BLOCK_CAPACITY_DISABLED_REASON =\n  'WORKSPACE_AT_BLOCK_CAPACITY';\n\n/**\n * Class for a flyout.\n */\nexport abstract class Flyout\n  extends DeleteArea\n  implements IAutoHideable, IFlyout\n{\n  /**\n   * Position the flyout.\n   */\n  abstract position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has\n   *     moved from the position at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  abstract isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float\n   *     between 0 and 1 specifying the degree of scrolling and a\n   *     similar x property.\n   */\n  protected abstract setMetrics_(xyRatio: {x?: number; y?: number}): void;\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected abstract layout_(contents: FlyoutItem[], gaps: number[]): void;\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected abstract wheel_(e: WheelEvent): void;\n\n  /**\n   * Compute height of flyout.  Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected abstract reflowInternal_(): void;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  abstract getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  abstract getY(): number;\n\n  /**\n   * Scroll the flyout to the beginning of its contents.\n   */\n  abstract scrollToStart(): void;\n\n  /**\n   * The type of a flyout content item.\n   */\n  static FlyoutItemType = FlyoutItemType;\n\n  protected workspace_: WorkspaceSvg;\n  RTL: boolean;\n  /**\n   * Whether the flyout should be laid out horizontally or not.\n   *\n   * @internal\n   */\n  horizontalLayout = false;\n  protected toolboxPosition_: number;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * Function that will be registered as a change listener on the workspace\n   * to reflow when blocks in the flyout workspace change.\n   */\n  private reflowWrapper: ((e: AbstractEvent) => void) | null = null;\n\n  /**\n   * Function that disables blocks in the flyout based on max block counts\n   * allowed in the target workspace. Registered as a change listener on the\n   * target workspace.\n   */\n  private filterWrapper: ((e: AbstractEvent) => void) | null = null;\n\n  /**\n   * List of background mats that lurk behind each block to catch clicks\n   * landing in the blocks' lakes and bays.\n   */\n  private mats: SVGElement[] = [];\n\n  /**\n   * List of visible buttons.\n   */\n  protected buttons_: FlyoutButton[] = [];\n\n  /**\n   * List of visible buttons and blocks.\n   */\n  protected contents: FlyoutItem[] = [];\n\n  /**\n   * List of event listeners.\n   */\n  private listeners: browserEvents.Data[] = [];\n\n  /**\n   * List of blocks that should always be disabled.\n   */\n  private permanentlyDisabled: Block[] = [];\n\n  protected readonly tabWidth_: number;\n\n  /**\n   * The target workspace.\n   *\n   * @internal\n   */\n  targetWorkspace!: WorkspaceSvg;\n\n  /**\n   * A list of blocks that can be reused.\n   */\n  private recycledBlocks: BlockSvg[] = [];\n\n  /**\n   * Does the flyout automatically close when a block is created?\n   */\n  autoClose = true;\n\n  /**\n   * Whether the flyout is visible.\n   */\n  private isVisible_ = false;\n\n  /**\n   * Whether the workspace containing this flyout is visible.\n   */\n  private containerVisible = true;\n  protected rectMap_: WeakMap<BlockSvg, SVGElement>;\n\n  /**\n   * Corner radius of the flyout background.\n   */\n  readonly CORNER_RADIUS: number = 8;\n  readonly MARGIN: number;\n  readonly GAP_X: number;\n  readonly GAP_Y: number;\n\n  /**\n   * Top/bottom padding between scrollbar and edge of flyout background.\n   */\n  readonly SCROLLBAR_MARGIN: number = 2.5;\n\n  /**\n   * Width of flyout.\n   */\n  protected width_ = 0;\n\n  /**\n   * Height of flyout.\n   */\n  protected height_ = 0;\n  // clang-format off\n  /**\n   * Range of a drag angle from a flyout considered \"dragging toward\n   * workspace\". Drags that are within the bounds of this many degrees from\n   * the orthogonal line to the flyout edge are considered to be \"drags toward\n   * the workspace\".\n   *\n   * @example\n   *\n   * ```\n   * Flyout                                                 Edge   Workspace\n   * [block] /  <-within this angle, drags \"toward workspace\" |\n   * [block] ---- orthogonal to flyout boundary ----          |\n   * [block] \\                                                |\n   * ```\n   *\n   * The angle is given in degrees from the orthogonal.\n   *\n   * This is used to know when to create a new block and when to scroll the\n   * flyout. Setting it to 360 means that all drags create a new block.\n   */\n  // clang-format on\n  protected dragAngleRange_ = 70;\n\n  /**\n   * The path around the background of the flyout, which will be filled with a\n   * background colour.\n   */\n  protected svgBackground_: SVGPathElement | null = null;\n\n  /**\n   * The root SVG group for the button or label.\n   */\n  protected svgGroup_: SVGGElement | null = null;\n  /**\n   * @param workspaceOptions Dictionary of options for the\n   *     workspace.\n   */\n  constructor(workspaceOptions: Options) {\n    super();\n    workspaceOptions.setMetrics = this.setMetrics_.bind(this);\n\n    this.workspace_ = new WorkspaceSvg(workspaceOptions);\n    this.workspace_.setMetricsManager(\n      new FlyoutMetricsManager(this.workspace_, this),\n    );\n\n    this.workspace_.internalIsFlyout = true;\n    // Keep the workspace visibility consistent with the flyout's visibility.\n    this.workspace_.setVisible(this.isVisible_);\n\n    /**\n     * The unique id for this component that is used to register with the\n     * ComponentManager.\n     */\n    this.id = idGenerator.genUid();\n\n    /**\n     * Is RTL vs LTR.\n     */\n    this.RTL = !!workspaceOptions.RTL;\n\n    /**\n     * Position of the toolbox and flyout relative to the workspace.\n     */\n    this.toolboxPosition_ = workspaceOptions.toolboxPosition;\n\n    /**\n     * Width of output tab.\n     */\n    this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\n\n    /**\n     * A map from blocks to the rects which are beneath them to act as input\n     * targets.\n     *\n     * @internal\n     */\n    this.rectMap_ = new WeakMap();\n\n    /**\n     * Margin around the edges of the blocks in the flyout.\n     */\n    this.MARGIN = this.CORNER_RADIUS;\n\n    // TODO: Move GAP_X and GAP_Y to their appropriate files.\n    /**\n     * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_X = this.MARGIN * 3;\n\n    /**\n     * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_Y = this.MARGIN * 3;\n  }\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own SVG element or be a g element nested inside a\n   * separate SVG element.\n   *\n   * @param tagName The type of tag to\n   *     put the flyout in. This should be <svg> or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\n  ): SVGElement {\n    /*\n        <svg | g>\n          <path class=\"blocklyFlyoutBackground\"/>\n          <g class=\"blocklyFlyout\"></g>\n        </ svg | g>\n        */\n    // Setting style to display:none to start. The toolbox and flyout\n    // hide/show code will set up proper visibility and size later.\n    this.svgGroup_ = dom.createSvgElement(tagName, {\n      'class': 'blocklyFlyout',\n    });\n    this.svgGroup_.style.display = 'none';\n    this.svgBackground_ = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyFlyoutBackground'},\n      this.svgGroup_,\n    );\n    this.svgGroup_.appendChild(this.workspace_.createDom());\n    this.workspace_\n      .getThemeManager()\n      .subscribe(this.svgBackground_, 'flyoutBackgroundColour', 'fill');\n    this.workspace_\n      .getThemeManager()\n      .subscribe(this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\n    return this.svgGroup_;\n  }\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to\n   *     create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg) {\n    this.targetWorkspace = targetWorkspace;\n    this.workspace_.targetWorkspace = targetWorkspace;\n\n    this.workspace_.scrollbar = new ScrollbarPair(\n      this.workspace_,\n      this.horizontalLayout,\n      !this.horizontalLayout,\n      'blocklyFlyoutScrollbar',\n      this.SCROLLBAR_MARGIN,\n    );\n\n    this.hide();\n\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.svgGroup_ as SVGGElement,\n        'wheel',\n        this,\n        this.wheel_,\n      ),\n    );\n    this.filterWrapper = this.filterForCapacity.bind(this);\n    this.targetWorkspace.addChangeListener(this.filterWrapper);\n\n    // Dragging the flyout up and down.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.svgBackground_ as SVGPathElement,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n      ),\n    );\n\n    // A flyout connected to a workspace doesn't have its own current gesture.\n    this.workspace_.getGesture = this.targetWorkspace.getGesture.bind(\n      this.targetWorkspace,\n    );\n\n    // Get variables from the main workspace rather than the target workspace.\n    this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\n\n    this.workspace_.createPotentialVariableMap();\n\n    targetWorkspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.hide();\n    this.targetWorkspace.getComponentManager().removeComponent(this.id);\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    if (this.filterWrapper) {\n      this.targetWorkspace.removeChangeListener(this.filterWrapper);\n    }\n    if (this.workspace_) {\n      this.workspace_.getThemeManager().unsubscribe(this.svgBackground_!);\n      this.workspace_.dispose();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Get the scale (zoom level) of the flyout. By default,\n   * this matches the target workspace scale, but this can be overridden.\n   *\n   * @returns Flyout workspace scale.\n   */\n  getFlyoutScale(): number {\n    return this.targetWorkspace.scale;\n  }\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Sets whether this flyout automatically closes when blocks are dragged out,\n   * the workspace is clicked, etc, or not.\n   */\n  setAutoClose(autoClose: boolean) {\n    this.autoClose = autoClose;\n    this.targetWorkspace.recordDragTargets();\n    this.targetWorkspace.resizeContents();\n  }\n\n  /** Automatically hides the flyout if it is an autoclosing flyout. */\n  autoHide(onlyClosePopups: boolean): void {\n    if (\n      !onlyClosePopups &&\n      this.targetWorkspace.getFlyout(true) === this &&\n      this.autoClose\n    )\n      this.hide();\n  }\n\n  /**\n   * Get the target workspace inside the flyout.\n   *\n   * @returns The target workspace inside the flyout.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    this.isVisible_ = visible;\n    if (visibilityChanged) {\n      if (!this.autoClose) {\n        // Auto-close flyouts are ignored as drag targets, so only non\n        // auto-close flyouts need to have their drag target updated.\n        this.targetWorkspace.recordDragTargets();\n      }\n      this.updateDisplay();\n    }\n  }\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay();\n    }\n  }\n\n  /**\n   * Get the list of buttons and blocks of the current flyout.\n   *\n   * @returns The array of flyout buttons and blocks.\n   */\n  getContents(): FlyoutItem[] {\n    return this.contents;\n  }\n\n  /**\n   * Store the list of buttons and blocks on the flyout.\n   *\n   * @param contents - The array of items for the flyout.\n   */\n  setContents(contents: FlyoutItem[]): void {\n    this.contents = contents;\n  }\n  /**\n   * Update the display property of the flyout based whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   */\n  private updateDisplay() {\n    let show = true;\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (this.svgGroup_) {\n      this.svgGroup_.style.display = show ? 'block' : 'none';\n    }\n    // Update the scrollbar's visibility too since it should mimic the\n    // flyout's visibility.\n    this.workspace_.scrollbar?.setContainerVisible(show);\n  }\n\n  /**\n   * Update the view based on coordinates calculated in position().\n   *\n   * @param width The computed width of the flyout's SVG group\n   * @param height The computed height of the flyout's SVG group.\n   * @param x The computed x origin of the flyout's SVG group.\n   * @param y The computed y origin of the flyout's SVG group.\n   */\n  protected positionAt_(width: number, height: number, x: number, y: number) {\n    this.svgGroup_?.setAttribute('width', `${width}`);\n    this.svgGroup_?.setAttribute('height', `${height}`);\n    this.workspace_.setCachedParentSvgSize(width, height);\n\n    if (this.svgGroup_) {\n      const transform = 'translate(' + x + 'px,' + y + 'px)';\n      dom.setCssTransform(this.svgGroup_, transform);\n    }\n\n    // Update the scrollbar (if one exists).\n    const scrollbar = this.workspace_.scrollbar;\n    if (scrollbar) {\n      // Set the scrollbars origin to be the top left of the flyout.\n      scrollbar.setOrigin(x, y);\n      scrollbar.resize();\n      // If origin changed and metrics haven't changed enough to trigger\n      // reposition in resize, we need to call setPosition. See issue #4692.\n      if (scrollbar.hScroll) {\n        scrollbar.hScroll.setPosition(\n          scrollbar.hScroll.position.x,\n          scrollbar.hScroll.position.y,\n        );\n      }\n      if (scrollbar.vScroll) {\n        scrollbar.vScroll.setPosition(\n          scrollbar.vScroll.position.x,\n          scrollbar.vScroll.position.y,\n        );\n      }\n    }\n  }\n\n  /**\n   * Hide and empty the flyout.\n   */\n  hide() {\n    if (!this.isVisible()) {\n      return;\n    }\n    this.setVisible(false);\n    // Delete all the event listeners.\n    for (const listen of this.listeners) {\n      browserEvents.unbind(listen);\n    }\n    this.listeners.length = 0;\n    if (this.reflowWrapper) {\n      this.workspace_.removeChangeListener(this.reflowWrapper);\n      this.reflowWrapper = null;\n    }\n    // Do NOT delete the blocks here.  Wait until Flyout.show.\n    // https://neil.fraser.name/news/2014/08/09/\n  }\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display\n   *     in the flyout. This is either an array of Nodes, a NodeList, a\n   *     toolbox definition, or a string with the name of the dynamic category.\n   */\n  show(flyoutDef: toolbox.FlyoutDefinition | string) {\n    this.workspace_.setResizesEnabled(false);\n    this.hide();\n    this.clearOldBlocks();\n\n    // Handle dynamic categories, represented by a name instead of a list.\n    if (typeof flyoutDef === 'string') {\n      flyoutDef = this.getDynamicCategoryContents(flyoutDef);\n    }\n    this.setVisible(true);\n\n    // Parse the Array, Node or NodeList into a a list of flyout items.\n    const parsedContent = toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n    const flyoutInfo = this.createFlyoutInfo(parsedContent);\n\n    renderManagement.triggerQueuedRenders(this.workspace_);\n\n    this.setContents(flyoutInfo.contents);\n\n    this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\n\n    if (this.horizontalLayout) {\n      this.height_ = 0;\n    } else {\n      this.width_ = 0;\n    }\n    this.workspace_.setResizesEnabled(true);\n    this.reflow();\n\n    this.filterForCapacity();\n\n    // Correctly position the flyout's scrollbar when it opens.\n    this.position();\n\n    this.reflowWrapper = this.reflow.bind(this);\n    this.workspace_.addChangeListener(this.reflowWrapper);\n    this.emptyRecycledBlocks();\n  }\n\n  /**\n   * Create the contents array and gaps array necessary to create the layout for\n   * the flyout.\n   *\n   * @param parsedContent The array\n   *     of objects to show in the flyout.\n   * @returns The list of contents and gaps needed to lay out the flyout.\n   */\n  private createFlyoutInfo(parsedContent: toolbox.FlyoutItemInfoArray): {\n    contents: FlyoutItem[];\n    gaps: number[];\n  } {\n    const contents: FlyoutItem[] = [];\n    const gaps: number[] = [];\n    this.permanentlyDisabled.length = 0;\n    const defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\n    for (const info of parsedContent) {\n      if ('custom' in info) {\n        const customInfo = info as toolbox.DynamicCategoryInfo;\n        const categoryName = customInfo['custom'];\n        const flyoutDef = this.getDynamicCategoryContents(categoryName);\n        const parsedDynamicContent =\n          toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n        const {contents: dynamicContents, gaps: dynamicGaps} =\n          this.createFlyoutInfo(parsedDynamicContent);\n        contents.push(...dynamicContents);\n        gaps.push(...dynamicGaps);\n      }\n\n      switch (info['kind'].toUpperCase()) {\n        case 'BLOCK': {\n          const blockInfo = info as toolbox.BlockInfo;\n          const block = this.createFlyoutBlock(blockInfo);\n          contents.push({type: FlyoutItemType.BLOCK, block: block});\n          this.addBlockGap(blockInfo, gaps, defaultGap);\n          break;\n        }\n        case 'SEP': {\n          const sepInfo = info as toolbox.SeparatorInfo;\n          this.addSeparatorGap(sepInfo, gaps, defaultGap);\n          break;\n        }\n        case 'LABEL': {\n          const labelInfo = info as toolbox.LabelInfo;\n          // A label is a button with different styling.\n          const label = this.createButton(labelInfo, /** isLabel */ true);\n          contents.push({type: FlyoutItemType.BUTTON, button: label});\n          gaps.push(defaultGap);\n          break;\n        }\n        case 'BUTTON': {\n          const buttonInfo = info as toolbox.ButtonInfo;\n          const button = this.createButton(buttonInfo, /** isLabel */ false);\n          contents.push({type: FlyoutItemType.BUTTON, button: button});\n          gaps.push(defaultGap);\n          break;\n        }\n      }\n    }\n\n    return {contents: contents, gaps: gaps};\n  }\n\n  /**\n   * Gets the flyout definition for the dynamic category.\n   *\n   * @param categoryName The name of the dynamic category.\n   * @returns The definition of the\n   *     flyout in one of its many forms.\n   */\n  private getDynamicCategoryContents(\n    categoryName: string,\n  ): toolbox.FlyoutDefinition {\n    // Look up the correct category generation function and call that to get a\n    // valid XML list.\n    const fnToApply =\n      this.workspace_.targetWorkspace!.getToolboxCategoryCallback(categoryName);\n    if (typeof fnToApply !== 'function') {\n      throw TypeError(\n        \"Couldn't find a callback function when opening\" +\n          ' a toolbox category.',\n      );\n    }\n    return fnToApply(this.workspace_.targetWorkspace!);\n  }\n\n  /**\n   * Creates a flyout button or a flyout label.\n   *\n   * @param btnInfo The object holding information about a button or a label.\n   * @param isLabel True if the button is a label, false otherwise.\n   * @returns The object used to display the button in the\n   *    flyout.\n   */\n  private createButton(\n    btnInfo: toolbox.ButtonOrLabelInfo,\n    isLabel: boolean,\n  ): FlyoutButton {\n    const curButton = new FlyoutButton(\n      this.workspace_,\n      this.targetWorkspace as WorkspaceSvg,\n      btnInfo,\n      isLabel,\n    );\n    return curButton;\n  }\n\n  /**\n   * Create a block from the xml and permanently disable any blocks that were\n   * defined as disabled.\n   *\n   * @param blockInfo The info of the block.\n   * @returns The block created from the blockInfo.\n   */\n  private createFlyoutBlock(blockInfo: toolbox.BlockInfo): BlockSvg {\n    let block;\n    if (blockInfo['blockxml']) {\n      const xml = (\n        typeof blockInfo['blockxml'] === 'string'\n          ? utilsXml.textToDom(blockInfo['blockxml'])\n          : blockInfo['blockxml']\n      ) as Element;\n      block = this.getRecycledBlock(xml.getAttribute('type')!);\n      if (!block) {\n        block = Xml.domToBlockInternal(xml, this.workspace_);\n      }\n    } else {\n      block = this.getRecycledBlock(blockInfo['type']!);\n      if (!block) {\n        if (blockInfo['enabled'] === undefined) {\n          blockInfo['enabled'] =\n            blockInfo['disabled'] !== 'true' && blockInfo['disabled'] !== true;\n        }\n        if (\n          blockInfo['disabledReasons'] === undefined &&\n          blockInfo['enabled'] === false\n        ) {\n          blockInfo['disabledReasons'] = [MANUALLY_DISABLED];\n        }\n        block = blocks.appendInternal(\n          blockInfo as blocks.State,\n          this.workspace_,\n        );\n      }\n    }\n\n    if (!block.isEnabled()) {\n      // Record blocks that were initially disabled.\n      // Do not enable these blocks as a result of capacity filtering.\n      this.permanentlyDisabled.push(block);\n    }\n    return block as BlockSvg;\n  }\n\n  /**\n   * Returns a block from the array of recycled blocks with the given type, or\n   * undefined if one cannot be found.\n   *\n   * @param blockType The type of the block to try to recycle.\n   * @returns The recycled block, or undefined if\n   *     one could not be recycled.\n   */\n  private getRecycledBlock(blockType: string): BlockSvg | undefined {\n    let index = -1;\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\n      if (this.recycledBlocks[i].type === blockType) {\n        index = i;\n        break;\n      }\n    }\n    return index === -1 ? undefined : this.recycledBlocks.splice(index, 1)[0];\n  }\n\n  /**\n   * Adds a gap in the flyout based on block info.\n   *\n   * @param blockInfo Information about a block.\n   * @param gaps The list of gaps between items in the flyout.\n   * @param defaultGap The default gap between one element and the\n   *     next.\n   */\n  private addBlockGap(\n    blockInfo: toolbox.BlockInfo,\n    gaps: number[],\n    defaultGap: number,\n  ) {\n    let gap;\n    if (blockInfo['gap']) {\n      gap = parseInt(String(blockInfo['gap']));\n    } else if (blockInfo['blockxml']) {\n      const xml = (\n        typeof blockInfo['blockxml'] === 'string'\n          ? utilsXml.textToDom(blockInfo['blockxml'])\n          : blockInfo['blockxml']\n      ) as Element;\n      gap = parseInt(xml.getAttribute('gap')!);\n    }\n    gaps.push(!gap || isNaN(gap) ? defaultGap : gap);\n  }\n\n  /**\n   * Add the necessary gap in the flyout for a separator.\n   *\n   * @param sepInfo The object holding\n   *    information about a separator.\n   * @param gaps The list gaps between items in the flyout.\n   * @param defaultGap The default gap between the button and next\n   *     element.\n   */\n  private addSeparatorGap(\n    sepInfo: toolbox.SeparatorInfo,\n    gaps: number[],\n    defaultGap: number,\n  ) {\n    // Change the gap between two toolbox elements.\n    // <sep gap=\"36\"></sep>\n    // The default gap is 24, can be set larger or smaller.\n    // This overwrites the gap attribute on the previous element.\n    const newGap = parseInt(String(sepInfo['gap']));\n    // Ignore gaps before the first block.\n    if (!isNaN(newGap) && gaps.length > 0) {\n      gaps[gaps.length - 1] = newGap;\n    } else {\n      gaps.push(defaultGap);\n    }\n  }\n\n  /**\n   * Delete blocks, mats and buttons from a previous showing of the flyout.\n   */\n  private clearOldBlocks() {\n    // Delete any blocks from a previous showing.\n    const oldBlocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = oldBlocks[i]); i++) {\n      if (this.blockIsRecyclable_(block)) {\n        this.recycleBlock(block);\n      } else {\n        block.dispose(false, false);\n      }\n    }\n    // Delete any mats from a previous showing.\n    for (let j = 0; j < this.mats.length; j++) {\n      const rect = this.mats[j];\n      if (rect) {\n        Tooltip.unbindMouseEvents(rect);\n        dom.removeNode(rect);\n      }\n    }\n    this.mats.length = 0;\n    // Delete any buttons from a previous showing.\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\n      button.dispose();\n    }\n    this.buttons_.length = 0;\n\n    // Clear potential variables from the previous showing.\n    this.workspace_.getPotentialVariableMap()?.clear();\n  }\n\n  /**\n   * Empties all of the recycled blocks, properly disposing of them.\n   */\n  private emptyRecycledBlocks() {\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\n      this.recycledBlocks[i].dispose();\n    }\n    this.recycledBlocks = [];\n  }\n\n  /**\n   * Returns whether the given block can be recycled or not.\n   *\n   * @param _block The block to check for recyclability.\n   * @returns True if the block can be recycled. False otherwise.\n   */\n  protected blockIsRecyclable_(_block: BlockSvg): boolean {\n    // By default, recycling is disabled.\n    return false;\n  }\n\n  /**\n   * Puts a previously created block into the recycle bin and moves it to the\n   * top of the workspace. Used during large workspace swaps to limit the number\n   * of new DOM elements we need to create.\n   *\n   * @param block The block to recycle.\n   */\n  private recycleBlock(block: BlockSvg) {\n    const xy = block.getRelativeToSurfaceXY();\n    block.moveBy(-xy.x, -xy.y);\n    this.recycledBlocks.push(block);\n  }\n\n  /**\n   * Add listeners to a block that has been added to the flyout.\n   *\n   * @param root The root node of the SVG group the block is in.\n   * @param block The block to add listeners for.\n   * @param rect The invisible rectangle under the block that acts\n   *     as a mat for that block.\n   */\n  protected addBlockListeners_(\n    root: SVGElement,\n    block: BlockSvg,\n    rect: SVGElement,\n  ) {\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        root,\n        'pointerdown',\n        null,\n        this.blockMouseDown(block),\n      ),\n    );\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        rect,\n        'pointerdown',\n        null,\n        this.blockMouseDown(block),\n      ),\n    );\n    this.listeners.push(\n      browserEvents.bind(root, 'pointerenter', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.addSelect();\n        }\n      }),\n    );\n    this.listeners.push(\n      browserEvents.bind(root, 'pointerleave', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.removeSelect();\n        }\n      }),\n    );\n    this.listeners.push(\n      browserEvents.bind(rect, 'pointerenter', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.addSelect();\n        }\n      }),\n    );\n    this.listeners.push(\n      browserEvents.bind(rect, 'pointerleave', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.removeSelect();\n        }\n      }),\n    );\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block in a non-closing flyout.\n   *\n   * @param block The flyout block to copy.\n   * @returns Function to call when block is clicked.\n   */\n  private blockMouseDown(block: BlockSvg): Function {\n    return (e: PointerEvent) => {\n      const gesture = this.targetWorkspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartBlock(block);\n        gesture.handleFlyoutStart(e, this);\n      }\n    };\n  }\n\n  /**\n   * Pointer down on the flyout background.  Start a vertical scroll drag.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.handleFlyoutStart(e, this);\n    }\n  }\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *    otherwise.\n   * @internal\n   */\n  isBlockCreatable(block: BlockSvg): boolean {\n    return block.isEnabled();\n  }\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   * @internal\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg {\n    let newBlock = null;\n    eventUtils.disable();\n    const variablesBeforeCreation = this.targetWorkspace.getAllVariables();\n    this.targetWorkspace.setResizesEnabled(false);\n    try {\n      newBlock = this.placeNewBlock(originalBlock);\n    } finally {\n      eventUtils.enable();\n    }\n\n    // Close the flyout.\n    this.targetWorkspace.hideChaff();\n\n    const newVariables = Variables.getAddedVariables(\n      this.targetWorkspace,\n      variablesBeforeCreation,\n    );\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.setGroup(true);\n      // Fire a VarCreate event for each (if any) new variable created.\n      for (let i = 0; i < newVariables.length; i++) {\n        const thisVariable = newVariables[i];\n        eventUtils.fire(\n          new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\n        );\n      }\n\n      // Block events come after var events, in case they refer to newly created\n      // variables.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    if (this.autoClose) {\n      this.hide();\n    } else {\n      this.filterForCapacity();\n    }\n    return newBlock;\n  }\n\n  /**\n   * Initialize the given button: move it to the correct location,\n   * add listeners, etc.\n   *\n   * @param button The button to initialize and place.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   */\n  protected initFlyoutButton_(button: FlyoutButton, x: number, y: number) {\n    const buttonSvg = button.createDom();\n    button.moveTo(x, y);\n    button.show();\n    // Clicking on a flyout button or label is a lot like clicking on the\n    // flyout background.\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        buttonSvg,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n      ),\n    );\n\n    this.buttons_.push(button);\n  }\n\n  /**\n   * Create and place a rectangle corresponding to the given block.\n   *\n   * @param block The block to associate the rect to.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   * @param blockHW The height and width of\n   *     the block.\n   * @param index The index into the mats list where this rect should\n   *     be placed.\n   * @returns Newly created SVG element for the rectangle behind\n   *     the block.\n   */\n  protected createRect_(\n    block: BlockSvg,\n    x: number,\n    y: number,\n    blockHW: {height: number; width: number},\n    index: number,\n  ): SVGElement {\n    // Create an invisible rectangle under the block to act as a button.  Just\n    // using the block as a button is poor, since blocks have holes in them.\n    const rect = dom.createSvgElement(Svg.RECT, {\n      'fill-opacity': 0,\n      'x': x,\n      'y': y,\n      'height': blockHW.height,\n      'width': blockHW.width,\n    });\n    (rect as AnyDuringMigration).tooltip = block;\n    Tooltip.bindMouseEvents(rect);\n    // Add the rectangles under the blocks, so that the blocks' tooltips work.\n    this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\n\n    this.rectMap_.set(block, rect);\n    this.mats[index] = rect;\n    return rect;\n  }\n\n  /**\n   * Move a rectangle to sit exactly behind a block, taking into account tabs,\n   * hats, and any other protrusions we invent.\n   *\n   * @param rect The rectangle to move directly behind the block.\n   * @param block The block the rectangle should be behind.\n   */\n  protected moveRectToBlock_(rect: SVGElement, block: BlockSvg) {\n    const blockHW = block.getHeightWidth();\n    rect.setAttribute('width', String(blockHW.width));\n    rect.setAttribute('height', String(blockHW.height));\n\n    const blockXY = block.getRelativeToSurfaceXY();\n    rect.setAttribute('y', String(blockXY.y));\n    rect.setAttribute(\n      'x',\n      String(this.RTL ? blockXY.x - blockHW.width : blockXY.x),\n    );\n  }\n\n  /**\n   * Filter the blocks on the flyout to disable the ones that are above the\n   * capacity limit.  For instance, if the user may only place two more blocks\n   * on the workspace, an \"a + b\" block that has two shadow blocks would be\n   * disabled.\n   */\n  private filterForCapacity() {\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      if (!this.permanentlyDisabled.includes(block)) {\n        const enable = this.targetWorkspace.isCapacityAvailable(\n          common.getBlockTypeCounts(block),\n        );\n        while (block) {\n          block.setDisabledReason(\n            !enable,\n            WORKSPACE_AT_BLOCK_CAPACITY_DISABLED_REASON,\n          );\n          block = block.getNextBlock();\n        }\n      }\n    }\n  }\n\n  /**\n   * Reflow blocks and their mats.\n   */\n  reflow() {\n    if (this.reflowWrapper) {\n      this.workspace_.removeChangeListener(this.reflowWrapper);\n    }\n    this.reflowInternal_();\n    if (this.reflowWrapper) {\n      this.workspace_.addChangeListener(this.reflowWrapper);\n    }\n  }\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or\n   *     by dragging.\n   * @internal\n   */\n  isScrollable(): boolean {\n    return this.workspace_.scrollbar\n      ? this.workspace_.scrollbar.isVisible()\n      : false;\n  }\n\n  /**\n   * Copy a block from the flyout to the workspace and position it correctly.\n   *\n   * @param oldBlock The flyout block to copy.\n   * @returns The new block in the main workspace.\n   */\n  private placeNewBlock(oldBlock: BlockSvg): BlockSvg {\n    const targetWorkspace = this.targetWorkspace;\n    const svgRootOld = oldBlock.getSvgRoot();\n    if (!svgRootOld) {\n      throw Error('oldBlock is not rendered');\n    }\n\n    // Clone the block.\n    const json = this.serializeBlock(oldBlock);\n    // Normally this resizes leading to weird jumps. Save it for terminateDrag.\n    targetWorkspace.setResizesEnabled(false);\n    const block = blocks.append(json, targetWorkspace) as BlockSvg;\n\n    this.positionNewBlock(oldBlock, block);\n\n    return block;\n  }\n\n  /**\n   * Serialize a block to JSON.\n   *\n   * @param block The block to serialize.\n   * @returns A serialized representation of the block.\n   */\n  protected serializeBlock(block: BlockSvg): blocks.State {\n    return blocks.save(block) as blocks.State;\n  }\n\n  /**\n   * Positions a block on the target workspace.\n   *\n   * @param oldBlock The flyout block being copied.\n   * @param block The block to posiiton.\n   */\n  private positionNewBlock(oldBlock: BlockSvg, block: BlockSvg) {\n    const targetWorkspace = this.targetWorkspace;\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\n\n    // The offset in pixels between the flyout workspace's origin and the upper\n    // left corner of the injection div.\n    const flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\n\n    // The position of the old block in flyout workspace coordinates.\n    const oldBlockPos = oldBlock.getRelativeToSurfaceXY();\n    // The position of the old block in pixels relative to the flyout\n    // workspace's origin.\n    oldBlockPos.scale(this.workspace_.scale);\n\n    // The position of the old block in pixels relative to the upper left corner\n    // of the injection div.\n    const oldBlockOffsetPixels = Coordinate.sum(\n      flyoutOffsetPixels,\n      oldBlockPos,\n    );\n\n    // The position of the old block in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset = Coordinate.difference(\n      oldBlockOffsetPixels,\n      mainOffsetPixels,\n    );\n    // The position of the old block in main workspace coordinates.\n    finalOffset.scale(1 / targetWorkspace.scale);\n\n    // No 'reason' provided since events are disabled.\n    block.moveTo(new Coordinate(finalOffset.x, finalOffset.y));\n  }\n}\n\n/**\n * A flyout content item.\n */\nexport interface FlyoutItem {\n  type: FlyoutItemType;\n  button?: FlyoutButton | undefined;\n  block?: BlockSvg | undefined;\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Layout code for a vertical variant of the flyout.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VerticalFlyout\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for a flyout.\n */\nexport class VerticalFlyout extends Flyout {\n  /** The name of the vertical flyout in the registry. */\n  static registryName = 'verticalFlyout';\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.y === 'number') {\n      this.workspace_.scrollY = -(\n        scrollMetrics.top +\n        (scrollMetrics.height - viewMetrics.height) * xyRatio.y\n      );\n    }\n    this.workspace_.translate(\n      this.workspace_.scrollX + absoluteMetrics.left,\n      this.workspace_.scrollY + absoluteMetrics.top,\n    );\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n    let x = 0;\n\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = toolboxMetrics.width;\n        } else {\n          x = viewMetrics.width - this.width_;\n        }\n      } else {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          x = viewMetrics.width;\n        }\n      }\n    } else {\n      if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n        x = 0;\n      } else {\n        // Because the anchor point of the flyout is on the left, but we want\n        // to align the right edge of the flyout with the right edge of the\n        // blocklyDiv, we calculate the full width of the div minus the width\n        // of the flyout.\n        x = viewMetrics.width + absoluteMetrics.left - this.width_;\n      }\n    }\n\n    return x;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    // Y is always 0 since this is a vertical flyout.\n    return 0;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.height_ = targetWorkspaceViewMetrics.height;\n\n    const edgeWidth = this.width_ - this.CORNER_RADIUS;\n    const edgeHeight =\n      targetWorkspaceViewMetrics.height - 2 * this.CORNER_RADIUS;\n    this.setBackgroundPath(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath(width: number, height: number) {\n    const atRight = this.toolboxPosition_ === toolbox.Position.RIGHT;\n    const totalWidth = width + this.CORNER_RADIUS;\n\n    // Decide whether to start on the left or right.\n    const path: Array<string | number> = [\n      'M ' + (atRight ? totalWidth : 0) + ',0',\n    ];\n    // Top.\n    path.push('h', atRight ? -width : width);\n    // Rounded corner.\n    path.push(\n      'a',\n      this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n      0,\n      0,\n      atRight ? 0 : 1,\n      atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n    );\n    // Side closest to workspace.\n    path.push('v', Math.max(0, height));\n    // Rounded corner.\n    path.push(\n      'a',\n      this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n      0,\n      0,\n      atRight ? 0 : 1,\n      atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n    );\n    // Bottom.\n    path.push('h', atRight ? width : -width);\n    path.push('z');\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setY(0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    if (scrollDelta.y) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n      const pos = viewMetrics.top - scrollMetrics.top + scrollDelta.y;\n\n      this.workspace_.scrollbar?.setY(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hideIfOwnerIsInWorkspace(this.workspace_);\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    const cursorX = this.RTL ? margin : margin + this.tabWidth_;\n    let cursorY = margin;\n\n    for (let i = 0, item; (item = contents[i]); i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        if (!block) {\n          continue;\n        }\n        const allBlocks = block.getDescendants(false);\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        const root = block.getSvgRoot();\n        const blockHW = block.getHeightWidth();\n        const moveX = block.outputConnection\n          ? cursorX - this.tabWidth_\n          : cursorX;\n        block.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(\n          block,\n          this.RTL ? moveX - blockHW.width : moveX,\n          cursorY,\n          blockHW,\n          i,\n        );\n\n        this.addBlockListeners_(root, block, rect);\n\n        cursorY += blockHW.height + gaps[i];\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorY += button.height + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for left or right dragging.\n    if (\n      (dragDirection < range && dragDirection > -range) ||\n      dragDirection < -180 + range ||\n      dragDirection > 180 - range\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const left = flyoutRect.left;\n\n    if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n      const width = flyoutRect.width;\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\n    } else {\n      // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute width of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks and buttons to be right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutWidth = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      let width = block.getHeightWidth().width;\n      if (block.outputConnection) {\n        width -= this.tabWidth_;\n      }\n      flyoutWidth = Math.max(flyoutWidth, width);\n    }\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\n      flyoutWidth = Math.max(flyoutWidth, button.width);\n    }\n    flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\n    flyoutWidth *= this.workspace_.scale;\n    flyoutWidth += Scrollbar.scrollbarThickness;\n\n    if (this.width_ !== flyoutWidth) {\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (this.RTL) {\n          // With the flyoutWidth known, right-align the blocks.\n          const oldX = block.getRelativeToSurfaceXY().x;\n          let newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\n          if (!block.outputConnection) {\n            newX -= this.tabWidth_;\n          }\n          block.moveBy(newX - oldX, 0);\n        }\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n      if (this.RTL) {\n        // With the flyoutWidth known, right-align the buttons.\n        for (let i = 0, button; (button = this.buttons_[i]); i++) {\n          const y = button.getPosition().y;\n          const x =\n            flyoutWidth / this.workspace_.scale -\n            button.width -\n            this.MARGIN -\n            this.tabWidth_;\n          button.moveTo(x, y);\n        }\n      }\n\n      // TODO(#7689): Remove this.\n      // Workspace with no scrollbars where this is permanently\n      // open on the left.\n      // If scrollbars exist they properly update the metrics.\n      if (\n        !this.targetWorkspace.scrollbar &&\n        !this.autoClose &&\n        this.targetWorkspace.getFlyout() === this &&\n        this.toolboxPosition_ === toolbox.Position.LEFT\n      ) {\n        this.targetWorkspace.translate(\n          this.targetWorkspace.scrollX + flyoutWidth,\n          this.targetWorkspace.scrollY,\n        );\n      }\n\n      this.width_ = flyoutWidth;\n      this.position();\n      this.targetWorkspace.resizeContents();\n      this.targetWorkspace.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n  registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n  registry.DEFAULT,\n  VerticalFlyout,\n);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Horizontal flyout tray containing blocks which may be created.\n *\n * @class\n */\n// Former goog.module ID: Blockly.HorizontalFlyout\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for a flyout.\n */\nexport class HorizontalFlyout extends Flyout {\n  override horizontalLayout = true;\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.workspace_.scrollX = -(\n        scrollMetrics.left +\n        (scrollMetrics.width - viewMetrics.width) * xyRatio.x\n      );\n    }\n\n    this.workspace_.translate(\n      this.workspace_.scrollX + absoluteMetrics.left,\n      this.workspace_.scrollY + absoluteMetrics.top,\n    );\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    // X is always 0 since this is a horizontal flyout.\n    return 0;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n\n    let y = 0;\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (atTop) {\n          y = toolboxMetrics.height;\n        } else {\n          y = viewMetrics.height - this.height_;\n        }\n      } else {\n        if (atTop) {\n          y = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          y = viewMetrics.height;\n        }\n      }\n    } else {\n      if (atTop) {\n        y = 0;\n      } else {\n        // Because the anchor point of the flyout is on the top, but we want\n        // to align the bottom edge of the flyout with the bottom edge of the\n        // blocklyDiv, we calculate the full height of the div minus the height\n        // of the flyout.\n        y = viewMetrics.height + absoluteMetrics.top - this.height_;\n      }\n    }\n\n    return y;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.width_ = targetWorkspaceViewMetrics.width;\n\n    const edgeWidth = targetWorkspaceViewMetrics.width - 2 * this.CORNER_RADIUS;\n    const edgeHeight = this.height_ - this.CORNER_RADIUS;\n    this.setBackgroundPath(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath(width: number, height: number) {\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // Start at top left.\n    const path: (string | number)[] = [\n      'M 0,' + (atTop ? 0 : this.CORNER_RADIUS),\n    ];\n\n    if (atTop) {\n      // Top.\n      path.push('h', width + 2 * this.CORNER_RADIUS);\n      // Right.\n      path.push('v', height);\n      // Bottom.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        -this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n      );\n      path.push('h', -width);\n      // Left.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        -this.CORNER_RADIUS,\n        -this.CORNER_RADIUS,\n      );\n      path.push('z');\n    } else {\n      // Top.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        this.CORNER_RADIUS,\n        -this.CORNER_RADIUS,\n      );\n      path.push('h', width);\n      // Right.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n      );\n      path.push('v', height);\n      // Bottom.\n      path.push('h', -width - 2 * this.CORNER_RADIUS);\n      // Left.\n      path.push('z');\n    }\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setX(this.RTL ? Infinity : 0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n    const delta = scrollDelta.x || scrollDelta.y;\n\n    if (delta) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n\n      const pos = viewMetrics.left - scrollMetrics.left + delta;\n      this.workspace_.scrollbar?.setX(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hideIfOwnerIsInWorkspace(this.workspace_);\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    let cursorX = margin + this.tabWidth_;\n    const cursorY = margin;\n    if (this.RTL) {\n      contents = contents.reverse();\n    }\n\n    for (let i = 0, item; (item = contents[i]); i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n\n        if (block === undefined || block === null) {\n          continue;\n        }\n\n        const allBlocks = block.getDescendants(false);\n\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        const root = block.getSvgRoot();\n        const blockHW = block.getHeightWidth();\n        // Figure out where to place the block.\n        const tab = block.outputConnection ? this.tabWidth_ : 0;\n        let moveX;\n        if (this.RTL) {\n          moveX = cursorX + blockHW.width;\n        } else {\n          moveX = cursorX - tab;\n        }\n        block.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(block, moveX, cursorY, blockHW, i);\n        cursorX += blockHW.width + gaps[i];\n\n        this.addBlockListeners_(root, block, rect);\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorX += button.width + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for up or down dragging.\n    if (\n      (dragDirection < 90 + range && dragDirection > 90 - range) ||\n      (dragDirection > -90 - range && dragDirection < -90 + range)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const top = flyoutRect.top;\n\n    if (this.toolboxPosition_ === toolbox.Position.TOP) {\n      const height = flyoutRect.height;\n      return new Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\n    } else {\n      // Bottom.\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute height of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutHeight = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\n    }\n    const buttons = this.buttons_;\n    for (let i = 0, button; (button = buttons[i]); i++) {\n      flyoutHeight = Math.max(flyoutHeight, button.height);\n    }\n    flyoutHeight += this.MARGIN * 1.5;\n    flyoutHeight *= this.workspace_.scale;\n    flyoutHeight += Scrollbar.scrollbarThickness;\n\n    if (this.height_ !== flyoutHeight) {\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n\n      // TODO(#7689): Remove this.\n      // Workspace with no scrollbars where this is permanently open on the top.\n      // If scrollbars exist they properly update the metrics.\n      if (\n        !this.targetWorkspace.scrollbar &&\n        !this.autoClose &&\n        this.targetWorkspace.getFlyout() === this &&\n        this.toolboxPosition_ === toolbox.Position.TOP\n      ) {\n        this.targetWorkspace.translate(\n          this.targetWorkspace.scrollX,\n          this.targetWorkspace.scrollY + flyoutHeight,\n        );\n      }\n\n      this.height_ = flyoutHeight;\n      this.position();\n      this.targetWorkspace.resizeContents();\n      this.targetWorkspace.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n  registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n  registry.DEFAULT,\n  HorizontalFlyout,\n);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Variable input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldVariable\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport {Field, FieldConfig, UnattachedFieldError} from './field.js';\nimport {\n  FieldDropdown,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuOption,\n} from './field_dropdown.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as internalConstants from './internal_constants.js';\nimport type {Menu} from './menu.js';\nimport type {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a variable's dropdown field.\n */\nexport class FieldVariable extends FieldDropdown {\n  protected override menuGenerator_: MenuGenerator | undefined;\n  defaultVariableName: string;\n\n  /** The type of the default variable for this field. */\n  private defaultType = '';\n\n  /**\n   * All of the types of variables that will be available in this field's\n   * dropdown.\n   */\n  variableTypes: string[] | null = [];\n  protected override size_: Size;\n\n  /** The variable model associated with this field. */\n  private variable: VariableModel | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param varName The default name for the variable.\n   *     If null, a unique variable name will be generated.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a variable ID  & returns a validated variable\n   *     ID, or null to abort the change.\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown. Will only be used if config is not provided.\n   * @param defaultType The type of variable to create if this field's value\n   *     is not explicitly set.  Defaults to ''. Will only be used if config\n   *     is not provided.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/variable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    varName: string | null | typeof Field.SKIP_SETUP,\n    validator?: FieldVariableValidator,\n    variableTypes?: string[],\n    defaultType?: string,\n    config?: FieldVariableConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * An array of options for a dropdown list,\n     * or a function which generates these options.\n     */\n    this.menuGenerator_ = FieldVariable.dropdownCreate as MenuGenerator;\n\n    /**\n     * The initial variable name passed to this field's constructor, or an\n     * empty string if a name wasn't provided. Used to create the initial\n     * variable.\n     */\n    this.defaultVariableName = typeof varName === 'string' ? varName : '';\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (varName === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setTypes(variableTypes, defaultType);\n    }\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldVariableConfig) {\n    super.configure_(config);\n    this.setTypes(config.variableTypes, config.defaultType);\n  }\n\n  /**\n   * Initialize the model for this field if it has not already been initialized.\n   * If the value has not been set to a variable by the first render, we make up\n   * a variable rather than let the value be invalid.\n   */\n  override initModel() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.variable) {\n      return; // Initialization already happened.\n    }\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      null,\n      this.defaultVariableName,\n      this.defaultType,\n    );\n    // Don't call setValue because we don't want to cause a rerender.\n    this.doValueUpdate_(variable.getId());\n  }\n\n  override shouldAddBorderRect_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    return (\n      super.shouldAddBorderRect_() &&\n      (!this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n        block.type !== 'variables_get')\n    );\n  }\n\n  /**\n   * Initialize this field based on the given XML.\n   *\n   * @param fieldElement The element containing information about the variable\n   *     field's state.\n   */\n  override fromXml(fieldElement: Element) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const id = fieldElement.getAttribute('id');\n    const variableName = fieldElement.textContent;\n    // 'variabletype' should be lowercase, but until July 2019 it was sometimes\n    // recorded as 'variableType'.  Thus we need to check for both.\n    const variableType =\n      fieldElement.getAttribute('variabletype') ||\n      fieldElement.getAttribute('variableType') ||\n      '';\n\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string | undefined'.\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      id,\n      variableName as AnyDuringMigration,\n      variableType,\n    );\n\n    // This should never happen :)\n    if (variableType !== null && variableType !== variable.type) {\n      throw Error(\n        \"Serialized variable type with id '\" +\n          variable.getId() +\n          \"' had type \" +\n          variable.type +\n          ', and ' +\n          'does not match variable field that references it: ' +\n          Xml.domToText(fieldElement) +\n          '.',\n      );\n    }\n\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Serialize this field to XML.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   */\n  override toXml(fieldElement: Element): Element {\n    // Make sure the variable is initialized.\n    this.initModel();\n\n    fieldElement.id = this.variable!.getId();\n    fieldElement.textContent = this.variable!.name;\n    if (this.variable!.type) {\n      fieldElement.setAttribute('variabletype', this.variable!.type);\n    }\n    return fieldElement;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @param doFullSerialization If true, the variable field will serialize the\n   *     full state of the field being referenced (ie ID, name, and type) rather\n   *     than just a reference to it (ie ID).\n   * @returns The state of the variable field.\n   * @internal\n   */\n  override saveState(doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldVariable);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    // Make sure the variable is initialized.\n    this.initModel();\n    const state = {'id': this.variable!.getId()};\n    if (doFullSerialization) {\n      (state as AnyDuringMigration)['name'] = this.variable!.name;\n      (state as AnyDuringMigration)['type'] = this.variable!.type;\n    }\n    return state;\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.loadLegacyState(FieldVariable, state)) {\n      return;\n    }\n    // This is necessary so that blocks in the flyout can have custom var names.\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      state['id'] || null,\n      state['name'],\n      state['type'] || '',\n    );\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  override setSourceBlock(block: Block) {\n    if (block.isShadow()) {\n      throw Error('Variable fields are not allowed to exist on shadow blocks.');\n    }\n    super.setSourceBlock(block);\n  }\n\n  /**\n   * Get the variable's ID.\n   *\n   * @returns Current variable's ID.\n   */\n  override getValue(): string | null {\n    return this.variable ? this.variable.getId() : null;\n  }\n\n  /**\n   * Get the text from this field, which is the selected variable's name.\n   *\n   * @returns The selected variable's name, or the empty string if no variable\n   *     is selected.\n   */\n  override getText(): string {\n    return this.variable ? this.variable.name : '';\n  }\n\n  /**\n   * Get the variable model for the selected variable.\n   * Not guaranteed to be in the variable map on the workspace (e.g. if accessed\n   * after the variable has been deleted).\n   *\n   * @returns The selected variable, or null if none was selected.\n   * @internal\n   */\n  getVariable(): VariableModel | null {\n    return this.variable;\n  }\n\n  /**\n   * Gets the validation function for this field, or null if not set.\n   * Returns null if the variable is not set, because validators should not\n   * run on the initial setValue call, because the field won't be attached to\n   * a block and workspace at that point.\n   *\n   * @returns Validation function, or null.\n   */\n  override getValidator(): FieldVariableValidator | null {\n    // Validators shouldn't operate on the initial setValue call.\n    // Normally this is achieved by calling setValidator after setValue, but\n    // this is not a possibility with variable fields.\n    if (this.variable) {\n      return this.validator_;\n    }\n    return null;\n  }\n\n  /**\n   * Ensure that the ID belongs to a valid variable of an allowed type.\n   *\n   * @param newValue The ID of the new variable to set.\n   * @returns The validated ID, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === null) {\n      return null;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const newId = newValue as string;\n    const variable = Variables.getVariable(block.workspace, newId);\n    if (!variable) {\n      console.warn(\n        \"Variable id doesn't point to a real variable! \" + 'ID was ' + newId,\n      );\n      return null;\n    }\n    // Type Checks.\n    const type = variable.type;\n    if (!this.typeIsAllowed(type)) {\n      console.warn(\"Variable type doesn't match this field!  Type was \" + type);\n      return null;\n    }\n    return newId;\n  }\n\n  /**\n   * Update the value of this variable field, as well as its variable and text.\n   *\n   * The variable ID should be valid at this point, but if a variable field\n   * validator returns a bad ID, this could break.\n   *\n   * @param newId The value to be saved.\n   */\n  protected override doValueUpdate_(newId: string) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.variable = Variables.getVariable(block.workspace, newId as string);\n    super.doValueUpdate_(newId);\n  }\n\n  /**\n   * Check whether the given variable type is allowed on this field.\n   *\n   * @param type The type to check.\n   * @returns True if the type is in the list of allowed types.\n   */\n  private typeIsAllowed(type: string): boolean {\n    const typeList = this.getVariableTypes();\n    if (!typeList) {\n      return true; // If it's null, all types are valid.\n    }\n    for (let i = 0; i < typeList.length; i++) {\n      if (type === typeList[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Return a list of variable types to include in the dropdown.\n   *\n   * @returns Array of variable types.\n   * @throws {Error} if variableTypes is an empty array.\n   */\n  private getVariableTypes(): string[] {\n    let variableTypes = this.variableTypes;\n    if (variableTypes === null) {\n      // If variableTypes is null, return all variable types.\n      if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n        return this.sourceBlock_.workspace.getVariableTypes();\n      }\n    }\n    variableTypes = variableTypes || [''];\n    if (variableTypes.length === 0) {\n      // Throw an error if variableTypes is an empty list.\n      const name = this.getText();\n      throw Error(\n        \"'variableTypes' of field variable \" + name + ' was an empty list',\n      );\n    }\n    return variableTypes;\n  }\n\n  /**\n   * Parse the optional arguments representing the allowed variable types and\n   * the default variable type.\n   *\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown.  If null or undefined, variables of all types will be\n   *     displayed in the dropdown.\n   * @param defaultType The type of the variable to create if this field's\n   *     value is not explicitly set.  Defaults to ''.\n   */\n  private setTypes(variableTypes: string[] | null = null, defaultType = '') {\n    // If you expected that the default type would be the same as the only entry\n    // in the variable types array, tell the Blockly team by commenting on\n    // #1499.\n    // Set the allowable variable types.  Null means all types on the workspace.\n    if (Array.isArray(variableTypes)) {\n      // Make sure the default type is valid.\n      let isInArray = false;\n      for (let i = 0; i < variableTypes.length; i++) {\n        if (variableTypes[i] === defaultType) {\n          isInArray = true;\n        }\n      }\n      if (!isInArray) {\n        throw Error(\n          \"Invalid default type '\" +\n            defaultType +\n            \"' in \" +\n            'the definition of a FieldVariable',\n        );\n      }\n    } else if (variableTypes !== null) {\n      throw Error(\n        \"'variableTypes' was not an array in the definition of \" +\n          'a FieldVariable',\n      );\n    }\n    // Only update the field once all checks pass.\n    this.defaultType = defaultType;\n    this.variableTypes = variableTypes;\n  }\n\n  /**\n   * Refreshes the name of the variable by grabbing the name of the model.\n   * Used when a variable gets renamed, but the ID stays the same. Should only\n   * be called by the block.\n   *\n   * @internal\n   */\n  override refreshVariableName() {\n    this.forceRerender();\n  }\n\n  /**\n   * Handle the selection of an item in the variable dropdown menu.\n   * Special case the 'Rename variable...' and 'Delete variable...' options.\n   * In the rename case, prompt the user for a new name.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected override onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    const id = menuItem.getValue();\n    // Handle special cases.\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      if (id === internalConstants.RENAME_VARIABLE_ID) {\n        // Rename variable.\n        Variables.renameVariable(\n          this.sourceBlock_.workspace,\n          this.variable as VariableModel,\n        );\n        return;\n      } else if (id === internalConstants.DELETE_VARIABLE_ID) {\n        // Delete variable.\n        this.sourceBlock_.workspace.deleteVariableById(this.variable!.getId());\n        return;\n      }\n    }\n    // Handle unspecial case.\n    this.setValue(id);\n  }\n\n  /**\n   * Overrides referencesVariables(), indicating this field refers to a\n   * variable.\n   *\n   * @returns True.\n   * @internal\n   */\n  override referencesVariables(): boolean {\n    return true;\n  }\n\n  /**\n   * Construct a FieldVariable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (variable, variableTypes, and\n   *     defaultType).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldVariableFromJsonConfig,\n  ): FieldVariable {\n    const varName = parsing.replaceMessageReferences(options.variable);\n    // `this` might be a subclass of FieldVariable if that class doesn't\n    // override the static fromJson method.\n    return new this(varName, undefined, undefined, undefined, options);\n  }\n\n  /**\n   * Return a sorted list of variable names for variable dropdown menus.\n   * Include a special option at the end for creating a new variable name.\n   *\n   * @returns Array of variable names/id tuples.\n   */\n  static dropdownCreate(this: FieldVariable): MenuOption[] {\n    if (!this.variable) {\n      throw Error(\n        'Tried to call dropdownCreate on a variable field with no' +\n          ' variable selected.',\n      );\n    }\n    const name = this.getText();\n    let variableModelList: VariableModel[] = [];\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      const variableTypes = this.getVariableTypes();\n      // Get a copy of the list, so that adding rename and new variable options\n      // doesn't modify the workspace's list.\n      for (let i = 0; i < variableTypes.length; i++) {\n        const variableType = variableTypes[i];\n        const variables =\n          this.sourceBlock_.workspace.getVariablesOfType(variableType);\n        variableModelList = variableModelList.concat(variables);\n      }\n    }\n    variableModelList.sort(VariableModel.compareByName);\n\n    const options: [string, string][] = [];\n    for (let i = 0; i < variableModelList.length; i++) {\n      // Set the UUID as the internal representation of the variable.\n      options[i] = [variableModelList[i].name, variableModelList[i].getId()];\n    }\n    options.push([\n      Msg['RENAME_VARIABLE'],\n      internalConstants.RENAME_VARIABLE_ID,\n    ]);\n    if (Msg['DELETE_VARIABLE']) {\n      options.push([\n        Msg['DELETE_VARIABLE'].replace('%1', name),\n        internalConstants.DELETE_VARIABLE_ID,\n      ]);\n    }\n\n    return options;\n  }\n}\n\nfieldRegistry.register('field_variable', FieldVariable);\n\n/**\n * Config options for the variable field.\n */\nexport interface FieldVariableConfig extends FieldConfig {\n  variableTypes?: string[];\n  defaultType?: string;\n}\n\n/**\n * fromJson config options for the variable field.\n */\nexport interface FieldVariableFromJsonConfig extends FieldVariableConfig {\n  variable?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldVariableValidator = FieldDropdownValidator;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Number input field\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldNumber\n\nimport {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as aria from './utils/aria.js';\n\n/**\n * Class for an editable number field.\n */\nexport class FieldNumber extends FieldInput<number> {\n  /** The minimum value this number field can contain. */\n  protected min_ = -Infinity;\n\n  /** The maximum value this number field can contain. */\n  protected max_ = Infinity;\n\n  /** The multiple to which this fields value is rounded. */\n  protected precision_ = 0;\n\n  /**\n   * The number of decimal places to allow, or null to allow any number of\n   * decimal digits.\n   */\n  private decimalPlaces: number | null = null;\n\n  /** Don't spellcheck numbers.  Our validator does a better job. */\n  protected override spellcheck_ = false;\n\n  /**\n   * @param value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param min Minimum value. Will only be used if config is not\n   *     provided.\n   * @param max Maximum value. Will only be used if config is not\n   *     provided.\n   * @param precision Precision for value. Will only be used if config\n   *     is not provided.\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/number#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | number | typeof Field.SKIP_SETUP,\n    min?: string | number | null,\n    max?: string | number | null,\n    precision?: string | number | null,\n    validator?: FieldNumberValidator | null,\n    config?: FieldNumberConfig,\n  ) {\n    // Pass SENTINEL so that we can define properties before value validation.\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setConstraints(min, max, precision);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldNumberConfig) {\n    super.configure_(config);\n    this.setMinInternal(config.min);\n    this.setMaxInternal(config.max);\n    this.setPrecisionInternal(config.precision);\n  }\n\n  /**\n   * Set the maximum, minimum and precision constraints on this field.\n   * Any of these properties may be undefined or NaN to be disabled.\n   * Setting precision (usually a power of 10) enforces a minimum step between\n   * values. That is, the user's value will rounded to the closest multiple of\n   * precision. The least significant digit place is inferred from the\n   * precision. Integers values can be enforces by choosing an integer\n   * precision.\n   *\n   * @param min Minimum value.\n   * @param max Maximum value.\n   * @param precision Precision for value.\n   */\n  setConstraints(\n    min: number | string | undefined | null,\n    max: number | string | undefined | null,\n    precision: number | string | undefined | null,\n  ) {\n    this.setMinInternal(min);\n    this.setMaxInternal(max);\n    this.setPrecisionInternal(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param min Minimum value.\n   */\n  setMin(min: number | string | undefined | null) {\n    this.setMinInternal(min);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param min Minimum value.\n   */\n  private setMinInternal(min: number | string | undefined | null) {\n    if (min == null) {\n      this.min_ = -Infinity;\n    } else {\n      min = Number(min);\n      if (!isNaN(min)) {\n        this.min_ = min;\n      }\n    }\n  }\n\n  /**\n   * Returns the current minimum value this field can contain. Default is\n   * -Infinity.\n   *\n   * @returns The current minimum value this field can contain.\n   */\n  getMin(): number {\n    return this.min_;\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param max Maximum value.\n   */\n  setMax(max: number | string | undefined | null) {\n    this.setMaxInternal(max);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param max Maximum value.\n   */\n  private setMaxInternal(max: number | string | undefined | null) {\n    if (max == null) {\n      this.max_ = Infinity;\n    } else {\n      max = Number(max);\n      if (!isNaN(max)) {\n        this.max_ = max;\n      }\n    }\n  }\n\n  /**\n   * Returns the current maximum value this field can contain. Default is\n   * Infinity.\n   *\n   * @returns The current maximum value this field can contain.\n   */\n  getMax(): number {\n    return this.max_;\n  }\n\n  /**\n   * Sets the precision of this field's value, i.e. the number to which the\n   * value is rounded. Updates the field to reflect.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  setPrecision(precision: number | string | undefined | null) {\n    this.setPrecisionInternal(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the precision of this field's value. Called internally to avoid\n   * value updates.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  private setPrecisionInternal(precision: number | string | undefined | null) {\n    this.precision_ = Number(precision) || 0;\n    let precisionString = String(this.precision_);\n    if (precisionString.includes('e')) {\n      // String() is fast.  But it turns .0000001 into '1e-7'.\n      // Use the much slower toLocaleString to access all the digits.\n      precisionString = this.precision_.toLocaleString('en-US', {\n        maximumFractionDigits: 20,\n      });\n    }\n    const decimalIndex = precisionString.indexOf('.');\n    if (decimalIndex === -1) {\n      // If the precision is 0 (float) allow any number of decimals,\n      // otherwise allow none.\n      this.decimalPlaces = precision ? 0 : null;\n    } else {\n      this.decimalPlaces = precisionString.length - decimalIndex - 1;\n    }\n  }\n\n  /**\n   * Returns the current precision of this field. The precision being the\n   * number to which the field's value is rounded. A precision of 0 means that\n   * the value is not rounded.\n   *\n   * @returns The number to which this field's value is rounded.\n   */\n  getPrecision(): number {\n    return this.precision_;\n  }\n\n  /**\n   * Ensure that the input value is a valid number (must fulfill the\n   * constraints placed on the field).\n   *\n   * @param newValue The input value.\n   * @returns A valid number, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): number | null {\n    if (newValue === null) {\n      return null;\n    }\n\n    // Clean up text.\n    newValue = `${newValue}`;\n    // TODO: Handle cases like 'ten', '1.203,14', etc.\n    // 'O' is sometimes mistaken for '0' by inexperienced users.\n    newValue = newValue.replace(/O/gi, '0');\n    // Strip out thousands separators.\n    newValue = newValue.replace(/,/g, '');\n    // Ignore case of 'Infinity'.\n    newValue = newValue.replace(/infinity/i, 'Infinity');\n\n    // Clean up number.\n    let n = Number(newValue || 0);\n    if (isNaN(n)) {\n      // Invalid number.\n      return null;\n    }\n    // Get the value in range.\n    n = Math.min(Math.max(n, this.min_), this.max_);\n    // Round to nearest multiple of precision.\n    if (this.precision_ && isFinite(n)) {\n      n = Math.round(n / this.precision_) * this.precision_;\n    }\n    // Clean up floating point errors.\n    if (this.decimalPlaces !== null) {\n      n = Number(n.toFixed(this.decimalPlaces));\n    }\n    return n;\n  }\n\n  /**\n   * Create the number input editor widget.\n   *\n   * @returns The newly created number input editor.\n   */\n  protected override widgetCreate_(): HTMLInputElement {\n    const htmlInput = super.widgetCreate_() as HTMLInputElement;\n\n    // Set the accessibility state\n    if (this.min_ > -Infinity) {\n      htmlInput.min = `${this.min_}`;\n      aria.setState(htmlInput, aria.State.VALUEMIN, this.min_);\n    }\n    if (this.max_ < Infinity) {\n      htmlInput.max = `${this.max_}`;\n      aria.setState(htmlInput, aria.State.VALUEMAX, this.max_);\n    }\n    return htmlInput;\n  }\n\n  /**\n   * Construct a FieldNumber from a JSON arg object.\n   *\n   * @param options A JSON object with options (value, min, max, and precision).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldNumberFromJsonConfig): FieldNumber {\n    // `this` might be a subclass of FieldNumber if that class doesn't override\n    // the static fromJson method.\n    return new this(\n      options.value,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      options,\n    );\n  }\n}\n\nfieldRegistry.register('field_number', FieldNumber);\n\nFieldNumber.prototype.DEFAULT_VALUE = 0;\n\n/**\n * Config options for the number field.\n */\nexport interface FieldNumberConfig extends FieldInputConfig {\n  min?: number;\n  max?: number;\n  precision?: number;\n}\n\n/**\n * fromJson config options for the number field.\n */\nexport interface FieldNumberFromJsonConfig extends FieldNumberConfig {\n  value?: number;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldNumberValidator = FieldInputValidator<number>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, serializable text field. Behaves like a\n *    normal label but is serialized to XML. It may only be\n *    edited programmatically.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldLabelSerializable\n\nimport {\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n} from './field_label.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, serializable text field.\n */\nexport class FieldLabelSerializable extends FieldLabel {\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * Serializable fields are saved by the XML renderer, non-serializable\n   * fields are not.  This field should be serialized, but only edited\n   * programmatically.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined.\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label-serializable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(value?: string, textClass?: string, config?: FieldLabelConfig) {\n    super(String(value ?? ''), textClass, config);\n  }\n\n  /**\n   * Construct a FieldLabelSerializable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldLabelFromJsonConfig,\n  ): FieldLabelSerializable {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabelSerializable if that class\n    // doesn't override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label_serializable', FieldLabelSerializable);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Checkbox field.  Checked or not checked.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldCheckbox\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\n\ntype BoolString = 'TRUE' | 'FALSE';\ntype CheckboxBool = BoolString | boolean;\n\n/**\n * Class for a checkbox field.\n */\nexport class FieldCheckbox extends Field<CheckboxBool> {\n  /** Default character for the checkmark. */\n  static readonly CHECK_CHAR = '';\n  private checkChar: string;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * Mouse cursor style when over the hotspot that initiates editability.\n   */\n  override CURSOR = 'default';\n\n  /**\n   * NOTE: The default value is set in `Field`, so maintain that value instead\n   * of overwriting it here or in the constructor.\n   */\n  override value_: boolean | null = this.value_;\n\n  /**\n   * @param value The initial value of the field. Should either be 'TRUE',\n   *     'FALSE' or a boolean. Defaults to 'FALSE'. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value ('TRUE' or 'FALSE') & returns a\n   *     validated value ('TRUE' or 'FALSE'), or null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/checkbox#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: CheckboxBool | typeof Field.SKIP_SETUP,\n    validator?: FieldCheckboxValidator,\n    config?: FieldCheckboxConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * Character for the check mark. Used to apply a different check mark\n     * character to individual fields.\n     */\n    this.checkChar = FieldCheckbox.CHECK_CHAR;\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldCheckboxConfig) {\n    super.configure_(config);\n    if (config.checkCharacter) this.checkChar = config.checkCharacter;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @returns The boolean value held by this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldCheckbox);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValueBoolean();\n  }\n\n  /**\n   * Create the block UI for this checkbox.\n   */\n  override initView() {\n    super.initView();\n\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyCheckbox');\n    textElement.style.display = this.value_ ? 'block' : 'none';\n  }\n\n  override render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_(this.getConstants()!.FIELD_CHECKBOX_X_OFFSET);\n  }\n\n  override getDisplayText_() {\n    return this.checkChar;\n  }\n\n  /**\n   * Set the character used for the check mark.\n   *\n   * @param character The character to use for the check mark, or null to use\n   *     the default.\n   */\n  setCheckCharacter(character: string | null) {\n    this.checkChar = character || FieldCheckbox.CHECK_CHAR;\n    this.forceRerender();\n  }\n\n  /** Toggle the state of the checkbox on click. */\n  protected override showEditor_() {\n    this.setValue(!this.value_);\n  }\n\n  /**\n   * Ensure that the input value is valid ('TRUE' or 'FALSE').\n   *\n   * @param newValue The input value.\n   * @returns A valid value ('TRUE' or 'FALSE), or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): BoolString | null {\n    if (newValue === true || newValue === 'TRUE') {\n      return 'TRUE';\n    }\n    if (newValue === false || newValue === 'FALSE') {\n      return 'FALSE';\n    }\n    return null;\n  }\n\n  /**\n   * Update the value of the field, and update the checkElement.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a either 'TRUE' or 'FALSE'.\n   */\n  protected override doValueUpdate_(newValue: BoolString) {\n    this.value_ = this.convertValueToBool_(newValue);\n    // Update visual.\n    if (this.textElement_) {\n      this.textElement_.style.display = this.value_ ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Get the value of this field, either 'TRUE' or 'FALSE'.\n   *\n   * @returns The value of this field.\n   */\n  override getValue(): BoolString {\n    return this.value_ ? 'TRUE' : 'FALSE';\n  }\n\n  /**\n   * Get the boolean value of this field.\n   *\n   * @returns The boolean value of this field.\n   */\n  getValueBoolean(): boolean | null {\n    return this.value_;\n  }\n\n  /**\n   * Get the text of this field. Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field ('true' or 'false').\n   */\n  override getText(): string {\n    return String(this.convertValueToBool_(this.value_));\n  }\n\n  /**\n   * Convert a value into a pure boolean.\n   *\n   * Converts 'TRUE' to true and 'FALSE' to false correctly, everything else\n   * is cast to a boolean.\n   *\n   * @param value The value to convert.\n   * @returns The converted value.\n   */\n  private convertValueToBool_(value: CheckboxBool | null): boolean {\n    if (typeof value === 'string') return value === 'TRUE';\n    return !!value;\n  }\n\n  /**\n   * Construct a FieldCheckbox from a JSON arg object.\n   *\n   * @param options A JSON object with options (checked).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldCheckboxFromJsonConfig,\n  ): FieldCheckbox {\n    // `this` might be a subclass of FieldCheckbox if that class doesn't\n    // 'override' the static fromJson method.\n    return new this(options.checked, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_checkbox', FieldCheckbox);\n\nFieldCheckbox.prototype.DEFAULT_VALUE = false;\n\n/**\n * Config options for the checkbox field.\n */\nexport interface FieldCheckboxConfig extends FieldConfig {\n  checkCharacter?: string;\n}\n\n/**\n * fromJson config options for the checkbox field.\n */\nexport interface FieldCheckboxFromJsonConfig extends FieldCheckboxConfig {\n  checked?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldCheckboxValidator = FieldValidator<CheckboxBool>;\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IDragTarget} from '../interfaces/i_drag_target.js';\nimport {IDeletable, isDeletable} from '../interfaces/i_deletable.js';\nimport {IDragger} from '../interfaces/i_dragger.js';\nimport {IDraggable} from '../interfaces/i_draggable.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {ComponentManager} from '../component_manager.js';\nimport {IDeleteArea} from '../interfaces/i_delete_area.js';\nimport * as registry from '../registry.js';\nimport * as eventUtils from '../events/utils.js';\nimport * as blockAnimations from '../block_animations.js';\nimport {BlockSvg} from '../block_svg.js';\n\nexport class Dragger implements IDragger {\n  protected startLoc: Coordinate;\n\n  protected dragTarget: IDragTarget | null = null;\n\n  constructor(\n    protected draggable: IDraggable,\n    protected workspace: WorkspaceSvg,\n  ) {\n    this.startLoc = draggable.getRelativeToSurfaceXY();\n  }\n\n  /** Handles any drag startup. */\n  onDragStart(e: PointerEvent) {\n    this.draggable.startDrag(e);\n  }\n\n  /**\n   * Handles calculating where the element should actually be moved to.\n   *\n   * @param totalDelta The total amount in pixel coordinates the mouse has moved\n   *     since the start of the drag.\n   */\n  onDrag(e: PointerEvent, totalDelta: Coordinate) {\n    this.moveDraggable(e, totalDelta);\n    const root = this.getRoot(this.draggable);\n\n    // Must check `wouldDelete` before calling other hooks on drag targets\n    // since we have documented that we would do so.\n    if (isDeletable(root)) {\n      root.setDeleteStyle(this.wouldDeleteDraggable(e, root));\n    }\n    this.updateDragTarget(e);\n  }\n\n  /** Updates the drag target under the pointer (if there is one). */\n  protected updateDragTarget(e: PointerEvent) {\n    const newDragTarget = this.workspace.getDragTarget(e);\n    const root = this.getRoot(this.draggable);\n    if (this.dragTarget !== newDragTarget) {\n      this.dragTarget?.onDragExit(root);\n      newDragTarget?.onDragEnter(root);\n    }\n    newDragTarget?.onDragOver(root);\n    this.dragTarget = newDragTarget;\n  }\n\n  /**\n   * Calculates the correct workspace coordinate for the movable and tells\n   * the draggable to go to that location.\n   */\n  private moveDraggable(e: PointerEvent, totalDelta: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits(totalDelta);\n    const newLoc = Coordinate.sum(this.startLoc, delta);\n    this.draggable.drag(newLoc, e);\n  }\n\n  /**\n   * Returns true if we would delete the draggable if it was dropped\n   * at the current location.\n   */\n  protected wouldDeleteDraggable(\n    e: PointerEvent,\n    rootDraggable: IDraggable & IDeletable,\n  ) {\n    const dragTarget = this.workspace.getDragTarget(e);\n    if (!dragTarget) return false;\n\n    const componentManager = this.workspace.getComponentManager();\n    const isDeleteArea = componentManager.hasCapability(\n      dragTarget.id,\n      ComponentManager.Capability.DELETE_AREA,\n    );\n    if (!isDeleteArea) return false;\n\n    return (dragTarget as IDeleteArea).wouldDelete(rootDraggable);\n  }\n\n  /** Handles any drag cleanup. */\n  onDragEnd(e: PointerEvent) {\n    const origGroup = eventUtils.getGroup();\n    const dragTarget = this.workspace.getDragTarget(e);\n    const root = this.getRoot(this.draggable);\n\n    if (dragTarget) {\n      this.dragTarget?.onDrop(root);\n    }\n\n    if (this.shouldReturnToStart(e, root)) {\n      this.draggable.revertDrag();\n    }\n\n    const wouldDelete = isDeletable(root) && this.wouldDeleteDraggable(e, root);\n\n    // TODO(#8148): use a generalized API instead of an instanceof check.\n    if (wouldDelete && this.draggable instanceof BlockSvg) {\n      blockAnimations.disposeUiEffect(this.draggable.getRootBlock());\n    }\n\n    this.draggable.endDrag(e);\n\n    if (wouldDelete && isDeletable(root)) {\n      // We want to make sure the delete gets grouped with any possible\n      // move event.\n      const newGroup = eventUtils.getGroup();\n      eventUtils.setGroup(origGroup);\n      root.dispose();\n      eventUtils.setGroup(newGroup);\n    }\n  }\n\n  // We need to special case blocks for now so that we look at the root block\n  // instead of the one actually being dragged in most cases.\n  private getRoot(draggable: IDraggable): IDraggable {\n    return draggable instanceof BlockSvg ? draggable.getRootBlock() : draggable;\n  }\n\n  /**\n   * Returns true if we should return the draggable to its original location\n   * at the end of the drag.\n   */\n  protected shouldReturnToStart(e: PointerEvent, rootDraggable: IDraggable) {\n    const dragTarget = this.workspace.getDragTarget(e);\n    if (!dragTarget) return false;\n    return dragTarget.shouldPreventMove(rootDraggable);\n  }\n\n  protected pixelsToWorkspaceUnits(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n      pixelCoord.x / this.workspace.scale,\n      pixelCoord.y / this.workspace.scale,\n    );\n    if (this.workspace.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n}\n\nregistry.register(registry.Type.BLOCK_DRAGGER, registry.DEFAULT, Dragger);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Dragger} from './dragging/dragger.js';\nimport {BlockDragStrategy} from './dragging/block_drag_strategy.js';\nimport {BubbleDragStrategy} from './dragging/bubble_drag_strategy.js';\nimport {CommentDragStrategy} from './dragging/comment_drag_strategy.js';\n\nexport {Dragger, BlockDragStrategy, BubbleDragStrategy, CommentDragStrategy};\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a block drag.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockDrag\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when a block is being manually dragged/dropped.\n */\nexport class BlockDrag extends UiBase {\n  /** The ID of the top-level block being dragged. */\n  blockId?: string;\n\n  /** True if this is the start of a drag, false if this is the end of one. */\n  isStart?: boolean;\n\n  /**\n   * A list of all of the blocks (i.e. all descendants of the block associated\n   * with the block ID) being dragged.\n   */\n  blocks?: Block[];\n\n  override type = eventUtils.BLOCK_DRAG;\n\n  /**\n   * @param opt_block The top block in the stack that is being dragged.\n   *     Undefined for a blank event.\n   * @param opt_isStart Whether this is the start of a block drag.\n   *    Undefined for a blank event.\n   * @param opt_blocks The blocks affected by this drag. Undefined for a blank\n   *     event.\n   */\n  constructor(opt_block?: Block, opt_isStart?: boolean, opt_blocks?: Block[]) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isStart = opt_isStart;\n    this.blocks = opt_blocks;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDragJson {\n    const json = super.toJson() as BlockDragJson;\n    if (this.isStart === undefined) {\n      throw new Error(\n        'Whether this event is the start of a drag is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (this.blockId === undefined) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isStart'] = this.isStart;\n    json['blockId'] = this.blockId;\n    // TODO: I don't think we should actually apply the blocks array to the JSON\n    //   object b/c they have functions and aren't actually serializable.\n    json['blocks'] = this.blocks;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDrag, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses..\n   * @internal\n   */\n  static fromJson(\n    json: BlockDragJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockDrag {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockDrag(),\n    ) as BlockDrag;\n    newEvent.isStart = json['isStart'];\n    newEvent.blockId = json['blockId'];\n    newEvent.blocks = json['blocks'];\n    return newEvent;\n  }\n}\n\nexport interface BlockDragJson extends AbstractEventJson {\n  isStart: boolean;\n  blockId: string;\n  blocks?: Block[];\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BLOCK_DRAG, BlockDrag);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for an event representing an intermediate change to a block's field's\n * value.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockFieldIntermediateChange\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when the value of a block's field has changed but the\n * change is not yet complete, and is expected to be followed by a block change\n * event.\n */\nexport class BlockFieldIntermediateChange extends BlockBase {\n  override type = eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE;\n\n  // Intermediate events do not undo or redo. They may be fired frequently while\n  // the field editor widget is open. A separate BLOCK_CHANGE event is fired\n  // when the editor is closed, which combines all of the field value changes\n  // into a single change that is recorded in the undo history instead. The\n  // intermediate changes are important for reacting to immediate changes, but\n  // some event handlers would prefer to handle the less frequent final events,\n  // like when triggering workspace serialization. Technically, this method of\n  // grouping changes can result in undo perfoming actions out of order if some\n  // other event occurs between opening and closing the field editor, but such\n  // events are unlikely to cause a broken state.\n  override recordUndo = false;\n\n  /** The name of the field that changed. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * @param opt_block The changed block. Undefined for a blank event.\n   * @param opt_name Name of the field affected.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n    opt_block?: Block,\n    opt_name?: string,\n    opt_oldValue?: unknown,\n    opt_newValue?: unknown,\n  ) {\n    super(opt_block);\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.name = opt_name;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockFieldIntermediateChangeJson {\n    const json = super.toJson() as BlockFieldIntermediateChangeJson;\n    if (!this.name) {\n      throw new Error(\n        'The changed field name is undefined. Either pass a ' +\n          'name to the constructor, or call fromJson.',\n      );\n    }\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockFieldIntermediateChange, but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be supertypes\n   *     of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockFieldIntermediateChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockFieldIntermediateChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockFieldIntermediateChange(),\n    ) as BlockFieldIntermediateChange;\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson',\n      );\n    }\n\n    const value = forward ? this.newValue : this.oldValue;\n    const field = block.getField(this.name!);\n    if (field) {\n      field.setValue(value);\n    } else {\n      console.warn(\"Can't set non-existent field: \" + this.name);\n    }\n  }\n}\n\nexport interface BlockFieldIntermediateChangeJson extends BlockBaseJson {\n  name: string;\n  newValue: unknown;\n  oldValue: unknown;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE,\n  BlockFieldIntermediateChange,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block move event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockMove\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\ninterface BlockLocation {\n  parentId?: string;\n  inputName?: string;\n  coordinate?: Coordinate;\n}\n\n/**\n * Notifies listeners when a block is moved. This could be from one\n * connection to another, or from one location on the workspace to another.\n */\nexport class BlockMove extends BlockBase {\n  override type = eventUtils.BLOCK_MOVE;\n\n  /** The ID of the old parent block. Undefined if it was a top-level block. */\n  oldParentId?: string;\n\n  /**\n   * The name of the old input. Undefined if it was a top-level block or the\n   * parent's next block.\n   */\n  oldInputName?: string;\n\n  /**\n   * The old X and Y workspace coordinates of the block if it was a top level\n   * block. Undefined if it was not a top level block.\n   */\n  oldCoordinate?: Coordinate;\n\n  /** The ID of the new parent block. Undefined if it is a top-level block. */\n  newParentId?: string;\n\n  /**\n   * The name of the new input. Undefined if it is a top-level block or the\n   * parent's next block.\n   */\n  newInputName?: string;\n\n  /**\n   * The new X and Y workspace coordinates of the block if it is a top-level\n   * block. Undefined if it is not a top level block.\n   */\n  newCoordinate?: Coordinate;\n\n  /**\n   * An explanation of what this move is for.  Known values include:\n   *  'drag' -- A drag operation completed.\n   *  'bump' -- Block got bumped away from an invalid connection.\n   *  'snap' -- Block got shifted to line up with the grid.\n   *  'inbounds' -- Block got pushed back into a non-scrolling workspace.\n   *  'connect' -- Block got connected to another block.\n   *  'disconnect' -- Block got disconnected from another block.\n   *  'create' -- Block created via XML.\n   *  'cleanup' -- Workspace aligned top-level blocks.\n   * Event merging may create multiple reasons: ['drag', 'bump', 'snap'].\n   */\n  reason?: string[];\n\n  /** @param opt_block The moved block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    const location = this.currentLocation_();\n    this.oldParentId = location.parentId;\n    this.oldInputName = location.inputName;\n    this.oldCoordinate = location.coordinate;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockMoveJson {\n    const json = super.toJson() as BlockMoveJson;\n    json['oldParentId'] = this.oldParentId;\n    json['oldInputName'] = this.oldInputName;\n    if (this.oldCoordinate) {\n      json['oldCoordinate'] =\n        `${Math.round(this.oldCoordinate.x)}, ` +\n        `${Math.round(this.oldCoordinate.y)}`;\n    }\n    json['newParentId'] = this.newParentId;\n    json['newInputName'] = this.newInputName;\n    if (this.newCoordinate) {\n      json['newCoordinate'] =\n        `${Math.round(this.newCoordinate.x)}, ` +\n        `${Math.round(this.newCoordinate.y)}`;\n    }\n    if (this.reason) {\n      json['reason'] = this.reason;\n    }\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockMove, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockMove(),\n    ) as BlockMove;\n    newEvent.oldParentId = json['oldParentId'];\n    newEvent.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      newEvent.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    newEvent.newParentId = json['newParentId'];\n    newEvent.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      newEvent.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['reason'] !== undefined) {\n      newEvent.reason = json['reason'];\n    }\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /** Record the block's new location.  Called after the move. */\n  recordNew() {\n    const location = this.currentLocation_();\n    this.newParentId = location.parentId;\n    this.newInputName = location.inputName;\n    this.newCoordinate = location.coordinate;\n  }\n\n  /**\n   * Set the reason for a move event.\n   *\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  setReason(reason: string[]) {\n    this.reason = reason;\n  }\n\n  /**\n   * Returns the parentId and input if the block is connected,\n   *   or the XY location if disconnected.\n   *\n   * @returns Collection of location info.\n   */\n  private currentLocation_(): BlockLocation {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The block associated with the block move event ' +\n          'could not be found',\n      );\n    }\n    const location = {} as BlockLocation;\n    const parent = block.getParent();\n    if (parent) {\n      location.parentId = parent.id;\n      const input = parent.getInputWithBlock(block);\n      if (input) {\n        location.inputName = input.name;\n      }\n    } else {\n      location.coordinate = block.getRelativeToSurfaceXY();\n    }\n    return location;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return (\n      this.oldParentId === this.newParentId &&\n      this.oldInputName === this.newInputName &&\n      Coordinate.equals(this.oldCoordinate, this.newCoordinate)\n    );\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      console.warn(\"Can't move non-existent block: \" + this.blockId);\n      return;\n    }\n    const parentId = forward ? this.newParentId : this.oldParentId;\n    const inputName = forward ? this.newInputName : this.oldInputName;\n    const coordinate = forward ? this.newCoordinate : this.oldCoordinate;\n    let parentBlock: Block | null;\n    if (parentId) {\n      parentBlock = workspace.getBlockById(parentId);\n      if (!parentBlock) {\n        console.warn(\"Can't connect to non-existent block: \" + parentId);\n        return;\n      }\n    }\n    if (block.getParent()) {\n      block.unplug();\n    }\n    if (coordinate) {\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(coordinate.x - xy.x, coordinate.y - xy.y, this.reason);\n    } else {\n      let blockConnection = block.outputConnection;\n      if (\n        !blockConnection ||\n        (block.previousConnection && block.previousConnection.isConnected())\n      ) {\n        blockConnection = block.previousConnection;\n      }\n      let parentConnection;\n      const connectionType = blockConnection?.type;\n      if (inputName) {\n        const input = parentBlock!.getInput(inputName);\n        if (input) {\n          parentConnection = input.connection;\n        }\n      } else if (connectionType === ConnectionType.PREVIOUS_STATEMENT) {\n        parentConnection = parentBlock!.nextConnection;\n      }\n      if (parentConnection && blockConnection) {\n        blockConnection.connect(parentConnection);\n      } else {\n        console.warn(\"Can't connect to non-existent input: \" + inputName);\n      }\n    }\n  }\n}\n\nexport interface BlockMoveJson extends BlockBaseJson {\n  oldParentId?: string;\n  oldInputName?: string;\n  oldCoordinate?: string;\n  newParentId?: string;\n  newInputName?: string;\n  newCoordinate?: string;\n  reason?: string[];\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MOVE, BlockMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of bubble open.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BubbleOpen\n\nimport type {AbstractEventJson} from './events_abstract.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as registry from '../registry.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Class for a bubble open event.\n */\nexport class BubbleOpen extends UiBase {\n  /** The ID of the block the bubble is attached to. */\n  blockId?: string;\n\n  /** True if the bubble is opening, false if closing. */\n  isOpen?: boolean;\n\n  /** The type of bubble; one of 'mutator', 'comment', or 'warning'. */\n  bubbleType?: BubbleType;\n\n  override type = eventUtils.BUBBLE_OPEN;\n\n  /**\n   * @param opt_block The associated block. Undefined for a blank event.\n   * @param opt_isOpen Whether the bubble is opening (false if closing).\n   *     Undefined for a blank event.\n   * @param opt_bubbleType The type of bubble. One of 'mutator', 'comment' or\n   *     'warning'. Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: BlockSvg,\n    opt_isOpen?: boolean,\n    opt_bubbleType?: BubbleType,\n  ) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isOpen = opt_isOpen;\n    this.bubbleType = opt_bubbleType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BubbleOpenJson {\n    const json = super.toJson() as BubbleOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n        'Whether this event is for opening the bubble is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (!this.bubbleType) {\n      throw new Error(\n        'The type of bubble is undefined. Either pass the ' +\n          'value to the constructor, or call fromJson',\n      );\n    }\n    json['isOpen'] = this.isOpen;\n    json['bubbleType'] = this.bubbleType;\n    json['blockId'] = this.blockId || '';\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BubbleOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BubbleOpenJson,\n    workspace: Workspace,\n    event?: any,\n  ): BubbleOpen {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BubbleOpen(),\n    ) as BubbleOpen;\n    newEvent.isOpen = json['isOpen'];\n    newEvent.bubbleType = json['bubbleType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum BubbleType {\n  MUTATOR = 'mutator',\n  COMMENT = 'comment',\n  WARNING = 'warning',\n}\n\nexport interface BubbleOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n  bubbleType: BubbleType;\n  blockId: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BUBBLE_OPEN, BubbleOpen);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for comment events.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentBase\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as comments from '../serialization/workspace_comments.js';\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentDelete} from './events_comment_delete.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Abstract class for a comment event.\n */\nexport class CommentBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the comment that this event references. */\n  commentId?: string;\n\n  /**\n   * @param opt_comment The comment this event corresponds to.  Undefined for a\n   *     blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super();\n    /** Whether or not an event is blank. */\n    this.isBlank = !opt_comment;\n\n    if (!opt_comment) return;\n\n    this.commentId = opt_comment.id;\n    this.workspaceId = opt_comment.workspace.id;\n    this.group = eventUtils.getGroup();\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentBaseJson {\n    const json = super.toJson() as CommentBaseJson;\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['commentId'] = this.commentId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentBase, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentBase(),\n    ) as CommentBase;\n    newEvent.commentId = json['commentId'];\n    return newEvent;\n  }\n\n  /**\n   * Helper function for Comment[Create|Delete]\n   *\n   * @param event The event to run.\n   * @param create if True then Create, if False then Delete\n   */\n  static CommentCreateDeleteHelper(\n    event: CommentCreate | CommentDelete,\n    create: boolean,\n  ) {\n    const workspace = event.getEventWorkspace_();\n    if (create) {\n      if (!event.json) {\n        throw new Error('Encountered a comment event without proper json');\n      }\n      comments.append(event.json, workspace);\n    } else {\n      if (!event.commentId) {\n        throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n            'the constructor, or call fromJson',\n        );\n      }\n      const comment = workspace.getCommentById(event.commentId);\n      if (comment) {\n        comment.dispose();\n      } else {\n        console.warn(\"Can't delete non-existent comment: \" + event.commentId);\n      }\n    }\n  }\n}\n\nexport interface CommentBaseJson extends AbstractEventJson {\n  commentId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment change event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentChange\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that the contents of a workspace comment has changed.\n */\nexport class CommentChange extends CommentBase {\n  override type = eventUtils.COMMENT_CHANGE;\n\n  // TODO(#6774): We should remove underscores.\n  /** The previous contents of the comment. */\n  oldContents_?: string;\n\n  /** The new contents of the comment. */\n  newContents_?: string;\n\n  /**\n   * @param opt_comment The comment that is being changed.  Undefined for a\n   *     blank event.\n   * @param opt_oldContents Previous contents of the comment.\n   * @param opt_newContents New contents of the comment.\n   */\n  constructor(\n    opt_comment?: WorkspaceComment,\n    opt_oldContents?: string,\n    opt_newContents?: string,\n  ) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.oldContents_ =\n      typeof opt_oldContents === 'undefined' ? '' : opt_oldContents;\n    this.newContents_ =\n      typeof opt_newContents === 'undefined' ? '' : opt_newContents;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentChangeJson {\n    const json = super.toJson() as CommentChangeJson;\n    if (!this.oldContents_) {\n      throw new Error(\n        'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newContents_) {\n      throw new Error(\n        'The new contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['oldContents'] = this.oldContents_;\n    json['newContents'] = this.newContents_;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentChange(),\n    ) as CommentChange;\n    newEvent.oldContents_ = json['oldContents'];\n    newEvent.newContents_ = json['newContents'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldContents_ === this.newContents_;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    // TODO: Remove the cast when we fix the type of getCommentById.\n    const comment = workspace.getCommentById(\n      this.commentId,\n    ) as unknown as WorkspaceComment;\n    if (!comment) {\n      console.warn(\"Can't change non-existent comment: \" + this.commentId);\n      return;\n    }\n    const contents = forward ? this.newContents_ : this.oldContents_;\n    if (contents === undefined) {\n      if (forward) {\n        throw new Error(\n          'The new contents is undefined. Either pass a value to ' +\n            'the constructor, or call fromJson',\n        );\n      }\n      throw new Error(\n        'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    comment.setText(contents);\n  }\n}\n\nexport interface CommentChangeJson extends CommentBaseJson {\n  oldContents: string;\n  newContents: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_CHANGE,\n  CommentChange,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentCreate\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as comments from '../serialization/workspace_comments.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a workspace comment was created.\n */\nexport class CommentCreate extends CommentBase {\n  override type = eventUtils.COMMENT_CREATE;\n\n  /** The XML representation of the created workspace comment. */\n  xml?: Element | DocumentFragment;\n\n  /** The JSON representation of the created workspace comment. */\n  json?: comments.State;\n\n  /**\n   * @param opt_comment The created comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.xml = Xml.saveWorkspaceComment(opt_comment);\n    this.json = comments.save(opt_comment, {addCoordinates: true});\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCreateJson {\n    const json = super.toJson() as CommentCreateJson;\n    if (!this.xml) {\n      throw new Error(\n        'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The comment JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['json'] = this.json;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentCreate(),\n    ) as CommentCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.json = json['json'];\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, forward);\n  }\n}\n\nexport interface CommentCreateJson extends CommentBaseJson {\n  xml: string;\n  json: object;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_CREATE,\n  CommentCreate,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment deletion event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentDelete\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as comments from '../serialization/workspace_comments.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a workspace comment has been deleted.\n */\nexport class CommentDelete extends CommentBase {\n  override type = eventUtils.COMMENT_DELETE;\n\n  /** The XML representation of the deleted workspace comment. */\n  xml?: Element;\n\n  /** The JSON representation of the created workspace comment. */\n  json?: comments.State;\n\n  /**\n   * @param opt_comment The deleted comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.xml = Xml.saveWorkspaceComment(opt_comment);\n    this.json = comments.save(opt_comment, {addCoordinates: true});\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, !forward);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentDeleteJson {\n    const json = super.toJson() as CommentDeleteJson;\n    if (!this.xml) {\n      throw new Error(\n        'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The comment JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['json'] = this.json;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentDelete(),\n    ) as CommentDelete;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.json = json['json'];\n    return newEvent;\n  }\n}\n\nexport interface CommentDeleteJson extends CommentBaseJson {\n  xml: string;\n  json: object;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_DELETE,\n  CommentDelete,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment move event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentMove\n\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a workspace comment has moved.\n */\nexport class CommentMove extends CommentBase {\n  override type = eventUtils.COMMENT_MOVE;\n\n  /** The comment that is being moved. */\n  comment_?: WorkspaceComment;\n\n  // TODO(#6774): We should remove underscores.\n  /** The location of the comment before the move, in workspace coordinates. */\n  oldCoordinate_?: Coordinate;\n\n  /** The location of the comment after the move, in workspace coordinates. */\n  newCoordinate_?: Coordinate;\n\n  /**\n   * An explanation of what this move is for.  Known values include:\n   *  'drag' -- A drag operation completed.\n   *  'snap' -- Comment got shifted to line up with the grid.\n   *  'inbounds' -- Block got pushed back into a non-scrolling workspace.\n   *  'create' -- Block created via deserialization.\n   *  'cleanup' -- Workspace aligned top-level blocks.\n   * Event merging may create multiple reasons: ['drag', 'inbounds', 'snap'].\n   */\n  reason?: string[];\n\n  /**\n   * @param opt_comment The comment that is being moved.  Undefined for a blank\n   *     event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.comment_ = opt_comment;\n    this.oldCoordinate_ = opt_comment.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Record the comment's new location.  Called after the move.  Can only be\n   * called once.\n   */\n  recordNew() {\n    if (this.newCoordinate_) {\n      throw Error(\n        'Tried to record the new position of a comment on the ' +\n          'same event twice.',\n      );\n    }\n    if (!this.comment_) {\n      throw new Error(\n        'The comment is undefined. Pass a comment to ' +\n          'the constructor if you want to use the record functionality',\n      );\n    }\n    this.newCoordinate_ = this.comment_.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Sets the reason for a move event.\n   *\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  setReason(reason: string[]) {\n    this.reason = reason;\n  }\n\n  /**\n   * Override the location before the move.  Use this if you don't create the\n   * event until the end of the move, but you know the original location.\n   *\n   * @param xy The location before the move, in workspace coordinates.\n   */\n  setOldCoordinate(xy: Coordinate) {\n    this.oldCoordinate_ = xy;\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentMoveJson {\n    const json = super.toJson() as CommentMoveJson;\n    if (!this.oldCoordinate_) {\n      throw new Error(\n        'The old comment position is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newCoordinate_) {\n      throw new Error(\n        'The new comment position is undefined. Either call recordNew, or ' +\n          'call fromJson',\n      );\n    }\n    json['oldCoordinate'] =\n      `${Math.round(this.oldCoordinate_.x)}, ` +\n      `${Math.round(this.oldCoordinate_.y)}`;\n    json['newCoordinate'] =\n      Math.round(this.newCoordinate_.x) +\n      ',' +\n      Math.round(this.newCoordinate_.y);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentMove(),\n    ) as CommentMove;\n    let xy = json['oldCoordinate'].split(',');\n    newEvent.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    newEvent.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return Coordinate.equals(this.oldCoordinate_, this.newCoordinate_);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    // TODO: Remove cast when we update getCommentById.\n    const comment = workspace.getCommentById(\n      this.commentId,\n    ) as unknown as WorkspaceComment;\n    if (!comment) {\n      console.warn(\"Can't move non-existent comment: \" + this.commentId);\n      return;\n    }\n\n    const target = forward ? this.newCoordinate_ : this.oldCoordinate_;\n    if (!target) {\n      throw new Error(\n        'Either oldCoordinate_ or newCoordinate_ is undefined. ' +\n          'Either pass a comment to the constructor and call recordNew, ' +\n          'or call fromJson',\n      );\n    }\n    comment.moveTo(target);\n  }\n}\n\nexport interface CommentMoveJson extends CommentBaseJson {\n  oldCoordinate: string;\n  newCoordinate: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.COMMENT_MOVE, CommentMove);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as registry from '../registry.js';\nimport {WorkspaceComment} from '../comments/workspace_comment.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\nexport class CommentCollapse extends CommentBase {\n  override type = eventUtils.COMMENT_COLLAPSE;\n\n  constructor(\n    comment?: WorkspaceComment,\n    public newCollapsed?: boolean,\n  ) {\n    super(comment);\n\n    if (!comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCollapseJson {\n    const json = super.toJson() as CommentCollapseJson;\n    if (this.newCollapsed === undefined) {\n      throw new Error(\n        'The new collapse value undefined. Either call recordNew, or ' +\n          'call fromJson',\n      );\n    }\n    json['newCollapsed'] = this.newCollapsed;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCollapse, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentCollapseJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentCollapse {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentCollapse(),\n    ) as CommentCollapse;\n    newEvent.newCollapsed = json.newCollapsed;\n    return newEvent;\n  }\n\n  /**\n   * Run a collapse event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    // TODO: Remove cast when we update getCommentById.\n    const comment = workspace.getCommentById(\n      this.commentId,\n    ) as unknown as WorkspaceComment;\n    if (!comment) {\n      console.warn(\n        \"Can't collapse or uncollapse non-existent comment: \" + this.commentId,\n      );\n      return;\n    }\n\n    comment.setCollapsed(forward ? !!this.newCollapsed : !this.newCollapsed);\n  }\n}\n\nexport interface CommentCollapseJson extends CommentBaseJson {\n  newCollapsed: boolean;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_COLLAPSE,\n  CommentCollapse,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of selecting an item on the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ToolboxItemSelect\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a toolbox item has been selected.\n */\nexport class ToolboxItemSelect extends UiBase {\n  /** The previously selected toolbox item. */\n  oldItem?: string;\n\n  /** The newly selected toolbox item. */\n  newItem?: string;\n\n  override type = eventUtils.TOOLBOX_ITEM_SELECT;\n\n  /**\n   * @param opt_oldItem The previously selected toolbox item.\n   *     Undefined for a blank event.\n   * @param opt_newItem The newly selected toolbox item. Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    opt_oldItem?: string | null,\n    opt_newItem?: string | null,\n    opt_workspaceId?: string,\n  ) {\n    super(opt_workspaceId);\n    this.oldItem = opt_oldItem ?? undefined;\n    this.newItem = opt_newItem ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ToolboxItemSelectJson {\n    const json = super.toJson() as ToolboxItemSelectJson;\n    json['oldItem'] = this.oldItem;\n    json['newItem'] = this.newItem;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ToolboxItemSelect, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ToolboxItemSelectJson,\n    workspace: Workspace,\n    event?: any,\n  ): ToolboxItemSelect {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ToolboxItemSelect(),\n    ) as ToolboxItemSelect;\n    newEvent.oldItem = json['oldItem'];\n    newEvent.newItem = json['newItem'];\n    return newEvent;\n  }\n}\n\nexport interface ToolboxItemSelectJson extends AbstractEventJson {\n  oldItem?: string;\n  newItem?: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.TOOLBOX_ITEM_SELECT,\n  ToolboxItemSelect,\n);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a finished loading workspace event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.FinishedLoading\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {Abstract as AbstractEvent} from './events_abstract.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when the workspace has finished deserializing from\n * JSON/XML.\n */\nexport class FinishedLoading extends AbstractEvent {\n  override isBlank = true;\n  override recordUndo = false;\n  override type = eventUtils.FINISHED_LOADING;\n\n  /**\n   * @param opt_workspace The workspace that has finished loading.  Undefined\n   *     for a blank event.\n   */\n  constructor(opt_workspace?: Workspace) {\n    super();\n    this.isBlank = !!opt_workspace;\n\n    if (!opt_workspace) return;\n\n    this.workspaceId = opt_workspace.id;\n  }\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.FINISHED_LOADING,\n  FinishedLoading,\n);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events\n\nimport {Abstract, AbstractEventJson} from './events_abstract.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {BlockChange, BlockChangeJson} from './events_block_change.js';\nimport {BlockCreate, BlockCreateJson} from './events_block_create.js';\nimport {BlockDelete, BlockDeleteJson} from './events_block_delete.js';\nimport {BlockDrag, BlockDragJson} from './events_block_drag.js';\nimport {\n  BlockFieldIntermediateChange,\n  BlockFieldIntermediateChangeJson,\n} from './events_block_field_intermediate_change.js';\nimport {BlockMove, BlockMoveJson} from './events_block_move.js';\nimport {BubbleOpen, BubbleOpenJson, BubbleType} from './events_bubble_open.js';\nimport {Click, ClickJson, ClickTarget} from './events_click.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {CommentChange, CommentChangeJson} from './events_comment_change.js';\nimport {CommentCreate, CommentCreateJson} from './events_comment_create.js';\nimport {CommentDelete} from './events_comment_delete.js';\nimport {CommentMove, CommentMoveJson} from './events_comment_move.js';\nimport {\n  CommentCollapse,\n  CommentCollapseJson,\n} from './events_comment_collapse.js';\nimport {MarkerMove, MarkerMoveJson} from './events_marker_move.js';\nimport {Selected, SelectedJson} from './events_selected.js';\nimport {ThemeChange, ThemeChangeJson} from './events_theme_change.js';\nimport {\n  ToolboxItemSelect,\n  ToolboxItemSelectJson,\n} from './events_toolbox_item_select.js';\nimport {TrashcanOpen, TrashcanOpenJson} from './events_trashcan_open.js';\nimport {UiBase} from './events_ui_base.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {VarCreate, VarCreateJson} from './events_var_create.js';\nimport {VarDelete, VarDeleteJson} from './events_var_delete.js';\nimport {VarRename, VarRenameJson} from './events_var_rename.js';\nimport {ViewportChange, ViewportChangeJson} from './events_viewport.js';\nimport * as eventUtils from './utils.js';\nimport {FinishedLoading} from './workspace_events.js';\n\n// Events.\nexport {Abstract};\nexport {AbstractEventJson};\nexport {BubbleOpen};\nexport {BubbleOpenJson};\nexport {BubbleType};\nexport {BlockBase};\nexport {BlockBaseJson};\nexport {BlockChange};\nexport {BlockChangeJson};\nexport {BlockCreate};\nexport {BlockCreateJson};\nexport {BlockDelete};\nexport {BlockDeleteJson};\nexport {BlockDrag};\nexport {BlockDragJson};\nexport {BlockFieldIntermediateChange};\nexport {BlockFieldIntermediateChangeJson};\nexport {BlockMove};\nexport {BlockMoveJson};\nexport {Click};\nexport {ClickJson};\nexport {ClickTarget};\nexport {CommentBase};\nexport {CommentBaseJson};\nexport {CommentChange};\nexport {CommentChangeJson};\nexport {CommentCreate};\nexport {CommentCreateJson};\nexport {CommentDelete};\nexport {CommentMove};\nexport {CommentMoveJson};\nexport {CommentCollapse};\nexport {CommentCollapseJson};\nexport {FinishedLoading};\nexport {MarkerMove};\nexport {MarkerMoveJson};\nexport {Selected};\nexport {SelectedJson};\nexport {ThemeChange};\nexport {ThemeChangeJson};\nexport {ToolboxItemSelect};\nexport {ToolboxItemSelectJson};\nexport {TrashcanOpen};\nexport {TrashcanOpenJson};\nexport {UiBase};\nexport {VarBase};\nexport {VarBaseJson};\nexport {VarCreate};\nexport {VarCreateJson};\nexport {VarDelete};\nexport {VarDeleteJson};\nexport {VarRename};\nexport {VarRenameJson};\nexport {ViewportChange};\nexport {ViewportChangeJson};\n\n// Event types.\nexport const BLOCK_CHANGE = eventUtils.BLOCK_CHANGE;\nexport const BLOCK_CREATE = eventUtils.BLOCK_CREATE;\nexport const BLOCK_DELETE = eventUtils.BLOCK_DELETE;\nexport const BLOCK_DRAG = eventUtils.BLOCK_DRAG;\nexport const BLOCK_MOVE = eventUtils.BLOCK_MOVE;\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\n  eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE;\nexport const BUBBLE_OPEN = eventUtils.BUBBLE_OPEN;\nexport type BumpEvent = eventUtils.BumpEvent;\nexport const BUMP_EVENTS = eventUtils.BUMP_EVENTS;\nexport const CHANGE = eventUtils.CHANGE;\nexport const CLICK = eventUtils.CLICK;\nexport const COMMENT_CHANGE = eventUtils.COMMENT_CHANGE;\nexport const COMMENT_CREATE = eventUtils.COMMENT_CREATE;\nexport const COMMENT_DELETE = eventUtils.COMMENT_DELETE;\nexport const COMMENT_MOVE = eventUtils.COMMENT_MOVE;\nexport const CREATE = eventUtils.CREATE;\nexport const DELETE = eventUtils.DELETE;\nexport const FINISHED_LOADING = eventUtils.FINISHED_LOADING;\nexport const MARKER_MOVE = eventUtils.MARKER_MOVE;\nexport const MOVE = eventUtils.MOVE;\nexport const SELECTED = eventUtils.SELECTED;\nexport const THEME_CHANGE = eventUtils.THEME_CHANGE;\nexport const TOOLBOX_ITEM_SELECT = eventUtils.TOOLBOX_ITEM_SELECT;\nexport const TRASHCAN_OPEN = eventUtils.TRASHCAN_OPEN;\nexport const UI = eventUtils.UI;\nexport const VAR_CREATE = eventUtils.VAR_CREATE;\nexport const VAR_DELETE = eventUtils.VAR_DELETE;\nexport const VAR_RENAME = eventUtils.VAR_RENAME;\nexport const VIEWPORT_CHANGE = eventUtils.VIEWPORT_CHANGE;\n\n// Event utils.\nexport const clearPendingUndo = eventUtils.clearPendingUndo;\nexport const disable = eventUtils.disable;\nexport const enable = eventUtils.enable;\nexport const filter = eventUtils.filter;\nexport const fire = eventUtils.fire;\nexport const fromJson = eventUtils.fromJson;\nexport const getDescendantIds = eventUtils.getDescendantIds;\nexport const get = eventUtils.get;\nexport const getGroup = eventUtils.getGroup;\nexport const getRecordUndo = eventUtils.getRecordUndo;\nexport const isEnabled = eventUtils.isEnabled;\nexport const setGroup = eventUtils.setGroup;\nexport const setRecordUndo = eventUtils.setRecordUndo;\nexport const disableOrphans = eventUtils.disableOrphans;\n", "/** @file Re-exports of Blockly.zelos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\nexport {\n  BottomRow,\n  ConstantProvider,\n  Drawer,\n  MarkerSvg,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  RightConnectionShape,\n  StatementInput,\n  TopRow,\n};\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport {CommentView} from './comments/comment_view.js';\nexport {WorkspaceComment} from './comments/workspace_comment.js';\nexport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubbles/bubble.js';\nimport {TextBubble} from './bubbles/text_bubble.js';\nimport {TextInputBubble} from './bubbles/textinput_bubble.js';\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\n\nexport {Bubble, TextBubble, TextInputBubble, MiniWorkspaceBubble};\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.BlocklyOptions\n\nimport type {Theme, ITheme} from './theme.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {ToolboxDefinition} from './utils/toolbox.js';\n\n/**\n * Blockly options.\n */\nexport interface BlocklyOptions {\n  collapse?: boolean;\n  comments?: boolean;\n  css?: boolean;\n  disable?: boolean;\n  grid?: GridOptions;\n  horizontalLayout?: boolean;\n  maxBlocks?: number;\n  maxInstances?: {[blockType: string]: number};\n  media?: string;\n  modalInputs?: boolean;\n  move?: MoveOptions;\n  oneBasedIndex?: boolean;\n  readOnly?: boolean;\n  renderer?: string;\n  rendererOverrides?: {[rendererConstant: string]: any};\n  rtl?: boolean;\n  scrollbars?: ScrollbarOptions | boolean;\n  sounds?: boolean;\n  theme?: Theme | string | ITheme;\n  toolbox?: string | ToolboxDefinition | Element;\n  toolboxPosition?: string;\n  trashcan?: boolean;\n  maxTrashcanContents?: number;\n  plugins?: {[key: string]: (new (...p1: any[]) => any) | string};\n  zoom?: ZoomOptions;\n  parentWorkspace?: WorkspaceSvg;\n}\n\nexport interface GridOptions {\n  colour?: string;\n  length?: number;\n  snap?: boolean;\n  spacing?: number;\n}\n\nexport interface MoveOptions {\n  drag?: boolean;\n  scrollbars?: boolean | ScrollbarOptions;\n  wheel?: boolean;\n}\n\nexport interface ScrollbarOptions {\n  horizontal?: boolean;\n  vertical?: boolean;\n}\n\nexport interface ZoomOptions {\n  controls?: boolean;\n  maxScale?: number;\n  minScale?: number;\n  pinch?: boolean;\n  scaleSpeed?: number;\n  startScale?: number;\n  wheel?: boolean;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.ConstantProvider\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n/**\n * An object that provides constants for rendering blocks in Geras mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  override FIELD_TEXT_BASELINE_CENTER = false;\n\n  // The dark/shadow path in classic rendering is the same as the normal block\n  // path, but translated down one and right one.\n  DARK_PATH_OFFSET = 1;\n\n  /**\n   * The maximum width of a bottom row that follows a statement input and has\n   * inputs inline.\n   */\n  MAX_BOTTOM_WIDTH = 30;\n  override STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT / 2;\n\n  constructor() {\n    super();\n  }\n\n  override getCSS_(selector: string) {\n    return super.getCSS_(selector).concat([\n      /* eslint-disable indent */\n      /* clang-format off */\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPathLight,`,\n      `${selector} .blocklyInsertionMarker>.blocklyPathDark {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      '}',\n      /* clang-format on */\n      /* eslint-enable indent */\n    ]);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Highlighter\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {\n  HighlightConstantProvider,\n  InsideCorner,\n  JaggedTeeth,\n  Notch,\n  OutsideCorner,\n  PuzzleTab,\n  StartHat,\n} from './highlight_constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\n\n/**\n * An object that adds highlights to a block based on the given rendering\n * information.\n *\n * Highlighting is interesting because the highlights do not fully enclose the\n * block.  Instead, they are positioned based on a light source in the top left.\n * This means that rendering highlights requires exact information about the\n * position of each part of the block.  The resulting paths are not continuous\n * or closed paths.  The highlights for tabs and notches are loosely based on\n * tab and notch shapes, but are not exactly the same.\n */\nexport class Highlighter {\n  info_: RenderInfo;\n  steps_ = '';\n  inlineSteps_ = '';\n  RTL_: boolean;\n  constants_: ConstantProvider;\n  highlightConstants_: HighlightConstantProvider;\n  private readonly highlightOffset: number;\n  outsideCornerPaths_: OutsideCorner;\n  insideCornerPaths_: InsideCorner;\n  puzzleTabPaths_: PuzzleTab;\n  notchPaths_: Notch;\n  startPaths_: StartHat;\n  jaggedTeethPaths_: JaggedTeeth;\n\n  /**\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(info: RenderInfo) {\n    this.info_ = info;\n\n    this.RTL_ = this.info_.RTL;\n\n    const renderer = info.getRenderer();\n\n    /** The renderer's constant provider. */\n    this.constants_ = renderer.getConstants();\n\n    this.highlightConstants_ = renderer.getHighlightConstants();\n    /** The offset between the block's main path and highlight path. */\n    this.highlightOffset = this.highlightConstants_.OFFSET;\n\n    this.outsideCornerPaths_ = this.highlightConstants_.OUTSIDE_CORNER;\n    this.insideCornerPaths_ = this.highlightConstants_.INSIDE_CORNER;\n    this.puzzleTabPaths_ = this.highlightConstants_.PUZZLE_TAB;\n    this.notchPaths_ = this.highlightConstants_.NOTCH;\n    this.startPaths_ = this.highlightConstants_.START_HAT;\n    this.jaggedTeethPaths_ = this.highlightConstants_.JAGGED_TEETH;\n  }\n\n  /**\n   * Get the steps for the highlight path.\n   *\n   * @returns The steps for the highlight path.\n   */\n  getPath(): string {\n    return this.steps_ + '\\n' + this.inlineSteps_;\n  }\n\n  /**\n   * Add a highlight to the top corner of a block.\n   *\n   * @param row The top row of the block.\n   */\n  drawTopCorner(row: TopRow) {\n    this.steps_ += svgPaths.moveBy(row.xPos, this.info_.startY);\n    for (let i = 0, elem; (elem = row.elements[i]); i++) {\n      if (Types.isLeftSquareCorner(elem)) {\n        this.steps_ += this.highlightConstants_.START_POINT;\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        this.steps_ += this.outsideCornerPaths_.topLeft(this.RTL_);\n      } else if (Types.isPreviousConnection(elem)) {\n        this.steps_ += this.notchPaths_.pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.steps_ += this.startPaths_.path(this.RTL_);\n      } else if (Types.isSpacer(elem) && elem.width !== 0) {\n        // The end point of the spacer needs to be offset by the highlight\n        // amount. So instead of using the spacer's width for a relative\n        // horizontal, use its width and position for an absolute horizontal\n        // move.\n        this.steps_ += svgPaths.lineOnAxis(\n          'H',\n          elem.xPos + elem.width - this.highlightOffset,\n        );\n      }\n    }\n\n    const right = row.xPos + row.width - this.highlightOffset;\n    this.steps_ += svgPaths.lineOnAxis('H', right);\n  }\n\n  /**\n   * Add a highlight on a jagged edge for a collapsed block.\n   *\n   * @param row  The row to highlight.\n   */\n  drawJaggedEdge_(row: Row) {\n    if (this.info_.RTL) {\n      const remainder =\n        row.height - this.jaggedTeethPaths_.height - this.highlightOffset;\n      this.steps_ +=\n        this.jaggedTeethPaths_.pathLeft + svgPaths.lineOnAxis('v', remainder);\n    }\n  }\n\n  /**\n   * Add a highlight on a value input.\n   *\n   * @param row The row the input belongs to.\n   */\n  drawValueInput(row: Row) {\n    const input = row.getLastInput() as InlineInput;\n    if (this.RTL_) {\n      const belowTabHeight = row.height - input.connectionHeight;\n\n      this.steps_ +=\n        svgPaths.moveTo(\n          input.xPos + input.width - this.highlightOffset,\n          row.yPos,\n        ) +\n        this.puzzleTabPaths_.pathDown(this.RTL_) +\n        svgPaths.lineOnAxis('v', belowTabHeight);\n    } else {\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos + input.width, row.yPos) +\n        this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n\n  /**\n   * Add a highlight on a statement input.\n   *\n   * @param row The row to highlight.\n   */\n  drawStatementInput(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    if (this.RTL_) {\n      const innerHeight = row.height - 2 * this.insideCornerPaths_.height;\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos, row.yPos) +\n        this.insideCornerPaths_.pathTop(this.RTL_) +\n        svgPaths.lineOnAxis('v', innerHeight) +\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\n        svgPaths.lineTo(\n          row.width - input.xPos - this.insideCornerPaths_.width,\n          0,\n        );\n    } else {\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos, row.yPos + row.height) +\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\n        svgPaths.lineTo(\n          row.width - input.xPos - this.insideCornerPaths_.width,\n          0,\n        );\n    }\n  }\n\n  /**\n   * Add a highlight on the right side of a row.\n   *\n   * @param row The row to highlight.\n   */\n  drawRightSideRow(row: Row) {\n    const rightEdge = row.xPos + row.width - this.highlightOffset;\n    if (row instanceof SpacerRow && row.followsStatement) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n    }\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n      if (row.height > this.highlightOffset) {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          row.yPos + row.height - this.highlightOffset,\n        );\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to the bottom row.\n   *\n   * @param row The row to highlight.\n   */\n  drawBottomRow(row: BottomRow) {\n    // Highlight the vertical edge of the bottom row on the input side.\n    // Highlighting is always from the top left, both in LTR and RTL.\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis(\n        'V',\n        row.baseline - this.highlightOffset,\n      );\n    } else {\n      const cornerElem = this.info_.bottomRow.elements[0];\n      if (Types.isLeftSquareCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(\n          row.xPos + this.highlightOffset,\n          row.baseline - this.highlightOffset,\n        );\n      } else if (Types.isLeftRoundedCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(row.xPos, row.baseline);\n        this.steps_ += this.outsideCornerPaths_.bottomLeft();\n      }\n    }\n  }\n\n  /**\n   * Draw the highlight on the left side of the block.\n   */\n  drawLeft() {\n    const outputConnection = this.info_.outputConnection;\n    if (outputConnection) {\n      const tabBottom =\n        outputConnection.connectionOffsetY + outputConnection.height;\n      // Draw a line up to the bottom of the tab.\n      if (this.RTL_) {\n        this.steps_ += svgPaths.moveTo(this.info_.startX, tabBottom);\n      } else {\n        const left = this.info_.startX + this.highlightOffset;\n        const bottom = this.info_.bottomRow.baseline - this.highlightOffset;\n        this.steps_ += svgPaths.moveTo(left, bottom);\n        this.steps_ += svgPaths.lineOnAxis('V', tabBottom);\n      }\n      this.steps_ += this.puzzleTabPaths_.pathUp(this.RTL_);\n    }\n\n    if (!this.RTL_) {\n      const topRow = this.info_.topRow;\n      if (Types.isLeftRoundedCorner(topRow.elements[0])) {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          this.outsideCornerPaths_.height,\n        );\n      } else {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          topRow.capline + this.highlightOffset,\n        );\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to an inline input.\n   *\n   * @param input The input to highlight.\n   */\n  drawInlineInput(input: InlineInput) {\n    const offset = this.highlightOffset;\n\n    // Relative to the block's left.\n    const connectionRight = input.xPos + input.connectionWidth;\n    const yPos = input.centerline - input.height / 2;\n    const bottomHighlightWidth = input.width - input.connectionWidth;\n    const startY = yPos + offset;\n\n    if (this.RTL_) {\n      const aboveTabHeight = input.connectionOffsetY - offset;\n      const belowTabHeight =\n        input.height -\n        (input.connectionOffsetY + input.connectionHeight) +\n        offset;\n\n      const startX = connectionRight - offset;\n\n      this.inlineSteps_ +=\n        svgPaths.moveTo(startX, startY) + // Right edge above tab.\n        svgPaths.lineOnAxis('v', aboveTabHeight) + // Back of tab.\n        this.puzzleTabPaths_.pathDown(this.RTL_) + // Right edge below tab.\n        svgPaths.lineOnAxis('v', belowTabHeight) + // Bottom.\n        svgPaths.lineOnAxis('h', bottomHighlightWidth);\n    } else {\n      this.inlineSteps_ += // Go to top right corner.\n        svgPaths.moveTo(input.xPos + input.width + offset, startY) + // Highlight right edge, bottom.\n        svgPaths.lineOnAxis('v', input.height) +\n        svgPaths.lineOnAxis('h', -bottomHighlightWidth) + // Go to top of tab.\n        svgPaths.moveTo(connectionRight, yPos + input.connectionOffsetY) + // Short highlight glint at\n        // bottom of tab.\n        this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {Row} from '../measurables/row.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {Highlighter} from './highlighter.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\nimport type {PathObject} from './path_object.js';\n\n/**\n * An object that draws a block based on the given rendering information,\n * customized for the geras renderer.\n */\nexport class Drawer extends BaseDrawer {\n  highlighter_: Highlighter;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n    // Unlike Thrasos, Geras has highlights and drop shadows.\n    this.highlighter_ = new Highlighter(info);\n  }\n\n  override draw() {\n    this.drawOutline_();\n    this.drawInternals_();\n    this.updateConnectionHighlights();\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    pathObject.setHighlightPath(this.highlighter_.getPath());\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  override drawTop_() {\n    this.highlighter_.drawTopCorner(this.info_.topRow);\n    this.highlighter_.drawRightSideRow(this.info_.topRow);\n\n    super.drawTop_();\n  }\n\n  override drawJaggedEdge_(row: Row) {\n    this.highlighter_.drawJaggedEdge_(row);\n\n    super.drawJaggedEdge_(row);\n  }\n\n  override drawValueInput_(row: Row) {\n    this.highlighter_.drawValueInput(row);\n\n    super.drawValueInput_(row);\n  }\n\n  override drawStatementInput_(row: Row) {\n    this.highlighter_.drawStatementInput(row);\n\n    super.drawStatementInput_(row);\n  }\n\n  override drawRightSideRow_(row: Row) {\n    this.highlighter_.drawRightSideRow(row);\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', row.xPos + row.width) +\n      svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  override drawBottom_() {\n    this.highlighter_.drawBottomRow(this.info_.bottomRow);\n\n    super.drawBottom_();\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected override drawLeft_() {\n    this.highlighter_.drawLeft();\n\n    super.drawLeft_();\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.highlighter_.drawInlineInput(input as InlineInput);\n\n    super.drawInlineInput_(input);\n  }\n\n  override positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX =\n        input.xPos + input.connectionWidth + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        yPos + input.connectionOffsetY + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n\n  override positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      } else {\n        connX += this.constants_.DARK_PATH_OFFSET;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        row.yPos + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n\n  override positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  override positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos; // Already contains info about startX.\n      const connX =\n        (this.info_.RTL ? -x : x) + this.constants_.DARK_PATH_OFFSET / 2;\n      connInfo.connectionModel.setOffsetInBlock(\n        connX,\n        bottomRow.baseline + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.HighlightConstantProvider\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\n/** An object containing sizing and path information about an outside corner. */\nexport interface OutsideCorner {\n  height: number;\n  topLeft: (p1: boolean) => string;\n  bottomLeft: () => string;\n}\n\n/** An object containing sizing and path information about an inside corner. */\nexport interface InsideCorner {\n  width: number;\n  height: number;\n  pathTop: (p1: boolean) => string;\n  pathBottom: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  path: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  pathLeft: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  width: number;\n  height: number;\n  pathDown: (p1: boolean) => string;\n  pathUp: (p1: boolean) => string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  pathLeft: string;\n}\n\n/**\n * An object that provides constants for rendering highlights on blocks.\n * Some highlights are simple offsets of the parent paths and can be generated\n * programmatically.  Others, especially on curves, are just made out of piles\n * of constants and are hard to tweak.\n */\nexport class HighlightConstantProvider {\n  constantProvider: ConstantProvider;\n\n  /** The offset between the block's main path and highlight path. */\n  OFFSET = 0.5;\n  START_POINT: string;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNER!: InsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNER!: OutsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constantProvider = constants;\n\n    /**\n     * The start point, which is offset in both X and Y, as an SVG path chunk.\n     */\n    this.START_POINT = svgPaths.moveBy(this.OFFSET, this.OFFSET);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about inside corner\n     * highlights.\n     */\n    this.INSIDE_CORNER = this.makeInsideCorner();\n\n    /**\n     * An object containing sizing and path information about outside corner\n     * highlights.\n     */\n    this.OUTSIDE_CORNER = this.makeOutsideCorner();\n\n    /**\n     * An object containing sizing and path information about puzzle tab\n     * highlights.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about notch highlights.\n     */\n    this.NOTCH = this.makeNotch();\n\n    /**\n     * An object containing sizing and path information about highlights for\n     * collapsed block indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /**\n     * An object containing sizing and path information about start hat\n     * highlights.\n     */\n    this.START_HAT = this.makeStartHat();\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corner highlights.\n   */\n  protected makeInsideCorner(): InsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the outside of a curve.\n     */\n    const distance45outside = (1 - Math.SQRT1_2) * (radius + offset) - offset;\n\n    const pathTopRtl =\n      svgPaths.moveBy(distance45outside, distance45outside) +\n      svgPaths.arc(\n        'a',\n        '0 0,0',\n        radius,\n        svgPaths.point(-distance45outside - offset, radius - distance45outside),\n      );\n\n    const pathBottomRtl = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius + offset,\n      svgPaths.point(radius + offset, radius + offset),\n    );\n\n    const pathBottomLtr =\n      svgPaths.moveBy(distance45outside, -distance45outside) +\n      svgPaths.arc(\n        'a',\n        '0 0,0',\n        radius + offset,\n        svgPaths.point(radius - distance45outside, distance45outside + offset),\n      );\n\n    return {\n      width: radius + offset,\n      height: radius,\n      pathTop(rtl) {\n        return rtl ? pathTopRtl : '';\n      },\n      pathBottom(rtl) {\n        return rtl ? pathBottomRtl : pathBottomLtr;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corner highlights.\n   */\n  protected makeOutsideCorner(): OutsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the inside of a curve.\n     */\n    const distance45inside = (1 - Math.SQRT1_2) * (radius - offset) + offset;\n\n    const topLeftStartX = distance45inside;\n    const topLeftStartY = distance45inside;\n    const topLeftCornerHighlightRtl =\n      svgPaths.moveBy(topLeftStartX, topLeftStartY) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(radius - topLeftStartX, -topLeftStartY + offset),\n      );\n    /**\n     * SVG path for drawing the highlight on the rounded top-left corner.\n     */\n    const topLeftCornerHighlightLtr =\n      svgPaths.moveBy(offset, radius) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(radius, -radius + offset),\n      );\n\n    const bottomLeftStartX = distance45inside;\n    const bottomLeftStartY = -distance45inside;\n    const bottomLeftPath =\n      svgPaths.moveBy(bottomLeftStartX, bottomLeftStartY) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(-bottomLeftStartX + offset, -bottomLeftStartY - radius),\n      );\n\n    return {\n      height: radius,\n      topLeft(rtl) {\n        return rtl ? topLeftCornerHighlightRtl : topLeftCornerHighlightLtr;\n      },\n      bottomLeft() {\n        return bottomLeftPath;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle tab\n   *     highlights.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.constantProvider.TAB_WIDTH;\n    const height = this.constantProvider.TAB_HEIGHT;\n\n    // This is how much of the vertical block edge is actually drawn by the\n    // puzzle tab.\n    const verticalOverlap = 2.5;\n\n    const highlightRtlUp =\n      svgPaths.moveBy(-2, -height + verticalOverlap + 0.9) +\n      svgPaths.lineTo(width * -0.45, -2.1);\n\n    const highlightRtlDown =\n      svgPaths.lineOnAxis('v', verticalOverlap) +\n      svgPaths.moveBy(-width * 0.97, 2.5) +\n      svgPaths.curve('q', [\n        svgPaths.point(-width * 0.05, 10),\n        svgPaths.point(width * 0.3, 9.5),\n      ]) +\n      svgPaths.moveBy(width * 0.67, -1.9) +\n      svgPaths.lineOnAxis('v', verticalOverlap);\n\n    const highlightLtrUp =\n      svgPaths.lineOnAxis('v', -1.5) +\n      svgPaths.moveBy(width * -0.92, -0.5) +\n      svgPaths.curve('q', [\n        svgPaths.point(width * -0.19, -5.5),\n        svgPaths.point(0, -11),\n      ]) +\n      svgPaths.moveBy(width * 0.92, 1);\n\n    const highlightLtrDown =\n      svgPaths.moveBy(-5, height - 0.7) + svgPaths.lineTo(width * 0.46, -2.1);\n\n    return {\n      width,\n      height,\n      pathUp(rtl) {\n        return rtl ? highlightRtlUp : highlightLtrUp;\n      },\n      pathDown(rtl) {\n        return rtl ? highlightRtlDown : highlightLtrDown;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notch\n   *     highlights.\n   */\n  protected makeNotch(): Notch {\n    // This is only for the previous connection.\n    const pathLeft =\n      svgPaths.lineOnAxis('h', this.OFFSET) +\n      this.constantProvider.NOTCH.pathLeft;\n    return {pathLeft};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block edge highlights.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const pathLeft =\n      svgPaths.lineTo(5.1, 2.6) +\n      svgPaths.moveBy(-10.2, 6.8) +\n      svgPaths.lineTo(5.1, 2.6);\n    return {pathLeft, height: 12, width: 10.2};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start\n   *     highlights.\n   */\n  protected makeStartHat(): StartHat {\n    const hatHeight = this.constantProvider.START_HAT.height;\n    const pathRtl =\n      svgPaths.moveBy(25, -8.7) +\n      svgPaths.curve('c', [\n        svgPaths.point(29.7, -6.2),\n        svgPaths.point(57.2, -0.5),\n        svgPaths.point(75, 8.7),\n      ]);\n\n    const pathLtr =\n      svgPaths.curve('c', [\n        svgPaths.point(17.8, -9.2),\n        svgPaths.point(45.3, -14.9),\n        svgPaths.point(75, -8.7),\n      ]) + svgPaths.moveTo(100.5, hatHeight + 0.5);\n    return {\n      path(rtl) {\n        return rtl ? pathRtl : pathLtr;\n      },\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.InlineInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {InlineInput as BaseInlineInput} from '../../../renderers/measurables/inline_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends BaseInlineInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width += this.constants_.DARK_PATH_OFFSET;\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.StatementInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../inputs/input.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {InputRow} from '../measurables/input_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport {ValueInput} from '../../inputs/value_input.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput as StatementInputMeasurable} from './measurables/statement_input.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block,\n * customized for the geras renderer.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  protected override readonly renderer_: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n    this.renderer_ = renderer;\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override populateBottomRow_() {\n    super.populateBottomRow_();\n\n    const followsStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\n        StatementInput;\n    // The minimum height of the bottom row is smaller in Geras than in other\n    // renderers, because the dark path adds a pixel.\n    // If one of the row's elements has a greater height this will be\n    // overwritten in the compute pass.\n    if (!followsStatement) {\n      this.bottomRow.minHeight =\n        this.constants_.MEDIUM_PADDING - this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input instanceof ValueInput) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input instanceof StatementInput) {\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n    } else if (input instanceof ValueInput) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\n      // Dummy and end-row inputs have no visual representation, but the\n      // information is still important.\n      activeRow.minHeight = Math.max(\n        activeRow.minHeight,\n        this.constants_.DUMMY_INPUT_MIN_HEIGHT,\n      );\n      activeRow.hasDummyInput = true;\n    }\n    // Ignore row alignment if inline.\n    if (!this.isInline && activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n      }\n    }\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing = this.getInRowSpacing_(\n          oldElems[oldElems.length - 1],\n          null,\n        );\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row or a statement input.\n    if (!Types.isInput(prev) && (!next || Types.isStatementInput(next))) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\n        return next.notchOffset + offset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\n        return next.notchOffset - this.constants_.CORNER_RADIUS + offset;\n      }\n    }\n\n    // Spacing between two fields of the same editability.\n    if (\n      Types.isField(prev) &&\n      next &&\n      Types.isField(next) &&\n      (prev as Field).isEditable === (next as Field).isEditable\n    ) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) || Types.isIcon(elem)) {\n      result += elem.height / 2;\n      if (\n        (row.hasInlineInput || row.hasStatement) &&\n        elem.height + this.constants_.TALL_INPUT_FIELD_OFFSET_Y <= row.height\n      ) {\n        result += this.constants_.TALL_INPUT_FIELD_OFFSET_Y;\n      }\n    } else if (Types.isInlineInput(elem)) {\n      result += elem.height / 2;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override alignRowElements_() {\n    if (!this.isInline) {\n      super.alignRowElements_();\n      return;\n    }\n    // Walk backgrounds through rows on the block, keeping track of the right\n    // input edge.\n    let nextRightEdge = 0;\n    const rowNextRightEdges = new WeakMap();\n    let prevInput = null;\n    for (let i = this.rows.length - 1, row; (row = this.rows[i]); i--) {\n      rowNextRightEdges.set(row, nextRightEdge);\n      if (Types.isInputRow(row)) {\n        if (row.hasStatement) {\n          this.alignStatementRow_(row as InputRow);\n        }\n        if (\n          prevInput &&\n          prevInput.hasStatement &&\n          row.width < prevInput.width\n        ) {\n          rowNextRightEdges.set(row, prevInput.width);\n        } else if (row.hasStatement) {\n          nextRightEdge = row.width;\n        } else {\n          // To keep right edges of consecutive non-statement rows aligned, use\n          // the maximum width.\n          nextRightEdge = Math.max(nextRightEdge, row.width);\n        }\n        prevInput = row;\n      }\n    }\n    // Walk down each row from the top, comparing the prev and next right input\n    // edges and setting the desired width to the max of the two.\n    let prevRightEdge = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        prevRightEdge = this.getDesiredRowWidth_(row);\n      } else if (Types.isSpacer(row)) {\n        // Set the spacer row to the max of the prev or next input width.\n        row.width = Math.max(prevRightEdge, rowNextRightEdges.get(row));\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = Math.max(\n          prevRightEdge,\n          rowNextRightEdges.get(row),\n        );\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        prevRightEdge = row.width;\n      }\n    }\n  }\n\n  override getDesiredRowWidth_(row: Row) {\n    // Limit the width of a statement row when a block is inline.\n    if (this.isInline && row.hasStatement) {\n      return (\n        this.statementEdge + this.constants_.MAX_BOTTOM_WIDTH + this.startX\n      );\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (\n        row === this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\n      ) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (\n      this.outputConnection &&\n      this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()\n    ) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width - this.constants_.DARK_PATH_OFFSET,\n        );\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren =\n      widestRowWithConnectedBlocks +\n      this.startX +\n      this.constants_.DARK_PATH_OFFSET;\n    this.width += this.constants_.DARK_PATH_OFFSET;\n    this.height = yCursor + this.constants_.DARK_PATH_OFFSET;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  svgPathDark: SVGElement;\n  svgPathLight: SVGElement;\n\n  /**\n   * The colour of the dark path on the block in '#RRGGBB' format.\n   */\n  colourDark = '#000000';\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    public override constants: ConstantProvider,\n  ) {\n    super(root, style, constants);\n\n    /** The dark path of the block. */\n    this.svgPathDark = dom.createSvgElement(Svg.PATH, {\n      'class': 'blocklyPathDark',\n      'transform': 'translate(1,1)',\n    });\n    // SVG draw order is based on the order of elements (top most = back most)\n    // So we need to insert the dark path before the base path to make sure it\n    // gets drawn first.\n    this.svgRoot.insertBefore(this.svgPathDark, this.svgPath);\n\n    /** The light path of the block. */\n    this.svgPathLight = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyPathLight'},\n      this.svgRoot,\n    );\n  }\n\n  override setPath(mainPath: string) {\n    this.svgPath.setAttribute('d', mainPath);\n    this.svgPathDark.setAttribute('d', mainPath);\n  }\n\n  /**\n   * Set the highlight path generated by the renderer onto the SVG element.\n   *\n   * @param highlightPath The highlight path.\n   */\n  setHighlightPath(highlightPath: string) {\n    this.svgPathLight.setAttribute('d', highlightPath);\n  }\n\n  override flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathLight.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathDark.setAttribute('transform', 'translate(1,1) scale(-1 1)');\n  }\n\n  override applyColour(block: BlockSvg) {\n    this.svgPathLight.style.display = '';\n    this.svgPathDark.style.display = '';\n    if (!this.style.colourTertiary) {\n      throw new Error(\n        'The renderer did not properly initialize the tertiary colour of ' +\n          'the block style',\n      );\n    }\n    this.svgPathLight.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPathDark.setAttribute('fill', this.colourDark);\n\n    super.applyColour(block);\n\n    this.svgPath.setAttribute('stroke', 'none');\n  }\n\n  override setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n    this.colourDark =\n      colour.blend('#000', this.style.colourPrimary, 0.2) || this.colourDark;\n  }\n\n  override updateHighlighted(highlighted: boolean) {\n    if (highlighted) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.embossFilterId + ')',\n      );\n      this.svgPathLight.style.display = 'none';\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n      this.svgPathLight.style.display = 'inline';\n    }\n  }\n\n  override updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPathLight.style.display = 'none';\n      if (!this.style.colourSecondary) {\n        throw new Error(\n          'The renderer did not properly initialize the secondary colour ' +\n            'of the block style block style',\n        );\n      }\n      this.svgPathDark.setAttribute('fill', this.style.colourSecondary);\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  override updateDisabled_(disabled: boolean) {\n    super.updateDisabled_(disabled);\n    if (disabled) {\n      this.svgPath.setAttribute('stroke', 'none');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {RenderInfo} from './info.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The geras renderer. This renderer was designed to be backwards compatible\n * with pre-2019 Blockly. Newer projects that are not constrained by backwards\n * compatibility should use thrasos, which is a more modern take on this\n * renderer.\n *\n * Geras is the ancient Greek spirit of old age.\n */\nexport class Renderer extends BaseRenderer {\n  /** The renderer's highlight constant provider. */\n  private highlightConstants: HighlightConstantProvider | null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Initialize the renderer.  Geras has a highlight provider in addition to\n   * the normal constant provider.\n   */\n  override init(\n    theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\n  ) {\n    super.init(theme, opt_rendererOverrides);\n    this.highlightConstants = this.makeHighlightConstants_();\n    this.highlightConstants.init();\n  }\n\n  override refreshDom(svg: SVGElement, theme: Theme) {\n    super.refreshDom(svg, theme);\n    this.getHighlightConstants().init();\n  }\n\n  override makeConstants_() {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\n  }\n\n  /**\n   * Create a new instance of the renderer's highlight constant provider.\n   *\n   * @returns The highlight constant provider.\n   */\n  protected makeHighlightConstants_(): HighlightConstantProvider {\n    return new HighlightConstantProvider(this.getConstants());\n  }\n\n  /**\n   * Get the renderer's highlight constant provider.  We assume that when this\n   * is called, the renderer has already been initialized.\n   *\n   * @returns The highlight constant provider.\n   */\n  getHighlightConstants(): HighlightConstantProvider {\n    if (!this.highlightConstants) {\n      throw new Error(\n        'Cannot access the highlight constants because init has not ' +\n          'been called',\n      );\n    }\n    return this.highlightConstants;\n  }\n}\n\nblockRendering.register('geras', Renderer);\n", "/** @file Re-exports of Blockly.geras.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {Highlighter} from './highlighter.js';\nimport {RenderInfo} from './info.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\nexport {\n  ConstantProvider,\n  Drawer,\n  HighlightConstantProvider,\n  Highlighter,\n  InlineInput,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  StatementInput,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n        break;\n      }\n    }\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing = this.getInRowSpacing_(\n          oldElems[oldElems.length - 1],\n          null,\n        );\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row.\n    if (!Types.isInput(prev) && !next) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      return next.notchOffset - this.constants_.CORNER_RADIUS;\n    }\n\n    // Spacing between two fields of the same editability.\n    if (\n      Types.isField(prev) &&\n      next &&\n      Types.isField(next) &&\n      (prev as Field).isEditable === (next as Field).isEditable\n    ) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput || next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) && row.hasStatement) {\n      const offset =\n        this.constants_.TALL_INPUT_FIELD_OFFSET_Y + elem.height / 2;\n      result += offset;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (\n        row === this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\n      ) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (\n      this.outputConnection &&\n      this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()\n    ) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width,\n        );\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {RenderInfo} from './info.js';\n\n/**\n * The thrasos renderer. This is a more modern take on the legacy geras\n * renderer.\n *\n * Thrasos is the ancient Greek spirit of boldness.\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n}\n\nblockRendering.register('thrasos', Renderer);\n", "/** @file Re-exports of Blockly.thrasos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos\n\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\nexport {Renderer, RenderInfo};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes.Zelos\n\nimport {Theme} from '../theme.js';\n\nconst defaultBlockStyles = {\n  'colour_blocks': {\n    'colourPrimary': '#CF63CF',\n    'colourSecondary': '#C94FC9',\n    'colourTertiary': '#BD42BD',\n  },\n  'list_blocks': {\n    'colourPrimary': '#9966FF',\n    'colourSecondary': '#855CD6',\n    'colourTertiary': '#774DCB',\n  },\n  'logic_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n  },\n  'loop_blocks': {\n    'colourPrimary': '#0fBD8C',\n    'colourSecondary': '#0DA57A',\n    'colourTertiary': '#0B8E69',\n  },\n  'math_blocks': {\n    'colourPrimary': '#59C059',\n    'colourSecondary': '#46B946',\n    'colourTertiary': '#389438',\n  },\n  'procedure_blocks': {\n    'colourPrimary': '#FF6680',\n    'colourSecondary': '#FF4D6A',\n    'colourTertiary': '#FF3355',\n  },\n  'text_blocks': {\n    'colourPrimary': '#FFBF00',\n    'colourSecondary': '#E6AC00',\n    'colourTertiary': '#CC9900',\n  },\n  'variable_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'variable_dynamic_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'hat_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n    'hat': 'cap',\n  },\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '#CF63CF'},\n  'list_category': {'colour': '#9966FF'},\n  'logic_category': {'colour': '#4C97FF'},\n  'loop_category': {'colour': '#0fBD8C'},\n  'math_category': {'colour': '#59C059'},\n  'procedure_category': {'colour': '#FF6680'},\n  'text_category': {'colour': '#FFBF00'},\n  'variable_category': {'colour': '#FF8C1A'},\n  'variable_dynamic_category': {'colour': '#FF8C1A'},\n};\n\n/**\n * Zelos theme.\n */\nexport const Zelos = new Theme('zelos', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes\n\nimport {Classic} from './classic.js';\nimport {Zelos} from './zelos.js';\n\nexport {Classic, Zelos};\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An item in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxItem\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Class for an item in the toolbox.\n */\nexport class ToolboxItem implements IToolboxItem {\n  protected id_: string;\n  protected parent_: ICollapsibleToolboxItem | null;\n  protected level_: number;\n  protected toolboxItemDef_: toolbox.ToolboxItemInfo | null;\n  protected workspace_: WorkspaceSvg;\n  /** The toolbox this category belongs to. */\n  protected readonly parentToolbox_: IToolbox;\n\n  /**\n   * @param toolboxItemDef The JSON defining the toolbox item.\n   * @param parentToolbox The toolbox that holds the toolbox item.\n   * @param opt_parent The parent toolbox item or null if the category does not\n   *     have a parent.\n   */\n  constructor(\n    toolboxItemDef: toolbox.ToolboxItemInfo,\n    parentToolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    /** The ID for the category. */\n    this.id_ =\n      (toolboxItemDef as AnyDuringMigration)['toolboxitemid'] ||\n      idGenerator.getNextUniqueId();\n\n    /** The parent of the category. */\n    this.parent_ = opt_parent || null;\n\n    /** The level that the category is nested at. */\n    this.level_ = this.parent_ ? this.parent_.getLevel() + 1 : 0;\n\n    /** The JSON definition of the toolbox item. */\n    this.toolboxItemDef_ = toolboxItemDef;\n\n    this.parentToolbox_ = parentToolbox;\n\n    /** The workspace of the parent toolbox. */\n    this.workspace_ = this.parentToolbox_.getWorkspace();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init() {}\n  // No-op by default.\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element | null {\n    return null;\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks, or null if this item should\n   *     not receive clicks.\n   */\n  getClickTarget(): Element | null {\n    return null;\n  }\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): ICollapsibleToolboxItem | null {\n    return null;\n  }\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number {\n    return this.level_;\n  }\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean {\n    return false;\n  }\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean {\n    return false;\n  }\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose() {}\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param _isVisible True if category should be visible.\n   */\n  setVisible_(_isVisible: boolean) {}\n}\n// nop by default\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxCategory\n\nimport * as Css from '../css.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport type {\n  CategoryInfo,\n  DynamicCategoryInfo,\n  FlyoutDefinition,\n  FlyoutItemInfo,\n  FlyoutItemInfoArray,\n  StaticCategoryInfo,\n} from '../utils/toolbox.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as colourUtils from '../utils/colour.js';\nimport * as dom from '../utils/dom.js';\nimport * as parsing from '../utils/parsing.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n/**\n * Class for a category in a toolbox.\n */\nexport class ToolboxCategory\n  extends ToolboxItem\n  implements ISelectableToolboxItem\n{\n  /** Name used for registering a toolbox category. */\n  static registrationName = 'category';\n\n  /** The number of pixels to move the category over at each nested level. */\n  static nestedPadding = 19;\n\n  /** The width in pixels of the strip of colour next to each category. */\n  static borderWidth = 8;\n\n  /**\n   * The default colour of the category. This is used as the background colour\n   * of the category when it is selected.\n   */\n  static defaultBackgroundColour = '#57e';\n\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override toolboxItemDef_!: CategoryInfo;\n\n  /** The name that will be displayed on the category. */\n  protected name_ = '';\n\n  /** The colour of the category. */\n  protected colour_ = '';\n\n  /** The HTML container for the category. */\n  protected htmlDiv_: HTMLDivElement | null = null;\n\n  /** The HTML element for the category row. */\n  protected rowDiv_: HTMLDivElement | null = null;\n\n  /** The HTML element that holds children elements of the category row. */\n  protected rowContents_: HTMLDivElement | null = null;\n\n  /** The HTML element for the toolbox icon. */\n  protected iconDom_: Element | null = null;\n\n  /** The HTML element for the toolbox label. */\n  protected labelDom_: Element | null = null;\n  protected cssConfig_: CssConfig;\n\n  /** True if the category is meant to be hidden, false otherwise. */\n  protected isHidden_ = false;\n\n  /** True if this category is disabled, false otherwise. */\n  protected isDisabled_ = false;\n\n  /** The flyout items for this category. */\n  protected flyoutItems_: string | FlyoutItemInfoArray = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param parentToolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n    categoryDef: CategoryInfo,\n    parentToolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    super(categoryDef, parentToolbox, opt_parent);\n\n    /** All the css class names that are used to create a category. */\n    this.cssConfig_ = this.makeDefaultCssConfig_();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   * Init should be called immediately after the construction of the toolbox\n   * item, to ensure that the category contents are properly parsed.\n   */\n  override init() {\n    this.parseCategoryDef_(this.toolboxItemDef_);\n    this.parseContents_(this.toolboxItemDef_);\n    this.createDom_();\n    if (this.toolboxItemDef_['hidden'] === 'true') {\n      this.hide();\n    }\n  }\n\n  /**\n   * Creates an object holding the default classes for a category.\n   *\n   * @returns The configuration object holding all the CSS classes for a\n   *     category.\n   */\n  protected makeDefaultCssConfig_(): CssConfig {\n    return {\n      'container': 'blocklyToolboxCategory',\n      'row': 'blocklyTreeRow',\n      'rowcontentcontainer': 'blocklyTreeRowContentContainer',\n      'icon': 'blocklyTreeIcon',\n      'label': 'blocklyTreeLabel',\n      'contents': 'blocklyToolboxContents',\n      'selected': 'blocklyTreeSelected',\n      'openicon': 'blocklyTreeIconOpen',\n      'closedicon': 'blocklyTreeIconClosed',\n    };\n  }\n\n  /**\n   * Parses the contents array depending on if the category is a dynamic\n   * category, or if its contents are meant to be shown in the flyout.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseContents_(categoryDef: CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        const flyoutItem = itemDef as FlyoutItemInfo;\n        if (Array.isArray(this.flyoutItems_)) {\n          this.flyoutItems_.push(flyoutItem);\n        }\n      }\n    }\n  }\n\n  /**\n   * Parses the non-contents parts of the category def.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseCategoryDef_(categoryDef: CategoryInfo) {\n    this.name_ =\n      'name' in categoryDef\n        ? parsing.replaceMessageReferences(categoryDef['name'])\n        : '';\n    this.colour_ = this.getColour_(categoryDef);\n    Object.assign(\n      this.cssConfig_,\n      categoryDef['cssconfig'] || (categoryDef as any)['cssConfig'],\n    );\n  }\n\n  /**\n   * Creates the DOM for the category.\n   *\n   * @returns The parent element for the category.\n   */\n  protected createDom_(): HTMLDivElement {\n    this.htmlDiv_ = this.createContainer_();\n    aria.setRole(this.htmlDiv_, aria.Role.TREEITEM);\n    aria.setState(this.htmlDiv_, aria.State.SELECTED, false);\n    aria.setState(this.htmlDiv_, aria.State.LEVEL, this.level_ + 1);\n\n    this.rowDiv_ = this.createRowContainer_();\n    this.rowDiv_.style.pointerEvents = 'auto';\n    this.htmlDiv_.appendChild(this.rowDiv_);\n\n    this.rowContents_ = this.createRowContentsContainer_();\n    this.rowContents_.style.pointerEvents = 'none';\n    this.rowDiv_.appendChild(this.rowContents_);\n\n    this.iconDom_ = this.createIconDom_();\n    aria.setRole(this.iconDom_, aria.Role.PRESENTATION);\n    this.rowContents_.appendChild(this.iconDom_);\n\n    this.labelDom_ = this.createLabelDom_(this.name_);\n    this.rowContents_.appendChild(this.labelDom_);\n\n    const id = this.labelDom_.getAttribute('id');\n    if (id) {\n      aria.setState(this.htmlDiv_, aria.State.LABELLEDBY, id);\n    }\n\n    this.addColourBorder_(this.colour_);\n\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Creates the container that holds the row and any subcategories.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    return container;\n  }\n\n  /**\n   * Creates the parent of the contents container. All clicks will happen on\n   * this div.\n   *\n   * @returns The div that holds the contents container.\n   */\n  protected createRowContainer_(): HTMLDivElement {\n    const rowDiv = document.createElement('div');\n    const className = this.cssConfig_['row'];\n    if (className) {\n      dom.addClass(rowDiv, className);\n    }\n    const nestedPadding = `${\n      ToolboxCategory.nestedPadding * this.getLevel()\n    }px`;\n    this.workspace_.RTL\n      ? (rowDiv.style.paddingRight = nestedPadding)\n      : (rowDiv.style.paddingLeft = nestedPadding);\n    return rowDiv;\n  }\n\n  /**\n   * Creates the container for the label and icon.\n   * This is necessary so we can set all subcategory pointer events to none.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createRowContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = this.cssConfig_['rowcontentcontainer'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Creates the span that holds the category icon.\n   *\n   * @returns The span that holds the category icon.\n   */\n  protected createIconDom_(): Element {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Creates the span that holds the category label.\n   * This should have an ID for accessibility purposes.\n   *\n   * @param name The name of the category.\n   * @returns The span that holds the category label.\n   */\n  protected createLabelDom_(name: string): Element {\n    const toolboxLabel = document.createElement('span');\n    toolboxLabel.setAttribute('id', this.getId() + '.label');\n    toolboxLabel.textContent = name;\n    const className = this.cssConfig_['label'];\n    if (className) {\n      dom.addClass(toolboxLabel, className);\n    }\n    return toolboxLabel;\n  }\n\n  /** Updates the colour for this category. */\n  refreshTheme() {\n    this.colour_ = this.getColour_(this.toolboxItemDef_);\n    this.addColourBorder_(this.colour_);\n  }\n\n  /**\n   * Add the strip of colour to the toolbox category.\n   *\n   * @param colour The category colour.\n   */\n  protected addColourBorder_(colour: string) {\n    if (colour) {\n      const border =\n        ToolboxCategory.borderWidth + 'px solid ' + (colour || '#ddd');\n      if (this.workspace_.RTL) {\n        this.rowDiv_!.style.borderRight = border;\n      } else {\n        this.rowDiv_!.style.borderLeft = border;\n      }\n    }\n  }\n\n  /**\n   * Gets either the colour or the style for a category.\n   *\n   * @param categoryDef The object holding information on the category.\n   * @returns The hex colour for the category.\n   */\n  protected getColour_(categoryDef: CategoryInfo): string {\n    const styleName =\n      categoryDef['categorystyle'] || (categoryDef as any)['categoryStyle'];\n    const colour = categoryDef['colour'];\n\n    if (colour && styleName) {\n      console.warn(\n        'Toolbox category \"' +\n          this.name_ +\n          '\" must not have both a style and a colour',\n      );\n    } else if (styleName) {\n      return this.getColourfromStyle_(styleName);\n    } else if (colour) {\n      return this.parseColour_(colour);\n    }\n    return '';\n  }\n\n  /**\n   * Sets the colour for the category using the style name and returns the new\n   * colour as a hex string.\n   *\n   * @param styleName Name of the style.\n   * @returns The hex colour for the category.\n   */\n  private getColourfromStyle_(styleName: string): string {\n    const theme = this.workspace_.getTheme();\n    if (styleName && theme) {\n      const style = theme.categoryStyles[styleName];\n      if (style && style.colour) {\n        return this.parseColour_(style.colour);\n      } else {\n        console.warn(\n          'Style \"' + styleName + '\" must exist and contain a colour value',\n        );\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  override getClickTarget(): Element {\n    return this.rowDiv_ as Element;\n  }\n\n  /**\n   * Parses the colour on the category.\n   *\n   * @param colourValue HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   * @returns The hex colour for the category.\n   */\n  private parseColour_(colourValue: number | string): string {\n    // Decode the colour for any potential message references\n    // (eg. `%{BKY_MATH_HUE}`).\n    const colour = parsing.replaceMessageReferences(colourValue);\n    if (colour == null || colour === '') {\n      // No attribute. No colour.\n      return '';\n    } else {\n      const hue = Number(colour);\n      if (!isNaN(hue)) {\n        return colourUtils.hueToHex(hue);\n      } else {\n        const hex = colourUtils.parse(colour);\n        if (hex) {\n          return hex;\n        } else {\n          console.warn(\n            'Toolbox category \"' +\n              this.name_ +\n              '\" has unrecognized colour attribute: ' +\n              colour,\n          );\n          return '';\n        }\n      }\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display an open icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected openIcon_(iconDiv: Element | null) {\n    if (!iconDiv) {\n      return;\n    }\n    const closedIconClass = this.cssConfig_['closedicon'];\n    if (closedIconClass) {\n      dom.removeClasses(iconDiv, closedIconClass);\n    }\n    const className = this.cssConfig_['openicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display a closed icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected closeIcon_(iconDiv: Element | null) {\n    if (!iconDiv) {\n      return;\n    }\n    const openIconClass = this.cssConfig_['openicon'];\n    if (openIconClass) {\n      dom.removeClasses(iconDiv, openIconClass);\n    }\n    const className = this.cssConfig_['closedicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /** Hide the category. */\n  hide() {\n    this.setVisible_(false);\n  }\n\n  /**\n   * Show the category. Category will only appear if its parent category is also\n   * expanded.\n   */\n  show() {\n    this.setVisible_(true);\n  }\n\n  /**\n   * Whether the category is visible.\n   * A category is only visible if all of its ancestors are expanded and\n   * isHidden_ is false.\n   *\n   * @returns True if the category is visible, false otherwise.\n   */\n  isVisible(): boolean {\n    return !this.isHidden_ && this.allAncestorsExpanded_();\n  }\n\n  /**\n   * Whether all ancestors of a category (parent and parent's parent, etc.) are\n   * expanded.\n   *\n   * @returns True only if every ancestor is expanded\n   */\n  protected allAncestorsExpanded_(): boolean {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let category: IToolboxItem = this;\n    while (category.getParent()) {\n      category = category.getParent()!;\n      if (!(category as ICollapsibleToolboxItem).isExpanded()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  override isSelectable() {\n    return this.isVisible() && !this.isDisabled_;\n  }\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event) {}\n  // No-op\n\n  /**\n   * Sets the current category as selected.\n   *\n   * @param isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(isSelected: boolean) {\n    if (!this.rowDiv_) {\n      return;\n    }\n    const className = this.cssConfig_['selected'];\n    if (isSelected) {\n      const defaultColour = this.parseColour_(\n        ToolboxCategory.defaultBackgroundColour,\n      );\n      this.rowDiv_.style.backgroundColor = this.colour_ || defaultColour;\n      if (className) {\n        dom.addClass(this.rowDiv_, className);\n      }\n    } else {\n      this.rowDiv_.style.backgroundColor = '';\n      if (className) {\n        dom.removeClass(this.rowDiv_, className);\n      }\n    }\n    aria.setState(this.htmlDiv_ as Element, aria.State.SELECTED, isSelected);\n  }\n\n  /**\n   * Sets whether the category is disabled.\n   *\n   * @param isDisabled True to disable the category, false otherwise.\n   */\n  setDisabled(isDisabled: boolean) {\n    this.isDisabled_ = isDisabled;\n    this.getDiv()!.setAttribute('disabled', `${isDisabled}`);\n    isDisabled\n      ? this.getDiv()!.setAttribute('disabled', 'true')\n      : this.getDiv()!.removeAttribute('disabled');\n  }\n\n  /**\n   * Gets the name of the category. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string {\n    return this.name_;\n  }\n\n  override getParent() {\n    return this.parent_;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets the contents of the category. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray | string {\n    return this.flyoutItems_;\n  }\n\n  /**\n   * Updates the contents to be displayed in the flyout.\n   * If the flyout is open when the contents are updated, refreshSelection on\n   * the toolbox must also be called.\n   *\n   * @param contents The contents to be displayed in the flyout. A string can be\n   *     supplied to create a dynamic category.\n   */\n  updateFlyoutContents(contents: FlyoutDefinition | string) {\n    this.flyoutItems_ = [];\n\n    if (typeof contents === 'string') {\n      const newDefinition: DynamicCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        custom: contents,\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    } else {\n      const newDefinition: StaticCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        name:\n          'name' in this.toolboxItemDef_ ? this.toolboxItemDef_['name'] : '',\n        contents: toolbox.convertFlyoutDefToJsonArray(contents),\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    }\n    this.parseContents_(this.toolboxItemDef_);\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_);\n  }\n}\n\nexport namespace ToolboxCategory {\n  /** All the CSS class names that are used to create a category. */\n  export interface CssConfig {\n    container?: string;\n    row?: string;\n    rowcontentcontainer?: string;\n    icon?: string;\n    label?: string;\n    contents?: string;\n    selected?: string;\n    openicon?: string;\n    closedicon?: string;\n  }\n}\n\nexport type CssConfig = ToolboxCategory.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n`);\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  ToolboxCategory.registrationName,\n  ToolboxCategory,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A separator used for separating toolbox categories.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxSeparator\n\nimport * as Css from '../css.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\nimport type * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n/**\n * Class for a toolbox separator. This is the thin visual line that appears on\n * the toolbox. This item is not interactable.\n */\nexport class ToolboxSeparator extends ToolboxItem {\n  /** Name used for registering a toolbox separator. */\n  static registrationName = 'sep';\n\n  /** All the CSS class names that are used to create a separator. */\n  protected cssConfig_: CssConfig = {'container': 'blocklyTreeSeparator'};\n\n  private htmlDiv_: HTMLDivElement | null = null;\n\n  /**\n   * @param separatorDef The information needed to create a separator.\n   * @param toolbox The parent toolbox for the separator.\n   */\n  constructor(separatorDef: toolbox.SeparatorInfo, toolbox: IToolbox) {\n    super(separatorDef, toolbox);\n\n    const cssConfig =\n      separatorDef['cssconfig'] || (separatorDef as any)['cssConfig'];\n    Object.assign(this.cssConfig_, cssConfig);\n  }\n\n  override init() {\n    this.createDom_();\n  }\n\n  /**\n   * Creates the DOM for a separator.\n   *\n   * @returns The parent element for the separator.\n   */\n  protected createDom_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    this.htmlDiv_ = container;\n    return container;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_ as HTMLDivElement;\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_ as HTMLDivElement);\n  }\n}\n\nexport namespace ToolboxSeparator {\n  export interface CssConfig {\n    container: string | undefined;\n  }\n}\n\nexport type CssConfig = ToolboxSeparator.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n`);\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  ToolboxSeparator.registrationName,\n  ToolboxSeparator,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.CollapsibleToolboxCategory\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxCategory} from './category.js';\nimport {ToolboxSeparator} from './separator.js';\n\n/**\n * Class for a category in a toolbox that can be collapsed.\n */\nexport class CollapsibleToolboxCategory\n  extends ToolboxCategory\n  implements ICollapsibleToolboxItem\n{\n  /** Name used for registering a collapsible toolbox category. */\n  static override registrationName = 'collapsibleCategory';\n\n  /** Container for any child categories. */\n  protected subcategoriesDiv_: HTMLDivElement | null = null;\n\n  /** Whether or not the category should display its subcategories. */\n  protected expanded_ = false;\n\n  /** The child toolbox items for this category. */\n  protected toolboxItems_: IToolboxItem[] = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param toolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n    categoryDef: toolbox.CategoryInfo,\n    toolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    super(categoryDef, toolbox, opt_parent);\n  }\n\n  override makeDefaultCssConfig_() {\n    const cssConfig = super.makeDefaultCssConfig_();\n    cssConfig['contents'] = 'blocklyToolboxContents';\n    return cssConfig;\n  }\n\n  override parseContents_(categoryDef: toolbox.CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n      this.flyoutItems_ = [];\n      let prevIsFlyoutItem = true;\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        // Separators can exist as either a flyout item or a toolbox item so\n        // decide where it goes based on the type of the previous item.\n        if (\n          !registry.hasItem(registry.Type.TOOLBOX_ITEM, itemDef['kind']) ||\n          (itemDef['kind'].toLowerCase() ===\n            ToolboxSeparator.registrationName &&\n            prevIsFlyoutItem)\n        ) {\n          const flyoutItem = itemDef as toolbox.FlyoutItemInfo;\n          this.flyoutItems_.push(flyoutItem);\n          prevIsFlyoutItem = true;\n        } else {\n          this.createToolboxItem_(itemDef);\n          prevIsFlyoutItem = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * Creates a toolbox item and adds it to the list of toolbox items.\n   *\n   * @param itemDef The information needed to create a toolbox item.\n   */\n  private createToolboxItem_(itemDef: toolbox.ToolboxItemInfo) {\n    let registryName = itemDef['kind'];\n    const categoryDef = itemDef as toolbox.CategoryInfo;\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (\n      registryName.toUpperCase() === 'CATEGORY' &&\n      toolbox.isCategoryCollapsible(categoryDef)\n    ) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n    const ToolboxItemClass = registry.getClass(\n      registry.Type.TOOLBOX_ITEM,\n      registryName,\n    );\n    const toolboxItem = new ToolboxItemClass!(\n      itemDef,\n      this.parentToolbox_,\n      this,\n    );\n    this.toolboxItems_.push(toolboxItem);\n  }\n\n  override init() {\n    super.init();\n\n    this.setExpanded(\n      this.toolboxItemDef_['expanded'] === 'true' ||\n        this.toolboxItemDef_['expanded'] === true,\n    );\n  }\n\n  override createDom_() {\n    super.createDom_();\n\n    const subCategories = this.getChildToolboxItems();\n    this.subcategoriesDiv_ = this.createSubCategoriesDom_(subCategories);\n    aria.setRole(this.subcategoriesDiv_, aria.Role.GROUP);\n    this.htmlDiv_!.appendChild(this.subcategoriesDiv_);\n    this.closeIcon_(this.iconDom_);\n    aria.setState(this.htmlDiv_ as HTMLDivElement, aria.State.EXPANDED, false);\n\n    return this.htmlDiv_!;\n  }\n\n  override createIconDom_() {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n      toolboxIcon.style.visibility = 'visible';\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Create the DOM for all subcategories.\n   *\n   * @param subcategories The subcategories.\n   * @returns The div holding all the subcategories.\n   */\n  protected createSubCategoriesDom_(\n    subcategories: IToolboxItem[],\n  ): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    contentsContainer.style.display = 'none';\n    const className = this.cssConfig_['contents'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n\n    for (let i = 0; i < subcategories.length; i++) {\n      const newCategory = subcategories[i];\n      newCategory.init();\n      const newCategoryDiv = newCategory.getDiv();\n      contentsContainer.appendChild(newCategoryDiv!);\n      if (newCategory.getClickTarget) {\n        newCategory.getClickTarget()?.setAttribute('id', newCategory.getId());\n      }\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Opens or closes the current category and the associated flyout.\n   *\n   * @param isExpanded True to expand the category, false to close.\n   */\n  setExpanded(isExpanded: boolean) {\n    if (this.expanded_ === isExpanded) return;\n\n    this.expanded_ = isExpanded;\n    if (isExpanded) {\n      this.subcategoriesDiv_!.style.display = 'block';\n      this.openIcon_(this.iconDom_);\n    } else {\n      this.parentToolbox_.getFlyout()?.setVisible(false);\n      this.subcategoriesDiv_!.style.display = 'none';\n      this.closeIcon_(this.iconDom_);\n    }\n    aria.setState(\n      this.htmlDiv_ as HTMLDivElement,\n      aria.State.EXPANDED,\n      isExpanded,\n    );\n\n    this.parentToolbox_.handleToolboxItemResize();\n  }\n\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    const childToolboxItems = this.getChildToolboxItems();\n    for (let i = 0; i < childToolboxItems.length; i++) {\n      const child = childToolboxItems[i];\n      child.setVisible_(isVisible);\n    }\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /**\n   * Whether the category is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean {\n    return this.expanded_;\n  }\n\n  override isCollapsible() {\n    return true;\n  }\n\n  override onClick(_e: Event) {\n    this.toggleExpanded();\n  }\n\n  /** Toggles whether or not the category is expanded. */\n  toggleExpanded() {\n    this.setExpanded(!this.expanded_);\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[] {\n    return this.toolboxItems_;\n  }\n}\n\nexport namespace CollapsibleToolboxCategory {\n  /**\n   * All the CSS class names that are used to create a collapsible\n   * category. This is all the properties from the regular category plus\n   * contents.\n   */\n  export interface CssConfig {\n    container: string | null;\n    row: string | null;\n    rowcontentcontainer: string | null;\n    icon: string | null;\n    label: string | null;\n    selected: string | null;\n    openicon: string | null;\n    closedicon: string | null;\n    contents: string | null;\n  }\n}\n\nexport type CssConfig = CollapsibleToolboxCategory.CssConfig;\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  CollapsibleToolboxCategory.registrationName,\n  CollapsibleToolboxCategory,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Toolbox from whence to create blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Toolbox\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../events/events_toolbox_item_select.js';\n\nimport {BlockSvg} from '../block_svg.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {ComponentManager} from '../component_manager.js';\nimport * as Css from '../css.js';\nimport {DeleteArea} from '../delete_area.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IAutoHideable} from '../interfaces/i_autohideable.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IDraggable} from '../interfaces/i_draggable.js';\nimport type {IFlyout} from '../interfaces/i_flyout.js';\nimport type {IKeyboardAccessible} from '../interfaces/i_keyboard_accessible.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport {isSelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IStyleable} from '../interfaces/i_styleable.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport {Options} from '../options.js';\nimport * as registry from '../registry.js';\nimport type {KeyboardShortcut} from '../shortcut_registry.js';\nimport * as Touch from '../touch.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {ToolboxCategory} from './category.js';\nimport {CollapsibleToolboxCategory} from './collapsible_category.js';\nimport {isDeletable} from '../interfaces/i_deletable.js';\n\n/**\n * Class for a Toolbox.\n * Creates the toolbox's DOM.\n */\nexport class Toolbox\n  extends DeleteArea\n  implements IAutoHideable, IKeyboardAccessible, IStyleable, IToolbox\n{\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'toolbox';\n  protected toolboxDef_: toolbox.ToolboxInfo;\n  private readonly horizontalLayout_: boolean;\n\n  /** The HTML container for the toolbox. */\n  HtmlDiv: HTMLDivElement | null = null;\n\n  /** The HTML container for the contents of a toolbox. */\n  protected contentsDiv_: HTMLDivElement | null = null;\n\n  /** Whether the Toolbox is visible. */\n  protected isVisible_ = false;\n\n  /** The list of items in the toolbox. */\n  protected contents_: IToolboxItem[] = [];\n\n  /** The width of the toolbox. */\n  protected width_ = 0;\n\n  /** The height of the toolbox. */\n  protected height_ = 0;\n  RTL: boolean;\n\n  /** The flyout for the toolbox. */\n  private flyout_: IFlyout | null = null;\n  protected contentMap_: {[key: string]: IToolboxItem};\n  toolboxPosition: toolbox.Position;\n\n  /** The currently selected item. */\n  protected selectedItem_: ISelectableToolboxItem | null = null;\n\n  /** The previously selected item. */\n  protected previouslySelectedItem_: ISelectableToolboxItem | null = null;\n\n  /**\n   * Array holding info needed to unbind event handlers.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  protected boundEvents_: browserEvents.Data[] = [];\n\n  /** The workspace this toolbox is on. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace in which to create new blocks. */\n  constructor(workspace: WorkspaceSvg) {\n    super();\n\n    this.workspace_ = workspace;\n\n    /** The JSON describing the contents of this toolbox. */\n    this.toolboxDef_ = workspace.options.languageTree || {\n      contents: new Array<toolbox.ToolboxItemInfo>(),\n    };\n\n    /** Whether the toolbox should be laid out horizontally. */\n    this.horizontalLayout_ = workspace.options.horizontalLayout;\n\n    /** Is RTL vs LTR. */\n    this.RTL = workspace.options.RTL;\n\n    /** A map from toolbox item IDs to toolbox items. */\n    this.contentMap_ = Object.create(null);\n\n    /** Position of the toolbox and flyout relative to the workspace. */\n    this.toolboxPosition = workspace.options.toolboxPosition;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /** Initializes the toolbox */\n  init() {\n    const workspace = this.workspace_;\n    const svg = workspace.getParentSvg();\n\n    this.flyout_ = this.createFlyout_();\n\n    this.HtmlDiv = this.createDom_(this.workspace_);\n    dom.insertAfter(this.flyout_.createDom('svg'), svg);\n    this.setVisible(true);\n    this.flyout_.init(workspace);\n\n    this.render(this.toolboxDef_);\n    const themeManager = workspace.getThemeManager();\n    themeManager.subscribe(\n      this.HtmlDiv,\n      'toolboxBackgroundColour',\n      'background-color',\n    );\n    themeManager.subscribe(this.HtmlDiv, 'toolboxForegroundColour', 'color');\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Creates the DOM for the toolbox.\n   *\n   * @param workspace The workspace this toolbox is on.\n   * @returns The HTML container for the toolbox.\n   */\n  protected createDom_(workspace: WorkspaceSvg): HTMLDivElement {\n    const svg = workspace.getParentSvg();\n\n    const container = this.createContainer_();\n\n    this.contentsDiv_ = this.createContentsContainer_();\n    this.contentsDiv_.tabIndex = 0;\n    aria.setRole(this.contentsDiv_, aria.Role.TREE);\n    container.appendChild(this.contentsDiv_);\n\n    svg.parentNode!.insertBefore(container, svg);\n\n    this.attachEvents_(container, this.contentsDiv_);\n    return container;\n  }\n\n  /**\n   * Creates the container div for the toolbox.\n   *\n   * @returns The HTML container for the toolbox.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const toolboxContainer = document.createElement('div');\n    toolboxContainer.setAttribute('layout', this.isHorizontal() ? 'h' : 'v');\n    dom.addClass(toolboxContainer, 'blocklyToolboxDiv');\n    dom.addClass(toolboxContainer, 'blocklyNonSelectable');\n    toolboxContainer.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    return toolboxContainer;\n  }\n\n  /**\n   * Creates the container for all the contents in the toolbox.\n   *\n   * @returns The HTML container for the toolbox contents.\n   */\n  protected createContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    dom.addClass(contentsContainer, 'blocklyToolboxContents');\n    if (this.isHorizontal()) {\n      contentsContainer.style.flexDirection = 'row';\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Adds event listeners to the toolbox container div.\n   *\n   * @param container The HTML container for the toolbox.\n   * @param contentsContainer The HTML container for the contents of the\n   *     toolbox.\n   */\n  protected attachEvents_(\n    container: HTMLDivElement,\n    contentsContainer: HTMLDivElement,\n  ) {\n    // Clicking on toolbox closes popups.\n    const clickEvent = browserEvents.conditionalBind(\n      container,\n      'pointerdown',\n      this,\n      this.onClick_,\n      /* opt_noCaptureIdentifier */ false,\n    );\n    this.boundEvents_.push(clickEvent);\n\n    const keyDownEvent = browserEvents.conditionalBind(\n      contentsContainer,\n      'keydown',\n      this,\n      this.onKeyDown_,\n      /* opt_noCaptureIdentifier */ false,\n    );\n    this.boundEvents_.push(keyDownEvent);\n  }\n\n  /**\n   * Handles on click events for when the toolbox or toolbox items are clicked.\n   *\n   * @param e Click event to handle.\n   */\n  protected onClick_(e: PointerEvent) {\n    if (browserEvents.isRightButton(e) || e.target === this.HtmlDiv) {\n      // Close flyout.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(false);\n    } else {\n      const targetElement = e.target;\n      const itemId = (targetElement as Element).getAttribute('id');\n      if (itemId) {\n        const item = this.getToolboxItemById(itemId);\n        if (item!.isSelectable()) {\n          this.setSelectedItem(item);\n          (item as ISelectableToolboxItem).onClick(e);\n        }\n      }\n      // Just close popups.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(true);\n    }\n    Touch.clearTouchIdentifier();\n  }\n\n  /**\n   * Handles key down events for the toolbox.\n   *\n   * @param e The key down event.\n   */\n  protected onKeyDown_(e: KeyboardEvent) {\n    let handled = false;\n    switch (e.key) {\n      case 'ArrowDown':\n        handled = this.selectNext_();\n        break;\n      case 'ArrowUp':\n        handled = this.selectPrevious_();\n        break;\n      case 'ArrowLeft':\n        handled = this.selectParent_();\n        break;\n      case 'ArrowRight':\n        handled = this.selectChild_();\n        break;\n      case 'Enter':\n      case ' ':\n        if (this.selectedItem_ && this.selectedItem_.isCollapsible()) {\n          const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n          collapsibleItem.toggleExpanded();\n          handled = true;\n        }\n        break;\n      default:\n        handled = false;\n        break;\n    }\n    if (!handled && this.selectedItem_) {\n      // TODO(#6097): Figure out who implements onKeyDown and which interface it\n      // should be part of.\n      if ((this.selectedItem_ as any).onKeyDown) {\n        handled = (this.selectedItem_ as any).onKeyDown(e);\n      }\n    }\n\n    if (handled) {\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Creates the flyout based on the toolbox layout.\n   *\n   * @returns The flyout for the toolbox.\n   * @throws {Error} If missing a require for `Blockly.HorizontalFlyout`,\n   *     `Blockly.VerticalFlyout`, and no flyout plugin is specified.\n   */\n  protected createFlyout_(): IFlyout {\n    const workspace = this.workspace_;\n    // TODO (#4247): Look into adding a makeFlyout method to Blockly Options.\n    const workspaceOptions = new Options({\n      'parentWorkspace': workspace,\n      'rtl': workspace.RTL,\n      'oneBasedIndex': workspace.options.oneBasedIndex,\n      'horizontalLayout': workspace.horizontalLayout,\n      'renderer': workspace.options.renderer,\n      'rendererOverrides': workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    // Options takes in either 'end' or 'start'. This has already been parsed to\n    // be either 0 or 1, so set it after.\n    workspaceOptions.toolboxPosition = workspace.options.toolboxPosition;\n    let FlyoutClass = null;\n    if (workspace.horizontalLayout) {\n      FlyoutClass = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        workspace.options,\n        true,\n      );\n    } else {\n      FlyoutClass = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        workspace.options,\n        true,\n      );\n    }\n    return new FlyoutClass!(workspaceOptions);\n  }\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   * @internal\n   */\n  render(toolboxDef: toolbox.ToolboxInfo) {\n    this.toolboxDef_ = toolboxDef;\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      if (toolboxItem) {\n        toolboxItem.dispose();\n      }\n    }\n    this.contents_ = [];\n    this.contentMap_ = Object.create(null);\n    this.renderContents_(toolboxDef['contents']);\n    this.position();\n    this.handleToolboxItemResize();\n  }\n\n  /**\n   * Adds all the toolbox items to the toolbox.\n   *\n   * @param toolboxDef Array holding objects containing information on the\n   *     contents of the toolbox.\n   */\n  protected renderContents_(toolboxDef: toolbox.ToolboxItemInfo[]) {\n    // This is for performance reasons. By using document fragment we only have\n    // to add to the DOM once.\n    const fragment = document.createDocumentFragment();\n    for (let i = 0; i < toolboxDef.length; i++) {\n      const toolboxItemDef = toolboxDef[i];\n      this.createToolboxItem_(toolboxItemDef, fragment);\n    }\n    this.contentsDiv_!.appendChild(fragment);\n  }\n\n  /**\n   * Creates and renders the toolbox item.\n   *\n   * @param toolboxItemDef Any information that can be used to create an item in\n   *     the toolbox.\n   * @param fragment The document fragment to add the child toolbox elements to.\n   */\n  private createToolboxItem_(\n    toolboxItemDef: toolbox.ToolboxItemInfo,\n    fragment: DocumentFragment,\n  ) {\n    let registryName = toolboxItemDef['kind'];\n\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (\n      registryName.toUpperCase() === 'CATEGORY' &&\n      toolbox.isCategoryCollapsible(toolboxItemDef as toolbox.CategoryInfo)\n    ) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n\n    const ToolboxItemClass = registry.getClass(\n      registry.Type.TOOLBOX_ITEM,\n      registryName.toLowerCase(),\n    );\n    if (ToolboxItemClass) {\n      const toolboxItem = new ToolboxItemClass(toolboxItemDef, this);\n      toolboxItem.init();\n      this.addToolboxItem_(toolboxItem);\n      const toolboxItemDom = toolboxItem.getDiv();\n      if (toolboxItemDom) {\n        fragment.appendChild(toolboxItemDom);\n      }\n      // Adds the ID to the HTML element that can receive a click.\n      // This is used in onClick_ to find the toolboxItem that was clicked.\n      if (toolboxItem.getClickTarget()) {\n        toolboxItem.getClickTarget()!.setAttribute('id', toolboxItem.getId());\n      }\n    }\n  }\n\n  /**\n   * Adds an item to the toolbox.\n   *\n   * @param toolboxItem The item in the toolbox.\n   */\n  protected addToolboxItem_(toolboxItem: IToolboxItem) {\n    this.contents_.push(toolboxItem);\n    this.contentMap_[toolboxItem.getId()] = toolboxItem;\n    if (toolboxItem.isCollapsible()) {\n      const collapsibleItem = toolboxItem as ICollapsibleToolboxItem;\n      const childToolboxItems = collapsibleItem.getChildToolboxItems();\n      for (let i = 0; i < childToolboxItems.length; i++) {\n        const child = childToolboxItems[i];\n        this.addToolboxItem_(child);\n      }\n    }\n  }\n\n  /**\n   * Gets the items in the toolbox.\n   *\n   * @returns The list of items in the toolbox.\n   */\n  getToolboxItems(): IToolboxItem[] {\n    return this.contents_;\n  }\n\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   * @internal\n   */\n  addStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.addClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   * @internal\n   */\n  removeStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.removeClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.HtmlDiv || !this.isVisible_) {\n      return null;\n    }\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the toolbox\n    // area are still deleted.  Must be smaller than Infinity, but larger than\n    // the largest screen size.\n    const BIG_NUM = 10000000;\n    const toolboxRect = this.HtmlDiv.getBoundingClientRect();\n\n    const top = toolboxRect.top;\n    const bottom = top + toolboxRect.height;\n    const left = toolboxRect.left;\n    const right = left + toolboxRect.width;\n\n    // Assumes that the toolbox is on the SVG edge.  If this changes\n    // (e.g. toolboxes in mutators) then this code will need to be more complex.\n    if (this.toolboxPosition === toolbox.Position.TOP) {\n      return new Rect(-BIG_NUM, bottom, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.BOTTOM) {\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.LEFT) {\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, right);\n    } else {\n      // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  override wouldDelete(element: IDraggable): boolean {\n    if (element instanceof BlockSvg) {\n      const block = element;\n      this.updateWouldDelete_(!block.getParent() && block.isDeletable());\n    } else {\n      this.updateWouldDelete_(isDeletable(element) && element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragEnter(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected override updateWouldDelete_(wouldDelete: boolean) {\n    if (wouldDelete === this.wouldDelete_) {\n      return;\n    }\n    // This logic handles updating the deleteStyle properly if the delete state\n    // changes while the block is over the Toolbox. This could happen if the\n    // implementation of wouldDeleteBlock depends on the couldConnect parameter\n    // or if the isDeletable property of the block currently being dragged\n    // changes during the drag.\n    this.updateCursorDeleteStyle_(false);\n    this.wouldDelete_ = wouldDelete;\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Adds or removes the CSS style of the cursor over the toolbox based whether\n   * the block or bubble over it is expected to be deleted if dropped (using the\n   * internal this.wouldDelete_ property).\n   *\n   * @param addStyle Whether the style should be added or removed.\n   */\n  protected updateCursorDeleteStyle_(addStyle: boolean) {\n    const style = this.wouldDelete_\n      ? 'blocklyToolboxDelete'\n      : 'blocklyToolboxGrab';\n    if (addStyle) {\n      this.addStyle(style);\n    } else {\n      this.removeStyle(style);\n    }\n  }\n\n  /**\n   * Gets the toolbox item with the given ID.\n   *\n   * @param id The ID of the toolbox item.\n   * @returns The toolbox item with the given ID, or null if no item exists.\n   */\n  getToolboxItemById(id: string): IToolboxItem | null {\n    return this.contentMap_[id] || null;\n  }\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout | null {\n    return this.flyout_;\n  }\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): ISelectableToolboxItem | null {\n    return this.selectedItem_;\n  }\n\n  /**\n   * Gets the previously selected item.\n   *\n   * @returns The previously selected item, or null if no item was previously\n   *     selected.\n   */\n  getPreviouslySelectedItem(): ISelectableToolboxItem | null {\n    return this.previouslySelectedItem_;\n  }\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean {\n    return this.horizontalLayout_;\n  }\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position() {\n    const workspaceMetrics = this.workspace_.getMetrics();\n    const toolboxDiv = this.HtmlDiv;\n    if (!toolboxDiv) {\n      // Not initialized yet.\n      return;\n    }\n\n    if (this.horizontalLayout_) {\n      toolboxDiv.style.left = '0';\n      toolboxDiv.style.height = 'auto';\n      toolboxDiv.style.width = '100%';\n      this.height_ = toolboxDiv.offsetHeight;\n      this.width_ = workspaceMetrics.viewWidth;\n      if (this.toolboxPosition === toolbox.Position.TOP) {\n        toolboxDiv.style.top = '0';\n      } else {\n        // Bottom\n        toolboxDiv.style.bottom = '0';\n      }\n    } else {\n      if (this.toolboxPosition === toolbox.Position.RIGHT) {\n        toolboxDiv.style.right = '0';\n      } else {\n        // Left\n        toolboxDiv.style.left = '0';\n      }\n      toolboxDiv.style.height = '100%';\n      this.width_ = toolboxDiv.offsetWidth;\n      this.height_ = workspaceMetrics.viewHeight;\n    }\n    this.flyout_!.position();\n  }\n\n  /**\n   * Handles resizing the toolbox when a toolbox item resizes.\n   *\n   * @internal\n   */\n  handleToolboxItemResize() {\n    // Reposition the workspace so that (0,0) is in the correct position\n    // relative to the new absolute edge (ie toolbox edge).\n    const workspace = this.workspace_;\n    const rect = this.HtmlDiv!.getBoundingClientRect();\n    const newX =\n      this.toolboxPosition === toolbox.Position.LEFT\n        ? workspace.scrollX + rect.width\n        : workspace.scrollX;\n    const newY =\n      this.toolboxPosition === toolbox.Position.TOP\n        ? workspace.scrollY + rect.height\n        : workspace.scrollY;\n    workspace.translate(newX, newY);\n\n    // Even though the div hasn't changed size, the visible workspace\n    // surface of the workspace has, so we may need to reposition everything.\n    common.svgResize(workspace);\n  }\n\n  /** Unhighlights any previously selected item. */\n  clearSelection() {\n    this.setSelectedItem(null);\n  }\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   *\n   * @internal\n   */\n  refreshTheme() {\n    for (let i = 0; i < this.contents_.length; i++) {\n      const child = this.contents_[i];\n      // TODO(#6097): Fix types or add refreshTheme to IToolboxItem.\n      const childAsCategory = child as ToolboxCategory;\n      if (childAsCategory.refreshTheme) {\n        childAsCategory.refreshTheme();\n      }\n    }\n  }\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection() {\n    if (\n      this.selectedItem_ &&\n      this.selectedItem_.isSelectable() &&\n      this.selectedItem_.getContents().length\n    ) {\n      this.flyout_!.show(this.selectedItem_.getContents());\n    }\n  }\n\n  /**\n   * Shows or hides the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    if (this.isVisible_ === isVisible) {\n      return;\n    }\n\n    this.HtmlDiv!.style.display = isVisible ? 'block' : 'none';\n    this.isVisible_ = isVisible;\n    // Invisible toolbox is ignored as drag targets and must have the drag\n    // target updated.\n    this.workspace_.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    if (!onlyClosePopups && this.flyout_ && this.flyout_.autoClose) {\n      this.clearSelection();\n    }\n  }\n\n  /**\n   * Sets the given item as selected.\n   * No-op if the item is not selectable.\n   *\n   * @param newItem The toolbox item to select.\n   */\n  setSelectedItem(newItem: IToolboxItem | null) {\n    const oldItem = this.selectedItem_;\n\n    if (\n      (!newItem && !oldItem) ||\n      (newItem && !isSelectableToolboxItem(newItem))\n    ) {\n      return;\n    }\n\n    if (this.shouldDeselectItem_(oldItem, newItem) && oldItem !== null) {\n      this.deselectItem_(oldItem);\n    }\n\n    if (this.shouldSelectItem_(oldItem, newItem) && newItem !== null) {\n      this.selectItem_(oldItem, newItem);\n    }\n\n    this.updateFlyout_(oldItem, newItem);\n    this.fireSelectEvent_(oldItem, newItem);\n  }\n\n  /**\n   * Decides whether the old item should be deselected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the old item should be deselected, false otherwise.\n   */\n  protected shouldDeselectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ): boolean {\n    // Deselect the old item unless the old item is collapsible and has been\n    // previously clicked on.\n    return (\n      oldItem !== null && (!oldItem.isCollapsible() || oldItem !== newItem)\n    );\n  }\n\n  /**\n   * Decides whether the new item should be selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the new item should be selected, false otherwise.\n   */\n  protected shouldSelectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ): boolean {\n    // Select the new item unless the old item equals the new item.\n    return newItem !== null && newItem !== oldItem;\n  }\n\n  /**\n   * Deselects the given item, marks it as unselected, and updates aria state.\n   *\n   * @param item The previously selected toolbox item which should be\n   *     deselected.\n   */\n  protected deselectItem_(item: ISelectableToolboxItem) {\n    this.selectedItem_ = null;\n    this.previouslySelectedItem_ = item;\n    item.setSelected(false);\n    aria.setState(\n      this.contentsDiv_ as Element,\n      aria.State.ACTIVEDESCENDANT,\n      '',\n    );\n  }\n\n  /**\n   * Selects the given item, marks it selected, and updates aria state.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected selectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem,\n  ) {\n    this.selectedItem_ = newItem;\n    this.previouslySelectedItem_ = oldItem;\n    newItem.setSelected(true);\n    aria.setState(\n      this.contentsDiv_ as Element,\n      aria.State.ACTIVEDESCENDANT,\n      newItem.getId(),\n    );\n  }\n\n  /**\n   * Selects the toolbox item by its position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number) {\n    if (position > -1 && position < this.contents_.length) {\n      const item = this.contents_[position];\n      if (item.isSelectable()) {\n        this.setSelectedItem(item);\n      }\n    }\n  }\n\n  /**\n   * Decides whether to hide or show the flyout depending on the selected item.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected updateFlyout_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ) {\n    if (\n      !newItem ||\n      (oldItem === newItem && !newItem.isCollapsible()) ||\n      !newItem.getContents().length\n    ) {\n      this.flyout_!.hide();\n    } else {\n      this.flyout_!.show(newItem.getContents());\n      this.flyout_!.scrollToStart();\n    }\n  }\n\n  /**\n   * Emits an event when a new toolbox item is selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  private fireSelectEvent_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ) {\n    const oldElement = oldItem && oldItem.getName();\n    let newElement = newItem && newItem.getName();\n    // In this case the toolbox closes, so the newElement should be null.\n    if (oldItem === newItem) {\n      newElement = null;\n    }\n    const event = new (eventUtils.get(eventUtils.TOOLBOX_ITEM_SELECT))(\n      oldElement,\n      newElement,\n      this.workspace_.id,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Closes the current item if it is expanded, or selects the parent.\n   *\n   * @returns True if a parent category was selected, false otherwise.\n   */\n  private selectParent_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    if (\n      this.selectedItem_.isCollapsible() &&\n      (this.selectedItem_ as ICollapsibleToolboxItem).isExpanded()\n    ) {\n      const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else if (\n      this.selectedItem_.getParent() &&\n      this.selectedItem_.getParent()!.isSelectable()\n    ) {\n      this.setSelectedItem(this.selectedItem_.getParent());\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Selects the first child of the currently selected item, or nothing if the\n   * toolbox item has no children.\n   *\n   * @returns True if a child category was selected, false otherwise.\n   */\n  private selectChild_(): boolean {\n    if (!this.selectedItem_ || !this.selectedItem_.isCollapsible()) {\n      return false;\n    }\n    const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n    if (!collapsibleItem.isExpanded()) {\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else {\n      this.selectNext_();\n      return true;\n    }\n  }\n\n  /**\n   * Selects the next visible toolbox item.\n   *\n   * @returns True if a next category was selected, false otherwise.\n   */\n  private selectNext_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let nextItemIdx = this.contents_.indexOf(this.selectedItem_) + 1;\n    if (nextItemIdx > -1 && nextItemIdx < this.contents_.length) {\n      let nextItem = this.contents_[nextItemIdx];\n      while (nextItem && !nextItem.isSelectable()) {\n        nextItem = this.contents_[++nextItemIdx];\n      }\n      if (nextItem && nextItem.isSelectable()) {\n        this.setSelectedItem(nextItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Selects the previous visible toolbox item.\n   *\n   * @returns True if a previous category was selected, false otherwise.\n   */\n  private selectPrevious_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let prevItemIdx = this.contents_.indexOf(this.selectedItem_) - 1;\n    if (prevItemIdx > -1 && prevItemIdx < this.contents_.length) {\n      let prevItem = this.contents_[prevItemIdx];\n      while (prevItem && !prevItem.isSelectable()) {\n        prevItem = this.contents_[--prevItemIdx];\n      }\n      if (prevItem && prevItem.isSelectable()) {\n        this.setSelectedItem(prevItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /** Disposes of this toolbox. */\n  dispose() {\n    this.workspace_.getComponentManager().removeComponent('toolbox');\n    this.flyout_!.dispose();\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      toolboxItem.dispose();\n    }\n\n    for (let j = 0; j < this.boundEvents_.length; j++) {\n      browserEvents.unbind(this.boundEvents_[j]);\n    }\n    this.boundEvents_ = [];\n    this.contents_ = [];\n\n    if (this.HtmlDiv) {\n      this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);\n      dom.removeNode(this.HtmlDiv);\n    }\n  }\n}\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyToolboxDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n`);\n\nregistry.register(registry.Type.TOOLBOX, registry.DEFAULT, Toolbox);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.Metrics\n\nexport interface Metrics {\n  /** Height of the visible portion of the workspace. */\n  viewHeight: number;\n\n  /** Width of the visible portion of the workspace. */\n  viewWidth: number;\n\n  /** Height of the content. */\n  contentHeight: number;\n\n  /** Width of the content. */\n  contentWidth: number;\n\n  /** Height of the scroll area. */\n  scrollHeight: number;\n\n  /** Width of the scroll area. */\n  scrollWidth: number;\n\n  /**\n   * Top-edge of the visible portion of the workspace, relative to the workspace\n   * origin.\n   */\n  viewTop: number;\n\n  /**\n   * Left-edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewLeft: number;\n\n  /** Top-edge of the content, relative to the workspace origin. */\n  contentTop: number;\n\n  /** Left-edge of the content relative to the workspace origin. */\n  contentLeft: number;\n\n  /** Top-edge of the scroll area, relative to the workspace origin. */\n  scrollTop: number;\n\n  /** Left-edge of the scroll area relative to the workspace origin. */\n  scrollLeft: number;\n\n  /**\n   * Top-edge of the visible portion of the workspace, relative to the\n   * blocklyDiv.\n   */\n  absoluteTop: number;\n\n  /**\n   * Left-edge of the visible portion of the workspace, relative to the\n   * blocklyDiv.\n   */\n  absoluteLeft: number;\n\n  /**\n   * Height of the Blockly div (the view + the toolbox, simple of otherwise).\n   */\n  svgHeight: number;\n\n  /** Width of the Blockly div (the view + the toolbox, simple or otherwise). */\n  svgWidth: number;\n\n  /** Width of the toolbox, if it exists.  Otherwise zero. */\n  toolboxWidth: number;\n\n  /** Height of the toolbox, if it exists.  Otherwise zero. */\n  toolboxHeight: number;\n\n  /** Top, bottom, left or right. Use TOOLBOX_AT constants to compare. */\n  toolboxPosition: number;\n\n  /** Width of the flyout if it is always open.  Otherwise zero. */\n  flyoutWidth: number;\n\n  /** Height of the flyout if it is always open.  Otherwise zero. */\n  flyoutHeight: number;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.IPathObject\n\nimport type {BlockStyle} from '../../theme.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from './constants.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Coordinate} from '../../utils/coordinate.js';\n\n/**\n * An interface for a block's path object.\n *\n * @param _root The root SVG element.\n * @param _constants The renderer's constants.\n */\nexport interface IPathObject {\n  /**\n   * The primary path of the block.\n   */\n  svgPath: SVGElement;\n\n  /** The renderer's constant provider. */\n  constants: ConstantProvider;\n\n  /** The primary path of the block. */\n  style: BlockStyle;\n\n  /**\n   * Holds the cursors SVG element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement | null;\n\n  /**\n   * Holds the markers SVG element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement | null;\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string): void;\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg): void;\n\n  /**\n   * Update the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle): void;\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL(): void;\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement): void;\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement): void;\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  updateHighlighted(highlighted: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enabled: boolean): void;\n\n  /** Adds the given path as a connection highlight for the given connection. */\n  addConnectionHighlight?(\n    connection: RenderedConnection,\n    connectionPath: string,\n    offset: Coordinate,\n    rtl: boolean,\n  ): void;\n\n  /**\n   * Removes any highlight associated with the given connection, if it exists.\n   */\n  removeConnectionHighlight?(connection: RenderedConnection): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IToolboxItem\n\n/**\n * Interface for an item in the toolbox.\n */\nexport interface IToolboxItem {\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init(): void;\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element | null;\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string;\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): IToolboxItem | null;\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number;\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean;\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean;\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose(): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element | null;\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  setVisible_(isVisible: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IToolbox\n\nimport type {IRegistrable} from './i_registrable.js';\nimport type {IToolboxItem} from './i_toolbox_item.js';\nimport type {ToolboxInfo} from '../utils/toolbox.js';\nimport type {IFlyout} from './i_flyout.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Interface for a toolbox.\n */\nexport interface IToolbox extends IRegistrable {\n  /** Initializes the toolbox. */\n  init(): void;\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   */\n  render(toolboxDef: ToolboxInfo): void;\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number;\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The height of the toolbox.\n   */\n  getHeight(): number;\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout | null;\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg;\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean;\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position(): void;\n\n  /** Handles resizing the toolbox when a toolbox item resizes. */\n  handleToolboxItemResize(): void;\n\n  /** Unhighlights any previously selected item. */\n  clearSelection(): void;\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   */\n  refreshTheme(): void;\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection(): void;\n\n  /**\n   * Sets the visibility of the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean): void;\n\n  /**\n   * Selects the toolbox item by it's position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number): void;\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): IToolboxItem | null;\n\n  /** Disposes of this toolbox. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IStyleable\n\n/**\n * Interface for an object that a style can be added to.\n */\nexport interface IStyleable {\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   */\n  addStyle(style: string): void;\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   */\n  removeStyle(style: string): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.ISerializer\n\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Serializes and deserializes a plugin or system.\n */\nexport interface ISerializer {\n  /**\n   * A priority value used to determine the order of deserializing state.\n   * More positive priorities are deserialized before less positive\n   * priorities. Eg if you have priorities (0, -10, 10, 100) the order of\n   * deserialiation will be (100, 10, 0, -10).\n   * If two serializers have the same priority, they are deserialized in an\n   * arbitrary order relative to each other.\n   */\n  priority: number;\n\n  /* eslint-disable no-unused-vars, valid-jsdoc */\n\n  /**\n   * Saves the state of the plugin or system.\n   *\n   * @param workspace The workspace the system to serialize is associated with.\n   * @returns A JS object containing the system's state, or null if there is no\n   *     state to record.\n   */\n  save(workspace: Workspace): Object | null;\n  /* eslint-enable valid-jsdoc */\n\n  /**\n   * Loads the state of the plugin or system.\n   *\n   * @param state The state of the system to deserialize. This will always be\n   *     non-null.\n   * @param workspace The workspace the system to deserialize is associated\n   *     with.\n   */\n  load(state: Object, workspace: Workspace): void;\n\n  /**\n   * Clears the state of the plugin or system.\n   *\n   * @param workspace The workspace the system to clear the state of is\n   *     associated with.\n   */\n  clear(workspace: Workspace): void;\n}\n/* eslint-enable no-unused-vars */\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IRegistrable\n\n/**\n * The interface for a Blockly component that can be registered.\n */\nexport interface IRegistrable {}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {State} from '../serialization/procedures.js';\nimport {IParameterModel} from './i_parameter_model.js';\n\n/**\n * A data model for a procedure.\n */\nexport interface IProcedureModel {\n  /** Sets the human-readable name of the procedure. */\n  setName(name: string): this;\n\n  /**\n   * Inserts a parameter into the list of parameters.\n   *\n   * To move a parameter, first delete it, and then re-insert.\n   */\n  insertParameter(parameterModel: IParameterModel, index: number): this;\n\n  /** Removes the parameter at the given index from the parameter list. */\n  deleteParameter(index: number): this;\n\n  /**\n   * Sets the return type(s) of the procedure.\n   *\n   * Pass null to represent a procedure that does not return.\n   */\n  setReturnTypes(types: string[] | null): this;\n\n  /**\n   * Sets whether this procedure is enabled/disabled. If a procedure is disabled\n   * all procedure caller blocks should be disabled as well.\n   */\n  setEnabled(enabled: boolean): this;\n\n  /** Returns the unique language-neutral ID for the procedure. */\n  getId(): string;\n\n  /** Returns the human-readable name of the procedure. */\n  getName(): string;\n\n  /** Returns the parameter at the given index in the parameter list. */\n  getParameter(index: number): IParameterModel;\n\n  /** Returns an array of all of the parameters in the parameter list. */\n  getParameters(): IParameterModel[];\n\n  /**\n   * Returns the return type(s) of the procedure.\n   *\n   * Null represents a procedure that does not return a value.\n   */\n  getReturnTypes(): string[] | null;\n\n  /**\n   * Returns whether the procedure is enabled/disabled. If a procedure is\n   * disabled, all procedure caller blocks should be disabled as well.\n   */\n  getEnabled(): boolean;\n\n  /**\n   * Serializes the state of the procedure to JSON.\n   *\n   * @returns JSON serializable state of the procedure.\n   */\n  saveState(): State;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureModel} from './i_procedure_model.js';\n\nexport interface IProcedureMap extends Map<string, IProcedureModel> {\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this;\n\n  /** Returns all of the procedures stored in this map. */\n  getProcedures(): IProcedureModel[];\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Rect} from '../utils/rect.js';\nimport type {UiMetrics} from '../metrics_manager.js';\n// Former goog.module ID: Blockly.IPositionable\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component that is positioned on top of the workspace.\n */\nexport interface IPositionable extends IComponent {\n  /**\n   * Positions the element. Called when the window is resized.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]): void;\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ParameterState} from '../serialization/procedures';\nimport {IProcedureModel} from './i_procedure_model';\n\n/**\n * A data model for a procedure.\n */\nexport interface IParameterModel {\n  /**\n   * Sets the name of this parameter to the given name.\n   */\n  setName(name: string): this;\n\n  /**\n   * Sets the types of this parameter to the given type.\n   */\n  setTypes(types: string[]): this;\n\n  /**\n   * Returns the name of this parameter.\n   */\n  getName(): string;\n\n  /**\n   * Return the types of this parameter.\n   */\n  getTypes(): string[];\n\n  /**\n   * Returns the unique language-neutral ID for the parameter.\n   *\n   * This represents the identify of the variable model which does not change\n   * over time.\n   */\n  getId(): string;\n\n  /** Sets the procedure model this parameter is associated with. */\n  setProcedureModel(model: IProcedureModel): this;\n\n  /**\n   * Serializes the state of the parameter to JSON.\n   *\n   * @returns JSON serializable state of the parameter.\n   */\n  saveState(): ParameterState;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IMovable\n\n/**\n * The interface for an object that is movable.\n */\nexport interface IMovable {\n  /**\n   * Get whether this is movable or not.\n   *\n   * @returns True if movable.\n   */\n  isMovable(): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {\n  ContainerRegion,\n  ToolboxMetrics,\n  AbsoluteMetrics,\n  UiMetrics,\n} from '../metrics_manager.js';\nimport type {Size} from '../utils/size.js';\nimport type {Metrics} from '../utils/metrics.js';\n// Former goog.module ID: Blockly.IMetricsManager\n\n/**\n * Interface for a metrics manager.\n */\nexport interface IMetricsManager {\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean;\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container\n   */\n  getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ): ContainerRegion;\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics;\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link IMetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics;\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size;\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics;\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics;\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {KeyboardShortcut} from '../shortcut_registry.js';\n// Former goog.module ID: Blockly.IKeyboardAccessible\n\n/**\n * An interface for an object that handles keyboard shortcuts.\n */\nexport interface IKeyboardAccessible {\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(shortcut: KeyboardShortcut): boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IFlyout\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {FlyoutDefinition} from '../utils/toolbox.js';\nimport type {Svg} from '../utils/svg.js';\nimport type {IRegistrable} from './i_registrable.js';\nimport {FlyoutItem} from '../flyout_base.js';\n\n/**\n * Interface for a flyout.\n */\nexport interface IFlyout extends IRegistrable {\n  /** Whether the flyout is laid out horizontally or not. */\n  horizontalLayout: boolean;\n\n  /** Is RTL vs LTR. */\n  RTL: boolean;\n\n  /** The target workspace */\n  targetWorkspace: WorkspaceSvg | null;\n\n  /** Margin around the edges of the blocks in the flyout. */\n  readonly MARGIN: number;\n\n  /** Does the flyout automatically close when a block is created? */\n  autoClose: boolean;\n\n  /** Corner radius of the flyout background. */\n  readonly CORNER_RADIUS: number;\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own svg element or be a g element nested inside a\n   * separate svg element.\n   *\n   * @param tagName The type of tag to put the flyout in. This should be <svg>\n   *     or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\n  ): SVGElement;\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg): void;\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose(): void;\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number;\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The height of the flyout.\n   */\n  getHeight(): number;\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg;\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean;\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean): void;\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean): void;\n\n  /** Hide and empty the flyout. */\n  hide(): void;\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display in the flyout. This is either an array\n   *     of Nodes, a NodeList, a toolbox definition, or a string with the name\n   *     of the dynamic category.\n   */\n  show(flyoutDef: FlyoutDefinition | string): void;\n\n  /**\n   * Returns the list of flyout items currently present in the flyout.\n   * The `show` method parses the flyout definition into a list of actual\n   * flyout items. This method should return those concrete items, which\n   * may be used for e.g. keyboard navigation.\n   *\n   * @returns List of flyout items.\n   */\n  getContents(): FlyoutItem[];\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg;\n\n  /** Reflow blocks and their mats. */\n  reflow(): void;\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or by\n   *     dragging.\n   */\n  isScrollable(): boolean;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  getY(): number;\n\n  /** Position the flyout. */\n  position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *     otherwise.\n   */\n  isBlockCreatable(block: BlockSvg): boolean;\n\n  /** Scroll the flyout to the beginning of its contents. */\n  scrollToStart(): void;\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate';\n\nexport interface IDragger {\n  /**\n   * Handles any drag startup.\n   *\n   * @param e PointerEvent that started the drag.\n   */\n  onDragStart(e: PointerEvent): void;\n\n  /**\n   * Handles dragging, including calculating where the element should\n   * actually be moved to.\n   *\n   * @param e PointerEvent that continued the drag.\n   * @param totalDelta The total distance, in pixels, that the mouse\n   *     has moved since the start of the drag.\n   */\n  onDrag(e: PointerEvent, totalDelta: Coordinate): void;\n\n  /**\n   * Handles any drag cleanup.\n   *\n   * @param e PointerEvent that finished the drag.\n   * @param totalDelta The total distance, in pixels, that the mouse\n   *     has moved since the start of the drag.\n   */\n  onDragEnd(e: PointerEvent, totalDelta: Coordinate): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Rect} from '../utils/rect.js';\n\nimport {IDraggable} from './i_draggable.js';\n\n// Former goog.module ID: Blockly.IDragTarget\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component with custom behaviour when a block or bubble is\n * dragged over or dropped on top of it.\n */\nexport interface IDragTarget extends IComponent {\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect | null;\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDrop(dragElement: IDraggable): void;\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(dragElement: IDraggable): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDeleteArea\n\nimport type {IDragTarget} from './i_drag_target.js';\nimport type {IDraggable} from './i_draggable.js';\n\n/**\n * Interface for a component that can delete a block or bubble that is dropped\n * on top of it.\n */\nexport interface IDeleteArea extends IDragTarget {\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable): boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IContextMenu\n\nexport interface IContextMenu {\n  /**\n   * Show the context menu for this object.\n   *\n   * @param e Mouse event.\n   */\n  showContextMenu(e: Event): void;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {BlockSvg} from '../block_svg';\nimport type {RenderedConnection} from '../rendered_connection';\n\n/**\n * Displays visual \"previews\" of where a block will be connected if it is\n * dropped.\n */\nexport interface IConnectionPreviewer {\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, replacing the replacedBlock (currently connected to the\n   * staticCon).\n   *\n   * @param draggedCon The connection on the block stack being dragged.\n   * @param staticCon The connection not being dragged that we are\n   *     connecting to.\n   * @param replacedBlock The block currently connected to the staticCon that\n   *     is being replaced.\n   */\n  previewReplacement(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n    replacedBlock: BlockSvg,\n  ): void;\n\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, and no block is being relaced.\n   *\n   * @param draggedCon The connection on the block stack being dragged.\n   * @param staticCon The connection not being dragged that we are\n   *     connecting to.\n   */\n  previewConnection(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ): void;\n\n  /** Hide any previews that are currently displayed. */\n  hidePreview(): void;\n\n  /** Dispose of any references held by this connection previewer. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Connection} from '../connection.js';\nimport type {RenderedConnection} from '../rendered_connection.js';\n// Former goog.module ID: Blockly.IConnectionChecker\n\n/**\n * Class for connection type checking logic.\n */\nexport interface IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): boolean;\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): number;\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(\n    errorCode: number,\n    a: Connection | null,\n    b: Connection | null,\n  ): string;\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection | null, b: Connection | null): number;\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean;\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(\n    a: RenderedConnection,\n    b: RenderedConnection,\n    distance: number,\n  ): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IComponent\n\n/**\n * The interface for a workspace component that can be registered with the\n * ComponentManager.\n */\nexport interface IComponent {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id: string;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ICollapsibleToolboxItem\n\nimport type {ISelectableToolboxItem} from './i_selectable_toolbox_item.js';\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for an item in the toolbox that can be collapsed.\n */\nexport interface ICollapsibleToolboxItem extends ISelectableToolboxItem {\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[];\n\n  /**\n   * Whether the toolbox item is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean;\n\n  /** Toggles whether or not the toolbox item is expanded. */\n  toggleExpanded(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Coordinate} from '../utils/coordinate.js';\n// Former goog.module ID: Blockly.IBubble\n\nimport type {IContextMenu} from './i_contextmenu.js';\nimport type {IDraggable} from './i_draggable.js';\n\n/**\n * A bubble interface.\n */\nexport interface IBubble extends IDraggable, IContextMenu {\n  /**\n   * Return the coordinates of the top-left corner of this bubble's body\n   * relative to the drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate;\n\n  /**\n   * Return the root node of the bubble's SVG group.\n   *\n   * @returns The root SVG node of the bubble's group.\n   */\n  getSvgRoot(): SVGElement;\n\n  /**\n   * Sets whether or not this bubble is being dragged.\n   *\n   * @param adding True if dragging, false otherwise.\n   */\n  setDragging(dragging: boolean): void;\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   */\n  moveDuringDrag(newLoc: Coordinate): void;\n\n  /**\n   * Move the bubble to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   */\n  moveTo(x: number, y: number): void;\n\n  /**\n   * Update the style of this bubble when it is dragged over a delete area.\n   *\n   * @param enable True if the bubble is about to be deleted, false otherwise.\n   */\n  setDeleteStyle(enable: boolean): void;\n\n  /** Dispose of this bubble. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Rect} from '../utils/rect.js';\n// Former goog.module ID: Blockly.IBoundedElement\n\n/**\n * A bounded element interface.\n */\nexport interface IBoundedElement {\n  /**\n   * Returns the coordinates of a bounded element describing the dimensions of\n   * the element. Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounded element.\n   */\n  getBoundingRectangle(): Rect;\n\n  /**\n   * Move the element by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   * @param reason Why is this move happening?  'user', 'bump', 'snap'...\n   */\n  moveBy(dx: number, dy: number, reason?: string[]): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IAutoHideable\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component that can be automatically hidden.\n */\nexport interface IAutoHideable extends IComponent {\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *   Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocationWithBlock\n\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\nimport type {Block} from '../block.js';\n\n/**\n * An AST node location that has an associated block.\n */\nexport interface IASTNodeLocationWithBlock extends IASTNodeLocation {\n  /**\n   * Get the source block associated with this node.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block | null;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocationSvg\n\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\n\n/**\n * An AST node location SVG interface.\n */\nexport interface IASTNodeLocationSvg extends IASTNodeLocation {\n  /**\n   * Add the marker SVG to this node's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the SVG group.\n   */\n  setMarkerSvg(markerSvg: SVGElement | null): void;\n\n  /**\n   * Add the cursor SVG to this node's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the SVG group.\n   */\n  setCursorSvg(cursorSvg: SVGElement | null): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocation\n\n/**\n * An AST node location interface.\n */\nexport interface IASTNodeLocation {}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AA8HMA,UAAAA,0CAqENC,0CAiBMC,4CA+BNC,yCAgCMC,yCAoBAC,0CAoBAC,2CAkBAC,6CAqCAC,qDCzTAC,0DAUAC,iDCxBAC,mDAwLAC,0CAONC,kDAsBAC,6CA6DMC,4CAgGAC,sDA0BAC,+CA0BNC,sDAeMC,sDAiBAC,8CAgBAC,yCAgBAC,oDCvfAC,gDASAC,gDAaAC,iDASAC,kDAiBAC,gDASAC,gDAYAC,2CAsCAC,kDAYAC,kDAaAC,yCAyCAC,kDA+BNC,+CAYMC,yDAONC,iECzLMC,wCAgBAC,uCAYAC,mDAaAC,gDAiBAC,0DAcAC,mDC1FAC,uDAiDAC,4CAuCAC,8CAkBAC,qDAoCAC,qDAkBAC,kDAqBAC,4DCnNAC,+CCCAlD,qCAkBAmD,mCCiBAC,mDAwBAC,2CAeAC,gDAaAC,8CAgBAC,2CAWAC,6CAWAC,8CAqBAC,kDAYAC,sDAWAC,qDAaAC,+CAwCAC,mDA2BAC,iEAuDAC,qDC9SAC,4CAONC,oDAiCAC,uDAiBMC,qDAiBAC,kDAuBAC,0DAeAC,iDAsBAC,4DAwBAC,mEC3IAC,qDA8CAC,yDAwBAC,uDAiBAC,yDAiBAC,6DA0CAC,6DC/HAC,qDAkGAC,4CAINC,+CCmBMC,8DAyBNC,sDAgCMC,kEAmCAC,oDAONC,4DAuBMC,4DAmBNC,2DAeAC,qDA2CAC,oDAsBMC,uDCzUAC,kEA0DAC,sEA6BAC,8DCrHAC,qCAUAC,wCAWAC,uCAONC,+CAUMC,0CAgBAC,sCAcAC,yCC1FAC,oGCWAC,uFAaAC,wFCgDAC,iDAuBAC,uDAuDAC,qDAONC,6DAgBMC,gEAqDAC,8DA0GAC,6CA4BNC,wDAuBMC,sDA2BAC,+DAcNC,8EA0BAC,+EA0BMC,2DAoGNC,iDAuCMC,oDC1kBAC,sDAwBAC,8DAeAC,+DAWNC,kEAUAC,qDAgBAC,oDAkCAC,uDAkBAC,gEAUAC,sDCvKMlI,wDASAE,0DCEAiI,8DAiCAC,gEC9CApI,oDAYAE,sDC2BNmI,oFAuBAC,uFCyCMC,2CAcAC,4CC5GAC,iEC4DAN,kDA0ENO,4DAkCAC,wDAeAC,4DA6BAC,uDAsBAC,wDAwBAC,6DAiCAC,4DA4BAC,4DA6BMb,oDA2BAc,4DAoENC,2DAmCAC,+DA0BAC,wDAgBAC,4DAsCAC,4DAkBAC,gEAsDAC,uDA2BAC,wDA0BAC,6DAsBAC,4DAiBAC,4DAuBAC,uDCnvBMC,0DCAAC,6CAWAC,6CAYAC,yCC2EHC,8CAsCAC,qDAOAC,6CASAC,kDAKHC,iDAWGC,8CAiBAC,0DAyBAC,0DAcHC,yDAeAC,yDAWAC,yDA+DGC,yCA+GHC,4DAwCAC,4DAyCAC,gEA+CGC,iDAiCAC,8CAYAC,gDAgBHC,yCAgBAC,yDAqCAC,qDAoEGC,8DC/tBGC,0DAiBAC,sDAwCAC,sDAsDNC,8CAmDAC,+CAyDAC,gDAoCAC,gDCjOMC,iDASAC,iDAYAd,0CAsEAe,uCAUAC,mDAsBNC,gDAkBMjC,0CAgBAkC,gDA0BAC,kDAgBNC,4CAsBAC,2CAwBAC,4CAwCMC,wCASArB,qCAmBAsB,sCAWAC,wCAKNC,8CAaAC,qDAmBAC,4CAoCAjC,qCCraMkC,sDAWAC,sDAgBAC,iDAWAC,iDAgBAC,2CAsCAC,8CAeAC,8CAsBAC,8CA6DAC,2CAoDAC,8CC9ONC,oEAuKMC,4DAaAC,+DAsBAC,6DA8BAC,uDCvNA5B,yCAUA6B,kDAUA5D,4CAsBAW,uCAkCAO,uCA+BAF,4CAUAC,8CAYA4C,2DAcNzC,mDAsBM0C,qDA6BNC,6CAkCAC,6CAsBAC,mDAQM5C,4DClQA6C,oDASAC,oDAiBAxD,yCA+BNyD,8CA8CAC,8CAmCAC,kDAsBAC,oDASMrD,yCAQAqB,4CCtLAiC,2CAsBAC,iDA8BAC,2CAuBAC,6CAoCNC,uCAgBAC,2CAqBMC,uCAuINC,wCAkDMhK,sCAaAiK,4CAkCAC,yDAwFAC,iDAsCAC,iDA6EAC,+CAkEAC,2CA6BNC,gDAsDAC,kDAsBAC,iDA0BAC,8CAaAC,+CAkBAC,4CA0BAC,+CA6CAC,8CA2CAC,+CAoHAC,uCAiBMC,uCAUNC,sCChjCMC,yDAmCNC,uDA4BMC,4DAmEAC,4DA0BNC,0DA0BMC,0DCxJAC,2DC/CAC,+CCGAC,sECGAC,6DCwCA9Q,gDASAE,kDAwBN6Q,wDCkoBAC,mDA6DAC,iDAiBAC,uDCpsBMhR,8CAgBAiR,gDAaAC,yCA0CNC,4DAwBAC,iDAqBAC,kDAqBAC,sDAuBAC,wDAsBAC,6DAwBAC,wDAkCAC,0DAuBMC,oDAwDNC,+DAqDAC,0DCxcMC,+CCJAC,8CAiBAC,8CAcAC,+CAcAC,+CAcAC,+CAcAC,6CAiBAC,mDAiBAC,4CC3GAxS,gDAYAE,kDCiCAuS,iDA6CNC,uDAwCAC,+CAiBMC,8CAmEAjM,kDA2FNkM,uDAgCMC,uDA+BNC,yDAqBMC,8CAcNC,0DCnUMC,kEAKAC,+DAQAC,2DC4mBNC,uDAiBAC,uDA+BAC,kEC1qBMC,iDCrEAC,gEC00BNC,kECvzBM1T,kEASAE,oEAcAyT,8DCvCNC,mEAeAC,mEAeAC,mEAiBMnN,yDAuCAC,+DCmxEAmN,wDCh0EAC,sEAsCNC,yEAgBAC,mEC9FAC,0DA2DMC,2DA2DNC,4DA4BMC,8DCvJAC,2DCJNC,+CAqCMC,wCAoBNC,gDAcAC,oDClEMC,yDCUAC,sDAoBAC,sDAyCAC,oDAgDAC,mDA2DAC,qDAgDAC,oDAgCAC,oDAyCAC,gEC/PAC,+DAUAC,+DC5DAnN,sDAsBAoN,sDCTApS,sCAsDNgH,yCAsDAqL,mDA2DA7B,oCAyFA8B,yCAkCAC,kDAqCAC,0CC5UMT,uDAwBAC,uDAwBAS,0DA6BNC,wDA0BMC,2DAkCAC,yDAqCNC,8DAiBAC,8DAgBAC,sDAuBMC,4DAgDNC,oEAYMC,4DA+BAC,0DAwCAC,yDAoCAC,sEA+BAC,0DAkDA3B,yDAoCA4B,uDA2BAC,gEAmBAC,mEAoBAC,gEA6BNC,kEAgCAC,gEAWMC,iEAYAC,iEClqBAC,qDCDAC,wECOAC,6DCgCAC,qFCgPAC,0CCnRF;iDvEuGEtX,SACJuX,GACAC,GACAC,GAIAC,GAA4B1X;AAE5BA,YACGA,EAAEuX,aAAgBI,yCAAyB3X,aAAhBA,OAAOuX,KACdvX,OAArBA,GAAGuX,CAAHvX,GAAU4X,KAAV5X;AAEAA,gBAAM6X,MACJ7X,mBACEuX,IACAvX,oEAHEA;AAORuX,YAAOvX,GAAGuX,CAAHvX,GAAU8X,YAAV9X;AAEPA,YAAoBA,aAAhBA,OAAOwX,KAAqCxX,OAAhBwX,EAAKI,KAAL5X;AAC9BA,gBAAM6X,MACJ7X,mBAAmBwX,IAAOxX,yCADtBA;AAIRA,cAAM+X,IAAeP,EAAKM,YAAL9X;AACrBA,YAAIA,CAACyX;AACHzX,gBAAM6X,MAAM7X,+BAANA;AAERA,YAAIgY,IAAeC,wCAAQV,CAARvX,GACfkY,IAAeC,wCAAQZ,CAARvX;AAEdgY,cACHA,IAAeC,wCAAQV,CAARvX,IAAgBoY,uBAAOC,OAAOrY,IAAdA,GAC/BkY,IAAeC,wCAAQZ,CAARvX,IAAgBoY,uBAAOC,OAAOrY,IAAdA;AAIjCC,iDAASsX,GAAME,CAAfzX;AAIAA,YACEA,CAAC0X,KACDM,EAAaD,CAAb/X,KACAgY,EAAaD,CAAb/X,MAA+ByX;AAE/BzX,gBAAM6X,MACJ7X,WACE+X,IACA/X,kBACAuX,IACAvX,uBALEA;AAQRgY,UAAaD,CAAb/X,IAA6ByX;AAC7BS,UAAaH,CAAb/X,IAA6BwX;MAnDDxX;iDA8D9BC,SAAkBsX,GAAcE,GAA2CxX;AACzEA,gBAAQsX,GAARtX;UACEA,KAAKqY,OAAOX,qCAAKY,KAAZtY;AACHA,gBAAqCA,eAAjCA,OAAOwX,EAAarW;AACtBnB,oBAAM4X,MAAM5X,WAAWsX,IAAOtX,iCAAxBA;QAHZA;MADyEA;mDAiBrEC,SAAwBqX,GAAwBC,GAAYtX;AAChEqX,YAAOrX,GAAGqX,CAAHrX,GAAU4X,YAAV5X;AACPsX,YAAOA,EAAKM,YAAL5X;AACPA,cAAM8X,IAAeC,wCAAQV,CAARrX;AAChB8X,aAAiBA,EAAaR,CAAbtX,KAWtBA,OAAO+X,wCAAQV,CAARrX,EAAcsX,CAAdtX,GACPA,OAAOiY,wCAAQZ,CAARrX,EAAcsX,CAAdtX,KAXLsY,QAAQxG,KACN9R,2BACEsX,IACAtX,OACAqX,IACArX,sBALJA;MAL8DA;gDA+BlEC,SACEoX,GACAC,GACAiB,GAA4BtY;AAE5BoX,YAAOpX,GAAGoX,CAAHpX,GAAU2X,YAAV3X;AACPqX,YAAOA,EAAKM,YAAL3X;AACPA,cAAM6X,IAAeC,wCAAQV,CAARpX;AACrBA,YAAIA,CAAC6X,KAAgB7X,CAAC6X,EAAaR,CAAbrX,GAAoBA;AAClCuY,cAAMvY,qBAAqBqX,IAAOrX,OAAOoX,IAAOpX;AACtDA,cAAIsY;AACFtY,kBAAU0X,MACRa,IAAMvY,qCAAqCoX,IAAOpX,UAD9CA;AAINqY,kBAAQxG,KAAK0G,CAAbvY;AAEFA,iBAAOA;QATiCA;AAW1CA,eAAO6X,EAAaR,CAAbrX;MAhBqBA;AA6BxBC,gDAAAA,SAAqBmX,GAAwBC,GAAYpX;AAC7DmX,YAAOnX,GAAGmX,CAAHnX,GAAU0X,YAAV1X;AACPoX,YAAOA,EAAKM,YAAL1X;AAEPA,gBADM4X,IAAeC,wCAAQV,CAARnX,KAIdA,CAACA,CAAC4X,EAAaR,CAAbpX,IAFAA;MALoDA;iDAoBzDC,SACJkX,GACAC,GACAiB,GAA4BpY;AAE5BA,eAAOF,wCAAQoX,GAAMC,GAAMiB,CAApBpY;MAFqBA;AAiBxBC,kDAAAA,SACJiX,GACAC,GACAiB,GAA4BnY;AAE5BA,eAAOH,wCAAQoX,GAAMC,GAAMiB,CAApBnY;MAFqBA;oDAexBC,SACJgX,GACAoB,GACAF,GAA4BlY;AAE5BgX,YAAOhX,GAAGgX,CAAHhX,GAAUuX,YAAVvX;AACPA,YAAMyX,IAAeC,wCAAQV,CAARhX;AACrBA,YAAIA,CAACyX,GAAczX;AACXmY,cAAMnY,mBAAmBgX,CAAnBhX;AACZA,cAAIkY;AACFlY,kBAAUsX,MAAMtX,GAAGmY,CAAHnY,mCAAyCgX,CAAzChX,UAAVA;AAENiY,kBAAQxG,KAAK0G,CAAbnY;AAEFA,iBAAOA;QAPUA;AASnBA,YAAIA,CAACoY;AACHpY,iBAAOyX;AAEHE,YAAeC,wCAAQZ,CAARhX;AACfqY,YAAgBR,uBAAOC,OAAO9X,IAAdA;AACtBA,mBAAWsY,KAAOT,OAAOU,KAAKd,CAAZzX;AAChBqY,YAAcV,EAAaW,CAAbtY,CAAdA,IAAmCyX,EAAaa,CAAbtY;AAErCA,eAAOqY;MArBqBrY;4DAkCxBC,SACJ+W,GACAwB,GACAN,GAA4BjY;AAEtBwY,YAASD,EAAQE,QAAQX,OAAOf,CAAP/W,CAAhBA,KAAiC0Y;AAGhD1Y,eAAsBA,eAAlBA,OAAOwY,IACFA,IAEF3Y,yCAASkX,GAAMyB,GAAQP,CAAvBjY;MARqBA;AC5TxBC,iEAAAA,WAAyBA;AAC7BA,eAAOA,cAAc0Y,mDAAUC,SAAS3Y,EAApBA;MADSA;AAUzBC,wDAAAA,WAAgBA;AACpBA,eAAO2Y,kDAAS3Y,OAATA;MADaA;QCjChB4Y,oDAAAA,SAAwBC,GAAiBD;AAC7CE,yDAAaD;MADgCD;AASzC3Y,0DAAAA,WAAuBA;AAC3BA,eAAO6Y;MADoB7Y;AAwLvBC,iDAAAA,SAAe6Y,GAAe7Y;AAClC8Y,sDAAU7Y,aAAa4Y,CAAvB7Y;MADkCA;yDAOpCC,SAAsB4Y,GAAe5Y;AACnCA,YAAKI,8CAAAJ,GAALA;AAGAA,cAAIA,CAAC8Y,+CAAWC;AAEd/Y,gBAAIA;AAGFgZ,oCAAsBhZ,MAAKA;AACzBiZ,2BAAWhZ,6CAASD,CAApBA;cADyBA,CAA3BA;YAHEA,SAMKkZ,GAAGlZ;AAGViZ,yBAAWhZ,6CAASD,CAApBA;YAHUA;AAMd8Y,yDAAWK,KAAKP,CAAhB5Y;QAjBAA;MADmCA;oDAsBrCC,WAAgBA;AACdA,YAAMmZ,IAAQlZ,2CAAO4Y,gDAAY7Y,IAAnBA;AACd6Y,uDAAWC,SAAS9Y;AACpBA,iBAASoZ,IAAIpZ,GAAG2Y,GAAQA,IAAQQ,EAAMC,CAANpZ,GAAWoZ;AACzCpZ,cAAK2Y,EAAMU,aAAXrZ;AAGAA,gBAAMsZ,IAAwB7Y,+CAAiBkY,EAAMU,WAA9BrZ;AACnBsZ,iBACFA,EAAeC,mBAAmBZ,CAAlC3Y;UALFA;AAaIwZ,YAAexZ,IAAIyZ,IAAIN,EAAMO,IAAKT,OAAMA,EAAEI,WAAnBrZ,CAARA;AACrBA,mBAAWqZ,KAAeG,GAAcxZ;AAEtCA,cAAIA,CAACqZ;AACHrZ;AAEIsZ,cAAwB7Y,+CAAiB4Y,CAAxBrZ;AACvBA,cAAIA,CAACsZ;AACHtZ;AAII2Z,cAAYL,EAAeM,aAAf5Z;cAEd6Z,IAA4BC;AAChC9Z,eAAKoZ,IAAIO,EAAUb,QAAY9Y,IAAJoZ,GAAOA,KAAKpZ;AACrCA,kBAAM2Y,IAAQgB,EAAUP,IAAIpZ,CAAdA;AACdA,gBAAoBA,OAAhB2Y,EAAMkB;AACR7Z;qBACmB8Z,WAAVD;AACTA,kBAAQlB,EAAMkB;qBACLlB,EAAMkB,UAAUA;AACzB7Z;UAPmCA;AAUlC6Z,eAAST,KAAKO,EAAUb,SAAS9Y,MAMlC+Z,IAASJ,EAAUK,OAAOZ,GAAGO,EAAUb,SAASM,CAAvCpZ,GACb+Z,IAAS9Z,2CAAO8Z,GAAQ/Z,IAAfA,GACT2Z,EAAUT,KAAKlZ,GAAG+Z,CAAlB/Z;QAhCsCA;MAlB1BA;mDA6DVC,SAAiBga,GAAqBC,GAAgBja;AACtDkZ,YAAQc,EAAQE,MAARla;AAEPia,aAEHf,EAAMiB,QAANna;AAEFA,cAAMoa,IAAcpa,CAAAA,GACdqa,IAAOhD,uBAAOC,OAAOtX,IAAdA;AAEbA,iBAASmZ,IAAInZ,GAAG0Y,GAAQA,IAAQQ,EAAMC,CAANnZ,GAAWmZ;AACzCnZ,cAAIA,CAAC0Y,EAAM4B,OAANta,GAAgBA;AAKnBA,gBAAM8X,IAAM9X,CAHM0Y,EAAM6B,YAAYC,yCAAK9B,EAAMlC,MAE9BkC,EAA6B+B,SACb/B,EAAMU,WAA3BpZ,EAAwC0a,KAAK1a,GAA7CA,GAEN2a,IAAYN,EAAKvC,CAAL9X;AAClBA,kBAAM4a,IAAYD,IAAYA,EAAUjC,QAAQ1Y;AAChDA,gBAAIA,CAAC2a;AAIHN,gBAAKvC,CAAL9X,IAAYA,EAAC0Y,OAAAA,GAAOmC,OAAO1B,EAAfnZ,GACZoa,EAAYnB,KAAKP,CAAjB1Y;qBACS0Y,EAAMlC,SAASsE,EAAAA,4CAAQH,EAAUE,UAAU1B,IAAInZ;AAClD+a,kBAAYrC,GAElBkC,EAAUI,cAAcD,EAAUC,aAClCJ,EAAUK,eAAeF,EAAUE,cACnCL,EAAUM,gBAAgBH,EAAUG,eAChCH,EAAUI,WACRP,EAAUO,UAENC,IAAYpb,IAAIwZ,IACpBuB,EAAUI,OAAOE,OAAOT,EAAUO,MAAlCnb,CADgBA,GAGlB4a,EAAUO,SAASG,MAAMC,KAAKH,CAAXpb,KAEnB4a,EAAUO,SAASJ,EAAUI,SAGjCR,EAAUE,QAAQ1B;qBAElBT,EAAMlC,SAASgF,EAAAA,8CACd9C,EAAsB+C,YAAYb,EAAUa,WAC5C/C,EAAsBjC,SAASmE,EAAUnE;AAI1CmE,gBAAUpC,WAFUE,EAEaF;qBACxBE,EAAMlC,SAASkF;AAClBC,kBAAgBjD,GAEtBkC,EAAUgB,UAAUD,EAAcC,SAClChB,EAAUiB,WAAWF,EAAcE,UACnCjB,EAAUkB,QAAQH,EAAcG,OAChClB,EAAUmB,WAAWJ,EAAcI;qBAC1BrD,EAAMlC,SAASwF,6CAASpB,EAAUpE,SAASyF;AAKpD5B,gBAAKvC,CAAL9X,IAAYA;gBAAC0Y,OAAAA;gBAAOmC,OAAO1B;cAAfnZ,GACZoa,EAAYnB,KAAKP,CAAjB1Y;UAtDiBA;AA2DvBkZ,YAAQkB,EAAYpa,OAAOA,SAAUgZ,GAAChZ;AACpCA,iBAAOA,CAACgZ,EAAEsB,OAAFta;QAD4BA,CAA9BA;AAGHia,aAEHf,EAAMiB,QAANna;AAIFA,iBAASmZ,IAAInZ,GAAG0Y,GAAQA,IAAQQ,EAAMC,CAANnZ,GAAWmZ;AAIvCT,YAAMlC,SAASgF,EAAAA,8CAC2Bxb,eAAzC0Y,EAA6B+C,WAE9BvC,EAAMgD,QAAQhD,EAAMa,OAAOZ,GAAGnZ,CAAhBA,EAAmBA,CAAnBA,CAAdA;AAGJA,eAAOkZ;MAzFmDlZ;AAgGtDC,6DAAAA,WAA0BA;AAC9BA,iBAASkZ,IAAIlZ,GAAGyY,GAAQA,IAAQE,+CAAWO,CAAXlZ,GAAgBkZ;AAC9CT,YAAMD,aAAaxY;MAFSA;AAS1Bkc,QAAAA,8CAAAA,WAAiBA;AACrBC;MADqBD;QAQjBE,6CAAAA,WAAgBA;AACpBD;MADoBC;AAShBnc,sDAAAA,WAAmBA;AACvBA,eAAoBA,MAAbkc;MADgBlc;AASnBoc,QAAAA,+CAAAA,WAAkBA;AACtBA,eAAO1C;MADe0C;AAUlBC,QAAAA,+CAAAA,SAAmBC,GAAuBD;AAC9C5D,sDAAUxY,iBAAiBqc,CAA3BD;MAD8CA;6DAOhDpc,SAA0Bqc,GAAuBrc;AAE7CyZ,oDADmBzZ,cAAjBA,OAAOqc,IACDA,IAAoB7c,gDAAZQ,IAAuBA,KAE/Bqc;MAJqCrc;AAe3CC,6DAAAA,SAA2BwL,GAAYxL;AAC3CA,cAAMqc,IAAMrc,CAAAA;AACNsc,YAAc9Q,EAAM+Q,eAAevc,KAArBA;AACpBA,iBAAS+Y,IAAI/Y,GAAGwc,GAAaA,IAAaF,EAAYvD,CAAZ/Y,GAAiB+Y;AACzDsD,YAAItD,CAAJ/Y,IAASwc,EAAWC;AAEtBzc,eAAOqc;MANoCrc;qDAiBvCC,SACJyc,GACAC,GAAoB1c;AAEpBA,cAAM2c,IAAa1c,wCAAIwc,EAAAzc,IAAJA;AACnBA,YAAIA,CAAC2c;AAAY3c,gBAAMyW,MAAMzW,qBAANA;AAEvBA,eAAQ2c,EAAmB3c,SAASyc,GAAMC,CAAlC1c;MALYA;AAchBC,gDAAAA,SACJ2c,GAAiB3c;AAEjBA,cAAMoY,IAAiBpZ,yCAAkBsX,qCAAKsG,OAAOD,CAAvC3c;AACdA,YAAIA,CAACoY;AACHpY,gBAAUwW,MAAMxW,cAAc2c,CAAd3c,yBAAVA;AAERA,eAAOoY;MANUpY;2DAebC,SAAyBmY,GAAenY;AAC5CA,aAAImY,EAAMlC,SAASsE,EAAAA,4CAAQpC,EAAMlC,SAAS2G,EAAAA,+CACrBzE,EACHU,aAAhB7Y;AAGAA,cAAM8Y,IAAwB7Y,+CAJXkY,EAKNU,WADU7Y;AAGvBA,cAAIA,CAPemY,EAOH+B;AACdla,kBAAUuW,MAAMvW,mDAAVA;AAGRA,cADIqL,IAAQyN,EAAe+D,aAVR1E,EAUgC+B,OAAvCla,GACDA;AAETA,kBAAM8c,IAAkB5E;AACxBlY,gBAAIA;AACFkY,+DAAalY;AACbA,oBAAM+c,IAAS1R,EAAM2R,UAANhd;kBAEb+c,KACA/c,CAAC+c,EAAOE,kBAAkBC,kEAAzBld,GACDA;AACAA,sBAAMmd,IAAW9R,EAAM+Q,eAAepc,KAArBA;AACjBA,yBAAS4Y,IAAI5Y,GAAGod,GAAQA,IAAQD,EAASvE,CAAT5Y,GAAc4Y;AAC5CwE,oBAAMC,kBAAkBrd,OAAOkd,kEAA/Bld;cAHFA,YAMCqL,EAAMiS,oBAAoBjS,EAAMkS,uBACjCvd,CAAC8Y,EAAe0E,WAAfxd,GAFIA;AAILA;AACEqL,oBAAMgS,kBAAkBrd,MAAMkd,kEAA9Bld,GACAqL,IAAQA,EAAMoS,aAANzd;uBACDqL;cAPJrL;YAXLA,UAAJA;AAqBEkY,+DAAa4E;YADL9c;UAvBDA;QAVXA;MAH0CA;uDCvfxCC,SAA2Bqc,GAAUrc;AACzCA,eAAOyd,2CAAapB,CAAbrc,KAAoBA;MADcA;AASrCC,uDAAAA,WAA0BA;AAC9BA,cAAMyd,IAAazd,CAAAA;AACnBA,mBAAW2Y,KAAe6E;AACxBC,YAAWjF,KAAKgF,2CAAa7E,CAAb3Y,CAAhBA;AAEFA,eAAOyd;MALuBzd;AAa1BC,wDAAAA,SAA4Bqc,GAAoBrc;AACpDud,mDAAalB,EAAUF,EAAvBnc,IAA6Bqc;MADuBrc;AAShDC,yDAAAA,SAA6Boc,GAAoBpc;AACrDA,eAAOsd,2CAAalB,EAAUF,EAAvBlc;MAD8CA;uDAiBjDC,WAA0BA;AAC9BA,eAAOud;MADuBvd;AAS1BC,uDAAAA,SAA2Bkc,GAAoBlc;AACnDsd,sDAAgBpB;MADmClc;AAY/CC,kDAAAA,WAAqBA;AACzBA,eAAOsd;MADkBtd;QAYrBud,4CAAAA,SAAsBC,GAAgCD;AAC1DA,YAAID,2CAAaE,GAAjBD;AAGED,cAAAA,GAE8BA,GAFpBvB,GACIA,GACUA,GAAxBwB,GAHI3F,IAAQ2F,KAAgB/d,wCAAeie,4CAA1BF,GACPxB,SAAAA,IAAAA,SAAVuB,IAAAA,0CAAUvB,SAAVuB,EAAUvB,MAAAA,IAAMwB,MACFxB,SAAAA,IAAAA,QAAdyB,IAAczB,SAAdyB,EAAczB,MAAAA,IAAMwB,MACpBA,SAAAA,IAAwBxB,SAAAA,IAAAA,QAAxByB,IAAwBzB,SAAxByB,EAAcvB,UAAUF,MAAAA,IAA0BA,SAApBuB,IAAAA,0CAAoBvB,SAApBuB,EAAUrB,UAAUF,MAAlDwB,IAAwDA,EAH5CA;AAKHxe,mDAAK6Y,CAAhB2F;cAEAD;AAAAC,mBAAAD,IAAAA,2CAAAA,EAAUI,SAAVH;AACAD,mDAAWE;AACXF,cAAAA;AAAAC,mBAAAD,IAAAA,2CAAAA,EAAUK,OAAVJ;QAXAA;MAD0DA;AA0BtDtd,yDAAAA,WAA4BA;AAChCA,eAAO2d;MADyB3d;AAY5BC,yDAAAA,SAA6B2d,GAAkB3d;AACnD0d,wDAAkBC;MADiC3d;gDAa/CC,SAAoB8b,GAAuB9b;AAE/CA,eAAOkd,EAAcnG,QAAQ4G;AAC3BT,cAAgBA,EAAcnG,QAAQ4G;AAExC3d,cAAM4d,IAAMV,EAAcW,aAAd7d,GACN8d,IAAaZ,EAAca,uBAAd/d;AACnBA,YAAMge,IAAMJ,EAAIK;AAChBje,YAAMge,aAAeE,aAArBle;AAKAA,cAAMme,IAAQH,EAAII;AACZC,cAASL,EAAIM;AACfR,YAAWK,UAAUA,MACvBP,EAAIW,aAAave,SAASme,IAAQne,IAAlCA,GACAkd,EAAcsB,uBAAuBL,GAAOne,IAA5CA;AAEE8d,YAAWO,WAAWA,MACxBT,EAAIW,aAAave,UAAUqe,IAASre,IAApCA,GACAkd,EAAcsB,uBAAuBxe,MAAMqe,CAA3Cre;AAEFkd,YAAcuB,OAAdze;QAfAA;MAR+CA;yDAyC3CC,SACJ0K,GACA+T,GAA4Bze;AAE5BA,cAAM0e,IAAgBvI,uBAAOC,OAAOpW,IAAdA,GAChBwb,IAAc9Q,EAAM+Q,eAAezb,IAArBA;AAChBye,cACIE,IAAYjU,EAAMoS,aAAN9c,OAEV2Z,IAAQ6B,EAAYoD,QAAQD,CAApB3e,GACdwb,EAAY3C,OAAOc,GAAO6B,EAAY7D,SAASgC,CAA/C3Z;AAGJA,iBAASiY,IAAIjY,GAAG6e,GAAaA,IAAarD,EAAYvD,CAAZjY,GAAiBiY;AACrDyG,YAAcG,EAAWvJ,IAAzBtV,IACF0e,EAAcG,EAAWvJ,IAAzBtV,MAEA0e,EAAcG,EAAWvJ,IAAzBtV,IAAiCA;AAGrCA,eAAO0e;MAlBqB1e;AA6B9BC,sDAAAA,SAAyB6e,GAA2B7e;AAClDA,eAAOA,WAAAA;AACLA,eAAK8e,SAASD,CAAd7e;QADKA;MAD2CA;AAY9CC,gEAAAA,SAAoC8e,GAA+B9e;AACvEuX,gDAAUtX,kCAAkC6e,CAA5C9e;MADuEA;wEAOzEC,SAA2C6e,GAA+B7e;AACxE8e,UAAAA,2CAAaC,EAAAA,kEAAoCF,CAApC7e,CAAbA;MADwEA;QAYpE+e,oEAAAA,SACJF,GAA+BE;AAE/BA,cAAMC,IAA2CD,CAAAA;AACjDA,iBAASjH,IAAIiH,GAAGjH,IAAI+G,EAAUrH,QAAQM,KAAKiH;AACzCA,gBAAME,IAAOJ,EAAU/G,CAAViH;AACbA,cAAIA,CAACE,GAAMF;AACT3I,oBAAQxG,KAAKmP,qBAAqBjH,CAArBiH,qBAA2CE,CAA3CF,YAAbA;AACAA;UAFSA;AAIXA,gBAAM5J,IAAO8J,EAAAF;AACR5J,cAOL6J,EAAO7J,CAAP4J,IAAeA,EAACxN,MAAMzR,8CAAgBmf,CAAhBF,EAAPA,IANb3I,QAAQxG,KACNmP,qBAAqBjH,CAArBiH,uDADFA;QARuCA;AAgB3CA,eAAOC;MAnBwBD;QA6B3BD,6CAAAA,SAAuBE,GAAwCF;AAEnEA,mBAAW3J,KAAQa,OAAOU,KAAKsI,CAAZF,GAAqBA;AACtCA,gBAAMI,IAAaF,EAAO7J,CAAP2J;AACf3J,eAAQgK,wCACV/I,QAAQxG,KACNkP,qBAAqB3J,CAArB2J,mCADFA;AAIFK,+CAAOhK,CAAP2J,IAAeI;QAPuBJ;MAF2BA;ACnO/D7e,+CAAAA,SAAoB0X,GAAiByH,GAAgBnf;AACzDC,8CAAAD;AACAof,gDAAW3H,WAAWzX,WAAAA;AAEhBmf,eACFA,EAAQE,iBAAiB3H,CAAzB1X;QAHkBA,GAKnBsf,sCALQtf;MAF8CA;8CAgBrDC,WAAkBA;AAClBmf,kDACFG,aAAaH,qCAAbnf,GACAmf,wCAAWnf;MAHSA;AAYlBC,0DAAAA,WAA8BA;AAClCsf,wDAAmBtf;MADeA;AAa9BC,uDAAAA,SAA4BuX,GAAQvX;AAKxCA,eACEA,CAACuX,EAAExC,KAAKuK,WAAWtf,SAAlBA,KACAuX,aAAagI,gBAAgBrf,kDAAqBqX,CAArBvX;MAPQA;iEAiBpCC,SAAsCsX,GAAetX;AACzDA,eAAOA,GAAGsX,EAAEiI,SAALvf;MADkDA;AAcrDC,0DAAAA,SAA+BqX,GAAerX;AAClDA,cAAMuf,IAAaxf,yDAA4BsX,CAA5BrX;AAEnBA,eAAImf,gDAGKA,kDAAqBI,IAEfvf,kBAAXqX,EAAExC,QAGJsK,gDAAmBI,GACZvf,QAKFA;MAjB2CA;8DC1F9CC,SACJuf,GACA1K,GACA2K,GACAC,GACAC,GAAiC1f;AAMjC2f,iBAASA,EAASvI,GAAQpX;AAGxBA,cAF2B0f,KAEO7f,+CAAkBuX,CAAxBpX;AACtBwf,gBACFC,EAAKG,KAAKJ,GAAYpI,CAAtBpX,IAEAyf,EAAKrI,CAALpX;QAPoBA;AAY1BA,cAAM6f,IAAiB7f,CAAAA;AACvBA,YAAI6U,KAAciL;AAChB9f,mBAASuX,IAAIvX,GAAGuX,IAAUuI,uCAAUjL,CAAhB7U,EAAsBiX,QAAQM,KAAKvX;AACrDA,kBAAM4U,IAAakL,uCAAUjL,CAAhB7U,EAAsBuX,CAAtBvX;AACbuf,cAAKQ,iBAAiBnL,GAAM+K,GAAU3f,KAAtCA;AACA6f,cAASxI,KAAKrX,CAACuf,GAAM3K,GAAM+K,CAAb3f,CAAdA;UAHqDA;;AAMvDuf,YAAKQ,iBAAiBlL,GAAM8K,GAAU3f,KAAtCA,GACA6f,EAASxI,KAAKrX,CAACuf,GAAM1K,GAAM8K,CAAb3f,CAAdA;AAEFA,eAAO6f;MA7B0B7f;mDA4C7BC,SACJsf,GACA1K,GACA2K,GACAC,GAAcxf;AAMd0f,iBAASA,EAASvI,GAAQnX;AACpBuf,cACFC,EAAKG,KAAKJ,GAAYpI,CAAtBnX,IAEAwf,EAAKrI,CAALnX;QAJsBA;AAQ1BA,cAAM4f,IAAiB5f,CAAAA;AACvBA,YAAI4U,KAAciL;AAChB7f,mBAASsX,IAAItX,GAAGsX,IAAUuI,uCAAUjL,CAAhB5U,EAAsBgX,QAAQM,KAAKtX;AACrDA,kBAAM2U,IAAakL,uCAAUjL,CAAhB5U,EAAsBsX,CAAtBtX;AACbsf,cAAKQ,iBAAiBnL,GAAM+K,GAAU1f,KAAtCA;AACA4f,cAASxI,KAAKpX,CAACsf,GAAM3K,GAAM+K,CAAb1f,CAAdA;UAHqDA;;AAMvDsf,YAAKQ,iBAAiBlL,GAAM8K,GAAU1f,KAAtCA,GACA4f,EAASxI,KAAKpX,CAACsf,GAAM1K,GAAM8K,CAAb1f,CAAdA;AAEFA,eAAO4f;MAzBO5f;qDAmCVC,SAAiB2f,GAAc3f;AAInCA,cAAM8f,IAAWH,EAASA,EAAS5I,SAAS/W,CAA3BA,EAA8BA,CAA9BA;AACjBA,eAAO2f,EAAS5I,UAAQ/W;AACtBA,gBAAMA,CAACqf,GAAM1K,GAAM4K,CAAbvf,IAAqB2f,EAASI,IAAT/f;AAC3Bqf,YAAKW,oBAAoBrL,GAAM4K,GAAMvf,KAArCA;QAFsBA;AAIxBA,eAAO8f;MAT4B9f;4DAkB/BC,SAAwBiX,GAAQjX;AACpCA,YAAIiX,EAAE+I,kBAAkB5C,aAAapd;AACnCA,cACEiX,EAAE+I,OAAOC,qBACuCjgB,WAAhDiX,EAAE+I,OAAOE,aAAalgB,oBAAtBA;AAEAA,mBAAOA;AAGTA,cAAIiX,EAAE+I,kBAAkBG;AAEtBngB,mBADMggB,IAAS/I,EAAE+I,QAEChgB,WAAhBggB,EAAOvL,QACSzU,aAAhBggB,EAAOvL,QACSzU,YAAhBggB,EAAOvL,QACSzU,eAAhBggB,EAAOvL,QACSzU,aAAhBggB,EAAOvL,QACSzU,UAAhBggB,EAAOvL,QACSzU,UAAhBggB,EAAOvL;AAIXzU,cAAIiX,EAAE+I,kBAAkBI;AACtBpgB,mBAAOA;QAtB0BA;AA0BrCA,eAAOA;MA3B6BA;4DAoChCC,SAAwBgX,GAAahX;AACzCA,eAAIgX,EAAEoJ,WAAqBC,6CAGlBrgB,OAEWA,MAAbgX,EAAEsJ;MANgCtgB;AAkBrCC,yDAAAA,SACJ+W,GACA6F,GACA0D,GAAwBtgB;AAExBA,cAAMugB,IAAW3D,EAAI4D,eAAJxgB;AACjBugB,UAASE,IAAI1J,EAAE2J;AACfH,UAASI,IAAI5J,EAAE6J;AAEVN,cACHA,IAAS1D,EAAIiE,aAAJ7gB,EAAoB8gB,QAApB9gB;AAEXA,eAAOugB,EAASQ,gBAAgBT,CAAzBtgB;MATiBA;mEAkBpBC,SAA+B8W,GAAa9W;AAChDA,gBAAQ8W,EAAEiK,WAAV/gB;UAEEA;AACEA,mBAAOA,EAACwgB,GAAG1J,EAAEkK,QAAQN,GAAG5J,EAAEmK,OAAnBjhB;UACTA,KAAKA;AACHA,mBAAOA,EACLwgB,GAAG1J,EAAEkK,SAASE,4DACdR,GAAG5J,EAAEmK,SAASC,2DAFTlhB;UAITA,KAAKA;AACHA,mBAAOA,EACLwgB,GAAG1J,EAAEkK,SAASG,4DACdT,GAAG5J,EAAEmK,SAASE,2DAFTnhB;QAVXA;MADgDA;sDCnN5CC,SAAwBmhB,GAAeC,GAAQphB;AAC7CgX,YAAImK,EAAIxD,QAAQyD,CAAZphB;AACVA,YAAUA,OAANgX;AACFhX,iBAAOA;AAETmhB,UAAIvJ,OAAOZ,GAAGhX,CAAdA;AACAA,eAAOA;MAN4CA;ACC/ClD,4CAAAA,SAAmBukB,GAAkBvkB;AACzCA,YAAIwkB;AACFxkB,gBAAM6X,MAAM7X,sBAANA;AAERykB,8CAAWzkB,OAAOukB;MAJuBvkB;0CAkBrCmD,SAAiBuhB,GAAiBC,GAAmBxhB;AAErDqhB,gDAGJA,sCAAWrhB,MACNuhB,MAICE,IAAYD,EAAYE,QAAQ1hB,UAAUA,EAA9BA,GACZohB,IAAaE,mCAAQI,QAAQ1hB,eAAeyhB,CAA/BzhB,GAEnBshB,qCAAUthB,IAGJ2hB,IAAUC,SAASC,cAAc7hB,OAAvBA,GAChB2hB,EAAQlH,KAAKza,wBACP8hB,IAAcF,SAASG,eAAeX,CAAxBphB,GACpB2hB,EAAQK,YAAYF,CAApB9hB,GACA4hB,SAASK,KAAKC,aAAaP,GAASC,SAASK,KAAKE,UAAlDniB;MApByDA;0DCiBrDC,SACJoU,GACA+N,GACAC,GAA2BpiB;AAErB2W,YAAIgL,SAASU,gBAAgBC,yCAAQtiB,GAAGoU,CAAHpU,EAAjCA;AACVA,mBAAWyV,KAAO0M;AAChBxL,YAAEwG,aAAa1H,GAAKzV,GAAGmiB,EAAM1M,CAANzV,CAAHA,EAApBA;AAEEoiB,aACFA,EAAWL,YAAYpL,CAAvB3W;AAEFA,eAAO2W;MAToB3W;AAqBvBC,kDAAAA,SAAmBmZ,GAAkBmJ,GAAiBtiB;AACpDuiB,YAAaD,EAAUE,MAAMxiB,GAAhBA;AACnBA,YAAIuiB,EAAWE,MAAOtO,OAASgF,EAAQuJ,UAAUC,SAASxO,CAA3BnU,CAA3BA;AACFA,iBAAOA;AAETmZ,UAAQuJ,UAAUE,IAAI5iB,GAAGuiB,CAAzBviB;AACAA,eAAOA;MANmDA;AAetDC,uDAAAA,SAAwBkZ,GAAkBoJ,GAAkBtiB;AAChEkZ,UAAQuJ,UAAUG,OAAO5iB,GAAGsiB,EAAWC,MAAMviB,GAAjBA,CAA5BA;MADgEA;qDAa5DC,SAAsBiZ,GAAkBmJ,GAAiBpiB;AACvDqiB,YAAaD,EAAUE,MAAMtiB,GAAhBA;AACnBA,YAAIqiB,EAAWE,MAAOtO,OAASjU,CAACiZ,EAAQuJ,UAAUC,SAASxO,CAA3BjU,CAA5BA;AACFA,iBAAOA;AAETiZ,UAAQuJ,UAAUG,OAAO3iB,GAAGqiB,CAA5BriB;AACAA,eAAOA;MANsDA;AAgBzDC,kDAAAA,SAAmBgZ,GAAkBmJ,GAAiBniB;AAC1DA,eAAOgZ,EAAQuJ,UAAUC,SAASL,CAA3BniB;MADmDA;AAWtDC,oDAAAA,SAAqBye,GAAiBze;AAC1CA,eAAOye,KAAQA,EAAKiE,aAAajE,EAAKiE,WAAWC,YAAYlE,CAA5Bze,IAAoCA;MAD3BA;qDAWtCC,SAAsB2iB,GAAkBC,GAAgB5iB;AAC5DA,cAAM6iB,IAAcD,EAAQE;AACtBL,YAAaG,EAAQH;AAC3BziB,YAAIA,CAACyiB;AACHziB,gBAAMmU,MAAMnU,+BAANA;AAEJ6iB,YACFJ,EAAWd,aAAagB,GAASE,CAAjC7iB,IAEAyiB,EAAWhB,YAAYkB,CAAvB3iB;MAT0DA;AAqBxDC,yDAAAA,SACJ6Y,GACAiK,GAAiB9iB;AAEjB6Y,UAAQkK,MAAR/iB,YAA6B8iB;AAC7BjK,UAAQkK,MAAM/iB,mBAAdA,IAA4C8iB;MAH3B9iB;6DAUbC,WAA6BA;AACjC+iB;AACKC,yDACHA,+CAAcxO,uBAAOC,OAAOzU,IAAdA;MAHiBA;AAW7BC,4DAAAA,WAA4BA;AAChC8iB;AACKA,4DACHC,+CAAc/iB;MAHgBA;sDAa5BC,SAAuB+iB,GAA2B/iB;AACtDA,cAAM+U,IAAMgO,EAAYC,cAAchjB,OAAO+iB,EAAYlB,UAAUoB;AACnEjjB,YAAIqc;AAEJrc,YAAI8iB,iDACFzG,IAAQyG,6CAAY/N,CAAZ/U;AAENA,iBAAOqc;AAKXrc,YAAIA;AACFqc,cAAQ0G,EAAYG,sBAAZljB;QADNA,SAEKiW,GAAGjW;AAKVA,iBAAyCA,IAAlC+iB,EAAYC,YAAalN;QALtB9V;AASR8iB,yDACFA,6CAAY/N,CAAZ/U,IAAmBqc;AAErBrc,eAAOqc;MA1B+Crc;0DAwClDC,SACJ8iB,GACAI,GACAC,GACAC,GAAkBpjB;AAElBA,eAAOC,gEACL6iB,GACAI,IAAWljB,MACXmjB,GACAC,CAJKpjB;MAFWA;wEAuBdC,SACJ6iB,GACAI,GACAC,GACAC,GAAkBnjB;AAElBA,cAAMojB,IAAOP,EAAYC;AACnBjO,YAAMuO,IAAOpjB,OAAO6iB,EAAYlB,UAAUoB;AAChD/iB,YAAImc;AAGJnc,YAAI4iB,iDACFzG,IAAQyG,6CAAY/N,CAAZ7U;AAENA,iBAAOmc;AAINkH,2DAEGC,IAAgBvC,SAASC,cAAchhB,QAAvBA,GACtBsjB,EAAc3B,YAAY3hB,wBAC1B+gB,SAASwC,KAAKpC,YAAYmC,CAA1BtjB,GAKAqjB,iDAAgBC,EAAcE,WAAWxjB,IAAzBA;AAGlBqjB,uDAAcI,OAAOP,IAAaljB,MAAMijB,IAAWjjB,MAAMmjB;AAIvDhH,YADEiH,IACMC,+CAAcK,YAAYN,CAA1BpjB,EAAgCmc,QAEhCnc;AAIN4iB,yDACFA,6CAAY/N,CAAZ7U,IAAmBmc;AAErBnc,eAAOmc;MAvCWnc;4DAmDdC,SACJmjB,GACAH,GACAC,GACAC,GAAkBljB;AAElBA,cAAM0jB,IAAO5C,SAASC,cAAc/gB,MAAvBA;AACb0jB,UAAKjB,MAAMe,OAAOP,IAAajjB,MAAMgjB,IAAWhjB,MAAMkjB;AACtDQ,UAAKb,cAAcM;AAEbza,YAAQoY,SAASC,cAAc/gB,KAAvBA;AACd0I,UAAM+Z,MAAMvG,QAAQlc;AACpB0I,UAAM+Z,MAAMrG,SAASpc;AAEf+b,YAAM+E,SAASC,cAAc/gB,KAAvBA;AACZ+b,UAAI0G,MAAMkB,UAAU3jB;AACpB+b,UAAI0G,MAAMmB,WAAW5jB;AACrB+b,UAAI0G,MAAMoB,MAAM7jB;AAChB+b,UAAI0G,MAAMqB,OAAO9jB;AACjB+b,UAAImF,YAAYwC,CAAhB1jB;AACA+b,UAAImF,YAAYxY,CAAhB1I;AAEA8gB,iBAASwC,KAAKpC,YAAYnF,CAA1B/b;AACM+jB,YAAS/jB,EACboc,QAAQpc,GACRgkB,UAAUhkB,EAFGA;AAIfA,YAAIA;AACF+b,YAAI0G,MAAMwB,aAAajkB,YACvB+jB,EAAOC,WAAWtb,EAAMwb,YAAYR,EAAKQ,WACzCnI,EAAI0G,MAAMwB,aAAajkB,YACvB+jB,EAAO3H,SAAS1T,EAAMwb,YAAYR,EAAKQ;QAJrClkB,UAAJA;AAME8gB,mBAASwC,KAAKnB,YAAYpG,CAA1B/b;QADQA;AAGVA,eAAO+jB;MA/BW/jB;AClTdC,mDAAAA,SAAkBsY,GAAgBtY;AACtCA,eAAOwV,6CAAUvV,gBAAgBqY,CAA1BtY;MAD+BA;2DAOxCC,SAAyBqY,GAAgBrY;AACvCA,YAA6CA,WAAzCE,oDAAiBmY,GAASrY,SAA1BA;AACFA,iBAAOC,sDAAmBoY,CAAnBrY;AAMTA,cAAMuiB,IAASlK,EAA+BkK,OACxC0B,IAAkB1B,EAAMkB,SACxBS,IAAqB3B,EAAM4B,YAC3BC,IAAmB7B,EAAMmB;AAE/BnB,UAAM4B,aAAankB;AACnBuiB,UAAMmB,WAAW1jB;AACjBuiB,UAAMkB,UAAUzjB;AAEhBA,cAAMic,IAAe5D,EAAwB4D;AACvCE,YAAgB9D,EAAwB8D;AAE9CoG,UAAMkB,UAAUQ;AAChB1B,UAAMmB,WAAWU;AACjB7B,UAAM4B,aAAaD;AAEnBlkB,eAAOA,IAAIqkB,uCAAKpI,GAAaE,CAAtBnc;MAxBgCA;8DAiCzCC,SAA4BoY,GAAgBpY;AAG1CA,eAAOA,IAAIokB,uCAFUhM,EAAwB4D,aACvB5D,EAAwB8D,YACvClc;MAHmCA;AAiBtCC,4DAAAA,SAA2BmY,GAAkBiM,GAAgBpkB;AAC3DqkB,YAASC,OAAOtkB,iBAAiBmY,CAAxBnY;AAGfA,eACGqkB,EAA8BD,CAA9BpkB,KACDqkB,EAAOE,iBAAiBH,CAAxBpkB;MAN+DA;yDAiB7DC,SAAwBukB,GAAWvkB;AACvCA,cAAMwkB,IAAMxkB,IAAIykB,mDAAWzkB,GAAGA,CAAlBA;AACN0kB,YAAMH,EAAGI,sBAAH3kB;AACZA,YAAM4kB,IAAkBnE,SAASmE;AAI3BC,YAAc7kB,IAAIykB,mDACtBJ,OAAOS,eAAeF,EAAgBG,YACtCV,OAAOW,eAAeJ,EAAgBK,SAFpBjlB;AAIpBwkB,UAAIrF,IAAIuF,EAAIjB,OAAOoB,EAAY1F;AAC/BqF,UAAInF,IAAIqF,EAAIlB,MAAMqB,EAAYxF;AAE9Brf,eAAOwkB;MAdgCxkB;iEAuBnCC,WAA+BA;AACnCA,cAAMgjB,IAAOxC,SAASwC,MAChB2B,IAAkBnE,SAASmE;AAGjC3kB,eAAOA,IAAIwkB,mDAFQxB,EAAK8B,cAAcH,EAAgBG,YACpC9B,EAAKgC,aAAaL,EAAgBK,SAC7ChlB;MAL4BA;wDAe/BC,SAAuBgY,GAAgBhY;AAC3CA,cAAMujB,IAAOyB,WAAWnlB,oDAAiBmY,GAAShY,iBAA1BA,CAAXA,GACPilB,IAAQD,WAAWnlB,oDAAiBmY,GAAShY,kBAA1BA,CAAXA,GACRsjB,IAAM0B,WAAWnlB,oDAAiBmY,GAAShY,gBAA1BA,CAAXA;AACNklB,YAASF,WAAWnlB,oDAAiBmY,GAAShY,mBAA1BA,CAAXA;AAEfA,eAAOA,IAAImlB,uCAAK7B,GAAK4B,GAAQ3B,GAAM0B,CAA5BjlB;MANoCA;mEAsBvCC,SACJ+X,GACAoN,GACAC,GAAoBplB;AAEdqlB,YAASplB,kEAA+B8X,GAASoN,GAAWC,CAAnDplB;AACfmlB,UAAUP,aAAaS,EAAOrG;AAC9BmG,UAAUL,YAAYO,EAAOnG;MAJTlf;0EAqBhBC,SACJ8X,GACAoN,GACAC,GAAoBnlB;AAGpBA,YAAMqlB,IAAazlB,iDAAckY,CAAd9X,GAEbslB,IAAe1lB,iDAAcslB,CAAdllB,GACfulB,IAAkBzlB,gDAAaolB,CAAbllB;AAExBA,cAAMwlB,IAAOH,EAAWtG,IAAIuG,EAAavG,IAAIwG,EAAgBlC;AACvDoC,YAAOJ,EAAWpG,IAAIqG,EAAarG,IAAIsG,EAAgBnC;AAIvDsC,YAAchmB,sDAAmBoY,CAAnB9X;AACd2lB,YAAST,EAAUU,cAAcF,EAAYjK;AAC7CoK,YAASX,EAAUY,eAAeJ,EAAY/J;AAChDgJ,YAAaO,EAAUP;AACvBE,YAAYK,EAAUL;AACtBM,aAEFR,KAAca,IAAOG,IAAS3lB,GAC9B6kB,KAAaY,IAAOI,IAAS7lB,MAS7B2kB,KAAcoB,KAAKC,IAAIR,GAAMO,KAAKE,IAAIT,IAAOG,GAAQ3lB,CAAxBA,CAAfA,GACd6kB,KAAakB,KAAKC,IAAIP,GAAMM,KAAKE,IAAIR,IAAOI,GAAQ7lB,CAAxBA,CAAfA;AAEfA,eAAOA,IAAIqkB,mDAAWM,GAAYE,CAA3B7kB;MAjCaA;4DC9IhBC,SAAwB6X,GAAgB7X;AAC5CA,cAAMimB,IAAKjmB,IAAIokB,mDAAWpkB,GAAGA,CAAlBA;AAKXA,YAAM8e,IAAKjH,EAAgBiH,KAAKjH,EAAQwG,aAAare,GAArBA;AAChCA,cAAMgf,IAAKnH,EAAgBmH,KAAKnH,EAAQwG,aAAare,GAArBA;AAC5B8e,cACFmH,EAAGnH,IAAIoH,SAASpH,CAAT9e;AAELgf,cACFiH,EAAGjH,IAAIkH,SAASlH,CAAThf;AAKTA,YADMmmB,KADArE,IAAYjK,EAAQwG,aAAare,WAArBA,MACK8hB,EAAUsE,MAAMC,8CAAhBrmB;AAErBimB,YAAGnH,KAAKwH,OAAOH,EAAEnmB,CAAFA,CAAPA,GACJmmB,EAAEnmB,CAAFA,MACFimB,EAAGjH,KAAKsH,OAAOH,EAAEnmB,CAAFA,CAAPA;AAMZA,SADM+hB,IAAQlK,EAAQwG,aAAare,OAArBA,MACD+hB,EAAMwE,SAASvmB,WAAfA,MACLwmB,IAAkBzE,EAAMqE,MAAMK,oDAAZzmB,OAEtBimB,EAAGnH,KAAKwH,OAAOE,EAAgBxmB,CAAhBA,CAAPA,GACJwmB,EAAgBxmB,CAAhBA,MACFimB,EAAGjH,KAAKsH,OAAOE,EAAgBxmB,CAAhBA,CAAPA;AAIdA,eAAOimB;MAnCqCjmB;AA8CxCC,gEAAAA,SAA4B4X,GAAgB5X;AAChDA,YAAI6e,IAAI7e,GACJ+e,IAAI/e;AACRA,eAAO4X,KAAS5X;AACdA,gBAAMgmB,IAAKjmB,oDAAc6X,CAAd5X;AACX6e,eAAKmH,EAAGnH;AACRE,eAAKiH,EAAGjH;AAER/e,eAAKA,OADW4X,EAAQwG,aAAape,OAArBA,KAAiCA,MAC5BA,KAAKsmB,SAAStmB,gBAA/BA;AACFA;AAEF4X,cAAUA,EAAQ2J;QARJvhB;AAUhBA,eAAOA,IAAImkB,mDAAWtF,GAAGE,CAAlB/e;MAbyCA;8DAwB5CC,WAAyBA;AAE7BA,cAAMwmB,IAAqB9mB,yDAANM;AACrBA,eAAOA,IAAI8kB,uCACT0B,EAAa1H,GACboB,SAASmE,gBAAgBsB,eAAea,EAAa1H,GACrD0H,EAAa5H,GACbsB,SAASmE,gBAAgBoB,cAAce,EAAa5H,CAJ/C5e;MAHsBA;AAiBzBC,gEAAAA,WAA2BA;AAC/BA,cAAM+jB,IAAK9D,SAASmE,iBACdoC,IAAM3C;AACZ7jB,eAAOA,IAAIikB,mDACTuC,EAAIlC,eAAeP,EAAGQ,YACtBiC,EAAIhC,eAAeT,EAAGU,SAFjBzkB;MAHwBA;oEAiB3BC,SACJwmB,GACAC,GAA6BzmB;AAE7BA,YAAM0mB,IAAUD,EAAkB/H;AAC5BiI,YAAUF,EAAkB7H;AAMlC5e,cAAM4mB,IAJeJ,EAAGK,gBAAHC,EAIa5C,sBAAblkB;AAGf+mB,YAAqB/mB,IAAIgkB,mDAC7B0C,IAAUE,EAAa5D,MACvB2D,IAAUC,EAAa7D,GAFE/iB;AAOrBgnB,YAAmBR,EAAGS,wBAAHjnB;AAUzBA,eAN0BgkB,mDAAWkD,WACnCH,GACAC,CAFwBG,EAKkBrP,MAAM9X,IAAIwmB,EAAG1O,KAA/BsP;MA5BGpnB;oEAwCzBC,SACJumB,GACAa,GAAgCpnB;AAGhCA,YAAMwmB,IAAoBY,EAAqBvP,MAAM0O,EAAG1O,KAA9B7X;AACpBymB,YAAUD,EAAkB/H;AAC5BiI,YAAUF,EAAkB7H;AAGlC3e,cAAM2mB,IADeJ,EAAGK,gBAAHC,EACa5C,sBAAbjkB;AACfqnB,YAAad,EAAGS,wBAAHhnB;AAGnBA,eAAOA,IAAI+jB,mDACT0C,IAAUE,EAAa5D,OAAOsE,EAAW5I,GACzCiI,IAAUC,EAAa7D,MAAMuE,EAAW1I,CAFnC3e;MAZyBA;4DCjI5BC,SAA6BqnB,GAIlCrnB;AACCA,SAACA,EAECA,UAAA8f,4CAAWA,2CACX9f,WAAAsnB,6CAAYA,4CACZtnB,eAAAunB,iDAAgBA,+CAJjBvnB,IAKGqnB;AAEJG,qDAAYxnB,IAAIsnB;AAChBG,yDAAgBznB,IAAIunB;MATrBvnB;AA0BK+f,QAAAA,iDAAAA,SAAwB2H,GAAe3H;AAC3CA,eAAOD,0CAASU,gBAAgBmH,6CAAYD,CAArC3H;MADoCA;AAUvCE,QAAAA,kDAAAA,SAAyBkC,GAAYlC;AACzCA,eAAOH,0CAASG,eAAekC,CAAxBlC;MADkCA;QAoBrC2H,6CAAAA,SAAoBzF,GAAYyF;AACpCA,YAAIC,IAAML,2CAAUM,gBAAgB3F,GAAMyF,UAAhCA;AACVA,YACEC,KACAA,EAAI5D,mBACJ2D,CAACC,EAAIE,qBAAqBH,aAAzBA,EAAwCjT;AAEzCiT,iBAAOC,EAAI5D;AAMb2D,aADAC,IAAML,2CAAUM,gBAAgB3F,GAAMyF,WAAhCA,MAGJC,EAAIvF,KAAKjC,cACsCuH,UAA/CC,EAAIvF,KAAKjC,WAAW2H,SAASnV,YAA7B+U;AAEAA,iBAAOC,EAAIvF,KAAKjC;AAGlBuH,cAAUhV,MAAMgV,kCAAkCzF,CAAlCyF,EAAVA;MArB8BA;mDAsChC3nB,SAAoBgoB,GAAShoB;AACjCA,eAAOC,8CAAaunB,+CAAcS,kBAAkBD,CAAhChoB,CAAbA;MAD0BA;AAInCC,sDAAAA,SAAsBiiB,GAAYjiB;AAChCA,eAAOiiB,EAAKvC,QACVuI,wDACCrC,OAAU5lB,KAAK4lB,EAAMsC,WAAWloB,CAAjBA,CAALA,GAFNA;MADyBA;qECmB5BC,SACJkoB,GAAoCloB;AAEpCA,YAAIA,CAACkoB;AACHloB,iBAAOA;AAGTA,YAAIkoB,aAAsBC,WAAiCnoB,aAAtBA,OAAOkoB;AAC1CA,cAAaznB,sDAAiBynB,CAAjBloB,GAGbkoB,IAAa5nB,0DAAqB4nB,CAArBloB;AAIfC,6DAAgBmoB,CAAhBpoB;AACAA,eAAOooB;MAf6BpoB;6DAwBtCC,SAAyBmoB,GAAwBnoB;AAC/CA,cAAMooB,IAAcD,EAAAnoB;AACdqoB,YAAkBF,EAAAnoB;AAExBA,YAAIooB,KAEAA,MAAgBE,4DAChBF,MAAgBG;AAEhBvoB,gBAAMwS,MACJxS,0BACEooB,IACApoB,4BAEAsoB,2DACAtoB,SACAuoB,0DAPEvoB;AAWVA,YAAIA,CAACqoB;AACHroB,gBAAMwS,MAAMxS,yCAANA;MArBuCA;yEAgC3CC,SACJuoB,GAAkCvoB;AAElCA,eAAKuoB,IAIAA,EAAAvoB,WACKuoB,EAAAvoB,WAMR+W,MAAMyR,QAAQD,CAAdvoB,KACmBA,IAAnBuoB,EAAUjU,UACVtU,CAAEuoB,EAAUvoB,CAAVA,EAAoCyoB,WAI/BF,IAKFloB,oDAAekoB,CAAfvoB,IArBEA,CAAAA;MAHyBA;AAkC9BC,2DAAAA,SAAwBioB,GAA+BjoB;AAC3DA,eAAOmU,+CAAUlU,sBAAsBgoB,CAAhCjoB;MADoDA;mEAO7DC,SAA+BgoB,GAA+BhoB;AAC5DA,YAAIA,CAACgoB;AACHhoB,iBAAOA;AAGTA,cAAMioB,IAAcD,EAAAhoB;AACpBA,eAAIioB,IACKA,MAAgBG,6DAMlBpoB,CAACA,CAHWgoB,EAAAhoB,SAAwBzE,OAAOyE,SAAUwoB,GAAIxoB;AAC9DA,iBAAsCA,eAA/BwoB,EAAAxoB,KAAayoB,YAAbzoB;QADuDA,CAA7C0oB,EAGCtU;MAbwCpU;AAuBxDC,mEAAAA,SAAgC0oB,GAA0B1oB;AAC9DA,eAAK0oB,KAAkBA,EAAA1oB,WAShBA,CAACA,CALY0oB,EAAA1oB,SAAgD1E,OAClE0E,SAAUuoB,GAAwBvoB;AAChCA,iBAAsCA,eAA/BuoB,EAAAvoB,KAAawoB,YAAbxoB;QADyBA,CADhByoB,EAKAtU,SARXnU;MAFqDA;kEAmBhEC,SAA8B4nB,GAAgB5nB;AAE5CA,cAAM8nB,IAAc9nB,EAACA,UADJC,oDAAe2nB,CAAfc,EACG1oB;AAChB4nB,qBAAsBe,QACxBzoB,mDAAc0nB,GAAYE,CAA1B9nB;AAEFA,eAAO8nB;MANqC9nB;4DAe9CC,SACE2nB,GAAoC3nB;AAEpCA,cAAM0e,IAAM1e,CAAAA;AAIZA,YAAI2oB,IAAchB,EAAkCgB;AAC/CA,cAEHA,IAAahB;AAEf3nB,iBAASuU,IAAIvU,GAAG+Y,GAAQA,IAAQ4P,EAAWpU,CAAXvU,GAAgBuU,KAAKvU;AACnDA,cAAIA,CAAC+Y,EAAMiO;AACThnB;AAEI4oB,cAAM5oB,CAAAA;AACZA,gBAAMgnB,IAAUjO,EAAMiO,QAAQsB,YAAdtoB;AACf4oB,YAAA5oB,OAAqCgnB;AAGtBhnB,sBAAZgnB,IACD4B,EAAA5oB,WAAyC+Y,IACjCA,EAAM4P,cAAwC3oB,IAA1B+Y,EAAM4P,WAAW1U,WAE7C2U,EAAA5oB,WAAyCA,oDAAe+Y,CAAf/Y;AAI5CC,6DAAc8Y,GAAO6P,CAArB5oB;AACA0e,YAAIrK,KAAKuU,CAAT5oB;QAlBmDA;AAsBrDA,eAAO0e;MAjC6B1e;2DA0CtCC,SAAuBsc,GAAYqM,GAAuB3oB;AAGxDA,iBAAS4oB,IAAI5oB,GAAG4oB,IAAKtM,EAA4BuM,WAAW7U,QAAQ4U,KAAK5oB;AAGvEA,gBAAM8oB,IAAQxM,EAA4BuM,WAAWD,CAAvC5oB;AACV8oB,YAAKzB,SAAS/B,SAAStlB,MAAvBA,KACF2oB,EAAA3oB,YAAmB2oB,EAAA3oB,aAAoBA,CAAAA,GACvC2oB,EAAA3oB,UAAiB8oB,EAAKzB,SAASpI,QAAQjf,QAAQA,EAA9BA,CAAjBA,IAAsD8oB,EAAKpK,SAE3DiK,EAAIG,EAAKzB,QAATrnB,IAAqB8oB,EAAKpK;QAR2C1e;MAHjBA;8DAsBpDC,SACJynB,GAAmCznB;AAEnCA,YAAI8oB,IAAmC9oB;AACvCA,YAAIynB;AACFznB,cAA0BA,aAAtBA,OAAOynB,GAETznB;AAAAA,gBADA8oB,IAA4B9B,EAAAA,2CAAUS,CAAnBznB,GAC6BA,UAA5C8oB,EAAiB1B,SAASnV,YAA1BjS;AACFA,oBAAM+oB,UAAU/oB,sCAAVA;UADRA;AAGSynB,yBAAsBC,YAC/BoB,IAAmBrB;AAGvBznB,eAAO8oB;MAb4B9oB;yEC1U/BC,SACJ+hB,GACAgH,GACAC,GACAC,GACAC,GACAlR,GAAuBhY;AAIvBA,cAAMmpB,IACJnR,EAAUoR,aAAapR,EAAUoR,UAAUC,oBAApBrpB;AACrB+hB,UAASuH,eAAeC,+DAAmBC,QAC7CvH,IAAOiH,EAAQO,gBAAgBxH,OAAO+G,GAClCG,KAAwBnR,EAAU0R,QACpCzH,KAAQ0H,2CAAUC,wBAIpB3H,IACEiH,EAAQO,gBAAgBxH,OACxBiH,EAAQW,YAAYxP,QACpB0O,EAAK1O,QACL2O,GACEG,KAAwBnpB,CAACgY,EAAU0R,QACrCzH,KAAQ0H,2CAAUC;AAKlB7H,UAAS+H,aAAaC,6DAAiBC,MACzChI,IAAMkH,EAAQO,gBAAgBzH,MAAMiH,KAGpCjH,IACEkH,EAAQO,gBAAgBzH,MACxBkH,EAAQW,YAAYtP,SACpBwO,EAAKxO,SACL0O,GACEjR,EAAUoR,aAAapR,EAAUoR,UAAUa,sBAApBjqB,MAEzBgiB,KAAO2H,2CAAUC;AAGrB5pB,eAAOA,IAAI6jB,uCAAK7B,GAAKA,IAAM+G,EAAKxO,QAAQ0H,GAAMA,IAAO8G,EAAK1O,KAAnDra;MAtCgBA;6EAoDnBC,SACJ+X,GACAkR,GAAkBjpB;AAUlBA,eAAOA,EAACqpB,YAPNJ,EAAQgB,eAAenI,aAAqBoI,8CAASX,QACnDxR,EAAUoS,oBAA8BV,CAAV1R,EAAU0R,MAIxCH,+DAAmBc,QADnBd,+DAAmBC,MAGQM,UALbZ,EAAQgB,eAAenI,aAAqBoI,8CAASG,SAIzCP,6DAAiBC,MAAMD,6DAAiBO,OAC/DrqB;MAVWA;qEA2BdC,SACJqqB,GACAC,GACAC,GACAC,GAAsBxqB;AAGtBA,cAAM+hB,IAAOsI,EAAUtI,MACjB5H,IAAQkQ,EAAU5G,QAAQ4G,EAAUtI,MACpC1H,IAASgQ,EAAU3G,SAAS2G,EAAUvI;AAI5C9hB,iBAASkU,IAAIlU,GAAGkU,IAAIsW,EAAe5W,QAAQM,KAAKlU;AAC9CA,gBAAMyqB,IAAUD,EAAetW,CAAflU;AACZ2lB,YAAa+E,WAAWD,CAAxBzqB,MAEA8hB,IADEyI,MAAYI,0DAAcC,KACtBH,EAAQ3I,MAAMzH,IAASiQ,IAGvBG,EAAQ/G,SAAS4G,GAGzB3E,IAAe3lB,IAAI2jB,uCAAK7B,GAAKA,IAAMzH,GAAQ0H,GAAMA,IAAO5H,CAAzCna,GACfkU,IAAIlU;QAXwCA;AAchDA,eAAO2lB;MAvBe3lB;ACzHlBC,4CAAAA,SAAgB4qB,GAAiBC,GAAyB7qB;AAC9D8qB,0DAAoBF,GAASC,CAA7B7qB;MAD8DA;+CAU1DC,SAAmB8qB,GAAoD9qB;AAC3E6qB,4DAAsBC;MADqD9qB;AAWvEC,8CAAAA,SAAkB0qB,GAAiBlO,GAA+Bxc;AACtEuT,gDAAUtT,gBAAgByqB,GAASlO,CAAnCxc;MADsEA;AAOxEC,sDAAAA,SAAyByqB,GAAiBlO,GAA+Bvc;AACvE6qB,4DAAsBJ,GAASlO,CAA/Bvc;MADuEA;AAUnEC,iDAAAA,SACJ6qB,GAAgE7qB;AAEhE4qB,8DAAwBC;MAFwC7qB;6CAe5DC,SACJuqB,GACAM,GACAxO,GAAqCrc;AAErC8qB,2DAAqBP,GAASM,GAAcxO,CAA5Crc;MAFqCA;AAWjCC,gDAAAA,SACJ8qB,GAIS9qB;AAET6qB,6DAAuBC;MAFd9qB;AC/FLC,2GAAAA,SACJ8qB,GAAsB9qB;AAEtBA,eAA2CoU,WAAnC0W,EAAcC;MAFA/qB;ACUlBC,8FAAAA,SACJkG,GAAalG;AAEbA,eAA0CmU,WAAlCjO,EAAc6kB;MAFT/qB;+FAYTC,SACJiG,GAAajG;AAEbA,eACsCkU,WAAnCjO,EAAc8kB,oBACoB7W,WAAlCjO,EAAc+kB;MAJJhrB;ACPTirB,QAAAA,oDAAAA,SAA2BpG,GAAaoG;AACtCvQ,YAASmK,EAAGqG,aAAaD,KAAhBA;AACfA,cAAME,IAAYF,oBAAIpX;AAEtBoX,iBAASzX,IAAIyX,GAAGzX,IAAIkH,EAAOxH,QAAQM,KAAKyX;AACtCA,gBAAMG,IAAiB1Q,EAAOlH,CAAPyX,EAAUI,aAAVJ;AACvBA,cAAIG;AACFH,qBAASnD,IAAImD,GAAGnD,IAAIsD,EAAelY,QAAQ4U,KAAKmD;AAC9CA,oBAAMK,IAAWF,EAAetD,CAAfmD;AACNK,gBAASC,MAATrU,KAETiU,EAAU5L,IAAI+L,CAAdL;YAJ4CA;QAHZA;AAaxCA,eAAOtV,MAAMC,KAAKuV,EAAUK,OAAVP,CAAXA;MAjBqCA;QA+BxCQ,yDAAAA,SAAgCrU,GAAoBqU;AAClD/Q,YAAStD,EAAU8T,aAAaO,KAAvBA;AACfA,cAAMN,IAAYM,oBAAI5X;AACtB4X,iBAASjY,IAAIiY,GAAGxlB,GAAQA,IAAQyU,EAAOlH,CAAPiY,GAAYjY,KAAKiY;AAC/CA,cAAMC,IAAwBzlB,EAAMylB;AACpCD,cAAIC,GAAuBD;AACnBE,gBAAUD,EAAAD;AAChBA,qBAAS3D,IAAI2D,GAAG3D,IAAI6D,EAAQzY,QAAQ4U;AAClCqD,gBAAU5L,IAAIoM,EAAQ7D,CAAR2D,CAAdA;UAHuBA;QAFoBA;AAUjDA,eAAO9V,MAAMC,KAAKuV,EAAUK,OAAVC,CAAXA;MAbiDA;wDAuBpDxrB,SAAyBmX,GAAuBnX;AACpDA,YAAI2rB,IAAU3rB,CAAAA;AACdA,cAAM0c,IAAS0B,SAASC,cAAcre,QAAvBA;AACf0c,UAAO9C,aAAa5Z,QAAQA,qBAA5BA;AACA0c,UAAO9C,aAAa5Z,eAAeA,iBAAnCA;AAEAmX,UAAUyU,uBAAuB5rB,mBAAmBA,SAAU0c,GAAM1c;AAClEK,uEAA4Bqc,EAAOmP,mBAAP7rB,CAA5BA;QADkEA,CAApEA;AAIA2rB,UAAQtY,KAAKqJ,CAAb1c;AAEM8rB,YAAY7rB,sDAAqBkX,CAArBnX;AAElBA,eADA2rB,IAAUA,EAAQlW,OAAOqW,CAAf9rB;MAb0CA;8DAuBhDC,SAA+BkX,GAAoBlX;AACjD8rB,YAAoB5U,EAAU6U,mBAAmB/rB,EAA7BA;AAE1BA,cAAM0rB,IAAU1rB,CAAAA;AAChBA,YAA+BA,IAA3B8rB,EAAkB9Y,QAAYhT;AAEhCA,cAAMgsB,IAAqBF,EAAkBA,EAAkB9Y,SAAShT,CAA7CA;AAC3BA,cAAI2a,qCAAA3a,eAAyBA;AAC3BA,gBAAM+F,IAAiBqY,EAAAA,+CAAcpe,OAAvBA;AACd+F,cAAM4T,aAAa3Z,QAAQA,eAA3BA;AACA+F,cAAM4T,aAAa3Z,OAAO2a,qCAAA3a,cAAwBA,MAAMA,IAAxDA;AACA+F,cAAMwY,YAAY5d,0DAAyBqrB,CAAzBhsB,CAAlBA;AACA0rB,cAAQtY,KAAKrN,CAAb/F;UAL2BA;AAOzB2a,+CAAA3a,gBACI+F,IAAiBqY,EAAAA,+CAAcpe,OAAvBA,GACd+F,EAAM4T,aAAa3Z,QAAQA,aAA3BA,GACA+F,EAAM4T,aAAa3Z,OAAO2a,qCAAA3a,gBAA0BA,OAAOA,GAA3DA,GACA+F,EAAMwY,YAAY5d,0DAAyBqrB,CAAzBhsB,CAAlBA,GACM0d,IAAiBuI,EAAAA,2CACrBjmB,6FADYA,GAOd+F,EAAMwY,YAAYb,CAAlB1d,GACA0rB,EAAQtY,KAAKrN,CAAb/F;AAGFA,cAAI2a,qCAAA3a,eAAyBA;AAC3B8rB,cAAkBG,KAAKC,oDAAcC,aAArCnsB;qBACSsT,IAAItT,GAAGorB,GAAWA,IAAWU,EAAkBxY,CAAlBtT,GAAuBsT;AACrDvN,kBAAiBqY,EAAAA,+CAAcpe,OAAvBA,GACd+F,EAAM4T,aAAa3Z,QAAQA,eAA3BA,GACA+F,EAAM4T,aAAa3Z,OAAOA,GAA1BA,GACA+F,EAAMwY,YAAY5d,0DAAyByqB,CAAzBprB,CAAlBA,GACA0rB,EAAQtY,KAAKrN,CAAb/F;UAPyBA;QA1BGA;AAqClCA,eAAO0rB;MAzCgD1rB;AAuDnDC,4DAAAA,SAA6BiX,GAAoBjX;AACrDA,eAAO6S,2CAAU5S,2BAA2BgX,CAArCjX;MAD8CA;oEAOvDC,SAAoCgX,GAAoBhX;AACtDA,eAAOC,+DACLisB,oDAAmBC,OAAOnsB,CAA1BA,GACAgX,EAAUoV,oBAAVpsB,CAFKA;MAD+CA;uEAgBlDC,SACJosB,GACAC,GAAmBrsB;AAEnBA,YAAIA,CAACqsB,EAAUxZ;AACb7S,iBAAOosB;AAGTpsB,cAAMssB,IAAUL;AAChBjsB,YAAIusB,IAASvsB,IACTwsB,IAAcF,EAAQxS,QAAQsS,CAAhBpsB;AAIlBA,mBAAaA;AACXA,cAAIysB,IAAQzsB;AACZA,mBAASmT,IAAInT,GAAGmT,IAAIkZ,EAAUxZ,QAAQM;AACpCnT,gBAAIqsB,EAAUlZ,CAAVnT,EAAa+Q,YAAb/Q,MAA+B0sB,GAAS1sB;AAC1CysB,kBAAQzsB;AACRA;YAF0CA;AAK9CA,cAAIA,CAACysB;AACHzsB;AAGFwsB;AACIA,gBAAgBF,EAAQzZ,WAE1B2Z,IAAcxsB,GACdusB,IAASvsB,GAAGkkB,OAAOqI,CAAPvsB,IAAiBA,CAApBA;AAEX0sB,cAAUJ,EAAQJ,OAAOM,CAAfxsB,IAA8BusB;QAlB7BvsB;AAoBbA,eAAO0sB;MAhCY1sB;qEAmDfC,SACJ8W,GACAgT,GACA4C,GAAiB1sB;AAIjB2sB,iBAASA,EAAwBC,GAAmB5sB;AAClDC,sDAAW4sB,EAAAA,+BAAA7sB,oBAA2B4sB,GAAa5sB,SAAUogB,GAAIpgB;AAC/DA,gBAAKogB,GAALpgB;AAMAA,kBAAM8sB,IAAW3sB,qDAAoBigB,GAAMtJ,CAA1B9W;AACjBA,kBAAK8sB,GAAL9sB;AAQAA,oBAAI8sB,EAASvc,SAASA;AACpBvQ,sBAAA0R,IAAMmb,EAAAA,+BAAA7sB,wBAA+B6d,QAAQ7d,MAAM8sB,EAAStc,IAAtDxQ;;AAEN0R,sBAAMmb,EAAAA,+BAAA7sB,0CACN0R,IAAMA,EAAImM,QAAQ7d,MAAM8sB,EAAStc,IAA3BxQ,EAAiC6d,QAAQ7d,MAAM8sB,EAASvc,IAAxDvQ;oDAEK0R,GAAK1R,WAAAA;AAChB2sB,oBAAwBvM,CAAxBpgB;gBADgBA,CAAlBA;cAdAA;AAEE8W,kBAAUtW,eAAe4f,GAAM7P,CAA/BvQ,GACI8pB,KAAcA,EAAa1J,CAAbpgB;YAVpBA;AAEM8pB,mBAAcA,EAAa9pB,IAAbA;UAH2CA,CAAjEA;QADkDA;AAFpDA,cAAMuQ,IAAOmc,KAAY1sB;AA8BzB2sB,UAAwB3sB,EAAxBA;MAhCiBA;QA8Cb+sB,kDAAAA,SACJjW,GACAkU,GACAlB,GAA2CiD;AAG3CJ,iBAASA,EAAwBC,GAAmBG;AAClDA,gBAAMC,IAAaH,EAAAA,+BAAAE,sBAA6BlP,QAC9CkP,MACA/B,EAASxa,IAFQuc;AAInB9sB,sDAAW+sB,GAAYJ,GAAaG,SAAUE,GAAOF;AACnDA,gBAAKE,GAALF;AAMAA,kBAAMD,IAAW5sB,uDAAsB+sB,GAASjC,EAASza,MAAMuG,CAA9CiW,GACXG,IAAY9sB,8DAChB4qB,EAASxa,MACTyc,GACAnW,CAHgBiW;AAKlBA,kBAAKD,KAAaI,GAAlBH;AAOAA,oBAAIrb,IAAMqb;AACND,oBACFpb,IAAMmb,EAAAA,+BAAAE,yCACHlP,QAAQkP,MAAMD,EAAStc,IADpBuc,EAEHlP;kBAAQkP;kBAAMD,EAASvc;gBAFpBwc,IAGGG,MACTxb,IAAMmb,EAAAA,+BAAAE,wCACHlP,QAAQkP,MAAME,CADXF,EAEHlP,QAAQkP,MAAMG,CAFXH;AAID9tB,oDAAMyS,GAAKqb,WAAAA;AAChBJ,oBAAwBM,CAAxBF;gBADgBA,CAAlBA;cAjBAA;AAEEjW,kBAAUqW,mBAAmBnC,EAASC,MAAT8B,GAAkBE,CAA/CF,GACIjD,KAAcA,EAAamD,CAAbF;YAfpBA;AAEMjD,mBAAcA,EAAaiD,IAAbA;UAH+BA,CAArDA;QALkDA;AAwCpDJ,UAAwBI,EAAxBA;MA3C2CA;oDAsDvC9sB,SACJ+sB,GACAI,GACAzR,GAAqC1b;AAE9BX,6CAAO0tB,GAAYI,GAAantB,SAAUotB,GAAMptB;AAGjDotB,gBACFA,IAASA,EAAOxP,QAAQ5d,cAAcA,GAA7BA,EAAkC2Q,KAAlC3Q,GACLotB,MAAWR,EAAAA,+BAAA5sB,mBAA0BotB,MAAWR,EAAAA,+BAAA5sB,kBAElDotB,IAASptB;AAGb0b,YAAS0R,CAATptB;QAVqDA,CAAvDA;MAFqCA;AAyBvCC,+DAAAA,SACEsQ,GACAD,GACAuG,GAAoB5W;AAEdotB,YAAexW,EAAUyW,eAAVrtB,EAA2BstB,gBAA3BttB;AAErBsQ,YAAOA,EAAKM,YAAL5Q;AACPA,iBAASgT,IAAIhT,GAAG8qB,GAAWA,IAAWsC,EAAapa,CAAbhT,GAAkBgT;AACtDhT,cAAI8qB,EAASxa,KAAKM,YAAd5Q,MAAgCsQ,KAAQwa,EAASza,SAASA;AAC5DrQ,mBAAO8qB;AAGX9qB,eAAOA;MAVaA;6DAoBhBC,SACJqQ,GACAsG,GAAoB3W;AAEdmtB,YAAexW,EAAUyW,eAAVptB,EAA2BqtB,gBAA3BrtB;AAErBqQ,YAAOA,EAAKM,YAAL3Q;AACPA,iBAAS+S,IAAI/S,GAAG6qB,GAAWA,IAAWsC,EAAapa,CAAb/S,GAAkB+S;AACtD/S,cAAI6qB,EAASxa,KAAKM,YAAd3Q,MAAgCqQ;AAClCrQ,mBAAO6qB;AAGX7qB,eAAOA;MAVaA;AAyBhBC,sEAAAA,SACJqtB,GACAR,GACAnW,GAAoB1W;AAEpBA,eAAO0W,EAAU4W,gBAAVttB,EAA4ButB,cAA5BvtB,EAA4CwS,SAC/CvS,6EAA4CotB,GAASR,GAASnW,CAA9D1W,IACAE,8EAA6CmtB,GAASR,GAASnW,CAA/D1W;MAJgBA;qFAWtBC,SACEotB,GACAR,GACAnW,GAAoBzW;AAEpBotB,YAAUA,EAAQ3c,YAARzQ;AACV4sB,YAAUA,EAAQnc,YAARzQ;AAEJutB,YAAa9W,EAAU4W,gBAAVrtB,EAA4BstB,cAA5BttB;AACnBA,mBAAW6sB,KAAaU,GAAYvtB;AAClCA,cAAMwtB,IAASX,EACZY,cADYztB,EAEZtG,OAAOyF,kGAFKa,EAGZmT,IAAK8W,OAAUA,EAAMC,iBAAN/Z,EAAyBA,IAH5BnQ;AAIfA,cAAKwtB,MACCE,IAAaF,EAAOG,KAAM1D,OAAUA,EAAMxZ,YAANzQ,MAAwBotB,CAA/CptB,GACb4tB,IAAaJ,EAAOG,KAAM1D,OAAUA,EAAMxZ,YAANzQ,MAAwB4sB,CAA/C5sB,GACf0tB,KAAcE;AAAY5tB,mBAAO6sB,EAAUgB,QAAV7tB;QARHA;AAUpCA,eAAOA;MAhBaA;sFAuBtBC,SACEmtB,GACAR,GACAnW,GAAoBxW;AAEpBmtB,YAAUA,EAAQ3c,YAARxQ;AACV2sB,YAAUA,EAAQnc,YAARxQ;AAEJ8Z,YAAStD,EAAU8T,aAAatqB,KAAvBA;AACfA,mBAAWqF,KAASyU,GAAQ9Z;AAC1BA,cAAIA,CAACb,sFAA0BkG,CAA1BrF;AAAkCA;AACjC6tB,cAAMxoB,EAAM6kB,gBAANlqB;AACZA,cAAMutB,IAASM,EAAI7tB,CAAJA;AACfA,gBAAM8tB,IAAcP,EAAOG,KAAM1D,OAAUA,EAAMxZ,YAANxQ,MAAwBmtB,CAA/CntB;AACd+tB,cAAcR,EAAOG,KAAM1D,OAAUA,EAAMxZ,YAANxQ,MAAwB2sB,CAA/C3sB;AACpBA,cAAI8tB,KAAeC;AAAa/tB,mBAAO6tB,EAAI7tB,CAAJA;QANbA;AAQ5BA,eAAOA;MAdaA;kEAuBhBC,SACJ+tB,GAA4B/tB;AAK5BA,cAAMguB,IAAiBvQ,EAAAA,+CAAczd,OAAvBA;AACdguB,UAAMhV,aAAahZ,QAAQA,KAA3BA;AACAguB,UAAMhV,aAAahZ,MAAM+tB,EAAcrD,MAAd1qB,CAAzBA;AACAguB,UAAMhV,aAAahZ,gBAAgB+tB,EAAc/d,IAAjDhQ;AACMiQ,YAAgB0N,EAAAA,gDAAeoQ,EAAc9d,IAAtCjQ;AACbguB,UAAMpQ,YAAY3N,CAAlBjQ;AACAA,eAAOguB;MAXqBhuB;QA0BxBiuB,8DAAAA,SACJ1X,GACAF,GACA6X,GACA/B,GAAiB8B;AAEjBA,YAAIxD,IAAW0D,EAAAA,6CAAY5X,GAAWF,GAAI6X,GAAU/B,CAArC8B;AACVxD,cACHA,IAAWxqB,gDAAesW,GAAWF,GAAI6X,GAAU/B,CAAxC8B;AAEbA,eAAOxD;MANUwD;QAwBbE,+CAAAA,SACJ5X,GACAF,GACA6X,GACA/B,GAAiBgC;AAEjBA,cAAMC,IAAuB7X,EAAU8X,wBAAVF;AAC7BA,YAAI1D,IAAW0D;AAEfA,YAAI9X,MAEFoU,IAAWlU,EAAU+X,gBAAgBjY,CAA1B8X,GACPA,CAAC1D,KAAY2D,MACf3D,IAAW2D,EAAqBE,gBAAgBjY,CAArC8X,IAET1D;AACF0D,iBAAO1D;AAKX0D,YAAID,GAAUC;AACZA,cAAiB9a,WAAb8Y;AACFgC,kBAAM7d,MAAM6d,oDAANA;AAGR1D,cAAWlU,EAAU4X,YAAYD,GAAU/B,CAAhCgC;AACPA,WAAC1D,KAAY2D,MACf3D,IAAW2D,EAAqBD,YAAYD,GAAU/B,CAA3CgC;QAPDA;AAUdA,eAAO1D;MA3BU0D;wDAyCnBluB,SACEsW,GACAF,GACA6X,GACA/B,GAAiBlsB;AAEjBA,cAAMmuB,IAAuB7X,EAAU8X,wBAAVpuB;AAExBiuB,cAIHA,IAAW5uB,oDAHAiX,EAAUgY,WAChBhY,EAA2BiY,kBAC5BjY,CACOtW;AAWbA,eANImuB,IACSA,EAAqBnuB,eAAeiuB,GAAU/B,GAAU9V,CAAxDpW,IAGAsW,EAAUtW,eAAeiuB,GAAU/B,GAAU9V,CAA7CpW;MAjBIA;AAmCbC,2DAAAA,SACJqW,GACAkY,GAAkCvuB;AAE5BwuB,YAAsBnY,EAAU0W,gBAAV/sB;AAC5BA,cAAMyuB,IAAiBzuB,CAAAA;AACvBA,YAAIuuB,EAAkBpc,WAAWqc,EAAoBrc;AACnDnS,mBAASyS,IAAIzS,GAAGyS,IAAI+b,EAAoBrc,QAAQM,KAAKzS;AACnDA,kBAAMuqB,IAAWiE,EAAoB/b,CAApBzS;AAGZuuB,cAAkB9K,SAAS8G,CAA3BvqB,KACHyuB,EAAelc,KAAKgY,CAApBvqB;UALiDA;AASvDA,eAAOyuB;MAd2BzuB;6DC5kB9BC,SAAsBiF,GAAejF;AACzCI,4DAAW6E,CAAXjF;AAEAA,YAAIG,iEAAAH;AAEFA,iBADAK,mDAAAL,GACOyuB,QAAQC,QAAR1uB;AAGJ2uB,yEACHA,+DAAsB3uB,IAAIyuB,QAASC,OAAW1uB;AAC5C4uB,0EAAuBF;AACvBG,wEAAqB5N,OAAO9O,sBAAsBnS,MAAKA;AACrDK,+DAAAL;AACA0uB,cAAA1uB;UAFqDA,CAAlCA;QAFuBA,CAAxBA;AAQxBA,eAAO2uB;MAjBkC3uB;AAwBrCC,qEAAAA,WAA6BA;AAGjCA,eAAO0uB,+DAAsBA,+DAAsBF,QAAQC,QAARzuB;MAHlBA;sEAe7BC,SAA+BkW,GAAwBlW;AACtDkW,aAAW6K,OAAO6N,qBAAqBD,2DAA5B3uB;AAChBG,2DAAU+V,CAAVlW;AACIA,SAACkW,KAAawY,iEAAsBA,8DAAA1uB;MAHmBA;AAW7DC,yEAAAA,WAAgCA;AAC9BA,eAAiB4uB;MADa5uB;4DAUhCC,SAAoB6E,GAAe7E;AACjC4uB,6DAAYzQ,IAAItZ,CAAhB7E;AACA6uB,6DAAYC,IAAIjqB,GAAkB0Q,EAAAA,6CAAXvV,CAAvBA;AACAA,cAAMuW,IAAS1R,EAAM2R,UAANxW;AACXuW,YACFvW,oDAAWuW,CAAXvW,IAEA+uB,oDAAW5Q,IAAItZ,CAAf7E;MAP+BA;2DAgBnCC,SAAmB+V,GAAwB/V;AACzCA,cAAMkX,IAAanB,IACf/V,oBAAIwS,IAAIxS,CAAC+V,CAAD/V,CAARA,IACAA,IAAIwS,IAAIxS,CAACA,GAAG8uB,mDAAJ9uB,EAAgByS,IAAK7N,OAAUA,EAAMmR,SAArC/V,CAARA,GACEqZ,IAASrZ,CAACA,GAAG8uB,mDAAJ9uB,EACZhH,OAAOkH,8DADKF,EAEZhH,OAAQ+1B,OAAM7X,EAAW8X,IAAID,EAAEhZ,SAAjB/V,CAFFA;AAGfA,iBAAW4E,KAASyU;AAClBlZ,+DAAYyE,CAAZ5E;AAEFA,mBAAW+V,KAAamB;AACtBnB,YAAUkZ,eAAVjvB;AAEFA,iBAAW4E,KAASyU;AACZ6V,cAActqB,EAAMuqB,uBAANnvB,GACpB4E,EAAMwqB,yBAAyBF,CAA/BlvB;mBAES4E,KAASyU;AACZgW,cAAsB/Z,EAAAA,6CAAXtV,IACXsvB,IAAWV,qDAAYt1B,IAAIsL,CAAhB5E,MACQuV,EAAAA,6CAAS+Z,CAApBtvB,GAEd4E,EAAM2qB,eAANvvB,GAEWuV,EAAAA,6CAAS8Z,CAApBrvB;AAGFA,mBAAW4E,KAASyU;AAClBpZ,gEAAa2E,CAAb5E;AAEG+V,cAAWuY,+DAAsBtuB;MA9BGA;8DAkC3CC,SAAsB2E,GAAe3E;AACnC6uB,4DAAWU,OAAO5qB,CAAlB3E;AACA0uB,6DAAYa,OAAO5qB,CAAnB3E;AACA2uB,6DAAYY,OAAO5qB,CAAnB3E;AACAA,mBAAW0W,KAAS/R,EAAM6qB,YAAYxvB,KAAlBA;AAClBA,gEAAa0W,CAAb1W;MALiCA;AAkBrCC,uEAAAA,SAA+B0E,GAAe1E;AAC5CA,eAAOA,CAAC0E,EAAM8qB,WAANxvB,KAAsBA,CAAC0E,EAAM2R,UAANrW;MADaA;6DAU9CC,SAAqByE,GAAezE;AAClCA,YAAKwuB,qDAAYK,IAAIpqB,CAAhBzE,KACAyE,EAAM+qB,aAAXxvB;AACAA,qBAAWwW,KAAS/R,EAAM6qB,YAAYtvB,KAAlBA;AAClBA,iEAAYwW,CAAZxW;AAEFyE,YAAMgrB,kBAANzvB;QAJAA;MAFkCA;ACvK9BlI,+DAAAA,SAAmBwX,GAAcogB,GAAuB53B;AACnDA,iDAAkB2X,qCAAKkgB,YAAYrgB,GAAMogB,CAAlD53B;MAD4DA;iEASxDE,SAAqBsX,GAAYtX;AAC5BA,mDAAoByX,qCAAKkgB,YAAYrgB,CAA9CtX;MADqCA;qECEjCiI,SACJ2vB,GACA3vB,EACEA,gBAAA4vB,IAAiB5vB,OACjBA,SAAA6vB,IAAU7vB,KAFZA,IAMIA,CAAAA,GAAEA;AAENA,cAAM2V,IAAYga,EAAQha,WACpBP,IAAenF,uBAAOC,OAAOlQ,IAAdA;AAErBoV,UAAM8C,SAASyX,EAAQ5zB,QAARiE,EAAkBkY;AACjC9C,UAAM4C,QAAQ2X,EAAQ5zB,QAARiE,EAAkBgY;AAE5B6X,cAASza,EAAMK,KAAKka,EAAQla;AAC5Bma,cACIE,IAAMH,EAAQZ,uBAAR/uB,GACZoV,EAAMkG,IAAI3F,EAAU0R,MAAM1R,EAAUoa,SAAV/vB,IAAuB8vB,EAAIxU,IAAIwU,EAAIxU,GAC7DlG,EAAMoG,IAAIsU,EAAItU;AAGZmU,UAAQK,QAARhwB,MAAmBoV,EAAM6J,OAAO0Q,EAAQK,QAARhwB;AAChC2vB,UAAQM,YAARjwB,MAAuBoV,EAAM8a,YAAYlwB;AACxC2vB,UAAQQ,cAARnwB,MAAyBoV,EAAMgb,WAAWpwB;AAC1C2vB,UAAQU,aAARrwB,MAAwBoV,EAAMkb,UAAUtwB;AACxC2vB,UAAQY,eAARvwB,MAA0BoV,EAAMob,YAAYxwB;AAEjDA,eAAOoV;MArBDpV;uEAyBFC,SACJmV,GACAO,GACA1V,EAACA,YAAAoR,IAAapR,MAAdA,IAA+CA,CAAAA,GAAEA;AAEjDA,cAAMwwB,IAA4Bj4B,kDAAXyH;AACZkR,UAAAA,kDAAcE,CAAzBpR;AAEM0vB,YAAUha,EAAU+a,WAAWtb,EAAMK,EAA3BxV;AAEGwS,mBAAf2C,EAAM6J,QAAoB0Q,EAAQgB,QAAQvb,EAAM6J,IAAtBhf;AAC9BA,YAAgBwS,WAAZ2C,EAAMkG,KAA+B7I,WAAZ2C,EAAMoG,GAAiBvb;AAClDA,gBAAM2wB,IAAajB,EAAQZ,uBAAR9uB;AACLqb,cAAAA,GAAVA,IAAUA,SAAAA,IAANlG,EAAMkG,KAAAA,IAAKsV,EAAWtV;AAC9BA,cAAI3F,EAAU0R,MAAM1R,EAAUoa,SAAV9vB,IAAuBqb,IAAIA;AAC/BE,cAAAA;AAAVA,cAAUA,SAAAA,IAANpG,EAAMoG,KAAAA,IAAKoV,EAAWpV;AAChCmU,YAAQ3lB,OAAO/J,IAAI2gB,mDAAWtF,GAAGE,CAAlBvb,CAAfA;QALkDA;AAOpDA,YAAoBwS,WAAhB2C,EAAM4C,SAAuB5C,EAAM8C,QAAQjY;AACvC4wB,cAAclB,EAAQ5zB,QAARkE;AAGV+X,cAAAA,GACAE;AAHVyX,YAAQmB,QACN7wB,IAAIogB,uCACIrI,SAAAA,IAAN5C,EAAM4C,SAAAA,IAAS6Y,EAAY7Y,OACrBE,SAAAA,IAAN9C,EAAM8C,UAAAA,IAAU2Y,EAAY3Y,MAF9BjY,CADFA;QAF6CA;AASvBwS,mBAApB2C,EAAM8a,aAAyBP,EAAQoB,aAAa3b,EAAM8a,SAA3BjwB;AACZwS,mBAAnB2C,EAAMgb,YAAwBT,EAAQqB,YAAY5b,EAAMgb,QAA1BnwB;AACZwS,mBAAlB2C,EAAMkb,WAAuBX,EAAQsB,WAAW7b,EAAMkb,OAAzBrwB;AACTwS,mBAApB2C,EAAMob,aAAyBb,EAAQuB,aAAa9b,EAAMob,SAA3BvwB;AAExBkR,UAAAA,kDAAcsf,CAAzBxwB;AAEAA,eAAO0vB;MA/B0C1vB;2DCjD7CpI,SACJuX,GACA+hB,GAAqBt5B;AAEZA,iDAAkB2X,qCAAK4hB,QAAQhiB,GAAM+hB,CAA9Ct5B;MAFqBA;AAUjBE,6DAAAA,SAAqBqX,GAAYrX;AAC5BA,mDAAoByX,qCAAK4hB,QAAQhiB,CAA1CrX;MADqCA;2FC2BvCmI,SAAkCyvB,GAAiCzvB;AACjEA,cAAMyV,IAAYga,EAAQha,WAEpB0b,IAAQ1B,EAAQZ,uBAAR7uB,GACRyhB,IAASzhB,IAAI0gB,mDAAW1gB,GAAGA,CAAlBA,GAEToxB,IAAc3b,EACjB4b,eAAerxB,KADEA,EAEjBtH,OAAQ44B,OAAiBA,EAAa/b,OAAOka,EAAQla,EAFpCvV,EAGjBmS,IAAKof,OAAMA,EAAE1C,uBAAF7uB,CAHMA;AAKpBA,eACEC,sFAA4BygB,mDAAW8Q,IAAIL,GAAO1P,CAAtBzhB,GAA+BoxB,CAA3DpxB;AAEAyhB,YAAOgQ,UACLhc,EAAU0R,MAAMnnB,MAbM0xB,IAAAA,EAYxB1xB;AAMFyvB,UAAQ3lB,OAAO4W,mDAAW8Q;UAAIL;UAAO1P;QAAtBzhB,CAAfA;MApBiEA;AAuBnEC,8FAAAA,SACEkxB,GACAC,GAAyBnxB;AAEzBA,eAAOmxB,EAAYzE,KAChBgF,OACqC1xB,KAApCmiB,KAAKwP,IAAID,EAAWvW,IAAI+V,EAAM/V,CAA9Bnb,KACoCA,KAApCmiB,KAAKwP,IAAID,EAAWrW,IAAI6V,EAAM7V,CAA9Brb,CAHGA;MAFkBA;ACuCrBC,kDAAAA,SAAkBiU,GAAkB0d,GAAc3xB;AACtDiU,UAAQ+D,aAAa4Z,kDAAgBD,CAArC3xB;MADsDA;AAclDC,mDAAAA,SACJgU,GACA4d,GACA9V,GAA2C9b;AAEvC6T,cAAMyR,QAAQxJ,CAAd9b,MACF8b,IAAQA,EAAM7I,KAAKjT,GAAXA;AAGVgU,UAAQ+D,aADc8Z,gDAAcD,GACA5xB,GAAG8b,CAAH9b,EAApCA;MAN2CA;wEC/GvCC,SAAyB8lB,GAAQ9lB;AACrCA,eAAyBmS,WAAlB2T,EAAI+L,aAA6C1f,WAAlB2T,EAAIgM;MADL9xB;yDC4DjCN,SACJwE,GACAxE,EACEA,gBAAA4vB,IAAiB5vB,OACjBA,gBAAAqyB,IAAiBryB,MACjBA,eAAAsyB,IAAgBtyB,MAChBA,qBAAAuyB,IAAsBvyB,MACtBA,SAAA6vB,IAAU7vB,KALZA,IAYIA,CAAAA,GAAEA;AAENA,YAAIwE,EAAMguB,kBAANxyB;AACFA,iBAAOA;AAETA,cAAMoV,IAAQpV,EACZA,MAAQwE,EAAM4K,MACdpP,IAAM6vB,IAAUrrB,EAAMiR,KAAKhD,OAFfzS;AAKV4vB,aAGFpvB,uDAAWgE,GAAO4Q,CAAlBpV;AAIFO,mEAAeiE,GAAO4Q,CAAtBpV;AAGAS,mEAAe+D,GAAO4Q,GAA6Bmd,CAAnDvyB;AAGAU,8DAAU8D,GAAO4Q,GAA6Bmd,CAA9CvyB;AAGAW;UAAW6D;UAAO4Q;UAA6Bmd;QAA/CvyB;AACIqyB,aAGFzxB,4DACE4D,GACA4Q,GACAmd,GACA1C,CAJF7vB;AAOEsyB,aAGFzxB,2DACE2D,GACA4Q,GACAmd,GACA1C,CAJF7vB;AAUFA,eAAOoV;MAlDDpV;mEA4DRO,SAAwBiE,GAAc4Q,GAAY7U;AAC5CiE,UAAMyrB,YAAN1vB,MACF6U,EAAA7U,YAAqBA;AAElBiE,UAAM1L,UAANyH,MACH6U,EAAA7U,kBAA2B2T,MAAMC,KAAK3P,EAAMiuB,mBAANlyB,CAAXA;AAExBiE,UAAM+rB,eAANhwB,MACH6U,EAAA7U,YAAqBA;AAElBiE,UAAM6rB,aAAN9vB,MACH6U,EAAA7U,UAAmBA;AAEhBiE,UAAM2rB,cAAN5vB,MACH6U,EAAA7U,WAAoBA;AAGGkS,mBAAvBjO,EAAMkuB,gBACNluB,EAAMkuB,iBAAiBluB,EAAMmuB,wBAE7Bvd,EAAA7U,SAAkBiE,EAAMkuB;AAGtBluB,UAAMouB,SACRxd,EAAA7U,OAAgBiE,EAAMouB;MAxBwBryB;+DAkClDC,SAAoBgE,GAAc4Q,GAAY5U;AAC5CA,cAAMmV,IAAYnR,EAAMmR;AAClB8M,YAAKje,EAAMuqB,uBAANvuB;AACX4U,UAAA5U,IAAa8hB,KAAKuQ,MAAMld,EAAU0R,MAAM1R,EAAUoa,SAAVvvB,IAAuBiiB,EAAGnH,IAAImH,EAAGnH,CAA5D9a;AACb4U,UAAA5U,IAAa8hB,KAAKuQ,MAAMpQ,EAAGjH,CAAdhb;MAJ+BA;AAe9CC,mEAAAA,SACE+D,GACA4Q,GACAmd,GAA4B9xB;AAExB+D,UAAM/D,kBACFqyB,IAAatuB,EAAM/D,eAAe8xB,CAArB9xB,GACAA,SAAfqyB,MACF1d,EAAA3U,aAAsBqyB,MAEftuB,EAAMuuB,kBACTD,IAAatuB,EAAMuuB,cAANtyB,GACAA,SAAfqyB,MACF1d,EAAA3U,aAA0B1D,qCAAU+1B,CAAdryB,EAA0Bic,QAC9Cjc,sDACAA,EAFoBA;MAVEA;8DA0B9BC,SAAmB8D,GAAc4Q,GAAcmd,GAA4B7xB;AACzEA,cAAMsyB,IAAQ/iB,uBAAOC,OAAOxP,IAAdA;AACdA,mBAAWuyB,KAAQzuB,EAAM0uB,SAANxyB;AACbJ,0EAAe2yB,CAAfvyB,MACI0U,IAAQ6d,EAAKd,UAAUI,CAAf7xB,OACHsyB,EAAMC,EAAKE,QAALzyB,EAAeuQ,SAAfvQ,CAANA,IAAmC0U;AAI9CnF,eAAOU,KAAKqiB,CAAZtyB,EAAmB+Q,WACrB2D,EAAA1U,QAAiBsyB;MAVsDtyB;+DAsB3EC,SAAoB6D,GAAc4Q,GAAcmd,GAA4B5xB;AAC1EA,cAAMyyB,IAASnjB,uBAAOC,OAAOvP,IAAdA;AACfA,iBAASoR,IAAIpR,GAAGoR,IAAIvN,EAAM6uB,UAAU5hB,QAAQM,KAAKpR;AAC/CA,gBAAM2yB,IAAQ9uB,EAAM6uB,UAAUthB,CAAhBpR;AACdA,mBAAS0lB,IAAI1lB,GAAG0lB,IAAIiN,EAAMC,SAAS9hB,QAAQ4U,KAAK1lB;AAC9CA,kBAAMysB,IAAQkG,EAAMC,SAASlN,CAAf1lB;AACVysB,cAAM9sB,eAANK,MACFyyB,EAAOhG,EAAM/d,IAAb1O,IAAsBysB,EAAM+E,UAAUI,CAAhB5xB;UAHsBA;QAFDA;AAS7CsP,eAAOU,KAAKyiB,CAAZzyB,EAAoB8Q,WACtB2D,EAAAzU,SAAkByyB;MAZsDzyB;oEAwB5EC,SACE4D,GACA4Q,GACAmd,GACA1C,GAAgBjvB;AAEhBA,cAAM4yB,IAASvjB,uBAAOC,OAAOtP,IAAdA;AACfA,iBAASmR,IAAInR,GAAGmR,IAAIvN,EAAM6uB,UAAU5hB,QAAQM,KAAKnR;AAC/CA,gBAAM0yB,IAAQ9uB,EAAM6uB,UAAUthB,CAAhBnR;AACdA,cAAIA,CAAC0yB,EAAMG;AAAY7yB;AACvBA,gBAAM8yB,IAAkB5yB,2DACtBwyB,EAAMG,YACNlB,GACA1C,CAHsBjvB;AAKpB8yB,gBACFF,EAAOF,EAAMjkB,IAAbzO,IAAqB8yB;QATwB9yB;AAa7CqP,eAAOU,KAAK6iB,CAAZ5yB,EAAoB6Q,WACtB2D,EAAAxU,SAAkB4yB;MAjBJ5yB;mEA6BlBC,SACE2D,GACA4Q,GACAmd,GACA1C,GAAgBhvB;AAEX2D,UAAMmvB,mBAGLD,IAAkB5yB,2DACtB0D,EAAMmvB,gBACNpB,GACA1C,CAHsBhvB,OAMtBuU,EAAAvU,OAAgB6yB;MAXF7yB;AAwBlBC,mEAAAA,SACE2yB,GACAlB,GACA1C,GAAgB/uB;AAEhBA,cAAM8yB,IAASH,EAAWI,eAAe/yB,IAA1BA;AACTyV,YAAQkd,EAAWK,YAAXhzB;AACdA,YAAIA,CAAC8yB,KAAU9yB,CAACyV;AACdzV,iBAAOA;AAETA,cAAMsU,IAAQnF,uBAAOC,OAAOpP,IAAdA;AACV8yB,cACFxe,EAAAtU,SAAkB8yB;AAEhBrd,aAASzV,CAACyV,EAAMwd,SAANjzB,MACZsU,EAAAtU,QAAiBd,iDAAKuW,GAAOzV,EAACyxB,qBAAAA,GAAqB1C,SAAAA,EAAtB/uB,CAAZA;AAEnBA,eAAOsU;MAdStU;2DA0BZb,SACJmV,GACAO,GACA1V,EAACA,YAAAoR,IAAapR,MAAdA,IAA+CA,CAAAA,GAAEA;AAE3CuE,YAAQzD,2DAAeqU,GAAOO,GAAW1V,EAACoR,YAAAA,EAADpR,CAAjCA;AACV0V,UAAUqe,YAA2Bv0B,8DAAjBQ;AACxBA,eAAOuE;MAJ0CvE;mEAwB7Cc,SACJqU,GACAO,GACA5U,EACEA,kBAAAkzB,GACAlzB,UAAAgzB,IAAWhzB,OACXA,YAAAsQ,IAAatQ,MAHfA,IAQIA,CAAAA,GAAEA;AAENA,cAAM0vB,IAA4Bj4B,kDAAXuI;AACZoQ,UAAAA,kDAAcE,CAAzBtQ;AAEAA,SADMmzB,IAA2Bhf,EAAAA,6CAAXnU,MAEToU,EAAAA,6CAASpU,IAApBA;AAESgU,UAAAA,4CAAXhU;AAEAA,cAAMozB,IAA0Bxe,EAAU0W,gBAAVtrB;AAChCA,YAAIyD;AACJzD,YAAIA;AACFyD,cAAQxD,0DAAcoU,GAAOO,GAAW5U;YAACkzB,kBAAAA;YAAkBF,UAAAA;UAAnBhzB,CAAhCA;QADNA,UAAJA;AAGakU,YAAAA,2CAAXlU;QADQA;AAKVE,sEAAkB0U,GAAWwe,CAA7BpzB;AAEejI,sDAAXiI,KAGStI,yCAAKsI,KAAgB7H,wCAAek7B,EAAAA,0CAA1BrzB,GAAyCyD,CAA9CzD,CAAhBA;AAESoU,UAAAA,6CAAS+e,CAApBnzB;AACWoQ,UAAAA,kDAAcsf,CAAzB1vB;AAIAA,YAAI4U,EAAUqe,UAAUjzB;AACtBA,gBAAMszB,IAAW7vB;AACjBmN;YAAW5Q,MAAKA;AACTszB,gBAASC,YACZD,EAASE,sBAAsBxzB,IAA/BA;YAFYA;YAIbA;UAJHA;QAFsBA;AASxBA,eAAOyD;MAxCDzD;kEAyDRC,SACEoU,GACAO,GACA3U,EACEA,kBAAAizB,GACAjzB,UAAA+yB,IAAW/yB,MAFbA,IAGyDA,CAAAA,GAAEA;AAE3DA,YAAIA,CAACoU,EAAApU;AACHA,gBAAMA,IAAIwzB,iEAAiBpf,CAArBpU;AAGRA,cAAMwD,IAAQmR,EAAU8e,SAASrf,EAAApU,MAAeoU,EAAApU,EAAlCA;AACdwD,UAAMkwB,UAAUX,CAAhB/yB;AACAE,+DAAWsD,GAAO4Q,CAAlBpU;AACAG,mEAAeqD,GAAO4Q,CAAtBpU;AACAI,mEAAeoD,GAAO4Q,CAAtBpU;AACAK;UAAmB4yB;UAAkBzvB;UAAO4Q;QAA5CpU;AACAM,8DAAUkD,GAAO4Q,CAAjBpU;AACAO,+DAAWiD,GAAO4Q,CAAlBpU;AACAQ,oEAAgBgD,GAAO4Q,CAAvBpU;AACAS,mEAAe+C,GAAO4Q,CAAtBpU;AACAW,8DAAU6C,GAAOmR,EAAUqe,QAA3BhzB;AAEAA,eAAOwD;MAlBoDxD;sEA6B7DC,SACE0U,GACAkY,GAAkC5sB;AAElCA,YAAenI,8CAAXmI;AAMFA,eALM0zB,IAAyBr1B,mDAC7BqW,GACAkY,CAFmB5sB,GAKZ8Q,IAAI9Q,GAAG8Q,IAAI4iB,EAAaljB,QAAQM,KAAK9Q;AAC5CA,kBAAM2zB,IAAeD,EAAa5iB,CAAb9Q;AACVxI,qDACTwI,KAAgB/H,wCAAe27B,8CAA1B5zB,GAAuC2zB,CAA5C3zB,CADFA;UAF4CA;MARdA;+DAwBpCC,SAAoBsD,GAAc4Q,GAAYlU;AAC5CA,YAAIoa,IAAmB7I,WAAf2C,EAAAlU,IAA2BA,IAAIkU,EAAAlU;AACjCsa,YAAmB/I,WAAf2C,EAAAlU,IAA2BA,IAAIkU,EAAAlU;AAEzCA,cAAMyU,IAAYnR,EAAMmR;AACxB2F,YAAI3F,EAAU0R,MAAM1R,EAAUoa,SAAV7uB,IAAuBoa,IAAIA;AAE/C9W,UAAMyF,OAAOqR,GAAGE,CAAhBta;MAP4CA;mEAgB9CC,SAAwBqD,GAAc4Q,GAAYjU;AAC5CiU,UAAAjU,aACFqD,EAAMusB,aAAa5vB,IAAnBA;AAEyBA,kBAAvBiU,EAAAjU,aACFqD,EAAM0sB,aAAa/vB,KAAnBA;AAEuBA,kBAArBiU,EAAAjU,WACFqD,EAAMysB,WAAW9vB,KAAjBA;AAEwBA,kBAAtBiU,EAAAjU,YACFqD,EAAMwsB,YAAY7vB,KAAlBA;AAEuBA,kBAArBiU,EAAAjU,WAGFqD,EAAMgS,kBAAkBrV,MAAM2zB,kDAA9B3zB;AAEFA,YAAI+S,MAAMyR,QAAQvQ,EAAAjU,eAAdA;AACFA,qBAAW4S,KAAUqB,EAAAjU;AACnBqD,cAAMgS,kBAAkBrV,MAAM4S,CAA9B5S;AAGoBsR,mBAApB2C,EAAAjU,UACFqD,EAAMuwB,gBAAgB3f,EAAAjU,MAAtBA;AAEoBsR,mBAAlB2C,EAAAjU,SACFqD,EAAMouB,OAAOxd,EAAAjU;MA3BiCA;mEAsClDC,SAAwBoD,GAAc4Q,GAAYhU;AAC3CgU,UAAAhU,eAGDoD,EAAMpD,iBACRoD,EAAMpD,eAAegU,EAAAhU,UAArBA,IACSoD,EAAMwwB,iBACfxwB,EAAMwwB,cAAuBtQ,EAAAA,2CAAUtP,EAAAhU,UAAnBA,CAApBA;MAP8CA;uEAkBlDC,SACE4yB,GACA1d,GACAnB,GAAY/T;AAEZA,YAAK4yB,GAAL5yB;AAIAA,cAAI4yB,EAAiBgB,eAAjB5zB,EAAkC0yB,SAAlC1yB,KAAgDA,CAACkV,EAAMwd,SAAN1yB;AACnDA,kBAAMA,IAAI6zB,kEAAkB9f,CAAtB/T;AAKRA,cAAI4yB,EAAiB7kB,SAAS+lB,EAAAA,qDAAWC,OAAO/zB;AAC9CA,gBAAAg0B,IAAkB9e,EAAME;AACxBpV,gBAAIA,CAACg0B;AACHh0B,oBAAMA,IAAIi0B,kEAAkBj0B,UAAUkV,GAAOnB,CAAvC/T;UAHsCA,WAQ9Cg0B,IAAkB9e,EAAMG,oBACpBrV,CAACg0B;AACHh0B,kBAAMA,IAAIi0B;cAAkBj0B;cAAYkV;cAAOnB;YAAzC/T;AAKVA,cAAIA,CAVU4yB,EAAiBsB,QAAQF,CAAzBG,GAUEn0B;AACdA,kBAAMo0B,IAAUlf,EAAMZ,UAAU+f;AAChCr0B,kBAAMA,IAAIs0B,mEACRF,EAAQG,gBACNH,EAAQI,qBAAqBR,GAAiBpB,GAAkB5yB,KAAhEA,GACAg0B,GACApB,CAHF5yB,GAKA4yB,EAAiB7kB,SAAS+lB,EAAAA,qDAAWC,QACjC/zB,sBACAA,uBACJkV,GACAnB,CAVI/T;UAFQA;QAzBhBA;MAFYA;8DAmDdC,SAAmBkD,GAAc4Q,GAAY9T;AAC3CA,YAAK8T,EAAA9T,OAALA;AAEAA,cAAMw0B,IAAY7lB,OAAOU,KAAKyE,EAAA9T,KAAZA;AAClBA,qBAAWy0B,KAAYD,GAAWx0B;AAC1B00B,gBAAY5gB,EAAA9T,MAAey0B,CAAfz0B;AAClBA,gBAAI2xB,IAAOzuB,EAAMyxB,QAAQF,CAAdz0B;AACXA,gBAAIA,CAAC2xB,GAAM3xB;AACH40B,kBAAuBh+B,yCAClBsX,qCAAK2mB,MACdJ,GACAz0B,KAHkBA;AAKpBA,kBAAIA,CAAC40B;AAAa50B,sBAAMA,IAAI80B,iEAAiBL,GAAUvxB,GAAO4Q,CAAtC9T;AACxB2xB,kBAAO3xB,IAAI40B,EAAY1xB,CAAhBlD;AACPkD,gBAAM6xB,QAAQpD,CAAd3xB;YARSA;AAUPhB,4EAAe2yB,CAAf3xB,KAAsB2xB,EAAKb,UAAU4D,CAAf10B;UAbMA;QAHlCA;MAD2CA;+DA2B7CC,SAAoBiD,GAAc4Q,GAAY7T;AAC5CA,YAAK6T,EAAA7T,QAALA;AAGAA,cAAMoP,IAAOV,OAAOU,KAAKyE,EAAA7T,MAAZA;AACbA,mBAASwQ,IAAIxQ,GAAGwQ,IAAIpB,EAAKc,QAAQM,KAAKxQ;AACpCA,kBAAM+0B,IAAY3lB,EAAKoB,CAALxQ,GACZg1B,IAAanhB,EAAA7T,OAAgB+0B,CAAhB/0B,GACb6rB,IAAQ5oB,EAAMgyB,SAASF,CAAf/0B;AACT6rB,gBAMLA,EAAMgF,UAAUmE,CAAhBh1B,IALE8O,QAAQxG,KACNtI,+BAA+B+0B,CAA/B/0B,aAAqDiD,EAAM4K,IAA3D7N,EADFA;UALkCA;QAJtCA;MAD4CA;oEA0B9CC,SAAyBgD,GAAc4Q,GAAY5T;AACjDA,YAAK4T,EAAA5T,QAALA;AAGAA,cAAMmP,IAAOV,OAAOU,KAAKyE,EAAA5T,MAAZA;AACbA,mBAASuQ,IAAIvQ,GAAGuQ,IAAIpB,EAAKc,QAAQM,KAAKvQ;AACpCA,kBAAMi1B,IAAY9lB,EAAKoB,CAALvQ,GACZ8xB,IAAQ9uB,EAAMkyB,SAASD,CAAfj1B;AACdA,gBAAIA,CAAC8xB,KAAS9xB,CAAC8xB,EAAMG;AACnBjyB,oBAAMA,IAAI8zB,kEAAkBmB,GAAWjyB,GAAO4Q,CAAxC5T;AAERE,uEAAe4xB,EAAMG,YAAYre,EAAA5T,OAAgBi1B,CAAhBj1B,CAAjCA;UANoCA;QAJtCA;MADiDA;mEAsBnDC,SAAwB+C,GAAc4Q,GAAY3T;AAChDA,YAAK2T,EAAA3T,MAALA;AAGAA,cAAIA,CAAC+C,EAAMmvB;AACTlyB,kBAAMA,IAAI6zB,kEAAkB7zB,QAAQ+C,GAAO4Q,CAArC3T;AAERC,qEAAe8C,EAAMmvB,gBAAgBve,EAAA3T,IAArCA;QANAA;MADgDA;AAiBlDC,mEAAAA,SACE+xB,GACAC,GAAgChyB;AAE5BgyB,UAAAhyB,UACF+xB,EAAWkD,eAAejD,EAAAhyB,MAA1BA;AAEEgyB,UAAAhyB,SACFV,0DACE0yB,EAAAhyB,OACA+xB,EAAWwB,eAAXvzB,EAA4BiU,WAC5BjU,EAACuyB,kBAAkBR,EAAnB/xB,CAHFA;MAN8BA;8DAqBlCC,SAAmB6C,GAAcwvB,GAAiBryB;AAChDA,YAAIqyB,GAAUryB;AACK6C,YAGR+vB,sBAAsB5yB,KAA/BA;AAHiB6C,YAKRoyB,QAATj1B;AALiB6C,YAMRjF,YAAToC;AAIAA,qBAAWsxB,KAVMzuB,EAUW0uB,SAATvxB;AACjBsxB,cAAK4D,iBAXUryB,EAWgBuqB,uBAATptB,CAAtBA;QAZUA;AAeZ6C,YAAMsyB,UAANn1B;MAhB8CA;ACnvB5CC,iEAAAA,SAAoBwkB,GAAQxkB;AAChCA,eAC0B6Q,WAAxB2T,EAAI2Q,mBAA0DtkB,WAAzB2T,EAAI4Q;MAFXp1B;ACA5BC,oDAAAA,SAAoBo1B,GAAoBp1B;AAC5CA,eAAQo1B,IAAe3U,KAAK4U,KAAMr1B;MADUA;oDAWxCC,SAAoBq1B,GAAoBr1B;AAC5CA,eAAuBA,MAAfq1B,IAAsB7U,KAAK4U;MADSp1B;AAYxCC,gDAAAA,SACJq1B,GACAC,GACAC,GAAkBv1B;AAElBA,YAAIu1B,IAAaF,GAAYr1B;AAC3BA,gBAAMw1B,IAAOD;AACbA,cAAaF;AACbA,cAAaG;QAHcx1B;AAK7BA,eAAOugB,KAAKE,IAAI4U,GAAY9U,KAAKC,IAAI8U,GAAQC,CAAjBv1B,CAArBA;MAPWA;qDCwEjBC,WAAAA;AACG4a,iBAAU4a,cAASx1B,qBAAnBA,MAGJ6V,yCAAC+E,SAAAC,cAAA7a,KAAAA,GACD6V,uCAAG2F,YAAYxb,uBACCrI,iDAAAqI,KAAqB4a,SAAAwC,MAC/BpC,YAAYnF,sCAAlB7V,GACAsa,6CAAUM,SAAAC,cAAiB7a,KAAjBA,GAEVsa,2CAAOkB,YAAYxb,0BACnB6V,uCAAAmF,YAAQV,0CAARta,GACAy1B,2CAAI7a,SAAYC,cAAS7a,KAArBA,GAEJy1B,yCAAKja,YAAYxb,wBACjB6V,uCAAAmF,YAAeya,wCAAfz1B,GACA6V,uCAAI0G,MAAAmZ,UAAY11B,KAGhB6V,uCAAA0G,MAAAoZ,aACI31B,eAAM41B,oDAAU51B,gBAAA41B,oDAAA51B,KAIpB6V,uCAAA0C,iBAAAvY,WAAAA,WAAiCA;AAC7B9G,oDAAA2c,wCAAiB7V,gBAAjBA;QAD6BA,CAAjCA,GAGA6V,uCAAG0C,iBAAAvY,YAAAA,WAAAA;AACC5G,uDAAgByc,wCAAC7V,gBAAjBA;QADDA,CAAHA;MA3BCA;4DAsCAC,SAAA41B,GAAA51B;AACH61B,2DAAgBD;MADb51B;AAOAC,oDAAAA,WAAAA;AACHA,eAAM61B;MADH71B;AASAC,yDAAAA,WAAAA;AACHA,eAAMma;MADHna;wDAKHC,WAAAA;AACAka,mDAAMqC,cAAUvc;AACdka,mDAAQiC,MAAAvG,QAAc5V;MAFxBA;AAWGC,qDAAAA,SAAA21B,GAAAC,GAAA51B;AACHwV,+CAAM0G,MAAA2Z,kBAAoBF;AACxBngB,+CAAI0G,MAAM4Z,cAAAF;MAFT51B;iEAiBAC,SAAA8qB,GAAA5oB,GAAA4zB,GAAAC,GAAA/1B;AACHA,eAAMI,wDAAUF,wDAGdgC,CAHclC,GAGd8qB,GACAgL,GAAAC,CAJI/1B;MADHA;AAyBAC,iEAAAA,SAAA6qB,GAAAgL,GAAAC,GAAA91B;AACH+1B,6DAAgB/1B;AAKdA,eAAAG,wDAAuBD,wDAAA2qB,CAAA7qB,GAAA6qB,GAAAgL,GAAAC,CAAvB91B;MANCA;gEAcHC,SAKGgC,GAAAhC;AACHA,YAAS6xB,IAAA7vB,EAAA+zB,WAAA/1B;AACPA,cAAMkS,IAAQlQ,EAAGmR,UAAMjB,OACjB8jB,IAAch0B,EAAA0T,SAAgBxD;AAC9B+jB,YAAYj0B,EAAQwT,QAAOtD;AAC3B+N,YAAWtmB,iDAAck4B,CAAzB7xB;AACNA,eAAMA,IAAKgf,uCAAKiB,EAACjH,GAAAiH,EAAAjH,IAAAgd,GAAwB/V,EAAAnH,GAAAmH,EAAAnH,IAAAmd,CAAnCj2B;MANLA;AAUHC,gEAAAA,SAKG2qB,GAAA3qB;AACMi2B,YAAAtL,EAAAuL,cAAAl2B;AACPA,eAAMA,IAAI+e,uCAAGkX,EAAM/Y,KAAA+Y,EAAAnX,QAAgBmX,EAAA9Y,MAAA8Y,EAAApX,KAA7B7e;MAFLA;gEAMHC,SAWGg2B,GAAAtL,GAAAgL,GAAAC,GAAA31B;AAODA,cAAAk2B,IAAAF,EAAA9Y,QAAA8Y,EAAApX,QAAAoX,EAA4C9Y,QAAAld,GACtCm2B,IAAWH,EAAKnX;AAGtBuX,YAAgBJ,EAAG/Y;AACf0Y,cACAS,KAAAT;AAEHU,YAAA3L,EAAA6H,eAAAvyB;AAEDA,YAAAiT,IAAAojB,EAAApjB;AACAjT,eAAIiT,EAAY/E,QAAA4G;AAChB7B,cAAgBA,EAAS/E,QAAA4G;AAEzBvV,4DAAC0T,EAAA+B,aAAAhV,EAAAsb,UAADtb;AACAA,eAAAC,wCAAAyqB,GAAiB2L,EAAU1R,KAAAuR,GAAeC,GAZ1CD,GAYwEE,GAAAV,CAAxE11B;MAtBCA;gDAoDAC,SAAAq2B,GAAAC,GAAAL,GAAAC,GAAAK,GAAAJ,GAAAV,GAAAz1B;AACHo1B,mDAAMiB;AASJG,oDAAQf,KAAkBz1B;AAE1BkV,+CAAA0G,MAAA6a,YAAiBH,IAAAt2B,QAAAA;AACboU,YAAwBvd,+CAANmJ;AAEtB02B,+DAAmBtiB,EAAUuiB,YAAV32B,EAA6C42B,aAA7C52B;AACnB62B,4DAAiBziB,EAAG0iB,SAAH92B,EAAiB42B,aAAjB52B;AACjB02B,gEACIn+B;UAAA2c;UAAiBwhB;QAAjB12B;AAEH62B,6DACGt+B,0CAAA2c,wCAAiB2hB,iDAAjB72B;AAWJA,eAAAS,oDAAAw1B,GAAAC,GAAAK,GAAAJ,CAAAn2B;MAhCCA;mEA+GHC,SAWGg2B,GAAAC,GAAAa,GAAAC,GAAA/2B;AACMg3B,YAAA72B,gDACP61B,GACAc,EACA9Z,MAAA8Z,EACApY,OAAaqY,EAAA3hB,KAJNpV;AAcPA,eAAMA,EAENi3B,UAAOD,EAAAE,MACLC,UAAUlB,GACVmB,QAAQJ,EAAEE,MACVG,QANapB,IAAEqB,8CAOfC,QAAMP,EAAAO,QACNC,QAfWA,EAAGC,gDACdz3B,IAAA03B,iDAeAC,YAAM33B,MACN43B,cAAY53B,KATRA;MAfLA;mEA6BHC,SAWGq2B,GAAAJ,GAAAY,GAAAC,GAAA92B;AACM+2B,YAAA72B,gDACPm2B,GACAQ,EAAkB9Z,MAClB8Z,EACApY,OAAaqY,EAAA3hB,KAJNnV;AAePA,eAAMA,EAENg3B,UAAOD,EAAAE,MACLC,UAJajB,IAAaa,EAAQzhB,QAKlC8hB,QAAQJ,EAAAE,MACRG,QAPanB,IAAQa,EAASzhB,SAAWgiB,8CAQzCC,QAAMP,EAAAO,QACNC,QAhBWT,EAAGzhB,SAEdrV,IADAy3B,iDACAD,gDACAx3B,GAcA03B,YAAM13B,OACN23B,cAAY33B,KATRA;MAhBLA;uEA8BHC,SAUG23B,GAAAf,GAAAC,GAAA72B;AACM82B,YAAA72B,gDAAA03B,GACPf,EACA9Z,MACA8Z,EAAapY,OAAAqY,EAAA3hB,KAHNlV;AAYPA,eAAAA,EACA+2B,UAAOD,EAAAE,MACLC,UAAUj3B,GACVk3B,QAAQJ,EAAGE,MACXG,QAAQn3B,GACRy3B,YAAWz3B,MACXq3B,QAAAr3B,MACAs3B,QAAQt3B,MACR03B,cAAY13B,MARdA;MAbCA;wDAqCAC,SAAA03B,GAAAC,GAAAC,GAAAC,GAAA73B;AAUD+2B,YAAA/3B,wCAAA24B,GATID,IAOJG,IAAA73B,GAEA43B,IAAAC,CAAA73B;AAMA83B,YALYJ,IAGZJ,gDAAAt3B,IAEA+2B;AACIgB,YAAiBC;AAErBF,YAAA94B,wCAAA+4B,GAAAD,GAAAD,IAAAE,IAAyET,6CAAzEt3B;AACAA,eAAAA,EAAAo3B,QAAiBU,GACff,MAAAA,EADF/2B;MApBCA;AAiCAC,qDAAAA,WAAAA;AACHA,eAAMA,CAAAA,CAAA+0B;MADH/0B;uDAYAC,SAAA+3B,GAAAC,GAAAh4B;AACHA,eAAM80B,6CAAUiD,KAIVC,IACE93B,wDAAAF,IAEHC,wCAAAD,GAEAA,QAEFA;MAZAA;gDAgBHC,WAAAA;AAGE2U,+CAAA0G,MAAAD,YAAApb;AACA2U,+CAAI0G,MAAMmZ,UAASx0B;AAEnBg4B,6DAAAvpB,WAAAzO,WAAAA;AACAC,kEAAAD;QADAA,GAEEA,MAD2B00B,iDAD7B10B;AAGGi2B,sDACCA,0CAAAj2B,GACFi2B,4CAASj2B;MAXbA;gEAgBAC,WAAAA;AACMH,qDAAAG,MAGH+3B,sDACGzhB,aAAAyhB,kDAAA/3B,GAKJ0U,uCAAA0G,MAAAD,YAAAnb,IACA0U,uCAAI0G,MAAMqB,OAAAzc,IACV0U,uCAAI0G,MAAMoB,MAAIxc,IACd0U,uCAAI0G,MAAMmZ,UAASv0B,KACnB0U,uCAAI0G,MAAMkB,UAAUtc,QACpB0U,uCAAI0G,MAAM2Z,kBAAiB/0B,IAC3B0U,uCAAI0G,MAAM4Z,cAAAh1B,IACNg2B,8CAEAA,0CAAAh2B,GACFg2B,4CAASh2B,OAEXf,gDAAAe,GACA40B,2CAAA50B,MACAk2B,yDAEIj+B;UAAAyc;UAAoBwhB;QAApBl2B,GACFk2B,uDAAmBl2B,KAEpBq2B,sDACGp+B,6CAAgByc,wCAAC2hB,iDAAjBr2B,GACFq2B,oDAAgBr2B,KAEjB3J,+CAAD2J,EAACg4B,YAADh4B;MAjCFA;4DAqCAC,SAQGw1B,GAAAC,GAAAK,GAAAJ,GAAA11B;AACMyjB,YAAA3V,4CACPkqB,mBAEAxC,GACAC,GAAkBK,GAAAJ,CAJX11B;AAaPyjB,UAAA2T,gBACI/C,yCAAAlZ,MAAQkB,UAAcrc,IACxBq0B,yCAAMlZ,MAAMD,YACZlb,eACEyjB,EAAYsT,SACZ/2B,QACAyjB,EAAKuT,SACLh3B,qBAAcq0B,yCAAArf,aACdhV,SAAoByjB,EAAA0T,aAChBn3B,yCAGAA,yCALUA,KAQjBq0B,yCAAOlZ,MAAAkB,UAAArc;AAEPy2B,YAAAvX,KAAA+Y,MAAAxU,EAAAgT,QAAAz2B;AAEK22B,YAAWzX,KAAK+Y,MAAMxU,EAAQkT,QAAnB32B;AACX42B,YAAQ1X,KAAG+Y,MAAKxU,EAAMmT,MAAd52B;AACdA,cAAM62B,IAAS3X,KAAK+Y,MAAMxU,EAAQoT,MAAnB72B;AAGfyU,+CAAA0G,MAAAqB,OAAAia,IAAAz2B;AACAyU,+CAAI0G,MAAMoB,MAAIoa,IAAW32B;AAGzByU,+CAAA0G,MAAAkB,UAAgBrc;AAChByU,+CAAI0G,MAAMmZ,UAAUt0B;AAMpByU,+CAAA0G,MAAQD,YAAYlb,gBAFpB42B,IAAAH,KAE6Bz2B,SADlB62B,IAASF,KACS32B;AAC7BA,eAAIA,CAAAA,CAAKyjB,EAAC0T;MAlDTn3B;qEA4DAC,WAAAA;AAMDA,YAAA00B,0CAAM10B;AACFA,cAAKmB,IAAGuzB,yCAAA9C,eAAA5xB;AACJq1B,cAAKJ,qDACL71B,wDAAOs1B,wCAAP10B,IACFb,wDAAqBgC,CAArBnB;AAEJA,gBAAAu1B,IAAAF,EAAA9Y,QAAA8Y,EAAApX,QAAAoX,EAA4C9Y,QAAAvc;AAK5CD,8DAAgBw1B,GAJCF,EAAKnX,QAEtBqX,GACmBF,EAAA/Y,GACnBtc;QAXIA;AAaLH,kDAAAG;MAnBAA;iEC/tBGC,SAA+Bg4B,GAAeh4B;AAClDA,eAAKg4B,EAAM7pB,SAGJ6pB,EAAMC,OAAOj4B,SAAUk4B,GAAG7M,GAACrrB;AAChCA,iBAAOk4B,EAAE/pB,SAASkd,EAAEld,SAAS+pB,IAAI7M;QADDrrB,CAA3BA,EAEJmO,SAJMnO;MAFyCA;6DAiB9CC,SACJ+3B,GACAG,GAAqBl4B;AAErBA,YAAIA,CAAC+3B,EAAM7pB;AACTlO,iBAAOA;AACFA,YAAqBA,MAAjB+3B,EAAM7pB;AACflO,iBAAO+3B,EAAM/3B,CAANA,EAASkO;AAElBlO,YAAIm4B,IAAan4B;AACXif,YAAMiZ,KAAgBn4B,yDAAqBg4B,CAArB/3B;AAC5BA,YAAIo4B;AACJp4B,aAAKo4B,IAAMp4B,GAAGo4B,IAAMnZ,GAAKmZ,KAAOp4B;AAC9BA,cAAMq4B,IAASN,EAAM/3B,CAANA,EAASo4B,CAATp4B;AACfA,mBAASwO,IAAIxO,GAAGwO,IAAIupB,EAAM7pB,QAAQM;AAChCxO,gBAAIq4B,MAAWN,EAAMvpB,CAANxO,EAASo4B,CAATp4B;AACbA,qBAAOm4B;AAGIn4B,kBAAXq4B,MACFF,IAAaC,IAAMp4B;QARSA;AAWhCA,aAASwO,IAAIxO,GAAGwO,IAAIupB,EAAM7pB,QAAQM;AAEhCxO,eADMq4B,IAASN,EAAMvpB,CAANxO,EAASo4B,CAATp4B,MACUA,QAAXq4B;AACZr4B,mBAAOm4B;AAGXn4B,eAAOif;MA3Bcjf;6DAsCjBC,SACJ83B,GACAG,GAAqBj4B;AAErBA,YAAIA,CAAC83B,EAAM7pB;AACTjO,iBAAOA;AACFA,YAAqBA,MAAjB83B,EAAM7pB;AACfjO,iBAAO83B,EAAM93B,CAANA,EAASiO;AAElBjO,YAAIk4B,IAAal4B;AACXgf,YAAMiZ,KAAgBn4B,yDAAqBg4B,CAArB93B;AAC5BA,YAAIm4B;AACJn4B,aAAKm4B,IAAMn4B,GAAGm4B,IAAMnZ,GAAKmZ,KAAOn4B;AAC9BA,cAAMo4B,IAASN,EAAM93B,CAANA,EAASq4B,OAAOr4B,CAACm4B,IAAMn4B,GAAGA,CAA1BA;AACfA,mBAASuO,IAAIvO,GAAGuO,IAAIupB,EAAM7pB,QAAQM;AAChCvO,gBAAIo4B,MAAWN,EAAMvpB,CAANvO,EAASq4B,OAAOr4B,CAACm4B,IAAMn4B,GAAGA,CAA1BA;AACbA,qBAAOk4B;AAGIl4B,kBAAXo4B,MACFF,IAAaC,IAAMn4B;QARSA;AAWhCA,aAASuO,IAAIvO,GAAGuO,IAAIupB,EAAM7pB,QAAQM;AAEhCvO,eADMo4B,IAASN,EAAMvpB,CAANvO,EAASsnB,OAAOwQ,EAAMvpB,CAANvO,EAASiO,SAASkqB,IAAMn4B,CAAxCA,MACUA,QAAXo4B;AACZp4B,mBAAOk4B;AAGXl4B,eAAOgf;MA3Bchf;QAqCjBs4B,2CAAAA,SAAe7c,GAAc8c,GAAaD;AACxCE,YAAQ/c,EAAKvB,MAAMoe,IAAXA;AACdA,iBAAS/pB,IAAI+pB,GAAG/pB,IAAIiqB,EAAMvqB,QAAQM;AAChCiqB,YAAMjqB,CAAN+pB,IAAWr4B,6CAASu4B,EAAMjqB,CAAN+pB,GAAUC,CAAnBD;AAEbA,eAAOE,EAAM1oB,KAAKwoB,IAAXA;MALuCA;qDAehDr4B,SAAkBwb,GAAc8c,GAAat4B;AAC3CA,YAAIwb,EAAKxN,UAAUsqB;AAEjBt4B,iBAAOwb;AAGTxb,cAAMw4B,IAAQhd,EAAKxP,KAALhM,EAAYia,MAAMja,KAAlBA;AAEdA,iBAASsO,IAAItO,GAAGsO,IAAIkqB,EAAMxqB,QAAQM;AAC5BkqB,YAAMlqB,CAANtO,EAASgO,SAASsqB,MACpBA,IAAQE,EAAMlqB,CAANtO,EAASgO;AAKrBhO,YAAIy4B,IAAQz4B;AACZA,YAAI04B,GACAC,IAAY34B;AAChBA,WAAGA;AACD44B,cAAYH;AACZC,cAAWld;AAGPqd,cAAa74B,CAAAA;AAEX84B,cAAQN,EAAMxqB,SAAS2qB;AAC7B34B,cAAI+4B,IAAiB/4B;AACrBA,mBAASsO,IAAItO,GAAGsO,IAAIkqB,EAAMxqB,SAAShO,GAAGsO;AAChCyqB,iBAAkBzqB,IAAItO,OAAO84B,KAC/BC,KACAF,EAAWvqB,CAAXtO,IAAgBA,QAEhB64B,EAAWvqB,CAAXtO,IAAgBA;AAGpB64B,cAAa34B,+CAAWs4B,GAAOK,GAAYP,CAA9Bt4B;AACby4B,cAAQx4B,8CAAUu4B,GAAOK,GAAYP,CAA7Bt4B;AACRwb,cAAOrb,+CAAWq4B,GAAOK,CAAlB74B;AACP24B;QApBC34B,SAqBMy4B,IAAQG;AACjB54B,eAAO04B;MAxCoC14B;sDAmD7CC,SACEu4B,GACAK,GACAP,GAAar4B;AAIbA,cAAM+4B,IAAc/4B,CAACA,CAADA,GACdg5B,IAAkBh5B,CAAAA;AACxBA,iBAASqO,IAAIrO,GAAGqO,IAAIkqB,EAAMxqB,QAAQM;AAChC0qB,YAAYA,EAAYhrB,SAAS/N,CAAjCA,KAAuCu4B,EAAMlqB,CAANrO,EAAS+N,QAC1B/N,SAAlB44B,EAAWvqB,CAAXrO,KACF+4B,EAAY5qB,KAAKnO,CAAjBA,GACAg5B,EAAgB7qB,KAAKoqB,EAAMlqB,CAANrO,EAASonB,OAAOmR,EAAMlqB,CAANrO,EAAS+N,SAAS/N,CAAlCA,CAArBA,KAC2BA,UAAlB44B,EAAWvqB,CAAXrO,KACT+4B,EAAYA,EAAYhrB,SAAS/N,CAAjCA;AAGEi5B,YAAYra,KAAKE,IAAI9e,GAAG+4B,CAAZ/4B;AAEdw4B,YAAQx4B;AACZA,aAASqO,IAAIrO,GAAGqO,IAAI0qB,EAAYhrB,QAAQM;AAGtCmqB,eAA2Dx4B,IAAlD4e,KAAKsa,IAAIta,KAAKwP,IAAIiK,IAAQU,EAAY1qB,CAAZrO,CAAjBA,GAAkCA,GAA3CA,GAGTw4B,KAAS5Z,KAAKsa,IAAID,IAAYF,EAAY1qB,CAAZrO,GAAgBA,GAArCA,GAGLA,MAAMqf,SAAS2Z,EAAgB3qB,CAAhBrO,CAAfA,IACFw4B,KAASH,IAAQr4B,IACRA,QAAQqf,SAAS2Z,EAAgB3qB,CAAhBrO,CAAjBA,MACTw4B,KAASH,IAAQr4B;AAQEA,YAArB+4B,EAAYhrB,UACZgrB,EAAYA,EAAYhrB,SAAS/N,CAAjCA,KAAuC+4B,EAAYA,EAAYhrB,SAAS/N,CAAjCA,MAEvCw4B,KAASx4B;AAEXA,eAAOw4B;MA3CMx4B;uDAsDfC,SACEs4B,GACAK,GACAP,GAAap4B;AAEbA,YAAIk5B,IAAYn5B,8CAAUu4B,GAAOK,GAAYP,CAA7Bp4B,GACZm5B;AAEJn5B,iBAASoO,IAAIpO,GAAGoO,IAAIuqB,EAAW7qB,SAAS9N,GAAGoO,KAAKpO;AAC9CA,cAAI24B,EAAWvqB,CAAXpO,MAAkB24B,EAAWvqB,IAAIpO,CAAfA;AACpBA;AAEFA,gBAAMo5B,IAAoBp5B,CAAAA,EAAqBsQ,OAAOqoB,CAA5B34B;AAC1Bo5B,YAAkBhrB,CAAlBpO,IAAuBA,CAACo5B,EAAkBhrB,CAAlBpO;AACxBo5B,YAAkBhrB,IAAIpO,CAAtBA,IAA2BA,CAACo5B,EAAkBhrB,IAAIpO,CAAtBA;AAC5BA,gBAAMq5B,IAAet5B,8CAAUu4B,GAAOc,GAAmBhB,CAApCp4B;AACjBq5B,cAAeH,MACjBA,IAAYG,GACZF,IAAaC;QAV+Bp5B;AAahDA,eAAIm5B,IAEKn5B,+CAAWs4B,GAAOa,GAAYf,CAA9Bp4B,IAGF24B;MAvBM34B;uDAiCfC,SAAoBq4B,GAAiBK,GAAqB14B;AACxDA,cAAMqb,IAAOrb,CAAAA;AACbA,iBAASmO,IAAInO,GAAGmO,IAAIkqB,EAAMxqB,QAAQM;AAChCkN,YAAKpN,KAAKoqB,EAAMlqB,CAANnO,CAAVA,GACsB6O,WAAlB6pB,EAAWvqB,CAAXnO,KACFqb,EAAKpN,KAAKyqB,EAAWvqB,CAAXnO,IAAgBA,OAAOA,GAAjCA;AAGJA,eAAOqb,EAAK3L,KAAK1P,EAAVA;MARiDA;AAiBpDq5B,QAAAA,+CAAAA,SAAmBC,GAAWD;AAClCA,eAAOA,wBAAwBE,KAAKD,CAA7BD;MAD2BA;AClP9Bp5B,wDAAAA,SAA2Bu5B,GAAuBv5B;AACtDw5B,uDAAgBD;MADsCv5B;AASlDC,wDAAAA,WAA0BA;AAC9BA,eAAOu5B;MADuBv5B;iDAY1Bd,WAAmBA;AACvBA,eAAOs6B;MADgBt6B;AAsEnBe,8CAAAA,WAAgBA;AACpBA,eAAOw5B;MADax5B;AAUhBC,0DAAAA,SAA6Bw5B,GAAiCx5B;AAElEA,YADMoiB,IAAMniB,+CAAgBu5B,CAAhBx5B,GACHA;AAEPA,eADIy5B,IAAUrX,EAAIqX,SACQz5B,eAAnBA,OAAOy5B;AACZA,gBAAUA,EAAAz5B;AAEZA,cAAuBA,aAAnBA,OAAOy5B;AACTz5B,kBAAM0L,MAAM1L,wCAANA;AAERA,iBAAOy5B;QARAz5B;AAUTA,eAAOA;MAZ2DA;uDAsBpEC,SACEmiB,GAAkBniB;AAElBA,eAAOmiB,KAAQA,EAAYqX,WAASx5B;AAClCA,cACkCA,aAAhCA,OAAQmiB,EAAYqX,WACYx5B,eAAhCA,OAAQmiB,EAAYqX;AAEpBx5B,mBAAOmiB;AAETA,cAAOA,EAAYqX;QAPex5B;AASpCA,eAAOA;MAXWA;AAiBdjC,iDAAAA,WAAmBA;AACnB4a,iBAAS4a,cAAcx1B,oBAAvBA,MAIJu7B,8CAAe3gB,SAASC,cAAc7a,KAAvBA,GACfu7B,4CAAa/f,YAAYxb,sBACArI,iDAAPqI,KAA+B4a,SAASwC,MAChDpC,YAAYugB,2CAAtBv7B;MARuBA;uDAgBnBkC,SAA0BmQ,GAAgBnQ;AAE7CmQ,UAA+BqpB,oBAAkCjjC,2CAChE4Z,GACAnQ,eACAA,MACAE,0CAJkDF;AAMnDmQ,UAA+BspB,mBAAiCljC,2CAC/D4Z,GACAnQ,cACAA,MACAG,yCAJiDH;AAUnDmQ,UAAQkG,iBAAiBrW,eAAeI,4CAAaJ,KAArDA;MAlB8CA;yDA0B1CC,SAA4BkQ,GAAuBlQ;AAClDkQ,cAIS3Z,6CAAQ2Z,EAA+BqpB,iBAArDv5B,GACczJ,6CAAQ2Z,EAA+BspB,gBAArDx5B,GACAkQ,EAAQqG,oBAAoBvW,eAAeG,0CAA3CH;MAPuDA;mDAgBzDC,SAAqBwN,GAAexN;AAC9Bw5B,mDAMEC,IAAa55B,+CAAgB2N,EAAEksB,aAAlB15B,GACfiQ,2CAAYwpB,MACd36B,oCAAAkB,GACA25B,iDAAkB35B,MAClBiQ,yCAAUwpB,IAGZpkB,aAAaukB,0CAAb55B;MAdkCA;kDAsBpCC,SAAoB45B,GAAgB55B;AAC9Bu5B,mDAQJI,6CAAcrsB,WAAWtN,WAAAA;AAEvB05B,2DADA1pB,yCAAUhQ;AAEVnB,8CAAAmB;QAHuBA,GAItBA,CAJWA,GAKdoV,aAAaykB,sCAAb75B,GACA65B,yCAAU75B;MAfwBA;mDAwBpCC,SAAqBsN,GAAQtN;AAC3BA,YAAK+P,0CAAaA,uCAA+BopB,WAGtCG,CAAAA;AAKXt5B,cAAIg5B,wCAASh5B;AAKXA,kBAAM65B,IAAKC,uCAASxsB,EAAyBysB;AAGvCC,gBAAKC,uCAAS3sB,EAAyB4sB;AACzClc,iBAAKmc,KAAKN,IAAKA,IAAKG,IAAKA,CAAzBh6B,IAA+Bo6B,4CACjCx7B,oCAAAoB;UAVSA;AAYFy5B,+DAAoB1pB,2CAE7BoF,aAAaykB,sCAAb55B,GAIA85B,uCAASxsB,EAAyBysB,OAGlCE,uCAAS3sB,EAAyB4sB,OAClCN,yCAAUvsB,WAAWhP,qCAAMg8B,uCAAjBr6B;MA/BeA;AAwCvBC,+CAAAA,WAAiBA;AAErBw5B,yDADA1pB,yCAAU9P;AAEVrB,4CAAAqB;MAHqBA;4CASjBrB,WAAcA;AACdo6B,mDACFA,yCAAUp6B,OACNq6B,gDACFA,4CAAahf,MAAMkB,UAAUvc;AAG7Bg7B,mDACFzkB,aAAaykB,sCAAbh7B,GACAg7B,yCAAUh7B;MATMA;6CAmBdsB,WAAeA;AACnBtB,4CAAAsB;AACAo5B,iDAAUp5B;MAFSA;AAWfC,+CAAAA,WAAiBA;AACrBm5B,iDAAUn5B;MADWA;qDAKvBC,WAAsBA;AACf64B,uDAAiBlpB,2CAIO3P,eAAzBA,OAAO24B,+CACTA,6CAAcE,6CAAclpB,sCAA5B3P,IAEAC,oDAAAD;MARkBA;4DAatBC,WAA6BA;AAC3BA,YAAIi6B,IAAM56B,kDAAmBqQ,sCAAnB1P;AACVi6B,YAAoB9C,EAAAA,yCAAK8C,GAAKC,oCAAxBl6B;AAEAq3B,YAAQ4C,EAAIlhB,MAAM/Y,IAAVA;AACdA,iBAASoN,IAAIpN,GAAGoN,IAAIiqB,EAAMvqB,QAAQM,KAAKpN;AACrCA,gBAAMkT,IAAM+E,SAASC,cAAclY,KAAvBA;AACZkT,YAAImF,YAAYJ,SAASG,eAAeif,EAAMjqB,CAANpN,CAAxBA,CAAhBA;AACA44B,sDAAcvgB,YAAYnF,CAA1BlT;QAHqCA;MALZA;mDAmB7BC,SAAqBq0B,GAAYr0B;AAE/BA,cAAMk6B,IAAcliB,SAASmE,gBAAgBoB,aACvC4c,IAAeniB,SAASmE,gBAAgBsB;AAE9Czd,YAAIo6B,IAAUZ;AAEZY,YADE/F,IACF+F,KAAWC,0CAAW1B,4CAActlB,eAEpC+mB,IAAWC;AAGbr6B,YAAIs6B,IAAUX,uCAAQY;AAClBD,YAAU3B,4CAAcplB,eAAe4mB,IAAeve,OAAO4e,YAE/DF,KAAW3B,4CAAcplB,eAAevT,IAAIu6B;AAG1ClG,YAEF+F,IAAU1c,KAAKE,IAAI6c,yCAAU7e,OAAO8e,SAASN,CAAnCp6B,IAGRo6B,IAAUzB,4CAActlB,cACxB6mB,IAActe,OAAO8e,UAAU16B,IAAIy6B,2CAInCL,IAAUF,IAAcvB,4CAActlB,cAAcrT,IAAIy6B;AAI5Dz6B,eAAOA,EAAC0W,GAAG0jB,GAASxjB,GAAG0jB,EAAhBt6B;MAhCwBA;4CAoCjCjC,WAAaA;AACXA,YAAIi7B,CAAAA,2CAIJG,iDAAkB1pB,wCACbkpB,8CAAL56B;AAIA46B,sDAAa5e,cAAchc;AAG3B+B,uDAAA/B;AAGAA,cAAMs2B,IAAO5kB,uCAAgBgT;AAC7BkW,sDAAahf,MAAM6a,YAAYH,IAAMt2B,QAAQA;AAC7C46B,sDAAahf,MAAMkB,UAAU9c;AAC7B26B,mDAAU36B;AAEVA,cAAMA,EAACA,GAAA2Y,GAAG3Y,GAAA6Y,EAAJ7Y,IAASiC,2CAAYq0B,CAAZt2B;AACf46B,sDAAahf,MAAMqB,OAAOtE,IAAI3Y;AAC9B46B,sDAAahf,MAAMoB,MAAMnE,IAAI7Y;QAjB7BA;MANWA;ACraPkC,6DAAAA,WAA0BA;AAC9BA,eAAO06B;MADuB16B;AAW1BC,6DAAAA,SAA2B06B,GAAqB16B;AACpDy6B,4DAAgBC;MADoC16B;wDAgBhDC,WAAqBA;AACzBA,eAAO06B;MADkB16B;AAWrBC,wDAAAA,SAAsBoM,GAAgBpM;AAC1Cy6B,uDAAWruB;MAD+BpM;kDAgBtCC,SAAgBi4B,GAAoBj4B;AACxCi4B,YAAMj4B,GAAGi4B,CAAHj4B,GAAS0K,YAAT1K,EAAuBwK,KAAvBxK;AACNA,YAAIy6B,IAAMC,0CAAMzC,CAANj4B;AACVA,YAAIy6B;AAEFz6B,iBAAOy6B;AAETA,YAA8Bz6B,SAAxBi4B,EAAI0C,UAAU36B,GAAGA,CAAjBA,IAA+BA,MAAMi4B,EAAI0C,UAAU36B,CAAdA,IAAmBi4B;AAC9DwC,YAAiBz6B,QAAXy6B,EAAIz6B,CAAJA,IAAiBy6B,IAAMz6B,MAAMy6B;AACnCz6B,YAAIA,iBAAiBk4B,KAAKuC,CAAtBz6B;AAEFA,iBAAOy6B;AAETz6B,YAAIA,iBAAiBk4B,KAAKuC,CAAtBz6B;AAEFA,iBAAOA,CAACA,KAAKy6B,EAAIz6B,CAAJA,GAAQy6B,EAAIz6B,CAAJA,GAAQy6B,EAAIz6B,CAAJA,GAAQy6B,EAAIz6B,CAAJA,GAAQy6B,EAAIz6B,CAAJA,GAAQy6B,EAAIz6B,CAAJA,CAA9CA,EAAsDqO,KAAKrO,EAA3DA;AAETA,YAAM46B,IAAM3C,EAAIta,MAAM3d,sDAAVA;AACZA,eAAI46B,MAEIld,IAAIG,OAAO+c,EAAI56B,CAAJA,CAAPA,GACJ66B,IAAIhd,OAAO+c,EAAI56B,CAAJA,CAAPA,GACJ0pB,IAAI7L,OAAO+c,EAAI56B,CAAJA,CAAPA,GACDA,KAAL0d,KAAc1d,MAAJ0d,KAAgB1d,KAAL66B,KAAc76B,MAAJ66B,KAAgB76B,KAAL0pB,KAAc1pB,MAAJ0pB,KAC/CzpB;UAASyd;UAAGmd;UAAGnR;QAAf1pB,IAGJA;MA3BiCA;AAsCpCC,qDAAAA,SAAmByd,GAAWmd,GAAWnR,GAASzpB;AAChD26B,YAAOld,KAAKzd,KAAO46B,KAAK56B,IAAKypB;AACnCzpB,eAAQA,KAAJyd,IACKzd,OAAOA,WAAY26B,GAAK5uB,SAAS/L,EAA3BA,EAA+B22B,OAAO32B,CAAtCA,IAERA,MAAM26B,EAAI5uB,SAAS/L,EAAbA;MALyCA;AAelDC,qDAAAA,SAAmB46B,GAAc56B;AAC/Bu6B,YAAMz6B,0CAAM86B,CAAN56B;AACZA,YAAIA,CAACu6B;AACHv6B,iBAAOA,CAACA,GAAGA,GAAGA,CAAPA;AAGH06B,YAAMnd,SAASgd,EAAI7D,OAAO12B,CAAXA,GAAeA,EAAxBA;AAKZA,eAAOA,CAJG06B,KAAO16B,IACN06B,KAAO16B,IAAKA,KACb06B,IAAM16B,GAETA;MAX8BA;qDAsBjCC,SAAmB46B,GAAWC,GAAWC,GAAS96B;AACtDA,YAAI+6B,IAAM/6B,GACNg7B,IAAQh7B,GACRi7B,IAAOj7B;AACXA,YAAUA,MAAN66B;AAGFI,cADAD,IADAD,IAAMD;aAGD96B;AACLA,gBAAMk7B,IAAUhe,KAAK+Y,MAAM2E,IAAI56B,EAAfA,GACVm7B,IAAYP,IAAI56B,KAAKk7B;AACrBE,cAAON,KAAK96B,IAAI66B;AACtB76B,gBAAMq7B,IAAOP,KAAK96B,IAAI66B,IAAIM;AACpBG,cAAOR,KAAK96B,IAAI66B,KAAK76B,IAAIm7B;AAC/Bn7B,kBAAQk7B,GAARl7B;YACEA,KAAKA;AACH+6B,kBAAMM;AACNL,kBAAQF;AACRG,kBAAOG;AACPp7B;YACFA,KAAKA;AACH+6B,kBAAMK;AACNJ,kBAAQF;AACRG,kBAAOK;AACPt7B;YACFA,KAAKA;AACH+6B,kBAAMK;AACNJ,kBAAQK;AACRJ,kBAAOH;AACP96B;YACFA,KAAKA;AACH+6B,kBAAMO;AACNN,kBAAQI;AACRH,kBAAOH;AACP96B;YACFA,KAAKA;AACH+6B,kBAAMD;AACNE,kBAAQI;AACRH,kBAAOI;AACPr7B;YACFA,KAAKA;YACLA,KAAKA;AACH+6B,kBAAMD,GACNE,IAAQM,GACRL,IAAOG;UA9BXp7B;QANKA;AAwCPA,eAAOF,6CAASod,KAAK+Y,MAAM8E,CAAX/6B,GAAiBkd,KAAK+Y,MAAM+E,CAAXh7B,GAAmBkd,KAAK+Y,MAAMgF,CAAXj7B,CAA7CA;MAhD+CA;kDA6DlDC,SACJs7B,GACAC,GACAC,GAAcx7B;AAERy7B,YAAO77B,0CAAM07B,CAANt7B;AACbA,YAAIA,CAACy7B;AACHz7B,iBAAOA;AAEH07B,YAAO97B,0CAAM27B,CAANv7B;AACbA,YAAIA,CAAC07B;AACH17B,iBAAOA;AAEH27B,YAAO77B,6CAAS27B,CAATz7B;AACP47B,YAAO97B,6CAAS47B,CAAT17B;AAIbA,eAAOH,6CAHGod,KAAKuQ,MAAMoO,EAAK57B,CAALA,IAAUw7B,KAAUG,EAAK37B,CAALA,IAAU47B,EAAK57B,CAALA,EAAzCsd,GACAL,KAAKuQ,MAAMoO,EAAK57B,CAALA,IAAUw7B,KAAUG,EAAK37B,CAALA,IAAU47B,EAAK57B,CAALA,EAAzCy6B,GACAxd,KAAKuQ,MAAMoO,EAAK57B,CAALA,IAAUw7B,KAAUG,EAAK37B,CAALA,IAAU47B,EAAK57B,CAALA,EAAzCspB,CACHtpB;MAfOA;qDAiDVC,SAAmB47B,GAAW57B;AAClCA,eAAOF,6CAAS87B,GAAK3B,mDAA0Bj6B,MAAXm6B,4CAA7Bn6B;MAD2BA;2EC9OpCC,SACEmjB,GACAyY,GACAC,GAAyB77B;AAEzBA,cAAM87B,IAAS97B,CAAAA;AACfA,YAAM+7B,IAAQ5Y,EAAQhL,MAAMnY,EAAdA;AACd+7B,UAAMzvB,KAAKtM,EAAXA;AAMAA,YAAI6P,IAAQ7P;AACNg8B,YAASh8B,CAAAA;AACfA,YAAI8xB,IAAS9xB;AACbA,iBAASwM,IAAIxM,GAAGwM,IAAIuvB,EAAM7vB,QAAQM,KAAKxM;AACrCA,cAAMksB,IAAI6P,EAAMvvB,CAANxM;AACVA,cAAcA,MAAV6P;AAEF7P,gBAAUA,QAANksB;AAMFlsB,eALM0Z,IAAOsiB,EAAOjuB,KAAK/N,EAAZA,MAEX87B,EAAOxvB,KAAKoN,CAAZ1Z,GAEFg8B,EAAO9vB,SAASlM,GAChB6P,IAAQ7P;qBACC67B,KAA0B77B,SAANksB,GAAYlsB;AAGzCA,oBAAM0Z,IAAOsiB,EAAOjuB,KAAK/N,EAAZA;AACT0Z,mBACFoiB,EAAOxvB,KAAKoN,CAAZ1Z;AAEFg8B,gBAAO9vB,SAASlM;AAChB87B,gBAAOxvB,KAAK4f,CAAZlsB;YARyCA;AAUzCg8B,gBAAO1vB,KAAK4f,CAAZlsB;mBAEiBA,MAAV6P;AACC7P,oBAANksB,KACF8P,EAAO1vB,KAAK4f,CAAZlsB,GACA6P,IAAQ7P,KACC47B,KAA4B57B,OAAOksB,KAAUlsB,OAALksB,KACjDrc,IAAQ7P,GACR8xB,IAAS5F,IACHxS,IAAOsiB,EAAOjuB,KAAK/N,EAAZA,MAEX87B,EAAOxvB,KAAKoN,CAAZ1Z,GAEFg8B,EAAO9vB,SAASlM,KACDA,QAANksB,IACTrc,IAAQ7P,KAERg8B,EAAO1vB,KAAKtM,KAAKksB,CAAjBlsB,GACA6P,IAAQ7P;mBAESA,MAAV6P;AACT7P,gBAAIA,OAAOksB,KAAUlsB,OAALksB;AACd4F,mBAAU5F;iBACLlsB;AACgB8xB,kBAAAA,IAAAA;AAArBgK,gBAAOxvB,KAAK6Q,SAAS2U,SAAAA,IAAAA,KAAAA,IAAU9xB,IAAIA,EAAvBA,CAAZA;AACAwM;AACAqD,kBAAQ7P;YAHHA;;AAKYA,kBAAV6P,MAEC7P,OAANksB,KAEF8P,EAAO5uB,OAAOpN,GAAGA,GAAGA,IAApBA,GACAwM,KACAqD,IAAQ7P,KACOA,QAANksB,IACT8P,EAAO1vB,KAAK4f,CAAZlsB,KAEMi8B,IAASD,EAAOjuB,KAAK/N,EAAZA,GACXA,YAAY43B,KAAKqE,CAAjBj8B,KAGIk8B,IAAWD,EAAO1b,YAAPvgB,IAKXm8B,IAAUD,EAAS9nB,WAAWpU,MAApBA,IACZk8B,EAAS7B,UAAUr6B,CAAnBA,IACAA,SACWm8B,KAAWhW,EAAAA,kCAClBiW,IAAWjW,EAAAA,+BAAIgW,CAAJn8B,GACOA,aAApBA,OAAOo8B,IAGTztB,MAAM0tB,UAAU/vB,KAAK5I,MACnBo4B,GACA97B,mEACEo8B,GACAR,GACAC,CAHF77B,CAFFA,IAQS47B,IAITE,EAAOxvB,KAAKtM,GAAGo8B,CAAHp8B,EAAZA,IAEA87B,EAAOxvB,KAAK8vB,CAAZp8B,KAIF87B,EAAOxvB,KAAKtM,OAAOi8B,IAASj8B,GAA5BA,KAKF87B,EAAOxvB,KAAKtM,OAAOi8B,IAASj8B,GAA5BA,GAFA6P,IADAmsB,EAAO9vB,SAASlM;QAhGeA;AA2GvCA,SADI0Z,IAAOsiB,EAAOjuB,KAAK/N,EAAZA,MAET87B,EAAOxvB,KAAKoN,CAAZ1Z;AAKIs8B,YAAet8B,CAAAA;AACrBg8B,UAAO9vB,SAASlM;AAChBA,aAASwM,IAAIxM,GAAGwM,IAAIsvB,EAAO5vB,QAAQM;AAEVxM,uBAArBA,OAAO87B,EAAOtvB,CAAPxM,KACL67B,KAAkC77B,SAAd87B,EAAOtvB,CAAPxM,MAItB0Z,IAAOsiB,EAAOjuB,KAAK/N,EAAZA,MAELs8B,EAAahwB,KAAKoN,CAAlB1Z,GAEFg8B,EAAO9vB,SAASlM,GAChBs8B,EAAahwB,KAAKwvB,EAAOtvB,CAAPxM,CAAlBA,KAPAg8B,EAAO1vB,KAAKwvB,EAAOtvB,CAAPxM,CAAZA;AAWJA,SADA0Z,IAAOsiB,EAAOjuB,KAAK/N,EAAZA,MAELs8B,EAAahwB,KAAKoN,CAAlB1Z;AAEFg8B,UAAO9vB,SAASlM;AAEhBA,eAAOs8B;MArJkBt8B;AAoKrBC,mEAAAA,SAAgCkjB,GAAeljB;AACnDA,eAAOD,mEAA8BmjB,GAASljB,MAAMA,IAA7CA;MAD4CA;sEAa/CC,SAAmCijB,GAAqBjjB;AAC5DA,YAAuBA,aAAnBA,OAAOijB;AACTjjB,iBAAOijB;AAEHoZ,YAAqBv8B,mEACzBmjB,GACAjjB,OACAA,KAHyBA;AAO3BA,eAAOq8B,EAAmBrwB,SAAStB,OAAO2xB,EAAmBr8B,CAAnBA,CAAPA,IAAgCA;MAXPA;oEAsBxDC,SAAiCgjB,GAAehjB;AACpDA,YAAIq8B,IAAar8B;AAEjBA,cAAMs8B,IAAWtW,EAAAA,gCAGXuW,IAAIvZ,EAAQ9F,MAAMld,mBAAdA;AACVA,YAAIu8B;AACFv8B,mBAASqM,IAAIrM,GAAGqM,IAAIkwB,EAAExwB,QAAQM,KAAKrM;AACjCA,kBAAMw8B,IAASD,EAAElwB,CAAFrM,EAAKogB,YAALpgB;AACuB+M,uBAAlCuvB,EAASE,EAAOpvB,MAAMpN,GAAGA,EAAhBA,CAATA,MACF2K,QAAQxG,KAAKnE,2BAA2Bu8B,EAAElwB,CAAFrM,IAAOA,SAASgjB,CAAxDhjB,GACAq8B,IAAar8B;UAJkBA;AASrCA,eAAOq8B;MAjB6Cr8B;8DA8BhDC,SAA2Bo6B,GAAuBp6B;AAItDA,cAAMw8B,IACcx8B,aAAlBA,OAAOo6B,IAAsBt6B,8DAAyBs6B,CAAzBp6B,IAAmCo6B;AAElEp6B,YAAMu7B,IAAMpe,OAAOqf,CAAPx8B;AACZA,YAAIA,CAACy8B,MAAMlB,CAANv7B,KAAcA,KAAKu7B,KAAcv7B,OAAPu7B;AAC7Bv7B,iBAAOA,EACLu7B,KAAKA,GACLxB,KAAiBt6B,6CACf87B,GACYr8B,qDAAZc,GAC4BA,MAAhBZ,gDAAZY,CAHGA,EAFAA;AAUPA,YADM+5B,IAAkBz6B,0CAAMk9B,CAAlBx8B;AAGVA,iBAAOA,EAACu7B,KAAKv7B,MAAM+5B,KAAKA,EAAjB/5B;AAEH08B,YAAW18B,sBAAsBw8B,IAAex8B;AAChDo6B,cAAWoC,MACbE,KAAY18B,aAAao6B,IAASp6B;AAEpCA,cAAM+J,MAAM2yB,CAAN18B;MA3B4CA;ACvNlD5B,gDAAAA,WAAgBA;AACpBA,eAAOw5B;MADax5B;AAUhB6B,yDAAAA,SAA0B08B,GAA6B18B;AAC3D23B,wDAAe+E;AACf18B,YAAeA,SAAX08B,GAAiB18B;AACnBA,cAAAA;AAAAA,mBAAAA,IAAAgX,SAAS4a,cAAc5xB,MAAM28B,mDAA7B38B,MAAAA,EAAkDmY,OAAlDnY;QADmBA;MAFsCA;mDAUvD5D,WAAmBA;AACvBA,cAAMyf,IAAmB9nB,iDAAPqI,KAA+B4a,SAASwC;AAEtDxC,iBAAS4a,cAAcx1B,MAAMugC,mDAA7BvgC,IACFu7B,gDAAe3gB,SAAS4a,cAAcx1B,MAAMugC,mDAA7BvgC,KAEfu7B,gDAAe3gB,SAASC,cAAc7a,KAAvBA,GACfu7B,8CAAa/f,YAAY+kB;UAGjBvlB,YAAYugB,6CAAtBv7B;MAVuBA;8CAsBnBW,SACJq2B,GACAC,GACAuJ,GACA7sB,GAA+BhT;AAE/BO,8CAAAP;AACAo1B,iDAAQiB;AACRz0B,mDAAUi+B;AAEV7/B,YADMkV,IAAM0lB,+CACZ56B;AACAkV,YAAI0G,MAAM6a,YAAYH,IAAMt2B,QAAQA;AACpCkV,YAAI0G,MAAMkB,UAAU9c;AACpBA,cAAIA,CAACgT,KAAaqjB,aAAoByJ,oCAAO9/B;AAG9BA,gBAAAA;AAAbgT,gBAAkDA,SAArCA,IAAAqjB,EAAmB/D,eAAnBtf,KAAqCA,SAArCA,EAAqCA;UAHPhT;AAK5BgT,cAAAA;AAAjB+sB,4DAAiB/sB,SAAAA,IAAAA,KAAAA,IAAahT;AAE5BgT,cAAAA;AADIgtB,cACJhtB,SAAAA,IAAAA,KAAAA,IAAqBnc,+CAAPmJ;+DACIggC,EAAkBrJ,YAAlB32B,EAAgC42B,aAAhC52B;AACpB62B,4DAAiBmJ,EAAkBlJ,SAAlB92B,EAA6B42B,aAA7B52B;AACbigC,gEACE1nC,0CAAS2c,GAAK+qB,kDAAlBjgC;AAEE62B,6DACEt+B,0CAAS2c,GAAK2hB,+CAAlB72B;QAjBFA;MAN+BA;8CA8B3BO,WAAcA;AAClBA,YAAKF,2CAAAE,GAALA;AAGA60B,mDAAQ70B;AAERA,cAAM2U,IAAM0lB;AACP1lB,gBACLA,EAAI0G,MAAMkB,UAAUvc,QACpB2U,EAAI0G,MAAMqB,OAAO1c,IACjB2U,EAAI0G,MAAMoB,MAAMzc,IAChBqB,4CAAWA,yCAAArB,GACXqB,2CAAUrB,MACV2U,EAAI8G,cAAczb,IAEd0/B,uDACExnC,6CAAYyc,GAAK+qB,kDAArB1/B,GACA0/B,qDAAoB1/B,KAElBs2B,oDACEp+B,6CAAYyc,GAAK2hB,+CAArBt2B,GACAs2B,kDAAiBt2B,KAEX1J,+CAAP0J,EAA2Ci4B,YAA3Cj4B;QAtBDA;MADkBA;AA+BdF,mDAAAA,WAAmBA;AACvBA,eAAOA,CAACA,CAAC+0B;MADc/0B;qDAUnBC,SAAsB4/B,GAAiB5/B;AACvC80B,mDAAU8K,KACZ3/B,sCAAAD;MAFyCA;AAYvC4C,kEAAAA,SAAmCi9B,GAA+Bj9B;AAC/CA,iBAAnB68B,mDAA2BA,oDAAmBI,KAChD5/B,sCAAA2C;MAFoEA;0DAcxEzC,SAA0BkY,GAAWE,GAAWtD,GAAc9U;AAC5Dm6B,sDAAchf,MAAMqB,OAAOtE,IAAIlY;AAC/Bm6B,sDAAchf,MAAMoB,MAAMnE,IAAIpY;AAC9Bm6B,sDAAchf,MAAMrG,SAASA,IAAS9U;MAHsBA;4DAsBxD0C,SACJi9B,GACAC,GACAC,GACAhK,GAAYnzB;AAEZA,cAAM0V,IAAIxV,4CAAW+8B,GAAcC,GAAYC,CAArCn9B;AACJwV,YAAIvV,4CAAWg9B,GAAcC,GAAYC,GAAYhK,CAAjDnzB;AAEFA,YAAJ0V,IACFpY,kDAAiBkY,GAAGxV,GAAGm9B,EAAW/qB,SAASsD,CAA3C1V,IAEA1C,kDAAiBkY,GAAGE,GAAGynB,EAAW/qB,MAAlCpS;MARUA;AAyBdC,oDAAAA,SACEg9B,GACAC,GACAC,GACAhK,GAAYlzB;AAEZA,eAAIkzB,IAMK3W,KAAKC,IAFFD,KAAKE,IAFIwgB,EAAW1hB,QAAQ2hB,EAAWjrB,OAElB+qB,EAAanjB,IAAlCtE,GAESynB,EAAazhB,QAAQ2hB,EAAWjrB,KAA5CjS,IAMAuc,KAAKE,IAFFF,KAAKC,IAAIygB,EAAWpjB,MAAMmjB,EAAazhB,QAAQ2hB,EAAWjrB,KAA1DsD,GAESynB,EAAanjB,IAAzB7Z;MAdGA;oDA8BdC,SACE+8B,GACAC,GACAC,GAAgBj9B;AAKhBA,eAAIg9B,EAAWzhB,SAAS0hB,EAAW/qB,UAAU6qB,EAAaxhB,SAEjDyhB,EAAWrjB,MAAMsjB,EAAW/qB,SAG5B8qB,EAAWzhB;MAVJvb;AAmBlBC,0DAAAA,SAA0B4f,GAAS5f;AACjCA,eAAOA,EAAQ5C,QAANwiB,KAAMxiB,CAANwiB,EAAMxiB;MADkB4C;AAQ7B5C,mEAAAA,WAAmCA;AAClC4C,0DAAiB8xB,sCAAjB10B,KAA4B00B,uCAAM10B,0BAANA,KAI/BH,sCAAAG;MALqCA;2DClQnC6C,WAAyBA;AAC7BA,eAAOg9B;MADsBh9B;AASzBC,2DAAAA,SAA0B3B,GAAmB2B;AACjD+8B,0DAAe1+B;MADkC2B;gDAiB7CxD,SACJiP,GACAhB,GACAqoB,GACAtjB,GAAwBhT;AAEdA,8CAAKwgC,+CAAYlK,GAAK10B,4CAASoR,CAAzChT;AACAA,YAAKiO,EAAQa,QAAb9O;AAIAA,cAAMygC,IAAOh9B,6CAAUwK,GAASqoB,GAAKrnB,CAAxBjP;AACb0gC,qDAAQD;AAER/8B,uDAAU+8B,GAAMxxB,GAAGqnB,CAAnBt2B;AAGAgP,qBAAWhP,WAAAA;AACTygC,cAAKE,MAAL3gC;UADSA,GAERA,CAFHA;AAGAugC,4DAAevgC;QAbfA;AACEO,kDAAAP;MAJsBA;qDA2B1ByD,SACEwK,GACAqoB,GACArnB,GAAexL;AAOfA,cAAMg9B,IAAOh9B,IAAIm9B;AACjBH,UAAKhjC,QAAaojC,uCAAKC,IAAvBr9B;AACAA,iBAAS2L,IAAI3L,GAAG2L,IAAInB,EAAQa,QAAQM,KAAK3L;AACvCA,gBAAMs9B,IAAS9yB,EAAQmB,CAAR3L,GACTu9B,IAAWv9B,IAAIw9B,yCAASF,EAAOzkB,IAApB7Y;AACjBu9B,YAASE,eAAe5K,CAAxB7yB;AACAu9B,YAASvjC,QAAaojC,uCAAKM,QAA3B19B;AACAg9B,YAAKW,SAASJ,CAAdv9B;AACAu9B,YAASK,WAAWN,EAAOO,OAA3B79B;AACAA,cAAIs9B,EAAOO;AAaTN,cAASO,SAZaC,WAAA/9B;AACpBlD,sDAAAkD;AACAsL,oCAAsBtL,MAAKA;AACzBuL,2BAAWvL,MAAKA;AAKds9B,oBAAOlpB;oBAAUkpB,EAA6BU;oBAAOxyB;kBAArDxL;gBALcA,GAMbA,CANHA;cADyBA,CAA3BA;YAFoBA,GAYWA,CAAAA,CAAjCA;QApBqCA;AAuBzCA,eAAOg9B;MAhCQh9B;AA2CjBC,qDAAAA,SAAmB+8B,GAAYxxB,GAAUqnB,GAAY5yB;AAEnDA,cAAM08B,IAAuBrmC,sDAAR2J;AAIf28B,YAAa38B,IAAImb,uCAHJ5P,EAIN6J,UAAUsnB,EAAapjB,KAJjB/N,EAKN6J,UAAUsnB,EAAapjB,KALjB/N,EAMN2J,UAAUwnB,EAAanjB,MANjBhO,EAON2J,UAAUwnB,EAAanjB,IAJjBvZ;AAOnBC,yDAAc88B,CAAd/8B;AACAA,cAAMg+B,IAAWjB,EAAKrnC,QAALsK;AAEb4yB,cACF+J,EAAWpjB,QAAQykB,EAASrsB,OAC5BgrB,EAAW1hB,SAAS+iB,EAASrsB,OAC7B+qB,EAAanjB,QAAQykB,EAASrsB,OAC9B+qB,EAAazhB,SAAS+iB,EAASrsB;AAGvBlS,4DAAmBi9B,GAAcC,GAAYqB,GAAUpL,CAAjE5yB;AAIA+8B,UAAKE,MAALj9B;MA3BmDA;yDAmCrDC,SAAuB88B,GAAU98B;AAC/BA,YAAMuR,IAAgB9T,wCAAVuC;AACZA,YAAIA,CAACuR;AACHvR,gBAAMoJ,MAAMpJ,6DAANA;AAEFg+B,YAAUlB,EAAKmB,OAAO1sB,CAAZvR;AACZpL,kDAASopC,GAASh+B,oBAAtBA;AAEc9L,8DACZ8pC,GACAh+B,eACAA,MACAC,kDAJFD;AAOA88B,UAAKE,MAALh9B;MAf+BA;AAsBjCC,2DAAAA,SAAyBqL,GAAQrL;AAE/BqL,UAAE4yB,eAAFj+B;AACAqL,UAAE6yB,gBAAFl+B;MAH+BA;gDAS3BrD,WAAcA;AACRD,qDAAYkgC,6CAAtBjgC;AACAggC,0DAAehgC;MAFGA;AAQdqB,mDAAAA,WAAiBA;AACjB8+B,qDACFA,yCAAM9+B,QAANA,GACA8+B,2CAAQ9+B;MAHWA;QAejBmgC,qDAAAA,SACJlgC,GACA4Q,GAA0CsvB;AAE1CA,eAAOA,MAAKA;AACC3vB,YAAAA,4CAAX2vB;AACAA,cAAIjQ;AACJiQ,cAAIA;AAEAjQ,gBADErf,aAAiBgQ,UACJhe,8CAAmBgO,GAAO5Q,EAAMmR,SAApC+uB,IAEoB3jC,2DAC7BqU,GACA5Q,EAAMmR,SAFG+uB;AAMbA,kBAAMjiB,IAAKje,EAAMuqB,uBAAN2V;AAETjiB,cAAGnH,IADD9W,EAAM6iB,MACR5E,EAAGnH,IAAKqpB,EAAAA,qCAAOC,aAEfniB,EAAGnH,IAAKqpB,EAAAA,qCAAOC;AAEjBniB,cAAGjH,KAAyBkpB,IAApBC,EAAAA,qCAAOC;cACN36B,OAAOwY,EAAGnH,GAAGmH,EAAGjH,CAAzBkpB;UAjBEA,UAAJA;AAmBazvB,cAAAA,2CAAXyvB;UADQA;AAGK5rC,wDAAX4rC,KAA0BA,CAACjQ,EAASV,SAAT2Q,KAClBjsC,yCAAKisC,KAAgBxrC,wCAAek7B,EAAAA,0CAA1BsQ,GAAyCjQ,CAA9CiQ,CAAhBA;AAEKztB,YAAAA,0CAAYwd,CAAnBiQ;AACAA,iBAAOjQ;QA5BGiQ;MAF8BA;kDCvMtCl+B,SAAyBmP,GAAsBkvB,IAASr+B,OAAKA;AACjEA,cAAMs+B,IAAmBjoB,EAAAA,+CAAcrW,KAAvBA;AAChBA,YAAMu+B,IAAmBr+B,0CACb8iB,EAAAA,kDAAiB7T,CAA3BnP,CADuBA;AAGrBu+B,UAAiBC,cAAjBx+B,KACFs+B,EAAQ9nB,YAAY+nB,CAApBv+B;AAEFA,mBAAWmpB,KAAWha,EAAU4b,eAAV/qB;AACpBs+B,YAAQ9nB,YACNvW,gDAAqBkpB,GAA+BkV,CAApDr+B,CADFA;AAIIyS,YAAStD,EAAUsvB,aAAaz+B,IAAvBA;AACfA,aAASuL,IAAIvL,GAAGuL,IAAIkH,EAAOxH,QAAQM;AAEjC+yB,YAAQ9nB,YAAYrW,4CADNsS,EAAOlH,CAAPvN,GAC8BqgC,CAAxBr+B,CAApBA;AAEFA,eAAOs+B;MAlB0Dt+B;wDAsB7DC,SACJkpB,GACAkV,IAASp+B,OAAKA;AAEdA,cAAMyS,IAAgB2D,EAAAA,+CAAcpW,SAAvBA;AACRo+B,aAAQ3rB,EAAKd,aAAa3R,MAAMkpB,EAAQla,EAAhChP;AAEPkP,YAAYga,EAAQha;AAC1BlP,cAAMqpB,IAAMH,EAAQZ,uBAARtoB;AACZqpB,UAAIxU,IAAI3F,EAAU0R,MAAM1R,EAAUoa,SAAVtpB,IAAuBqpB,EAAIxU,IAAIwU,EAAIxU;AAC3DpC,UAAKd,aAAa3R,KAAKA,GAAGqpB,EAAIxU,CAAP7U,EAAvBA;AACAyS,UAAKd,aAAa3R,KAAKA,GAAGqpB,EAAItU,CAAP/U,EAAvBA;AACAyS,UAAKd,aAAa3R,KAAKA,GAAGkpB,EAAQ5zB,QAAR0K,EAAkBuR,KAArBvR,EAAvBA;AACAyS,UAAKd,aAAa3R,KAAKA,GAAGkpB,EAAQ5zB,QAAR0K,EAAkByR,MAArBzR,EAAvBA;AAEIkpB,UAAQK,QAARvpB,MAAmByS,EAAKyF,cAAcgR,EAAQK,QAARvpB;AACtCkpB,UAAQM,YAARxpB,KAAuByS,EAAKd,aAAa3R,aAAaA,MAA/BA;AACtBkpB,UAAQQ,cAAR1pB,KAAyByS,EAAKd;UAAa3R;UAAYA;QAA9BA;AACzBkpB,UAAQU,aAAR5pB,KAAwByS,EAAKd,aAAa3R,WAAWA,OAA7BA;AACxBkpB,UAAQY,eAAR9pB,KAA0ByS,EAAKd,aAAa3R,aAAaA,OAA/BA;AAE/BA,eAAOyS;MAnBOzS;AA4BVC,kDAAAA,SAAyBw+B,GAA6Bx+B;AAC1DA,cAAMgjB,IAAqB7M,EAAAA,+CAAcnW,WAAvBA;AAClBA,iBAASqL,IAAIrL,GAAGqL,IAAImzB,EAAazzB,QAAQM,KAAKrL;AAC5CA,gBAAMmjB,IAAWqb,EAAanzB,CAAbrL,GACX2N,IAAmBwI,EAAAA,+CAAcnW,UAAvBA;AAChB2N,YAAQ2I,YAAqBD,EAAAA,gDAAe8M,EAASxa,IAAjC3I,CAApBA;AACImjB,YAASza,QACXiF,EAAQ+D,aAAa1R,QAAQmjB,EAASza,IAAtC1I;AAEF2N,YAAQoB,KAAKoU,EAASC,MAATpjB;AACbgjB,YAAU1M,YAAY3I,CAAtB3N;QAR4CA;AAU9CA,eAAOgjB;MAZmDhjB;oDAuBtDC,SACJnC,GACA2gC,GAAkBx+B;AAElBA,YAAInC,EAAMguB,kBAAN7rB,MAEFnC,IAAQA,EAAM6qB,YAAY1oB,KAAlBA,EAAyBA,CAAzBA,GACJA,CAACnC;AAEHmC,iBAAOA,IAAIy+B;AAIfz+B,YAAIqR,IAAQrR;AACRnC,UAAMmR,UAAU0R,QAClBrP,IAAQxT,EAAMmR,UAAUoa,SAAhBppB;AAGJ0N,YAAUvN,sCAAWtC,GAAO2gC,CAAlBx+B;AAChBA,YAAIsB,qCAAUoM,CAAV1N,GAAoBA;AACtBA,gBAAM8b,IAAKje,EAAMuqB,uBAANpoB;AACX0N,YAAQ+D,aACNzR,KACAwJ,OAAOmS,KAAKuQ,MAAMruB,EAAMmR,UAAU0R,MAAMrP,IAAQyK,EAAGnH,IAAImH,EAAGnH,CAAnD3U,CAAPA,CAFFA;AAIA0N,YAAQ+D,aAAazR,KAAKwJ,OAAOmS,KAAKuQ,MAAMpQ,EAAGjH,CAAd7U,CAAPA,CAA1BA;QANsBA;AAQxBA,eAAO0N;MAzBW1N;8CAkCpBC,SAAoBwmB,GAAYxmB;AAC9BA,YAAIwmB,EAAM9sB,eAANsG,GAAwBA;AAC1BA,gBAAM6a,IAAqB5E,EAAAA,+CAAcjW,OAAvBA;AAClB6a,YAAUrJ,aAAaxR,QAAQwmB,EAAM/d,QAAQzI,EAA7CA;AACAA,iBAAOwmB,EAAMiY,MAAM5jB,CAAZ7a;QAHmBA;AAK5BA,eAAOA;MANuBA;AAgBhCC,kDAAAA,SAAwBrC,GAAc6P,GAAgBxN;AACpDA,iBAASkL,IAAIlL,GAAGkL,IAAIvN,EAAM6uB,UAAU5hB,QAAQM,KAAKlL;AAC/CA,gBAAMysB,IAAQ9uB,EAAM6uB,UAAUthB,CAAhBlL;AACdA,mBAASwf,IAAIxf,GAAGwf,IAAIiN,EAAMC,SAAS9hB,QAAQ4U,KAAKxf;AAE9CA,kBAAMy+B,IAAW1+B,sCADH0sB,EAAMC,SAASlN,CAAf+G,CACGvmB;AACby+B,iBACFjxB,EAAQ2I,YAAYsoB,CAApBz+B;UAJ4CA;QAFDA;MADGA;8CAqBhDC,SACJtC,GACA2gC,GAAkBr+B;AAGlBA,YAAItC,EAAMguB,kBAAN1rB;AAEFA,kBADMyP,IAAQ/R,EAAM6qB,YAAYvoB,KAAlBA,EAAyBA,CAAzBA,KAELA,sCAAWyP,CAAXzP,IAGAA,IAAIs+B;AAIft+B,cAAMuN,IAAmBwI,EAAAA,+CAAcrY,EAAMuvB,SAANjtB,IAAmBA,WAAWA,OAArDA;AAChBuN,UAAQ+D,aAAatR,QAAQtC,EAAM4K,IAAnCtI;AACKq+B,cACH9wB,EAAQoB,KAAKjR,EAAMiR;AAErB3O,YAAItC,EAAMuuB,eAAejsB;AAEvBA,cAAMy+B,IAAW/gC,EAAMuuB,cAANjsB;AACby+B,gBAAaA,EAASP,cAATl+B,KAA4By+B,EAASC,cAAT1+B,MAC3CuN,EAAQ2I,YAAYuoB,CAApBz+B;QAJqBA;AAQzBD,kDAAerC,GAAO6P,CAAtBvN;AAGAA,YADM2+B,IAAcjhC,EAAMkhC,eAAN5+B,GACHA;AACfA,cAAM6oB,IAAUnrB,EAAMyxB,QAAQ0P,iDAASC,OAAvB9+B,GACV4f,IAAOiJ,EAAQkW,cAAR/+B;AACPg/B,cAASnW,EAAQoH,gBAARjwB;AAEfA,cAAMi/B,IAA0BlpB,EAAAA,+CAAc/V,SAAvBA;AACvBi/B,YAAe/oB,YAAqBD,EAAAA,gDAAe0oB,CAAxB3+B,CAA3BA;AACAi/B,YAAe3tB,aAAatR,UAAUA,GAAGg/B,CAAHh/B,EAAtCA;AACAi/B,YAAe3tB,aAAatR,KAAKqJ,OAAOuW,EAAKxO,MAAZpR,CAAjCA;AACAi/B,YAAe3tB,aAAatR,KAAKqJ,OAAOuW,EAAK1O,KAAZlR,CAAjCA;AAEAuN,YAAQ2I,YAAY+oB,CAApBj/B;QAXeA;AAcbtC,UAAMouB,SACFoT,IAAuBnpB,EAAAA,+CAAc/V,MAAvBA,GACpBk/B,EAAYhpB,YAAqBD,EAAAA,gDAAevY,EAAMouB,IAA9B9rB,CAAxBA,GACAuN,EAAQ2I,YAAYgpB,CAApBl/B;AAGFA,aAASiL,IAAIjL,GAAGiL,IAAIvN,EAAM6uB,UAAU5hB,QAAQM,KAAKjL;AACzCwsB,cAAQ9uB,EAAM6uB,UAAUthB,CAAhBjL;cACV2a,IAAAA;AACAwkB,cAAQn/B;AACZA,cAAIwsB,EAAMlkB,SAAS+lB,EAAAA,qDAAW+Q,SAAS5S,EAAMlkB,SAAS+lB,EAAAA,qDAAWgR,SAE1Dr/B;AACCs/B,gBAAa9S,EAAMG,WAAYK,YAAlBhtB;AACfwsB,cAAMlkB,SAAS+lB,EAAAA,qDAAWC,QAC5B3T,IAAqB5E,EAAAA,+CAAc/V,OAAvBA,IACHwsB,EAAMlkB,SAAS+lB,EAAAA,qDAAWkR,cACnC5kB,IAAqB5E,EAAAA,+CAAc/V,WAAvBA;AAEdA,kBAAMw/B,IAAchT,EAAMG,WAAY8S,aAAlBz/B;aAChBw/B,KAAiBF,KAAeA,EAAWrS,SAAXjtB,KAClC2a,EAAWzE,YAAYjW,uCAAYu/B,GAAanB,CAAzBr+B,CAAvBA;AAEEs/B,kBACII,IAAY1/B,sCAAWs/B,GAAYjB,CAAvBr+B,GACd0/B,EAAU5gB,aAAiB6gB,0CAASC,iBACtCjlB,EAAWzE,YAAYwpB,CAAvB1/B,GACAm/B,IAAQn/B;AAId2a,cAAWrJ,aAAatR,QAAQwsB,EAAMjkB,IAAtCvI;AACKm/B,iBACH5xB,EAAQ2I,YAAYyE,CAApB3a;UArBKA;QANwCA;AA+BxB2L,mBAAvBjO,EAAMkuB,gBACNluB,EAAMkuB,iBAAiBluB,EAAMmuB,uBAE7Bte,EAAQ+D,aAAatR,UAAUqJ,OAAO3L,EAAMkuB,YAAb5rB,CAA/BA;AAEEtC,UAAMyrB,YAANnpB,KACFuN,EAAQ+D,aAAatR,aAAaA,MAAlCA;AAEGtC,UAAM1L,UAANgO,KAIHuN,EAAQ+D,aACNtR,oBACAoN,MAAMC,KAAK3P,EAAMiuB,mBAAN3rB,CAAXA,EAAuCuL,IAAIs0B,kBAA3C7/B,EAA+DwM,KAAKxM,GAApEA,CAFFA;UAKSypB,eAANzpB,KACHuN,EAAQ+D,aAAatR,aAAaA,OAAlCA;AAEGtC,UAAM6rB,aAANvpB,KACHuN,EAAQ+D,aAAatR,WAAWA,OAAhCA;AAEGtC,UAAM2rB,cAANrpB,KACHuN,EAAQ+D,aAAatR,YAAYA,OAAjCA;AAGI2R,YAAYjU,EAAMoS,aAAN9P;AAClBA,YAAI2a;AACAhJ,cACImuB,IAAW9/B,sCAAW2R,GAAW0sB,CAAtBr+B,GACb8/B,EAAShhB,aAAiB6gB,0CAASC,iBACrCjlB,IAAqB5E,EAAAA,+CAAc/V,MAAvBA,GACZ2a,EAAUzE,YAAY4pB,CAAtB9/B,GACAuN,EAAQ2I,YAAYyE,CAApB3a;AAGE+/B,YACJriC,EAAMmvB,kBAAkBnvB,EAAMmvB,eAAe4S,aAArBz/B;AACtB+/B,SAAAA,KAAgBpuB,KAAcA,EAAUsb,SAAVjtB,KAChC2a,EAAWzE,YAAYjW;UAAY8/B;UAAY1B;QAAxBr+B,CAAvBA;AAGFA,eAAOuN;MA3HWvN;+CAqIpBC,SAAqB6sB,GAAiBuR,GAAkBp+B;AAGtDA,YAAIgT,IAFJ6Z,IAASA,EAAOkT,UAAU//B,IAAjBA,GAGLggC;AACJhgC,eAAOgT;AAMLhT,cALIo+B,KAA8Bp+B,aAAlBgT,EAAK+K,YAGlB/K,EAAiBitB,gBAAgBjgC,IAAjCA,GAECgT,EAAKoD;AACPpD,gBAAOA,EAAKoD;eACPpW;AACLA,mBAAOgT,KAAQhT,CAACgT,EAAKsE,eAAatX;AAChCggC,kBAAWhtB;AACXA,kBAAOA,EAAKiE;AAIVjE,kBAAAA;AAFAgtB,gBAASnhB,aAAiB6gB,0CAASQ,aACAlgC,OAAlCggC,EAAkBnU,KAAKnjB,KAAvB1I,MACKoW,SAANpD,IAAAA,KAAMoD,SAANpD,EAAMoD,gBAAe4pB,KAGjBzrC,4CAAWyrC,CAAfhgC;YAT8BA;AAY9BgT,kBACFgtB,IAAWhtB,GACXA,IAAOA,EAAKsE,aAEV0oB,EAASnhB,aAAiB6gB,0CAASQ,aACAlgC,OAAlCggC,EAAkBnU,KAAKnjB,KAAvB1I,KAGGzL,4CAAWyrC,CAAfhgC;UArBCA;AA0BTA,eAAO6sB;MAvC+C7sB;AAkDlDhK,6CAAAA,SAAoBgoB,GAAShoB;AAIjCA,eAHsBA,2CAAUgoB,CAAnB9F,EAGDvC,QAAQ3f,qBAAqBA,aAAlCA;MAJ0BA;mDAa7BiK,SAA0B+d,GAAS/d;AAKjCg1B,YAFOj/B,qCAAUgoB,CAAVmiB,EAEMxpB,MAAM1W,GAAXA;AAEdA,YAAImgC,IAASngC;AACbA,iBAAS+K,IAAI/K,GAAG+K,IAAIiqB,EAAMvqB,QAAQM,KAAK/K;AACrCA,gBAAMmD,IAAO6xB,EAAMjqB,CAAN/K;AACGA,kBAAZmD,EAAKnD,CAALA,MACFmgC,IAASA,EAAOvH,UAAU54B,CAAjBA;AAEXg1B,YAAMjqB,CAAN/K,IAAWmgC,IAASngC,MAAMmD;AACVnD,kBAAZmD,EAAKnD,CAALA,KAAsCA,SAAnBmD,EAAK2I,MAAM9L,EAAXA,MACrBmgC,KAAUngC;QAPyBA;AAYnCiY,YAAO+c,EAAM1oB,KAAKtM,IAAXA;AACXiY,YAAOA,EAAKvC,QAAQ1V,qCAAqCA,SAAlDA;AAEPA,eAAOiY,EAAKvC,QAAQ1V,OAAOA,EAApBA;MAvBgCA;gEAkCnCC,SACJmgC,GACAzxB,GAAuB1O;AAEvB0O,UAAU0xB,kBAAkBpgC,KAA5BA;AACA0O,UAAU2xB,MAAVrgC;AACMsgC,YAAWC,EAAAA,0CAAeJ,GAAKzxB,CAApB1O;AACjB0O,UAAU0xB,kBAAkBpgC,IAA5BA;AACAA,eAAOsgC;MANgBtgC;QAgBnBugC,4CAAAA,SAAyBJ,GAAczxB,GAAoB6xB;AAC/DA,YAAIxvB,IAAQwvB;AACR7xB,UAAU0R,QACZrP,IAAQrC,EAAUoa,SAAVyX;AAEVA,cAAMC,IAAcD,CAAAA;AAChB/rC,6DAAJ+rC;AACAA,cAAMtT,IAA2Bhf,EAAAA,6CAAXsyB;AACjBtT,aACQ/e,EAAAA,6CAASqyB,IAApBA;AAKG7xB,UAA2B0xB,qBAC7B1xB,EAA2B0xB,kBAAkBG,KAA7CA;AAEHA,YAAIE,IAAiBF;AACrBA,YAAIA;AACFA,mBAASz1B,IAAIy1B,GAAGG,GAAWA,IAAWP,EAAIjhB,WAAWpU,CAAfy1B,GAAoBz1B,KAAKy1B;AAC7DA,kBAAMn4B,IAAOs4B,EAAS7iB,SAASnV,YAAlB63B,GACPI,IAAkBD;AACxBH,gBACWA,YAATn4B,KACUm4B,aAATn4B,KAAqBm4B,CAAYhvC,kDAAXgvC,GACvBA;AAIAA,oBAAMhjC,IAAQ4C;gBAAmBwgC;gBAAiBjyB;cAApC6xB;AACdC,gBAAY51B,KAAKrN,EAAMiR,EAAvB+xB;AACwBA,kBAAAA;AAAxBA,oBAAMK,IAASnlB,SAAS8kB,SAAAA,IAAAI,EAAgB/sB,aAAa2sB,GAA7BA,KAAAA,IAAqCA,MAAMA,EAApDA;AACSA,kBAAAA;AAAxBA,oBAAMM,IAASplB,SAAS8kB,SAAAA,IAAAI,EAAgB/sB,aAAa2sB,GAA7BA,KAAAA,IAAqCA,MAAMA,EAApDA;AACVpF,oBAAMyF,CAANL,KAAkBpF,MAAM0F,CAANN,KACrBhjC,EAAMyF,OAAO0L,EAAU0R,MAAMrP,IAAQ6vB,IAASA,GAAQC,GAAQN,CAC5DA,QAD4DA,CAA9DA;AAIFE,kBAAiBF;YAbjBA,OAcKA;AAAAA,kBAAaA,aAATn4B;AACTm4B,sBAAM/gB,UAAU+gB,2CAAVA;AACDA,kBAAaA,cAATn4B;AACTnI,gEAAqB0gC,GAAiBjyB,CAAtC6xB;uBACkBA,gBAATn4B,GAAsBm4B;AAC/BA,oBAAIE;AACFrgC,4DAAeugC,GAAiBjyB,CAAhC6xB;;AAEAA,wBAAM93B,MACJ83B,kIADIA;AAMRE,oBAAiBF;cAVcA;YAJ1BA;UApBsDA;QAD7DA,UAAJA;AAuCaryB,YAAAA,6CAAS+e,CAApBsT,GACK7xB,EAA2B0xB,qBAC7B1xB,EAA2B0xB,kBAAkBG,IAA7CA,GAEC7xB,EAAUqe,YAA2Bv0B,8DAAjB+nC,GACpB9rC,oDAAJ8rC;QANQA;AASC/uC,iDAAK+uC,KAAgBtuC,wCAAe6uC,oDAA1BP,GAA6C7xB,CAAlD6xB,CAAhBA;AACAA,eAAOC;MAlEwDD;wDAsE3DtgC,SACJgS,GACAvD,GAAoBzO;AAETA,YAAAA;AAAXA,cAAMuO,IAAKvO,SAAAA,IAAAgS,EAAK2B,aAAa3T,IAAlBA,KAAAA,IAA2BuL;AAChCkd,YAAUha,EAAUqe,WACtB9sB,IAAI8gC,oFAAyBryB,GAA2BF,CAAxDvO,IACAA,IAAI+gC,mEAAiBtyB,GAAWF,CAAhCvO;AAEiByX,YAAAA;AAArBgR,UAAQgB,QAAahS,SAAAA,IAALzF,EAAKyF,eAAAA,IAAezX,EAApCA;AAEiBA,YAAAA;AAAboU,YAAIoH,SAASxb,SAAAA,IAAAgS,EAAK2B,aAAa3T,GAAlBA,KAAAA,IAA0BA,IAAIA,EAAvCA;AACWA,YAAAA;AAAbsU,YAAIkH,SAASxb,SAAAA,IAAAgS,EAAK2B,aAAa3T,GAAlBA,KAAAA,IAA0BA,IAAIA,EAAvCA;AACLk7B,cAAM9mB,CAANpU,KAAak7B,MAAM5mB,CAANtU,MAChBoU,IAAI3F,EAAU0R,MAAM1R,EAAUoa,SAAV7oB,IAAuBoU,IAAIA,GAC/CqU,EAAQ3lB,OAAO9C,IAAI0Z,mDAAWtF,GAAGE,CAAlBtU,CAAfA;AAGiBA,YAAAA;AAAbghC,YAAIxlB,SAASxb,SAAAA,IAAAgS,EAAK2B,aAAa3T,GAAlBA,KAAAA,IAA0BA,IAAIA,EAAvCA;AACSA,YAAAA;AAAb84B,YAAItd,SAASxb,SAAAA,IAAAgS,EAAK2B,aAAa3T,GAAlBA,KAAAA,IAA0BA,IAAIA,EAAvCA;AACLk7B,cAAM8F,CAANhhC,KAAak7B,MAAMpC,CAAN94B,KAAUyoB,EAAQmB,QAAQ5pB,IAAImZ,uCAAK6nB,GAAGlI,CAAZ94B,CAAhBA;AAEWA,mBAAnCgS,EAAK2B,aAAa3T,WAAlBA,KAA2CyoB,EAAQoB,aAAa7pB,IAArBA;AACTA,oBAAlCgS,EAAK2B,aAAa3T,UAAlBA,KAA2CyoB,EAAQqB,YAAY9pB,KAApBA;AACVA,oBAAjCgS,EAAK2B,aAAa3T,SAAlBA,KAA0CyoB,EAAQsB,WAAW/pB,KAAnBA;AACPA,oBAAnCgS,EAAK2B,aAAa3T,WAAlBA,KAA4CyoB,EAAQuB,aAAahqB,KAArBA;AAEhDA,eAAOyoB;MAzBazoB;wDAoChBC,SACJigC,GACAzxB,GAAuBxO;AAKvBA,YAAIA,CAAEwO,EAA2BwyB;AAC/BhhC,iBAAOqgC,EAAAA,0CAAeJ,GAAKzxB,CAApBxO;AAGTA,YAAMihC,IAAQzyB,EAA2BwyB,qBAA3BhhC;AAERsgC,YAAcD,EAAAA,0CAAeJ,GAAKzxB,CAApBxO;AACpBA,YAAIihC,KAAQA,EAAKzoB,QAAQyoB,EAAK7mB,QAAQpa;AAI9BkhC,cAAAA,IAAOD,EAAK7mB;AACZ+mB,cAAO3yB,EAAU0R,MAAM+gB,EAAK9mB,QAAQ8mB,EAAKxoB;AAE/CzY,cAAIohC,IAAWC;AACfrhC,cAAIshC,IAAYthC,WACZuhC,IAAOF;AAEXrhC,mBAAS4K,IAAI5K,GAAG4K,IAAI01B,EAAYh2B,QAAQM,KAAK5K;AAC3CA,kBAAMwhC,IAAUhzB,EACbK,aAAayxB,EAAY11B,CAAZ5K,CADAA,EAEb4nB,uBAFa5nB;AAGZwhC,cAAQntB,IAAIktB,MACdA,IAAOC,EAAQntB;AAEbmtB,cAAQrtB,IAAIitB,MAEdA,IAAWI,EAAQrtB;AAEjBqtB,cAAQrtB,IAAImtB,MAEdA,IAAYE,EAAQrtB;UAbqBnU;AAgB7CyhC,cAAUP,IAAOK,IAjBGG;AAkBpBC,cAAUnzB,EAAU0R,MAAMihB,IAAOG,IAAYH,IAAOC;AACpDphC,eAAS4K,IAAI5K,GAAG4K,IAAI01B,EAAYh2B,QAAQM;AACxB4D,cAAUK,aAAayxB,EAAY11B,CAAZ5K,CAAvB3C,EACPyF;cAAO6+B;cAASF;cAASzhC,CAACA,QAADA;YAAhCA;QA/BkCA;AAkCtCA,eAAOsgC;MA9CgBtgC;AAyDnB4hC,QAAAA,wCAAAA,SAAqBC,GAAmBrzB,GAAoBozB;AAC1DvkC,YAAQ4C,8CAAmB4hC,GAAUrzB,CAA7BozB;AACVpzB,UAAUqe,YAA2Bv0B,8DAAjBspC;AACxBA,eAAOvkC;MAHyDukC;sDAkB5D3hC,SACJ4hC,GACArzB,GAAoBvO;AAGT2N,UAAAA,4CAAX3N;AACAA,YAAM+sB,IAA0Bxe,EAAU0W,gBAAVjlB;AAChCA,YAAI6hC;AACJ7hC,YAAIA;AAGFA,cAFA6hC,IAAWnhC,8CAAmBkhC,GAAUrzB,CAA7BvO,GAEPuO,EAAUqe,UAAU5sB;AACtBA,kBAAM8hC,IAAcD,GACdhwB,IAASgwB,EAAS1zB,eAAenO,KAAxBA;AACf8hC,cAAY3U,sBAAsBntB,KAAlCA;AAEAA,qBAAS2K,IAAIkH,EAAOxH,SAASrK,GAAQA,KAAL2K,GAAQA;AACrCkH,gBAAOlH,CAAP3K,EAAuBwvB,QAAvBxvB;AAEHA,qBAAS2K,IAAIkH,EAAOxH,SAASrK,GAAQA,KAAL2K,GAAQA;AACrCkH,gBAAOlH,CAAP3K,EAAuB7H,YAAvB6H;AAIHuK,uBAAWvK,WAAAA;AACJ8hC,gBAAY5U,YACf4U,EAAY3U,sBAAsBntB,IAAlCA;YAFOA,GAIRA,CAJHA;AAOCuO,cAA2BkZ,eAA3BznB;UApBqBA,OAqBjBA;AACLA,kBAAM6R,IAASgwB,EAAS1zB,eAAenO,KAAxBA;AACfA,qBAAS2K,IAAIkH,EAAOxH,SAASrK,GAAQA,KAAL2K,GAAQA;AACtCkH,gBAAOlH,CAAP3K,EAAU0vB,UAAV1vB;UAHGA;QAxBLA,UAAJA;AA+Ba6N,YAAAA,2CAAX7N;QADQA;AAGVA,YAAetO,8CAAXsO,GAAwBA;AACpButB,cAAyBr1B,mDAC7BqW,GACAwe,CAFmB/sB;AAKrBA,eAAS2K,IAAI3K,GAAG2K,IAAI4iB,EAAaljB,QAAQM;AACjC6iB,gBAAeD,EAAa5iB,CAAb3K,GACV3O,yCACT2O,KAAgBlO,wCAAe27B,8CAA1BztB,GAAuCwtB,CAA5CxtB,CADFA;AAMS3O,mDAAK2O,KAAgBlO,wCAAe6c,EAAAA,0CAA1B3O,GAAmC6hC,CAAxC7hC,CAAhBA;QAd0BA;AAgB5BA,eAAO6hC;MAvDa7hC;kDAgEhBC,SAAyB8hC,GAAuBxzB,GAAoBtO;AACxEA,iBAAS0K,IAAI1K,GAAG0K,IAAIo3B,EAAa7yB,SAAS7E,QAAQM,KAAK1K;AACrDA,cAAMsgC,IAAWwB,EAAa7yB,SAASvE,CAAtB1K;AACjBA,gBAAM+H,IAAOu4B,EAAS9sB,aAAaxT,MAAtBA,GACPoO,IAAKkyB,EAAS9sB,aAAaxT,IAAtBA;AACLgI,cAAOs4B,EAAShpB;AAEtBtX,cAAIA,CAACgI;AAAMhI;AACXsO,YAAUtW,eAAegQ,GAAMD,GAAMqG,CAArCpO;QAPqDA;MADiBA;uDA6B1EC,SAA6B0hC,GAAiB1hC;AAC5CA,cAAM8hC,IAAe9hC,EACnBi+B,UAAUj+B,CAAAA,GACVqoB,SAASroB,CAAAA,GACTsrB,MAAMtrB,CAAAA,GACN8lB,OAAO9lB,CAAAA,GACPgsB,OAAOhsB,CAAAA,GACP+hC,MAAM/hC,CAAAA,EANaA;AAQrBA,iBAASyK,IAAIzK,GAAGyK,IAAIi3B,EAAS1yB,SAAS7E,QAAQM,KAAKzK;AACjDA,gBAAMqgC,IAAWqB,EAAS1yB,SAASvE,CAAlBzK;AACjBA,cAAIqgC,EAAS/hB,aAAiB6gB,0CAASQ;AAIvC3/B,oBAAQqgC,EAAS7iB,SAASnV,YAAlBrI,GAARA;cACEA,KAAKA;AACH8hC,kBAAa7D,SAAS1zB,KAAK81B,CAA3BrgC;AACAA;cACFA,KAAKA;AACH8hC,kBAAazZ,QAAQ9d,KAAK81B,CAA1BrgC;AACAA;cACFA,KAAKA;AACH8hC,kBAAaxW,KAAK/gB,KAAK81B,CAAvBrgC;AACAA;cACFA,KAAKA;cAGLA,KAAKA;AACH8hC,kBAAahc,MAAMvb,KAAK81B,CAAxBrgC;AACAA;cACFA,KAAKA;cACLA,KAAKA;AACH8hC,kBAAa9V,MAAMzhB,KAAK81B,CAAxBrgC;AACAA;cACFA,KAAKA;AACH8hC,kBAAaC,KAAKx3B,KAAK81B,CAAvBrgC;;cAEFA;AAEE+I,wBAAQxG,KAAKvC,2BAA2BqgC,EAAS7iB,QAAjDxd;YAzBJA;QANiDA;AAkCnDA,eAAO8hC;MA3CqC9hC;AAsD9CC,yDAAAA,SAA+B+hC,GAAwB9kC,GAAY+C;AACjEA,YAAIgiC,IAAoBhiC;AACxBA,iBAASwK,IAAIxK,GAAGwK,IAAIu3B,EAAY73B,QAAQM,KAAKxK;AAC3CA,gBAAMogC,IAAW2B,EAAYv3B,CAAZxK;AAEb/C,YAAMwwB,kBACRxwB,EAAMwwB,cAAc2S,CAApBpgC,GACK/C,EAAmBoyB,YAEtB2S,IAAoBhiC;QAPmBA;AAW7CA,eAAOgiC;MAb0DhiC;wDAsBnEC,SAA8B8hC,GAAwB9kC,GAAYgD;AAChEA,iBAASuK,IAAIvK,GAAGuK,IAAIu3B,EAAY73B,QAAQM,KAAKvK;AAC3CA,cAAMmgC,IAAW2B,EAAYv3B,CAAZvK;AACjBA,gBAAMyX,IAAO0oB,EAAShpB,aAChBmnB,IAA6Ct+B,WAApCmgC,EAAS9sB,aAAarT,QAAtBA;AACQA,cAAAA;AAAvBA,gBAAMwQ,IAAQ0K,SAASlb,SAAAA,IAAAmgC,EAAS9sB,aAAarT,GAAtBA,KAAAA,IAA8BA,MAAMA,EAA7CA;AACUA,cAAAA;AAAlB0Q,cAASwK,SAASlb,SAAAA,IAAAmgC,EAAS9sB,aAAarT,GAAtBA,KAAAA,IAA8BA,MAAMA,EAA7CA;AAEfhD,YAAMglC,eAAevqB,CAArBzX;AACAA,gBAAMmoB,IAAUnrB,EAAMyxB,QAAQ0P,iDAASC,OAAvBp+B;AACX46B,gBAAMpqB,CAANxQ,KAAiB46B,MAAMlqB,CAAN1Q,KACpBmoB,EAAQ8Z,cAAcjiC,IAAI6Y,uCAAKrI,GAAOE,CAAhB1Q,CAAtBA;AAGFmoB,YAAQqH,iBAAiB8O,CAAzBt+B;AAEAmK;YAAWnK,MAAMmoB,EAAQqH,iBAAiB8O,CAAzBt+B;YAAkCA;UAAnDA;QAf2CA;MADmBA;AA0BlEC,qDAAAA,SAA2B6hC,GAAwB9kC,GAAYiD;AAC7DA,iBAASsK,IAAItK,GAAGsK,IAAIu3B,EAAY73B,QAAQM;AAEtCvN,YAAMouB,OADW0W,EAAYv3B,CAAZ41B,EACKhpB;MAHqClX;AAa/DC,sDAAAA,SAA4B4hC,GAAwB9kC,GAAYkD;AAC9DA,iBAASqK,IAAIrK,GAAGqK,IAAIu3B,EAAY73B,QAAQM,KAAKrK;AAC3CA,gBAAMigC,IAAW2B,EAAYv3B,CAAZrK,GACXod,IAAW6iB,EAAS9sB,aAAanT,MAAtBA;AACZod,cAIL/c,sCAAWvD,GAAOsgB,GAAU6iB,CAA5BjgC,IAHE2I,QAAQxG,KAAKnC,mCAAmClD,EAAM4K,IAAzC1H,EAAbA;QAJyCA;MADiBA;mDAkBhEC,SAAyB+hC,GAAgB/hC;AAIvCA,YAAIgiC,IAAoChiC,MACpCiiC,IAAqCjiC;AACzCA,iBAASoK,IAAIpK,GAAGoK,IAAI23B,EAAQvjB,WAAW1U,QAAQM,KAAKpK;AAClDA,gBAAMggC,IAAW+B,EAAQvjB,WAAWpU,CAAnBpK;AACbM,+CAAU0/B,CAAVhgC,MACsCA,YAApCggC,EAAS7iB,SAASnV,YAAlBhI,IACFgiC,IAAoBhC,IACyBhgC,aAApCggC,EAAS7iB,SAASnV,YAAlBhI,MACTiiC,IAAqBjC;QANyBhgC;AAUpDA,eAAOA,EAACgiC,mBAAAA,GAAmBC,oBAAAA,EAApBjiC;MAhBgCA;sDA0BzCC,SACE0hC,GACA3zB,GACAnR,GACAqlC,GAAqBjiC;AAErBA,iBAASmK,IAAInK,GAAGmK,IAAIu3B,EAAY73B,QAAQM,KAAKnK;AAC3CA,cAAM+/B,IAAW2B,EAAYv3B,CAAZnK;AACjBA,gBAAMkd,IAAW6iB,EAAS9sB,aAAajT,MAAtBA,GACX0rB,IAAQxO,IAAWtgB,EAAMkyB,SAAS5R,CAAfld,IAA2BA;AACpDA,cAAIA,CAAC0rB,GAAO1rB;AACVyI,oBAAQxG,KACNjC,iCACEkd,IACAld,eACAiiC,CAJJjiC;AAMAA;UAPUA;AASNkiC,cAAiBniC,2CAAgBggC,CAAhB//B;AACvBA,cAAIkiC,EAAeH,mBAAmB/hC;AACpCA,gBAAIA,CAAC0rB,EAAMG;AACT7rB,oBAAM6e,UAAU7e,kCAAVA;AAERE,0DACEgiC,EAAeH,mBACfh0B,GACA2d,EAAMG,YACN7rB,KAJFA;UAJoCA;AAYtCA,cAAIkiC,EAAeF,oBAAoBhiC;AAC/B6rB,gBAAAA;AAAN7rB,qBAAM6rB,IAANH,EAAMG,eAAAA,EAAYsW,aAAaD,EAAeF,kBAA9ChiC;UADqCA;QA1BIA;MAFxBA;AAyCvBC,qDAAAA,SACEyhC,GACA3zB,GACAnR,GAAYqD;AAEZA,iBAASkK,IAAIlK,GAAGkK,IAAIu3B,EAAY73B,QAAQM,KAAKlK;AAE3CA,gBAAMiiC,IAAiBniC,2CADN2hC,EAAYv3B,CAAZ41B,CACM9/B;AACvBA,cAAIiiC,EAAeH,mBAAmB9hC;AACpCA,gBAAIA,CAACrD,EAAMmvB;AACT9rB,oBAAM4e,UAAU5e,gCAAVA;AAGRA,gBAAIrD,EAAMmvB,eAAeqW,YAArBniC;AACFA,oBAAM4e,UAAU5e,sCAAVA;AAGRC,0DACEgiC,EAAeH,mBACfh0B,GACAnR,EAAMmvB,gBACN9rB,IAJFA;UAToCA;AAiBlCiiC,YAAeF,sBAAsBplC,EAAMmvB,kBAC7CnvB,EAAMmvB,eAAeoW,aAAaD,EAAeF,kBAAjD/hC;QArByCA;MAFjCA;sDAwCdC,SACEkhC,GACArzB,GACAse,GACAgW,GAA+BniC;AAE/BA,YAAItD;AACJsD,cAAM+hC,IAAgBb,EAASnuB,aAAa/S,MAAtBA;AACtBA,YAAIA,CAAC+hC;AACH/hC,gBAAM2e,UAAU3e,6BAA6BkhC,EAASkB,SAAhDpiC;AAERA,YAAM2N,IAAK3N,SAAAA,IAAAkhC,EAASnuB,aAAa/S,IAAtBA,KAAAA,IAA+B2K;AAC1CjO,YAAQmR,EAAU8e,SAASoV,GAAep0B,CAAlC3N;AAGFqiC,YAAkB7iC,+CAAoB0hC,CAApBlhC;AAExBA,cAAMyhC,IAAoBhiC,iDACxB4iC,EAAgB5E,UAChB/gC,CAFwBsD;AAI1BN,wDAAqB2iC,EAAgBxa,SAASnrB,CAA9CsD;AACAL,qDAAkB0iC,EAAgBvX,MAAMpuB,CAAxCsD;AAGAA,YAAImsB;AACFnsB,cAAImiC;AACFniC,gBAAItD,EAAMkS;AACRud,gBAAiBsB,QAAQ/wB,EAAMkS,kBAA/B5O;;AAEAA,oBAAM2e,UAAU3e,8CAAVA;mBAGJtD,EAAMiS;AACRwd,cAAiBsB,QAAQ/wB,EAAMiS,gBAA/B3O;mBACStD,EAAMkS;AACfud,cAAiBsB,QAAQ/wB,EAAMkS,kBAA/B5O;;AAEAA,kBAAM2e,UACJ3e,yDADIA;AAOZJ,sDAAmByiC,EAAgB/c,OAAO5oB,CAA1CsD;AACAF,sDAAmBuiC,EAAgB7W,OAAO3d,GAAWnR,GAAOqlC,CAA5D/hC;AACAD,qDAAkBsiC,EAAgBd,MAAM1zB,GAAWnR,CAAnDsD;AAEIyhC,aAKD/kC,EAAmBoyB,QAAnB9uB;AAIHA,SADMsiC,IAASpB,EAASnuB,aAAa/S,QAAtBA,MAEbtD,EAAMuwB,gBAA2BjtB,WAAXsiC,CAAtBtiC;AAGFA,SADMkN,IAAWg0B,EAASnuB,aAAa/S,UAAtBA,MAIftD,EAAMgS,kBACS1O,WAAbkN,KAAoClN,eAAbkN,GACvB8f,kDAFFhtB;AAKIuiC,YAAkBrB,EAASnuB,aAAa/S,kBAAtBA;AACxBA,YAAwBA,SAApBuiC;AACFviC,mBAAWiM,KAAUs2B,EAAgB3sB,MAAM5V,GAAtBA;AAGnBtD,cAAMgS,kBAAkB1O,MAAMwiC,mBAAmBv2B,CAAnBjM,CAA9BA;AAIJA,SADM0oB,IAAYwY,EAASnuB,aAAa/S,WAAtBA,MAEhBtD,EAAM0sB,aAA2BppB,WAAd0oB,CAAnB1oB;AAGFA,SADMwoB,IAAU0Y,EAASnuB,aAAa/S,SAAtBA,MAEdtD,EAAMysB,WAAuBnpB,WAAZwoB,CAAjBxoB;AAGFA,SADMsoB,IAAW4Y,EAASnuB,aAAa/S,UAAtBA,MAEftD,EAAMwsB,YAAyBlpB,WAAbsoB,CAAlBtoB;AAGFA,SADMooB,IAAY8Y,EAASnuB,aAAa/S,WAAtBA,MAEhBtD,EAAMusB,aAA2BjpB,WAAdooB,CAAnBpoB;AAEFA,YAAwCA,aAApCkhC,EAASlkB,SAASnV,YAAlB7H,GAA8CA;AAE1CwO,cAAW9R,EAAM6qB,YAAYvnB,KAAlBA;AACjBA,eAASiK,IAAIjK,GAAGiK,IAAIuE,EAAS7E,QAAQM;AAEnCjK,gBAAIA,CADUwO,EAASvE,CAATwE,EACHwd,SAANjsB;AACHA,oBAAM2e,UAAU3e,4CAAVA;AAIVtD,YAAMkwB,UAAU5sB,IAAhBA;QAVgDA;AAYlDA,eAAOtD;MAtGwBsD;AAgHjCC,8CAAAA,SAAoBvD,GAAc8xB,GAAmB8Q,GAAYr/B;AAC/DA,cAAMqlB,IAAQ5oB,EAAMgyB,SAASF,CAAfvuB;AACTqlB,YAMLA,EAAMmd,QAAQnD,CAAdr/B,IALEsI,QAAQxG,KACN9B,iCAAiCuuB,IAAYvuB,eAAevD,EAAM4K,IADpErH;MAH6DA;8CAiB3DC,SAAqBghC,GAAoChhC;AAC7DA,iBAAS+J,IAAI/J,GAAG+J,IAAIi3B,EAAS7iB,WAAW1U,QAAQM,KAAK/J;AACnDA,gBAAMuO,IAAQyyB,EAAS7iB,WAAWpU,CAApB/J;AACdA,cAAqCA,WAAjCuO,EAAMuO,SAASnV,YAAf3H,GAAyCA;AAC3CghC,cAAS/qB,YAAY1H,CAArBvO;AACAA;UAF2CA;QAFMA;MADQA;AAU/DC,6CAAAA,SAAmB8R,GAAU9R;AAC3BA,eAAO8R,EAAK6L,aAAiB6gB,0CAASC;MADXz+B;gEChjCvBC,SAA0B1D,GAAe0D;AAE7CA,YAAIA,EAAqCA,MAArC1D,EAAM+Q,eAAerN,KAArBA,EAA4BuJ,SAAhCvJ;AAEAA,cAAMyN,IAAYnR,EAAMmR,WAClB60B,IAAWhmC,EAAM+zB,WAANrwB;AACjByN,YAAU80B,gBAAVviC,EAA4BwiC,KAAKxiC,QAAjCA;AAEAA,cAAMua,IAAKje,EAAMuqB,uBAAN7mB,GAELyiC,IAAqBH,EAAS1D,UAAU5+B,IAAnBA;AAC3ByiC,YAAMvyB,aAAalQ,aAAaA,eAAeua,EAAGnH,IAAIpT,MAAMua,EAAGjH,IAAItT,GAAnEA;AACAA,cAAAA;AAAAA,mBAAAA,IAAAyN,EAAUi1B,gBAAV1iC,MAAAA,EAA6B2iC,uBAAuB3iC,EAClDqwB,YAAYrwB,MACHyiC,EAFyCziC,CAApDA;AAWAC,gEAAcwiC,GANIG,EAChB5iC,GAAKua,EAAGnH,GACRpT,GAAKua,EAAGjH,GACRtT,OAAS1D,EAAMwT,OACf9P,QAAU1D,EAAM0T,OAJA4yB,GAMcn1B,EAAU0R,KAAKnf,oBAAI6iC,MAAnD7iC;QArBAA;MAF6CA;8DAmC/CC,SACEwiC,GACAK,GACA/R,GACAgS,GAAW9iC;AAGXA,cAAM+iC,MADK/iC,oBAAI4iC,QAAOI,QAAXhjC,IAAuB8iC,EAAME,QAANhjC,KACbA;AACPA,YAAV+iC,IACE5vC,4CAAWqvC,CAAfxiC,KAKAwiC,EAAMvyB,aACJjQ,aACAA,gBALQ6iC,EAAK1vB,KAAO2d,IAAM9wB,KAAKA,KAAK6iC,EAAKhzB,QAAS7P,IAAK+iC,KAKpC/iC,OAJX6iC,EAAKxvB,IAAKwvB,EAAK9yB,SAAS/P,IAAK+iC,KAIR/iC,cAHjBA,IAAI+iC,KAGuC/iC,GAFzDA,GAIAwJ,WAAWxJ,uDAAeA,IAAIwiC,GAAOK,GAAM/R,GAAKgS,CAAhD9iC;MAdSA;mEAwBPC,SAA6B5D,GAAe4D;AAChDA,YAAMuN,IAAYnR,EAAMmR;AACxBvN,cAAMsM,IAAQiB,EAAUjB;AACxBiB,UAAU80B,gBAAVriC,EAA4BsiC,KAAKtiC,OAAjCA;AACAA,YAAIA,EAAQA,IAARsM,IAAJtM;AAIAA,cAAMqa,IAAK9M,EAAUy1B,SAAS5mC,EAAM+zB,WAANnwB,CAAnBA;AAEP5D,YAAMiS,oBACRgM,EAAGnH,MAAM9W,EAAM6iB,MAAMjf,IAAIA,MAAMsM,GAC/B+N,EAAGjH,KAAKpT,KAAKsM,KACJlQ,EAAMkS,uBACf+L,EAAGnH,MAAM9W,EAAM6iB,MAAMjf,MAAMA,MAAMsM,GACjC+N,EAAGjH,KAAKpT,IAAIsM;AAEdtM,cAAMijC,IAAapwC,kDACjBqwC,qCAAIC,QACJnjC,EACEA,IAAMqa,EAAGnH,GACTlT,IAAMqa,EAAGjH,GACTpT,GAAKA,GACLA,MAAQA,QACRA,QAAUA,QACVA,gBAAgBA,GANlBA,GAQAuN,EAAU+B,aAAVtP,CAVaA;AAaTojC,cAAqBvwC;YACzBqwC,qCAAIG;YACJrjC,EACEA,IAAMA,mBACNA,OAASA,cACTA,eAAiBA,KACjBA,KAAOA,SACPA,MAAQA,GACRA,IAAMA,KAAKsM,EANbtM;YAQAijC;UAVqBjjC;AAYjBsjC,cAAuBzwC,kDAC3BqwC,qCAAIG,SACJrjC,EACEA,IAAMA,oBACNA,OAASA,cACTA,eAAiBA,WACjBA,KAAOA,SACPA,MAAQA,GACRA,IAAMA,EANRA,GAQAijC,CAVuBjjC;AAazBojC,YAAeG,aAAfvjC;AACAsjC,YAAiBC,aAAjBvjC;AAEAuJ,qBAAWvJ,MAAMA,KAAS9M,4CAAW+vC,CAAfjjC,GAAwBA,GAA9CA;QAtDAA;MAJgDA;mEAmE5CC,SAA6B7D,GAAe6D;AAChDE,iEAAAF;AACA7D,UAAMmR,UAAU80B,gBAAhBpiC,EAAkCqiC,KAAKriC,YAAvCA;AACAA,YAAIA,EAAwBA,IAAxB7D,EAAMmR,UAAUjB,QAApBrM;AAMAA,cAAM6P,IAAS1T,EAAMonC,eAANvjC,EAAuB6P;AAClC2zB,cAAavpB,KAAKwpB,KAHDC,KAGqB7zB,CAAzB7P,IAAmCia,KAAK4U,KAAM7uB;AAC1D7D,YAAM6iB,QACTwkB,KAAaxjC;AAGf2jC,kEAAgBxnC;AAChB8D,mEAAiB9D,GAAOqnC,GAAWxjC,oBAAI0iC,MAAvC1iC;QAbAA;MAHgDA;iEA0BlDC,SAA0B9D,GAAiBqnC,GAAmBZ,GAAW3iC;AAKvEA,cAAM4iC,MADK5iC,oBAAIyiC,QAAOI,QAAX7iC,IAAuB2iC,EAAME,QAAN7iC,KAHjB2jC;AAMjB3jC,YAAI4jC,IAAO5jC;AACIA,aAAX4iC,MAIFgB,IAAO5jC,SAHKga,KAAKuQ,MACfvQ,KAAK6pB,IAAIjB,IAAU5oB,KAAK4U,KARZkV,CAQZ9jC,KAAyCA,IAAI4iC,KAAWW,CAD9CQ,CAGL/jC,KACPgkC,wDAAgB36B,WAAWrJ,0DAAkBA,IAAI9D,GAAOqnC,GAAWZ,CAAnD3iC;AAGlB9D,UACG+zB,WADHjwB,EAEG8P,aAAa9P,aAAaA,GAAG9D,EAAM+nC,eAANjkC,CAAHA,IAA6B4jC,CAA7B5jC,EAF7BA;MAhBuEA;iEA0BnEC,WAA0BA;AACzByjC,kEACDM,0DACF7yB,aAAa6yB,qDAAb/jC,GACA+jC,wDAAgB/jC,OAElByjC,sDACGzT,WADHhwB,EAEG6P,aAAa7P,aAAayjC,sDAAcO,eAAdhkC,CAF7BA,GAGAyjC,wDAAgBzjC;MATcA;ACxJ1BC,kEAAAA,SAAsB4d,GAAQ5d;AAClCA,eACiCiK,WAA/B2T,EAAI2I,0BACctc,WAAlB2T,EAAIomB,aACc/5B,WAAlB2T,EAAIqmB,aACSh6B,WAAb2T,EAAIsmB,QACYj6B,WAAhB2T,EAAIumB,WACel6B,WAAnB2T,EAAIwmB;MAP4BpkC;AC/C9BC,sDAAAA,SACJkS,GACAkyB,GAA0BpkC;AAE1BA,mBAAW6S,KAAKuxB;AAEZlyB,YAAOW,CAAP7S,IADgBA,SAAdokC,EAAOvxB,CAAP7S,KAA2CA,aAArBA,OAAOokC,EAAOvxB,CAAP7S,IACnBA,8CAAUkS,EAAOW,CAAP7S,KAAawH,uBAAOC,OAAOzH,IAAdA,GAAqBokC,EAAOvxB,CAAP7S,CAA5CA,IAEAokC,EAAOvxB,CAAP7S;AAGhBA,eAAOkS;MATmBlS;6ECCtBC,SACJlE,GAA8BkE;AAE9BA,eACmD+J,WAAhDjO,EAA0BsoC,qBACsBr6B,WAAhDjO,EAA0BuoC,qBACmBt6B,WAA7CjO,EAA0BwoC;MALCtkC;ACE1BC,oEAAAA,SAAuByd,GAAQzd;AACnCA,eAA+B8J,WAAxB2T,EAAI6mB,mBAAwDx6B,WAAvB2T,EAAI8mB;MADbvkC;ACwC/B9Q,uDAAAA,SAAmBuX,GAAc+9B,GAA4Bt1C;AACxDA,iDAAkB2X,qCAAKY,OAAOhB,GAAM+9B,CAA7Ct1C;MADiEA;yDAS7DE,SAAqBqX,GAAYrX;AAC5BA,mDAAoByX,qCAAKY,OAAOhB,CAAzCrX;MADqCA;AAejCkB,QAAAA,iDAAAA,SAAsB2X,GAAwB3X;AAClDA,eAAOsY,gDAAU3I,iBAAiBgI,CAA3B3X;MAD2CA;+DASpD2P,SAA6BgI,GAAwBhI;AACnDA,cAAMwkC,IAAuBj1C,0CAClBqX,qCAAKY,OACdQ,EAAQxB,IAFUxG;AAIpBA,eAAKwkC,IAUEA,EAAYn0C,SAAS2X,CAArBhI,KATLyH,QAAQxG,KACNjB,8CACEgI,EAAAhI,OACAA,yLAHJA,GAOOA;MAb0CA;0DCkoBrDC,SAAqB+H,GAAqB/H;AAKxCA,YAAIwkC,IAAYxkC;AAChBA,cAAMykC,IAAiB18B,EAAQyB,IAAIxJ,CAACA,CAAC0kC,GAAOpxB,CAARtT,MAA8BA;AAChEA,cAAqBA,aAAjBA,OAAO0kC;AACT1kC,mBAAOA,CAASpD,8DAAyB8nC,CAAjC1kC,GAAyCsT,CAA1CtT;AAGTwkC,cAAYxkC;AAOZA,iBAAOA,CAHSA,SAAd0kC,EAAMC,MACF3kC,OAAAA,OAAAA,CAAAA,GAAI0kC,GAAJ1kC,EAAW2kC,KAAa/nC,8DAAyB8nC,EAAMC,GAAvC3kC,EAAhBA,CAAAA,IACAA,OAAAA,OAAAA,CAAAA,GAAI0kC,CAAJ1kC,GACcsT,CAAbtT;QAZyDA,CAA3CA;AAevBA,YAAIwkC,KAA8BxkC,IAAjB+H,EAAQa;AAAY5I,iBAAOA,EAAC+H,SAAS08B,EAAVzkC;AAG5CA,YAAM4kC,IADgBH,EACaj7B,IAAIxJ,CAACA,CAAC0kC,CAAD1kC,MAAY0kC,CAA/B1kC,GAEf6kC,IAAuBpqC,yDAAqBmqC,CAAjC5kC;AACX8kC,YAA2BpqC;UAAiBkqC;UAAcC;QAA3C7kC;AACrBA,cAAM+kC,IAA2BpqC,qDAAiBiqC,GAAcC,CAA3C7kC;AAErBA,YACGA,CAAC8kC,KAAgB9kC,CAAC+kC,KACnBF,KAAYC,IAAeC;AAG3B/kC,iBAAOA,EAAC+H,SAZY08B,EAYbzkC;AAGHglC,YAASF,IACXF,EAAa5kC,CAAbA,EAAgB+2B,UAAU/2B,GAAG8kC,IAAe9kC,CAA5CA,IACA4J;AACE0Y,YAASyiB,IACXH,EAAa5kC,CAAbA,EAAgBgzB,OAAOhzB,IAAI+kC,CAA3B/kC,IACA4J;AACJ5J,eAAOA,EACL+H,SAAS9H,gDAtBWwkC,GAsBcK,GAAcC,CAAvC/kC,GACTglC,QAAAA,GACA1iB,QAAAA,EAHKtiB;MA5CiCA;AA6D1CC,wDAAAA,SACE8H,GACA+8B,GACAC,GAAoB9kC;AAEpBA,eAAO8H,EAAQyB,IAAIvJ,CAACA,CAACmW,GAAM9C,CAAPrT,MAAkBA,CACpCmW,EAAK2gB,UAAU+N,GAAc1uB,EAAKxN,SAASm8B,CAA3C9kC,GACAqT,CAFoCrT,CAA/BA;MAFaA;8DActBC,SAAyB6H,GAAqB7H;AAC5CA,YAAIA,CAACmL,MAAMyR,QAAQ/U,CAAd7H;AACHA,gBAAM0d,UAAU1d,yCAAVA;AAERA,YAAIA,CAAC6H,EAAQa;AACX1I,gBAAM0d,UAAU1d,mDAAVA;AAERA,YAAI+kC,IAAa/kC;AACjBA,iBAASgJ,IAAIhJ,GAAGgJ,IAAInB,EAAQa,QAAQM,KAAKhJ;AACvCA,gBAAMglC,IAAQn9B,EAAQmB,CAARhJ;AACTmL,gBAAMyR,QAAQooB,CAAdhlC,IAS0BA,aAApBA,OAAOglC,EAAMhlC,CAANA,KAChB+kC,IAAa/kC,MACbsH,QAAQ29B,MACNjlC,oBACEgJ,IACAhJ,6DAEAglC,EAAMhlC,CAANA,IACAA,SACFglC,CAPFhlC,KAUAglC,EAAMhlC,CAANA,KACoBA,aAApBA,OAAOglC,EAAMhlC,CAANA,KACiBA,aAAxBA,OAAOglC,EAAMhlC,CAANA,EAASklC,QAEhBH,IAAa/kC,MACbsH,QAAQ29B,MACNjlC,oBACEgJ,IACAhJ,sFAEAglC,EAAMhlC,CAANA,IACAA,SACFglC,CAPFhlC,MAzBA+kC,IAAa/kC,MACbsH,QAAQ29B,MACNjlC,oBACEgJ,IACAhJ,0DAEFglC,CALFhlC;QAJqCA;AAuCzCA,YAAI+kC;AACF/kC,gBAAM0d,UAAU1d,sCAAVA;MAhDoCA;QCjxBxClR,6CAAAA,SAAmBwX,GAAc6+B,GAAgBr2C;AACrDA,YAAoBA,aAAhBA,OAAOwX,KAAqCxX,OAAhBwX,EAAKI,KAAL5X;AAC9BA,gBAAM6X,MAAM7X,oCAAoCwX,IAAOxX,GAAjDA;AAERA,YAAIs2C,gDAAc9+B,CAAdxX;AACFA,gBAAM6X,MAAM7X,uBAAuBwX,IAAOxX,0BAApCA;AAERA,YAAsBA,eAAlBA,OAAOq2C;AACTr2C,gBAAM6X,MAAM7X,uBAAuBwX,IAAOxX,sBAApCA;AAERs2C,wDAAc9+B,CAAdxX,IAAsBq2C;MAV+Br2C;QAqBjDu2C,kDAAAA,SAAwB/+B,GAAcg/B,GAA4BD;AACtEA,YAAIA,CAACC,KAAgCD,aAApBA,OAAOC;AACtBD,gBAAM1+B,MAAM0+B,mBAAmB/+B,IAAO++B,oBAAhCA;AAERv2C,UAAAA,2CAASwX,GAAM++B,WAAAA;AACbA,eAAKE,MAAMD,CAAXD;QADaA,CAAfA;MAJsEA;QAsBlEG,oDAAAA,SACJl/B,GACAg/B,GACAG,GACAC,GAAwBF;AAExBA,cAAMG,IAAcH,qCAAqCl/B,IAAOk/B;AAEhEhlC,oEAA0BmlC,GAAaL,CAAvCE;AACAA,cAAMI,IAAmBtlC,qDAAmBglC,GAAUK,CAA7BH;AAEzBA,YAAIC,KAAwCD,eAAxBA,OAAOC;AACzBD,gBAAM7+B,MAAMg/B,IAAcH,gBAAgBl/B,IAAOk/B,qBAA3CA;AAIR12C,UAAAA,2CAASwX,GAAMk/B,WAAAA;AACTI,eACFJ,KAAKK,WAAWL,IAAIM,EAAAA,sDAAYJ,KAAiBF,CAAAA,GAAIA,IAArCA,CAAhBA;AAGFA,eAAKD,MAAMD,CAAXE;AAEIC,eACFA,EAAavlC,MAAMslC,IAAnBA;QARWA,CAAfA;MAZwBA;qDA8BpBx2C,SAAqBsX,GAAYtX;AACjCiR,uDAAaqG,CAAbtX,IACFA,OAAOo2C,gDAAc9+B,CAAdtX,IAEPsY,QAAQxG,KACN9R,oCAAoCsX,IAAOtX,uBAD7CA;MAJmCA;AAgBjCiR,uDAAAA,SAAuBqG,GAAYrG;AACvCA,eAAOA,CAACA,CAACmlC,gDAAc9+B,CAAdrG;MAD8BA;gDAanCC,SAAgBoG,GAAc7K,GAAcsqC,GAAkB7lC;AAClEA,cAAM8lC,IAAcZ,gDAAc9+B,CAAdpG;AACpBA,YAA2BA,eAAvBA,OAAO8lC;AACT9lC,gBAAMyG,MAAMzG,uBAAuBoG,IAAOpG,cAApCA;AAERA,YAAI+lC;AACAF,YAEF5lC,2DAAyBmG,GAAM7K,CAA/ByE,IAIA+lC,IAAoBxlC,uDAAqBhF,CAArByE;AAEtB8lC,UAAY9lC,MAAMzE,CAAlByE;AAEAA,YAAI6lC;AAEFvlC,sEADoBN,mCAAmCoG,IAAOpG,OACvBzE,CAAvCyE;iBAGEA,CAACQ;UAAuBulC;UAA2CxqC;QAAlEyE;AAEDA,gBAAMyG,MACJzG,oCACEoG,IACApG,uEAHEA;MAvBwDA;AA0CpEC,mEAAAA,SAAkC+lC,GAAsBzqC,GAAY0E;AAElEA,YADmBM,uDAAqBhF,CAArB0qC,EACJz9B;AACbvI,gBAAMwG,MACJxG,qCACE+lC,IACA/lC,iEAEA1E,EAAMiR,EALJvM;MAH0DA;wDAwBpEC,SACEq0B,GACAkR,GAAmBvlC;AAEnBA,eAAOG,uDACLk0B,EAAOzK,eACPyK,EAAOxI,eACP0Z,IAAcvlC,8BAHTA;MAFYA;AAmBrBC,yDAAAA,SACEo0B,GACAkR,GAAmBtlC;AAEnBA,eAAOE,uDACLk0B,EAAO/8B,gBACP+8B,EAAOp8B,gBACPstC,IAActlC,gCAHTA;MAFYA;6DAmBrBC,SACEm0B,GACAkR,GAAmBrlC;AAEnBA,eAAOC,uDACLk0B,EAAO2R,SACP3R,EAAO4R,WACPV,IAAcrlC,oBAHTA;MAFYA;AAqBrBC,+DAAAA,SACE+lC,GACAC,GACAZ,GAAmBplC;AAEnBA,YAAI+lC,KAASC,GAAOhmC;AAClBA,cAAqBA,eAAjBA,OAAO+lC,KAAyC/lC,eAAjBA,OAAOgmC;AACxChmC,kBAAMoG,MAAMg/B,IAAcplC,qBAApBA;AAERA,iBAAOA;QAJWA;AAKbA,YAAIA,CAAC+lC,KAAS/lC,CAACgmC;AACpBhmC,iBAAOA;AAETA,cAAMoG,MAAMg/B,IAAcplC,qCAApBA;MAVaA;oEAmBrBC,SACEmlC,GACAlR,GAA0Bj0B;AAE1BA,cAAMgmC,IAAcpmC,gDAAcq0B,GAAQkR,CAAtBnlC,GACdimC,IAAepmC,iDAAeo0B,GAAQkR,CAAvBnlC;AACrBA,YAAIA,CAACgmC,KAAehmC,CAACimC;AACnBjmC,gBAAMmG,MACJg/B,IACEnlC,iEAFEA;AAORF,6DAAmBm0B,GAAQkR,CAA3BnlC;MAZ0BA;+DAsB5BC,SAA8BhF,GAAYgF;AACxCA,cAAMqW,IAASrW,CAAAA;AAGaiJ,mBAAxBjO,EAAMwwB,iBACRnV,EAAOhO,KAAKrN,EAAMwwB,aAAlBxrB;AAE0BiJ,mBAAxBjO,EAAMuuB,iBACRlT,EAAOhO,KAAKrN,EAAMuuB,aAAlBvpB;AAE2BiJ,mBAAzBjO,EAAM/D,kBACRof,EAAOhO,KAAKrN,EAAM/D,cAAlB+I;AAE2BiJ,mBAAzBjO,EAAMpD,kBACRye,EAAOhO,KAAKrN,EAAMpD,cAAlBoI;AAEoBiJ,mBAAlBjO,EAAM2qC,WACRtvB,EAAOhO,KAAKrN,EAAM2qC,OAAlB3lC;AAEsBiJ,mBAApBjO,EAAM4qC,aACRvvB,EAAOhO,KAAKrN,EAAM4qC,SAAlB5lC;AAEFA,eAAOqW;MAtBiCrW;iEAkC1CC,SACEgmC,GACAjrC,GAAYiF;AAENimC,YAAgBlmC,uDAAqBhF,CAArBiF;AACtBA,YAAIimC,EAAcj+B,WAAWg+B,EAAch+B;AACzChI,iBAAOA;AAETA,iBAASsI,IAAItI,GAAGsI,IAAI29B,EAAcj+B,QAAQM;AACxCtI,cAAIgmC,EAAc19B,CAAdtI,MAAqBimC,EAAc39B,CAAdtI;AACvBA,mBAAOA;AAGXA,eAAOA;MAXKA;2DAqBRC,SAA2BimC,GAAcjmC;AAC7CA,YAAwBA,aAApBA,OAAOkT;AACTlT,gBAAMgG,MAAMhG,+CAANA;AAERA,YAA4BA,eAAxBkT,SAASgzB;AACXD,YAAAjmC;aADFA;AAIEA,gBAAMmmC,IAA0BC,YAAYpmC,WAAAA;AACdA,2BAAxBkT,SAASgzB,eACXG,cAAcF,CAAdnmC,GACAimC,EAAAjmC;UAHwCA,GAKzCA,EAL6BA;QAJlCA;MAJ6CA;QA0BzCsmC,4DAAAA,SACJC,GACAC,GAAoCF;AAGpCA,cAAMG,IAA8BH,CAAAA;AAEpCA,eAAOA,WAAAA;AACAG,YAAkBptB,SAASitB,KAAK5gC,IAAhC4gC,MACHrmC,8DAA4BqmC,MAAMC,GAAcC,CAAhDF,GACAG,EAAkBt+B,KAAKm+B,KAAK5gC,IAA5B4gC;AAGFA,eAAKI,YACHJ,WAAAA;AACEA,kBAAM7zB,IAAQhM,OAAO6/B,KAAKK,cAAcJ,CAAnBD,CAAPA;AACdA,mBAAevqC,8DAAyByqC,EAAY/zB,CAAZ6zB,CAAjCA;UAFTA,GAGEv1C,KAAKu1C,IAHPA,CADFA;QANKA;MAL6BA;sEA4BtCrmC,SACEnF,GACAyrC,GACAC,GAAoCvmC;AAEpCA,YAAM2mC,IAAW9rC,EAAMgyB,SAASyZ,CAAftmC;AACjBA,YAAM2mC,aAAoBC,uDAAkB5mC,CAAA2mC,EAASE,oBAAT7mC,GAA5CA;AAIMiH,cAAU0/B,EAASG,WAAT9mC;AAChBA,qBAAWA,CAAAA,EAAG+G,CAAH/G,KAAWiH;AACK6B,uBAArBy9B,EAAYx/B,CAAZ/G,KACF0G,QAAQxG,KACNF,gCAAgC+G,CAAhC/G,aACKsmC,CAAHtmC,kBAAiCnF,EAAM4K,IAAvCzF,GAFJA;QAPJA;MAHoCA;QA4BhC+mC,8DAAAA,SACJC,GACAra,GAAiBoa;AAEjBA,eAAOA,WAAAA;AACLA,eAAKN,YACHM,WAAAA;AACEA,kBAAMtjB,IAAQsjB,KAAKla,SAASF,CAAdoa;AACdA,mBACGjrC,8DAAyBkrC,CADrBD,EAEJh0B,QAAQg0B,MAAMtjB,IAAQA,EAAM4C,QAAN0gB,IAAkBA,EAFpCA;UAFTA,GAKEj2C,KAAKi2C,IALPA,CADFA;QADKA;MAFUA;AAoBnB9mC,iEAAAA,WAA+BA;AAC7BA,cAAMgnC,IAA0BhnC,KAAK6zB;AACrC7zB,aAAKwmC,YACHxmC,WAAAA;AACEA,gBAAMsM,IAAStM,KAAKuM,UAALvM;AACfA,iBACGsM,KAAUA,EAAO26B,gBAAPjnC,KAA4BsM,EAAOunB,WAC9CmT;QAJJhnC,GAMEnP,KAAKmP,IANPA,CADFA;MAF6BA;sDCxczBC,SACJwF,GACAyhC,GACAC,GACAC,GAAgBnnC;AAEZ0G,YACFlB,IACAxF,wBACAinC,IACAjnC,6BACAknC,IACAlnC;AACEmnC,cACFzgC,KAAO1G,WAAWmnC,IAAUnnC;AAI1BonC,kEAAiBriB,IAAIre,CAArB1G,MAIJonC,0DAAiBnzB,IAAIvN,CAArB1G,GACAwG,QAAQxG,KAAK0G,CAAb1G;MAnBgBA;ACRZC,qDAAAA,SAAgBwR,GAAWE,GAAS1R;AACxCA,eAAOA,MAAMwR,IAAIxR,MAAM0R,IAAI1R;MADaA;AAiBpCC,qDAAAA,SAAgBmnC,GAAiBC,GAAgBpnC;AACrDA,eAAOA,MAAMmnC,IAAUC,EAAO79B,KAAKvJ,EAAZA;MAD8BA;sDAcjDC,SAAiBsR,GAAWE,GAASxR;AACzCA,eAAOA,QAAQsR,IAAItR,MAAMwR,IAAIxR;MADYA;AAcrCC,sDAAAA,SAAiBk0B,GAAYG,GAAUr0B;AAC3CA,eAAOA,QAAQk0B,IAAKl0B,MAAMq0B,IAAKr0B;MADYA;AAcvCC,sDAAAA,SAAiBi0B,GAAYG,GAAUp0B;AAC3CA,eAAOA,QAAQi0B,IAAKj0B,MAAMo0B,IAAKp0B;MADYA;AAcvCC,oDAAAA,SAAegnC,GAAgBhnC;AACnCA,eAAOA,OAAOgnC,EAAO79B,KAAKnJ,EAAZA;MADqBA;AAiB/BC,0DAAAA,SAAqB8mC,GAAiB7E,GAAWjiC;AACrDA,eAAOA,MAAM8mC,IAAU9mC,MAAMiiC,IAAMjiC;MADkBA;mDAiBjDC,SACJ6mC,GACAE,GACAC,GACAvnC,GAAaO;AAEbA,eAAO6mC,IAAU7mC,MAAMgnC,IAAShnC,MAAMgnC,IAAShnC,MAAM+mC,IAAQtnC;MAFhDO;AC/GTxS,uDAAAA,SACJuX,GACAkiC,GAA4Cz5C;AAEnCA,iDAAkB2X,qCAAK2mB,MAAM/mB,EAAK6B,SAALpZ,GAAiBy5C,CAAvDz5C;MAF4CA;AAUxCE,yDAAAA,SAAqBqX,GAAYrX;AAC5BA,mDAAoByX,qCAAK2mB,MAAM/mB,CAAxCrX;MADqCA;wDCiCjCuS,SACJinC,GAAejnC;AAEfA,cAAMknC,IAAuCD,EAC1ChlB,gBAD0CjiB,EAE1CkiB,cAF0CliB,EAG1C1R,OAAQ64C,OAAMnnC,CAACmnC,EAAEC,eAAFpnC,CAH2BA,EAI1C+H,IAAKo/B,OAAMnnC,CACVmnC,EAAE1kB,QAAFziB,GACAmnC,EAAE9kB,cAAFriB,EAAkB+H,IAAKs/B,OAAOA,EAAG5kB,QAAHziB,CAA9BA,GACAA,KAHUA,CAJ+BA;AAS7CinC,UAAKK,gBAAgBtnC,0BAA0BA,KAA/CA,EAAsDunC,QAASljB,OAAKrkB;AAC9DA,WAAC5B,qEAAiBimB,CAAjBrkB,KAAuBhM,sFAA0BqwB,CAA1BrkB,KAC1BknC,EAAmB3/B,KAAK8c,EAAEtF,gBAAF/e,CAAxBA;QAFgEA,CAApEA;AAMAA,cAAMwnC,IAAqCP,EACxChlB,gBADwCjiB,EAExCkiB,cAFwCliB,EAGxC1R,OAAQ64C,OAAMnnC,CAACA,CAACmnC,EAAEC,eAAFpnC,CAHwBA,EAIxC+H,IAAKo/B,OAAMnnC,CACVmnC,EAAE1kB,QAAFziB,GACAmnC,EAAE9kB,cAAFriB,EAAkB+H,IAAKs/B,OAAOA,EAAG5kB,QAAHziB,CAA9BA,GACAA,IAHUA,CAJ6BA;AAS3CinC,UAAKK,gBAAgBtnC,wBAAwBA,KAA7CA,EAAoDunC,QAASljB,OAAKrkB;AAC5DA,WAAC5B,qEAAiBimB,CAAjBrkB,KAAuBhM,sFAA0BqwB,CAA1BrkB,KAC1BwnC,EAAiBjgC,KAAK8c,EAAEtF,gBAAF/e,CAAtBA;QAF8DA,CAAlEA;AAKAknC,UAAmB9mB,KAAKngB,qDAAxBD;AACAwnC,UAAiBpnB,KAAKngB,qDAAtBD;AACAA,eAAOA,CAACknC,GAAoBM,CAArBxnC;MAjCQA;8DA4CjBC,SAA6BwnC,GAAoBC,GAAkBznC;AACjEA,eAAOwnC,EAAGxnC,CAAHA,EAAM0nC,cAAcD,EAAGznC,CAAHA,GAAOkI,QAAWlI,EAAC2nC,aAAa3nC,OAAdA,CAAtCA;MAD0DA;AAa7D4nC,QAAAA,kDAAAA,SAAwB9iC,GAAc7K,GAAY2tC;AACtDA,YAAI3tC,EAAM4tC;AAERD,iBAAO9iC;AAGT8iC,aADA9iC,IAAOA,KAAQqc,EAAAA,+BAAAymB,eAAsBA,WAC9BA,CAAC3nC,8CAAY6E,GAAM7K,EAAMmR,WAAWnR,CAAnC2tC,KAA2CA;AAEjDA,gBAAMxvB,IAAItT,EAAKuT,MAAMuvB,cAAXA;AAIR9iC,cAHGsT,IAGIA,EAAEwvB,CAAFA,KAAQzvB,SAASC,EAAEwvB,CAAFA,CAATA,IAAiBA,KAFhC9iC,IAAQ8iC;QAJuCA;AASnDA,eAAO9iC;MAf+C8iC;sDA2BxD3nC,SACE6E,GACAsG,GACA08B,GAAmB7nC;AAEnBA,eAAOA,CAACC,6CAAW4E,GAAMsG,GAAW08B,CAA5B7nC;MAFWA;qDAcfC,SACJ4E,GACAsG,GACA08B,GAAmB5nC;AAEnBA,mBAAWjG,KAASmR,EAAU8T,aAAahf,KAAvBA;AAClBA,cAAIjG,MAAU6tC,KAGZ/zC,sFAA0BkG,CAA1BiG,KACA6nC,EAAAA,mCAAMC,OAAO/tC,EAAM6kB,gBAAN5e,EAAwBA,CAAxBA,GAA4B4E,CAAzC5E;AAEAA,mBAAOA;AAIL+nC,YACJH,KAAe3pC,qEAAiB2pC,CAAjB5nC,IACXA,QAAA4nC,IAAA5nC,SAAA4nC,EAAavF,kBAAbriC,IACAgI;AACNhI,mBAAWgoC,KAAS98B,EAAU4W,gBAAV9hB,EAA4B+hB,cAA5B/hB;AAClBA,cAAIgoC,MAAUD,KACVF,EAAAA,mCAAMC;YAAOE,EAAM1lB,QAANtiB;YAAiB4E;UAA9B5E;AAAqCA,mBAAOA;AAElDA,eAAOA;MArBYA;QA8BfioC,2CAAAA,SAA8BrjC,GAAYqjC;AAC9CA,YAAMluC,IAAQkuC,KAAKzd,eAALyd;AACdA,YAAIA,CAACluC;AACHkuC,gBAAMA,IAAIC;AAIZtjC,YAAOA,EAAKI,KAALijC;AAEPA,cAAME,IAAYT,EAAAA,gDAAc9iC,GAAM7K,CAApBkuC;AACdhqC,6EAAiBlE,CAAjBkuC,KAA2BA,CAACluC,EAAMguB,kBAANkgB,KAC9BluC,EAAMsoC,kBAAN4F,EAA0BG,QAAQD,CAAlCF;AAEFA,cAAMpmB,IAAUomB,KAAKI,SAALJ;AAChBA,YAAIpmB,MAAYjd,KAAQid,MAAYsmB;AAGlCF,eADMz5B,IAASzU,EAAMmR,UAAU8T,aAAaipB,KAA7BA,GACN3gC,IAAI2gC,GAAG3gC,IAAIkH,EAAOxH,QAAQM,KAAK2gC;AAEtCA,kBAAMK,IAAiB95B,EAAOlH,CAAP2gC;AACnBK,cAAexpB,mBACjBwpB,EAAexpB,gBAAgB+C,GAAmBsmB,CAAlDF;UAJoCA;AAQ1CA,eAAOE;MAzBuCF;yDAkC1Cl0C,SAAyBmX,GAAuBnX;AAmDpDw0C,iBAASA,EACPC,GACAC,GAAoB10C;AAEpBA,mBAASuT,IAAIvT,GAAGuT,IAAIkhC,EAAcxhC,QAAQM,KAAKvT;AAC7CA,gBAAM6Q,IAAO4jC,EAAclhC,CAAdvT,EAAiBA,CAAjBA;AACbA,kBAAM20C,IAAOF,EAAclhC,CAAdvT,EAAiBA,CAAjBA,GAMPgG,IAAiBqY,EAAAA,+CAAcre,OAAvBA;AACdgG,cAAM4T,aAAa5Z,QAAQ00C,CAA3B10C;AACAgG,cAAM4T,aAAa5Z,OAAOA,IAA1BA;AACAA,kBAAM+mC,IAAoB1oB,EAAAA,+CAAcre,UAAvBA;AACjB+mC,cAASntB,aAAa5Z,QAAQ6Q,CAA9B7Q;AACAgG,cAAMwY,YAAYuoB,CAAlB/mC;AACAA,iBAAS6nB,IAAI7nB,GAAG6nB,IAAI8sB,EAAK1hC,QAAQ4U,KAAK7nB;AACpCA,oBAAM40C,IAAev2B,EAAAA,+CAAcre,KAAvBA;AACZ40C,gBAAIh7B,aAAa5Z,QAAQ20C,EAAK9sB,CAAL7nB,CAAzBA;AACA+mC,gBAASvoB,YAAYo2B,CAArB50C;YAHoCA;AAKtC2rB,cAAQtY,KAAKrN,CAAbhG;UAnB6CA;QAF3BA;AApDtBA,cAAM2rB,IAAU3rB,CAAAA;AAChBA,YAAI4a,qCAAA5a,wBAAkCA;AAIpCA,cAAMgG,IAAiBqY,EAAAA,+CAAcre,OAAvBA;AACdgG,YAAM4T,aAAa5Z,QAAQA,wBAA3BA;AACAgG,YAAM4T,aAAa5Z,OAAOA,IAA1BA;AACAA,cAAM60C,IAAqBx2B,EAAAA,+CAAcre,OAAvBA;AAClB60C,YAAUj7B,aAAa5Z,QAAQA,MAA/BA;AACA60C,YAAUr2B,YACCD,EAAAA,gDAAe2O,EAAAA,+BAAAltB,gCAAxBA,CADFA;AAGAgG,YAAMwY,YAAYq2B,CAAlB70C;AACA2rB,YAAQtY,KAAKrN,CAAbhG;QAboCA;AAelC4a,6CAAA5a,yBAIIgG,IAAiBqY,EAAAA,+CAAcre,OAAvBA,GACdgG,EAAM4T,aAAa5Z,QAAQA,sBAA3BA,GACAgG,EAAM4T,aAAa5Z,OAAOA,IAA1BA,GACM60C,IAAqBx2B,EAAAA,+CAAcre,OAAvBA,GAClB60C,EAAUj7B,aAAa5Z,QAAQA,MAA/BA,GACA60C,EAAUr2B,YACCD,EAAAA,gDAAe2O,EAAAA,+BAAAltB,8BAAxBA,CADFA,GAGAgG,EAAMwY,YAAYq2B,CAAlB70C,GACA2rB,EAAQtY,KAAKrN,CAAbhG;AAEE4a,6CAAA5a,wBAEIgG,IAAiBqY,EAAAA,+CAAcre,OAAvBA,GACdgG,EAAM4T,aAAa5Z,QAAQA,qBAA3BA,GACAgG,EAAM4T,aAAa5Z,OAAOA,IAA1BA,GACA2rB,EAAQtY,KAAKrN,CAAbhG;AAEE2rB,UAAQ1Y,UAEV0Y,EAAQA,EAAQ1Y,SAASjT,CAAzBA,EAA4B4Z,aAAa5Z,OAAOA,IAAhDA;AAqCIuvC,YAAQzjC,gDAAcqL,CAAdnX;AACdw0C,UAAmBjF,EAAMvvC,CAANA,GAAUA,yBAA7BA;AACAw0C,UAAmBjF,EAAMvvC,CAANA,GAAUA,uBAA7BA;AACAA,eAAO2rB;MAjF6C3rB;8DA2FtDkM,SAA6BiL,GAAuBjL;AAClDA,YAAMugB,IAAYvgB,CAAAA,GACZuO,IAAStD,EAAUi8B,gBAAgBlnC,yBAAyBA,KAAnDA;AACfA,iBAASqH,IAAIrH,GAAGlG,GAAQA,IAAQyU,EAAOlH,CAAPrH,GAAYqH;AAC1CkZ,YAAUpZ,KAAKrN,EAAM6rC,cAAc3lC,MAApBA,CAAfA;AAGI4oC,YAAsBz2B,EAAAA,+CAAcnS,KAAvBA;AACnBA,cAAM6oC,IAAoB12B,EAAAA,+CAAcnS,OAAvBA;AACjB6oC,UAASn7B,aAAa1N,QAAQA,uBAA9BA;AACAA,cAAM2oC,IAAqBx2B,EAAAA,+CAAcnS,OAAvBA;AAClB2oC,UAAUj7B,aAAa1N,QAAQA,MAA/BA;AACM8oC,YAAqB50C;UACzB60C,EAAAA;UACAxoB;QAFevgB;AAIXgpC,YAAwB32B,EAAAA,gDAAey2B,CAAxB9oC;AAErB2oC,UAAUr2B,YAAY02B,CAAtBhpC;AACA6oC,UAASv2B,YAAYq2B,CAArB3oC;AACA4oC,UAAWt2B,YAAYu2B,CAAvB7oC;AAEAiL,UAAUg+B,cAAcL,CAAxB5oC;MAtBkDA;8DAgC9CC,SAA8BiH,GAAWjH;AAC7CA,YAAIiH,EAAExC,SAAoByF,mDAKKlK,cAFXiH,EAEJgiC,cAFIhiC,EAEoCiiC,UAFpCjiC,EAGLyB,SAFf1I;AAOMnG,cACHpL,+CATiBwY,EAOYI,WAClBrH,EAEXqL,aAViBpE,EAUQyB,OAFd1I;AAGdA,cAAMyE,IAAO5K,EAAM4K;AACnBzE,cAAaA,6BAATyE,KAA8CzE,2BAATyE;AAGnCuG,gBACJnR,EAAMyxB,QAAQ4Y,EAAAA,sDAAYiF,IAA1BnpC,EACAopC,aADAppC,GAEFD,sDAAoBiL,CAApBhL,GACAgL,EAAUq+B,kBAAkBppC,uDAA5BD;QAlBAA;MAL6CA;gEA+B/CC,SAA+BgH,GAAWhH;AACxCA,YACEgH,EAAExC,SAAoBglB,EAAAA,8CACtBxiB,EAAExC,SAAoB6kC,EAAAA,8CACtBriC,EAAExC,SAAoB8kC,EAAAA,8CACtBtiC,EAAExC,SAAoB+kC;AAKlBx+B,cAAmBvc,+CADLwY,EAAEI,WACJpH,GAClBF,sDAAoBiL,CAApB/K;MAXwCA;qDAqBpCC,SAAqBwE,GAAcsG,GAAoB9K;AAC3DA,eAAO8K,EAAU8T,aAAa5e,KAAvBA,EAA8BjS,OAAQ4L,OAEzCsG,yDAAuBtG,GAAO6K,CAA9BxE,KACCtM,uFAA2BiG,CAA3BqG,KACCynC,EAAAA,mCAAMC,OAAO/tC,EAAM8kB,iBAANze,GAA0BwE,CAAvCxE,CAJCA;MADoDA;iEAc7DC,SAAgCtG,GAAc4vC,GAAgBtpC;AAC5DA,eACEpC,qEAAiBlE,CAAjBsG,KACAA,CAACtG,EAAMwoC,eAANliC,KACDtG,EAAMsoC,kBAANhiC,KACAwnC,EAAAA,mCAAMC,OAAO/tC,EAAMsoC,kBAANhiC,EAA0BiiB,QAA1BjiB,GAAqCspC,CAAlDtpC;MAL0DA;QAexDupC,kDAAAA,SAAwBC,GAAeD;AAC3CA,cAAME,IAA2B/7C,kDAAX67C;AAEtBA,YAAMhlC,IADiBilC,EACKjrB,gBAAfgrB,EAAiCA,CAAjCA;AACbA,cAAMf,IAAagB,EAASvhB,cAAeshB,IAAxBA;AACbG,YAAU3pC,6CAAWwE,GAAMilC,EAAS3+B,SAA1B0+B;AAChBA,iBAAStiC,IAAIsiC,GAAGI,GAASA,IAASD,EAAQziC,CAARsiC,GAAatiC,KAAKsiC;AAE5CK,eADAC,IAAiBF,EAAO1hB,cAAPshB,MACwBt3C,2CAAU43C,CAAnBN;AAClCI,YAAOzf,iBACTyf,EAAOzf,cAAcse,CAArBe;AAEFA,cAAMO,IAAiBH,EAAO1hB,cAAPshB;AACjBQ,cAAcD,KAA2B73C,2CAAU63C,CAAnBP;AAClCK,gBAAgBG,MAIP1jC,EAAAA,kDAAckjC,KAAzBA,GACW57C,yCACT47C,KAAgBn7C,wCAAeg7C,EAAAA,0CAA1BG,GACHI,GACAJ,YACAA,MACAK,GACAG,CALFR,CADFA,GASWljC,EAAAA,kDAAcojC,CAAzBF;QAtBgDA;MANTA;QAwCvCS,kDAAAA,SACJzlC,GACAsG,GAAoBm/B;AAKpBA,mBAAWtwC,KAASmR,EAAU8T,aAAaqrB,KAAvBA;AAQlBA,cANEpsC,qEAAiBlE,CAAjBswC,KACAtwC,EAAMwoC,eAAN8H,KACAxC,EAAAA,mCAAMC,OAAO/tC,EAAMsoC,kBAANgI,EAA0B/nB,QAA1B+nB,GAAqCzlC,CAAlDylC,KAKAx2C,sFAA0BkG,CAA1BswC,KACAxC,EAAAA,mCAAMC,OAAO/tC,EAAM6kB,gBAANyrB,EAAwBA,CAAxBA,GAA4BzlC,CAAzCylC;AAEAA,mBAAOtwC;AAGXswC,eAAOA;MApBaA;yEC5XhB/pC,SAAyBgqC,GAAYhqC;AACzCA,eAAQgqC,EAAuBC;MADUjqC;AAKrCC,sEAAAA,SAAsB+pC,GAAY/pC;AACtCA,eACoCyH,WAAjCsiC,EAAoBE,YACWxiC,WAA/BsiC,EAAoBG;MAHelqC;AAQlCC,kEAAAA,SAAkB8pC,GAAY9pC;AAClCA,eACgCwH,WAA7BsiC,EAAgBI,YACc1iC,WAA9BsiC,EAAgBK;MAHenqC;8DC4mBpCC,SAA6BmqC,GAAmBC,GAAkBpqC;AAChEA,YAAIA,CAACmqC,KAASnqC,CAACoqC;AACbpqC,gBAAMwE,MAAMxE,kCAANA;AAERmqC,UAAME,mBAAmBD;AACzBA,UAAOC,mBAAmBF;MALsCnqC;AAiBlEC,8DAAAA,SACE3G,GACAgxC,GAAkBrqC;AAElBA,YAAIsqC,IAAkBtqC;AAChBuqC,YAASF,EAAY/+B;AAC3BtL,cAAMwqC,IAAcxqC,QAAAuqC,IAAAvqC,SAAAuqC,EAAQE,qBAARzqC;AAEpBA,iBAAS4G,IAAI5G,GAAGmoB,GAAQA,IAAQ9uB,EAAM6uB,UAAUthB,CAAhB5G,GAAqB4G,KAAK5G;AACxDA,gBAAMsoB,IAAaH,EAAMG;AACPkiB,cAAAA;AAAlBxqC,cAAIsoB,MAActoB,SAAAwqC,IAAAA,KAAAxqC,IAAAwqC,EAAaE,WAAWH,GAAQjiB,GAAYtoB,KAA5CA,IAAoDA;AACpEA,gBAAIsqC;AACFtqC,qBAAOA;AAETsqC,gBAAkBhiB;UAJkDtoB;QAFdA;AAS1DA,eAAOsqC;MAfWtqC;yEA6BpBC,SACE0qC,GACAN,GAAkBpqC;AAGlBA,YAAIqoB;AACJroB,eAAQqoB,IAAatoB,sDAAoBspB,GAAU+gB,CAA9BpqC;AAEnBA,cADAqpB,IAAWhB,EAAWK,YAAX1oB,GACPA,CAACqpB,KAAYA,EAASV,SAAT3oB;AACfA,mBAAOqoB;AAGXroB,eAAOA;MAVWA;wDC5qBdC,SAAiB+a,GAAQ/a;AAC7BA,eACkBoH,WAAhB2T,EAAI+M,WACa1gB,WAAjB2T,EAAI2vB,YACYtjC,WAAhB2T,EAAI7hB,WACckO,WAAlB2T,EAAI4vB,aACYvjC,WAAhB2T,EAAIrqB,WACgB0W,WAApB2T,EAAI6vB,eAC2BxjC,WAA/B2T,EAAI8vB,0BACmBzjC,WAAvB2T,EAAI+vB,kBACoB1jC,WAAxB2T,EAAIgwB,mBACyB3jC,WAA7B2T,EAAIiwB,wBACqB5jC,WAAzB2T,EAAIkwB,oBACqB7jC,WAAzB2T,EAAIyQ,oBACYpkB,WAAhB2T,EAAImwB;MAduBlrC;uECrEzBC,SAAwB8a,GAAW9a;AACvCA,eACED,gDAAO+a,CAAP9a,KACA1J,yDAAUwkB,CAAV9a,KACAhL,gEAAe8lB,CAAf9a,KAC4BmH,WAA3B2T,EAAA9a,WAC2BmH,WAA3B2T,EAAA9a,WACiCmH,WAAjC2T,EAAA9a,iBACiCmH,WAAjC2T,EAAA9a,iBACD8a,EAAI+M,QAAJ7nB,MAAkBq6B,iDAASC;MATUt6B;yEC00BzCC,SAA6B/G,GAAY+G;AACvCA,YAAIirC,IAAgBhyC,EAAMiS;AAC1BlL,YACEA,CAACirC,KACAhyC,EAAMkS,sBAAsBlS,EAAMkS,mBAAmBszB,YAAzBz+B;AAE7BirC,cAAgBhyC,EAAMkS;AAExBnL,eAAOirC;MARgCjrC;ACvzBnC1T,yEAAAA,SAAmBwX,GAAconC,GAAuB5+C;AACnDA,iDAAkB2X,qCAAKknC,UAAUrnC,GAAMonC,CAAhD5+C;MAD4DA;2EASxDE,SAAqBsX,GAAYtX;AAC5BA,mDAAoByX,qCAAKknC,UAAUrnC,CAA5CtX;MADqCA;AAcjCyT,qEAAAA,SACJ6D,GACAsnC,GACAC,GAAyDprC;AAGnDqrC,YAAWrrC,KADctT,yCAAkBsX,qCAAKknC,UAAUrnC,CAA1ConC,GACcpnC,CAAnB7D;AACjBqrC,UAASrrC,KAAKmrC,GAAOC,CAArBprC;AACAA,eAAOqrC;MALkDrrC;0EC1C3DC,SAAkCyP,GAAoBzP;AAC1C5M,qEACRqc,EAAOmP,mBAAP5e,GACAgH,QACAhH,QAHFA;MADoDA;AAetDC,0EAAAA,SAAkCwP,GAAoBxP;AAC1C7M,qEACRqc,EAAOmP,mBAAP3e,GACA+G,QACA/G,QAHFA;MADoDA;0EAetDC,SAAkCuP,GAAoBvP;AAC1C9M,qEACRqc,EAAOmP,mBAAP1e,GACA8G,QACA9G,QAHFA;MADoDA;gEAiBhDnN,SAAyBmX,GAAuBnX;AACpDA,YAAI2rB,IAAU3rB,CAAAA,GACV0c,IAAS0B,SAASC,cAAcre,QAAvBA;AACb0c,UAAO9C,aAAa5Z,QAAQktB,EAAAA,+BAAAltB,mBAA5BA;AACA0c,UAAO9C,aAAa5Z,eAAeA,wBAAnCA;AACA2rB,UAAQtY,KAAKqJ,CAAb1c;AACA0c,YAAS0B,SAASC,cAAcre,QAAvBA;AACT0c,UAAO9C,aAAa5Z,QAAQktB,EAAAA,+BAAAltB,mBAA5BA;AACA0c,UAAO9C,aAAa5Z,eAAeA,wBAAnCA;AACA2rB,UAAQtY,KAAKqJ,CAAb1c;AACA0c,YAAS0B,SAASC,cAAcre,QAAvBA;AACT0c,UAAO9C,aAAa5Z,QAAQktB,EAAAA,+BAAAltB,mBAA5BA;UACO4Z,aAAa5Z,eAAeA,wBAAnCA;AACA2rB,UAAQtY,KAAKqJ,CAAb1c;AAEAmX,UAAUyU,uBACR5rB,0BACAiN,iEAFFjN;AAIAmX,UAAUyU,uBACR5rB,0BACAkN,iEAFFlN;AAIAmX,UAAUyU,uBACR5rB,0BACAmN,iEAFFnN;AAKM8rB,YAAY7rB,8DAAqBkX,CAArBnX;AAElBA,eADA2rB,IAAUA,EAAQlW,OAAOqW,CAAf9rB;MA7B0CA;sEAuChDC,SAA+BkX,GAAoBlX;AACjD8rB,YAAoB5U,EAAU0W,gBAAV5tB;AAE1BA,cAAM0rB,IAAU1rB,CAAAA;AAChBA,YAA+BA,IAA3B8rB,EAAkB9Y,QAAYhT;AAChCA,cAAI2a,qCAAA3a,uBAAiCA;AACnCA,gBAAMq4C,IAAgBvsB,EAAkBA,EAAkB9Y,SAAShT,CAA7CA;AACtBA,kBAAM+F,IAAYqY,EAAAA,+CAAcpe,OAAlBA;AACd+F,cAAM4T,aAAa3Z,QAAQA,uBAA3BA;AACA+F,cAAM4T,aAAa3Z,OAAOA,IAA1BA;AACA+F,cAAMwY,YAAsB5d,0DAAyB03C,CAAnCr4C,CAAlBA;AACA0rB,cAAQtY,KAAKrN,CAAb/F;UANmCA;AAQrCA,cAAI2a,qCAAA3a,uBAAiCA;AACnC8rB,cAAkBG,KAAKC,oDAAcC,aAArCnsB;qBACSsT,IAAItT,GAAGorB,GAAWA,IAAWU,EAAkBxY,CAAlBtT,GAAuBsT;AACrDvN,kBAAYqY,EAAAA,+CAAcpe,OAAlBA,GACd+F,EAAM4T,aAAa3Z,QAAQA,uBAA3BA,GACA+F,EAAM4T,aAAa3Z,OAAOA,GAA1BA,GACA+F,EAAMwY,YAAsB5d,0DAAyByqB,CAAnCprB,CAAlBA,GACA0rB,EAAQtY,KAAKrN,CAAb/F;UAPiCA;QATLA;AAoBlCA,eAAO0rB;MAxBgD1rB;ACmxEnDmN,+DAAAA,SAA4B+J,GAAuB/J;AACvD+J,UAAUkZ,eAAVjjB;MADuDA;6ECh0EnDC,SACJrH,GACA4b,GAA4BvU;AAE5BA,cAAM8J,IAAYnR,EAAMmR,WAClBivB,IAAaD,EAAAA,qCAAOC,YACpBmS,IAAan2B,mDAAWkD,WAC5B1D,GACA5b,EAAMuqB,uBAANljB,CAFiBA,GAIb8V,IAAS9V,IAAI+U,mDAAW/U,GAAGA,CAAlBA,GAETylB,IAAc3b,EACjB8T,aAAa5d,KADIA,EAEjBjT,OAAQo+C,OAAeA,EAAWvhC,MAAMjR,EAAMiR,EAF7B5J,EAGjBwG,IAAKsc,OAAMA,EAAEI,uBAAFljB,CAHMA;AAKpBA,eACEC,wEACE8U,mDAAW8Q;UAAItR;UAAkBuB;QAAjC9V,GACAylB,CAFFzlB,KAIAE,kEAAoBvH,GAAOoc,mDAAW8Q,IAAIqlB,GAAYp1B,CAA3B9V,GAAoC+4B,CAA/D/4B;AAEI8J,YAAU0R,MACZ1F,EAAOgQ,UAAU9lB,CAAC+4B,GAAyB/4B,IAAb+4B,CAA9B/4B,IAEA8V,EAAOgQ,UAAUiT,GAAyB/4B,IAAb+4B,CAA7B/4B;AAIJrH,UAAOwF,OAAO4W,mDAAW8Q,IAAItR,GAAkBuB,CAAjC9V,CAAdA;MA7B4BA;AAoC9BC,gFAAAA,SACEulB,GACAC,GAAyBxlB;AAEzBA,eAAOwlB,EAAYzE,KAChBgF,OACqC/lB,KAApCwW,KAAKwP,IAAID,EAAWvW,IAAI+V,EAAM/V,CAA9BxP,KACoCA,KAApCwW,KAAKwP,IAAID,EAAWrW,IAAI6V,EAAM7V,CAA9B1P,CAHGA;MAFkBA;0EAc3BC,SACEvH,GACAmd,GACAijB,GAAkB74B;AAElBA,eAAOvH,EACJyyC,gBAAgBlrC,KADZA,EAEJ8gB,KAAM4G,OAAe1nB,CAACA,CAAC0nB,EAAWyjB,QAAQtS,GAAYjjB,CAA/B5V,EAAuC0nB,UAF1D1nB;MAFWA;iECjGpBC,SACE2J,GACAwhC,GACA3Z,GAAuBxxB;AAGvBA,cAAMorC,IAAgB5Z,EAAO6Z,qBAAPrrC,GAEhBgM,IAAQo/B,EAAc91B,QAAQ81B,EAAcx3B,MAY5C7D,IALyBha,wCALdo1C,EAAOx3B,KAOtBy3B,EAAcz3B,KANKw3B,EAAOx3B,MAAMw3B,EAAOj/B,UAJ1Bk/B,EAAc71B,SAAS61B,EAAcz3B,IAQ/B23B,IAKSF,EAAcz3B;AAI5C3T,YAAIurC,IAAYJ,EAAOv3B;AAEnB43B,YADgBL,EAAOv3B,OAAOu3B,EAAOn/B,QACVA;AAC3BrC,UAAU0R,MAIZkwB,IAAYj1B,KAAKC,IAAIi1B,GAAYD,CAArBvrC,IAKZwrC,IAAal1B,KAAKE,IAAI+0B,GAAWC,CAApBxrC;AASfA,gBAFM8P,IALyB/Z,wCAC7Bw1C,GACAH,EAAcx3B,MACd43B,CAHmBC,IAKSL,EAAcx3B,SAE9B7D,KACZyhB,EAAOvzB,OAAO6R,GAAQC,GAAQ/P,CAACA,UAADA,CAA9BA,GACOA,QAEFA;MA9CgBA;kEAwDnBC,SACJ0J,GAAuB1J;AAEvBA,eAAQ2F,OAAK3F;AACXA,cAAMyrC,IAAiB/hC,EAAUgiC,kBAAV1rC;AACvBA,cAAKyrC,EAAeE,cAAf3rC,KAAkCA,CAAA0J,EAAUgB,WAAV1K,GAAvCA;AAIsCmD,gBAAAA;AAAtCnD,gBAAe4rC,gDAAY90B,SAAW3T,SAAAA,IAAFwC,EAAExC,QAAAA,IAAQnD,EAA1CA,GAA+CA;AAC3C6rC,kBAA0BJ,EAAeK,iBAAiB9rC,IAAhCA;AAGhCA,oBAAMuxB,IAAStxB,2DACbyJ,GACA/D,CAFa3F;AAIVuxB,oBAICtJ,IAA2Bhf,EAAAA,6CAAXjJ,KAAyBA,OACpCkJ,EAAAA,6CAASvD,EAAEY,KAAtBvG,GAEkBD;gBAChB2J;gBACAmiC;gBACAta;cAHgBwa,KAMD/rC,CAAC2F,EAAEY,SAClBnC,QAAQxG,KACNoC,2EADFA,GAKSkJ,EAAAA,6CAAS+e,CAApBjoB;YA3BiDA;AA4BxC2F,gBAAExC,SAAoBkF,uDACT1C,EAEN8C,SAFM9C,EAGN+C,YAHM/C,EAIN8C,QAJM9C,EAIgB+C,YAEpCxI,6DAAyBwJ,CAAzB1J;UAvCJA;QAFWA;MAFUA;mEA0DzBC,SACEyJ,GACA/D,GAAuB1F;AAEvBA,YAAIsxB,IAAStxB;AACbA,gBAAQ0F,EAAExC,MAAVlD;UACEA,KAAgBkoB,EAAAA;UAChBloB,KAAgB+rC,EAAAA;AAEd/rC,aADAsxB,IAAS7nB,EAAUK,aAAcpE,EAA8ByB,OAAtDnH,OAEPsxB,IAASA,EAAO0a,aAAPhsC;AAEXA;UACFA,KAAgBisC;UAChBjsC,KAAgBksC;AACd5a,gBAAS7nB,EAAU0iC,eAChBzmC,EAAkC0mC,SAD5BpsC;QAVbA;AAeAA,eAAOsxB;MAlBgBtxB;qEA0BnBC,SAAmCwJ,GAAuBxJ;AAC9DA,YAAMurC,IAAiB/hC,EAAUgiC,kBAAVxrC;AACvBA,YAAKurC,EAAeE,cAAfzrC,KAAkCA,CAAAwJ,EAAUgB,WAAVxK,GAAvCA;AAIM2rC,cAA0BJ,EAAeK,iBAAiB5rC,IAAhCA;AAChCA,cAAMosC,IAAY5iC,EAAU6iC,sBAAVrsC;AAClBA,mBAAS4F,IAAI5F,GAAG3H,GAAQA,IAAQ+zC,EAAUxmC,CAAV5F,GAAe4F;AAC7C/F,qEAAqB2J,GAAWmiC,GAAyBtzC,CAAzD2H;QAPFA;MAF8DA;ACvJ1DC,kEAAAA,SAAsBga,GAAQha;AAClCA,eACyBqG,WAAvB2T,EAAAha,eACmBqG,WAAnB2T,EAAAha,WAC0BqG,WAA1B2T,EAAAha;MAJgCA;sDCJpCC,SAA2CosC,GAAoBpsC;AAC7DA,cAAMumB,IAAO6lB,EAAOC,WAAPrsC;AACbssC,2DAAkB/lB;AACiBjd,YAAAA;AAAnCijC,4DAAmCjjC,SAAAA,IAAf8iC,EAAe9iC,aAAAA,IAAatJ;AAChDA,eAAOumB;MAJsDvmB;+CAqCzDC,SACJusC,GACAljC,GACAmjC,GAAuBxsC;AAEvBA,eAAKusC,KAAaljC,IAIXpJ,+CAAcssC,GAAUljC,GAAWmjC,CAAnCxsC,IAHAqsC,oDAAoBC,oDAClBrsC,+CAAcosC,kDAAiBC,iDAA/BtsC,IAD2CA;MAH7BA;uDAiBzBC,SACEssC,GACAljC,GACAmjC,GAAuBvsC;AAEXA,YAAAA;AAAZoJ,YAAYpJ,SAAAA,IAAAoJ,EAAUojC,iBAAVxsC,KAAAA,IAAgCoJ;AACpCpJ,YAAAA,GAAAA;AAARA,eAAQA,SAAAA,IAAAA,SAAAA,IACLpU,0CAAyBqX,qCAAK4hB,QAAQynB,EAAS1nB,QAAQ5kB,KADlDA,KAAAA,SAAAA,EAEJD,MAAMusC,GAAUljC,GAAWmjC,CAFvBvsC,KAAAA,IAEsCA;MALvBA;AAWzBC,2DAAAA,SAGEwsC,GAAcxsC;AACdA,cAAMomB,IAAOomB,EAAYN,WAAZlsC;AACbA,eAAKomB,IACEtmB,uCAAMsmB,GAAMomB,EAAYrjC,SAAxBnJ,IADWA;MAFJA;gECrEVC,SAAqB2Z,GAAQ3Z;AACjCA,eAA0BgG,WAAnB2T,EAAIsyB;MADsBjsC;ACU7BC,6DAAAA,WAAwBA;AAc5BusC,kEAAiBC,SAASrhD,SAbashD,EACrC9pC,MAAMswB,4CAAMyZ,QACZC,eAAe1jC,GAASjJ;AACtBA,iBAAOA,CAACiJ,EAAU/E,QAAQ0oC;QADJ5sC,GAGxB8N,SAAS7E,GAASjJ;AAGfiJ,YAAiCxG,UAAjCzC;AACDA,iBAAOA;QAJSA,GAMlB6sC,UAAU7sC,CAAC8sC,+CAASC,GAAV/sC,EAX2BysC,CAavCzsC;MAd4BA;6DAoBxBC,WAAwBA;AA+B5BssC,kEAAiBC,SAASrhD,SA9Be6hD,EACvCrqC,MAAMswB,4CAAMga,QACZN,eAAe1jC,GAAShJ;AACtBA,gBAAMqK,IAAkBtd,0CAAPiT;AACjBA,iBACEA,CAACgJ,EAAU/E,QAAQ0oC,YACP3sC,QAAZqK,KACA5K,0DAAY4K,CAAZrK,KACAqK,EAAS5K,YAATO,KACAA,CAACitC,uCAAQC,WAARltC;QAPmBA,GAUxB6N,SAAS7E,GAAW/D,GAACjF;AAKnBiF,YAAE4yB,eAAF73B;AACMqK,cAAkBtd,0CAAPiT;uBACOmtC,4CACtB9iC,EAAS+iC,eAATptC,IACSP,0DAAY4K,CAAZrK,KAAyBqK,EAAS5K,YAATO,MACvBwI,EAAAA,6CAASxI,IAApBA,GACAqK,EAASzS,QAAToI,GACWwI,EAAAA,6CAASxI,KAApBA;AAEFA,iBAAOA;QAdYA,GAgBrB4sC,UAAU5sC,CAAC6sC,+CAASG,QAAQH,+CAASQ,SAA3BrtC,EA5B6B+sC,CA8BzC/sC;MA/B4BA;2DAyCxBC,WAAsBA;AAC1BA,cAAMqtC,IAAQhB,0DAAiBC,SAASgB,oBAAoBV,+CAASW,GAAGvtC,CACtE4sC,+CAASY,IAD6DxtC,CAA1DA,GAGRytC,IAAOpB,0DAAiBC,SAASgB,oBAAoBV,+CAASW,GAAGvtC,CACrE4sC,+CAASc,GAD4D1tC,CAA1DA,GAGP2tC,IAAQtB,0DAAiBC,SAASgB;UAAoBV,+CAASW;UAAGvtC,CACtE4sC,+CAASgB,IAD6D5tC;QAA1DA;AAmCdqsC,kEAAiBC,SAASrhD,SA/Ba4iD;UACrCprC,MAAMswB,4CAAM+a;UACZrB,eAAe1jC,GAAS/I;AACtBA,kBAAMoK,IAAkBtd,0CAAPkT;AACjBA,mBACEA,CAAC+I,EAAU/E,QAAQ0oC,YACnB1sC,CAACgtC,uCAAQC,WAARjtC,KACWA,QAAZoK,KACA5K,0DAAY4K,CAAZpK,KACAoK,EAAS5K,YAATQ,KACApE,0DAAYwO,CAAZpK,KACAoK,EAASw1B,UAAT5/B,KACAH,wDAAWuK,CAAXpK;UAVoBA;UAaxB4N,SAAS7E,GAAW/D,GAAChF;AAGnBgF,cAAE4yB,eAAF53B;AACA+I,cAAUxG,UAAVvC;AACMoK,gBAAkBtd,0CAAPkT;AACjBA,gBAAIA,CAACoK,KAAYpK,CAACH,wDAAWuK,CAAXpK;AAAsBA,qBAAOA;AAC/CisC,6DAAW7hC,EAAS0hC,WAAT9rC;AACX+tC,kEAAgBhlC;AAChBilC,+DAAapyC,0DAAYwO,CAAZpK,IACToK,EAAS+X,uBAATniB,IACAA;AACJA,mBAAOA,CAACA,CAACisC;UAZUjsC;UAcrB2sC,UAAU3sC,CAACqtC,GAAOI,GAAME,CAAd3tC;QA7B2B6tC,CA+BvC7tC;MA1C0BA;0DAgDtBC,WAAqBA;AACzBA,cAAMguC,IAAQ5B,0DAAiBC,SAASgB,oBAAoBV,+CAASsB,GAAGjuC,CACtE2sC,+CAASY,IAD6DvtC,CAA1DA,GAGRkuC,IAAO9B,0DAAiBC,SAASgB,oBAAoBV,+CAASsB,GAAGjuC,CACrE2sC,+CAASc,GAD4DztC,CAA1DA,GAGPmuC,IAAQ/B,0DAAiBC,SAASgB,oBAAoBV,+CAASsB,GAAGjuC,CACtE2sC,+CAASgB,IAD6D3tC,CAA1DA;kEA8CGqsC,SAASrhD,SA1CYojD,EACpC5rC,MAAMswB,4CAAMub,KACZ7B,eAAe1jC,GAAS9I;AACtBA,gBAAMmK,IAAkBtd,0CAAPmT;AACjBA,iBACEA,CAAC8I,EAAU/E,QAAQ0oC,YACnBzsC,CAAC+sC,uCAAQC,WAARhtC,KACWA,QAAZmK,KACA5K,0DAAY4K,CAAZnK,KACAmK,EAAS5K,YAATS,KACArE,0DAAYwO,CAAZnK,KACAmK,EAASw1B,UAAT3/B,KACAA,CAACmK,EAASrB,UAAWgY;QAVD9gB,GAaxB2N,SAAS7E,GAAS9I;AAChBA,gBAAMmK,IAAkBtd,0CAAPmT;iBAEbmK,aAAoB8iC,6CACtBjB,iDAAW7hC,EAAS0hC,WAAT7rC,GACX8tC,sDAAgBhlC,GAChBilC,mDAAa5jC,EAAS+X,uBAATliB,GACbmK,EAAS+iC,eAATltC,GACOA,QAEPT,0DAAY4K,CAAZnK,KACAmK,EAAS5K,YAATS,KACAJ,wDAAWuK,CAAXnK,KAEAgsC,iDAAW7hC,EAAS0hC,WAAT7rC,GACX8tC,sDAAgBhlC,GAChBilC,mDAAapyC,0DAAYwO,CAAZnK,IACTmK,EAAS+X,uBAATliB,IACAA,MACJmK,EAASzS,QAATsI,GACOA,QAEFA;QAtBSA,GAwBlB0sC,UAAU1sC,CAACguC,GAAOE,GAAMC,CAAdnuC,EAvC0BouC,CA0CtCpuC;MArDyBA;4DA2DrBC,WAAuBA;AAC3BA,cAAMquC,IAAQlC,0DAAiBC,SAASgB,oBAAoBV,+CAAS4B,GAAGtuC,CACtE0sC,+CAASY,IAD6DttC,CAA1DA,GAGRuuC,IAAOpC,0DAAiBC,SAASgB,oBAAoBV,+CAAS4B,GAAGtuC,CACrE0sC,+CAASc,GAD4DxtC,CAA1DA,GAGPwuC,IAAQrC,0DAAiBC,SAASgB;UAAoBV,+CAAS4B;UAAGtuC,CACtE0sC,+CAASgB,IAD6D1tC;QAA1DA;AAmCdmsC,kEAAiBC,SAASrhD,SA/Bc0jD,EACtClsC,MAAMswB,4CAAM6b,OACZnC,eAAe1jC,GAAS7I;AACtBA,iBAAOA,CAAC6I,EAAU/E,QAAQ0oC,YAAYxsC,CAAC8sC,uCAAQC,WAAR/sC;QADjBA,GAGxB0N,WAAQ1N;AACNA,cAAIA,CAAC+rC,kDAAY/rC,CAAC6tC;AAAe7tC,mBAAOA;AACxCA,cAAIA,CAAC8tC;AAGH9tC,mBAAOA,CAACA,CAAWR;cAAMusC;cAAU8B;YAA1B7tC;AAGXA,gBAAMA,EAACA,MAAA8S,GAAM9S,KAAA6S,GAAK7S,OAAAkL,GAAOlL,QAAAoL,EAAnBpL,IAA6B6tC,oDAChChD,kBADgC7qC,EAEhC2uC,eAAe3uC,IAFiBA;AAKnCA,cAFqB4uC,IAAIl6B,uCAAK7B,GAAKA,IAAMzH,GAAQ0H,GAAMA,IAAO5H,CAAzC0jC,EAEJ79B,SAAS+8B,iDAAWt/B,GAAGs/B,iDAAWp/B,CAA/C1O;AAGFA,mBAAOA,CAACA,CAAWR,uCAAMusC,gDAAU8B,mDAA1B7tC;gBAIL6uC,IAAe7uC,IAAI8T,mDAAWhB,IAAO5H,IAAQlL,GAAG6S,IAAMzH,IAASpL,CAAhDA;AACrBA,iBAAOA,CAACA,CAAWR,uCAAMusC,gDAAU8B,qDAAegB,CAAzC7uC;QArBHA,GAuBRysC,UAAUzsC,CAACquC,GAAOE,GAAMC,CAAdxuC,EA5B4ByuC,CA+BxCzuC;MA1C2BA;2DAgDvBC,WAAsBA;AAC1BA,cAAM6uC,IAAQ3C,0DAAiBC,SAASgB,oBAAoBV,+CAASqC,GAAG9uC,CACtEysC,+CAASY,IAD6DrtC,CAA1DA,GAGR+uC,IAAO7C,0DAAiBC,SAASgB,oBAAoBV,+CAASqC,GAAG9uC,CACrEysC,+CAASc,GAD4DvtC,CAA1DA,GAGPgvC,IAAQ9C,0DAAiBC,SAASgB;UAAoBV,+CAASqC;UAAG9uC,CACtEysC,+CAASgB,IAD6DztC;QAA1DA;AAkBdksC,kEAAiBC,SAASrhD,SAdamkD,EACrC3sC,MAAMswB,4CAAMsc,MACZ5C,eAAe1jC,GAAS5I;AACtBA,iBAAOA,CAAC4I,EAAU/E,QAAQ0oC,YAAYvsC,CAAC6sC,uCAAQC,WAAR9sC;QADjBA,GAGxByN,SAAS7E,GAAW/D,GAAC7E;AAElB4I,YAA2BxG,UAA3BpC;AACD4I,YAAUumC,KAAKnvC,KAAfA;AACA6E,YAAE4yB,eAAFz3B;AACAA,iBAAOA;QALYA,GAOrBwsC,UAAUxsC,CAAC6uC,GAAOE,GAAMC,CAAdhvC,EAZ2BivC,CAcvCjvC;MAzB0BA;2DAgCtBC,WAAsBA;AAC1BA,cAAMmvC,IAAalD,0DAAiBC,SAASgB,oBAAoBV,+CAASqC,GAAG7uC,CAC3EwsC,+CAAS4C,OACT5C,+CAASY,IAFkEptC,CAA1DA,GAIbqvC,IAAYpD,0DAAiBC,SAASgB,oBAAoBV,+CAASqC,GAAG7uC;UAC1EwsC,+CAAS4C;UACT5C,+CAASc;QAFiEttC,CAA1DA,GAIZsvC,IAAarD,0DAAiBC,SAASgB,oBAAoBV,+CAASqC,GAAG7uC,CAC3EwsC,+CAAS4C,OACT5C,+CAASgB,IAFkExtC,CAA1DA,GAKbuvC,IAAQtD,0DAAiBC,SAASgB,oBAAoBV,+CAASgD,GAAGxvC,CACtEwsC,+CAASY,IAD6DptC,CAA1DA;AAkBdisC,kEAAiBC,SAASrhD,SAda4kD;UACrCptC,MAAMswB,4CAAM+c;UACZrD,eAAe1jC,GAAS3I;AACtBA,mBAAOA,CAAC4sC,uCAAQC,WAAR7sC,KAAwBA,CAAC2I,EAAU/E,QAAQ0oC;UAD7BtsC;UAGxBwN,SAAS7E,GAAW/D,GAAC5E;AAElB2I,cAA2BxG,UAA3BnC;AACD2I,cAAUumC,KAAKlvC,IAAfA;AACA4E,cAAE4yB,eAAFx3B;AACAA,mBAAOA;UALYA;UAOrBusC,UAAUvsC,CAACmvC,GAAYE,GAAWC,GAAYC,CAApCvvC;QAZ2ByvC,CAcvCzvC;MAhC0BA;uEAyCtBC,WAAkCA;AACtCP,6DAAAO;AACAN,6DAAAM;AACAL,2DAAAK;AACAJ,0DAAAI;AACAH,4DAAAG;AACAF,2DAAAE;AACAD,2DAAAC;MAPsCA;sEC/PlCC,SAAwByvC,GAAqBzvC;AACjDA,cAAMkI,IAAeunC,EAAKxqB,UAALjlB;AACrBA,YAAIA,CAACyvC,EAAKhwB,cAALzf,EAAqBuE;AAAQvE,iBAAOkI;AACzCA,UAAMwnC,aAAaD,EAAKhwB,cAALzf,EAAqBmF,IAAK8W,OAAUA,EAAMgJ,UAANjlB,CAApCA;AACnBA,eAAOkI;MAJ0ClI;AAU7CC,sEAAAA,SAIJ0vC,GACAC,GACA1nC,GACAO,GAAoBxI;AAEdwvC,YAAOE,EAAoBzqB,UAAUhd,GAAOO,CAArCxI;AACbA,YAAIA,CAACiI,EAAMwnC;AAAYzvC,iBAAOwvC;AAC9BxvC,mBAAWA,CAACsG,GAAO0V,CAARhc,KAAkBiI,EAAMwnC,WAAWG,QAAjB5vC;AAC3BwvC,YAAKK,gBACHF,EAAoB1qB,UAAUjJ,GAAOxT,CAArCxI,GACAsG,CAFFtG;AAKFA,eAAOwvC;MAVaxvC;6DCnEhBnN,SAAe2V,GAAoB3V;AAGvCA,cAAMoV,IAAQnF,uBAAOC,OAAOlQ,IAAdA,GACRi9C,IAAyB7kD,4CAAqBoX,qCAAKkgB,YAAY1vB,IAA/CA;AACtBA,mBAAW0Q,KAAOusC,GAAej9C;AACjBA,cAAAA;AAAdA,gBAAMA,IAAQA,SAAAA,IAAAi9C,EAAcvsC,CAAd1Q,KAAAA,SAAAA,EAAoCA,KAAK2V,CAAzC3V;AACVA,gBACFoV,EAAM1E,CAAN1Q,IAAaA;QAHgBA;AAMjCA,eAAOoV;MAXgCpV;6DAsBnCoN,SACJgI,GACAO,GACAvI,EAACA,YAAAiE,IAAajE,MAAdA,IAA+CA,CAAAA,GAAEA;AAEjDA,YAAM6vC,IAAyB7kD,4CAAqBoX,qCAAKkgB,YAAYtiB,IAA/CA;AACtBA,YAAK6vC,GAAL7vC;AAIM8vC,cAAgBjtC,OAAO8sC,QAAQE,CAAf7vC,EAA8Bsd,KAClDtd,CAACouB,GAAG7M,MAAOA,EAAEvhB,CAAFA,EAAsB+vC,WAAY3hB,EAAEpuB,CAAFA,EAAsB+vC,QAD/C/vC;AAItBA,cAAMqjB,IAA4Bj4B,kDAAX4U;AACZ+D,YAAAA,kDAAcE,CAAzBjE;AAEAA,WADM8mB,IAA2Bhf,EAAAA,6CAAX9H,MAET+H,EAAAA,6CAAS/H,IAApBA;AAGE3R,+DAAJ2R;uBACyBgwC,qDACvBznC,EAAU0xB,kBAAkBj6B,KAA5BA;AAKFA,qBAAWA,CAAAA,EAAGiwC,CAAHjwC,KAAoB8vC,EAAcnqC,QAAd3F,GAAyBA;AACrDiwC,gBAAAA;AAAAjwC,qBAAAiwC,IAAAA,MAAAA,EAA8B/V,MAAM3xB,CAApCvI;UADqDA;AAKxDA,qBAAWA,CAACiC,GAAMguC,CAAPjwC,KAAwB8vC,EAAcnqC,QAAd3F;AAEjCA,gBADoBgI,EAAM/F,CAANiuC,GACHlwC;AACdiwC,kBAAAA;AAAAjwC,uBAAAiwC,IAAAA,MAAAA,EAA8BjwC,KAAKgI,EAAM/F,CAANjC,GAAauI,CAAhDvI;YADcA;AAKfuI,uBAAqBynC,qDACvBznC,EAAU0xB,kBAAkBj6B,IAA5BA;AAEE1R,8DAAJ0R;AAEW3U,mDAAK2U,KAAgBlU,wCAAe6uC,oDAA1B36B,GAA6CuI,CAAlDvI,CAAhBA;YAEW+H,6CAAS+e,CAApB9mB;AACW+D,YAAAA,kDAAcsf,CAAzBrjB;QA1CAA;MAHiDA;6CCZ7CpS,SACJymB,GACA87B,GAA4BviD;AAE5BA,YAAIwiD,IAAmCxiD;AAErCwiD,YADuBxiD,aAArBA,OAAOymB,IAEP7E,SAAS6gC,eAAeh8B,CAAxBzmB,KAAsC4hB,SAAS4a,cAAc/V,CAAvBzmB,IAErBymB;AAKN+7B,YAAAA;AAFfxiD,YACEA,CAAC4hB,SAASiB,SAAS2/B,CAAlBxiD,KACD4hB,cAA+B8gC,SAAlBF,IAAAA,KAAkBE,SAAlBF,EAAkBE;AAE/B1iD,gBAAM0U,MAAM1U,6CAANA;AAEF4V,YAAU5V,IAAI2iD,uCAAQJ,KAAgBviD,CAAAA,CAA5BA;AACV4iD,YAAehhC,SAASC,cAAc7hB,KAAvBA;AACjBE,kDAAS0iD,GAAc5iD,cAA3BA;AACAA,SAAiBi+B,QAAbskB,IAAatkB,IAAbskB,EAAatkB,QACX/9B,0CAAS0iD,GAAc5iD,YAA3BA;AAEF4iD,UAAaC,WAAW7iD;AACnBqF,mDAASu9C,GAAmBE,wCAAMC,OAAOryB,EAAAA,+BAAA1wB,oBAA9CA;AAEAwiD,UAAkBxgC,YAAY4gC,CAA9B5iD;AACMyc,YAAMzV,wCAAU47C,GAAchtC,CAAxB5V;AAEZA,cAAM2a,IAAYtI,kDAAoBuwC,GAAcnmC,GAAK7G,CAAvC5V;AAElBwQ,2CAAKmK,CAAL3a;AAIOvB,uDAAiBkc,CAAxB3a;AAEOnB,gDAAU8b,CAAjB3a;AAEA4iD,UAAarjC,iBAAiBvf,WAAWA,WAAAA;AAChCvB,yDAAiBkc,CAAxB3a;QADuCA,CAAzCA;AAIAA,eAAO2a;MA1CqB3a;gDAoD9BgH,SAAmByf,GAAoB7Q,GAAgB5O;AAIrDyf,UAAUrJ,aAAapW,OAAOA,KAA9BA;AAGIhH,0CAAO4V,EAAQ2L,QAAQ3L,EAAQ4L,WAAnCxa;AAaMyV,YAAUxc,kDACdqwC,qCAAI0S,KACJh8C,EACEA,OAAaub,yCACbvb,cAAkBi8C,0CAClBj8C,eAAmBk8C,2CACnBl8C,SAAWA,OACXA,SAASA,cACTA,UAAYA,IANdA,GAQAyf,CAVUzf;AAiBZA,cAAMm8C,IAAWljD;UAAiBqwC,qCAAI8S;UAAMp8C,CAAAA;UAAIyV;QAAnCzV,GAIPq8C,IAAMluC,OAAOmS,KAAKg8B,OAALt8C,CAAPA,EAAsB49B,UAAU59B,CAAhCA;AAEZ4O,UAAQ2tC,cAAcC,iCAAKx8C,UAAUq8C,GAAKztC,EAAQ6tC,aAAaN,CAAzCn8C;AACtBA,eAAOyV;MA5C8CzV;0DAsDvDqL,SACEqW,GACAjM,GACA7G,GAAgBvD;AAEhBuD,UAAQ4G,kBAAkBnK;AACpB0J,YAAgB1J,IAAI+vC,kDAAaxsC,CAAjBvD;AACtBA,cAAMqxC,IAAY3nC,EAAcnG;AAChCmG,UAAcrC,QAAQgqC,EAAUC,YAAYC;AAC5CnnC,UAAIuF,YACFjG,EAAc/U,UAAUqL,yBAAyBqW,CAAjDrW,CADFA;AAKAA,YAAMu1B,IAAoB7rB,EAAcuiB,YAAdjsB,EAA4BksB,aAA5BlsB;AACtBu1B,aACE1nC,0CAASwoB,GAAckf,CAA3Bv1B;AAGFA,SADMmsB,IAAiBziB,EAAc0iB,SAAdpsB,EAAyBksB,aAAzBlsB,MAEjBnS,0CAASwoB,GAAc8V,CAA3BnsB;AAGEA,SAACqxC,EAAUthD,iBAAiBshD,EAAUG,iBAElCC,IAAS/nC,EAAcgoC,UAAUzT,qCAAI0S,GAA5B3wC,GACX9R,6CAAYujD,GAAQrnC,CAAxBpK;AAEEqxC,UAAUM,eACZjoC,EAAckoC,YAAd5xC;AAEEqxC,UAAUC,eAAeD,EAAUC,YAAYO,YACjDnoC,EAAcooC,gBAAd9xC;AAGF0J,UACGqoC,gBADH/xC,EAEGgyC,UAAU5nC,GAAKpK,6BAA6BA,kBAF/CA;AAKA0J,UAAc4a,UAAUtkB,GAAGA,CAA3BA;AAEA0J,UAAci9B,kBACA/nC,0DAAsB8K,CAAlC1J,CADFA;AAKOxT,gDAAUkd,CAAjB1J;AACUrL,mDAAVqL;AACYrL,qDAAZqL;AACQrL,iDAARqL;AACAA,eAAO0J;MAhDS1J;2CAwDlB7B,SAAcuL,GAA2BvL;AACvCA,cAAMoF,IAAUmG,EAAcnG;AAC9BpF,YAAMiM,IAAMV,EAAcW,aAAdlM;AAGEhR,8DACZid,EAAIuG,YACJxS,eACAA,MACAA,SAAUoG,GAAQpG;AACG7Q,8DAAciX,CAA5BpG,KACHoG,EAAE4yB,eAAFh5B;QAFcA,CAJpBA;AAWM8zC,YAAuC9kD,sDAC3CgmB,QACAhV,UACAA,MACAA,WAAAA;AAGUtI,8CAARsI;AACAuL,YAAcwoC,eAAe/zC,IAA7BA;AACYnI,uEAAZmI;AACUnI,qEAAVmI;kDACiBuL,CAAjBvL;AACYW,uEAAyB4K,CAArCvL;QARFA,CAJ6BA;AAe/BuL,UAAcyoC,wBAAwBF,CAAtC9zC;AAEA+B,yDAAA/B;AAEAA,YAAIoF,EAAQiuC,cAAcrzC;AAClBi0C,cAAU1oC,EAAc2oC,WAAdl0C;AAChBA,gBAAMszC,IAAS/nC,EAAc4oC,UAAUn0C,IAAxBA;AACXi0C,cACFA,EAAQj0C,KAARA,IACSszC,MAETA,EAAOtzC,KAAKuL,CAAZvL,GACAszC,EAAOn8C,KAAKiO,EAAQiuC,YAApBrzC,GACoCA,eAAhCA,OAAOszC,EAAOc,iBAChBd,EAAOc,cAAPp0C;QAVoBA;AAetBoF,UAAQouC,eACVjoC,EAAc8oC,SAAUr0C,KAAxBA;AAEEoF,UAAQ+tC,eAAe/tC,EAAQ+tC,YAAYO,YAC7CnoC,EAAc+oC,cAAet0C,KAA7BA;AAGEoF,UAAQmvC,eAAenvC,EAAQmvC,YAAYC,cAO7CjpC,EAAcgQ,YAAYvb,IAAIy0C,oDAC5BlpC,GANmCvL,SAAnCoF,EAAQmvC,YAAYC,cACpBx0C,CAACA,CAACoF,EAAQmvC,YAAYC,WAAW/4B,YAEEzb,SAAnCoF,EAAQmvC,YAAYC,cACpBx0C,CAACA,CAACoF,EAAQmvC,YAAYC,WAAWv4B,UAKjCjc,+BAJwBA,GAM1BuL,EAAcgQ,UAAUzO,OAAxB9M,KAEAuL,EAAcmpC,WAAW10C,EAAC8P,GAAG9P,KAAKgQ,GAAGhQ,IAAZA,CAAzBA;AAIEoF,UAAQuvC,aACV3yC,yCAAWoD,EAAQ4L,aAAazF,CAAhCvL;MA7EqCA;gDAyFzC8B,SAAmBsE,GAAgBtE;AACjCA,cAAMyJ,IAAuBvd,+CAAP8T;AACtBA,YAAKyJ,KAKHzJ,EAAc3S,oDAAciX,CAA5BtE,KACCyJ,EAAcid,YAAY1mB,CAACyJ,EAAc/T,UAAdsK;AAO9B2rC,oEAAiBC,SAAS5rC,UAAUyJ,GAAenF,CAAnDtE;MAfiCA;yDAkCnCC,WAA2BA;AACpB6yC,8DACW5lD,sDAAgBoiB,UAAUrP,UAAUA,MAAMA,WAAAA;AACtDA,gBAAMuJ,IAAoBzd,+CAAPkU;AACnBA,mBAASwE,IAAIxE,GAAGoI,GAAYA,IAAYmB,EAAW/E,CAAXxE,GAAgBwE;AAClD4D,yBAAqBynC,qDACvBznC,EAAU0qC,uBAAV9yC;QAJkDA,CAAxDA,GAQc/S,sDAAgBoiB,UAAUrP,WAAWA,MAAMD,uCAAzDC,GAGc9S;UAAKmiB;UAAUrP;UAAYA;UAAYpT;QAArDoT,GACc9S,2CAAKmiB,UAAUrP,eAAeA,MAAYpT,qCAAxDoT,GAEc+yC,+CACE9lD,sDACZgmB,QACAjT,qBACAqP,UACArP,WAAAA;AAES1T,kDAAiBL,+CAAP+T,CAAjBA;QAFFA,CAJFA;AAWJ6yC,4DAAsB7yC;MA5BGA;iDAqC3BC,SAAoBgP,GAAqB7G,GAAuBnI;AAgC9D+yC,iBAASA,IAAY/yC;AACnBA,iBAAOgzC,EAAW/uC,UAAQjE;AACxBA,kBAAMizC,IAAkBD,EAAW/lC,IAAXjN;AACpBizC,iBACY/lD,6CAAO+lD,CAArBjzC;UAHsBA;AAM1BkzC,YAASC,QAATnzC;QAPmBA;AA/BrBA,cAAMkzC,IAAW/qC,EAAU80B,gBAAVj9B;AACjBkzC,UAAStzC,KACPI,CACEgP,IAAchP,aACdgP,IAAchP,aACdgP,IAAchP,WAHhBA,GAKAA,OANFA;AAQAkzC,UAAStzC,KACPI,CACEgP,IAAchP,kBACdgP,IAAchP,kBACdgP,IAAchP,gBAHhBA,GAKAA,YANFA;AAQAkzC,UAAStzC,KACPI,CACEgP,IAAchP,cACdgP,IAAchP,cACdgP,IAAchP,YAHhBA,GAKAA,QANFA;AAUAA,cAAMgzC,IAAmChzC,CAAAA;AAoBzCgzC,UAAW3uC,KACKrX,sDACZoiB,UACApP,eACAA,MACA+yC,GACA/yC,IALFA,CADFA;UASWqE,KACKrX,sDACZoiB,UACApP,cACAA,MACA+yC,GACA/yC,IALFA,CADFA;MAzD8DA;8DC5U1DT,WAAsBA;AAkB1B6zC,wEAAoB1H,SAASrhD,SAjBIgpD,EAC/BC,cAAW/zC;AACTA,iBAAO2e,EAAAA,+BAAA3e;QADEA,GAGXssC,eAAejV,GAAYr3B;AACzBA,iBAA6CA,IAAzCq3B,EAAMzuB,UAAWpD,aAAjBxF,EAAgC0E,SAC3B1E,YAEFA;QAJkBA,GAM3ByN,SAAS4pB,GAAYr3B;AACnBq3B,YAAMzuB,UAAWumC,KAAKnvC,KAAtBA;QADmBA,GAGrBg0C,WAAWH,gEAAoBI,UAAUC,WACzCxrC,IAAI1I,iBACJm0C,QAAQn0C,EAfuB8zC,CAiBjC9zC;MAlB0BA;8DAwBtBC,WAAsBA;AAkB1B4zC,wEAAoB1H,SAASrhD,SAjBIspD,EAC/BL,cAAW9zC;AACTA,iBAAO0e,EAAAA,+BAAA1e;QADEA,GAGXqsC,eAAejV,GAAYp3B;AACzBA,iBAA6CA,IAAzCo3B,EAAMzuB,UAAWyrC,aAAjBp0C,EAAgCyE,SAC3BzE,YAEFA;QAJkBA,GAM3BwN,SAAS4pB,GAAYp3B;AACnBo3B,YAAMzuB,UAAWumC,KAAKlvC,IAAtBA;QADmBA,GAGrB+zC,WAAWH,gEAAoBI,UAAUC,WACzCxrC,IAAIzI,iBACJk0C,QAAQl0C,EAfuBm0C,CAiBjCn0C;MAlB0BA;iEAwBtBS,WAAyBA;AAqB7BmzC,wEAAoB1H,SAASrhD,SApBKwpD,EAChCP,cAAWrzC;AACTA,iBAAOie,EAAAA,+BAAAje;QADEA,GAGX4rC,eAAejV,GAAY32B;AACzBA,iBAAI22B,EAAMzuB,UAAW62B,UAAjB/+B,IACgDA,IAA9C22B,EAAMzuB,UAAWsvB,aAAax3B,KAA9BA,EAAqCgE,SAChChE,YAEFA,aAEFA;QAPkBA,GAS3B+M,SAAS4pB,GAAY32B;AACnB22B,YAAMzuB,UAAW2rC,QAAjB7zC;QADmBA,GAGrBszC,WAAWH,gEAAoBI,UAAUC,WACzCxrC,IAAIhI,kBACJyzC,QAAQzzC,EAlBwB4zC,CAoBlC5zC;MArB6BA;+DA6B/BC,SAAuB6zC,GAAyBhJ,GAAqB7qC;AAInE8zC,iBAASA,EAAUh9C,GAAekJ;AAChC+zC;AACAj9C,YAAMusB,aAAawwB,CAAnB7zC;AACuBA,gBAAnB+zC,KACKtsC,EAAAA,6CAASzH,KAAhBA;QAJ8BA;AAFlCA,YAAIg0C,IAAKh0C,GACL+zC,IAAiB/zC;AAQdyH,UAAAA,6CAASzH,IAAhBA;AACAA,iBAASqE,IAAIrE,GAAGqE,IAAIwmC,EAAU9mC,QAAQM,KAAKrE;AACzCA,cAAIlJ,IAAyB+zC,EAAUxmC,CAAVrE;AAC7BA,iBAAOlJ;AACLi9C,iBACA9vC,WAAW6vC,EAAU/mD,KAAKiT,MAAMlJ,CAArBkJ,GAA6Bg0C,CAAxCh0C,GACAlJ,IAAQA,EAAMoS,aAANlJ,GACRg0C,KAjBUC;QAW6Bj0C;MAZwBA;kEA0B/DC,WAA0BA;AA4B9BizC,wEAAoB1H,SAASrhD,SA3BQ+pD,EACnCd,cAAWnzC;AACTA,iBAAO+d,EAAAA,+BAAA/d;QADEA,GAGX0rC,eAAejV,GAAYz2B;AACzBA,cAAIy2B,EAAMzuB,UAAW/E,QAAQixC,UAAUl0C;AAC/B4qC,gBAAYnU,EAAMzuB,UAAWsvB,aAAat3B,KAA9BA;AAClBA,qBAASoE,IAAIpE,GAAGoE,IAAIwmC,EAAU9mC,QAAQM,KAAKpE;AACzCA,kBAAInJ,IAAyB+zC,EAAUxmC,CAAVpE;AAC7BA,qBAAOnJ,KAAOmJ;AACZA,oBAAIA,CAACnJ,EAAMyrB,YAANtiB;AACHA,yBAAOA;AAETnJ,oBAAQA,EAAMoS,aAANjJ;cAJIA;YAF2BA;AAS3CA,mBAAOA;UAX8BA;AAavCA,iBAAOA;QAdkBA,GAgB3B6M,SAAS4pB,GAAYz2B;AACnBD;YAAcC;YAAMy2B,EAAMzuB,UAAWsvB,aAAat3B,IAA9BA;UAApBA;QADmBA,GAGrBozC,WAAWH,gEAAoBI,UAAUC,WACzCxrC,IAAI9H,qBACJuzC,QAAQvzC,EAzB2Bi0C,CA2BrCj0C;MA5B8BA;gEAkC1BC,WAAwBA;AA4B5BgzC,wEAAoB1H,SAASrhD,SA3BMiqD,EACjChB,cAAWlzC;AACTA,iBAAO8d,EAAAA,+BAAA9d;QADEA,GAGXyrC,eAAejV,GAAYx2B;AACzBA,cAAIw2B,EAAMzuB,UAAW/E,QAAQixC,UAAUj0C;AAC/B2qC,gBAAYnU,EAAMzuB,UAAWsvB,aAAar3B,KAA9BA;AAClBA,qBAASmE,IAAInE,GAAGmE,IAAIwmC,EAAU9mC,QAAQM,KAAKnE;AACzCA,kBAAIpJ,IAAyB+zC,EAAUxmC,CAAVnE;AAC7BA,qBAAOpJ,KAAOoJ;AACZA,oBAAIpJ,EAAMyrB,YAANriB;AACFA,yBAAOA;AAETpJ,oBAAQA,EAAMoS,aAANhJ;cAJIA;YAF2BA;AAS3CA,mBAAOA;UAX8BA;AAavCA,iBAAOA;QAdkBA,GAgB3B4M,SAAS4pB,GAAYx2B;AACnBF;YAAcE;YAAOw2B,EAAMzuB,UAAWsvB,aAAar3B,IAA9BA;UAArBA;QADmBA,GAGrBmzC,WAAWH,gEAAoBI,UAAUC,WACzCxrC,IAAI7H,mBACJszC,QAAQtzC,EAzByBk0C,CA2BnCl0C;MA5B4BA;AAqC9BC,qEAAAA,SAA6BrJ,GAAiBu9C,GAAsBl0C;AAClEA,YAAIrJ,EAAM4H,YAANyB;AACFqG,gBAAM0tB,UAAU/vB,KAAK5I,MAAM84C,GAAYv9C,EAAM+Q,eAAe1H,KAArBA,CAAvCA;aACKA;AACCyI,cAAW9R,EAAM6qB,YAAYxhB,KAAlBA;AACjBA,mBAASkE,IAAIlE,GAAGkE,IAAIuE,EAAS7E,QAAQM;AACnClE,yEAAoByI,EAASvE,CAATlE,GAAak0C,CAAjCl0C;QAHGA;MAH2DA;qEAiBpEC,SAA6B6H,GAAuB7H;AAClDA,cAAMi0C,IAAyBj0C,CAAAA;AACzByqC,YAAY5iC,EAAUsvB,aAAan3B,IAAvBA;AAClBA,iBAASiE,IAAIjE,GAAGiE,IAAIwmC,EAAU9mC,QAAQM;AACpClE,uEAAoB0qC,EAAUxmC,CAAVjE,GAAci0C,CAAlCj0C;AAEFA,eAAOi0C;MAN2Cj0C;6DAgBpDC,SAAqBg0C,GAAwBC,GAAmBj0C;AAE1Di0C,YACS7sC,EAAAA,6CAAS6sC,CAApBj0C,KAEWoH,EAAAA,6CAASpH,IAApBA,GACAi0C,IAAwB9sC,EAAAA,6CAAXnH;AAEfA,cAAMvJ,IAAQu9C,EAAWE,MAAXl0C;AACVvJ,cACGA,EAAM09C,cAANn0C,IAIHA,qDAAYg0C,GAAYC,CAAxBj0C,KAHAvJ,EAAMD,QAAQwJ,OAAOA,IAArBA,GACA4D,WAAW5D,sDAXD4zC,IAWqBI,GAAYC,CAA3Cj0C;AAKOoH,UAAAA,6CAASpH,KAApBA;MAjB8DA;mEAuB1DC,WAA2BA;AA6C/B4yC,wEAAoB1H,SAASrhD,SA5CMsqD;UACjCrB,YAAY1c,GAAYp2B;AACtBA,gBAAIA,CAACo2B,EAAMzuB;AACT3H,qBAAOA;AAEHo0C,gBAAwBt0C,6DAAoBs2B,EAAMzuB,SAA1B3H,EAAqCyD;AACnEzD,mBAA8BA,MAA1Bo0C,IACK12B,EAAAA,+BAAA1d,eAEF0d,EAAAA,+BAAA1d,gBAAuB0O,QAAQ1O,MAAMA,GAAGo0C,CAAHp0C,EAArCA;UAReA;UAUxBqrC,eAAejV,GAAYp2B;AACzBA,mBAAKo2B,EAAMzuB,YAIoB3H,IADDF,6DAAoBs2B,EAAMzuB,SAA1B3H,EAAqCyD,SAChCzD,YAAYA,aAHtCA;UAFgBA;UAO3BwM,SAAS4pB,GAAYp2B;AACnBA,gBAAKo2B,EAAMzuB,WAAX3H;AAGAo2B,gBAAMzuB,UAAU0sC,qBAAhBr0C;AACAA,kBAAMs0C,IAAkBx0C,6DAAoBs2B,EAAMzuB,SAA1B3H;AACKA,kBAAzBs0C,EAAgB7wC,SAClB1D,qDAAYu0C,CAAZt0C,IAEOhQ,sCACL0tB,EAAAA,+BAAA1d,kBAAyB0O,QACvB1O,MACAmC,OAAOmyC,EAAgB7wC,MAAvBzD,CAFFA,GAIAA,SAAUu0C,GAAEv0C;AACNu0C,qBACFx0C,qDAAYu0C,CAAZt0C;cAFQA,CALdA;YARFA;UADmBA;UAsBrB+yC,WAAWH,gEAAoBI,UAAUC;UACzCxrC,IAAIzH;UACJkzC,QAAQlzC;QA1CyBm0C,CA4CnCn0C;MA7C+BA;AAgDjCC,2EAAAA,WAAkCA;AAChClB,8DAAAkB;AACAjB,8DAAAiB;AACAR,iEAAAQ;AACAN,kEAAAM;AACAL,gEAAAK;AACAD,mEAAAC;MANgCA;mEAY5BC,WAA2BA;AAyB/B0yC,wEAAoB1H,SAASrhD,SAxBS2qD;UACpC1B,cAAW5yC;AACTA,mBAAOwd,EAAAA,+BAAAxd;UADEA;UAGXmrC,eAAejV,GAAYl2B;AACnB1J,gBAAQ4/B,EAAM5/B;AACpB0J,mBAAIA,CAAC1J,EAAO4tC,cAAc5tC,EAAO4H,YAAP8B,KAAwB1J,EAAOgoC,UAAPt+B,IAC5C1J,EAAOi+C,eAAPv0C,IACKA,YAEFA,aAEFA;UARkBA;UAU3BsM,SAAS4pB,GAAYl2B;AACnBA,gBAAKk2B,EAAM5/B,OAAX0J;AACAA,kBAAM0kB,IAAOwR,EAAM5/B,MAAMk0C,WAAZxqC;AACR0kB,mBACKtmB,uCAAMsmB,GAAMwR,EAAM5/B,MAAMmR,SAAlCzH;YAHAA;UADmBA;UAMrB6yC,WAAWH,gEAAoBI,UAAU0B;UACzCjtC,IAAIvH;UACJgzC,QAAQhzC;QAtB4Bs0C,CAwBtCt0C;MAzB+BA;iEA+B3BC,WAAyBA;AAkC7ByyC,wEAAoB1H,SAASrhD,SAjCO8qD,EAClC7B,YAAY1c,GAAYj2B;AACtBA,iBAAIi2B,EAAM5/B,MAAOo+C,QAAQC,sDAAY/O,IAAjC3lC,IAEKud,EAAAA,+BAAAvd,iBAGFud,EAAAA,+BAAAvd;QANeA,GAQxBkrC,eAAejV,GAAYj2B;AACnB3J,cAAQ4/B,EAAM5/B;AACpB2J,iBACEA,CAAC3J,EAAO4tC,cACR5tC,EAAOmR,UAAU/E,QAAQkyC,YACzB30C,CAAC3J,EAAOyrB,YAAP9hB,KACD3J,EAAOu+C,WAAP50C,IAEOA,YAEFA;QAVkBA,GAY3BqM,SAAS4pB,GAAYj2B;AACb3J,cAAQ4/B,EAAM5/B;AAChBA,YAAOo+C,QAAQC,sDAAY/O,IAA3B3lC,IACF3J,EAAOglC,eAAer7B,IAAtBA,IAEA3J,EAAOglC,eAAer7B,EAAtBA;QALiBA,GAQrB4yC,WAAWH,gEAAoBI,UAAU0B,OACzCjtC,IAAItH,gBACJ+yC,QAAQ/yC,EA/B0Bw0C,CAiCpCx0C;MAlC6BA;gEAwCzBC,WAAwBA;AA8B5BwyC,wEAAoB1H,SAASrhD,SA7BMmrD,EACjClC,YAAY1c,GAAYh2B;AACtBA,iBAAOg2B,EAAM5/B,MAAOqsC,gBAAbziC,IACHsd,EAAAA,+BAAAtd,kBACAsd,EAAAA,+BAAAtd;QAHkBA,GAKxBirC,eAAejV,GAAYh2B;AACnB5J,cAAQ4/B,EAAM5/B;AACpB4J,cAAIA,CAAC5J,EAAO4tC,cAAc5tC,EAAOgoC,UAAPp+B,KAAsBA,CAAC5J,EAAOyrB,YAAP7hB;AAC/CA,qBAAS2D,IAAI3D,GAAG2D,IAAIvN,EAAO6uB,UAAU5hB,QAAQM;AAG3C3D,kBACEA,EAAE5J,EAAO6uB,UAAUthB,IAAI3D,CAArBA,aAAmC60C,4EACnCz+C,EAAO6uB,UAAUthB,CAAjB3D,aAA+B60C;AAEjC70C,uBAAOA;;AAIbA,iBAAOA;QAdkBA,GAgB3BoM,SAAS4pB,GAAYh2B;AACnBg2B,YAAM5/B,MAAOuwB,gBAAgB3mB,CAACg2B,EAAM5/B,MAAOqsC,gBAAbziC,CAA9BA;QADmBA,GAGrB2yC,WAAWH,gEAAoBI,UAAU0B,OACzCjtC,IAAIrH,eACJ8yC,QAAQ9yC,EA3ByB40C,CA6BnC50C;MA9B4BA;6EAoCxBC,WAAqCA;AAyBzCuyC,wEAAoB1H,SAASrhD,SAxBcqrD;UACzCpC,YAAY1c,GAAY/1B;AACtBA,mBAAO+1B,EAAM5/B,MAAOyrB,YAAb5hB,IACHqd,EAAAA,+BAAArd,eACAqd,EAAAA,+BAAArd;UAHkBA;UAKxBgrC,eAAejV,GAAY/1B;AACnB7J,gBAAQ4/B,EAAM5/B;AACpB6J,mBACEA,CAAC7J,EAAO4tC,cACR5tC,EAAOgoC,UAAPn+B,KACA7J,EAAOmR,UAAU/E,QAAQixC,WAElBxzC,YAEFA;UATkBA;UAW3BmM,SAAS4pB,GAAY/1B;AACnB+1B,cAAM5/B,MAAOusB,aAAa1iB,CAAC+1B,EAAM5/B,MAAOyrB,YAAb5hB,CAA3BA;UADmBA;UAGrB0yC,WAAWH,gEAAoBI,UAAU0B;UACzCjtC,IAAIpH;UACJ6yC,QAAQ7yC;QAtBiC60C,CAwB3C70C;MAzByCA;iEA+BrCC,WAAyBA;AA4C7BsyC,wEAAoB1H,SAASrhD,SA3COsrD;UAClCrC,YAAY1c,GAAY91B;AACtBA,mBAAO81B,EAAM5/B,MAAO4R,kBAAkB0e,kDAA/BxmB,IACHod,EAAAA,+BAAApd,eACAod,EAAAA,+BAAApd;UAHkBA;UAKxB+qC,eAAejV,GAAY91B;AACnB9J,gBAAQ4/B,EAAM5/B;AACpB8J,gBACEA,CAAC9J,EAAO4tC,cACR5tC,EAAOmR,UAAU/E,QAAQmE,WACzBvQ,EAAOu+C,WAAPz0C,GACAA;AAGAA,kBAAM+7B,IAAkB7lC,EAAOiuB,mBAAPnkB;AAClB80C,kBACJ/Y,EAAgB3jB,QACf2jB,EAAgBzb,IAAIkG,kDAApBxmB,IAAyCA,IAAIA;AAEhDA,qBAAI9J,EAAO6+C,qBAAP/0C,KAAiC80C,IAC5B90C,aAEFA;YAXPA;AAaFA,mBAAOA;UAnBkBA;UAqB3BkM,SAAS4pB,GAAY91B;AACb9J,gBAAQ4/B,EAAM5/B;AACpB8J,kBAAM4lB,IAA2Bhf,EAAAA,6CAAX5G;AACjB4lB,iBACQ/e,EAAAA,6CAAS7G,IAApBA;AAEF9J,cAAOgS,kBACLlI,CAAC9J,EAAO4R,kBAAkB0e,kDAAzBxmB,GACDwmB,kDAFFxmB;AAIW6G,cAAAA,6CAAS+e,CAApB5lB;UAVmBA;UAYrByyC,WAAWH,gEAAoBI,UAAU0B;UACzCjtC,IAAInH;UACJ4yC,QAAQ5yC;QAzC0B60C,CA2CpC70C;MA5C6BA;gEAkDzB3B,WAAwBA;AA8B5Bi0C,wEAAoB1H,SAASrhD,SA7BMsqD;UACjCrB,YAAY1c,GAAYz3B;AACtBA,gBAAMnI,IAAQ4/B,EAAM5/B;AAEhB8+C,gBAAkB9+C,EAAO+Q,eAAe5I,KAAtBA,EAA6B8E;AAEnD9E,aADM8L,IAAYjU,EAAOoS,aAAPjK,OAGhB22C,KAAmB7qC,EAAUlD,eAAe5I,KAAzBA,EAAgC8E;AAErD9E,mBAA2BA,MAApB22C,IACH53B,EAAAA,+BAAA/e,eACA+e,EAAAA,+BAAA/e,gBAAuB+P,QAAQ/P,MAAMA,GAAG22C,CAAH32C,EAArCA;UAXkBA;UAaxB0sC,eAAejV,GAAYz3B;AACzBA,mBAAIA,CAACy3B,EAAM5/B,MAAO4tC,cAAchO,EAAM5/B,MAAO4H,YAAbO,IACvBA,YAEFA;UAJkBA;UAM3B6N,SAAS4pB,GAAYz3B;AACfy3B,cAAM5/B,SACR4/B,EAAM5/B,MAAMu1C,eAAZptC;UAFiBA;UAKrBo0C,WAAWH,gEAAoBI,UAAU0B;UACzCjtC,IAAI9I;UACJu0C,QAAQv0C;QA3ByBw1C,CA6BnCx1C;MA9B4BA;8DAoCxB4B,WAAsBA;AAuB1BqyC,wEAAoB1H,SAASrhD,SAtBI0rD,EAC/BzC,cAAWvyC;AACTA,iBAAOmd,EAAAA,+BAAAnd;QADEA,GAGX8qC,eAAejV,GAAY71B;AACnB/J,cAAQ4/B,EAAM5/B;AAKpB+J,kBAH4BA,eAA1BA,OAAO/J,EAAOg/C,UACVh/C,EAAOg/C,QAAPj1C,IACA/J,EAAOg/C,WAEJj1C,YAEFA;QATkBA,GAW3BiM,SAAS4pB,GAAY71B;AACnB61B,YAAM5/B,MAAOi/C,SAAbl1C;QADmBA,GAGrBwyC,WAAWH,gEAAoBI,UAAU0B,OACzCjtC,IAAIlH,aACJ2yC,QAAQ3yC,EApBuBg1C,CAsBjCh1C;MAvB0BA;uEA2BtBC,WAA+BA;AAenCoyC,wEAAoB1H,SAASrhD,SAdMsqD;UACjCrB,aAAatyC,MAAMkd,EAAAA,+BAAAld;UACnB6qC,eAAejV,GAAY51B;AACZmhB,gBAAAA;AAAbnhB,oBAAOA,SAAMmhB,IAANyU,EAAMzU,WAANnhB,IAAMmhB,EAASvjB,YAAfoC,KAA+BA,YAAYA;UADzBA;UAG3BgM,SAAS4pB,GAAY51B;AACR2G,cAAAA,6CAAS3G,IAApBA;AACMmhB,gBAAAA;AAANnhB,qBAAMmhB,IAANyU,EAAMzU,YAAAA,EAASprB,QAAfiK;AACW2G,cAAAA,6CAAS3G,KAApBA;UAHmBA;UAKrBuyC,WAAWH,gEAAoBI,UAAUpb;UACzCnwB,IAAIjH;UACJ0yC,QAAQ1yC;QAZyB2zC,CAcnC3zC;MAfmCA;0EAmB/BC,WAAkCA;AAgBtCmyC,wEAAoB1H,SAASrhD,SAfS2qD;UACpC1B,aAAaryC,MAAMid,EAAAA,+BAAAjd;UACnB4qC,eAAejV,GAAY31B;AACZkhB,gBAAAA;AAAblhB,oBAAOA,SAAMkhB,IAANyU,EAAMzU,WAANlhB,IAAMkhB,EAAS6c,UAAf/9B,KAA6BA,YAAYA;UADvBA;UAG3B+L,SAAS4pB,GAAY31B;AACnBA,gBAAK21B,EAAMzU,SAAXlhB;AACAA,kBAAMmkB,IAAOwR,EAAMzU,QAAQ+oB,WAAdjqC;AACRmkB,mBACKtmB,uCAAMsmB,GAAMwR,EAAMzU,QAAQha,SAApClH;YAHAA;UADmBA;UAMrBsyC,WAAWH,gEAAoBI,UAAUpb;UACzCnwB,IAAIhH;UACJyyC,QAAQzyC;QAb4B+zC,CAetC/zC;MAhBsCA;uEAoBlCC,WAA+BA;AAuBnCkyC,wEAAoB1H,SAASrhD,SAtBM6rD,EACjC5C,aAAapyC,MAAMgd,EAAAA,+BAAAhd,aACnB2qC,gBAAgB3qC,MAAMA,WACtB8L,UAAU9L,CAAC01B,GAAcxyB,MAAmBlD;AAE1CA,cADMiH,IAAYyuB,EAAMzuB,WACxBjH;AACWyG,cAAAA,6CAASzG,IAApBA;AACAA,gBAAMihB,IAAUjhB,IAAIs5B,oFAAyBryB,CAA7BjH;AAChBihB,cAAQgB,QAAQjF,EAAAA,+BAAAhd,8BAAhBA;AACAihB,cAAQ3lB,OACN2E,iEACED,IAAIkS;cAAWhP,EAAE2J;cAAS3J,EAAE6J;YAA5B/M,GACAiH,CAFFjH,CADFA;AAMOuI,cAAAA,0CAAY0Y,CAAnBjhB;AACWyG,cAAAA,6CAASzG,KAApBA;UAXAA;QAF0CA,GAe5CqyC,WAAWH,gEAAoBI,UAAUC,WACzCxrC,IAAI/G,iBACJwyC,QAAQxyC,EApByBg1C,CAsBnCh1C;MAvBmCA;yEA6BrCC,SACEg1C,GACAhuC,GAAuBhH;AAMvBA,YAAM6U,IAJe7N,EAAU8N,gBAAVC,EAIa5C,sBAAbnS;AAGfgV,YAAqBhV,IAAIiS,mDAC7B+iC,EAAWroC,IAAIkI,EAAa5D,MAC5B+jC,EAAWnoC,IAAIgI,EAAa7D,GAFHhR;AAOrBiV,YAAmBjO,EAAUkO,wBAAVlV;AAInBi1C,YAAchjC,mDAAWkD,WAC7BH,GACAC,CAFkBjV;AAKpBi1C,UAAYlvC,MAAM/F,IAAIgH,EAAUjB,KAAhC/F;AACAA,eAAOi1C;MA1BgBj1C;uEA8BzBC,WAA8BA;AAC5BV,mEAAAU;AACAT,iEAAAS;AACAR,gEAAAQ;AACAP,6EAAAO;AACAN,iEAAAM;AACAjC,gEAAAiC;AACAL,8DAAAK;MAP4BA;wEAWxBC,WAAgCA;AACpCJ,0EAAAI;AACAL,uEAAAK;AACAH,uEAAAG;MAHoCA;AAYhCC,wEAAAA,WAAgCA;AACpCb,2EAAAa;AACAF,uEAAAE;MAFoCA;4DClqBhCC,SACJqX,GAAQrX;AAERA,eAAqB0D,WAAd2T,EAAI9Z;MAFHyC;ACFJC,+EAAAA,SAA4BoX,GAAQpX;AACxCA,eAA6ByD,WAAtB2T,EAAApX;MADiCA;ACOpCC,oEAAAA,SAAuBmX,GAAWnX;AACtCA,eAC6BA,aAA3BA,OAAQmX,EAAY3Q,MACOhD,WAA1B2T,EAAYzQ,aACWlD,WAAvB2T,EAAY/O,UACa5E,WAAzB2T,EAAYhP;MALuBnI;ACgClCC,4FAAAA,SACJ20C,GAAyB30C;AAEzBA,eAAO20C,EAAY50C,aAAZC;MAFkBA;iDC+OrBC,SAAoB20C,GAA6B30C;AAC7C3V,uDAAP2V,EAA2CA,UAAU20C,CAArD30C;MADoDA;ACnRnD,gBAAU,WAAW,CAAA;AAGzB,cAAQ,QAAQ,CAAA;ACFhB,cAAQ,aAAa;AAMrB,cAAQ,uBAAuB;AAM/B,cAAQ,uBAAuB;AAU/B,cAAQ,yBAAyB;AASjC,cAAQ,oBAAoB;AAO5B,cAAQ,yBAAyB;AAOjC,cAAQ,qDAAqD;cClCrD,iBACJ,QAAQ,cAAgD,cAAlC,OAAO,OAAO,mBACpC,OAAO,iBACP,SAAS,GAAQ,GAAU,GAAY;AACrC,YAAI,KAAU,MAAM,aAEE,KAAW,OAAO;AACtC,iBAAO;AAUT,UAAO,CAAP,IAAmB,EAAW;AAC9B,eAAO;MAf8B;ACL3C,cAAQ,YAAY,SAAS,GAAc;AACrC,YAAkB,CAKpB,YAAY,OAAO,cAAc,YASjC,GAEA,YAAY,OAAO,UAAU,QAE7B,YAAY,OAAO,QAAQ,MAE3B,YAAY,OAAO,UAAU,MApBT;AAsBtB,iBAAS,IAAI,GAAG,IAAI,EAAgB,QAAQ,EAAE,GAAG;AAC/C,cAAI,IAAc,EAAgB,CAAhB;AAOlB,cAAI,KAAe,EAAA,QAAuB;AACxC,mBAA+B;QATc;AAqBzC,cAAU,MAAM,2BAAV;MA5C2B;AAsD3C,cAAQ,SAAS,QAAQ,UAAU,IAAlB;cC3DT,mBACc,eAAlB,OAAO,UAAgD,aAAvB,OAAO,OAAO,GAAP;AAO3C,cAAQ,sBACJ,CAAC,QAAQ,qBAAqB,QAAQ;ACX1C,cAAQ,YAAY,CAAA;AAmBpB,cAAQ,2BAA2B,CAAA;AAGnC,cAAQ,kBAAkB;AAsB1B,UAAI,gCAAgC,SAChC,GAAQ,GAAU,GAAkB;AACtC,YAAI,CAAA,KAA8B,QAAV,GAAxB;AAOI,cAAiB,QAAQ,yBAAyB,CAAjC;AACrB,cAAsB,QAAlB;AACF,mBAAO,EAAO,CAAP;AAKL,cAAW,EAAO,CAAP;AAKf,iBAAoB,WAAb,IAAyB,IAAW,EAAO,CAAP;QAnB3C;MADsC;cA8ChC,WAAW,SAAS,GAAQ,GAAU,GAAU,GAAQ;AACzD,cACD,QAAQ,oBACV,QAAQ,iBAAiB,GAAQ,GAAU,GAAU,CAArD,IAEA,QAAQ,mBAAmB,GAAQ,GAAU,GAAU,CAAvD;MAL4D;AAqBhE,cAAQ,qBAAqB,SAAS,GAAQ,GAAU,GAAU,GAAQ;AACpE,YAAM,QAAQ;AACd,YAAQ,EAAO,MAAM,GAAb;AACZ,aAAS,IAAI,GAAG,IAAI,EAAM,SAAS,GAAG,KAAK;AACzC,cAAI,IAAM,EAAM,CAAN;AACV,cAAI,EAAE,KAAO;AAAM;AACnB,cAAM,EAAI,CAAJ;QAHmC;AAKvC,YAAW,EAAM,EAAM,SAAS,CAArB;AACX,YAAO,EAAI,CAAJ;AACP,YAAO,EAAS,CAAT;AACP,aAAQ,KAAgB,QAAR,KACpB,QAAQ,eACJ,GAAK,GAAU,EAAC,cAAc,MAAM,UAAU,MAAM,OAAO,EAA5C,CADnB;MAZwE;cAwClE,mBAAmB,SAAS,GAAQ,GAAU,GAAU,GAAQ;AACtE,YAAI,IAAQ,EAAO,MAAM,GAAb;AACR,YAAgC,MAAjB,EAAM;AACrB,YAAO,EAAM,CAAN;AAQT,YAFE,CAAC,KAAgB,KAAQ,QAAQ,YAErB,QAAQ,YAGR,QAAQ;AAGxB,iBAAS,IAAI,GAAG,IAAI,EAAM,SAAS,GAAG,KAAK;AACzC,cAAI,IAAM,EAAM,CAAN;AACV,cAAI,EAAE,KAAO;AAAc;AAC3B,cAAc,EAAY,CAAZ;QAH2B;AAMvC,YAAW,EAAM,EAAM,SAAS,CAArB;AAIX,YAAa,QAAQ,oBAAiC,UAAb,IACzC,EAAY,CAAZ,IACA;AACA,YAAO,EAAS,CAAT;AAEC,gBAAR,MAIA,IAQF,QAAQ,eACJ,QAAQ,WAAW,GACnB,EAAC,cAAc,MAAM,UAAU,MAAM,OAAO,EAA5C,CAFJ,IAGS,MAAS,MAIiC,WAA/C,QAAQ,yBAAyB,CAAjC,MACE,IAA0B,MAAhB,KAAK,OAAL,MAAyB,GACvC,QAAQ,yBAAyB,CAAjC,IAA6C,QAAQ,mBAEjD,QAAQ,OAAR,OAAyB,CAAzB,IACA,QAAQ,kBAAkB,IAAS,MAAM,IAS/C,QAAQ,eACJ,GANiB,QAAQ,yBAAyB,CAAjC,GAOjB,EAAC,cAAc,MAAM,UAAU,MAAM,OAAO,EAA5C,CAFJ;MAjEoE;ACrJxE,cAAQ,0BAA0B,WAAW;AAC3C,YAAI,IAAI,EAAC,GAAG,KAAJ,GACJ,IAAI,CAAA;AACR,YAAI;AAEF,iBADA,EAAE,YAAY,GACP,EAAE;QAFP,SAGK,GAAG;QAAA;AAGZ,eAAO;MAToC;cAqBrC,iBAAkB,QAAQ,uBACwB,cAAhC,OAAO,OAAO,iBACpC,OAAO,iBACP,QAAQ,wBAAR,IAAoC,SAAS,GAAQ,GAAO;AAC1D,UAAO,YAAY;AACnB,YAAI,EAAO,cAAc;AACvB,gBAAM,IAAI,UAAU,IAAS,oBAAvB;AAER,eAAO;MALmD,IAMxD;AChCR,cAAQ,oBAAoB,SAAS,GAAO;AAC1C,YAAI,IAAQ;AACZ,eAAO,WAAW;AAChB,iBAAI,IAAQ,EAAM,SACT,EACL,MAAM,OACN,OAAO,EAAM,GAAN,EAFF,IAKA,EAAC,MAAM,KAAP;QAPO;MAFwB;AAoB5C,cAAQ,gBAAgB,SAAS,GAAO;AACtC,eAAoC,EAAC,MAAM,QAAQ,kBAAkB,CAA1B,EAAP;MADE;cCjBhC,eAAe,SAAS,GAAU;AAExC,YAAI,IAAoC,eAAjB,OAAO,UAAyB,OAAO,YACvC,EAAU,OAAO,QAAlB;AACtB,YAAI;AACF,iBAAO,EAAiB,KAAK,CAAtB;AAET,YAAiC,YAA7B,OAAO,EAAA;AACT,iBAAO,QAAQ,cAAqC,CAA7C;AAET,cAAU,MAAM,OAAO,CAAP,IAAmB,kCAA7B;MAVkC;AC4E1C,cAAQ,YAAY,CAAA;AAWpB,cAAQ,UAAU,gCAAgC,SAAS,GAAQ;AACjE,YAAI,EAAA,aAAkB;AAGtB,gBAAM,IAAI,UAAU,qBAAqB,IAAS,mBAA5C;MAJ2D;cAgB3D,UAAU,UAAU,WAAW;AAQrC,aAAK,aAAa;AASlB,aAAK,oBAAoB;AAQzB,aAAK,cAAc;AASnB,aAAK,cAAc;AAqBnB,aAAK,kBAXL,KAAK,gBAAgB;AA4CrB,aAAK,mBAvBL,KAAK,oBAAoB;MAjEY;AAmGvC,cAAQ,UAAU,QAAQ,UAAU,SAAS,WAAW;AACtD,YAAI,KAAK;AACP,gBAAM,IAAI,UAAU,8BAAd;AAER,aAAK,aAAa;MAJoC;AAcxD,cAAQ,UAAU,QAAQ,UAAU,QAAQ,WAAW;AACrD,aAAK,aAAa;MADmC;cAY/C,UAAU,QAAQ,UAAU,sBAAsB,WAAW;AACnE,aAAK,cAAc,KAAK,iBAAiB,KAAK;MADqB;AAarE,cAAQ,UAAU,QAAQ,UAAU,QAAQ,SAAS,GAAO;AAC1D,aAAK,cAAc;MADuC;AAa5D,cAAQ,UAAU,QAAQ,UAAU,SAAS,SAAS,GAAG;AACvD,aAAK,oBAAoB,EAAC,WAAW,GAAG,aAAa,KAA5B;AACzB,aAAK,oBAAL;MAFuD;AAazD,cAAQ,UAAU,QAAQ,UAAU,SAAS,SAAS,GAAO;AAC3D,aAAK,oBAAoB,EAAC,QAA8B,EAA/B;AACzB,aAAK,cAAc,KAAK;MAFmC;cAarD,UAAU,QAAQ,UAAU,2BAA2B,SAC3D,GAAa;AACf,aAAK,oBAAoB,EAAC,QAAQ,EAAT;AACzB,aAAK,cAAc,KAAK;MAFT;AAgBjB,cAAQ,UAAU,QAAQ,UAAU,QAAQ,SAAS,GAAO,GAAe;AACzE,aAAK,cAAc;AACnB,eAAO,EAAC,OAAO,EAAR;MAFkE;AAe3E,cAAQ,UAAU,QAAQ,UAAU,WAAW,SAC3C,GAAU,GAAe;AACgB,YACvC,QAAQ,aAAa,CAArB;AACU,YAAI,IAAS,EAAS,KAAT;AAC3B,gBAAQ,UAAU,8BAA8B,CAAhD;AACA,YAAI,EAAO;AAGT,eAAK,cAAc,EAAO,OAC1B,KAAK,cAAc;;AAIrB,iBADA,KAAK,oBAAoB,GAClB,KAAK,MAAM,EAAO,OAAO,CAAzB;MAboB;cAwBrB,UAAU,QAAQ,UAAU,SAAS,SAAS,GAAa;AACjE,aAAK,cAAc;MAD8C;AAUnE,cAAQ,UAAU,QAAQ,UAAU,YAAY,WAAW;AACzD,aAAK,cAAc;MADsC;AAa3D,cAAQ,UAAU,QAAQ,UAAU,wBAAwB,SACxD,GAAc,GAAgB;AAChC,aAAK,gBAAgB;AACC,kBAAlB,MACF,KAAK,kBAAkB;MAHO;AAelC,cAAQ,UAAU,QAAQ,UAAU,kBAAkB,SAAS,GAAgB;AAC7E,aAAK,gBAAgB;AACrB,aAAK,kBAAkB,KAAkB;MAFoC;AAc/E,cAAQ,UAAU,QAAQ,UAAU,gBAAgB,SAChD,GAAa,GAAc;AAC7B,aAAK,cAAc;AACnB,aAAK,gBAAgB,KAAgB;MAFR;cAcvB,UAAU,QAAQ,UAAU,kBAAkB,SAClD,GAAuB;AACzB,aAAK,gBAAgB,KAAyB;AAC5B,YACoC,KAAK,kBAClD;AACT,aAAK,oBAAoB;AACzB,eAAO;MANkB;AAmB3B,cAAQ,UAAU,QAAQ,UAAU,oBAAoB,SACpD,GAAkB,GAAoB,GAAc;AACjD,YAMF,KAAK,iBAAkB,CAAxB,IAAwC,KAAK,oBAL7C,KAAK,mBAAmB,CAAC,KAAK,iBAAN;AAO1B,aAAK,gBAAgB,KAAoB;AACzC,aAAK,kBAAkB,KAAsB;MAVS;cAuBhD,UAAU,QAAQ,UAAU,oBAAoB,SACpD,GAAa,GAAc;AAiDX,YAIb,KAAK,iBAAkB,OAAO,KAAgB,CAA/C,EAAkD,CAAlD;AAGJ,YAFkB,IAAmB,KAAK,oBACtC,KAAK,qBAAqB,GACR;AACpB,cAAI,EAAiB;AACnB,mBAAO,KAAK,oBAAL;AAkCsB,oBAA3B,EAAiB,UACjB,KAAK,kBAAkB,EAAiB,UAC1C,KAAK,cAAc,EAAiB,QACpC,KAAK,oBAAoB,QAEzB,KAAK,cAAc,KAAK;QAzCN;AA4CpB,eAAK,cAAc;MApGQ;AAyH/B,cAAQ,UAAU,QAAQ,UAAU,QAAQ,SAAS,GAAQ;AAC3D,eAAO,IAAI,QAAQ,UAAU,QAAQ,iBAAiB,CAA/C;MADoD;cAWrD,UAAU,QAAQ,mBAAmB,SAAS,GAAQ;AAM5D,aAAK,UAAU;AAOf,aAAK,cAAc,CAAA;AAEnB,iBAAS,KAAoC;AAC3C,eAAK,YAAY,KAAK,CAAtB;AAEF,aAAK,YAAY,QAAjB;MAlB4D;AA4B9D,cAAQ,UAAU,QAAQ,iBAAiB,UAAU,UAAU,WAAW;AAIxE,eAAiC,IAA1B,KAAK,YAAY,UAAY;AACpB,cAAI,IAAW,KAAK,YAAY,IAAjB;AAC7B,cAAI,KAAoC,KAAK;AAC3C,mBAAO;QAHyB;AAMpC,eAAO;MAViE;AAwB1E,cAAQ,UAAU,UAAU,SAAS,GAAS;AAM5C,aAAK,WAAW,IAAI,QAAQ,UAAU;AAOtC,aAAK,WAAW;MAb4B;cA2BtC,UAAU,QAAQ,UAAU,QAAQ,SAAS,GAAO;AAC1D,aAAK,SAAS,OAAd;AACA,YAAI,KAAK,SAAS;AAChB,iBAAO,KAAK,cACR,KAAK,SAAS,kBAAkB,MAAM,GAAO,KAAK,SAAS,KADxD;AAGT,aAAK,SAAS,MAAM,CAApB;AACA,eAAO,KAAK,UAAL;MAPmD;cAmBpD,UAAU,QAAQ,UAAU,UAAU,SAAS,GAAO;AAC5D,aAAK,SAAS,OAAd;AACc,YAAI,IAAmB,KAAK,SAAS;AACnD,YAAI;AAOF,iBAAO,KAAK,cAJJ,YAAY,IAAmB,EAAiB,QAAjB,IACA,SAAS,GAAG;AACV,mBAAO,EAAC,OAAO,GAAG,MAAM,KAAjB;UADG,GAGT,GAAO,KAAK,SAAS,MAAxD;AAET,aAAK,SAAS,OAAO,CAArB;AACA,eAAO,KAAK,UAAL;MAbqD;cA0BtD,UAAU,QAAQ,UAAU,SAAS,SAAS,GAAW;AAC/D,aAAK,SAAS,OAAd;AACA,YAAI,KAAK,SAAS;AAChB,iBAAO,KAAK,cACR,KAAK,SAAS,kBAAkB,OAAhC,GAA0C,GAC1C,KAAK,SAAS,KAFX;AAIT,aAAK,SAAS,OAAO,CAArB;AACA,eAAO,KAAK,UAAL;MARwD;cAuBzD,UAAU,QAAQ,UAAU,gBAAgB,SAChD,GAAQ,GAAO,GAAY;AAC7B,YAAI;AACY,cAAI,IAAS,EAAO,KACG,KAAK,SAAS,mBAC/C,CAFuB;AAG3B,kBAAQ,UAAU,8BAA8B,CAAhD;AACA,cAAI,CAAC,EAAO;AAEV,mBADA,KAAK,SAAS,MAAd,GACO;AAIK,cAAI,IAAc,EAAO;QAXrC,SAYK,GAAG;AAGV,iBAFA,KAAK,SAAS,oBAAoB,MAClC,KAAK,SAAS,OAAO,CAArB,GACO,KAAK,UAAL;QAHG;AAKZ,aAAK,SAAS,oBAAoB;AAClC,UAAW,KAAK,KAAK,UAAU,CAA/B;AACA,eAAO,KAAK,UAAL;MApBsB;cA+BvB,UAAU,QAAQ,UAAU,YAAY,WAAW;AACzD,eAAO,KAAK,SAAS;AACnB,cAAI;AACY,gBAAI,IAAa,KAAK,SAAS,KAAK,QAAnB;AAC/B,gBAAI;AAEF,qBADA,KAAK,SAAS,MAAd,GACO,EAAC,OAAO,EAAW,OAAO,MAAM,MAAhC;UAJP,SAMK,GAAG;AACV,iBAAK,SAAS,cAAc,QAC5B,KAAK,SAAS,OAAO,CAArB;UAFU;AAMd,aAAK,SAAS,MAAd;AACA,YAAI,KAAK,SAAS,mBAAmB;AACjB,cAAmB,KAAK,SAAS;AACnD,eAAK,SAAS,oBAAoB;AAClC,cAAI,EAAiB;AACnB,kBAAM,EAAiB;AAEzB,iBAAO,EAAC,OAAO,EAAiB,QAAQ,MAAM,KAAvC;QAN4B;AAQrC,eAAO,EAAC,OAAyB,QAAY,MAAM,KAA5C;MAvBkD;cAsCnD,UAAU,aAAa,SAAS,GAAQ;AAE9C,aAAK,OAAO,SAAS,GAAW;AAC9B,iBAAO,EAAO,MAAM,CAAb;QADuB;AAKhC,aAAK,QAAQ,SAAS,GAAW;AAC/B,iBAAO,EAAO,OAAO,CAAd;QADwB;AAKjC,aAAK,SAAS,SAAS,GAAO;AAC5B,iBAAO,EAAO,QAAQ,CAAf;QADqB;AAK9B,aAAK,OAAO,QAAZ,IAAwB,WAAW;AACjC,iBAAO;QAD0B;MAjBW;AAmChD,cAAQ,UAAU,kBAAkB,SAAS,GAAW,GAAS;AAC7C,YACd,IAAI,QAAQ,UAAU,WAAW,IAAI,QAAQ,UAAU,QAAQ,CAA9B,CAAjC;AASA,gBAAQ,kBAAkB,EAAU,aACc,QAAQ,eACxD,GAAQ,EAAU,SAD6B;AAGrD,eAAO;MAfwD;cC/yBzD,+BAA+B,SAAS,GAAW;AACzD,iBAAS,EAAqB,GAAO;AACnC,iBAAO,EAAU,KAAK,CAAf;QAD4B;AAIrC,iBAAS,EAAqB,GAAO;AACnC,iBAAO,EAAU,MAAM,CAAhB;QAD4B;AAIrC,eAAO,IAAI,QAAQ,SAAS,GAAS,GAAQ;AAC3C,mBAAS,EAAiD,GAAQ;AAC5D,cAAO,OACT,EAAQ,EAAO,KAAf,IAIA,QAAQ,QAAQ,EAAO,KAAvB,EACK,KAAK,GAAsB,CADhC,EAEK,KAAK,GAAuB,CAFjC;UAN8D;AAYlE,YAAsB,EAAU,KAAV,CAAtB;QAb2C,CAAtC;MATkD;AAoD3D,cAAQ,uCAAuC,SAAS,GAAmB;AACzE,eAAO,QAAQ,6BAA6B,EAAA,CAArC;MADkE;AAa3E,cAAQ,sCAAsC,SAAS,GAAS;AAC9D,eAAO,QAAQ,6BACX,IAAI,QAAQ,UAAU,WAClB,IAAI,QAAQ,UAAU,QAClB,CADJ,CADJ,CADG;MADuD;cC3FxD,SAAS,cAAc,SAAS,GAAM;AAC5C,eAAO,KAAQ,QAAQ;MADqB,GAE3C,WAAW,KAFd;ACJA,cAAQ,SAAS,4BAA4B,SAAS,GAAM;AAC1D,eAAI,IAAa,IAcF,SAAS,GAAe,GAAe;AACpD,cAAI,IAAQ;AACR,uBAAiB,WACnB,IAAoC,OAAO,CAAP;AAEtC,cAAI,IAAM,EAAM;AACZ,cAAI,KAAiB;AAIzB,eAHQ,IAAJ,MACF,IAAI,KAAK,IAAI,IAAI,GAAK,CAAlB,IAEC,IAAI,GAAK,KAAK;AACnB,gBAAI,IAAU,EAAM,CAAN;AACd,gBAAI,MAAY,KAAiB,OAAO,GAAG,GAAS,CAAnB;AAC/B,qBAAO;UAHU;AAMrB,iBAAO;QAhB6C;MAfI,GAmCzD,OAAO,KAnCV;ACYA,cAAQ,aAAa,WAAW;MAAA;AAmHhC,cAAQ,oBAAoB,SAAS,GAAM;AACrC,YAAW,EAAC,MAAM,EAAP;AAKf,UAAS,OAAO,QAAhB,IAA4B,WAAW;AACrC,iBAAO;QAD8B;AAGvC,eAAyC;MATA;cCpHnC,oBAAoB,SAAS,GAAO,GAAW;AAEjD,qBAAiB,WAAgB,KAAQ;AAC7C,YAAI,IAAI,GACJ,IAAO,OACP,IAAO,EACT,MAAM,WAAW;AAGf,cAAI,CAAC,KAAQ,IAAI,EAAM,QAAQ;AAC7B,gBAAI,IAAQ;AACZ,mBAAO,EAAC,OAAO,EAAU,GAAO,EAAM,CAAN,CAAjB,GAAgC,MAAM,MAA9C;UAFsB;AAI/B,cAAO;AACP,iBAAO,EAAC,MAAM,MAAM,OAAO,OAApB;QARQ,EADR;AAYX,UAAK,OAAO,QAAZ,IAAwB,WAAW;AAAE,iBAAO;QAAT;AACnC,eAAO;MAlB8C;ACPvD,cAAQ,SAAS,0BAA0B,SAAS,GAAM;AACxD,eAAI,IAAa,IAUF,WAAW;AACxB,iBAAO,QAAQ,kBAAkB,MAAM,SAAS,GAAG,GAAG;AAAE,mBAAO;UAAT,CAA/C;QADiB;MAX8B,GAgBvD,OAAO,KAhBV;cCJQ,SAAS,wBAAwB,SAAS,GAAM;AACtD,eAAI,IAAa,IAaN,SAAS,GAAO;AAEzB,cAAkB,WAAV,IAAsB,IAAI;AAClC,cAAI,IAAY,CAAA;AAWhB,gBAAM,UAAU,QAAQ,KAAK,MAVC,SAAS,GAAS;AAC1C,kBAAM,QAAQ,CAAd,KAAkC,IAAR,KACxB,IAAQ,MAAM,UAAU,KAAK,KAAK,GAAS,IAAQ,CAA3C,GACZ,EAAU,KAAK,MAAM,GAAW,CAAhC,KAEA,EAAU,KAAK,CAAf;UAL4C,CAUhD;AACA,iBAAO;QAfkB;MAd2B,GAiCrD,OAAO,KAjCV;ACAA,cAAQ,SAAS,2BAA2B,SAAS,GAAM;AACzD,eAAI,IAAa,IAcH,SAAS,GAAU,GAAS;AACxC,cAAI,IAAS,CAAA;AAiBb,gBAAM,UAAU,QAAQ,KAAK,MAhBO,SAAS,GAAS,GAAO;AACvD,gBAAS,EAAS,KAAK,GAAS,GAAS,GAAO,IAAvC;AACT,kBAAM,QAAQ,CAAd,IACF,EAAO,KAAK,MAAM,GAAQ,CAA1B,IAQA,EAAO,KAAK,CAAZ;UAXyD,CAgB7D;AACA,iBAAO;QAnBiC;MAfe,GAsCxD,OAAO,KAtCV;cCKQ,OAAO,SAAS,GAAK,GAAM;AACjC,eAAO,OAAO,UAAU,eAAe,KAAK,GAAK,CAA1C;MAD0B;ACLnC,cAAQ,SAAS,kBAAkB,SAAS,GAAM;AAChD,eAAI,IAAa,IAYH,SAAS,GAAK;AAC1B,cAAI,IAAS,CAAA,GACJ;AAAT,eAAS,KAAO;AACV,oBAAQ,KAAK,GAAK,CAAlB,KACF,EAAO,KAAK,CAAC,GAAK,EAAI,CAAJ,CAAN,CAAZ;AAGJ,iBAAO;QAPmB;MAboB,GAwB/C,OAAO,KAxBV;ACAA,cAAQ,SAAS,iBAAiB,SAAS,GAAM;AAC/C,eAAI,IAAa,IAWJ,SAAS,GAAK;AACzB,cAAI,IAAS,CAAA,GACJ;AAAT,eAAS,KAAO;AACV,oBAAQ,KAAK,GAAK,CAAlB,KACF,EAAO,KAAK,EAAI,CAAJ,CAAZ;AAGJ,iBAAO;QAPkB;MAZoB,GAuB9C,OAAO,KAvBV;U3FaMW,0CAIFG,uBAAOC,OAAO,IAAd,GACSqB,4CAAY,EAACzB,SAAAA,wCAAD,GAOnBE,0CAAoDC,uBAAOC,OAAO,IAAd,GAK7Ca,0CAAU,WAKVvB,uCAAP,MAAA;QAEJ0mB,YAA6B7mB,GAAY;AAAZ,eAAAA,OAAAA;QAAY;QAOzC4B,WAAQ;AACN,iBAAO,KAAK5B;QADN;MATJ;AAaGG,2CAAAu0C,qBAAqB,IAAIv0C,qCAAyB,mBAA7B;2CAErBw0C,uBAAuB,IAAIx0C,qCAChC,qBAD4B;AAIvBA,2CAAAy0C,SAAS,IAAIz0C,qCAAa,QAAjB;AAETA,2CAAAsG,QAAQ,IAAItG,qCAAe,OAAnB;AAERA,2CAAAY,QAAQ,IAAIZ,qCAAY,OAAhB;AAERA,2CAAA00C,QAAQ,IAAI10C,qCAAY,OAAhB;2CAERknC,WAAW,IAAIlnC,qCAAe,UAAnB;AAEXA,2CAAA20C,UAAU,IAAI30C,qCAAe,SAAnB;AAEVA,2CAAA40C,QAAQ,IAAI50C,qCAAY,OAAhB;AAERA,2CAAA60C,eAAe,IAAI70C,qCAAkB,aAAtB;AAEfA,2CAAA80C,2BAA2B,IAAI90C,qCAAc,wBAAlB;2CAE3B+0C,6BAA6B,IAAI/0C,qCACtC,0BADkC;AAI7BA,2CAAAg1C,kBAAkB,IAAIh1C,qCAAsB,gBAA1B;AAMlBA,2CAAAi1C,gBAAgB,IAAIj1C,qCAAe,cAAnB;AAGhBA,2CAAAkgB,aAAa,IAAIlgB,qCAAkB,YAAtB;AAGbA,2CAAA2mB,OAAO,IAAI3mB,qCAAY,MAAhB;2CAGP4hB,SAAS,IAAI5hB,qCAA+C,QAAnD;AA9GlB,UAAAk1C,iCAAA,EAiDa3zC,SAAAA,yCAZAQ,WAAAA,0CArCb;AAsDa/B,qCAAAA,OAAAA;AAuRGpX,qCAAAA,cAAAA;AAtCAF,qCAAAA,WAAAA;qCA2EAG,sBAAAA;AAvDAF,qCAAAA,YAAAA;AAxCAF,qCAAAA,UAAAA;AArJAJ,qCAAAA,WAAAA;AAsFAE,qCAAAA,aAAAA;A4FnMT,UAAMqhB,uCAA2CnJ,uBAAOC,OAAO,IAAd,GAjBxDw0C,+BAAA,EAiBatrC,QAAAA,qCAjBb;A3FeA,UAAMurC,gDACJ,4FASIzzC,oDAAW,EAOf3Y,QAAQ,MAAK;AAEX,cAAMqsD,IAAaD,8CAAKlzC,QAClBgE,IAAK,CAAA;AACX,iBAAS1D,IAAI,GAHEN,KAGCM,GAAYA;AAC1B0D,YAAG1D,CAAH,IAAQ4yC,8CAAK75B,OAAOxI,KAAKg8B,OAAL,IAAgBsG,CAA5B;AAEV,eAAOnvC,EAAGnC,KAAK,EAAR;MAPI,EAPE,GAiBJ/B,qDAAYL,mDAGrBF,kDAAS,GA7Cb0zC,0CAAA,EA0CanzC,WAAAA,kDA1Cb;AAmEgBhZ,8CAAAA,SAAAA;AAVAD,8CAAAA,kBAAAA;ACjCZka,UAAAA,2CAGAnB,gDAqBA2D,8CAUSof,kDAUA6f,kDAUAC,kDAMAC,qEAWA8D,gDAKApjB,gDAKAgwB,gDAKAC,gDAKA1xC,wCAKA2xC,gDAKA5tC,8CAKAvC,2CAKAowC,iDAKAnwC,iDAKAowC,mDAKAC,yDAKAC,kDAKA7wC,qDAKA6jC,oDAKAiN,oDAKAC,oDAKAjN,kDAGAkN,sDAKAvd,sDAMP1xB,oEAkBOwhC,iDAQPrmC,gDAgWOD,+CA5jBbmzC;kDAwBY;AAGRrzC,uDAAa;AAqBb2D,qDAAW;AAKFe,QAAAA,6CAAS;AAKTqe,yDAAere,EAAAA;AAKf4jC,QAAAA,6CAAS;AAKT1F,yDAAe0F,EAAAA;AAKfvlC,QAAAA,6CAAS;yDAKMA,EAAAA;AAMf+/B,4EACX;AAKWzgC,QAAAA,2CAAO;AAKPukC,uDAAavkC,EAAAA;AAKbmhB,uDAAa;AAKbgwB,uDAAa;uDAKA;AAKbzxC,+CAAK;AAKL2xC,uDAAa;AAKb5tC,qDAAW;AAKXvC,kDAAQ;AAKRowC,wDAAc;AAKdnwC,wDAAc;AAKdowC,0DAAgB;gEAKM;AAKtBE,yDAAe;AAKf7wC,4DAAkB;AAKlB6jC,2DAAiB;AAKjBiN,2DAAiB;AAKjBC,2DAAiB;AAKjBjN,yDAAe;6DAGI;AAKnBrQ,6DAAmB;AAM1B1xB,2EAAiC;AAkB1BwhC,wDAAwB,CACnCzjB,EAAAA,4CACA6jB,EAAAA,0CACAE,oDACAC,gDAJmC;uDAQN,CAAA;AAgWlB7mC,sDAAY,EACvBC,YAAAA,gDACA7Y,SAAAA,6CACAD,cAAAA,kDACAK,kBAAAA,qDAJuB;2CA5jBzB;QA8Eam7C,cAAAA,EAAAA;QApBA9f,cAAAA,EAAAA;QAUA6f,cAAAA,EAAAA;QAoDA8Q,YAAAA;QApCA5Q,iCAAAA;QAWA8D,YAAAA,EAAAA;QA6CApjC,aAAAA;QAwEAgjC,aAAAA;QA3IAzjC,QAAAA,EAAAA;QAyDAQ,OAAAA;QA6CAywC,gBAAAA;QAQAC,kBAAAA;QAlBAnN,gBAAAA;QAKAiN,gBAAAA;QAUAhN,cAAAA;QA/HAriC,QAAAA,EAAAA;QAUA4jC,QAAAA,EAAAA;QA6HA5R,kBAAAA;QArDAid,aAAAA;QA7CAtxC,MAAAA,EAAAA;QAmCAyD,UAAAA;QA+bA5F,WAAAA;QAjaA4zC,cAAAA;QALAD,qBAAAA;QALAD,eAAAA;QA9BA7xC,IAAAA;QAfAyhB,YAAAA;QAKAgwB,YAAAA;QAKAC,YAAAA;QAkDAxwC,iBAAAA;MAhKb;AA6ZgBzb,yCAAAA,mBAAAA;AASAkc,yCAAAA,UAAAA,EAAAA;AA2GA5b,yCAAAA,iBAAAA;yCAnGA8b,SAAAA,EAAAA;AAjHArc,yCAAAA,SAAAA;AA1FAH,yCAAAA,OAAAA;AA8QAQ,yCAAAA,WAAAA;AAgBAC,yCAAAA,MAAAA;AAjCAF,yCAAAA,mBAAAA;yCAhCAkc,WAAAA,EAAAA;AArZA1c,yCAAAA,gBAAAA;AA4YAM,yCAAAA,YAAAA;AAmBAqc,yCAAAA,WAAAA,EAAAA;AAxaAhE,yCAAAA,gBAAAA,EAAAA;AChBhB,UAAM0F,6CAAe5G,uBAAOC,OAAO,IAAd,GA+CjB6G,6CAyBAC,yCAA+B,MAmC/BM,+CA8DSiuC,oDAAoC,CAAA,GAqHpCh0C,0CAAY,EAACtX,mCAAAA,gEAAD,GAhTzByqD,+BAAA,EAgTanzC,WAAAA,wCAhTb;mCAqQgByH,sCAAAA,EAAAA;AA8BAD,mCAAAA,eAAAA,EAAAA;AAjDA/e,mCAAAA,4BAAAA;AAvDHurD,mCAAAA,sBAAAA;AAxJGlsD,mCAAAA,mBAAAA;mCAoKAS,qBAAAA;AA7HAN,mCAAAA,mBAAAA;AA2DAG,mCAAAA,qBAAAA;AAtCAD,mCAAAA,cAAAA;AArEAN,mCAAAA,mBAAAA;mCAsBAE,oBAAAA;AAmCAG,mCAAAA,mBAAAA;AA8DAG,mCAAAA,qBAAAA;AAtCAqd,mCAAAA,cAAAA,EAAAA;AAmDApd,mCAAAA,YAAAA;AArGAN,mCAAAA,qBAAAA;A0FnCV,UAAgBisD,yDAAhB,MAAA;QA2BJtvB,cAAA;AAnBA,eAAAlkB,cAAuBS;AAcvB,eAAAU,YAAY;AAGZ,eAAA/D,OAAO;AAGL,eAAKoD,QAAmB0C,EAAAA,6CAAX;AACb,eAAK7D,aAAwB7Y,kDAAX;QAFpB;QAUAitD,SAAM;AACJ,iBAAO,EACL,MAAQ,KAAKr2C,MACb,OAAS,KAAKoD,MAFT;QADH;QAgBCvZ,OAAAA,SACLyc,GACAC,GACArE,GAAU;AAEVA,YAAMo0C,UAAU;AAChBp0C,YAAMkB,QAAQkD,EAAA,SAAiB;AAC/BpE,YAAMU,cAAc2D,EAAUF;AAC9B,iBAAOnE;QALG;QAaZ4B,SAAM;AACJ,iBAAO;QADH;QASNyyC,IAAIC,GAAiB;QAAA;QAYrBC,qBAAkB;AAChB,cAAIlwC;AACA,eAAK3D,gBACP2D,IAAmBvc,+CAAiB,KAAK4Y,WAA7B;cAEV,CAAC2D;AACH,kBAAMjG,MACJ,6EADI;AAKR,iBAAOiG;QAXS;MA1Fd,GAtBN+uC,+CAAA,CAAA;AAsBsBc,mDAAAA,WAAAA;ACChB,UAAOM,sDAAP,cAAsBC,uDAAtB;QAcJ7vB,YAAY8vB,GAAwB;AAClC,gBAAA;AAVO,eAAA30C,aAAa;AAGb,eAAA8B,YAAY;AAUnB,eAAKuyC,UAAqC,gBAA3B,OAAOM;AAGtB,eAAKh0C,cAAcg0C,IAAkBA,IAAkB;QAPrB;MAdhC,GAvBNtB,8CAAA,CAAA;AAuBaoB,kDAAAA,SAAAA;ACCP,UAAOG,mDAAP,cAAqBH,oDAArB;QAoBJ5vB,YACEgwB,GACAF,GACAG,GAA4B;AAExBn0C,cAAck0C,IAAYA,EAAUvwC,UAAUF,KAAKuwC;AACnC,mBAAhBh0C,MACFA,IAAcS;AAEhB,gBAAMT,CAAN;AApBO,eAAA5C,OAAkBwF;AAsBzB,eAAKvB,UAAU6yC,IAAYA,EAAUzwC,KAAKhD;AAC1C,eAAK2zC,aAAaD;QATU;QAiBrBV,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKW;AACR,kBAAU12C,MACR,8FADI;AAKRgG,YAAA,aAAqB,KAAK0wC;AAC1B1wC,YAAA,UAAkB,KAAKrC;AACvB,iBAAOqC;QAVM;QAsBRzc,OAAAA,SAASyc,GAAiBC,GAAsBrE,GAAW;AAC1D+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI20C,kDAHE;AAKjBI,YAASD,aAAa1wC,EAAA;AACtB2wC,YAAShzC,UAAUqC,EAAA;AACnB,iBAAO2wC;QARyD;MA9D9D,GA0EMC;AAAZ,OAAA,SAAYA,GAAW;AACrBA,UAAA5D,QAAA;AACA4D,UAAArF,YAAA;AACAqF,UAAAC,gBAAA;MAHqB,GAAXD,2DAAAA,yDAAW,CAAA,EAAvB;+CAW2B92C,qCAAKsG,OAAkBlB,2CAAOqxC,gDAAzD;AA7GA,UAAAvB,4CAAA,CAAA;AAwBauB,gDAAAA,QAAAA;AA0EDK,gDAAAA,cAAAA;A3FvFZ,UAAM9sC,yCAAY,KAMLgtC,6CACX,kBAAkBC,cAClB,CAAC,EACCA,WAAA,YACA7pC,SAASmE,mBACT,kBAAkBnE,SAASmE,oBAG7B,EACE,CAAA0lC,WAAA,aACC,CAAAA,WAAA,UAAA,kBACE,CAAAA,WAAA,UAAA,mBAIH/sC,gDAAkC,MAMzBY,yCAAuC;QAClD,WAAa,CAAC,aAAD;QACb,YAAc,CAAC,cAAD;QACd,YAAc,CAAC,cAAD;QACd,WAAa,CAAC,aAAD;QACb,UAAY,CAAC,YAAD;QACZ,WAAa,CAAC,aAAD;QACb,SAAW,CAAC,aAAa,eAAd;QACX,UAAY,CAAC,WAAD;QACZ,aAAe,CAAC,eAAD;MATmC,GAahDhB,wCAA+B,GAnDnCorC,8BAAA,EAiBa8B,eAAAA,4CAqBAlsC,WAAAA,uCAtCb;AAwIgB/f,kCAAAA,uBAAAA;AA5CAH,kCAAAA,uBAAAA;kCA8BAE,8BAAAA;AA1DAJ,kCAAAA,YAAAA;AAgBAC,kCAAAA,WAAAA;AAyBAE,kCAAAA,oBAAAA;A4FhGhB,UAAIqsD,qDAEAC,iDAEAC,iDAEAC,gDAEAC,kDAEAC,+CAEAC,iDAEAC,8CAEAC,iDAEAC;gBAEOC,GAAG;AASZx4B,iBAASA,EAAIvf,GAAY;AACvB,iBAAOg4C,EAAStkC,SAAS1T,EAAKyW,YAAL,CAAlB;QADgB;AARzB4gC,8DAAeU;AACf,cAAMC,IAAWX,oDAAa5gC,YAAb;AAgBjB6gC,0DAAW/3B,EAAI,QAAJ;AAIXg4B,0DAAWh4B,EAAI,QAAJ;AACXi4B,yDAAUj4B,EAAI,OAAJ,KAAgB,CAACg4B;AAM3BE,2DAAYl4B,EAAI,SAAJ;AACN04B,YACJb,WAAA,aAA2BA,WAAA,UAAA;AAC7BM,wDAASn4B,EAAI,MAAJ,KAAgBA,EAAI,WAAJ,KAAqC,IAAjB04B;AAC7CN,0DAAWp4B,EAAI,QAAJ,KAAiB,CAACm4B;AAC7BE,uDAAQr4B,EAAI,WAAJ;AAIRs4B,0DAAWH,iDAAWD,oDAAa,CAACl4B,EAAI,QAAJ,KAAkBA,EAAI,MAAJ;AACtDu4B,0DAAW,CAACD,oDAAaF,mDAAYF;MAvCzB,GAwCVL,WAAA,aAA2BA,WAAA,UAAA,aAAyC,EAxCxE;UA0CaW,6CAAcV,qDAEdp4B,gDAAkBq4B,iDAElBY,+CAAiBV,gDAEjBW,iDAAmBV,kDAEnBxG,8CAAgByG,+CAEhBU,gDAAkBT,iDAElB/rC,6CAAegsC,8CAEfS,gDAAkBP,iDArF/BzC,wCAAA;QA6Ea8C,SAAAA;QAFAD,OAAAA;QAIAjH,MAAAA;QAEAmH,QAAAA;QARAn5B,QAAAA;QAUArT,KAAAA;QAEAysC,QAAAA;QAdAN,KAAAA;MAvEb;A3FsBA,UAAMprC,6DAAuB,IAOvBC,6DAAuB,KA7B7ByoC,uCAAA,CAAA;AA+FgBjqD,2CAAAA,OAAAA;AAjDAD,2CAAAA,kBAAAA;AAqLAM,2CAAAA,uBAAAA;2CAvCAF,gBAAAA;AApCAD,2CAAAA,gBAAAA;AAsDAE,2CAAAA,aAAAA;AAxEAH,2CAAAA,SAAAA;ACtIhB,UAAAgqD,oCAAA,CAAA;AAgBgB3pD,wCAAAA,aAAAA;A2FIhB,UAAM4sD,sDAAN,MAAA;QAOEzxB,YAAY7mB,GAAY;AACtB,eAAKu4C,QAAQv4C;QADS;QASxB4B,WAAQ;AACN,iBAAO,KAAK22C;QADN;MAhBV;AACSD,0DAAAE,eAAe,IAAIF,oDAA0B,cAA9B;AACfA,0DAAAG,cAAc,IAAIH,oDAAwB,aAA5B;AACdA,0DAAAI,cAAc,IAAIJ,oDAAwB,aAA5B;0DACdK,eAAe,IAAIL,oDAA0B,cAA9B;UAoBXM,4DAAP,MAAA;QAAN/xB,cAAA;AAMmB,eAAAgyB,gBAAgB,oBAAIC;AAGpB,eAAAC,2BAA2B,oBAAID;QATlD;QAkBEE,aAAaC,GAA+B/4C,GAA4B;AAEtE,gBAAMkG,IAAK6yC,EAAcC,UAAU9yC;AACnC,cAAI,CAAClG,KAAsB,KAAK24C,cAAct5B,IAAInZ,CAAvB,GAA4B;AAKjD,gBAAA;AAJJ,kBAAM/F,MACJ,aACE+F,IACA,2BAC4B+yC,SAA5BA,IAAAA,KAAKN,cAAchvD,IAAIuc,CAAvB+yC,KAA4BA,SAA5BA,EAA4BA,gBAC5B,kBALE;UAD+C;AASvD,eAAKN,cAAcz5B,IAAIhZ,GAAI6yC,CAA3B;AACMG,cAAqB,CAAA;AAC3B,eAAS12C,IAAI,GAAGA,IAAIu2C,EAAcE,aAAa/2C,QAAQM,KAAK;AAC1D,kBAAM22C,IAAav4C,OAAOm4C,EAAcE,aAAaz2C,CAA3B,CAAP,EAAsCpC,YAAtC;AACnB84C,cAAmB52C,KAAK62C,CAAxB;AACA,gBAAK,KAAKN,yBAAyBx5B,IAAI85B,CAAlC,GAEE;AACL,kBAAA;uBAAA,IAAA,KAAKN,yBAAyBlvD,IAAIwvD,CAAlC,MAAA,EAA+C72C,KAAK4D,CAApD;YADK;AADL,mBAAK2yC,yBAAyB35B,IAAIi6B,GAAY,CAACjzC,CAAD,CAA9C;UAJwD;AAS5D,eAAKyyC,cAAchvD,IAAIuc,CAAvB,EAA4B+yC,eAAeC;QAvB2B;QA+BxEE,gBAAgBlzC,GAAU;AACxB,gBAAM6yC,IAAgB,KAAKJ,cAAchvD,IAAIuc,CAAvB;AACtB,cAAK6yC,GAAL;AAGA,qBAASv2C,IAAI,GAAGA,IAAIu2C,EAAcE,aAAa/2C,QAAQM,KAAK;AAC1D,oBAAM22C,IAAav4C,OAAOm4C,EAAcE,aAAaz2C,CAA3B,CAAP,EAAsCpC,YAAtC;AACR5U,4DAAW,KAAKqtD,yBAAyBlvD,IAAIwvD,CAAlC,GAAgDjzC,CAAtE;YAF0D;AAI5D,iBAAKyyC,cAAc94B,OAAO3Z,CAA1B;UAPA;QAFwB;QAkB1BmzC,cAAiBnzC,GAAYizC,GAAkC;AAC7D,cAAI,CAAC,KAAKG,aAAapzC,CAAlB;AACH,kBAAM/F,MACJ,6BACEg5C,IACA,gBACAjzC,IACA,8CALE;AAQR,cAAI,KAAKqzC,cAAcrzC,GAAIizC,CAAvB;AACFr4C,oBAAQxG,KACN,aAAa4L,IAAK,6BAA6BizC,IAAa,GAD9D;eADF;AAMAA,gBAAa,GAAGA,CAAH,GAAgB/4C,YAAhB;AACb,gBAAA;AAAA,qBAAA,IAAA,KAAKu4C,cAAchvD,IAAIuc,CAAvB,MAAA,EAA4B+yC,aAAa32C,KAAK62C,CAA9C;AACA,gBAAA;AAAA,qBAAA,IAAA,KAAKN,yBAAyBlvD,IAAIwvD,CAAlC,MAAA,EAA+C72C,KAAK4D,CAApD;UARA;QAV6D;QA2B/DszC,iBAAoBtzC,GAAYizC,GAAkC;AAChE,cAAI,CAAC,KAAKG,aAAapzC,CAAlB;AACH,kBAAM/F,MACJ,gCACEg5C,IACA,gBACAjzC,IACA,8CALE;AAQH,eAAKqzC,cAAcrzC,GAAIizC,CAAvB,KAULA,IAAa,GAAGA,CAAH,GAAgB/4C,YAAhB,GACF5U;YAAW,KAAKmtD,cAAchvD,IAAIuc,CAAvB,EAA4B+yC;YAAcE;UAAhE,GACW3tD,8CAAW,KAAKqtD,yBAAyBlvD,IAAIwvD,CAAlC,GAAgDjzC,CAAtE,KAXEpF,QAAQxG,KACN,aACE4L,IACA,8BACAizC,IACA,aALJ;QAX8D;QAgClEI,cAAiBrzC,GAAYizC,GAAkC;AAC7DA,cAAa,GAAGA,CAAH,GAAgB/4C,YAAhB;AACb,iBACE,KAAKu4C,cAAct5B,IAAInZ,CAAvB,KACA,KAAKyyC,cAAchvD,IAAIuc,CAAvB,EAA4B+yC,aAAazlC,SAAS2lC,CAAlD;QAJ2D;QAc/DG,aAAapzC,GAAU;AACd,cAAA;AAAP,iBAAmC8yC,SAA5BA,IAAAA,KAAKL,cAAchvD,IAAIuc,CAAvB8yC,KAA4BA,SAA5BA,EAA4BA;QADd;QAWvBS,cACEN,GACAO,GAAe;AAEfP,cAAa,GAAGA,CAAH,GAAgB/4C,YAAhB;AACPu5C,cAAe,KAAKd,yBAAyBlvD,IAAIwvD,CAAlC;AACrB,cAAI,CAACQ;AACH,mBAAO,CAAA;AAET,gBAAMC,IAAkB,CAAA;AACxB,cAAIF,GAAQ;AACV,kBAAMG,IAAsC,CAAA;AAC5CF,cAAarX,QAASp8B,OAAM;AAC1B2zC,gBAAkBv3C,KAAK,KAAKq2C,cAAchvD,IAAIuc,CAAvB,CAAvB;YAD0B,CAA5B;AAGA2zC,cAAkB1+B,KAAK,SAAU8Q,GAAG7M,GAAC;AACnC,qBAAO6M,EAAE0lB,SAASvyB,EAAEuyB;YADe,CAArC;AAGAkI,cAAkBvX,QAAQ,SAAUwX,GAAc;AAChDF,gBAAWt3C,KAAKw3C,EAAed,SAA/B;YADgD,CAAlD;UARU;AAYVW,cAAarX,QAASp8B,OAAM;AAC1B0zC,gBAAWt3C,KAAK,KAAKq2C,cAAchvD,IAAIuc,CAAvB,EAA4B8yC,SAA5C;YAD0B,CAA5B;AAIF,iBAAOY;QAxBQ;MAzJb;AACGlB,gEAAAN,aAAaA;AA7CtB,UAAAjD,0CAAA,CAAA;AA4CauD,8CAAAA,mBAAAA;A1FnCb,UAAI5rC,sCAAW,OAoDXC,qCAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA7DdooC,4BAAA,CAAA;AAmCgB1pD,gCAAAA,SAAAA;AAlBAnD,gCAAAA,WAAAA;A2FCV,UAAO+oB,qDAAP,MAAA;QAKJsV,YACS5a,GACAE,GAAS;AADT,eAAAF,IAAAA;AACA,eAAAE,IAAAA;QAAS;QAQlBmvB,QAAK;AACH,iBAAO,IAAI/pB,mDAAW,KAAKtF,GAAG,KAAKE,CAA5B;QADJ;QAUL9G,MAAMurB,GAAS;AACb,eAAK3kB,KAAK2kB;AACV,eAAKzkB,KAAKykB;AACV,iBAAO;QAHM;QAcftO,UAAU23B,GAAYC,GAAU;AAC9B,eAAKjuC,KAAKguC;AACV,eAAK9tC,KAAK+tC;AACV,iBAAO;QAHuB;QAazBhX,OAAAA,OAAO/W,GAAuB7M,GAAqB;AACxD,iBAAI6M,MAAM7M,IACD,OAEJ6M,KAAM7M,IAGJ6M,EAAElgB,MAAMqT,EAAErT,KAAKkgB,EAAEhgB,MAAMmT,EAAEnT,IAFvB;QAL+C;QAiBnDguC,OAAAA,SAAShuB,GAAe7M,GAAa;AAC1C,gBAAMwP,IAAK3C,EAAElgB,IAAIqT,EAAErT;AACbgjB,cAAK9C,EAAEhgB,IAAImT,EAAEnT;AACnB,iBAAO8G,KAAKmc,KAAKN,IAAKA,IAAKG,IAAKA,CAAzB;QAHmC;QAYrCuN,OAAAA,UAAUrQ,GAAa;AAC5B,iBAAOlZ,KAAKmc,KAAKjD,EAAElgB,IAAIkgB,EAAElgB,IAAIkgB,EAAEhgB,IAAIggB,EAAEhgB,CAA9B;QADqB;QAYvBsI,OAAAA,WACL0X,GACA7M,GAAwB;AAExB,iBAAO,IAAI/N,mDAAW4a,EAAElgB,IAAIqT,EAAErT,GAAGkgB,EAAEhgB,IAAImT,EAAEnT,CAAlC;QAFiB;QAYnBkW,OAAAA,IAAI8J,GAA0B7M,GAAwB;AAC3D,iBAAO,IAAI/N,mDAAW4a,EAAElgB,IAAIqT,EAAErT,GAAGkgB,EAAEhgB,IAAImT,EAAEnT,CAAlC;QADoD;MA3GzD,GAlBNkpC,yCAAA,CAAA;AAkBa9jC,6CAAAA,aAAAA;A1FLN,UAAMrD,0CAAS,8BAKT0gC,2CAAU,gCAKVC,4CAAW,gCAMZzX;AAAZ,OAAA,SAAYA,GAAQ;AAClBA,UAAAA,EAAAC,eAAA,CAAA,IAAA;AACAD,UAAAA,EAAAQ,YAAA,CAAA,IAAA;AACAR,UAAAA,EAAAgjB,eAAA,CAAA,IAAA;MAHkB,GAARhjB,8CAAAA,4CAAQ,CAAA,EAApB;UAOIhoB,+CAA8C,MAG9CD,kDAAiB,GAGjBU,iDAAiD,MA1CrDwlC,kCAAA,EAkBazG,SAAAA,yCAlBb;AA6BYxX,sCAAAA,WAAAA;AAhBClpB,sCAAAA,SAAAA;AAUA2gC,sCAAAA,WAAAA;sCAqDGhjD,WAAAA;AAxBAD,sCAAAA,mBAAAA;AA2LAW,sCAAAA,mBAAAA;AA2BAC,sCAAAA,iCAAAA;AAnEAF,sCAAAA,eAAAA;sCA/EAN,WAAAA;AAsBAE,sCAAAA,cAAAA;AAmLAO,sCAAAA,qBAAAA;AAzNAV,sCAAAA,cAAAA;AAbAD,sCAAAA,gBAAAA;AAwCAG,sCAAAA,aAAAA;sCAgCAE,kBAAAA;AAYAC,sCAAAA,sBAAAA;AAWAC,sCAAAA,qBAAAA;A2FzKV,UAAO4vC,uCAAP,MAAA;QAwDJpV,YAA6B1R,GAAe;AAAf,eAAAA,UAAAA;QAAe;QAO5CvT,WAAQ;AACN,iBAAO,KAAKuT;QADN;MA/DJ;AAEG8mB,2CAAAG,UAAU,IAAIH,qCAAuB,SAA3B;AAEVA,2CAAAC,SAAS,IAAID,qCAAsB,QAA1B;AAETA,2CAAAoe,WAAW,IAAIpe,qCAAwB,UAA5B;AAEXA,2CAAA8S,OAAO,IAAI9S,qCAAoB,MAAxB;2CAEPqe,cAAc,IAAIre,qCAA2B,aAA/B;AAEdA,2CAAAse,sBAAsB,IAAIte,qCAC/B,qBAD2B;AAItBA,2CAAAue,UAAU,IAAIve,qCAAuB,SAA3B;AAEVA,2CAAAwe,UAAU,IAAIxe,qCAAuB,SAA3B;AAEVA,2CAAAye,iBAAiB,IAAIze,qCAA8B,gBAAlC;2CAEjB0e,eAAe,IAAI1e,qCAA4B,cAAhC;AAEfA,2CAAA2e,qBAAqB,IAAI3e,qCAC9B,oBAD0B;AAIrBA,2CAAA4e,SAAS,IAAI5e,qCAAsB,QAA1B;AAETA,2CAAA6e,gBAAgB,IAAI7e,qCAA6B,eAAjC;AAEhBA,2CAAA8e,IAAI,IAAI9e,qCAAiB,GAArB;2CAEJ+e,QAAQ,IAAI/e,qCAAqB,OAAzB;AAERA,2CAAAgf,OAAO,IAAIhf,qCAAoB,MAAxB;AAEPA,2CAAAif,OAAO,IAAIjf,qCAAoB,MAAxB;AAEPA,2CAAAkf,UAAU,IAAIlf,qCAAuB,SAA3B;AAEVA,2CAAAmf,UAAU,IAAInf,qCAAuB,SAA3B;2CAEVof,OAAO,IAAIpf,qCAAoB,MAAxB;AAEPA,2CAAA0S,MAAM,IAAI1S,qCAAmB,KAAvB;AAENA,2CAAAqf,OAAO,IAAIrf,qCAAoB,MAAxB;AAEPA,2CAAAsf,QAAQ,IAAItf,qCAAqB,OAAzB;AAnEjB,UAAAoZ,kCAAA,CAAA;AAiBapZ,sCAAAA,MAAAA;ACCP,UAAO9pB,yCAAP,MAAA;QAOJ0U,YACSvW,GACA4B,GACA3B,GACA0B,GAAa;AAHb,eAAA3B,MAAAA;AACA,eAAA4B,SAAAA;AACA,eAAA3B,OAAAA;AACA,eAAA0B,QAAAA;QAAa;QAGtBupC,YAAS;AACP,iBAAO,KAAKtpC,SAAS,KAAK5B;QADnB;QAIToQ,WAAQ;AACN,iBAAO,KAAKzO,QAAQ,KAAK1B;QADnB;QAWR/B,SAASvC,GAAWE,GAAS;AAC3B,iBACEF,KAAK,KAAKsE,QAAQtE,KAAK,KAAKgG,SAAS9F,KAAK,KAAKmE,OAAOnE,KAAK,KAAK+F;QAFvC;QAa7BgH,WAAWuiC,GAAW;AACpB,iBAAO,EACL,KAAKlrC,OAAOkrC,EAAMxpC,SAClB,KAAKA,QAAQwpC,EAAMlrC,QACnB,KAAKD,MAAMmrC,EAAMvpC,UACjB,KAAKA,SAASupC,EAAMnrC;QALF;MA1ClB,GAlBN+kC,mCAAA,CAAA;AAkBaljC,uCAAAA,OAAAA;ACAP,UAAOnB,yCAAP,MAAA;QAKJ6V,YACSle,GACAE,GAAc;AADd,eAAAF,QAAAA;AACA,eAAAE,SAAAA;QAAc;QAWhBq6B,OAAAA,OAAO/W,GAAgB7M,GAAc;AAC1C,iBAAI6M,MAAM7M,IACD,OAEJ6M,KAAM7M,IAGJ6M,EAAExjB,UAAU2W,EAAE3W,SAASwjB,EAAEtjB,WAAWyW,EAAEzW,SAFpC;QALiC;QAcrCsK,OAAAA,IAAIgZ,GAAS7M,GAAO;AACzB,iBAAO,IAAItO,uCAAKiC,KAAKE,IAAIgZ,EAAExjB,OAAO2W,EAAE3W,KAApB,GAA4BsK,KAAKE,IAAIgZ,EAAEtjB,QAAQyW,EAAEzW,MAArB,CAArC;QADkB;QAQpBqK,OAAAA,IAAIiZ,GAAS7M,GAAO;AACzB,iBAAO,IAAItO,uCAAKiC,KAAKC,IAAIiZ,EAAExjB,OAAO2W,EAAE3W,KAApB,GAA4BsK,KAAKC,IAAIiZ,EAAEtjB,QAAQyW,EAAEzW,MAArB,CAArC;QADkB;MAxCvB,GAlBNwsC,mCAAA,CAAA;AAkBarkC,uCAAAA,OAAAA;A5FsMN,UAAM9O,+CAAY,EACvBvV,iBAAAA,mDADuB,GAxNzB0oD,oCAAA,EAwNanzC,WAAAA,6CAxNb;AAmIgBlV,wCAAAA,eAAAA;AAvDAH,wCAAAA,mBAAAA;AAqGAK,wCAAAA,iCAAAA;wCApFAJ,gBAAAA;AA1EAJ,wCAAAA,UAAAA;AAiGAK,wCAAAA,wBAAAA;AAqCAE,wCAAAA,0BAAAA;ACpIhB,UAAMumB,iDAAW,qDAOXI,uDACJ,gFA+KW1R,kDAAY,EACvBsR,UAAAA,gDACAI,gBAAAA,qDAFuB,GA5MzByhC,uCAAA,EA4ManzC,WAAAA,gDA5Mb;2CA6HgB5U,oBAAAA;AAzCAF,2CAAAA,oBAAAA;AA9CAD,2CAAAA,gBAAAA;AAsEAE,2CAAAA,kBAAAA;AAkCAE,2CAAAA,wBAAAA;2CA0CAC,wBAAAA;A4FxJV,UAAOyqB,6CAAP,MAAA;QA4HJ4O,YACUvgB,GACSsR,GACjB8jC,GACAC,GACAC,GAAmB;AAJX,eAAAt1C,YAAAA;AACS,eAAAsR,aAAAA;AArGX,eAAAikC,iBAAiC;AAOzC,eAAAC,QAAQ;AAQA,eAAAC,SAAS,IAAIxqC,mDAAW,GAAG,CAAlB;AA2BT,eAAAyqC,kBAFA,KAAAC,iBANA,KAAAC,eAHA,KAAAC,kBAPA,KAAAC,iBAAiB;AAwBjB,eAAAC,mBAHA,KAAAC,kBAAkB;AAqB1B,eAAAjsC,WAAW,IAAIkB,mDAAW,GAAG,CAAlB;AAwBX,eAAAgrC,sBAHA,KAAAC,oBAA+C;AAmB7C,eAAKC,OAAOf,KAAY;AAExB,eAAK5iC,SACY1V,WAAfw4C,IACIA,IACA3jC,2CAAUykC;AAEZvuC,cACF,sBAAsB,KAAKyJ,aAAa,eAAe;AACrD+jC,gBACFxtC,KAAa,MAAMwtC;AAWrB,eAAKgB,WAAe/wD,kDAAiBqwC,qCAAI0S,KAAK,EAAC,SAASxgC,EAAV,CAA9B;AAEVhL,cAAYvX,kDAAiBqwC,qCAAI8e,GAAG,CAAA,GAAI,KAAK4B,QAArC;AAEd,eAAKC,gBAAoBhxD;YACvBqwC,qCAAIof;YACJ,EAAC,SAAS,6BAAV;YACAl4C;UAHmB;AAMf6+B,cAAS/uB,KAAK+Y,OAAO/T,2CAAUC,qBAAqB,KAAK,CAAhD;AACf,eAAK2kC,YAAgBjxD,kDACnBqwC,qCAAIof,MACJ,EAAC,SAAS,0BAA0B,IAAMrZ,GAAQ,IAAMA,EAAxD,GACA7+B,CAHe;AAMjB,eAAKmD,UACFypC,gBADH,EAEGC,UAAU,KAAK6M,WAAW,mBAAmB,MAFhD;AAGA,eAAKv2C,UACFypC,gBADH,EAEGC,UAAU,KAAK6M,WAAW,oBAAoB,cAFjD;AAKI3wD;YAAY,KAAKywD;YAAU,KAAKr2C,UAAU+B,aAAf;UAA/B;AAEA,eAAKy0C,oBAAL;AAEIllC,eACF,KAAKmlC,mBAAmB,SACxB,KAAKC,qBAAqB,QAE1B,KAAKD,mBAAmB,UACxB,KAAKC,qBAAqB;AAG5B,eAAKC,yBAAuC9xD,sDAC1C,KAAKyxD,eACL,eACA,MACA,KAAKM,cAJuB;AAM9B,eAAKC,4BAA0ChyD,sDAC7C,KAAK0xD,WACL,eACA,MACA,KAAKO,iBAJ0B;QAlEd;QA6EbN,sBAAmB;AACzB,gBAAM5kC,IAAqBD,2CAAUC;eAC5BN,cACP,KAAKglC,cAAc7zC,aAAa,UAAUjI,OAAOoX,CAAP,CAA1C,GACA,KAAKykC,SAAS5zC,aAAa,UAAUjI,OAAOoX,CAAP,CAArC,GACA,KAAK2kC,UAAU9zC,aAAa,UAAUjI,OAAOoX,IAAqB,CAA5B,CAAtC,GACA,KAAK2kC,UAAU9zC,aAAa,KAAK,KAAjC,MAEA,KAAK6zC,cAAc7zC,aAAa,SAASjI,OAAOoX,CAAP,CAAzC,GACA,KAAKykC,SAAS5zC,aAAa,SAASjI,OAAOoX,CAAP,CAApC,GACA,KAAK2kC,UAAU9zC,aAAa,SAASjI,OAAOoX,IAAqB,CAA5B,CAArC,GACA,KAAK2kC,UAAU9zC,aAAa,KAAK,KAAjC;QAXuB;QAmB3B7T,UAAO;AACL,eAAK+8C,QAAL;AACc5mD,uDAAO,KAAK4xD,sBAA1B;AACc5xD,uDAAO,KAAK8xD,yBAA1B;sDAEe,KAAKR,QAApB;AACA,eAAKr2C,UAAUypC,gBAAf,EAAiCsN,YAAY,KAAKR,SAAlD;QANK;QAgBCS,sBAAsBxwC,GAAa;AAMzC,iBAJEA,IADW,KAATA,KAAcimB,MAAMjmB,CAAN,IACR,IAEAmG,KAAKC,IAAIpG,GAAO,KAAKqvC,eAArB;QAJ+B;QAenCoB,gBAAgBC,GAAiB;AACvC,eAAKtB,eAAesB;AACpB,eAAKX,UAAU9zC,aACb,KAAKg0C,kBACLj8C,OAAO,KAAKo7C,YAAZ,CAFF;QAFuC;QAejCuB,wBAAwB3wC,GAAa;AAS3C,iBAPEA,IADW,KAATA,KAAcimB,MAAMjmB,CAAN,IACR,IAKAmG,KAAKC,IAAIpG,GAAO,KAAKqvC,kBAAkB,KAAKD,YAA5C;QAPiC;QAkB7CwB,kBAAkBC,GAAmB;AACnC,eAAK1B,iBAAiB0B;AACtB,eAAKd,UAAU9zC;YACb,KAAKi0C;YACLl8C,OAAO,KAAKm7C,cAAZ;UAFF;QAFmC;QAc7B2B,mBAAmBC,GAAe;AACxC,eAAK1B,kBAAkB0B;AACvB,eAAKlB,SAAS5zC,aACZ,KAAKg0C,kBACLj8C,OAAO,KAAKq7C,eAAZ,CAFF;AAIA,eAAKS,cAAc7zC,aACjB,KAAKg0C,kBACLj8C,OAAO,KAAKq7C,eAAZ,CAFF;QANwC;QAqB1C2B,YAAY7xC,GAAWE,GAAS;AAC9B,eAAKkE,SAASpE,IAAIA;AAClB,eAAKoE,SAASlE,IAAIA;AAKdhgB,2DAAgB,KAAKwwD,UADP,gBAFJ,KAAKtsC,SAASpE,IAAI,KAAK8vC,OAAO9vC,KAEH,SAD3B,KAAKoE,SAASlE,IAAI,KAAK4vC,OAAO5vC,KACa,KACzD;QAP8B;QAgBhClD,OAAO80C,GAAqB;AAG1B,cAAI,CAACC,MACHA,IAAc,KAAK13C,UAAU23C,WAAf,GACV,CAACD;AAEH;eAKGnC,kBACL5jC,2CAAUimC,qBAAqBF,GAAa,KAAKnC,cAAjD,MAKE,KAAKjkC,aACP,KAAKumC,iBAAiBH,CAAtB,IAEA,KAAKI,eAAeJ,CAApB,GAGF,KAAKnC,iBAAiBmC,GAGtB,KAAKK,cAAL;QA3B0B;QAsCpBC,mBAAmBN,GAAoB;AAC7C,iBAAK,KAAKnC,iBAIR,KAAKA,eAAe0C,cAAcP,EAAYO,aAC9C,KAAK1C,eAAe2C,eAAeR,EAAYQ,cAC/C,KAAK3C,eAAe4C,iBAAiBT,EAAYS,gBACjD,KAAK5C,eAAe6C,gBAAgBV,EAAYU,cANzC;QAFoC;QAkBvCP,iBAAiBH,GAAoB;AACvC,eAAKM,mBAAmBN,CAAxB,IACF,KAAKW,qBAAqBX,CAA1B,IAEA,KAAKY,wBAAwBZ,CAA7B;QAJyC;QAgB7CW,qBAAqBX,GAAoB;AACvC,cAAIa,IAAWb,EAAYO,YAA0B,IAAd,KAAKzlC;AACxC,eAAK2jC,SAEPoC,KAAY5mC,2CAAUC;AAExB,eAAK0lC,mBAAmB3qC,KAAKE,IAAI,GAAG0rC,CAAZ,CAAxB;AAEIC,cAAcd,EAAYS,eAAe,KAAK3lC;AAC9C,eAAK2jC,QAAQ,KAAKn2C,UAAU0R,QAC9B8mC,KAAe7mC,2CAAUC;AAU3B,eAAK4lC,YAAYgB,GAJfd,EAAYU,cACZV,EAAYQ,aACZvmC,2CAAUC,qBACV,KAAKY,MACP;AAIA,eAAK8lC,wBAAwBZ,CAA7B;QAxBuC;QAkCzCY,wBAAwBZ,GAAoB;AAC1C,cAAIA,EAAYO,aAAaP,EAAYe;AAGvC,iBAAKxB,gBAAgB,KAAKpB,eAA1B,GACA,KAAKuB,kBAAkB,CAAvB,GACK,KAAKjB,QAIR,KAAKuC,WAAW,KAAhB;eAGG;AAAK,iBAAKvC,QAEf,KAAKuC,WAAW,IAAhB;AAIF,gBAAI9C,IACD,KAAKC,kBAAkB6B,EAAYO,YAAaP,EAAYe;AAC/D7C,gBAAe,KAAKoB,sBAAsBpB,CAA3B;AACf,iBAAKqB,gBAAgBrB,CAArB;AAWM+C,gBAAoBjB,EAAYe,cAAcf,EAAYO;AAKhE,gBAAMW,IAAkB,KAAK/C,kBAAkB,KAAKD;AAChDiD,iBALwBnB,EAAY54C,WAAW44C,EAAYnsC,cAErBotC,IAGvBC;AACnBC,gBAAe,KAAK1B,wBAAwB0B,CAA7B;AACf,iBAAKzB,kBAAkByB,CAAvB;AAIA,iBAAKrD,QAAQoD,IAAkBD;UAhCxB;QAbmC;QAsDpCb,eAAeJ,GAAoB;AACrC,eAAKM,mBAAmBN,CAAxB,IACF,KAAKoB,mBAAmBpB,CAAxB,IAEA,KAAKqB,sBAAsBrB,CAA3B;QAJuC;QAe3CoB,mBAAmBpB,GAAoB;AACrC,cAAIa,IAAWb,EAAYQ,aAA2B,IAAd,KAAK1lC;AACzC,eAAK2jC,SAEPoC,KAAY5mC,2CAAUC;AAExB,eAAK0lC,mBAAmB3qC,KAAKE,IAAI,GAAG0rC,CAAZ,CAAxB;AAUA,eAAKf,YARe,KAAKx3C,UAAU0R,MAC/BgmC,EAAYS,eAAe,KAAK3lC,SAChCklC,EAAYS,eACZT,EAAYO,YACZtmC,2CAAUC,qBACV,KAAKY,QAEWklC,EAAYU,cAAc,KAAK5lC,MACnD;AAIA,eAAKumC,sBAAsBrB,CAA3B;QApBqC;QA8BvCqB,sBAAsBrB,GAAoB;AACxC,cAAIA,EAAYQ,cAAcR,EAAYsB;AAGxC,iBAAK/B,gBAAgB,KAAKpB,eAA1B,GACA,KAAKuB,kBAAkB,CAAvB,GACK,KAAKjB,QAIR,KAAKuC,WAAW,KAAhB;eAGG;AAAK,iBAAKvC,QAEf,KAAKuC,WAAW,IAAhB;AAIF,gBAAI9C,IACD,KAAKC,kBAAkB6B,EAAYQ,aACpCR,EAAYsB;AACdpD,gBAAe,KAAKoB,sBAAsBpB,CAA3B;AACf,iBAAKqB,gBAAgBrB,CAArB;AAWM+C,gBAAoBjB,EAAYsB,eAAetB,EAAYQ;AAKjE,gBAAMU,IAAkB,KAAK/C,kBAAkB,KAAKD;AAChDiD,iBALwBnB,EAAY74C,UAAU64C,EAAYjsC,aAEpBktC,IAGvBC;AACnBC,gBAAe,KAAK1B,wBAAwB0B,CAA7B;AACf,iBAAKzB,kBAAkByB,CAAvB;AAIA,iBAAKrD,QAAQoD,IAAkBD;UAjCxB;QAbiC;QAuD1CtrD,YAAS;AACP,iBAAO,KAAK2oD;QADL;QAUTiD,oBAAoBtxB,GAAgB;AAClC,gBAAMuxB,IAAoBvxB,MAAY,KAAKouB;AAE3C,eAAKA,mBAAmBpuB;AACpBuxB,eACF,KAAKC,eAAL;QALgC;QAepCT,WAAW/wB,GAAgB;AAIzB,cAAI,KAAKwuB;AACP,kBAAMp8C,MAAM,mDAAN;AAER,eAAKq/C,mBAAmBzxB,CAAxB;QAPyB;QAkB3ByxB,mBAAmBzxB,GAAgB;AACjC,gBAAMuxB,IAAoBvxB,MAAY,KAAKt6B,UAAL;AACtC,eAAK2oD,kBAAkBruB;AACnBuxB,eACF,KAAKC,eAAL;QAJ+B;QAcnCA,iBAAc;AAGP,eAAKpD,oBAGD,KAAK1oD,UAAL,IAGP,KAAKgpD,SAAS5zC,aAAa,WAAW,OAAtC,IAEA,KAAK4zC,SAAS5zC,aAAa,WAAW,MAAtC;QAXU;QAqBNm0C,eAAe36C,GAAa;AAClC,eAAK+D,UAAUwlB,YAAf;AACM/gC,4DAAN;AACA,eAAKknD,QAAL;cACkB1mD,oDAAcgX,CAA5B;AAGFA,cAAE6yB,gBAAF;eAHF;AAMA,gBAAMuqB,IAAwBn0D,iDAC5B+W,GACA,KAAK+D,UAAU+B,aAAf,GACA,KAAK/B,UAAUs5C,oBAAf,CAHc;AAKVC,gBAAgB,KAAKjoC,aAAa+nC,EAAQ1zC,IAAI0zC,EAAQxzC;AAE5D,gBAAM2zC,IAAmB1yD,wDAAkB,KAAKyvD,SAA/B;AACXkD,gBAAc,KAAKnoC,aAAakoC,EAAS7zC,IAAI6zC,EAAS3zC;AAC5D,gBAAI8vC,IAAiB,KAAKA,gBAEpB+D,IAAiC,OAApB,KAAK9D;AACpB2D,iBAAiBE,IAEnB9D,KAAkB+D,IACTH,KAAiBE,IAAc,KAAK7D,iBAE7CD,KAAkB+D;AAGpB,iBAAKtC,kBAAkB,KAAKD,wBAAwBxB,CAA7B,CAAvB;AAEA,iBAAKoC,cAAL;cACEjpB,gBAAF;AACA7yB,cAAE4yB,eAAF;UA9BA;QAJkC;QA2C5BioB,kBAAkB76C,GAAe;AACvC,eAAK+D,UAAUwlB,YAAf;AACA,eAAKmmB,QAAL;AACkB1mD,8DAAcgX,CAA5B,IAGFA,EAAE6yB,gBAAF,KAIF,KAAK4mB,kBAAkB,KAAKC,gBAG5B,KAAKG,iBAAiB,KAAKxkC,aAAarV,EAAE2J,UAAU3J,EAAE6J,SACtD,KAAKowC,oBAAkCrxD,sDACrCoiB,UACA,aACA,MACA,KAAK0yC,eAJkB,GAMzB,KAAK1D,sBAAoCpxD;YACvCoiB;YACA;YACA;YACA,KAAK2yC;UAJoB,GAM3B39C,EAAE6yB,gBAAF,GACA7yB,EAAE4yB,eAAF;QA3BuC;QAmCjC+qB,kBAAkB39C,GAAe;AAKvC,eAAKm7C,kBAAkB,KAAKD,wBAFL,KAAKzB,oBAFP,KAAKpkC,aAAarV,EAAE2J,UAAU3J,EAAE6J,WACnB,KAAKgwC,eAGhB,CAAvB;AACA,eAAKiC,cAAL;QANuC;QAUjC4B,kBAAe;AACfl1D,4DAAN;AACA,eAAKknD,QAAL;QAFqB;QASfA,UAAO;AACb,eAAK3rC,UAAUxG,UAAU,IAAzB;AACI,eAAK08C,sBACOnxD,6CAAO,KAAKmxD,iBAA1B,GACA,KAAKA,oBAAoB;AAEvB,eAAKD,wBACOlxD,6CAAO,KAAKkxD,mBAA1B,GACA,KAAKA,sBAAsB;QARhB;QAkBf4D,YAAS;AAEP,cAAIrE,IAAQ,KAAKG,kBADS,KAAKE,kBAAkB,KAAKD;AAElDnpB,gBAAM+oB,CAAN,MACFA,IAAQ;AAEV,iBAAOA;QANA;QAaDuC,gBAAa;AACnB,gBAAMvC,IAAQ,KAAKqE,UAAL;AACV,eAAKvoC,aACP,KAAKtR,UAAUuqC,WAAW,EAAC5kC,GAAG6vC,EAAJ,CAA1B,IAEA,KAAKx1C,UAAUuqC,WAAW,EAAC1kC,GAAG2vC,EAAJ,CAA1B;QALiB;QAgBrB18B,IAAItS,GAAeuxC,GAAuB;AACxC,eAAKX,kBAAkB,KAAKD,wBAAwB3wC,IAAQ,KAAKgvC,KAA1C,CAAvB;AACA,WAAIuC,KAAmCj7C,WAAlBi7C,MACnB,KAAKA,cAAL;QAHsC;QAgB1C+B,UAAUn0C,GAAWE,GAAS;AAC5B,eAAK4vC,SAAS,IAAIxqC;YAAWtF;YAAGE;UAAlB;QADc;QAUf+xC,OAAAA,qBACblY,GACAC,GAAe;AAEf,iBACED,EAAMuY,cAActY,EAAOsY,aAC3BvY,EAAMwY,eAAevY,EAAOuY,cAC5BxY,EAAM5gC,aAAa6gC,EAAO7gC,YAC1B4gC,EAAM7gC,YAAY8gC,EAAO9gC,WACzB6gC,EAAM0Y,gBAAgBzY,EAAOyY,eAC7B1Y,EAAMyY,iBAAiBxY,EAAOwY,gBAC9BzY,EAAM+Y,gBAAgB9Y,EAAO8Y,eAC7B/Y,EAAMsZ,iBAAiBrZ,EAAOqZ,gBAC9BtZ,EAAMn0B,eAAeo0B,EAAOp0B,cAC5Bm0B,EAAMj0B,cAAck0B,EAAOl0B;QAZd;MAl1Bb;AAKGkG,iDAAAC,qBAA2Bi/B,6CAAgB,KAAK;iDAQvCuF,2BAA2B;AA7C7C,UAAArH,kCAAA,CAAA;AAgCap9B,sCAAAA,YAAAA;A3FxBb,UAAIhD,6CAAuB,EACzBM,iBAAiBA,WAAA;AACf,cAAUlV,MACR,oGADI;MADS,EADQ,GASvB6U,iDAA+B,EACjCS,mBAAmBA,WAAA;AACjB,cAAUtV,MACR,uGADI;MADW,EADc,GAgB/B,EAAC,UAAAkN,2CAAU,WAAAwH,4CAAW,eAAAC,+CAAtB,IAAuCoiC;AACvCriC,qDAAWE,6CAAY,IAAIF;AAC3BC,yDAAeE,iDAAgB,IAAIF;UAyC1BI,8CAAa,6CAGpBQ,yDAAwB,iCA/E9By/B,kCAAA,EA4EajgC,YAAAA,4CA5Eb;AAuFgB5H,sCAAAA,gBAAAA,EAAAA;AAUAE,sCAAAA,iBAAAA,EAAAA;sCA0DAhgB,YAAAA;AAlGAD,sCAAAA,qBAAAA;AA4DA4nB,sCAAAA,YAAAA,EAAAA;ACoChB,UAAMe,6DAAwB,mBAMxBD,2DAAsB,iBAKhBsC;AAAZ,OAAA,SAAYA,GAAQ;AAClBA,UAAAA,EAAAH,MAAA,CAAA,IAAA;AACAG,UAAAA,EAAAG,SAAA,CAAA,IAAA;AACAH,UAAAA,EAAAX,OAAA,CAAA,IAAA;AACAW,UAAAA,EAAAE,QAAA,CAAA,IAAA;MAJkB,GAARF,kDAAAA,gDAAQ,CAAA,EAApB;UA4PavW,iDAAY,EACvBlU,uBAAAA,2DADuB,GAhazBqnD,sCAAA,CAAA;AAoKY58B,0CAAAA,WAAAA;AA4PCvW,0CAAAA,YAAAA;AArLGpU,0CAAAA,8BAAAA;0CAzDAF,0BAAAA;AA4FAG,0CAAAA,gBAAAA;AA8BAE,0CAAAA,wBAAAA;AAmGAI,0CAAAA,mBAAAA;AC3XhB,UAAYgqB;AAAZ,OAAA,SAAYA,GAAgB;AAC1BA,UAAAA,EAAAC,MAAA,CAAA,IAAA;AACAD,UAAAA,EAAAO,SAAA,CAAA,IAAA;MAF0B,GAAhBP,iEAAAA,+DAAgB,CAAA,EAA5B;AAUA,UAAYR;AAAZ,OAAA,SAAYA,GAAkB;AAC5BA,UAAAA,EAAAC,OAAA,CAAA,IAAA;AACAD,UAAAA,EAAAc,QAAA,CAAA,IAAA;MAF4B,GAAlBd,mEAAAA,iEAAkB,CAAA,EAA9B;UAoBYsB;AAAZ,OAAA,SAAYA,GAAa;AACvBA,UAAAA,EAAAC,KAAA,CAAA,IAAA;AACAD,UAAAA,EAAAknC,OAAA,CAAA,IAAA;MAFuB,GAAblnC,8DAAAA,4DAAa,CAAA,EAAzB;AAlDA,UAAAk8B,6CAAA,CAAA;AAkDYl8B,iDAAAA,gBAAAA;AA2GI3qB,iDAAAA,mBAAAA;iDA7BAD,2BAAAA;AA1DAD,iDAAAA,uBAAAA;AAxCJupB,iDAAAA,qBAAAA;AAVAQ,iDAAAA,mBAAAA;A0FVL,UAAMioC,wCAAS,EACpB33C,OAAO,IACPE,QAAQ,KACR03C,KAAK,cAHe,GAVtBlL,gCAAA,EAUaiL,QAAAA,sCAVb;ACkCM,UAAOE,oDAAP,MAAA;QAwDJ35B,YAA6BvgB,GAAuB;AAAvB,eAAAA,YAAAA;AAnD7B,eAAAF,KAAK;AAOG,eAAAq6C,cAAoC,CAAA;AASpC,eAAAC,iBAHA,KAAAC,eAHA,KAAAC,cAAkC;AAYzB,eAAAC,SAHA,KAAAC,QAAQ;AAMR,eAAAC,gBAAgB;AAKhB,eAAAC,gBAAgB;AAMhB,eAAAC,oBAHA,KAAAC,kBAAkB;AAM3B,eAAA/lB,WAA8B;AAM9B,eAAA7qB,MAHA,KAAAC,OAAO;AAMP,eAAA2P,cAAc;QAG8B;QAOpDvtB,YAAS;AACP,eAAKwoC,WAAevvC,kDAAiBqwC,qCAAI8e,GAAG,CAAA,CAA5B;AAKhB,gBAAM/L,IAAMluC,OAAOmS,KAAKg8B,OAAL,CAAP,EAAsB1e,UAAU,CAAhC;eACP4wB,iBAAiBnS,CAAtB;AACA,eAAKoS,gBAAgBpS,CAArB;AACI,eAAK1oC,UAAU62B,UAAf,KAGF,KAAKkkB,mBAAmBrS,CAAxB;AAEF,iBAAO,KAAK7T;QAdL;QAkBTh/B,OAAI;AACF,eAAKmK,UAAUg7C,oBAAf,EAAqCtI,aAAa,EAChDE,WAAW,MACXrH,QAAQ,GACRsH,cAAc,CAACP,0DAAiBN,WAAWE,YAA7B,EAHkC,CAAlD;AAKA,eAAKt4B,cAAc;QANjB;QAaJhrB,UAAO;AACL,eAAKoR,UAAUg7C,oBAAf,EAAqChI,gBAAgB,cAArD;AACI,eAAKne,YACHlvC,4CAAW,KAAKkvC,QAApB;AAEF,qBAAWl5B,KAAS,KAAKw+C;AACTp1D,yDAAO4W,CAArB;eAEGw+C,YAAYr+C,SAAS;QARrB;QAkBP4lC,uBAAoB;AAClB,cAAIn/B,IAAS,KAAKk4C,gBAAgB,IAAI,KAAKF;AACvC,eAAKH,mBACP73C,KAAU,KAAKm4C,gBAAgB,KAAKH;AAItC,iBAAO,IAAI1uC,uCAAK,KAAK7B,KAFN,KAAKA,MAAMzH,GAEQ,KAAK0H,MADzB,KAAKA,OAAO,KAAKuwC,KACxB;QAPW;QAkBpBzwC,SAASmH,GAAoBwB,GAAsB;AAEjD,cAAK,KAAKkH,aAAV;AAIA,gBAAMqhC,IAA4BhzD,qEAChC,KAAK+X,WACLkR,CAFqB,GAInB3O,IAAS,KAAKk4C,gBAAgB,IAAI,KAAKF;AACvC,iBAAKH,mBACP73C,KAAU,KAAKm4C,gBAAgB,KAAKH;AAEhChoC,gBAAuBvqB;cAC3BizD;cACA,IAAIvwC,uCAAK,KAAK8vC,OAAOj4C,CAArB;cACA,KAAKo4C;cACL,KAAKC;cACL1pC;cACA,KAAKlR;YANW;AASZ+R,gBAAmBkpC,EAAenpC;AAKlCopC,gBAA0BhzD,6DAC9BqqB,GACA,KAAKqoC,iBALL7oC,MAAgCA,6DAAiBC,MAClCa,0DAAcknC,OACdlnC,0DAAcC,IAK7BJ,CAJmB;AAOrB,gBAAIX,MAAgCA,6DAAiBC,KAAK;AACxD,kBAAMmpC,IAAmB,KAAKV,gBAAgB,KAAKF,QAC9CD;AAAL,uBAAKA,IAALA,KAAKA,gBAAAA,EAAa73C,aAChB,aACA,kBAAkB04C,IAAmB,GAFvC;AAII,mBAAKf,kBAGP,KAAKA,eAAe33C,aAClB,aACA,mBAHA04C,IAAmB,KAAKT,gBAAgB,KAAKH,UAGL,GAF1C;YATsD,OAcnD;AACCY,kBAAmB,KAAKf,iBAC1B,KAAKM,gBAAgB,KAAKH,SAC1B;AACCD,kBAAAA;AAAL,uBAAKA,IAALA,KAAKA,gBAAAA,EAAa73C,aAChB,aACA,kBAAkB04C,IAAmB,GAFvC;AAIMC,kBACJD,IAAmB,KAAKV,gBAAgB,KAAKF;AAC/C,uBAAKF,IAALA,KAAKA,iBAAAA,EAAc53C,aACjB,aACA,kBAAkB24C,IAAoB,GAFxC;YAVK;AAgBP,iBAAKpxC,MAAMkxC,EAAalxC;AACxB,iBAAKC,OAAOixC,EAAajxC;gBACpB4qB;AAAL,qBAAKA,IAALA,KAAKA,aAAAA,EAAUpyB,aACb,aACA,eAAe,KAAKwH,OAAO,MAAM,KAAKD,MAAM,GAF9C;UAjEA;QAFiD;QAgF3C6wC,iBAAiBnS,GAAW;AAWlC,eAAK2R,eAAmB/0D,kDACtBqwC,qCAAI8e,GACJ,EAAC,SAAS,6BAAV,GACA,KAAK5f,QAHa;AAKpB,gBAAMwmB,IAAW/1D,kDACfqwC,qCAAIoe,UACJ,EAAC,IAAM,2BAA2BrL,EAAlC,GACA,KAAK2R,YAHM;AAKT/0D;YACFqwC,qCAAIof;YACJ,EACE,OAAS,IACT,QAAU,GAFZ;YAIAsG;UANF;AAQuB/1D,4DACrBqwC,qCAAI+e,OACJ,EACE,OAASsF,sCAAO33C,OAChB,QAAU23C,sCAAOz3C,QACjB,GAAK,KACL,GAAK,KACL,aAAa,gCAAgCmmC,IAAM,IALrD,GAOA,KAAK2R,YATYiB,EAWRC,eACLhT,2CACJ,cACA,KAAKvoC,UAAU/E,QAAQ4L,cAAcmzC,sCAAOC,GAH9C;AAOA,eAAKE,YAAYj+C,KACDrX;YACZ,KAAKw1D;YACL;YACA;YACA,KAAKmB,KAAK12D,KAAK,MAAM,EAArB;UAJF,CADF;QA/CkC;QAgE5Bg2D,gBAAgBpS,GAAW;AAWjC,eAAK4R,cAAkBh1D,kDACrBqwC,qCAAI8e,GACJ,EAAC,SAAS,4BAAV,GACA,KAAK5f,QAHY;AAKnB,gBAAMwmB,IAAW/1D,kDACfqwC,qCAAIoe,UACJ,EAAC,IAAM,0BAA0BrL,EAAjC,GACA,KAAK4R,WAHM;AAKTh1D,4DACFqwC,qCAAIof,MACJ,EACE,OAAS,IACT,QAAU,GAFZ,GAIAsG,CANF;AAQsB/1D;YACpBqwC,qCAAI+e;YACJ,EACE,OAASsF,sCAAO33C,OAChB,QAAU23C,sCAAOz3C,QACjB,GAAK,KACL,GAAK,KACL,aAAa,+BAA+BmmC,IAAM,IALpD;YAOA,KAAK4R;UATWmB,EAWRF,eACJhT,2CACJ,cACA,KAAKvoC,UAAU/E,QAAQ4L,cAAcmzC,sCAAOC,GAH9C;AAOA,eAAKE,YAAYj+C,KACDrX,sDACZ,KAAKy1D,aACL,eACA,MACA,KAAKkB,KAAK12D,KAAK,MAAM,CAArB,CAJF,CADF;QA/CiC;QAiE3B02D,KAAKE,GAAgBz/C,GAAe;AAC1C,eAAK+D,UAAUwlB,YAAf;eACKxlB,UAAU27C,WAAWD,CAA1B;AACA,eAAKE,cAAL;AACMn3D,4DAAN;AACAwX,YAAE6yB,gBAAF;AACA7yB,YAAE4yB,eAAF;QAN0C;QAgBpCksB,mBAAmBrS,GAAW;AAWpC,eAAK0R,iBAAqB90D,kDACxBqwC,qCAAI8e,GACJ,EAAC,SAAS,+BAAV,GACA,KAAK5f,QAHe;AAKtB,gBAAMwmB,IAAW/1D,kDACfqwC,qCAAIoe,UACJ,EAAC,IAAM,6BAA6BrL,EAApC,GACA,KAAK0R,cAHM;AAKT90D;YAAiBqwC,qCAAIof;YAAM,EAAC,OAAS,IAAI,QAAU,GAAxB;YAA6BsG;UAA5D;AACyB/1D,4DACvBqwC,qCAAI+e,OACJ,EACE,OAASsF,sCAAO33C,OAChB,QAAU23C,sCAAOz3C,QACjB,GAAK,KACL,aAAa,kCAAkCmmC,IAAM,IAJvD,GAMA,KAAK0R,cARcyB,EAURN,eACPhT,2CACJ,cACA,KAAKvoC,UAAU/E,QAAQ4L,cAAcmzC,sCAAOC,GAH9C;AAOA,eAAKE,YAAYj+C,KACDrX;YACZ,KAAKu1D;YACL;YACA;YACA,KAAK0B,UAAUh3D,KAAK,IAApB;UAJF,CADF;QAvCoC;QAsD9Bg3D,UAAU7/C,GAAe;AAC/B,eAAK+D,UAAUwlB,YAAf;AAWA,gBAAMk2B,IAAS/uC,KAAKovC,IAPA,KAAK/7C,UAAU/E,QAAQ+tC,YAAYC,aAClC,KAAKjpC,UAAUjB,KAMrB,IAAuC4N,KAAKovC,IAL7C,KAAK/7C,UAAU/E,QAAQ+tC,YAAYgT,UAKK;AACtD,eAAKh8C,UAAUi8C,sBAAf;AACA,eAAKj8C,UAAU27C,WAAWD,CAA1B;AACA,eAAK17C,UAAUk8C,aAAf;AAEAlgD,qBAAW,KAAKgE,UAAUm8C,oBAAoBr3D,KAAK,KAAKkb,SAA7C,GAAyD,GAApE;AACA,eAAK47C,cAAL;AACMn3D,4DAAN;AACAwX,YAAE6yB,gBAAF;AACA7yB,YAAE4yB,eAAF;QArB+B;QAyBzB+sB,gBAAa;AACnB,gBAAMQ,IAAU,KAAgB74D,wCAAe0b,yCAA1B,GACnB,MACA,KAAKe,UAAUF,IACf,eAHc;AAKLhd,mDAAKs5D,CAAhB;QANmB;MAlbjB;AA6bFl6D,0CAAS,qOAAb;AA/dA,UAAA6sD,sCAAA,CAAA;0CAkCamL,eAAAA;ACvBN,UAAMmC,wDAAuB,yBAKvBC,wDAAuB,yBAMvBn9B,qDAAoB,qBAtBjC4vB,kCAAA,EAgBauN,sBAAAA,uDALAD,sBAAAA,uDAWAl9B,mBAAAA,mDAtBb;ACcM,UAAO6Q,mDAAP,MAAA;QAEJzP,YAA6B7mB,GAAY;AAAZ,eAAAA,OAAAA;QAAY;QAGzC4B,WAAQ;AACN,iBAAO,KAAK5B;QADN;QAKRkjC,OAAOnjC,GAAqB;AAC1B,iBAAO,KAAKC,SAASD,EAAK6B,SAAL;QADK;MAVxB;AAcG00B,uDAAAusB,UAAU,IAAIvsB,iDAAsB,SAA1B;AACVA,uDAAAwsB,UAAU,IAAIxsB,iDAAsB,SAA1B;AACVA,uDAAAC,UAAU,IAAID,iDAAuB,SAA3B;UA9BnB+e,yCAAA,CAAA;AAca/e,6CAAAA,WAAAA;ACDb,OAAA,SAAYxQ,GAAU;AAEpBA,UAAAA,EAAAC,QAAA,CAAA,IAAA;AAEAD,UAAAA,EAAAkR,YAAA,CAAA,IAAA;AAEAlR,UAAAA,EAAA+Q,QAAA,CAAA,IAAA;AAEA/Q,UAAAA,EAAAi9B,SAAA,CAAA,IAAA;AAIAj9B,UAAAA,EAAAgR,UAAA,CAAA,IAAA;MAZoB,GAAVhR,EAAAA,yDAAAA,EAAAA,uDAAU,CAAA,EAAtB;AAbA,UAAAuvB,2CAAA,CAAA;AAaYvvB,+CAAAA,aAAAA,EAAAA;A7FLZ,UAAIvM,oDAAsBA,SACxBF,GACAC,GAAyB;AAEzBnI,eAAO1iB,MAAM4qB,CAAb;AACIC,aACFA,EAAA;MAJuB,GAQvBG,sDAAwBA,SAC1BJ,GACAlO,GAAmC;AAEnCA,UAASgG,OAAOxiB,QAAQ0qB,CAAf,CAAT;MAFmC,GAKjCO,qDAAuBA,SACzBP,GACAM,GACAxO,GAAyC;AAEzCA,UAASgG,OAAOriB,OAAOuqB,GAASM,CAAvB,CAAT;MAFyC,GA0F9BzX,0CAAY,EACvBtT,iBAAAA,8CADuB,GAtHzBymD,+BAAA,EAsHanzC,WAAAA,wCAtHb;AAwCgBzT,mCAAAA,QAAAA;mCAqBAE,UAAAA;AAiCAG,mCAAAA,SAAAA;AA5CAJ,mCAAAA,WAAAA;AA4BAG,mCAAAA,aAAAA;AA8BAE,mCAAAA,YAAAA;AC5GhB,UAAAsmD,qEAAA,CAAA;AAkBgBrmD,yEAAAA,iCAAAA;A6FIHg0D,UAAAA,sCAtBb3N;AASah5B,QAAAA,iCAA+Bzb,uBAAOC,OAAO,IAAd;AAa/BmiD,6CAAYA,SAAUC,GAA+B;AAChEriD,eAAOU,KAAK2hD,CAAZ,EAAoBzgB,QAAQ,SAAU0gB,GAAC;AACrC7mC,YAAAA,+BAAI6mC,CAAJ,IAASD,EAAOC,CAAP;QAD4B,CAAvC;MADgE;AAtBlE7N,kCAAA,EASah5B,KAAAA,EAAAA,gCAaA2mC,WAAAA,qCAtBb;A5FAA,UAAA3N,6DAAA,CAAA;AA0CgBnmD,iEAAAA,6BAAAA;AAbAD,iEAAAA,4BAAAA;A6FLV,UAAOk0D,wDAAP,cAAuBzM,uDAAvB;QASJ7vB,YAAYu8B,GAA4B;AACtC,gBAAA;AACA,eAAK/M,UAAkC,gBAAxB,OAAO+M;AACjBA,gBAEL,KAAKC,QAAQD,EAAa3oC,MAAb,GACb,KAAK9X,cAAcygD,EAAa98C,UAAUF;QANJ;QAc/BgwC,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKiN;AACR,kBAAUhjD,MACR,sFADI;AAKRgG,YAAA,QAAgB,KAAKg9C;AACrB,iBAAOh9C;QATM;QAqBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIkhD,uDAHE;YAKRE,QAAQh9C,EAAA;AACjB,iBAAO2wC;QARI;MA/CT,GAxBN3B,+CAAA,CAAA;AAwBa8N,mDAAAA,UAAAA;ACDP,UAAOG,4DAAP,cAAyBH,sDAAzB;QAYJt8B,YAAYu8B,GAA4B;AACtC,gBAAMA,CAAN;AAZO,eAAArjD,OAAkBylB;AAcpB49B,gBAGL,KAAKG,UAAUH,EAAarjD,MAC5B,KAAKyjD,UAAUJ,EAAapjD;QAPU;QAe/Bo2C,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAqBhzC,WAAjB,KAAKmgD;AACP,kBAAUljD,MACR,wFADI;AAKR,cAAI,CAAC,KAAKmjD;AACR,kBAAUnjD,MACR,wFADI;AAKRgG,YAAA,UAAkB,KAAKk9C;AACvBl9C,YAAA,UAAkB,KAAKm9C;AACvB,iBAAOn9C;QAhBM;QA4BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIqhD,2DAHE;AAKjBtM,YAASuM,UAAUl9C,EAAA;AACnB2wC,YAASwM,UAAUn9C,EAAA;AACnB,iBAAO2wC;QATI;QAiBJV,IAAI9yC,GAAgB;AAC3B,gBAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAK6M;AACR,kBAAUhjD,MACR,sFADI;AAKR,cAAI,CAAC,KAAKmjD;AACR,kBAAUnjD,MACR,wFADI;AAKJmD,cACF8C,EAAUtW;YAAe,KAAKwzD;YAAS,KAAKD;YAAS,KAAKF;UAA1D,IAEA/8C,EAAUm9C,mBAAmB,KAAKJ,KAAlC;QAjByB;MA3EzB;AAsGG76D,+CAAkB2X,qCAAKsG,OAAkB+e,gDAAY89B,yDAA9D;AA7HA,UAAAjO,iDAAA,CAAA;AAuBaiO,qDAAAA,YAAAA;ACEP,UAAOhoC,sDAAP,MAAA;QAaJuL,YACSvgB,GACAtG,GACPkc,GACAwnC,GAAe;AAHR,eAAAp9C,YAAAA;AACA,eAAAtG,OAAAA;AAWP,eAAKD,OAAOmc,KAAY;AAOxB,eAAKynC,MAAMD,KAAsBx6D,gDAAZ;QAhBN;QAoBjBuxB,QAAK;AACH,iBAAO,KAAKkpC;QADT;QAaEpoC,OAAAA,cAAcqoC,GAAqBC,GAAmB;AAC3D,iBAAOD,EAAK5jD,KAAK4iC,cAAcihB,EAAK7jD,MAAMoD,QAAW,EAACy/B,aAAa,OAAd,CAA9C;QADoD;MAlDzD,GAzBNwS,uCAAA,CAAA;AAyBa/5B,2CAAAA,gBAAAA;A9FAN,UAAMwoC,iDAAgB,YAoIhBtoC,sDAAqB,6BA+erBtZ,6CAAY,EACvB5S,4BAAAA,4DADuB,GA5oBzB+lD,kCAAA,EAyBayO,eAAAA,gDAmnBA5hD,WAAAA,4CA/eAsZ,oBAAAA,oDA7Jb;sCAmEgBb,wBAAAA,EAAAA;AA/BAR,sCAAAA,mBAAAA,EAAAA;AAgNA3qB,sCAAAA,8BAAAA;AA1JAL,sCAAAA,iBAAAA;AAuBAC,sCAAAA,uBAAAA;sCAuDAC,qBAAAA;AAuBAE,sCAAAA,gCAAAA;AA+SAQ,sCAAAA,2BAAAA;AA2IAE,sCAAAA,oBAAAA;sCAhHA+tB,6BAAAA,EAAAA;AA4BAE,sCAAAA,cAAAA,EAAAA;AApJAvuB,sCAAAA,sBAAAA;AA2BAC,sCAAAA,+BAAAA;AA9EAH,sCAAAA,aAAAA;sCAzDA8sB,iBAAAA,EAAAA;ACzRhB,UAAM8C,sDAAa,oBAAItc,OAGjBmc,uDAAc,oBAAI6kC,WAGlB5kC,uDAAc,oBAAI6kC,WAQpBnlC,+DAA4C,MAG5CC,gEAA4C,MAM5CC,8DAAqB,GAnCzBs2B,0CAAA,CAAA;AAuEgBllD,8CAAAA,sBAAAA;8CAxBAD,cAAAA;AAuCAE,8CAAAA,uBAAAA;A8FzEV,UAAOwoC,qEAAP,MAAA;QAsCJ/R,YACkBvgB,GAChBF,GAAW;AADK,eAAAE,YAAAA;AAlCV,eAAAsJ,OAAO;AAGP,eAAAyH,OAAO,IAAIrG,uCAAK,KAAK,GAAd;AAGP,eAAA6P,YAAY;AASZ,eAAAM,YAHA,KAAAF,UAHA,KAAAF,WAAW;AAST,eAAAkjC,WAAW,IAAI1yC,mDAAW,GAAG,CAAlB;AAMX,eAAA2yC,YAHA,KAAAj/B,WAAW;AAgBnB,eAAK7e,KAAKA,KAAM,CAACE,EAAU0iC,eAAe5iC,CAAzB,IAA+BA,IAAiBld,gDAAZ;AAErDod,YAAU69C,cAAc,IAAxB;AAEA,eAAKC,gBAAL;QANW;QASLA,kBAAe;AACN36D,wDAAX,KACSL,yCAAK,KAAgBS,wCAAei/C,kDAA1B,GAA2C,IAAhD,CAAhB;QAFmB;QAMfub,kBAAe;AACN56D,wDAAX,KACSL,yCAAK,KAAgBS,wCAAeksD,kDAA1B,GAA2C,IAAhD,CAAhB;QAFmB;QAOfuO,gBAAgBC,GAAiBC,GAAe;AACvC/6D,wDAAX,KACSL,yCACT,KAAgBS,wCAAemsD,kDAA1B;YAA2C;YAAMuO;YAASC;UAA/D,CADF;QAFoD;QAShDC,kBAAkBC,GAAqB;AAC9Bj7D,wDAAX,KACSL,yCACT,KAAgBS,wCAAeosD,oDAA1B,GAA6C,MAAMyO,CAAxD,CADF;QAF2C;QAS/CpjC,QAAQ1R,GAAY;AAClB,gBAAM20C,IAAU,KAAK30C;AACrB,eAAKA,OAAOA;AACZ,eAAK00C,gBAAgBC,GAAS30C,CAA9B;QAHkB;QAOpB+Q,UAAO;AACL,iBAAO,KAAK/Q;QADP;QAKP6R,QAAQpK,GAAU;AAChB,eAAKA,OAAOA;QADI;QAKlB3qB,UAAO;AACL,iBAAO,KAAK2qB;QADP;QAKPqK,aAAab,GAAkB;AAC7B,eAAKA,YAAYA;AACjB,eAAK4jC,kBAAkB5jC,CAAvB;QAF6B;QAM/BD,cAAW;AACT,iBAAO,KAAKC;QADH;QAKXc,YAAYZ,GAAiB;AAC3B,eAAKA,WAAWA;QADW;QAQ7B2yB,aAAU;AACR,iBAAO,KAAK5yB,cAAL,KAAwB,CAAC,KAAKxa,UAAU/E,QAAQ0oC;QAD/C;QAQVnpB,gBAAa;AACX,iBAAO,KAAKC;QADD;QAKba,WAAWX,GAAgB;AACzB,eAAKA,UAAUA;QADU;QAQ3Bkc,YAAS;AACP,iBAAO,KAAKnc,aAAL,KAAuB,CAAC,KAAK1a,UAAU/E,QAAQ0oC;QAD/C;QAQTjpB,eAAY;AACV,iBAAO,KAAKC;QADF;QAKZY,aAAaV,GAAkB;AAC7B,eAAKA,YAAYA;QADY;QAQ/BpkB,cAAW;AACT,iBAAO,KAAKmkB,eAAL,KAAyB,CAAC,KAAK5a,UAAU/E,QAAQ0oC;QAD/C;QAQX/oB,iBAAc;AACZ,iBAAO,KAAKC;QADA;QAKdxmB,OAAOspD,GAAsBv/C,GAA6B;AACxD,gBAAMzC,IAAQ,KAAgBpY,wCAAek/C,gDAA1B,GACjB,IADY;AAGVrkC,eAAQzC,EAAM0iD,UAAUjgD,CAAhB;AAEZ,eAAKu/C,WAAWA;AAEhBhiD,YAAM2iD,UAAN;AACen7D,wDAAX,KAAmCL,yCAAK6Y,CAAhB;QAT4B;QAa1Dyd,yBAAsB;AACpB,iBAAO,KAAKukC;QADQ;QAKtB/uD,UAAO;AACL,eAAKgvD,YAAY;AACjB,eAAKG,gBAAL;AACA,eAAK/9C,UAAUu+C,iBAAiB,IAAhC;AACA,eAAK5/B,WAAW;QAJX;QAQPhF,aAAU;AACR,iBAAO,KAAKgF;QADJ;QAQV4tB,gBAAa;AACX,iBAAO,KAAKqR,aAAa,KAAKj/B;QADnB;MAlNT,GAbNowB,mDAAA,CAAA;AAaazc,uDAAAA,mBAAAA;ACFN,UAAMya,sCAAQ,IAORyR,uCAAS,KAlBtBzP,+BAAA,EAWahC,OAAAA,qCAOAyR,QAAAA,qCAlBb;ACiBM,UAAOC,2DAAP,MAAA;QAoFJl+B,YAA6BvgB,GAAuB;AAAvB,eAAAA,YAAAA;AA/CrB,eAAA+Q,OAAa,IAAIrG,uCAAK,KAAK,GAAd;AAGb,eAAA6P,YAAqB;AAGrB,eAAAE,WAAoB;AAGpB,eAAAkjC,WAAuB,IAAI1yC,mDAAW,GAAG,CAAlB;AAGvB,eAAA3B,OAAe;AAGf,eAAAo1C,sBAEJ,CAAA;AAGI,eAAAC,sBACN,CAAA;AAGM,eAAAC,mBAAsC,CAAA;AAGtC,eAAAC,0BAAiE,CAAA;AAYjE,eAAAC,4BANA,KAAAC,0BAAqD;AAYrD,eAAApgC,WAHA,KAAAi/B,YAAY;AAMlB,eAAKoB,UAAc15D,kDAAiBqwC,qCAAI8e,GAAG,EACzC,SAAS,iCADgC,CAA5B;AAIf,eAAKwK,gBAAgB,KAAKC,oBAAoB,KAAKF,OAA9B;AAErB,WAAC,EACC,aAAa,KAAKG,aAClB,kBAAkB,KAAKC,kBACvB,YAAY,KAAKC,YACjB,aAAa,KAAKC,aAClB,aAAa,KAAKC,aAClB,iBAAiB,KAAKC,gBANvB,IAOG,KAAKC,aAAa,KAAKT,SAASh/C,CAAhC;AAEJ,WAAC,EAAC,eAAe,KAAK0/C,eAAe,UAAU,KAAKC,SAAnD,IACC,KAAKC,eAAe,KAAKZ,OAAzB;eAEGa,eAAe,KAAKC,mBAAmB,KAAKd,SAASh/C,CAAtC;AAIpB,cAAA;AAAA,mBAAA,IAAAA,EAAUi1B,gBAAV,MAAA,EAA6B3qC,OAAO,MAAayiD,mCAAjD;AAGA,eAAK5xB,QAAQ,KAAKpK,IAAlB;AAGA,eAAK1c,OAAO,IAAI4W,mDAAW,GAAG,CAAlB,CAAZ;QA7BkD;QAmC5Ci0C,oBAAoBF,GAAoB;AAC9C,iBAAW15D,kDACTqwC,qCAAIof,MACJ,EAAC,SAAS,0BAAV,GACAiK,CAHK;QADuC;QAYxCS,aACNT,GACAh/C,GAAuB;AASjBm/C,cAAkB75D;YACtBqwC,qCAAI8e;YACJ,EACE,SAAS,uBADX;YAGAuK;UALkB;AAOpB,gBAAMI,IAAuB95D,kDAC3BqwC,qCAAIof,MACJ,EACE,SAAS,iCADX,GAGAoK,CALuB,GASnBE,IAAiB/5D,kDACrBqwC,qCAAI+e,OACJ,EACE,SAAS,qBACT,MAAQ,GAAG10C,EAAU/E,QAAQ4L,WAArB,kBAFV,GAIAs4C,CANiB;AAQbG,cAAkBh6D;YACtBqwC,qCAAI+e;YACJ,EACE,SAAS,sBACT,MAAQ,GAAG10C,EAAU/E,QAAQ4L,WAArB,mBAFV;YAIAs4C;UANkB;AAQpB,gBAAMI,IAAkBj6D,kDACtBqwC,qCAAIqf,MACJ,EACE,SAAS,uDADX,GAGAmK,CALkB,GAOdK,IAAkBv4C,SAASG,eAAe,EAAxB;AACxBm4C,YAAYl4C,YAAYm4C,CAAxB;AAKc36D,gEACZy6D,GACA,eACA,MACA,KAAKS,aAJP;AAMcl7D,gEACZw6D,GACA,eACA,MACA,KAAKW,YAJP;AAOA,iBAAO,EACLb,aAAAA,GACAC,kBAAAA,GACAC,YAAAA,GACAC,aAAAA,GACAC,aAAAA,GACAC,iBAAAA,EANK;QAnEgB;QAgFjBI,eAAeZ,GAAoB;AAInCU,cAAoBp6D,kDACxBqwC,qCAAI6e,eACJ,EACE,SAAS,8BADX,GAGAwK,CALoB;AAOtB,gBAAMv1C,IAAOxC,SAASU,gBAAoB2gC,0CAAS,MAAtC;AACb7+B,YAAKhH,aAAa,SAAa6lC,wCAA/B;AACA7+B,YAAK5B,YAAY;AACjB,gBAAM83C,IAAW14C,SAASU,gBACpB2gC,0CACJ,UAFe;AAIb/iD,oDAASo6D,GAAU,oBAAvB;AACIp6D;YAASo6D;YAAU;UAAvB;AACIp6D,oDAASo6D,GAAU,aAAvB;AACAl2C,YAAKpC,YAAYs4C,CAAjB;AACAD,YAAcr4C,YAAYoC,CAA1B;AAEc5kB,gEAAgB86D,GAAU,UAAU,MAAM,KAAKM,YAA7D;AAEA,iBAAO,EAACP,eAAAA,GAAeC,UAAAA,EAAhB;QA1BkC;QA8BnCG,mBACNd,GACAh/C,GAAuB;AAEjB6/C,cAAmBv6D,kDACvBqwC,qCAAI+e,OACJ,EACE,SAAS,uBACT,MAAQ,GAAG10C,EAAU/E,QAAQ4L,WAArB,oBAFV,GAIAm4C,CANmB;AASPn6D;YACZg7D;YACA;YACA;YACA,KAAKK;UAJP;AAOA,iBAAOL;QAlBgB;QAsBzBj9B,aAAU;AACR,iBAAO,KAAKo8B;QADJ;QAQV54D,UAAO;AACL,iBAAO,KAAKm0B,YAAY,KAAK6kC,iBAAiBe,QAAtB,IAAkC,KAAKpvC;QAD1D;QAQPoK,QAAQpK,GAAU;AAChB,gBAAMqvC,IAAa,KAAKhB,iBAAiBe,QAAtB,GACbE,IAAa,KAAKhB,WAAWc,QAAhB,GACbG,IAAc,KAAKhB,YAAYa,QAAjB,GACdI,IAAkB,KAAKhB,YAAYY,QAAjB,GAClBK,IAAa,KAAKX,aAAaM,QAAlB;AAEnBpvC,cAAOrG,uCAAKmC,IACVkE,GACA,KAAK0vC,YAAYL,GAAYE,GAAaD,CAA1C,CAFK;AAIP,gBAAMK,IAAU,KAAK3vC;AACrB,eAAKA,OAAOA;AAEZ,eAAKiuC,QAAQv8C,aAAa,UAAU,GAAGsO,EAAKxO,MAAR,EAApC;AACA,eAAKy8C,QAAQv8C,aAAa,SAAS,GAAGsO,EAAK1O,KAAR,EAAnC;eAEKs+C,oBAAoB5vC,CAAzB;AACA,eAAK6vC,iBAAiB7vC,CAAtB;AACA,eAAK8vC,mBAAmB9vC,GAAMqvC,CAA9B;AACA,eAAKU,yBAAyB/vC,GAAMqvC,GAAYC,CAAhD;AACA,eAAKU,0BAA0BX,GAAYE,CAA3C;AACA,eAAKU,sBACHjwC,GACAqvC,GACAG,GACAF,GACAG,CALF;AAOA,eAAKS,2BAA2BlwC,GAAMyvC,CAAtC;AAEA,eAAKU,aAAaR,GAAS,KAAK3vC,IAAhC;QA/BgB;QA0CV0vC,YACNL,GACAE,GACAD,GAAgB;AAEqB75C,cAAAA;AAArC,eAAK26C,kBAAgC36C,SAAAA,IAAdA,KAAKm5C,SAASn5C,SAAAA,IAAS,EAA9C;AACM46C,cAAuBp7D,8CAAa,KAAKu5D,WAAtB;AAEzB,gBAAM8B,IAAgB,KAAKC,kBAAkBlB,GAAYE,CAAnC,GAChBiB,IAAe,KAAKC,iBAAiBpB,GAAYC,CAAlC;AAErB,cAAIh+C,IAAQ++C;AACR,eAAK9B,YAAYmC,gBAAjB,IACFp/C,KAASi+C,EAAYj+C,QAAwB,IAAhBg/C,IACpBD,MACT/+C,KAAS;AAEP,eAAKg9C,WAAWoC,gBAAhB,IACFp/C,KAASg+C,EAAWh+C,QAAuB,IAAfk/C,IACnBH,MACT/+C,KAAS;AAMX,iBAAO,IAAIqI,uCAAKrI,GAFD+9C,EAAW79C,SAAS,EAE5B;QAvBS;QA2BVi/C,iBAAiBpB,GAAkBC,GAAgB;AACzD,kBAAQD,EAAW79C,SAAS89C,EAAW99C,UAAU;QADQ;QAKnD++C,kBAAkBlB,GAAkBE,GAAiB;AAC3D,kBAAQF,EAAW79C,SAAS+9C,EAAY/9C,UAAU;QADS;QAKrDo+C,oBAAoB5vC,GAAU;AACpC,eAAKkuC,cAAcx8C,aAAa,UAAU,GAAGsO,EAAKxO,MAAR,EAA1C;AACA,eAAK08C,cAAcx8C,aAAa,SAAS,GAAGsO,EAAK1O,KAAR,EAAzC;AACI,eAAKrC,UAAU0R,OACjB,KAAKutC,cAAcx8C,aAAa,KAAK,GAAG,CAACsO,EAAK1O,KAAT,EAArC;QAJkC;QAS9Bu+C,iBAAiB7vC,GAAU;AACjC,eAAKquC,iBAAiB38C;YAAa;YAAS,GAAGsO,EAAK1O,KAAR;UAA5C;QADiC;QAK3Bw+C,mBAAmB9vC,GAAYqvC,GAAgB;AACrD,eAAKV,cAAcj9C,aACjB,UACA,GAAGsO,EAAKxO,SAAS69C,EAAW79C,MAA5B,EAFF;AAIA,eAAKm9C,cAAcj9C,aAAa,SAAS,GAAGsO,EAAK1O,KAAR,EAAzC;AACA,eAAKq9C,cAAcj9C,aAAa,KAAK,GAAG29C,EAAW79C,MAAd,EAArC;AACI,eAAKvC,UAAU0R,OACjB,KAAKguC,cAAcj9C,aAAa,KAAK,GAAG,CAACsO,EAAK1O,KAAT,EAArC;QARmD;QAe/Cy+C,yBACN/vC,GACAqvC,GACAC,GAAgB;AAEVkB,cAAe,KAAKC,iBAAiBpB,GAAYC,CAAlC;AACrB,eAAKhB,WAAW58C,aAAa,KAAK,GAAG8+C,CAAH,EAAlC;AACA,eAAKlC,WAAW58C,aACd,KACA,GAAGsO,EAAK1O,QAAQg+C,EAAWh+C,QAAQk/C,CAAnC,EAFF;QAJgB;QAaVR,0BAA0BX,GAAkBE,GAAiB;AAC7De,cAAgB,KAAKC,kBAAkBlB,GAAYE,CAAnC;AACtB,eAAKhB,YAAY78C;YAAa;YAAK,GAAG4+C,CAAH;UAAnC;AACA,eAAK/B,YAAY78C,aAAa,KAAK,GAAG4+C,CAAH,EAAnC;QAHmE;QAS7DL,sBACNjwC,GACAqvC,GACAG,GACAF,GACAC,GAAiB;AAEjB,gBAAMoB,KAAqBtB,EAAW79C,SAASg+C,EAAgBh+C,UAAU,GACnEg/C,IAAe,KAAKC,iBAAiBpB,GAAYC,CAAlC;AACfgB,cAAgB,KAAKC,kBAAkBlB,GAAYE,CAAnC;AAEhBc,cACJrwC,EAAK1O,QACLi+C,EAAYj+C,QACI,IAAhBg/C,IACAhB,EAAWh+C,QACI,IAAfk/C;AACF,eAAKhC,YAAY98C,aACf,KACA,GACE69C,EAAYj+C,QAAwB,IAAhBg/C,KAAqB,KAAKrhD,UAAU0R,MAAM,KAAK,EADrE,EAFF;AAMA,eAAK6tC,YAAY98C,aACf,KACA,GAAGi/C,IAAoBnB,EAAgBh+C,SAAS,CAAhD,EAFF;AAIA,eAAKg9C,YAAY98C,aAAa,SAAS,GAAG2+C,CAAH,EAAvC;QAtBiB;QA0BXH,2BAA2BlwC,GAAYyvC,GAAgB;AAC7D,eAAKX,aAAap9C,aAAa,KAAK,GAAGsO,EAAKxO,SAASi+C,EAAWj+C,MAA5B,EAApC;AACA,eAAKs9C,aAAap9C;YAAa;YAAK,GAAGsO,EAAK1O,QAAQm+C,EAAWn+C,KAA3B;UAApC;QAF6D;QASvD6+C,aAAaR,GAAenJ,GAAa;AAE/C,mBAASn7C,IAAI,KAAKuiD,oBAAoB7iD,SAAS,GAAQ,KAALM,GAAQA;AACxD,iBAAKuiD,oBAAoBviD,CAAzB,EAA4BskD,GAASnJ,CAArC;QAH6C;QAajDoK,sBAAsBC,GAAgD;AACpE,eAAKjD,oBAAoBziD,KAAK0lD,CAA9B;QADoE;QAKtEC,yBAAyBD,GAAoB;AAC3C,eAAKjD,oBAAoB3hD,OACvB,KAAK2hD,oBAAoB57C,QAAQ6+C,CAAjC,GACA,CAFF;QAD2C;QAWrC1B,oBAAoBjkD,GAAe;AACpC,eAAKmxC,WAAL,MAEL,KAAK0U,aAAL,GACkB78D,oDAAcgX,CAA5B,MAMJ,KAAK+D,UAAU82B,UACb76B,GACA,IAAIgP,mDACF,KAAKjL,UAAU0R,MAAM,CAAC,KAAKtrB,QAAL,EAAeic,QAAQ,KAAKjc,QAAL,EAAeic,OAC5D,KAAKjc,QAAL,EAAemc,MAFjB,CAFF,GAQA,KAAKw8C,0BAAwCl6D,sDAC3CoiB,UACA,aACA,MACA,KAAK86C,iBAJwB,GAM/B,KAAKjD,4BAA0Cj6D,sDAC7CoiB,UACA,eACA,MACA,KAAK+6C,mBAJ0B,GAOjC,KAAKhiD,UAAUxG,UAAf,IA1BEyC,EAAE6yB,gBAAF;QALuC;QAqCnCizB,kBAAkBz5B,GAAgB;AAClC7jC,4DAAN;AACI,eAAKs6D,4BACOh6D,6CAAO,KAAKg6D,uBAA1B,GACA,KAAKA,0BAA0B;AAE7B,eAAKD,8BACO/5D,6CAAO,KAAK+5D,yBAA1B,GACA,KAAKA,4BAA4B;QARK;QAalCkD,oBAAoB/lD,GAAe;AAEnCgmD,cAAQ,KAAKjiD,UAAUkiD,SAASjmD,CAAxB;AACd,eAAKkf,QAAQ,IAAIzQ,uCAAK,KAAK1K,UAAU0R,MAAM,CAACuwC,EAAMt8C,IAAIs8C,EAAMt8C,GAAGs8C,EAAMp8C,CAAxD,CAAb;QAHyC;QAO3CyU,cAAW;AACT,iBAAO,KAAKC;QADH;QAKXa,aAAab,GAAkB;AAE7B,WADA,KAAKA,YAAYA,KAEXh1B,0CAAS,KAAKy5D,SAAS,kBAA3B,IAEIv5D;YAAY,KAAKu5D;YAAS;UAA9B;AAGF,eAAK7jC,QAAQ,KAAKpK,IAAlB;AACA,eAAKoxC,WAAL;QAT6B;QAgBvBA,aAAU;AAEhB,mBAAS/lD,IAAI,KAAKyiD,wBAAwB/iD,SAAS,GAAQ,KAALM,GAAQA;AAC5D,iBAAKyiD,wBAAwBziD,CAA7B,EAAgC,KAAKme,SAArC;QAHc;QAQlB6nC,sBAAsBR,GAAwC;AAC5D,eAAK/C,wBAAwB3iD,KAAK0lD,CAAlC;QAD4D;QAK9DS,yBAAyBT,GAAoB;AAC3C,eAAK/C,wBAAwB7hD,OAC3B,KAAK6hD,wBAAwB97C,QAAQ6+C,CAArC,GACA,CAFF;QAD2C;QAWrC7B,cAAc9jD,GAAe;AACnC,eAAK6lD,aAAL;AACkB78D,8DAAcgX,CAA5B,MAKJ,KAAKmf,aAAa,CAAC,KAAKb,SAAxB,GAEA,KAAKva,UAAUxG,UAAf;YANIs1B,gBAAF;QAHiC;QAerCse,aAAU;AACR,iBAAO,KAAK3yB;QADJ;QAKVY,YAAYZ,GAAiB;AAE3B,WADA,KAAKA,WAAWA,MAEVl1B,0CAAS,KAAKy5D,SAAS,iBAA3B,GACIv5D,6CAAY,KAAKu5D,SAAS,iBAA9B,GACA,KAAKW,SAAStuB,gBAAgB,UAA9B,MAEI5rC,6CAAY,KAAKu5D,SAAS,iBAA9B,GACIz5D,0CAAS,KAAKy5D,SAAS,iBAA3B,GACA,KAAKW,SAASl9C,aAAa,YAAY,MAAvC;QATyB;QAc7B2W,yBAAsB;AACpB,iBAAO,KAAKukC;QADQ;QAStBtpD,OAAOspD,GAAoB;AACzB,eAAKA,WAAWA;AAChB,eAAKqB,QAAQv8C,aACX,aACA,aAAak7C,EAASh4C,CAAtB,KAA4Bg4C,EAAS93C,CAArC,GAFF;QAFyB;QAS3BwU,UAAO;AACL,iBAAO,KAAK/Q;QADP;QAKP0R,QAAQ1R,GAAY;AAClB,eAAKq2C,SAASn5C,QAAQ8C;AACtB,eAAK22C,aAAL;QAFkB;QAMpBqC,sBAAsBV,GAAoD;AACxE,eAAKlD,oBAAoBxiD,KAAK0lD,CAA9B;QADwE;QAK1EW,yBAAyBX,GAAoB;AAC3C,eAAKlD,oBAAoB1hD,OACvB,KAAK0hD,oBAAoB37C,QAAQ6+C,CAAjC,GACA,CAFF;QAD2C;QAWrC3B,eAAY;AAClB,gBAAMhC,IAAU,KAAK30C;AACrB,eAAKA,OAAO,KAAKq2C,SAASn5C;AAC1B,eAAK26C,kBAAkB,KAAK73C,IAA5B;AAEA,eAAK6R,QAAQ,KAAKpK,IAAlB;AAEA,mBAAS3U,IAAI,KAAKsiD,oBAAoB5iD,SAAS,GAAQ,KAALM,GAAQA;AACxD,iBAAKsiD,oBAAoBtiD,CAAzB;cAA4B6hD;cAAS,KAAK30C;YAA1C;QARgB;QAaZ63C,kBAAkB73C,GAAY;AACpC,eAAKk2C,gBAAgBx2C,cAAc,KAAKw5C,aAAal5C,CAAlB;QADC;QAK9Bk5C,aAAal5C,GAAY;AAC/B,iBAAsB,MAAfA,EAAKxN,SAAe,GAAGwN,EAAK2gB,UAAU,GAAG,CAAlB,CAAH,QAA+B3gB;QAD3B;QAKzBw4C,eAAY;AAClB,gBAAMvhD,IAAS,KAAKy+C,QAAQ32C,YACtBmI,IAAajQ,EAAQiQ;AAEvBA,YAAWA,EAAW1U,SAAS,CAA/B,MAAsC,KAAKkjD,WAC7Cz+C,EAAQ8G,YAAY,KAAK23C,OAAzB;QALgB;QAaZgB,aAAa/jD,GAAe;AAChBhX,8DAAcgX,CAA5B,KAKJ,KAAKrN,QAAL;AAJEqN,YAAE6yB,gBAAF;QAFgC;QAWpClgC,UAAO;AACL,eAAKgvD,YAAY;AACbj4D,sDAAW,KAAKq5D,OAApB;AAEA,mBAAS5iD,IAAI,KAAKwiD,iBAAiB9iD,SAAS,GAAQ,KAALM,GAAQA;AACrD,iBAAKwiD,iBAAiBxiD,CAAtB,EAAA;AAEF,eAAKuiB,WAAW;QAPX;QAWPhF,aAAU;AACR,iBAAO,KAAKgF;QADJ;QAQV4tB,gBAAa;AACX,iBAAO,KAAKqR,aAAa,KAAKj/B;QADnB;QAKb8jC,mBAAmBb,GAAoB;AACrC,eAAKhD,iBAAiB1iD,KAAK0lD,CAA3B;QADqC;QAKvCc,sBAAsBd,GAAoB;AACxC,eAAKhD,iBAAiB5hD,OAAO,KAAK4hD,iBAAiB77C,QAAQ6+C,CAA9B,GAAyC,CAAtE;QADwC;MAzuBtC;AA8uBF1/D,0CAAS,uiEAAb;UA/vBA6sD,8CAAA,CAAA;AAiBa0P,kDAAAA,cAAAA;ACHP,UAAOkE,4EAAP,MAAA;QAKJpiC,YAAoBvG,GAAiC;AAAjC,eAAAA,UAAAA;AAJZ,eAAA4oC,WAA8B;AAKpC,eAAK5iD,YAAYga,EAAQha;QAD0B;QAIrD62B,YAAS;AACP,iBAAO,KAAK7c,QAAQU,aAAb,KAA+B,CAAC,KAAK1a,UAAU/E,QAAQ0oC;QADvD;QAIT7M,YAAS;AACSv3B,YAAAA,6CAAX,KACQC,EAAAA,6CAAS,IAApB;AAEF,eAAKojD,WAAW,KAAK5oC,QAAQZ,uBAAb;AAChB,eAAKpZ,UAAU0xB,kBAAkB,KAAjC;AACA,cAAA;AAAA,mBAAA,IAAA,KAAK1xB,UAAUi1B,gBAAf,MAAA,EAAkC4tB,gBAAgB,KAAK7oC,OAAvD;eACKA,QAAQ8oC,YAAY,IAAzB;QAPO;QAUT/rB,KAAKgsB,GAAkB;AACrB,eAAK/oC,QAAQgpC,eAAeD,CAA5B;QADqB;QAIvB/rB,UAAO;AACL,eAAKisB,cAAL;AAEA,cAAA;AAAA,mBAAA,IAAA,KAAKjjD,UACFi1B,gBADH,MAAA,EAEIiuB,iBAAiB,KAAKlpC,SAAgB+yB,mCAF1C;AAGA,eAAK/yB,QAAQ8oC,YAAY,KAAzB;AAEA,eAAK9oC,QAAQmpC,WAAb;AAEA,eAAKnjD,UAAU0xB,kBAAkB,IAAjC;AACWlyB,YAAAA,6CAAS,KAApB;QAXK;QAcCyjD,gBAAa;AACnB,cAAI,CAAA,KAAKjpC,QAAQuyB,cAAb,GAAJ;AACA,gBAAM5wC,IAAQ,KAAgBpY,wCAAek/C,gDAA1B,GACjB,KAAKzoB,OADO;cAGRqkC,UAAU,CAAC,MAAD,CAAhB;AACA1iD,cAAMynD,iBAAiB,KAAKR;AAC5BjnD,cAAM2iD,UAAN;AACWx7D,qDAAK6Y,CAAhB;UAPA;QADmB;QAWrBs7B,aAAU;AACJ,eAAK2rB,YAAU,KAAK5oC,QAAQgpC,eAAe,KAAKJ,QAAjC;QADX;MApDN,GAdN7T,uDAAA,CAAA;AAca4T,2DAAAA,sBAAAA;ACHN,UAAMU,4DAAY,KAKZC,6DAAa,IAKbC,yDAAS,IAGTC,qEAAqB,IAxBlCzU,iDAAA;QAqBawU,QAAAA;QALAD,YAAAA;QALAD,WAAAA;QAaAG,oBAAAA;MAxBb;AjGAA,UAAAzU,+CAAA,CAAA;AAkBgB7sD,mDAAAA,WAAAA;AASAE,mDAAAA,aAAAA;ACyEhB,UAAMqhE,sEAAcp5D,8DAGPq5D,qFAAP,MAAA;QAANnjC,cAAA;AACE,eAAAinB,WAAsBgc;QADxB;QAMEn5D,KAAK2V,GAAoB;AACvB,gBAAM2jD,IAAgB,CAAA;AACtB,qBAAW3pC,KAAWha,EAAU4b,eAAV;AAKpB,aAJMnc,IAAQgkD,6DAAYzpC,GAA+B,EACvDC,gBAAgB,MAChBC,SAAS,KAF8C,CAA3C,MAIHypC,EAAcznD,KAAKuD,CAAnB;AAEb,iBAAOkkD,EAAc7nD,SAAS6nD,IAAgB;QATvB;QAgBzBlsD,KAAKgI,GAAgBO,GAAoB;AACvC,qBAAW4jD,KAAgBnkD;AACzBnV,2EAAOs5D,GAAc5jD,GAAW,EAACtE,YAAuB7Y,kDAAX,EAAb,CAAhC;QAFqC;QAOzC8uC,MAAM3xB,GAAoB;AACxB,qBAAWga,KAAWha,EAAU4b,eAAV;AACpB5B,cAAQprB,QAAR;QAFsB;MA7BtB;AAoCgB1M,6DACpB,qBACA,IAAIwhE,oFAFN;AA3IA,UAAA3U,yDAAA,CAAA;6DAuGa2U,6BAAAA;AAzCGp5D,6DAAAA,SAAAA;AAjCAD,6DAAAA,OAAAA;AC7BhB,UAAA0kD,2CAAA,CAAA;AAgBgB7sD,+CAAAA,WAAAA;AAYAE,+CAAAA,aAAAA;ACZV,UAAOyhE,mFAAP,MAAA;QAKJltD,MACEusC,GACAljC,GACAmjC,GAAuB;AAEjB1jC,cAAQyjC,EAAS0gB;AAEnBzgB,gBACF1jC,EAAA,IAAa0jC,EAAWx9B,GACxBlG,EAAA,IAAa0jC,EAAWt9B;AAGfzG,YAAAA,4CAAX;AACA,cAAI4a;AACJ,cAAI;AACFA,gBAA8B1vB,+DAC5BmV,GACAO,CAFQ,GAIVzV,mFAAyByvB,CAAzB;UALE,UAAJ;AAOa1a,cAAAA,2CAAX;UADQ;AAIV,cAAI,CAAC0a;AAAS,mBAAO;AAEN72B,wDAAX,KACSL,yCAAK,KAAgBS,wCAAei/C,kDAA1B,GAA2CxoB,CAAhD,CAAhB;YAEK1Y,0CAAY0Y,CAAnB;AACA,iBAAOA;QA3BgB;MARrB;AAGG6pC,uFAAA1lB,OAAO;AA0EPj8C,yDAAS2hE,iFAAuB1lB,MAAM,IAAI0lB,kFAAnD;AA7FA,UAAA9U,2DAAA,CAAA;+DAgBa8U,yBAAAA;A+FMPC,UAAAA,mDAtBN/U;AAsBM+U,0DAAsB;AAMf90B,QAAAA,uCAAiB,EAK5B+0B,YAAY,GAOZC,kBAAkB,IAKlB/0B,YAAY60B,mDAKZG,sBAAsBH,mDAQtBI,6BAA6B,GAK7BC,WAAW,IAnCiB;AA5B9BpV,qCAAA,EA4Ba/f,QAAAA,EAAAA,qCA5Bb;A9FSA,UAAMzS,gDAAc,SAGdF,mDAAiB,QAMXwR;AAAZ,OAAA,SAAYA,GAAI;AAEdA,UAAAu2B,OAAA;AAGAv2B,UAAAw2B,WAAA;AAEAx2B,UAAAy2B,QAAA;AAGAz2B,UAAA02B,UAAA;AAGA12B,UAAAC,OAAA;AAGAD,UAAAM,WAAA;AAEAN,UAAA22B,mBAAA;AAGA32B,UAAA42B,SAAA;AAEA52B,UAAA62B,eAAA;AAGA72B,UAAA82B,MAAA;AAEA92B,UAAA+2B,OAAA;AAGA/2B,UAAAg3B,WAAA;MA/Bc,GAAJh3B,2CAAAA,yCAAI,CAAA,EAAhB;AAsCA,UAAYsa;gBAAAA,GAAK;AAGfA,UAAA,mBAAA;AAIAA,UAAA,WAAA;AAEAA,UAAA,WAAA;AAIAA,UAAA,WAAA;AAIAA,UAAA,UAAA;AAIAA,UAAA,QAAA;AAGAA,UAAA,aAAA;AAIAA,UAAA,QAAA;AAGAA,UAAA,cAAA;AAIAA,UAAA,WAAA;AAKAA,UAAA,WAAA;AAIAA,UAAA,WAAA;AAEAA,UAAA,UAAA;AAGAA,UAAA,WAAA;AAGAA,UAAA,WAAA;MApDe,GAALA,4CAAAA,0CAAK,CAAA,EAAjB;AAxDA,UAAA4G,mCAAA,CAAA;uCAkBYlhB,OAAAA;AAsCAsa,uCAAAA,QAAAA;AA+DI19C,uCAAAA,UAAAA;AAcAC,uCAAAA,WAAAA;A+F7GV,UAAOkjC,mCAAP,MAAA;QA2CJrN,cAAA;AArCiB,eAAAukC,YAAwB,CAAA;AAkCjC,eAAA1oC,WAHA,KAAA1d,UAHA,KAAAqmD,mBAHA,KAAAC,oBAHA,KAAAC,oBAHA,KAAAC,eAHA,KAAAC,mBAHA,KAAAC,kBANR,KAAAC,gBAAmC;QA8BnC;QAQAj3B,SAASJ,GAAkB;AACzB,eAAK82B,UAAU5oD,KAAK8xB,CAApB;QADyB;QAU3BY,OAAO9iB,GAAkB;AACvB,gBAAMpN,IAAUuI,SAASC,cAAc,KAAvB;AAEhBxI,YAAQmJ,YAAY;AACpBnJ,YAAQwpC,WAAW;AACf,eAAK9rB,YACF3xB,0CAAQiU,GAAS,KAAK0d,QAA3B;AAEF,eAAK1d,UAAUA;AAGf,mBAAStC,IAAI,GAAG4xB,GAAWA,IAAW,KAAK82B,UAAU1oD,CAAf,GAAoBA;AACxDsC,cAAQ2I,YAAY2mB,EAAS3hC,UAAT,CAApB;AAIF,eAAK84D,mBAAiCtgE,sDACpC6Z,GACA,eACA,MACA,KAAK4mD,iBACL,IALsB;AAOxB,eAAKJ,eAA6BrgE,sDAChC6Z,GACA,aACA,MACA,KAAK6mD,aACL,IALkB;AAOpB,eAAKN,oBAAkCpgE,sDACrC6Z,GACA,gBACA,MACA,KAAK8mD,kBACL,IALuB;AAOzB,eAAKR,oBAAkCngE;YACrC6Z;YACA;YACA;YACA,KAAK+mD;YACL;UALuB;AAOzB,eAAKV,mBAAiClgE,sDACpC6Z,GACA,WACA,MACA,KAAKgnD,cAJiB;AAOxB55C,YAAUzE,YAAY3I,CAAtB;AACA,iBAAOA;QApDgB;QA6DzBinD,aAAU;AACR,iBAAO,KAAKjnD;QADJ;QASVivB,QAAK;AACH,gBAAM5iB,IAAK,KAAK46C,WAAL;AACP56C,gBACFA,EAAG4iB,MAAM,EAACi4B,eAAe,KAAhB,CAAT,GACIrgE,0CAASwlB,GAAI,gBAAjB;QAJC;QASG86C,OAAI;AACV,gBAAM96C,IAAK,KAAK46C,WAAL;AACP56C,gBACFA,EAAG86C,KAAH,GACIpgE,6CAAYslB,GAAI,gBAApB;QAJQ;QAcZtgB,QAAQ2xB,GAAmB;AACzB,eAAKA,WAAWA;QADS;QAK3BxtB,UAAO;AAED,eAAKu2D,qBACOpgE,6CAAO,KAAKogE,gBAA1B,GACA,KAAKA,mBAAmB;AAEtB,eAAKD,iBACOngE,6CAAO,KAAKmgE,YAA1B,GACA,KAAKA,eAAe;AAElB,eAAKD,sBACOlgE,6CAAO,KAAKkgE,iBAA1B,GACA,KAAKA,oBAAoB;AAEvB,eAAKD,sBACOjgE,6CAAO,KAAKigE,iBAA1B,GACA,KAAKA,oBAAoB;AAEvB,eAAKD,qBACOhgE,6CAAO,KAAKggE,gBAA1B,GACA,KAAKA,mBAAmB;AAI1B,mBAAS3oD,IAAI,GAAG4xB,GAAWA,IAAW,KAAK82B,UAAU1oD,CAAf,GAAoBA;AACxD4xB,cAASp/B,QAAT;AAEF,eAAK8P,UAAU;QA3BV;QAuCConD,YAAYviD,GAAa;AAC/B,gBAAMwiD,IAAW,KAAKJ,WAAL;AAMjB,iBAAOK,KAAkBA,MAAmBD,KAAU;AACpD,gBAAIC,EAAe/9C,UAAUC,SAAS,iBAAlC;AAEF,uBAAS9L,IAAI,GAAG4xB,GAAWA,IAAW,KAAK82B,UAAU1oD,CAAf,GAAoBA;AACxD,oBAAI4xB,EAAS23B,WAAT,MAA0BK;AAC5B,yBAAOh4B;;AAIbg4B,gBAAiBA,EAAe7jD;UAToB;AAWtD,iBAAO;QAlBwB;QA6BjC8jD,eAAe/1C,GAAqB;AAClC,cAAMg2C,IAAqB,KAAKd;AAC5Bc,gBACFA,EAAmBD,eAAe,KAAlC,GACA,KAAKb,kBAAkB;AAErBl1C,gBACFA,EAAK+1C,eAAe,IAApB,GACA,KAAKb,kBAAkBl1C,GAGjBnF,IAAK,KAAK46C,WAAL,GACLh/D;YAAwBupB,EAAKy1C,WAAL;YAA8B56C;UAA5D,GAEKrgB,2CAASqgB,GAASo9B,wCAAMge,kBAAkBj2C,EAAKiE,MAAL,CAA/C;QAdgC;QAwBpCiyC,gBAAa;AACX,gBAAMtoD,IAAQ,KAAKsnD,kBACf,KAAKN,UAAU/hD,QAAQ,KAAKqiD,eAA5B,IACA;AACJ,eAAKiB,gBAAgBvoD,GAAO,CAA5B;QAJW;QAabwoD,oBAAiB;AACf,gBAAMxoD,IAAQ,KAAKsnD,kBACf,KAAKN,UAAU/hD,QAAQ,KAAKqiD,eAA5B,IACA;AACJ,eAAKiB,gBAAwB,IAARvoD,IAAY,KAAKgnD,UAAUhpD,SAASgC,GAAO,EAAhE;QAJe;QAQTyoD,iBAAc;AACpB,eAAKF,gBAAgB,IAAI,CAAzB;QADoB;QAKdG,gBAAa;AACnB,eAAKH,gBAAgB,KAAKvB,UAAUhpD,QAAQ,EAA5C;QADmB;QAWbuqD,gBAAgBI,GAAoBxE,GAAa;AAC3CwE,eAAaxE;AACzB,cAAIj0B;AACJ,iBAAQA,IAAW,KAAK82B,UAAUhnD,CAAf,KAAwB;AACzC,gBAAIkwB,EAAS7qC,UAAT,GAAsB;AACxB,mBAAK8iE,eAAej4B,CAApB;AACA;YAFwB;AAI1BlwB,iBAASmkD;UALgC;QAHY;QAmBjDqD,gBAAgBrpD,GAAe;AAGrC,WAFM+xB,IAAW,KAAK83B,YAAY7pD,EAAE+I,MAAnB,OAGXgpB,EAAS7qC,UAAT,IACE,KAAKiiE,oBAAoBp3B,KAC3B,KAAKi4B,eAAej4B,CAApB,IAGF,KAAKi4B,eAAe,IAApB;QATiC;QAmB/BV,YAAYtpD,GAAe;AACjC,gBAAMyqD,IAAY,KAAKrB;AAEvB,eAAKA,gBAAgB;AACrB,cAAIqB,KAAkC,aAArB,OAAOzqD,EAAE2J,SAAsB;AAC9C,kBAAM+gD,IAAY,IAAI17C,mDAAWhP,EAAE2J,SAAS3J,EAAE6J,OAA5B;AAClB,gBAAgD,IAA5CmF,mDAAW4oC,SAAS6S,GAAWC,CAA/B;AAMF;UAR4C;AAahD,WADM34B,IAAW,KAAK83B,YAAY7pD,EAAE+I,MAAnB,MAEfgpB,EAAS44B,cAAT;QAlB+B;QA2B3BpB,iBAAiBl9B,GAAgB;AACvC,eAAKqF,MAAL;QADuC;QASjC83B,iBAAiBn9B,GAAgB;AACnC,eAAKq9B,WAAL,MACF,KAAKE,KAAL,GACA,KAAKI,eAAe,IAApB;QAHqC;QAgBjCP,eAAezpD,GAAQ;AAC7B,cAAK,KAAK6oD,UAAUhpD,UAMlB,EAFoBG,EAEN4qD,YAFM5qD,EAGNoJ,WAHMpJ,EAIN6qD,WAJM7qD,EAKN8qD,SAJhB;AAUA,gBAAMC,IAAc,KAAK5B;AACzB,oBAZsBnpD,EAYAlB,KAAtB;cACE,KAAK;cACL,KAAK;AACCisD,qBACFA,EAAYJ,cAAZ;AAEF;cAEF,KAAK;AACH,qBAAKN,kBAAL;AACA;cAEF,KAAK;AACH,qBAAKF,cAAL;AACA;cAEF,KAAK;cACL,KAAK;AACH,qBAAKG,eAAL;AACA;cAEF,KAAK;cACL,KAAK;AACH,qBAAKC,cAAL;;cAGF;AAEE;YA5BJ;AA+BAvqD,cAAE4yB,eAAF;AACA5yB,cAAE6yB,gBAAF;UA3CA;QAN6B;QA0D/B1oC,UAAO;AACL,gBAAMuoC,IAAU,KAAKg3B,WAAL,GACVj3B,IAAiBtoC,2CAAQuoC,CAAd;AAEjBD,YAASnsB,SAASosB,EAAQqqB;AAC1B,iBAAOtqB;QALF;MApbH,GAxBNqgB,6BAAA,CAAA;AAwBanhB,iCAAAA,OAAAA;ACJP,UAAOK,2CAAP,MAAA;QA8BJ1N,YACmB5Z,GACAsgD,GAAkB;AADlB,eAAAtgD,UAAAA;AACA,eAAAsgD,YAAAA;AA9BX,eAAA34B,UAAU;AAGV,eAAA5vB,UAAiC;AAGjC,eAAAwoD,cAAc;AAGd,eAAA9qC,WAA6B;AAS7B,eAAA+qC,YAHA,KAAAC,UAHA,KAAAC,YAAY;AASZ,eAAA74B,gBAAiC;QASJ;QAQrCniC,YAAS;AACP,gBAAMqS,IAAUuI,SAASC,cAAc,KAAvB;AAChBxI,YAAQoB,KAAiBnd,yDAAZ;AACb,eAAK+b,UAAUA;AAIfA,YAAQmJ,YACN,oCACC,KAAKymB,UAAU,KAAK,sDACpB,KAAK84B,UAAU,kDAAkD,OACjE,KAAKD,YACF,sDACA,OACH,KAAKD,cAAc,0CAA0C;AAEhE,gBAAMvgD,IAAUM,SAASC,cAAc,KAAvB;AAChBP,YAAQkB,YAAY;AAEpB,cAAI,KAAKw/C,WAAW;AAClB,gBAAMC,IAAWrgD,SAASC,cAAc,KAAvB;AACjBogD,cAASz/C,YAAY;AACrBlB,cAAQU,YAAYigD,CAApB;UAHkB;AAMhBC,cAAmB,KAAK5gD;AACA,uBAAxB,OAAO,KAAKA,YACd4gD,IAAatgD,SAASG,eAAe,KAAKT,OAA7B;AAEfA,YAAQU,YAAYkgD,CAApB;AACA7oD,YAAQ2I,YAAYV,CAApB;AAGI,eAAKyV,YACF3xB,0CAAQiU,GAAS,KAAK0d,QAA3B;AAEG1xB,qDACHgU,GACKypC,wCAAM3mC,UACV,KAAK6lD,aAAa,KAAKD,WAAY,KAHtC;AAKK18D,qDAASgU,GAAcypC,wCAAMqf,UAAU,CAAC,KAAKl5B,OAAlD;AAEA,iBAAO5vB;QA3CA;QA+CT9P,UAAO;AACL,eAAK8P,UAAU;QADV;QAUPinD,aAAU;AACR,iBAAO,KAAKjnD;QADJ;QAUVyV,QAAK;AACH,iBAAO,KAAKzV,QAASoB;QADlB;QAULq9B,WAAQ;AACM8pB,cAAAA;AAAZ,iBAAYA,SAAAA,IAALA,KAAKA,aAAAA,IAAa;QADnB;QAUR/4B,eAAe5K,GAAY;AACzB,eAAK4jC,cAAc5jC;QADM;QAU3B74B,QAAQ2xB,GAAmB;AACzB,eAAKA,WAAWA;QADS;QAW3BqrC,aAAaJ,GAAkB;AAC7B,eAAKA,YAAYA;QADY;QAU/BK,WAAWN,GAAgB;AACzB,eAAKA,UAAUA;QADU;QAU3BnB,eAAekB,GAAkB;AAC/B,eAAKA,YAAYA;AAEjB,gBAAMp8C,IAAK,KAAK46C,WAAL;AACP56C,eAAM,KAAK5nB,UAAL,MAKJgkE,KACE5hE,0CAASwlB,GAHFrR,0BAGX,GACInU,0CAASwlB,GAHC48C,yBAGd,MAEIliE,6CAAYslB,GANLrR,0BAMX,GACIjU,6CAAYslB,GANF48C,yBAMd;QAd2B;QAyBjCxkE,YAAS;AACP,iBAAO,KAAKmrC;QADL;QAUTD,WAAWC,GAAgB;AACzB,eAAKA,UAAUA;QADU;QAU3Bs4B,gBAAa;AACP,eAAKzjE,UAAL,KAAoB,KAAKqrC,iBAC3B,KAAKA,cAAc,IAAnB;QAFS;QAcbD,SAASyL,GAA4BvpB,GAAW;AAC9C,eAAK+d,gBAAgBwL,EAAGl1C,KAAK2rB,CAAR;QADyB;MAnO5C,GApBNs+B,iCAAA,CAAA;AAoBa9gB,qCAAAA,WAAAA;A/FpBb,UAAA8gB,kDAAA,CAAA;AAyBgBpkD,sDAAAA,iBAAAA;AgGdV,UAAOi9D,uEAAP,cAAoC7tD,MAApC;MAAA,GAOO8kB,mEAAP,cAAgC+oC,qEAAhC;QAKJrnC,YAAmB9gB,GAAY;AAC7B,gBAAM,6DAAN;AADiB,eAAAA,QAAAA;QAAY;MAL3B,GAcOkgB,oEAAP,cAAiCioC,qEAAjC;QAQJrnC,YACEzC,GACOjvB,GACA4Q,GAAY;AAEnB,gBAAM,aAAa5Q,EAAMg5D,YAAN,CAAb,oBAAoD/pC,CAApD;WAAN;AAHO,eAAAjvB,QAAAA;AACA,eAAA4Q,QAAAA;QAAY;MAXjB,GAsBOugB,qEAAP,cAAkC4nC,qEAAlC;QASJrnC,YACEniB,GACAshB,GACO+Q,GACAq3B,GAAiB;AAExB,gBAAM,aAAar3B,EAAWo3B,YAAX,CAAb;EACRnoC,CADQ,4BACmCthB,CADnC,EAAN;AAHO,eAAAqyB,aAAAA;AACA,eAAAq3B,aAAAA;QAAiB;MAbtB,GA0BOvoC,oEAAP,cAAiCqoC,qEAAjC;QAKJrnC,YAAmB9gB,GAAY;AAC7B,gBAAM,sJAAN;AADiB,eAAAA,QAAAA;QAAY;MAL3B,GAYOghB,mEAAP,cAAgCmnC,qEAAhC;QAOJrnC,YACEH,GACOvxB,GACA4Q,GAAY;AAEnB,gBACE,+BAA+B2gB,CAA/B,kBACKvxB,EAAMg5D,YAAN,CAAH,oDACSznC,CAAT,2DAHJ;AAHO,eAAAvxB,QAAAA;AACA,eAAA4Q,QAAAA;QAAY;MAVjB,GA5FNsvC,iDAAA,CAAA;AAsDa/uB,qDAAAA,qBAAAA;AA3CA4nC,qDAAAA,uBAAAA;qDAOA/oC,mBAAAA;AAcAc,qDAAAA,oBAAAA;AAgDAJ,qDAAAA,oBAAAA;AAYAkB,qDAAAA,mBAAAA;A/F2rBb,UAAMsnC,wDAAY19D,kDAKL29D,8DAAP,MAAA;QAIJznC,cAAA;AAEE,eAAKinB,WAAsB+b;QAF7B;QAYAl5D,KACE2V,GAAoB;AAEpB,gBAAMioD,IAAc,CAAA;AACpB,qBAAWp5D,KAASmR,EAAUsvB,aAAa,KAAvB;AAKlB,aAJM7vB,IAAQsoD,iDAAUl5D,GAAO,EAC7BorB,gBAAgB,MAChB2C,qBAAqB,MAFQ,CAAjB,MAKZqrC,EAAY/rD,KAAKuD,CAAjB;AAGJ,iBAAIwoD,EAAYnsD,SACP,EACL,iBAAmB,GACnB,QAAUmsD,EAFL,IAKF;QAlBa;QA4BtBxwD,KACEgI,GACAO,GAAoB;AAEdioD,cAAcxoD,EAAA;AACpB,qBAAWA,KAASwoD;AAClB39D;cAAOmV;cAAOO;cAAW,EAACtE,YAAuB7Y,kDAAX,EAAb;YAAzB;QAJkB;QAatB8uC,MAAM3xB,GAAoB;AAExB,qBAAWnR,KAASmR,EAAUsvB,aAAa,KAAvB;AAClBzgC,cAAMD,QAAQ,KAAd;QAHsB;MA5DtB;AAoEgB1M,6DAAS,UAAU,IAAI8lE,6DAA7C;AAh2BA,UAAAjZ,6CAAA,CAAA;AA4xBaiZ,iDAAAA,kBAAAA;AAvaG19D,iDAAAA,SAAAA;iDA2BAc,iBAAAA;AA3TAf,iDAAAA,OAAAA;ACrFhB,UAAA0kD,gDAAA,CAAA;AAegB9iD,oDAAAA,YAAAA;A+FSV,UAAOi8D,4DAAP,cAAyB9X,uDAAzB;QAUJ7vB,YAAYgwB,GAAiB;AAC3B,gBAAA;AACA,eAAKR,UAAU,CAACQ;AAEXA,gBAEL,KAAK7yC,UAAU6yC,EAAUzwC,IACzB,KAAKzD,cAAck0C,EAAUvwC,UAAUF;QAPZ;QAepBgwC,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKpyC;AACR,kBAAU3D,MACR,qFADI;AAKRgG,YAAA,UAAkB,KAAKrC;AACvB,iBAAOqC;QATM;QAqBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIusD,2DAHE;YAKRxqD,UAAUqC,EAAA;AACnB,iBAAO2wC;QARI;MAjDT,GAxBN3B,iDAAA,CAAA;AAwBamZ,qDAAAA,YAAAA;ACMP,UAAOC,gEAAP,cAA2BD,0DAA3B;QA8BJ3nC,YACEgwB,GACA6X,GACAzwC,GACA0wC,GACAC,GAAsB;AAEtB,gBAAM/X,CAAN;AApCO,eAAA92C,OAAkB8kC,EAAAA;AAsCpBgS,gBAGL,KAAK7xC,UAAU0pD,GACf,KAAK1uD,OAAOie,KAAY7a,QACxB,KAAKyrD,WAAWF,GAChB,KAAK5sD,WAAW6sD;QAVM;QAkBfxY,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKpxC;AACR,kBAAU3E,MACR,+FADI;AAKRgG,YAAA,UAAkB,KAAKrB;AACvBqB,YAAA,OAAe,KAAKrG;AACpBqG,YAAA,WAAmB,KAAKwoD;AACxBxoD,YAAA,WAAmB,KAAKtE;AACpB,eAAK+sD,mBACPzoD,EAAA,iBAAyB,KAAKyoD;AAEhC,iBAAOzoD;QAfM;QA2BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIwsD,+DAHE;AAKjBzX,YAAShyC,UAAUqB,EAAA;AACnB2wC,YAASh3C,OAAOqG,EAAA;AAChB2wC,YAAS6X,WAAWxoD,EAAA;AACpB2wC,YAASj1C,WAAWsE,EAAA;AACWjD,qBAA3BiD,EAAA,mBACF2wC,EAAS8X,iBAAiBzoD,EAAA;AAE5B,iBAAO2wC;QAdI;QAyBb7vC,kBAAkB2nD,GAAsB;AACtC,cAAqB,eAAjB,KAAK9pD;AACP,kBAAU3E,MACR,0FADI;AAKR,eAAKyuD,iBAAiBA;QAPgB;QAe/BjrD,SAAM;AACb,iBAAO,KAAKgrD,aAAa,KAAK9sD;QADjB;QASNu0C,IAAI9yC,GAAgB;AAC3B,cAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKxyC;AACR,kBAAU3D,MACR,qFADI;AAKFlL,cAAQmR,EAAUK,aAAa,KAAK3C,OAA5B;AACd,cAAI,CAAC7O;AACH,kBAAUkL,MACR,6FADI;AAMR,gBAAMujB,IAAOzuB,EAAMyxB,QAAQ0P,iDAASusB,OAAvB;AACTj/B,eAAQrxB,yDAAUqxB,CAAV,KAAmBA,EAAK8D,gBAAL,KAE7B9D,EAAK+D,iBAAiB,KAAtB;AAEI7a,cAAQtJ,IAAU,KAAKzB,WAAW,KAAK8sD;AAC7C,kBAAQ,KAAK7pD,SAAb;YACE,KAAK;AAEH,eADM+Y,IAAQ5oB,EAAMgyB,SAAS,KAAKnnB,IAApB,KAEZ+d,EAAMgxC,SAASjiD,CAAf,IAEA9L,QAAQxG,KAAK,mCAAmC,KAAKwF,IAArD;AAEF;YAEF,KAAK;AACH7K,gBAAMglC,eAAgBrtB,KAAoB,IAA1C;AACA;YACF,KAAK;AACH3X,gBAAMusB,aAAa,CAAC,CAAC5U,CAArB;AACA;YACF,KAAK;AAGIgiD,kBAAAA;AAFP35D,gBAAMgS,kBACJ,CAAC,CAAC2F,GACGgiD,SAAAA,IAALA,KAAKA,kBAAAA,IAAkBrpC,kDAFzB;AAIA;YACF,KAAK;AACHtwB,gBAAMuwB,gBAAgB,CAAC,CAAC5Y,CAAxB;AACA;YACF,KAAK;AACGkiD,kBAAWP,8DAAYQ,oBAAoB95D,CAAhC;gBACPpD,iBACRoD,EAAMpD,eAAem9D,KAAKt5D,MAAOkX,KAAoB,IAAhC,CAArB,IACS3X,EAAMwwB,iBACfxwB,EAAMwwB,cACKtQ,EAAAA,2CAAWvI,KAAoB,aAAxC,CADF;AAIS1jB,uDACT,IAAIqlE,8DAAYt5D,GAAO,YAAY,MAAM65D,GAAUliD,CAAnD,CADF;AAGA;YAEF;AACE9L,sBAAQxG,KAAK,0BAA0B,KAAKwK,OAA5C;UAxCJ;QAtB2B;QA4EtBiqD,OAAAA,oBAAoB95D,GAAe;AACxC,iBAAIA,EAAM/D,kBACF2U,IAAQ5Q,EAAM/D,eAAe,IAArB,KACC89D,KAAKC,UAAUppD,CAAf,IAAwB,KAC9B5Q,EAAMuuB,iBACT3d,IAAQ5Q,EAAMuuB,cAAN,KACKh2B,qCAAUqY,CAAd,IAAuB,KAEjC;QARiC;MAhNtC;AAoOGvd,+CAAkB2X,qCAAKsG,OAAkB1B,EAAAA,4CAAQ0pD,6DAA1D;AAlQA,UAAApZ,mDAAA,CAAA;AA8BaoZ,uDAAAA,cAAAA;A/F9Bb,UAAApZ,mCAAA,CAAA;AAsCgB3iD,uCAAAA,QAAAA;AAZAD,uCAAAA,YAAAA;AAXAD,uCAAAA,YAAAA;ACYb,UAAAw4B,gDAAA,IAMAC,iDAAA,GAMAS,8DAAA,IAGHb,+CAAA,IAGAtC,oDAAA,MAMGsD,qDAAA,MAGH/B,4CAAA,MAGAE,uDAAA,IAGAG,oDAAA,IAGA3hB,wCAGAyE,4CAGAmb,0CAMGK,mDAAA,MAGHC,2CAAA,MAGAO,qDAAA,MAyRCpnB,8CAAA,EAGCutD,eAKGA,WAAA;AACH,cAAAC,IAAeviE,iDAAA27B,gDAAA,GACP6mC,IAAgB5iE,2CAAM+7B,gDAAtB;eACA,EAENlY,MAAO8+C,EAAApjD,GACLgG,OAAMo9C,EAAepjD,IAAAqjD,EAAA3mD,OACrB2H,KAAK++C,EAAEljD,GACP+F,QAAKm9C,EAAeljD,IAAAmjD,EAAAzmD,QACpBF,OAAM2mD,EAAE3mD,OACRE,QAAOymD,EAAUzmD,OAPb;MAHL,GAeHkjB,oBAUGA,SAAAxC,GAAAC,GAAAK,GAAAJ,GAAA;AACH,cAAAY,IAAoBxoB,4CAClButD,cADkB,GAMZ9kC,IAAa59B,2CAAS8b,sCAAZ;AAGhB,eAAAghB,IAAAc,EAAAzhB,SAAAwhB,EAAyCnY,SACrC3e,2DAA4Bg2B,GAAWC,GAASa,GAAAC,CAAhD,IAGJb,IAAAa,EAAAzhB,SAAAwhB,EAAyC/Z,MACrC9c,2DAA8Bq2B,GAAWJ,GAAMY,GAAAC,CAA/C,IASJd,IAASc,EAAAzhB,SAAA0E,SAAAmE,gBAAAsB,eACLzf,2DAA4Bg2B,GAASC,GAAAa,GAAgBC,CAArD,IAIJb,IAASa,EAAAzhB,SAAA0E,SAAAmE,gBAAA69C,YACL/7D,2DAA8Bq2B,GAASJ,GAAgBY,GAAYC,CAAnE,IASJ72B,+DAAA81B,GAAsCc,GAAAC,CAAtC;MAvCC,EAjCJ,GAyZApoB,+CAAAL,6CAnwBDwzC,oCAAA;QA6CA9sB,gBAAAA;QANGmD,0BAAAA;QAZAV,YAAAA;QAMAC,aAAAA;QASHJ,WAAAA;QAytBC3oB,WAAAA;MAnwBD;AA4KAnP,wCAAAA,eAAAA;AA3DGJ,wCAAAA,YAAAA;AAsDAG,wCAAAA,gBAAAA;wCATAD,WAAAA;AAyZAa,wCAAAA,eAAAA;AA6DHG,wCAAAA,OAAAA;AAhBGD,wCAAAA,cAAAA;AAgCHE,wCAAAA,uBAAAA;wCA5CGH,YAAAA;AAqJAK,wCAAAA,4BAAAA;AAtlBApB,wCAAAA,mBAAAA;AAgCAI,wCAAAA,YAAAA;AAiJAM,wCAAAA,OAAAA;wCAhIAL,wBAAAA;AAyBAC,wCAAAA,wBAAAA;A+F7MG,UAAOs8D,sDAAP,MAAA;QAoBJ3oC,YAA6BvgB,GAAuB;AAAvB,eAAAA,YAAAA;AAZrB,eAAAmpD,aAHA,KAAAC,UAAyB;AAMzB,eAAAC,UAAU,oBAAI7W;AAGd,eAAA8W,aAAgC;QAMY;QAQpDC,eAAezpD,GAAY0pD,GAAc;AACnC,eAAKH,QAAQpwC,IAAInZ,CAAjB,KACF,KAAK2pD,iBAAiB3pD,CAAtB;AAEF0pD,YAAOE,UACL,KAAK1pD,UAAU2jB,YAAf,EAA6BgmC,iBAAiB,KAAK3pD,WAAWwpD,CAA9D,CADF;AAGA,eAAKI,aAAaJ,EAAOK,UAAP,EAAmBx9D,UAAnB,CAAlB;AACA,eAAKg9D,QAAQvwC,IAAIhZ,GAAI0pD,CAArB;QARuC;QAgBzCC,iBAAiB3pD,GAAU;AACzB,gBAAM0pD,IAAS,KAAKH,QAAQ9lE,IAAIuc,CAAjB;AACf,cAAI0pD;AACFA,cAAO56D,QAAP,GACA,KAAKy6D,QAAQ5vC,OAAO3Z,CAApB;;AAEA,kBAAM/F,MACJ,oBACE+F,IACA,0DAHE;QANiB;QAoB3BgqD,YAAS;AACP,iBAAO,KAAKV;QADL;QAWTW,UAAUjqD,GAAU;AAClB,iBAAO,KAAKupD,QAAQ9lE,IAAIuc,CAAjB,KAAwB;QADb;QAUpBkqD,UAAUC,GAAc;AAClB,eAAKb,WAAW,KAAKA,QAAQS,UAAb,KAClB,KAAKT,QAAQS,UAAb,EAAyBj7D,QAAzB;AAGF,cADA,KAAKw6D,UAAUa;AAEPC,gBAAS,KAAKlqD,UACjB2jB,YADY,EAEZgmC,iBAAiB,KAAK3pD,WAAW,KAAKopD,OAF1B,GAGf,KAAKA,QAAQM,UAAUQ,CAAvB,GACA,KAAKC,aAAa,KAAKf,QAAQS,UAAb,EAAyBx9D,UAAzB,CAAlB;QAVoB;QAqBxB89D,aAAaC,GAA4B;AAClCA,eAKL,KAAKpqD,UAAUqqD,eAAf,EAAiChjD,YAAY+iD,CAA7C,GACA,KAAKjB,aAAaiB,KALhB,KAAKjB,aAAa;QAFmB;QAiBzCS,aAAaU,GAA4B;AAClCA,cAKD,KAAKtqD,UAAUqqD,eAAf,MACE,KAAKlB,aACP,KAAKnpD,UACFqqD,eADH,EAEG9iD,aAAa+iD,GAAW,KAAKnB,UAFhC,IAIA,KAAKnpD,UAAUqqD,eAAf,EAAiChjD,YAAYijD,CAA7C,KAVF,KAAKhB,aAAa;QAFmB;QAsBzCiB,gBAAa;AACP,eAAKvqD,UAAUwqD,6BAA6B,KAAKrB,cACnD,KAAKnpD,UAAU8pD,UAAf,EAA4BW,KAA5B;QAFS;QAYb77D,UAAO;AACL,gBAAM87D,IAAYpwD,OAAOU,KAAK,KAAKquD,OAAjB;AAClB,mBAASjtD,IAAI,GAAGuuD,GAAWA,IAAWD,EAAUtuD,CAAV,GAAeA;AACnD,iBAAKqtD,iBAAiBkB,CAAtB;AAEF,eAAKtB,QAAQ13B,MAAb;AACI,eAAKy3B,YACP,KAAKA,QAAQx6D,QAAb,GACA,KAAKw6D,UAAU;QARZ;MA7JH;0DAEYwB,eAAe;AAtBjC,UAAA7b,uCAAA,CAAA;AAoBama,2CAAAA,gBAAAA;A9FpBb,UAAAna,qCAAA,CAAA;AA+BgBnhD,yCAAAA,mBAAAA;AAwCAC,yCAAAA,mBAAAA;AAuNAy5B,yCAAAA,WAAAA,EAAAA;AAhRA35B,yCAAAA,uBAAAA;AAgGAw4B,yCAAAA,OAAAA,EAAAA;AC1EhB,UAAIuB,+CAA2C5qB,QAsB3C6qB,yCAAU,OAYVM,yCAAU,OAKDiB,uCAAQ,IAGjBb,6CAAkC,GAGlCE,yCAA8B,GAK9BE,uCAAQ,GAKRG,uCAAQ,GAGRlqB,yCAA8B,MAM9B0pB,iDAAsC,MAK7BkB,0CAAW,GAKXE,0CAAW,IAKXT,2CAAY,IAKZC,0CAAW,KAKXU,yCAAU,GAGnB9B,8CAAsC,MAhI1CmnB,gCAAA,EAwHa/lB,UAAAA,yCA7CAE,OAAAA,sCAkDAQ,SAAAA,wCApBAJ,UAAAA,yCAKAE,UAAAA,yCAKAT,WAAAA,yCAnHb;oCAyMgBx6B,kBAAAA;AA4JAM,oCAAAA,QAAAA;AA5KAxC,oCAAAA,YAAAA;AAgJAuC,oCAAAA,UAAAA;AApRAT,oCAAAA,mBAAAA;AAkFAC,oCAAAA,SAAAA;oCAUAC,qBAAAA;AAiMAd,oCAAAA,OAAAA;AAjRAF,oCAAAA,YAAAA;AArBAa,oCAAAA,mBAAAA;AAuLAM,oCAAAA,oBAAAA;AA6IAM,oCAAAA,UAAAA;ACpWhB,UAAI86B,oDAAgB,MA2BhBE,+CAAW,MAsMFE,4CAAiC,EAC5C,MAAQ,WACR,OAAS,WACT,MAAQ,WACR,SAAW,WACX,MAAQ,WACR,OAAS,WACT,MAAQ,WACR,QAAU,WACV,MAAQ,WACR,OAAS,WACT,QAAU,WACV,KAAO,WACP,QAAU,WACV,MAAQ,WACR,OAAS,WACT,QAAU,UAhBkC,GA7O9C+kB,qCAAA,CAAA;AAkNgBr/C,yCAAAA,QAAAA;yCA9LAR,mBAAAA;AA2BAE,yCAAAA,cAAAA;AAgFAI,yCAAAA,WAAAA;AAsBAC,yCAAAA,WAAAA;AAiHAE,yCAAAA,WAAAA;yCAzBHq6B,QAAAA;AAnKG16B,yCAAAA,QAAAA;AAsCAC,yCAAAA,WAAAA;AAjFAJ,yCAAAA,mBAAAA;AA2BAE,yCAAAA,cAAAA;AC1DhB,UAAA0/C,sCAAA,CAAA;AAkOgBh/C,0CAAAA,yBAAAA;AA8BAC,0CAAAA,mBAAAA;AApDAF,0CAAAA,2BAAAA;AAbAD,0CAAAA,wBAAAA;A4F5HV,UAAgBi9B,qCAAhB,MAAA;QA+IJvM,YACE/Z,GACAqkD,GACA77B,GAAoB;AAnItB,eAAA87B,gBAA0B;AAgB1B,eAAApxD,OAAgBoD;AAyCN,eAAAiuD,aAHF,KAAAC,oBAHE,KAAAC,eAHA,KAAAC,eAHA,KAAAC,cAHA,KAAAC,cAHF,KAAA9B,aANA,KAAAH,aAPA,KAAAkC,WANE,KAAAC,aAAuC;AA4CjD,eAAA3sC,WAAW;AAGX,eAAA4sC,mBAAmB;AAGT,eAAAC,eAA6B;AAW7B,eAAAC,WALA,KAAAC,WAHA,KAAAC,WAAW;AAyBrB,eAAAC,cAPA,KAAAC,cAPU,KAAAC,eAA+B;AAoBzC,eAAAC,WAAW;AAOX,eAAAC,eAAe;AAGf,eAAA1d,SAAS;eAuBF2d,SACH,mBAAmB,WAAWhgC,YAC1B,WAAWA,UAAU6+B,gBACrB,KAAKA;AAGX,eAAKoB,QAAQ,IAAIxhD,uCAAK,GAAG,CAAZ;AAETlE,gBAAUsmB,mCAAMq/B,eAChBn9B,KACF,KAAKo9B,WAAWp9B,CAAhB,GAEF,KAAKy5B,SAASjiD,CAAd,GACIqkD,KACF,KAAKwB,aAAaxB,CAAlB;QApBkB;QA+BZuB,WAAWp9B,GAAmB;AAGlCA,YAAOlH,WACT,KAAK2S,WAAmB3qC,8DAAyBk/B,EAAOlH,OAAxC,CAAhB;QAJoC;QAaxCwkC,eAAez9D,GAAY;AACzB,cAAI,KAAK28D;AACP,kBAAMzxD,MAAM,gCAAN;AAER,eAAKyxD,eAAe38D;QAJK;QAY3B09D,eAAY;AAER,WAAC,KAAKxB,cACN,KAAKS,gBACL,CAAC,KAAKA,aAAajf,cAAlB,KACD,KAAKif,aAAaxrD,UAAUqe,aAE5B,KAAK0sC,aAAc,KAAKS,aAAaxrD,UAClC2jB,YADgB,EAEhB4oC,aAFgB;AAIrB,iBAAO,KAAKxB;QAXF;QAoBZzrC,iBAAc;AACZ,iBAAO,KAAKksC;QADA;QAWd31D,OAAI;AACE,eAAKu1D,gBAIT,KAAKA,cAAkB9lE,kDAAiBqwC,qCAAI8e,GAAG,CAAA,CAA5B,GACd,KAAKpnD,UAAL,MACH,KAAK+9D,YAAYxiD,MAAMkB,UAAU,SAEZ,KAAK0hD,aACb5oC,WAAf,EAA4Bvb,YAAY,KAAK+jD,WAA7C,GACA,KAAKhrB,SAAL,GACA,KAAKI,eAAL,GACA,KAAK/F,WAAW,KAAK4wB,QAArB,GACA,KAAKmB,YAAL,GACA,KAAKrrC,UAAL,GACA,KAAKmf,YAAL;QAhBE;QAsBMF,WAAQ;AAChB,eAAKqsB,kBAAL;AACA,eAAKC,mBAAL;QAFgB;QASlBvrC,YAAS;QAAA;QAUCwrC,mBAAgB;AACxB,iBAAO,CAAC,KAAKxB;QADW;QAShBsB,oBAAiB;AACzB,eAAKtB,cAAkB7lE,kDACrBqwC,qCAAIof,MACJ;YACE,IAAM,KAAKwX,aAAL,EAAqBK;YAC3B,IAAM,KAAKL,aAAL,EAAqBK;YAC3B,GAAK;YACL,GAAK;YACL,QAAU,KAAKV,MAAM3pD;YACrB,OAAS,KAAK2pD,MAAM7pD;YACpB,SAAS;UAPX,GASA,KAAK+oD,WAXY;QADM;QAqBjBsB,qBAAkB;AAC1B,eAAKxB,eAAmB5lE,kDACtBqwC,qCAAIqf,MACJ,EACE,SAAS,cADX,GAGA,KAAKoW,WALa;AAOhB,eAAKmB,aAAL,EAAqBM,8BACvB,KAAK3B,aAAazoD,aAAa,qBAAqB,SAApD;AAEF,eAAKwoD,eAAehkD,SAASG,eAAe,EAAxB;AACpB,eAAK8jD,aAAa7jD,YAAY,KAAK4jD,YAAnC;QAZ0B;QAmBlBuB,cAAW;AACnB,gBAAMM,IAAc,KAAKC,gBAAL;AACpB,cAAI,CAACD;AAAa,kBAAU/yD,MAAM,kCAAV;AAChBxL,yDAAgBu+D,CAAxB;AACA,eAAK9B,oBAAkCnmE,sDACrCioE,GACA,eACA,MACA,KAAKE,YAJkB;QAJN;QAmBrBp4B,QAAQq4B,GAAqB;AAE3B,eAAKxE,SAASwE,EAAajkD,WAA3B;QAF2B;QAa7B0mB,MAAMu9B,GAAqB;AAEzBA,YAAajkD,cAAc,KAAKm0B,SAAL;AAC3B,iBAAO8vB;QAHkB;QAmB3BzwC,UAAU0wC,GAA8B;AAChCC,cAAc,KAAKC,gBAAgBtgC,kCAArB;AACpB,iBAAoB,SAAhBqgC,IACKA,IAEF,KAAKhwB,SAAL;QAL+B;QAexC1gB,UAAUhd,GAAyB;AAC7B,eAAK4tD,gBAAgBvgC,oCAAOrtB,CAA5B,KAGJ,KAAKgpD,SAAShpD,CAAd;QAJiC;QAgBzB2tD,gBAAgBE,GAAwB;AAChD,iBACEA,EAAarhC,UAAUzP,cAAc,KAAKA,aAC1C8wC,EAAarhC,UAAUyD,UAAU,KAAKA,SAEhCnsB,IAAgB2D,EAAAA,+CAAc,OAAvB,GACb3D,EAAKd,aAAa,QAAQ,KAAK/I,QAAQ,EAAvC,GACsBtS,2CAAU,KAAKsoC,MAAMnsB,CAAX,CAAnB+F,EACDvC,QACV,sDACA,EAFK,KAOF;QAfyC;QA2BlDsmD,gBACEC,GACA7tD,GAAyB;AAEzB,iBACE6tD,EAAarhC,UAAUxP,cAAc,KAAKA,aAC1C6wC,EAAarhC,UAAU2I,YAAY,KAAKA,WAExC,KAAKA,QAAiB7lB,EAAAA,2CAAUtP,CAAnB,CAAb,GACO,QAIF;QAXkB;QAmB3B7Q,UAAO;AACOtB,yDAAY,IAAxB;uDACsB,IAAtB;AAEK,cAAA;AAAL,WAAK,SAAA,IAAA,KAAKgyB,eAAL,KAAA,IAAA,EAAuBitB,cAAvB,MACC5mD,4CAAW,KAAKylE,WAApB;AAGF,eAAKzsC,WAAW;QARX;QAYP6hB,iBAAc;AACZ,gBAAM3jC,IAAQ,KAAKuuD,aACbv8D,IAAQ,KAAKywB,eAAL;AACT,eAAKysC,YAAalvD,KAAUhO,MAG7B,KAAK48D,YAAY58D,EAAMu+C,WAAN,KACf7nD,0CAASsX,GAAO,qBAApB,GACIpX,6CAAYoX,GAAO,wBAAvB,GACAA,EAAM+L,MAAMqhD,SAAS,KAAK3b,WAEtB/oD;YAASsX;YAAO;UAApB,GACIpX,6CAAYoX,GAAO,qBAAvB,GACAA,EAAM+L,MAAMqhD,SAAS;QAbX;QAuBd57B,WAAWC,GAAgB;AACzB,eAAKm9B,WAAWn9B;AAChB,eAAKkS,eAAL;QAFyB;QAW3Br9C,YAAS;AACP,iBAAO,KAAKsoE;QADL;QAST8B,cAAW;AACT,iBACE,KAAK9B,YACL,CAAC,CAAC,KAAKD,gBACP,KAAKA,aAAape,WAAlB,KACA,KAAKogB,gBAAgB1gC,mCAAMb,UAAUuhC;QAL9B;QAmBXC,oBAAoBC,GAA0B;AAC5C,iBAAO,CAACA;QADoC;QAY9CC,sBAAmB;AACjB,iBACE,KAAKlC,YACL,KAAKM,YACL,CAAC,CAAC,KAAKP,gBACP,KAAKA,aAAape,WAAlB;QALe;QAenBziD,iBAAc;AACZ,cAAIA,IAAiB;AACjB,eAAK+O,SACH,KAAKsyD,eACPrhE,IAAiB,OACR,KAAKohE,aACdrxD,QAAQxG,KACN,iKADF,GAKAvJ,IAAiB;AAGrB,iBAAOA;QAdK;QAsBd0C,YAAS;AACP,iBAAO,KAAKq+D;QADL;QAWThT,WAAW/wB,GAAgB;AACzB,cAAI,KAAK+jC,aAAa/jC,GAAtB;AAGA,iBAAK+jC,WAAW/jC;AAChB,gBAAMiU,IAAO,KAAKwvB;AACdxvB,kBACFA,EAAKhzB,MAAMkB,UAAU6d,IAAU,UAAU;UAN3C;QADyB;QA0B3B0kC,aAAauB,GAA0B;AACrC,eAAKtC,aAAasC;QADmB;QASvCC,eAAY;AACV,iBAAO,KAAKvC;QADF;QAUZ1oC,aAAU;AACR,iBAAO,KAAKwoC;QADJ;QAUA0C,gBAAa;AACrB,cAAI,CAAC,KAAK3C;AACR,kBAAUpxD,MAAM,2BAA2B,KAAKoxD,WAAhC,GAAV;AAER,iBAAO,KAAKA;QAJS;QAab4C,iBAAc;AACtB,cAAI,CAAC,KAAK7C;AACR,kBAAUnxD,MAAM,uBAAuB,KAAKmxD,YAA5B,GAAV;AAER,iBAAO,KAAKA;QAJU;QAad8C,iBAAc;AACtB,cAAI,CAAC,KAAK/C;AACR,kBAAUlxD,MAAM,uBAAuB,KAAKkxD,YAA5B,GAAV;AAER,iBAAO,KAAKA;QAJU;QAmBxB3qB,cAAW;QAAA;QAQD2tB,UAAO;AACX,eAAKhD,iBACP,KAAKA,aAAaiD,YAAY,KAAKC,gBAAL;AAEhC,eAAKC,YAAL;QAJe;QAgBjBC,WAAWpyD,GAAS;AACd,eAAKsxD,YAAL,KACF,KAAKC,YAAYvxD,CAAjB;QAFgB;QAaVuxD,YAAYllC,GAAU;QAAA;QAqBhC56B,4BAAyB;AACvB,iBAAO;QADgB;QASf0gE,YAAY57C,GAAe;AACnC,gBAAM87C,IAAY,KAAK/B,aAAL;AACZgC,cACOzxD,WAAX0V,IACIA,IACC,KAAKm6C,iBAAL,IAEC,IADA,KAAKJ,aAAL,EAAqBiC;AAE7B,cAAIC,IAAuB,IAAVF,GACbG,IAAcJ,EAAWK,mBAEzBC,IAAe;AACf,eAAK1D,iBACP0D,IAAmB3oE,kDACjB,KAAKilE,cACLoD,EAAWO,qBACXP,EAAWQ,uBACXR,EAAWS,qBAJE,GAMfN,KAAcG;AAEX,eAAKjC,iBAAL,MACH+B,IAAc/hD,KAAKE,IAAI6hD,GAAaJ,EAAWU,wBAAjC;AAGhB,eAAK9C,MAAM3pD,SAASmsD;AACpB,eAAKxC,MAAM7pD,QAAQosD;AAEnB,eAAKQ,qBAAqBV,GAASK,CAAnC;AACA,eAAKM,oBAAL;QA7BmC;QAuC3BD,qBAAqBV,GAAiBK,GAAoB;AAClE,cAAK,KAAK1D,cAAV;AAGA,gBAAMoD,IAAY,KAAK/B,aAAL,GACZ4C,IAAa,KAAKjD,MAAM3pD,SAAS,GAKnC;AAHJ,iBAAK2oD,aAAazoD,aAChB,KACAjI,QACyBkX,SAAvBA,IAAAA,KAAK4N,eAAL5N,KAAuBA,IAAvBA,EAAuBA,OACnB,KAAKw6C,MAAM7pD,QAAQusD,IAAeL,IAClCA,CAHN,CAFF;AAQA,iBAAKrD,aAAazoD,aAChB,KACAjI,OACE8zD,EAAWzB,6BACPsC,IACAA,IACEb,EAAWK,oBAAoB,IAC/BL,EAAWc,mBALnB,CAFF;UAdA;QADkE;QA4B1DF,sBAAmB;AACtB,eAAK/D,gBAGV,KAAKA,YAAY1oD,aAAa,SAASjI,OAAO,KAAK0xD,MAAM7pD,KAAlB,CAAvC,GACA,KAAK8oD,YAAY1oD,aAAa,UAAUjI,OAAO,KAAK0xD,MAAM3pD,MAAlB,CAAxC,GACA,KAAK4oD,YAAY1oD,aACf,MACAjI,OAAO,KAAK+xD,aAAL,EAAqBK,wBAA5B,CAFF,GAIA,KAAKzB,YAAY1oD,aACf,MACAjI,OAAO,KAAK+xD,aAAL,EAAqBK,wBAA5B,CAFF;QAV2B;QAuB7BxmE,UAAO;AACL,cAAI,CAAC,KAAKiH,UAAL;AACH,mBAAO,IAAIqd,uCAAK,GAAG,CAAZ;AAGL,eAAKihD,YACP,KAAKsC,QAAL,GACA,KAAKtC,WAAW,SACP,KAAKD,YAAiC,MAArB,KAAKQ,MAAM7pD,UAGrC,KAAK4rD,QAAL,GAEyB,MAArB,KAAK/B,MAAM7pD,SACb3H,QAAQxG,KACN,qGADF;AAMJ,iBAAO,KAAKg4D;QApBP;QA+BPlpC,gBAAa;AAGX,cAAIlW;AACEje,cAAAA,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAGZ,cAAI,KAAK2vB,iBAAL,GAAyB;AAIrB5pC,gBAAAA,IAAQ,KAAKyoC,aAA0Bv1B,eAA/B;AACd,kBAAMl3B,IAASlQ,EAAMmR,UAA2BjB;AAChD+N,gBAAK,KAAKuiD,eAAL;AACLvsC,iBAAeC,EAAK1gB,QAAQ,KAAKtD;AACjC8jB,iBAAgBE,EAAKxgB,SAAS,KAAKxD;AAErB6yC,4DACZ9kC,EAAGnH,KAAK,MAAM5G,GACd+N,EAAGjH,KAAK,MAAM9G,MAEd+N,EAAGnH,KAAK,MAAM5G,GACd+N,EAAGjH,KAAK,MAAM9G;UAfW;AAkBrBgkB,gBAAO,KAAKooC,YAAahgD,sBAAlB,GACb2B,IAAWtmB,iDAAc,KAAK2kE,WAAzB,GACLroC,IAAcC,EAAK1gB,OACnBwgB,IAAeE,EAAKxgB;AAEtB,iBAAO,IAAIsJ,uCAAKiB,EAAGjH,GAAGiH,EAAGjH,IAAIgd,GAAc/V,EAAGnH,GAAGmH,EAAGnH,IAAImd,CAAjD;QAhCI;QAyCb5B,iBAAiBouC,GAAa;QAAA;QAQpBnB,kBAAe;AACvB,cAAI7kD,IAAO,KAAK+Q,QAAL;cACP,CAAC/Q;AAEH,mBAAOwjB,mCAAMyiC;AAEXjmD,YAAKxN,SAAS,KAAKyvD,qBAErBjiD,IAAOA,EAAK2gB,UAAU,GAAG,KAAKshC,mBAAmB,CAA1C,IAA+C;AAGxDjiD,cAAOA,EAAKvC,QAAQ,OAAO+lB,mCAAMyiC,IAA1B;AACH,eAAK/D,gBAAgB,KAAKA,aAAa95C,QAEzCpI,KAAQ;AAEV,iBAAOA;QAhBgB;QA2BzB+Q,UAAO;AAGL,gBAAM/Q,IAAO,KAAKkmD,SAAL;AACb,iBAAa,SAATlmD,IACK9O,OAAO8O,CAAP,IAEF9O,OAAO,KAAK2iC,SAAL,CAAP;QAPF;QAkBGqyB,WAAQ;AAChB,iBAAO;QADS;QAYlBC,YAAS;AACP,eAAK9D,WAAW;AAChB,eAAKZ,aAAa;QAFX;QAaT2E,gBAAa;AACX,eAAK/D,WAAW;AACZ,eAAKH,gBAAgB,KAAKA,aAAantC,YACxC,KAAKmtC,aAA0B5hE,YAA/B;QAHQ;QAkBb6+D,SAAShtD,GAA8BuiD,IAAkB,MAAI;AAE3D,cAAiB,SAAbviD,GAAJ;AAMA,gBAAMk0D,IAAkB,KAAKC,mBAAmBn0D,CAAxB;AAClBo0D,gBAAa,KAAKC,mBACtBr0D,GACAk0D,GACA3R,CAHiB;AAKnB,gBAAI,EAAA6R,aAAsB91D,QAA1B;AAKwB,kBAAA;AAAlBg2D,kBAAkB,SAAA,IAAA,KAAKlC,aAAL,KAAA,SAAA,EAAqBppD,KAAK,MAAMorD,CAAhC;AAClBG,kBAAa,KAAKF,mBACtBD,GACAE,GACA/R,CAHiB;AAKfgS,2BAAsBj2D,UAKpBm9B,IAAS,KAAKs0B,cAChBt0B,KAAUA,EAAOvY,aAKf4pC,IAAW,KAAKprB,SAAL,GACborB,MAAayH,IAEf,KAAKC,eAAeD,CAApB,KAIF,KAAKC,eAAeD,CAApB,GACIhS,KAAmB9mB,KAAqB/zC,8CAAX,KACpBL,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B;gBACHrH;gBACA;gBACA,KAAKx9B,QAAQ;gBACb6uD;gBACAyH;cALF,CADF,GAUE,KAAKrE,YACP,KAAK+D,cAAL;YA1CF;UAZA;QAF2D;QAqErDI,mBACNr0D,GACAy0D,GACAlS,GAAwB;AAExB,iBAAuB,SAAnBkS,KACF,KAAKC,gBAAgB10D,GAAUuiD,CAA/B,GACI,KAAK2N,YACP,KAAK+D,cAAL,GAEK31D,MAAA,KAEiB+C,WAAnBozD,IAAgCz0D,IAAiBy0D;QAThC;QAiB1B/yB,WAAQ;AACN,iBAAO,KAAK8uB;QADN;QA0BE2D,mBACRn0D,GAAiC;AAEjC,iBAAiB,SAAbA,KAAkCqB,WAAbrB,IAChB,OAGFA;QAN0B;QAezBw0D,eAAex0D,GAAW;AAClC,eAAKwwD,SAASxwD;AACd,eAAKkwD,WAAW;QAFkB;QAa1BwE,gBACRC,GACAC,GAAgC;QAAA;QASxBrD,aAAa/wD,GAAe;AAC/B,eAAKuvD,gBAAgB,CAAA,KAAKA,aAAajf,cAAlB,MAGpB7oC,IAAW,KAAK8nD,aAAaxrD,UAA2BswD,WAAWr0D,CAAxD,MAEfyH,EAAQ6sD,cAAc,IAAtB;QANkC;QAkBtC91B,WAAW+1B,GAA8B;AAClCA,eAAqB,OAAXA,MAEbA,IAAS,KAAKhF;AAEhB,gBAAMsB,IAAc,KAAKC,gBAAL;AAChBD,cACDA,EAAmChlC,UAAU0oC,IAG9C,KAAKnF,WAAWmF;QAVqB;QAmBzCC,aAAU;AACR,gBAAM3D,IAAc,KAAKC,gBAAL;AACpB,iBAAID,IACaz+D,kDAAmBy+D,CAA3B,IAGMz+D,kDAAmB,EAACy5B,SAAS,KAAKujC,SAAf,CAA3B;QANC;QAgBA0B,kBAAe;AACvB,iBAAO,KAAKjB,gBAAgB,KAAKlpC,WAAL;QADL;QAUfysC,iBAAc;AACtB,iBAAa7oE,iDAAc,KAAKumE,gBAAL,CAApB;QADe;QAYxB2D,sBAAmB;AACjB,iBAAO;QADU;QAUnBC,sBAAmB;QAAA;QAUnBC,iBAAc;AACZ,cAAIC,IAAc;AAClB,gBAAMhiE,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,gBAAMnf,IAAShvB,EAAM6uB;AAErB,mBAASozC,IAAM,GAAGA,IAAMjiE,EAAM6uB,UAAU5hB,QAAQg1D,KAAO;AACrD,kBAAMnzC,IAAQE,EAAOizC,CAAP,GACRC,IAAYpzC,EAAMC;AACxB,qBAASlN,IAAI,GAAGA,IAAIqgD,EAAUj1D,QAAQ4U;AACpC,kBAAIqgD,EAAUrgD,CAAV,MAAiB,MAAM;AACzBmgD,oBAAclzC;AACd;cAFyB;UAJwB;AAUvD,iBAAOkzC;QAlBK;QA0BdG,aAAU;AACR,iBAAO;QADC;QASVC,iBAAc;AACZ,iBAAO;QADK;QAUdC,WAAWC,GAA2B;AACpC,iBAAO;QAD6B;QAUtChH,aAAaC,GAAqB;AAChC,cAAKA,GAAL;AAKA,gBAAI,CAAC,KAAKgB;AACR,oBAAUrxD,MAAM,sBAAsB,KAAKqxD,WAA3B,GAAV;AAER,iBAAKA,YAAY/jD,YAAY+iD,CAA7B;AACA,iBAAKjB,aAAaiB;UATlB;AACE,iBAAKjB,aAAa;QAFY;QAmBlCS,aAAaU,GAAqB;AAChC,cAAKA,GAAL;AAKA,gBAAI,CAAC,KAAKc;AACR,oBAAUrxD,MAAM,sBAAsB,KAAKqxD,WAA3B,GAAV;AAER,iBAAKA,YAAY/jD,YAAYijD,CAA7B;AACA,iBAAKhB,aAAagB;UATlB;AACE,iBAAKhB,aAAa;QAFY;QAkBlC8H,iBAAc;AACZ,cAAMviE,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAENh9B,cAAYnR,EAAMmR;AACpBA,YAAUwqD,6BAA6B,KAAKrB,cAC9CnpD,EAAU8pD,UAAV,EAAuBW,KAAvB;AAEEzqD,YAAUwqD,6BAA6B,KAAKlB,cAE9CtpD,EAAU+pD,UAAUb,oDAAc0B,YAAlC,EAAiDH,KAAjD;QAXU;QAyBPnnE,OAAAA,SAAS+tE,GAAqB;AACnC,gBAAUt3D,MACR,6FADI;QAD6B;MAn2CjC;AAkBY+yB,yCAAAyiC,OAAO;AAOPziC,yCAAAq/B,aAAamF,OAAO,YAAP;AAu2CzB,UAAOt0B,oDAAP,cAAoCjjC,MAApC;QAEJwmB,cAAA;AACE,gBACE,kFADF;QADF;MAFI,GAn8CNwuB,8BAAA,CAAA;AAmEsBjiB,kCAAAA,QAAAA;AAg4CTkQ,kCAAAA,uBAAAA;A3Fn7Cb,UAAI5a,yCAAiB,MAGjB2K,kDAAsC,MAGtCn+B,2CAA+B,MAG7Bg+B,sDAAqB,oBAGvBK,qDAAoB,IAGpBpJ,kDAAiB,IAGjB+D,+CAlCJmnB,kCAAA,CAAA;AA6DgB1iD,sCAAAA,YAAAA;sCApBA+B,SAAAA;AA4EAb,sCAAAA,OAAAA;AAyCAD,sCAAAA,cAAAA;AAYA4C,sCAAAA,2BAAAA;AAtBA7C,sCAAAA,YAAAA;AA0DA8C,sCAAAA,qBAAAA;sCA6FAzC,4BAAAA;AAxNAV,sCAAAA,OAAAA;AAhCAiD,sCAAAA,kBAAAA;ACnBhB,UAAIs9B,kDAA6B,MAE3BC,gDAAa,CAAA,GAuBfE,2CAAqB,MAzDzBqhB,oCAAA,CAAA;AAyOgBhgB,wCAAAA,kBAAAA,EAAAA;AAfAngC,wCAAAA,UAAAA;AAjLA2B,wCAAAA,kBAAAA;wCAyKAhD,OAAAA;AAhKAiD,wCAAAA,kBAAAA;AAiBAxD,wCAAAA,OAAAA;A2F7CV,UAAOi+C,kEAAP,MAAA;QAMJ1qB,cAAA;AAHQ,eAAAgxC,YAAY,oBAAI/e;AAItB,eAAKgf,MAAL;QADF;QAKAA,QAAK;AACH,eAAKD,UAAU5/B,MAAf;QADG;QAULzvC,SAASguB,GAAkB;AACzB,cAAI,KAAKqhD,UAAUt4C,IAAI/I,EAAKpQ,EAAxB;AACF,kBAAM/F,MAAM,wBAAwBmW,EAAKpQ,KAAK,0BAAxC;AAER,eAAKyxD,UAAUz4C,IAAI5I,EAAKpQ,IAAIoQ,CAA5B;QAJyB;QAa3B9tB,WAAW0d,GAAU;AACnB,cAAI,CAAC,KAAKyxD,UAAUt4C,IAAInZ,CAAnB;AACH,kBAAU/F,MAAM,wBAAwB+F,IAAK,cAAvC;AAER,eAAKyxD,UAAU93C,OAAO3Z,CAAtB;QAJmB;QAWrBzd,QAAQyd,GAAU;AACT,cAAA;AAAP,iBAAO,SAAA,IAAA,KAAKyxD,UAAUhuE,IAAIuc,CAAnB,KAAA,IAA0B;QADjB;QAelB2xD,sBACErmB,GACA3c,GAAY;AAEZ,gBAAMijC,IAAmC,CAAA;AACzC,qBAAWxhD,KAAQ,KAAKqhD,UAAUn9C,OAAf;AACjB,gBAAIg3B,MAAcl7B,EAAKk7B,WAAW;AAChC,kBAAMumB,IAAezhD,EAAKwzB,eAAejV,CAApB;AACA,2BAAjBkjC,MAKIC,IAAgC,EACpCtoD,MAJ4B,eAA5B,OAAO4G,EAAKi7B,cACRj7B,EAAKi7B,YAAY1c,CAAjB,IACAve,EAAKi7B,aAGT7c,SAA0B,cAAjBqjC,GACT9sD,UAAUqL,EAAKrL,UACf4pB,OAAAA,GACA8c,QAAQr7B,EAAKq7B,OALuB,GAOtCmmB,EAAYx1D,KAAK01D,CAAjB;YAd8B;AAkBpCF,YAAY38C,KAAK,SAAU8Q,GAAG7M,GAAC;AAC7B,mBAAO6M,EAAE0lB,SAASvyB,EAAEuyB;UADS,CAA/B;AAGA,iBAAOmmB;QAzBK;MA9DV;gBA2FWzmB,GAAmB;AAMtB,YAAA,IAAAA,EAAAI,cAAAJ,EAAAI,YAAS,CAAA;AACnBA,UAAA0B,QAAA;AACA1B,UAAAC,YAAA;AACAD,UAAApb,UAAA;AA8DFgb,UAAoB1H,WAAW,IAAI0H;MAvED,GAAnBA,oEAAAA,kEAAmB,CAAA,EAApC;AA2EO,UAAMI,wDAAYJ,gEAAoBI,WA5L7C0D,6CAAA,CAAA;iDAsBa9D,sBAAAA;AAsKAI,iDAAAA,YAAAA;AC7JP,UAAOhZ,sFAAP,cACIC,mEADJ;QAmBJ/R,YAAYvgB,GAAyBF,GAAW;AAC9C,gBAAME,GAAWF,CAAjB;AAJM,eAAA+xD,eAAe,IAAIlP,0EAAoB,IAAxB;AAMrB,eAAK3iD,YAAYA;AAEjB,eAAK8xD,OAAO,IAAIrT,yDAAYz+C,CAAhB;AAEZ,eAAK8xD,KAAK32C,QAAQ,KAAK/0B,QAAL,CAAlB;AACA,eAAK0rE,KAAKz2C,YAAY,KAAK+xB,WAAL,CAAtB;AAEA,eAAK2kB,uBAAL;AAEcltE;YACZ,KAAKitE,KAAKlvC,WAAV;YACA;YACA;YACA,KAAKovC;UAJP;AAOcntE,gEACZ,KAAKitE,KAAKlvC,WAAV,GACA,SACA,MACC3mB,OAAY;AACXA,cAAE6yB,gBAAF;UADW,CAJf;QAnB8C;QAiCxCijC,yBAAsB;AAC5B,eAAKD,KAAKxP,sBACR,CAACgN,GAAGpR,MAAoB,KAAK,MAAMljC,QAAQkjC,CAAd,CAD/B;AAGA,eAAK4T,KAAKnQ,sBACR,CAAC2N,GAAG/X,MAAkB,KAAK,MAAMp8B,QAAQo8B,CAAd,CAD7B;AAGA,eAAKua,KAAK1P,sBACR,MAAM,KAAK,MAAMhnC,aAAa,KAAK02C,KAAKx3C,YAAV,CAAnB,CADb;AAGA,eAAKw3C,KAAKrP,mBAAmB,MAAK;AAC3B,iBAAKlW,cAAL,KAAsB,KAAK39C,QAAL;UADK,CAAlC;QAV4B;QAgBrBosB,QAAQ1R,GAAY;AAG3B,eAAKwoD,KAAK92C,QAAQ1R,CAAlB;QAH2B;QAOpB6R,QAAQpK,GAAU;AAGzB,eAAK+gD,KAAK32C,QAAQpK,CAAlB;QAHyB;QAOlBqK,aAAab,GAAkB;AAGtC,eAAKu3C,KAAK12C,aAAab,CAAvB;QAHsC;QAO/Bc,YAAYZ,GAAiB;AACpC,gBAAMY,YAAYZ,CAAlB;eAEKq3C,KAAKz2C,YAAY,KAAK+xB,WAAL,CAAtB;QAHoC;QAOtCxqB,aAAU;AACR,iBAAO,KAAKkvC,KAAKlvC,WAAV;QADC;QAQVx8B,UAAO;AACL,iBAAO,MAAMA,QAAN;QADF;QAQPs7C,uBAAoB;AAClB,gBAAMvnB,IAAM,KAAKf,uBAAL;AACM04C,cAAAA,GAAL;AAAb,gBAAM/gD,IAAO,SAAA,IAAA,SAAK+gD,IAALA,KAAKA,QAAL,SAAKA,EAAM1rE,QAAX,KAAA,IAAwB,KAAKA,QAAL;AAGjC,eAAK4Z,UAAU0R,OACjBzH,IAAOkQ,EAAIxU,IAAIoL,EAAK1O,OACpBsJ,IAAQwO,EAAIxU,MAEZsE,IAAOkQ,EAAIxU,GACXgG,IAAQwO,EAAIxU,IAAIoL,EAAK1O;AAEvB,iBAAO,IAAIwJ,uCAAKsO,EAAItU,GAAGsU,EAAItU,IAAIkL,EAAKxO,QAAQ0H,GAAM0B,CAA3C;QAZW;QAgBpBrX,OAAOk0B,GAAYG,GAAYvqB,GAA6B;AAC1D,gBAAM+b,IAAM,KAAKf,uBAAL;AACN2pC,cAAS,IAAI93C,mDAAWkP,EAAIxU,IAAI6iB,GAAIrO,EAAItU,IAAI8iB,CAAnC;AACf,eAAKt0B,OAAO0uD,GAAQ3kD,CAApB;QAH0D;QAOnD/J,OAAOspD,GAAsBv/C,GAA6B;AACjE,gBAAM/J,OAAOspD,GAAUv/C,CAAvB;AACA,eAAK0zD,KAAKz9D,OAAOspD,CAAjB;QAFiE;QAUnEqF,eAAerF,GAAoB;AACjC,eAAKA,WAAWA;AAChB,eAAKmU,KAAKz9D,OAAOspD,CAAjB;QAFiC;QAUnCmF,YAAYmP,GAAiB;AACvBA,cACE1sE,0CAAS,KAAKq9B,WAAL,GAAmB,iBAAhC,IAEIn9B,6CAAY,KAAKm9B,WAAL,GAAmB,iBAAnC;QAJyB;QASpBh0B,UAAO;AACd,eAAKgvD,YAAY;AACZ,eAAKkU,KAAKvlB,cAAV,KAA2B,KAAKulB,KAAKljE,QAAV;AAChC,gBAAMA,QAAN;QAHc;QAURojE,aAAa/1D,GAAe;AAClC,gBAAMyH,IAAU,KAAK1D,UAAUswD,WAAWr0D,CAA1B;AACZyH,gBACFA,EAAQwuD,mBAAmBj2D,GAAG,IAA9B,GACOqF,EAAAA,0CAAY,IAAnB;QAJgC;QASpC6wD,eAAeC,GAAoB;AAC7BA,cACE7sE,0CAAS,KAAKq9B,WAAL,GAAmB,uBAAhC,IAEIn9B,6CAAY,KAAKm9B,WAAL,GAAmB,uBAAnC;QAJ+B;QASnCiU,YAAS;AACP,iBAAO,KAAKg7B,aAAah7B,UAAlB;QADA;QAKTC,YAAS;AACP,eAAK+6B,aAAa/6B,UAAlB;QADO;QAKTC,KAAKgsB,GAAkB;AACrB,eAAK8O,aAAa96B,KAAKgsB,CAAvB;QADqB;QAKvB/rB,UAAO;AACL,eAAK66B,aAAa76B,QAAlB;QADK;QAKPC,aAAU;AACR,eAAK46B,aAAa56B,WAAlB;QADQ;QAKVv1B,SAAM;AACAnc,oDAAS,KAAKq9B,WAAL,GAAmB,iBAAhC;QADI;QAKNnhB,WAAQ;AACFhc;YAAY,KAAKm9B,WAAL;YAAmB;UAAnC;QADM;QAQRmgB,aAAU;AACR,iBAAO,EACLvnB,QAAQqoC,iFAAuB1lB,MAC/BylB,cAAmCv5D,6DAAK,MAAM,EAC5C4vB,gBAAgB,KAD4B,CAAhC,EAFT;QADC;QAUVo4C,gBAAgBp2D,GAAe;AAC7B,gBAAMy1D,IAAczmB,gEAAoB1H,SAASkuB,sBAC/CxmB,gEAAoBI,UAAUpb,SAC9B,EAACjW,SAAS,KAAV,CAFkB;AAIRhtB;YAAKiP;YAAGy1D;YAAa,KAAK1xD,UAAU0R;YAAK,KAAK1R;UAA1D;QAL6B;QAS/BmjD,aAAU;AACR,cAAI,CAAA,KAAK5W,cAAL,GAAJ;AACA,gBAAM+lB,IAAO,KAAKtyD,UAAUuyD,QAAf;AACb,gBAAK,QAAAD,KAAAA,EAAME,WAAN,GAAL;AACA,kBAAMC,IAAY,KAAKr5C,uBAAL;AACZs5C,kBAAYJ,EAAKK,QAAQF,CAAb;AACdC,oBAAcD,KAChB,KAAKp+D,OAAOq+D,GAAW,CAAC,MAAD,CAAvB;YAJF;UAFA;QADQ;MAzPN,GA/BN3jB,4DAAA,CAAA;AA+Ba1c,gEAAAA,2BAAAA;A3F/Bb,UAAA0c,4BAAA,CAAA;AA8hBgBv9C,gCAAAA,uBAAAA;AAtWAL,gCAAAA,aAAAA;AAzEAH,gCAAAA,mBAAAA;AAiTAM,gCAAAA,+BAAAA;AAsqBAe,gCAAAA,aAAAA;gCA7eA+gC,aAAAA,EAAAA;AAkBA3hC,gCAAAA,qBAAAA;AA7OAJ,gCAAAA,kBAAAA;AAbAjK,gCAAAA,YAAAA;AA4TAsK,gCAAAA,iBAAAA;AA3PAmgC,gCAAAA,iBAAAA,EAAAA;gCAsEAtgC,uBAAAA;AA9bAT,gCAAAA,uBAAAA;AA8BAC,gCAAAA,iBAAAA;AApDAF,gCAAAA,iBAAAA;A4FTV,UAAO+hE,gEAAP,cAA2B1K,0DAA3B;QAaJ3nC,YAAYgwB,GAAiB;AAC3B,gBAAMA,CAAN;AAbO,eAAA92C,OAAkBglB,EAAAA;AAepB8xB,gBAIDA,EAAUnyB,SAAV,MAEF,KAAK1iB,aAAa,QAGpB,KAAK+1B,MAAUzgC,4CAAiBu/C,CAArB,GACX,KAAK7wC,MAAiBrc,qDAAiBktD,CAA5B,GAEX,KAAKxwC,OAAc1V,iDAAKkmD,GAAW,EAACt2B,gBAAgB,KAAjB,CAAvB;QAfe;QAuBpB61B,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKre;AACR,kBAAU13B,MACR,sFADI;AAKR,cAAI,CAAC,KAAK2F;AACR,kBAAU3F,MACR,uFADI;AAKR,cAAI,CAAC,KAAKgG;AACR,kBAAUhG,MACR,uFADI;AAKRgG,YAAA,MAAkB3Y,qCAAU,KAAKqqC,GAAnB;AACd1xB,YAAA,MAAc,KAAKL;AACnBK,YAAA,OAAe,KAAKA;AACf,eAAKrE,eACRqE,EAAA,aAAqB,KAAKrE;AAE5B,iBAAOqE;QA1BM;QAsCRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIi3D,+DAHE;AAKjBliB,YAASjf,MAAe1iB,EAAAA,2CAAUhP,EAAA,GAAnB;YACNL,MAAMK,EAAA;AACf2wC,YAAS3wC,OAAOA,EAAA;AACWjD,qBAAvBiD,EAAA,eACF2wC,EAASh1C,aAAaqE,EAAA;AAExB,iBAAO2wC;QAbI;QAqBJV,IAAI9yC,GAAgB;AAC3B,gBAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKnwC;AACR,kBAAUhG,MACR,uFADI;AAKR,cAAI,CAAC,KAAK2F;AACR,kBAAU3F,MACR,uFADI;AAKR,cAAI,CAAA84D,kEAAgB7yD,GAAW,KAAKN,GAAhC;AACJ,gBAAIxC;AACK5S;gBAAO,KAAKyV;gBAAMC;cAAzB;;AAEA,mBAAS5D,IAAI,GAAGA,IAAI,KAAKsD,IAAI5D,QAAQM,KAAK;AACxC,sBAAM0D,IAAK,KAAKJ,IAAItD,CAAT,GACLvN,IAAQmR,EAAUK,aAAaP,CAAvB;AACVjR,oBACFA,EAAMD,QAAQ,KAAd,IACSkR,MAAO,KAAKpC,WAErBhD,QAAQxG,KAAK,wCAAwC4L,CAArD;cAPsC;QAlBjB;MAlGzB,GA4IA+yD,oEAAkBA,SACtB7yD,GACAN,GAAa;AAKb,eAHgBA,EACbhD,IAAKoD,OAAOE,EAAUK,aAAaP,CAAvB,CADC,EAEb7c,OAAQ4L,OAAUA,KAASA,EAAMuvB,SAAN,CAFd00C,EAGDh3D,WAAW4D,EAAI5D;MALjB;AAeN5Z,+CAAkB2X,qCAAKsG,OAAkBC,EAAAA,4CAAQwyD,6DAA1D;UAxLA7jB,mDAAA,CAAA;AA2Ba6jB,uDAAAA,cAAAA;ACLP,UAAOG,gEAAP,cAA2B5iB,oDAA3B;QAWJ5vB,YAAYyyC,GAAwB3iB,GAAwB;AAC1D,gBAAMA,CAAN;AARO,eAAA52C,OAAkB+1C;AASzB,eAAKyjB,YAAYD;QAFyC;QAUnDljB,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKmjB;AACR,kBAAUl5D,MACR,4FADI;AAKRgG,YAAA,YAAoB,KAAKkzD;AACzB,iBAAOlzD;QATM;QAqBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIo3D,+DAHE;YAKRE,YAAYlzD,EAAA;AACrB,iBAAO2wC;QARI;MA7CT;AA6DGxuD,+CAAkB2X,qCAAKsG,OAAkBqvC,kDAAcujB,6DAAhE;AAnFA,UAAAhkB,mDAAA,CAAA;AAsBagkB,uDAAAA,cAAAA;ACGP,UAAOG,+DAAP,cAA8B/iB,oDAA9B;QAgCJ5vB,YACE4yC,GACAC,GACAC,GACAhjB,GACAijB,GAAqB;AAErB,gBAAMjjB,CAAN;AApBO,eAAA52C,OAAkBkF;AAsBzB,eAAKE,UAAUs0D;AACf,eAAKr0D,WAAWs0D;AAChB,eAAKr0D,QAAQs0D;AACb,eAAKr0D,WAAWs0D;QAPK;QAedxjB,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAqBhzC,WAAjB,KAAK+B;AACP,kBAAU9E,MACR,qFADI;AAKR,cAAsB+C,WAAlB,KAAKgC;AACP,kBAAU/E,MACR,sFADI;AAKR,cAAmB+C,WAAf,KAAKiC;AACP,kBAAUhF,MACR,kFADI;AAKR,cAAsB+C,WAAlB,KAAKkC;AACP,kBAAUjF,MACR,sFADI;AAKRgG,YAAA,UAAkB,KAAKlB;AACvBkB,YAAA,WAAmB,KAAKjB;AACxBiB,YAAA,QAAgB,KAAKhB;AACrBgB,YAAA,WAAmB,KAAKf;AACxB,iBAAOe;QA9BM;QA0CRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIu3D,8DAHE;AAKjBxiB,YAAS7xC,UAAUkB,EAAA;AACnB2wC,YAAS5xC,WAAWiB,EAAA;YACXhB,QAAQgB,EAAA;AACjB2wC,YAAS1xC,WAAWe,EAAA;AACpB,iBAAO2wC;QAXI;MAjGT;AAuHGxuD,+CACE2X,qCAAKsG,OACHxB,qDACXu0D,4DAHF;AAhJA,UAAAnkB,+CAAA,CAAA;AAyBamkB,mDAAAA,iBAAAA;ACdb,UAAYK;AAAZ,OAAA,SAAYA,GAAc;AAExBA,UAAAA,EAAAC,cAAA,CAAA,IAAA;AAEAD,UAAAA,EAAAE,eAAA,CAAA,IAAA;AAEAF,UAAAA,EAAAG,iBAAA,CAAA,IAAA;AAEAH,UAAAA,EAAAI,qBAAA,CAAA,IAAA;MARwB,GAAdJ,0DAAAA,wDAAc,CAAA,EAA1B;AAXA,UAAAxkB,wCAAA,CAAA;AAWYwkB,4CAAAA,iBAAAA;ACcN,UAAOK,oDAAP,MAAA;QAQJrzC,YAA6BR,GAAqC;AAArC,eAAAA,oBAAAA;AANZ,eAAA8zC,cAAoC,CAAA;QAMa;QASlEC,cAAch2C,GAAgCi2C,GAAY;AAClDj2D,cAAQ,KAAKk2D,sBAAsBD,CAA3B;AACd,eAAKF,YAAY72D,OAAOc,GAAO,GAAGggB,CAAlC;QAFwD;QAgBlDm2C,sBACNC,GACAH,GAAY;AAEZ,cAAI,CAAC,KAAKF,YAAY/3D;AACpB,mBAAO;AAGT,gBAAMq4D,IAAY,KAAKH,sBAAsBD,CAA3B;AAClB,cAAII,KAAa,KAAKN,YAAY/3D;AAEhC,mBAAO;AAGTi4D,cAAOG,EAAKruD;AAEZ,cAAIuuD,IAAUD;AACd,iBAAkB,KAAXC,KAAgB,KAAKP,YAAYO,CAAjB,EAA0BvuD,MAAMkuD,KAAM;AAC3D,gBAAI,KAAKF,YAAYO,CAAjB,MAA8BF;AAChC,qBAAOE;AAETA;UAJ2D;AAQ7D,eADAA,IAAUD,GAERC,IAAU,KAAKP,YAAY/3D,UAC3B,KAAK+3D,YAAYO,CAAjB,EAA0BvuD,MAAMkuD,KAChC;AACA,gBAAI,KAAKF,YAAYO,CAAjB,MAA8BF;AAChC,qBAAOE;AAETA;UAJA;AAMF,iBAAO;QAhCK;QAyCNJ,sBAAsBD,GAAY;AACxC,cAAI,CAAC,KAAKF,YAAY/3D;AACpB,mBAAO;AAET,cAAIu4D,IAAa,GACbC,IAAa,KAAKT,YAAY/3D;AAClC,iBAAOu4D,IAAaC,KAAY;AAC9B,kBAAMC,IAAa5nD,KAAK+Y,OAAO2uC,IAAaC,KAAc,CAAvC;AACnB,gBAAI,KAAKT,YAAYU,CAAjB,EAA6B1uD,IAAIkuD;AACnCM,kBAAaE,IAAa;qBACjB,KAAKV,YAAYU,CAAjB,EAA6B1uD,IAAIkuD;AAC1CO,kBAAaC;iBACR;AACLF,kBAAaE;AACb;YAFK;UANuB;AAWhC,iBAAOF;QAjBiC;QA2B1CG,iBAAiB12C,GAAgCi2C,GAAY;AACrDj2D,cAAQ,KAAKm2D,sBAAsBn2C,GAAYi2C,CAAvC;AACd,cAAc,OAAVj2D;AACF,kBAAM/D,MAAM,4CAAN;AAER,eAAK85D,YAAY72D,OAAOc,GAAO,CAA/B;QAL2D;QAgB7D22D,cACE32C,GACA42C,GAAiB;AA6BjBC,mBAASA,EAAgBC,GAAc;AACrC,kBAAMpsC,IAAKqsC,IAAWC,EAAGF,CAAH,EAAWjvD,GAC3BgjB,IAAKosC,IAAWD,EAAGF,CAAH,EAAW/uD;AACvB8G,iBAAKmc,KAAKN,IAAKA,IAAKG,IAAKA,CAAzB3b,KACD0nD,KACPM,EAAW94D,KAAK44D,EAAGF,CAAH,CAAhB;mBAEKjsC,IAAK+rC;UAPyB;AA3BvC,gBAAMI,IAAK,KAAKjB,aACVgB,IAAW/2C,EAAWnY,GACtBovD,IAAWj3C,EAAWjY;AAGxBwuD,cAAa;AACjB,cAAIC,IAAaQ,EAAGh5D,SAAS,GACzBy4D,IAAaD;AACjB,iBAAOD,IAAaE;AACdO,cAAGP,CAAH,EAAe1uD,IAAIkvD,IACrBV,IAAaE,IAEbD,IAAaC,GAEfA,IAAa5nD,KAAK+Y,OAAO2uC,IAAaC,KAAc,CAAvC;AAGf,gBAAMU,IAAmC,CAAA;AAsBzCV,cADAD,IAAaE;AAEb,cAAIO,EAAGh5D,QAAQ;AACb,mBAAqB,KAAdu4D,KAAmBM,EAAgBN,CAAhB;AACxBA;AAEF;AACEC;mBACOA,IAAaQ,EAAGh5D,UAAU64D,EAAgBL,CAAhB;UANtB;AASf,iBAAOU;QAnDU;QA+DXC,WAAWn3D,GAAeo3D,GAAeR,GAAiB;AAChE,iBAAO/nD,KAAKwP,IAAI,KAAK03C,YAAY/1D,CAAjB,EAAwB+H,IAAIqvD,CAArC,KAA+CR;QADU;QAclES,iBACEjB,GACAQ,GACAU,GAAe;AAEf,cAAI,CAAC,KAAKvB,YAAY/3D;AAEpB,mBAAO,EAACgiB,YAAY,MAAM4d,QAAQg5B,EAA3B;AAIT,gBAAMQ,IAAQhB,EAAKruD,GACbwvD,IAAQnB,EAAKvuD;AAEnBuuD,YAAKvuD,IAAI0vD,IAAQD,EAAIzvD;AACrBuuD,YAAKruD,IAAIqvD,IAAQE,EAAIvvD;AAKrB,cAAMyvD,IAAe,KAAKtB,sBAAsBE,EAAKruD,CAAhC;AAEjB0vD,cAAiB;AACrB,cAAIC,IAAad,GACb9yC,GAGAyyC,IAAaiB,IAAe;AAChC,iBAAqB,KAAdjB,KAAmB,KAAKY,WAAWZ,GAAYH,EAAKruD,GAAG6uD,CAApC;AACxB9yC,gBAAO,KAAKiyC,YAAYQ,CAAjB,GACH,KAAKt0C,kBAAkBmgB,WAAWg0B,GAAMtyC,GAAM,MAAM4zC,CAApD,MACFD,IAAiB3zC,GACjB4zC,IAAa5zC,EAAK6zC,aAAavB,CAAlB,IAEfG;AAIF,iBACEC,IAAa,KAAKT,YAAY/3D,UAC9B,KAAKm5D,WAAWX,GAAYJ,EAAKruD,GAAG6uD,CAApC;AAEA9yC,gBAAO,KAAKiyC,YAAYS,CAAjB,GACH,KAAKv0C,kBAAkBmgB,WAAWg0B,GAAMtyC,GAAM,MAAM4zC,CAApD,MACFD,IAAiB3zC,GACjB4zC,IAAa5zC,EAAK6zC,aAAavB,CAAlB,IAEfI;AAIFJ,YAAKvuD,IAAI0vD;AACTnB,YAAKruD,IAAIqvD;AAET,iBAAO,EAACp3C,YAAYy3C,GAAgB75B,QAAQ85B,EAArC;QAnDQ;QA6DV3/D,OAAAA,KAAKiqB,GAA2B;AAErC,gBAAM41C,IAAS,CAAA;AACfA,YAAOnC,sDAAeC,WAAtB,IAAqC,IAAII,kDAAa9zC,CAAjB;AACrC41C,YAAOnC,sDAAeE,YAAtB,IAAsC,IAAIG,kDAAa9zC,CAAjB;YAC/ByzC,sDAAeG,cAAtB,IAAwC,IAAIE,kDAAa9zC,CAAjB;AACxC41C,YAAOnC,sDAAeI,kBAAtB,IAA4C,IAAIC,kDAAa9zC,CAAjB;AAC5C,iBAAO41C;QAP8B;MAtQnC,GAzBN3mB,sCAAA,CAAA;AAyBa6kB,0CAAAA,eAAAA;A/FJb,UAAIj9B,wDAAsD,MAGtDN,wDAAiC,MAxBrC0Y,yCAAA,CAAA;AA+FgBt8C,6CAAAA,qBAAAA;AAmEAC,6CAAAA,qBAAAA;AAoDAE,6CAAAA,mBAAAA;6CAtLAL,kBAAAA;AgGVV,UAAOojE,4DAAP,MAAA;QAMJp1C,YAAoBvgB,GAAuB;AAAvB,eAAAA,YAAAA;AAElB,eAAK41D,2BAA2B,KAAK51D,UAAU61D,sBAAf;AAGhC,eAAKC,yBAAyB,KAAK91D,UAAU+1D,oBAAf;AAM9B,eAAKC,iBAAiB,IAAI/qD,mDAAWjL,EAAU2pB,SAAS3pB,EAAUypB,OAA5C;QAXmB;QAmB3C76B,UAAO;AAGL,eAAKoR,YAAY;QAHZ;QAWP82B,YAAS;AACI/yC,oDAAP,KACKA,0CAAP,EAAsB0d,SAAtB;QAFK;QAaTu1B,QAAQi/B,GAA8B;AAEpC,eAAKl/B,KAAKk/B,CAAV;QAFoC;QAYtCl/B,KAAKk/B,GAA8B;AAC3BC,cAAQjrD,mDAAW8Q,IAAI,KAAKi6C,gBAAgBC,CAApC;AAEd,cAAI,KAAKL,4BAA4B,KAAKE;AACxC,iBAAK91D,UAAUm2D,OAAOD,EAAMvwD,GAAGuwD,EAAMrwD,CAArC;mBACS,KAAK+vD;AACd,iBAAK51D,UAAUm2D,OAAOD,EAAMvwD,GAAG,KAAK3F,UAAUypB,OAA9C;mBACS,KAAKqsC;AACd,iBAAK91D,UAAUm2D,OAAO,KAAKn2D,UAAU2pB,SAASusC,EAAMrwD,CAApD;;AAEA,kBAAM,IAAIiL,UAAU,gBAAd;QAVyB;MA7D/B,GAtBNi+B,0CAAA,CAAA;AAsBa4mB,8CAAAA,mBAAAA;A/FtBb,UAAA5mB,+CAAA,CAAA;AA8DgBl8C,mDAAAA,cAAAA;AgGlBhB,UAAMujE,oDAAqB,GAGrBC,qDAAsB,GAKfpyB,yCAAP,MAAA;QA+HJ1jB,YACEtkB,GACiBq6D,GAA8B;AAA9B,eAAAA,mBAAAA;AA3HX,eAAAC,cAAc,IAAItrD,mDAAW,GAAG,CAAlB;AA8CZ,eAAAurD,kBAPF,KAAAr4C,cARA,KAAAs4C,eANA,KAAAt2B,aANA,KAAAu2B,YANA,KAAAC,aANA,KAAAC,cAA8B;AA8C9B,eAAAC,wBAAwB;AAOxB,eAAA1c,cAAoC,CAAA;AAQpC,eAAA2c,mBANA,KAAAC,UAA2B;AAS3B,eAAA9E,WAAoB;AAGpB,eAAA9oB,SAAyB;AAezB,eAAA6tB,gBANE,KAAAC,YAHF,KAAAC,oBAHA,KAAAC,yBAAyB;AAezB,eAAAC,eAAe,oBAAI5kB;AAWnB,eAAA6kB,gBAHA,KAAAC,gBAAgB;AAcxB,eAAAC,uBARQ,KAAAC,qBAAqC;AAmB3C,eAAKC,kBAAkBx7D;AAMvB,eAAKg6D,qBAAqB,IAAIhrD,mDAAW,GAAG,CAAlB;QARqB;QAgBjDrc,UAAO;AACCnK,4DAAN;AACQqK,iDAAR;AAEA,eAAKwnE,iBAAiBoB,aAAtB;AAEA,qBAAW/7D,KAAS,KAAKw+C;AACTp1D,yDAAO4W,CAArB;eAEGw+C,YAAYr+C,SAAS;AAEtB,eAAKg7D,oBACP,KAAKA,iBAAiBloE,QAAtB;QAZG;QAqBC+oE,gBAAgB17D,GAAe;AACrC,gBAAMw2D,IAAY,IAAIxnD,mDAAWhP,EAAE2J,SAAS3J,EAAE6J,OAA5B;AACF,eAAK8xD,gBAAgBnF,CAArBoF,MAGd,KAAKC,iBAAiB77D,CAAtB,GACMzX,sCAAN;AAEF,eAAKizE,kBAAkBx7D;QARc;QAmB/B27D,gBAAgBnF,GAAqB;AAC3C,eAAKwD,qBAAqBhrD,mDAAWkD,WACnCskD,GACA,KAAK8D,WAFmB;AAK1B,iBAAK,KAAKM,wBAWH,QAHL,KAAKA,wBAPoB5rD,mDAAWirB,UAAU,KAAK+/B,kBAA1B8B,KAGL,KAAK5uB,SACrBna,EAAAA,qCAAOg1B,mBACPh1B,EAAAA,qCAAO+0B;QAZ8B;QA+BrCiU,6BAA0B;AACD7uB,cAAAA;AAA/B,cAAI,CAAC,KAAKhrB,eAAgB,SAAKgrB,IAALA,KAAKA,WAAL,CAAKA,EAAQ8uB,iBAAiB,KAAK95C,WAAnC;AACxB,mBAAO;AAET,cAAI,CAAC,KAAKgrB,OAAOlxB;AACf,kBAAUle,MAAM,2GAAV;AAGR,iBACE,CAAC,KAAKovC,OAAO+uB,aAAZ,KACD,KAAK/uB,OAAOgvB,sBAAsB,KAAKlC,kBAAvC,KAEA,KAAKO,kBAAkB,KAAKrtB,OAAOlxB,iBACnC,KAAKu+C,gBAAgB4B,mCAArB,GAGgB74D,EAAAA,6CAAX,KACQC,EAAAA,6CAAS,IAApB,GAGF,KAAK2gC,aAAa,MAClB,KAAKhiB,cAAc,KAAKgrB,OAAOkvB,YAAY,KAAKl6C,WAA7B,GACZ7c,EAAAA,0CAAY,KAAK6c,WAAxB,GACO,QAEF;QAzByB;QAqC1Bm6C,4BAAyB;AAC/B,cAAI,CAAC,KAAK9B;AACR,kBAAUz8D,MACR,+EADI;AASR,cAHkB,KAAKovC,SACnB,KAAKA,OAAO+uB,aAAZ,IACA,KAAK1B,mBAAmB,KAAKA,gBAAgB3jE,YAArB;AAG5B,iBAAKo/D,WAAW,MAChB,KAAK6E,mBAAmB,IAAInB,0DAAiB,KAAKa,eAA1B,GAExB,KAAKM,iBAAiBhgC,UAAtB;QAhB+B;QAyBzBghC,iBAAiB77D,GAAe;AACtC,cAAI,CAAC,KAAKu6D;AACR,kBAAUz8D,MACR,iEADI;AAKR,cAAI,KAAKo9D;AACP,kBAAMp9D,MAAM,2DAAN;AAER,eAAKo9D,yBAAyB;AAI1B,eAAKhuB,UAAQ,KAAK6uB,2BAAL;gBAEX32D,IAAkBtd,0CAAP;AACbsd,eAAYxO,0DAAYwO,CAAZ,KAAyBA,EAASw1B,UAAT,KACvC,KAAKo7B,WAAW,MAChB,KAAK8E,UAAU,KAAKwB,cAAcl3D,GAAU,KAAKm1D,eAAlC,GACf,KAAKO,QAAQyB,YAAYv8D,CAAzB,GACA,KAAK86D,QAAQ0B,OAAOx8D,GAAG,KAAKg6D,kBAA5B,KAEA,KAAKqC,0BAAL;QAvBoC;QA2BhCC,cACNG,GACA14D,GAAuB;AAOvB,iBAAO,KALuBtd,oDACnBmX,qCAAKi1C,eACd,KAAKwnB,iBAAiBr7D,SACtB,IAHmB09D,GAKID,GAAW14D,CAA7B;QAPgB;QAiBzB44D,QAAQ38D,GAAe;AACrB,cAAI,CAAC,KAAKu6D;AACR,kBAAUz8D,MACR,0EADI;AAKR,eAAKy9D,qBACH,KAAKhB,gBAAgBv7D,QAAQ+tC,eAC7B,KAAKwtB,gBAAgBv7D,QAAQ+tC,YAAY6vB;AAEzB7zE,8DAAciX,CAA5B,IACF,KAAK68D,OAAL,KAIF,KAAK5B,oBAAoB,MAETtkE,yDAAhB,GAEA,KAAK4jE,gBAAgB4B,mCAArB,GACI,KAAK5B,gBAAgBr9B,aAGvB,KAAKq9B,gBAAgB7zD,OAArB,GAIF,KAAK40D,uBAAmChrE,4CAAZ,GAG5B,KAAKiqE,gBAAgBh9D,UAAU,CAAC,CAAC,KAAK2vC,MAAtC,GAEA,KAAKqtB,gBAAgBhxC,YAArB,GACA,KAAKiyC,kBAAkBx7D,GAEfpN,qCAAR,GAEkB5J,oDAAcgX,CAA5B,IACF,KAAK2H,iBAAiB3H,CAAtB,KAI2B,kBAAzBA,EAAExC,KAAKO,YAAP,KAA4D,YAAlBiC,EAAE88D,eACxCx0E,uCAAU0X,GAAG,IAAnB,GAGF,KAAKs6D,cAAc,IAAItrD,mDAAWhP,EAAE2J,SAAS3J,EAAE6J,OAA5B,GAEnB,KAAKvX,gBAAgB0N,CAArB,GAEK,KAAKg7D,aACR,KAAK+B,iBAAiB/8D,CAAtB;QApDmB;QA8DvB1N,gBAAgB0N,GAAe;AAC7B,eAAKk+C,YAAYj+C,KACDrX;YACZoiB;YACA;YACA;YACA,KAAKwyC,YAAY30D,KAAK,IAAtB;YAC8B;UALhC,CADF;AASA,eAAKq1D,YAAYj+C,KACDrX,sDACZoiB,UACA,eACA,MACA,KAAKgyD,WAAWn0E,KAAK,IAArB,GAC8B,IALhC,CADF;AASA,eAAKq1D,YAAYj+C,KACDrX,sDACZoiB,UACA,aACA,MACA,KAAKiyD,SAASp0E,KAAK,IAAnB,GAC8B,IALhC,CADF;AAUAmX,YAAE4yB,eAAF;AACA5yB,YAAE6yB,gBAAF;QA9B6B;QAuC/B2qB,YAAYx9C,GAAe;AACrB,eAAK+E,WAAL,MAIJ,KAAKg4D,iBAAiB/8D,CAAtB,GAEI,KAAKk9D,aAAL,KACI30E,sCAAN;QARuB;QAkB3By0E,WAAWh9D,GAAe;AACxB,cACG,KAAK+E,WAAL,KAA2Btc,+CAAkBuX,CAAxB,KACtB,CAAC,KAAKk9D,aAAL,GACD;AACA,iBAAKxB,gBAAgB17D,CAArB;AACA,gBAAI,KAAK66D;AACP,mBAAKA,iBAAiB//B,KAAK,KAAKk/B,kBAAhC;qBACS,KAAKc;AACd,mBAAKA,QAAQ0B,OAAO,KAAKhB,iBAAiB,KAAKxB,kBAA/C;AAEFh6D,cAAE4yB,eAAF;AACA5yB,cAAE6yB,gBAAF;UARA;AASS,iBAAKqqC,aAAL,MACT,KAAKC,gBAAgBn9D,CAArB,GACMzX,sCAAN;QAfsB;QAyB1B00E,SAASj9D,GAAe;AACjB,eAAK+E,WAAL,KACH,KAAKq4D,eAAep9D,CAApB;AAEF,cAAI,CAAC,KAAKk9D,aAAL,KAAuB,KAAKn4D,WAAL,GAAmB;AAC7C,gBAAI,CAAOtc,+CAAkBuX,CAAxB;AACH;iBAEG07D,gBAAgB17D,CAArB;AACMzX,kDAAN;AAEA,gBAAI,KAAKyyE,WAAW;AAClBv8D,sBAAQqhD,IAAI,sCAAZ;AACA;YAFkB;AAIpB,iBAAKkb,YAAY;AAKjB,gBAAI,KAAKF;AACP,mBAAKA,QAAQuC,UAAUr9D,GAAG,KAAKg6D,kBAA/B;;AACS,mBAAKa,mBACd,KAAKA,iBAAiB9/B,QAAQ,KAAKi/B,kBAAnC,IACS,KAAKsD,cAAL,KAEA,KAAKC,eAAL,MAEA,KAAKC,aAAL,IACT,KAAKC,aAAL,IACS,KAAKC,YAAL,IACT,KAAKC,YAAL,IACS,KAAKC,aAAL,IACT,KAAKC,aAAL,IACS,KAAKC,iBAAL,KACT,KAAKC,iBAAiB/9D,CAAtB;UA/B2C;AAkC7CA,YAAE4yB,eAAF;YACEC,gBAAF;AAEA,eAAKlgC,QAAL;QAzCoB;QAyDxBoqE,iBAAiB/8D,GAAe;AAC9B,cAAMiI,IAAkBvf,yDAA4BsX,CAAlC;AAElB,eAAKm7D,aAAat+C,IAAI5U,GAAW,KAAK+1D,cAAch+D,CAAnB,CAAjC;AACA,cAAMi+D,IAAW37D,MAAMC,KAAK,KAAK44D,aAAap8D,KAAlB,CAAX;AAEO,gBAApBk/D,EAASp+D,WACLq+D,IAAS,KAAK/C,aAAa7zE,IAAI22E,EAAS,CAAT,CAAtB,GACTE,IAAS,KAAKhD,aAAa7zE,IAAI22E,EAAS,CAAT,CAAtB,GACf,KAAK7C,gBAAgBpsD,mDAAW4oC,SAASsmB,GAAQC,CAA5B,GACrB,KAAKpD,gBAAgB,MACrB/6D,EAAE4yB,eAAF;QAX4B;QAsBhCuqC,gBAAgBn9D,GAAe;AAC7B,gBAAMiI,IAAkBvf,yDAA4BsX,CAAlC;AAElB,eAAKm7D,aAAat+C;YAAI5U;YAAW,KAAK+1D,cAAch+D,CAAnB;UAAjC;AAEI,eAAKu7D,sBAAiD,MAA3B,KAAKJ,aAAarmD,OAC/C,KAAKspD,YAAYp+D,CAAjB,IAEA,KAAKg9D,WAAWh9D,CAAhB;QAR2B;QAiBvBo+D,YAAYp+D,GAAe;AACjC,cAAMi+D,IAAW37D,MAAMC,KAAK,KAAK44D,aAAap8D,KAAlB,CAAX,GAEXm/D,IAAS,KAAK/C,aAAa7zE,IAAI22E,EAAS,CAAT,CAAtB;AACTE,cAAS,KAAKhD,aAAa7zE,IAAI22E,EAAS,CAAT,CAAtB;AAETn7D,cADekM,mDAAW4oC,SAASsmB,GAAQC,CAA5BE,IACQ,KAAKjD;AAElC,cAAyB,IAArB,KAAKC,iBAA0CzkC,WAArB,KAAKykC,eAA0B;AACrDiD,gBAAex7D,IAAQ,KAAKu4D;AAC5BrV,gBACW,IAAfsY,IACIA,IAAenE,oDACfmE,IAAelE;gBACjB,CAAC,KAAKG;AACR,oBAAUz8D,MACR,gEADI;AAIR,kBAAMiG,IAAY,KAAKw2D,iBACjBzsD,IAAyB7kB,iDAC7B+W,GACA+D,EAAU+B,aAAV,GACA/B,EAAUs5C,oBAAV,CAHe;AAKjBt5C,cAAUw7C,KAAKzxC,EAASpE,GAAGoE,EAASlE,GAAGo8C,CAAvC;UAjB2D;AAmB7D,eAAKqV,gBAAgBv4D;AACrB9C,YAAE4yB,eAAF;QA5BiC;QAqCnCwqC,eAAep9D,GAAe;AACtBiI,cAAkBvf,yDAA4BsX,CAAlC;AACd,eAAKm7D,aAAan+C,IAAI/U,CAAtB,KACF,KAAKkzD,aAAa39C,OAAOvV,CAAzB;AAE2B,cAAzB,KAAKkzD,aAAarmD,SACpB,KAAKqmD,aAAazlC,MAAlB,GACA,KAAK2lC,gBAAgB;QAPK;QAkB9B2C,cAAch+D,GAAe;AAC3B,iBAAK,KAAKu6D,kBAGH,IAAIvrD,mDAAWhP,EAAEysB,OAAOzsB,EAAE4sB,KAA1B,IAFE;QAFkB;QAa7BswC,eAAY;AACV,iBAAO,KAAKnC;QADF;QAUZ8B,SAAM;AAIJ,cAAS7B,CAAL,KAAKA,WAAT;AAGMzyE,kDAAN;AACA,gBAAI,KAAKuyE;AACP,mBAAKA,QAAQuC,UAAU,KAAK7B,iBAAiB,KAAKxB,kBAAlD;;AACS,mBAAKa,oBACd,KAAKA,iBAAiB9/B,QAAQ,KAAKi/B,kBAAnC;AAEF,iBAAKrnE,QAAL;UATA;QAJI;QAsBNgV,iBAAiB3H,GAAe;AAC1B,eAAKkiB,eACP,KAAKq8C,kBAAL,GACA,KAAKr8C,YAAYne,UAAUxG,UAAU,CAAC,CAAC,KAAK2vC,MAA5C,GACA,KAAKhrB,YAAYk0C,gBAAgBp2D,CAAjC,KACS,KAAK26D,cACd,KAAKA,YAAYvE,gBAAgBp2D,CAAjC,IACS,KAAKw6D,gBACd,KAAKA,aAAaz2D,UAAUxG,UAA5B,GACA,KAAKi9D,aAAapE,gBAAgBp2D,CAAlC,KACS,KAAKu6D,mBAAmB,CAAC,KAAKrtB,WACvC,KAAKqtB,gBAAgBh9D,UAArB,GACA,KAAKg9D,gBAAgBnE,gBAAgBp2D,CAArC;AAIFA,YAAE4yB,eAAF;AACA5yB,YAAE6yB,gBAAF;AAEA,eAAKlgC,QAAL;QAnB8B;QA6BhC6rE,cAAcx+D,GAAiBwR,GAAgB;AAC7C,cAAI,KAAKypD;AACP,kBAAMn9D,MACJ,gFADI;AAKR,eAAK2gE,kBAAkBjtD,CAAvB;AACA,eAAKgqD,kBAAkBx7D;AAElB,eAAKkkC,cAAe,KAAKy2B,eAAgB,KAAKH,gBAG1Cn1D,EAAAA,0CAAY,IAAnB;AAGF,eAAKs3D,QAAQ38D,CAAb;QAhB6C;QAwBvC0+D,mBAAmBltD,GAAgB;AAC9B3qB,mDACT,KAAgBS,wCAAe0b,yCAA1B,GAAkC,MAAMwO,EAAG3N,IAAI,WAApD,CADF;QADyC;QAa3C86D,kBAAkB3+D,GAAiBktC,GAAe;AAChD,cAAI,KAAK+tB;AACP,kBAAMn9D,MACJ,oFADI;AAKR,eAAK8gE,eAAe1xB,CAApB;AACA,eAAKsxB,cAAcx+D,GAAGktC,EAAO/K,aAAP,CAAtB;QARgD;QAkBlD08B,iBAAiB7+D,GAAiBpN,GAAe;AAC/C,cAAI,KAAKqoE;AACP,kBAAMn9D,MACJ,mFADI;AAKR,eAAKghE,cAAclsE,CAAnB;AACA,eAAK4oE,kBAAkBx7D;QARwB;QAkBjD++D,kBAAkB/+D,GAAiBg/D,GAAe;AAChD,cAAI,KAAK/D;AACP,kBAAMn9D,MACJ,oFADI;AAKR,eAAKmhE,eAAeD,CAApB;AACA,eAAKxD,kBAAkBx7D;QARyB;QAkBlDi2D,mBAAmBj2D,GAAiB+d,GAAiC;AACnE,cAAI,KAAKk9C;AACP,kBAAMn9D,MACJ,qFADI;AAKR,eAAKohE,gBAAgBnhD,CAArB;AACA,eAAKy9C,kBAAkBx7D;QAR4C;QAgB7Dy9D,eAAY;AAClB,cAAI,CAAC,KAAK/C;AACR,kBAAU58D,MACR,8DADI;AAOoB,eAAKw9D,yBAAyB,KAAKZ,cAE7D,KAAKA,WAAWtI,WAAW,KAAKoJ,eAAhC;AAEF,eAAK+C,kBAAL;QAbkB;QAiBZZ,cAAW;AACjB,cAAI,CAAC,KAAKlD;AACR,kBAAU38D,MACR,6DADI;AAIR,eAAKygE,kBAAL;AACA,eAAK9D,UAAU91B,QAAf;QAPiB;QAWXk5B,eAAY;AAElB,cAAI,KAAK3wB,UAAU,KAAKA,OAAOiyB,WAAW;AACxC,gBAAI,CAAC,KAAKj9C;AACR,oBAAUpkB,MACR,+DADI;AAIR,gBAAI,KAAKokB,YAAYh7B,UAAjB,GAA8B;AAChBoc,gBAAAA,6CAAX,KACQC,EAAAA,6CAAS,IAApB;AAEF,kBAAMsf,IAAW,KAAKqqB,OAAOkvB,YAAY,KAAKl6C,WAA7B;AACjBW,gBAASqkC,WAAT;AACArkC,gBAAStF,eAAT;YANgC;UANM,OAcnC;AACL,gBAAI,CAAC,KAAKg9C;AACR,oBAAUz8D,MACR,kEADI;AAMF4B,gBAAQ,KAAgBpY,wCAAe0b,yCAA1B,GACjB,KAAKkhC,YACL,KAAKq2B,gBAAgB12D,IACrB,OAHY;AAKHhd,qDAAK6Y,CAAhB;UAbK;AAeP,eAAK6+D,kBAAL;YACWh7D,6CAAS,KAApB;QAhCkB;QAyCZw6D,iBAAiB1xC,GAAgB;AACjC7a,cAAK,KAAK6oD;AACLvyE,oDAAP,KACKA,0CAAP,EAAsB0d,SAAtB;AAEF,eAAKk5D,mBAAmB,KAAKnE,mBAAmB/oD,CAAhD;QALuC;QAiBjC+sD,oBAAiB;AAEnB,eAAKr8C,eAAe,CAAC,KAAKgrB,UAC5B,KAAKhrB,YAAY2jC,aAAjB;QAHqB;QAezByO,cAAiB94C,GAAe;AAC9B,cAAI,KAAKy/C;AACP,kBAAMn9D,MACJ,gFADI;AAKH,eAAK48D,eACR,KAAKA,aAAal/C;QARU;QAkBhC4jD,aAAa/9C,GAAW;AACtB,cAAI,KAAK45C;AACP,kBAAMn9D,MACJ,+EADI;AAMH,eAAK28D,cAAW,KAAKA,YAAYp5C;QARhB;QAiBxB49C,eAAeD,GAAe;AACvB,eAAKrE,gBACR,KAAKA,cAAcqE;QAFO;QAY9BE,gBAAgBnhD,GAAiC;AAC1C,eAAKy8C,iBACR,KAAKA,eAAez8C;QAFyB;QAajD+gD,cAAclsE,GAAe;AAEtB,eAAKsxC,cAAe,KAAKy2B,gBAC5B,KAAKz2B,aAAatxC,GACXyS,EAAAA,0CAAY,KAAK6+B,UAAxB,GACItxC,EAAM4tC,cAAc5tC,MAAUA,EAAM0zC,aAAN,IAChC,KAAK+4B,eAAezsE,EAAM0zC,aAAN,CAApB,IAEA,KAAK+4B,eAAezsE,CAApB;QARuB;QAoBrBysE,eAAezsE,GAAe;AAChCA,YAAMuvB,SAAN,IAGF,KAAKk9C,eAAezsE,EAAM2R,UAAN,CAApB,IAEA,KAAK2d,cAActvB;QANe;QAe9B6rE,kBAAkBjtD,GAAgB;AACnC,eAAK+oD,oBACR,KAAKA,kBAAkB/oD;QAFe;QAWlCotD,eAAe1xB,GAAe;AAC/B,eAAKA,WACR,KAAKA,SAASA;QAFoB;QAiB9BowB,gBAAa;AAGnB,iBADuBgC,CAAC,CAAC,KAAK3E,eACL,CAAC,KAAKC;QAHZ;QAMb2C,iBAAc;AACpB,iBAAO,CAAC,CAAC,KAAK/C,gBAAgB,CAAC,KAAKI;QADhB;QAUdgD,eAAY;AAIlB,iBADsB2B,CAAC,CAAC,KAAKr7B,cAG3B,CAAC,KAAK02B,yBACN,CAAC,KAAK4C,aAAL,KACD,CAAC,KAAKE,YAAL;QARe;QAkBZF,eAAY;AAClB,iBAAK,KAAK9C,aAER,KAAKA,WAAWpJ,YAAhB,KACA,CAAC,KAAKsJ,0BACL,CAAC,KAAK1tB,UACL,KAAKwtB,WAAWlJ,oBAAoB,KAAKtkB,OAAOiyB,SAAhD,KALyB;QADX;QAWZzB,cAAW;AACjB,cAAI,CAAC,KAAKjD;AAAW,mBAAO;gBACtB+E,IACJ,CAAC,KAAKtyB,UACN,CAAC,KAAKutB,UAAUjJ,uBAChB,KAAKiJ,UAAUjJ,oBAAoB,KAAKtkB,OAAOiyB,SAA/C;AACF,iBAAO,CAAC,KAAKvE,yBAAyB4E;QANrB;QAeX1B,mBAAgB;AAGtB,iBADE,CAAC,KAAK55B,cAAc,CAAC,KAAKy2B,eAAe,CAAC,KAAKD,cAClB,CAAC,KAAKE;QAHf;QASxB6E,oBAAiB;AACH5E,cAAAA,GAAL;AAAP,iBAAO,SAAA,IAAKA,SAAAA,IAALA,KAAKA,oBAAAA,IAAoB,KAAKC,WAA9B,IAAyC;QADjC;QAYjB/1D,aAAU;AACR,iBAAO,KAAKixD;QADJ;QAYV0J,aAAU;AACR,iBAAO,KAAKzE;QADJ;QASHhzB,OAAAA,aAAU;AACf,gBAAM/iC,IAAoBzd,+CAAP;mBACV0Y,IAAI,GAAG4D,GAAYA,IAAYmB,EAAW/E,CAAX,GAAgBA;AAItD,gBAAK4D,EAA2B47D;AAC9B,qBAAO;AAGX,iBAAO;QAVQ;MAtmCb,GApDN7sB,gCAAA,CAAA;AAoDa9K,oCAAAA,UAAAA;AC9BP,UAAO4E,mCAAP,MAAA;QAcJtoB,YACUs7C,GACR5gE,GAAoB;AADZ,eAAA4gE,UAAAA;AAZF,eAAA98D,QAAgB;AAgBP,cAAA;AAAf,eAAK+8D,UAAU,SAAA,IAAA7gE,EAAA,WAAA,IAAsB;AAGvB,cAAA;AAAd,eAAKa,SAAS,SAAA,IAAAb,EAAA,UAAA,IAAqB;AAMnC,eAAK8gE,SAHL,KAAKC,QAAQH,EAAQr0D,eAGO,KAAKw0D,MAAMtzD;AAGrB,cAAA;AAAlB,eAAKy6C,aAAa,SAAA,IAAAloD,EAAA,QAAA,IAAmB;QAfjB;QA0BtBghE,WAAWH,GAAe;AACxB,eAAKA,UAAUA;AACf,eAAKI,OAAO,KAAKn9D,KAAjB;QAFwB;QAU1Bo9D,aAAU;AACR,iBAAO,KAAKL;QADJ;QAKVM,UAAUtgE,GAAc;AACtB,eAAKA,SAASA;AACd,eAAKogE,OAAO,KAAKn9D,KAAjB;QAFsB;QAMxBs9D,YAAS;AACP,iBAAO,KAAKvgE;QADL;QAYTwgE,cAAcC,GAAa;AACzB,eAAKpZ,aAAaoZ;QADO;QAS3B/J,aAAU;AACR,iBAAO,KAAKrP;QADJ;QAWVqZ,eAAY;AACV,iBAAO,KAAKX,QAAQ/7D;QADV;QAUZo8D,OAAOn9D,GAAa;AAClB,eAAKA,QAAQA;AACb,cAAM09D,IAAc,KAAKX,UAAU/8D;AAEnC,eAAK88D,QAAQp5D,aAAa,SAAS,GAAGg6D,CAAH,EAAnC;AACA,eAAKZ,QAAQp5D,aAAa,UAAU,GAAGg6D,CAAH,EAApC;AAEIC,cAAO/vD,KAAK+Y,MAAM,KAAKo2C,UAAU,CAA1B,IAA+B;AAC1C,cAAIxmC,IAAQonC,IAAO,KAAK5gE,SAAS,GAC7B6gE,IAAMD,IAAO,KAAK5gE,SAAS;AAE/B4gE,eAAQ39D;AACRu2B,eAASv2B;AACT49D,eAAO59D;AAEP,eAAK69D,kBAAkB,KAAKZ,OAAOj9D,GAAOu2B,GAAOqnC,GAAKD,GAAMA,CAA5D;AACA,eAAKE,kBAAkB,KAAKb,OAAOh9D,GAAO29D,GAAMA,GAAMpnC,GAAOqnC,CAA7D;QAhBkB;QA8BZC,kBACNpoE,GACA6N,GACAw6D,GACAC,GACAC,GACAC,GAAU;AAENxoE,gBACFA,EAAKiO,aAAa,gBAAgB,GAAGJ,CAAH,EAAlC,GACA7N,EAAKiO,aAAa,MAAM,GAAGo6D,CAAH,EAAxB,GACAroE,EAAKiO,aAAa,MAAM,GAAGs6D,CAAH,EAAxB,GACAvoE,EAAKiO,aAAa,MAAM,GAAGq6D,CAAH,EAAxB,GACAtoE,EAAKiO,aAAa,MAAM,GAAGu6D,CAAH,EAAxB;QAPQ;QAmBZ3oE,OAAOsR,GAAWE,GAAS;AACzB,eAAKg2D,QAAQp5D;YAAa;YAAK,GAAGkD,CAAH;UAA/B;AACA,eAAKk2D,QAAQp5D,aAAa,KAAK,GAAGoD,CAAH,EAA/B;QAFyB;QAY3B8sD,QAAQ7lD,GAAc;AACpB,cAAMgvD,IAAU,KAAKK,WAAL;AAChB,gBAAMO,IAAOZ,IAAU,GACjBn2D,IAAIgH,KAAKuQ,MAAMvQ,KAAKuQ,OAAOpQ,EAAGnH,IAAI+2D,KAAQZ,CAA3B,IAAsCA,IAAUY,CAA3D;AACJ72D,cAAI8G,KAAKuQ,MAAMvQ,KAAKuQ,OAAOpQ,EAAGjH,IAAI62D,KAAQZ,CAA3B,IAAsCA,IAAUY,CAA3D;AACV,iBAAI/2D,MAAMmH,EAAGnH,KAAKE,MAAMiH,EAAGjH,IAElBiH,IAEF,IAAI7B,mDAAWtF,GAAGE,CAAlB;QATa;QAqBfxZ,OAAAA,UACLq8C,GACAI,GACAN,GAAgB;AAQVI,cAAkBtjD,kDACtBqwC,qCAAIkf,SACJ,EAAC,IAAM,uBAAuBnM,GAAK,cAAgB,iBAAnD,GACAF,CAHkB;AAMf,cAAA,GAAoC;AAAzC,cAAmC,KAA9B,SAAA,IAAAM,EAAA,UAAA,IAAyB,MAA0C,KAA/B,SAAA,IAAAA,EAAA,WAAA,IAA0B,IAAQ;AACrExjD,8DACFqwC,qCAAIgf,MACJ,EAAC,QAAU7L,EAAA,OAAX,GACAF,CAHF;AAKI,gBAAA;AAAA,qBAAA,IAAAE,EAAA,WAAA,KACExjD,kDACFqwC,qCAAIgf,MACJ,EAAC,QAAU7L,EAAA,OAAX,GACAF,CAHF;UAPuE;AAerEtjD,8DAAiBqwC,qCAAIgf,MAAM,CAAA,GAAI/L,CAAnC;AAEF,iBAAOA;QA/BS;MApMd,GAtBNmG,6BAAA,CAAA;AAsBalG,iCAAAA,OAAAA;AhGtBb,UAAAkG,qCAAA,CAAA;AAegBj8C,yCAAAA,YAAAA;AiGcV,UAAOmqE,qCAAP,MAAA;QA0BJ18C,YACS7mB,GACPwjE,GACAC,GACAC,GAAoC;AAH7B,eAAA1jE,OAAAA;AAXT,eAAA2jE,YAAsB;AAiBpB,eAAKC,cAAcJ,KAAmB5iE,uBAAOC,OAAO,IAAd;AAGtC,eAAKgjE,iBAAiBJ,KAAsB7iE,uBAAOC,OAAO,IAAd;AAG5C,eAAKijE,kBACHJ,KAAwB9iE,uBAAOC,OAAO,IAAd;AAG1B,eAAKkjE,YAAYnjE,uBAAOC,OAAO,IAAd;AAGRrY,mDAAkB2X,qCAAK40C,OAAO/0C,GAAM,MAAM,IAAnD;QAhBoC;QAyBtCkqB,eAAY;AACV,iBAAO,KAAKlqB,OAAO;QADT;QAUZgkE,cAAcC,GAAwBC,GAAsB;AAC1D,eAAKN,YAAYK,CAAjB,IAAmCC;QADuB;QAU5DC,iBAAiBC,GAA2BC,GAA4B;AACtE,eAAKR,eAAeO,CAApB,IAAyCC;QAD6B;QAWxEC,kBAAkBC,GAAqB;AAC/Br1D,cAAS,KAAK40D,gBAAuCS,CAA5C;AACf,cAAI,CAACr1D;AACH,mBAAO;AAET,cAAqB,aAAjB,OAAOA,GAAoB;AAC7B,kBAAMs1D,IAAiB,KAAKF,kBAAkBp1D,CAAvB;AACvB,gBAAIs1D;AACF,qBAAOA;UAHoB;AAM/B,iBAAO,GAAGt1D,CAAH;QAX8B;QAoBvCu1D,kBAAkBF,GAAuBG,GAA8B;AACpE,eAAKZ,gBAAuCS,CAA5C,IAA6DG;QADO;QASvEC,aAAaZ,GAAoB;AAC/B,eAAKA,YAAYA;QADc;QASjCa,aAAajB,GAAkB;AAC7B,eAAKA,YAAYA;QADY;QAWxBkB,OAAAA,YAAY7kE,GAAc8kE,GAAgB;AAC/C9kE,cAAOA,EAAKM,YAAL;AACP,gBAAMgnC,IAAQ,IAAIi8B,mCAAMvjE,CAAV;AACd,cAAI+kE,IAAOD,EAAA;AACX,cAAIC,GAAM;AACR,gBAAoB,aAAhB,OAAOA,GAAmB;AACrB,kBAAA;AAAPA,kBAAO,SAAA,IAASj8E,0CAAmBqX,qCAAK40C,OAAOgwB,CAAxC,KAAA,IAAiD3hE;YAD5B;AAG1B2hE,yBAAgBxB,uCACXnqE,8CAAUkuC,GAAOy9B,CAAxB,GACAz9B,EAAMtnC,OAAOA;UANP;AAUH5G,wDAAUkuC,EAAMs8B,aAAakB,EAAA,WAApC;AACO1rE,wDAAUkuC,EAAMu8B,gBAAgBiB,EAAA,cAAvC;AACO1rE,wDAAUkuC,EAAMw8B,iBAAiBgB,EAAA,eAAxC;AACO1rE,wDAAUkuC,EAAMy8B,WAAWe,EAAA,SAAlC;AAC8B,mBAA1BA,EAAA,cACFx9B,EAAMq8B,YAAYmB,EAAA;AAGpB,iBAAOx9B;QAtBwC;MAvI7C,GA7BN+N,8BAAA,CAAA;kCA6BakuB,QAAAA;ACnBb,UAAMyB,0DAAqB,EACzB,eAAiB,EAAC,eAAiB,KAAlB,GACjB,aAAe,EAAC,eAAiB,MAAlB,GACf,cAAgB,EAAC,eAAiB,MAAlB,GAChB,aAAe,EAAC,eAAiB,MAAlB,GACf,aAAe,EAAC,eAAiB,MAAlB,GACf,kBAAoB,EAAC,eAAiB,MAAlB,GACpB,aAAe,EAAC,eAAiB,MAAlB,GACf,iBAAmB,EAAC,eAAiB,MAAlB,GACnB,yBAA2B,EAAC,eAAiB,MAAlB,GAC3B,YAAc,EAAC,eAAiB,OAAO,KAAO,MAAhC,EAVW,GAarBnB,sDAAiB;QACrB,iBAAmB,EAAC,QAAU,KAAX;QACnB,eAAiB,EAAC,QAAU,MAAX;QACjB,gBAAkB,EAAC,QAAU,MAAX;QAClB,eAAiB,EAAC,QAAU,MAAX;QACjB,eAAiB,EAAC,QAAU,MAAX;QACjB,oBAAsB,EAAC,QAAU,MAAX;QACtB,eAAiB,EAAC,QAAU,MAAX;QACjB,mBAAqB,EAAC,QAAU,MAAX;QACrB,2BAA6B,EAAC,QAAU,MAAX;MATR,GAgBVoB,+CAAU,IAAI1B,mCAAM,WAAWyB,yDAAoBnB,mDAAzC,GAvCvBxuB,sCAAA,EAuCa4vB,SAAAA,6CAvCb;AC0BM,UAAO32B,yCAAP,MAAA;QAwDJznB,YAAYtlB,GAAuB;AAxBnC,eAAA2tC,cAAiC;AAiBjC,eAAA+O,aANA,KAAApN,aAAsDztC;AAcpD,cAAI8hE,IAAiB,MACjBn3E,IAAgB;AACpB,cAAI4hD,IAAc,OACdw1B,IAAc,OACdC,IAAc,OACdC,IAAa,OACbv0B,IAAY;AAChB,gBAAM7G,IAAW,CAAC,CAAC1oC,EAAA;AACnB,cAAI,CAAC0oC,GAAU;AAEX,gBAAA;AADFi7B,gBAAyBt3E,6DACvB,SAAA,IAAA2T,EAAA,WAAA,IAAsB,IADP;AAGjBxT,gBAAwBA,mDAAcm3E,CAAtB;AACVI,gBAAiB/jE,EAAA;AACvBouC,gBACqBvsC,WAAnBkiE,IAA+Bv3E,IAAgBu3E;AAC3CC,gBAAiBhkE,EAAA;AACvB4jE,gBACqB/hE,WAAnBmiE,IAA+Bx3E,IAAgBw3E;AAC3CC,gBAAiBjkE,EAAA;AACvB6jE,gBACqBhiE,WAAnBoiE,IAA+Bz3E,IAAgBy3E;AAC3CC,gBAAgBlkE,EAAA;AACtB8jE,gBAA+BjiE,WAAlBqiE,IAA8B13E,IAAgB03E;AACrDC,gBAAenkE,EAAA;AACrBuvC,gBAA6B1tC,WAAjBsiE,IAA6B,OAAOA;UAjBnC;AAoBXC,cAAsBpkE,EAAA;AACtBouC,cAC0BvsC,WAAxBuiE,MACFA,IAAsB,MAGxBA,IAAsB;AAExB,gBAAM/7C,IAAM,CAAC,CAACroB,EAAA;AACd,cAAImX,IAAmBnX,EAAA;AACE6B,qBAArBsV,MACFA,IAAmB;AAErB,cAAMktD,IAAgD,UAA/BrkE,EAAA;AAIrBskE,cADEntD,IACgBktD,IACNntD,8CAASH,MACTG,8CAASG,SAGnBgtD,MAAmBh8C,IAAcnR,8CAASE,QAAgBF,8CAASX;AAGvE,cAAI5K,IAAS3L,EAAA;AACE6B,qBAAX8J,MACFA,IAAS;AAEX,cAAIC,IAAc;AACd5L,YAAA,UACF4L,IAAc5L,EAAA,MAAiBukE,SAAS,GAA1B,IACVvkE,EAAA,QACAA,EAAA,QAAmB;AAEzB,gBAAMwkE,IAAmBxkE,EAAA,eAGnBimC,IAAWjmC,EAAA,YAAuB,SAElCE,IAAUF,EAAA,WAAsB,CAAA;AAEtC,cAAIykE,IAAczkE,EAAA;AACE6B,qBAAhB4iE,MACFA,IAAc;AAGhB,eAAKhuD,MAAM4R;AACX,eAAKq8C,gBAXkB7iE,WAArB2iE,IAAiC,OAAOA;AAY1C,eAAKvzB,WAAW2yB;AAChB,eAAK1xB,WAAW2xB;AAChB,eAAK1/D,UAAU2/D;AACf,eAAKp7B,WAAWA;AAChB,eAAKi8B,YAAY3kE,EAAA,aAAwB43B;AACrB,cAAA;AAApB,eAAKgtC,eAAe,SAAA,IAAA5kE,EAAA,gBAAA,IAA2B;AAC/C,eAAKykE,cAAcA;AACnB,eAAK74D,cAAcA;AACnB,eAAKpf,gBAAgBA;AACrB,eAAK2iD,cAAcpC,uCAAQ83B,kBAAkB7kE,GAASxT,CAAnC;AACnB,eAAKs4E,gBAAgB,CAAC,CAAC,KAAK31B,YAAYC;AACxC,eAAKhB,cAAcA;eACdg2B,sBAAsBA;AAC3B,eAAK70B,YAAYA;AACjB,eAAK5jC,SAASA;AACd,eAAKwL,mBAAmBA;AACxB,eAAK82B,eAAe01B;AACpB,eAAK91B,cAAcd,uCAAQg4B,kBAAkB/kE,CAA1B;AACnB,eAAK+tC,cAAchB,uCAAQi4B,kBAAkBhlE,CAA1B;AACnB,eAAKskE,kBAAkBA;AACvB,eAAKv+B,QAAQgH,uCAAQk4B,mBAAmBjlE,CAA3B;AACb,eAAKimC,WAAWA;AACS,cAAA;AAAzB,eAAKi/B,oBAAoB,SAAA,IAAAllE,EAAA,qBAAA,IAAgC;AAOlC,cAAA;AAAvB,eAAK4G,kBAAkB,SAAA,IAAA5G,EAAA,mBAAA,IAA8B;AAGrD,eAAKE,UAAUA;QA9GkB;QAyHpB2kE,OAAAA,kBACb7kE,GACAxT,GAAsB;AAEtB,gBAAM24E,IAAOnlE,EAAA,QAAmB,CAAA,GAC1BmvC,IAAc,CAAA;AAEKttC,qBAAvBsjE,EAAA,cAC0BtjE,WAA1B7B,EAAA,aAEAmvC,EAAYC,aAAa5iD,IACc,aAA9B,OAAO24E,EAAA,cAChBh2B,EAAYC,aAAa,EACvB,YAAc,CAAC,CAAC+1B,EAAA,WAAA,YAChB,UAAY,CAAC,CAACA,EAAA,WAAA,SAFS,GAQvBh2B,EAAYC,WAAW/4B,cACvB84B,EAAYC,WAAWv4B,WAEvBs4B,EAAYC,aAAa,OAExBD,EAAYC,WAAW/4B,cACvB84B,EAAYC,WAAWv4B,aAExBs4B,EAAYC,aAAa,UAG3BD,EAAYC,aAAa,CAAC,CAAC+1B,EAAA,cAAsB,CAAC,CAACnlE,EAAA;AAOnDmvC,YAAYi2B,QAJTj2B,EAAYC,cAAgCvtC,WAAlBsjE,EAAA,QAIT,CAAC,CAACA,EAAA,QAFgC,aAAlC,OAAOh2B,EAAYC;AAQvCD,YAAYrT,OAJTqT,EAAYC,aAEWvtC,WAAjBsjE,EAAA,OAEU,OAEA,CAAC,CAACA,EAAA,OALF;AAOrB,iBAAOh2B;QA9Ce;QAyDT61B,OAAAA,kBAAkBhlE,GAAuB;AAChDugD,cAAOvgD,EAAA,QAAmB,CAAA;AAChC,gBAAM+tC,IAAc,CAAA;AAElBA,YAAYO,WADWzsC,WAArB0+C,EAAA,WACqB,QAEA,CAAC,CAACA,EAAA;AAGzBxS,YAAYq3B,QADQvjE,WAAlB0+C,EAAA,QACkB,QAEA,CAAC,CAACA,EAAA;AAGtBxS,YAAYC,aADansC,WAAvB0+C,EAAA,aACuB,IAEAruC,OAAOquC,EAAA,UAAP;AAGzBxS,YAAYs3B,WADWxjE,WAArB0+C,EAAA,WACqB,IAEAruC,OAAOquC,EAAA,QAAP;AAGvBxS,YAAYu3B,WADWzjE,WAArB0+C,EAAA,WACqB,MAEAruC,OAAOquC,EAAA,QAAP;AAGvBxS,YAAYgT,aADal/C,WAAvB0+C,EAAA,aACuB,MAEAruC,OAAOquC,EAAA,UAAP;AAGzBxS,YAAY6vB,QADQ/7D,WAAlB0+C,EAAA,QACkBxS,EAAYq3B,SAASr3B,EAAYO,WAEjC,CAAC,CAACiS,EAAA;AAExB,iBAAOxS;QAtC+C;QAiDzCg3B,OAAAA,kBAAkB/kE,GAAuB;AAChDq3D,cAAOr3D,EAAA,QAAmB,CAAA;AAChC,gBAAM6tC,IAAc,CAAA;AACpBA,YAAYgzB,UAAU3uD,OAAOmlD,EAAA,OAAP,KAA2B;AACjDxpB,YAAY1e,SAASkoC,EAAA,UAAkB;AACvCxpB,YAAYhtC,SACSgB,WAAnBw1D,EAAA,SAA+B,IAAInlD,OAAOmlD,EAAA,MAAP;AACrCxpB,YAAYyzB,OAA6B,IAAtBzzB,EAAYgzB,WAAe,CAAC,CAACxJ,EAAA;AAChD,iBAAOxpB;QAR+C;QAkBzCo3B,OAAAA,mBAAmBjlE,GAAuB;AACjD+lC,cAAQ/lC,EAAA,SAAoB0jE;AAClC,iBAAqB,aAAjB,OAAO39B,IACOx+C,0CAAmBqX,qCAAK40C,OAAOzN,CAAxC,IACEA,aAAiBi8B,qCACnBj8B,IAEFi8B,mCAAMsB;YACXv9B,EAAMtnC,QAAQ,YAAwB/W,yDAAZ;YAC1Bq+C;UAFK;QAPgD;MA/SrD,GA1BN+N,gCAAA,CAAA;AA0Ba/G,oCAAAA,UAAAA;ACJArL,QAAAA,qCAAP,MAAA;QA2BJpc,YAAYigD,GAA2BC,GAA2B;AAhBjD,eAAA3L,KAAK,oBAAItiB;AAGT,eAAAkuB,YAAY,oBAAIjkE;AAKzB,eAAAkkE,cAAkC;AAUxC,eAAKC,iBAAiBH,KAAsB;AAE5C,eAAKI,gBAAgB,IAAIpkE,IACvB+jE,IAAoBA,EAAkBz4D,MAAM,GAAxB,IAA+B,CAAA,CADhC;QAJ2C;QAYlEypD,QAAK;AACH,eAAKsD,GAAGnjC,MAAR;AACA,eAAK+uC,UAAU/uC,MAAf;AACA,eAAKgvC,cAAc;QAHhB;QAWLG,eAAepkE,GAAgB;AAC7B,eAAKikE,cAAcjkE;QADU;QAYvBqkE,uBAAuBjhE,GAAU;AACvC,iBAAK,KAAK6gE,eAUJzsD,IAAW,KAAKysD,YAAY5oD,gBAAgBjY,CAAjC,KAERoU,EAASxa,OAEX,QAbLgB,QAAQxG,KACN,gOADF,GAOO;QAT8B;QAuBzC8sE,kBAAkBhhE,GAAoB;AAC9B+T,cAAsBF,EAAAA,kDAAiB7T,CAA3B;AAClB,mBAAS5D,IAAI,GAAGA,IAAI2X,EAAUjY,QAAQM;AACpC,iBAAKgb,QAAQrD,EAAU3X,CAAV,EAAa+X,MAAb,GAAsB8sD,EAAAA,sCAASC,QAA5C;QAHkC;QAatC7jC,mBAAmBr9B,GAAoB;AACrC,gBAAUjG,MACR,oFADI;QAD+B;QAevCqd,QAAQ+pD,GAAkB1nE,GAAuB;AAC/C,cAAIC,IAAOynE;AACP1nE,gBAASwnE,EAAAA,sCAASC,aACdhkB,IAAU,KAAK6jB,uBAAuBI,CAA5B,OAGdznE,IAAOwjD;AAGLkkB,cAAiB1nE,EAAKM,YAAL;AAKvB,gBAAMk+B,IAFJz+B,MAASwnE,EAAAA,sCAASC,YAAYznE,MAASwnE,EAAAA,sCAASI,qBAE3B,KAAKT,iBAAiB;AACxC,eAAK9L,GAAG77C,IAAIxf,CAAZ,KACH,KAAKq7D,GAAGh8C,IAAIrf,GAAM,oBAAI+4C,KAAtB;AAEF,gBAAM8uB,IAAS,KAAKxM,GAAGvxE,IAAIkW,CAAZ;AACf,cAAI6nE,EAAQroD,IAAImoD,CAAZ;AACF,mBAAOlpC,IAASopC,EAAQ/9E,IAAI69E,CAAZ;AAEZG,cAAW,KAAKC,gBAAgB9nE,GAAMD,CAA3B;AACjB6nE,YAAQxoD,IAAIsoD,GAAgBG,EAASr7C,OAAOgS,EAAOp8B,MAAvB,CAA5B;AACA,iBAAOylE;QAxBwC;QAkCjDE,aAAahoE,GAAuB;AAChB,cAAA;AAClB,kBADMioE,IAAY,SAAA,IAAA,KAAK5M,GAAGvxE,IAAIkW,CAAZ,KAAA,SAAA,EAAmBuB,KAAnB,KACCuD,MAAMC,KAAKkjE,CAAX,IAAwB,CAAA;QAFT;QAgBpCF,gBAAgB9nE,GAAcD,GAAuB;AAC/C8nE,cAAW,KAAKA,SAAS7nE,CAAd;AACf,cAAI0C,IAAmB,MAEUA,GACIA;AAFrC,iBACE,KAAKskE,UAAUznD,IAAIsoD,KAAYnlE,SAAAA,IAAAA,KAAAA,IAAK,GAApC,KACA,KAAKykE,cAAc5nD,IAAIsoD,KAAYnlE,SAAAA,IAAAA,KAAAA,IAAK,GAAxC;AAGAA,gBAAIA,IAAIA,IAAI,IAAI;AAENA,cAAAA;AAAZmlE,eAAYnlE,SAAAA,IAAAA,KAAAA,IAAK;AACjB,eAAKskE,UAAUv4D,IAAIo5D,CAAnB;AAIA,kBAFE9nE,MAASwnE,EAAAA,sCAASC,YAAYznE,MAASwnE,EAAAA,sCAASI,qBAC3B,KAAKT,iBAAiB,MAC7BW;QAfmC;QA0B7CA,SAAS7nE,GAAY;AACtBA,eAMHA,IAAOioE,UAAUjoE,EAAKqN,QAAQ,MAAM,GAAnB,CAAV,EAAmCA,QAAQ,UAAU,GAArD,GAEH,aAAaqG,SAAS1T,EAAK,CAAL,CAAtB,MACFA,IAAO,QAAQA,MARjBA,IAAOqc,EAAAA,+BAAA,eAAsB;AAW/B,iBAAOrc;QAboB;QAwBtBkjC,OAAAA,OAAOglC,GAAeC,GAAa;AAExC,iBAAOD,EAAM5nE,YAAN,MAAwB6nE,EAAM7nE,YAAN;QAFS;MArNtC;gBA2NW2iC,GAAK;AAYR,YAAAA,EAAAskC,aAAAtkC,EAAAskC,WAAQ,CAAA;AAClBA,UAAAI,qBAAA;AACAJ,UAAAC,WAAA;AACAD,UAAAa,YAAA;MAfkB,GAALnlC,EAAAA,uCAAAA,EAAAA,qCAAK,CAAA,EAAtB;AAoBaskC,QAAAA,wCAAWtkC,EAAAA,mCAAMskC;AAS9BtkC,QAAAA,mCAAMolC,0BAA0Bd,EAAAA,sCAASI;AA9QzC,UAAAtyB,8BAAA,EAqQakyB,UAAAA,EAAAA,sCArQb;kCAsBatkC,QAAAA,EAAAA;AnGtBb,UAAAoS,qDAAA,CAAA;AAkBgBh8C,yDAAAA,mBAAAA;AClBhB,UAAAg8C,gDAAA,CAAA;AAqBgB/7C,oDAAAA,eAAAA;AmGXV,UAAOgvE,yEAAP,cACIxvB,IADJ;QAKJjyB,cAAA;AACE,gBAAA;QADF;QAOSzH,IAAIhZ,GAAYknC,GAAqB;AAC5C,cAAI,KAAKzjD,IAAIuc,CAAT,MAAiBknC;AAAM,mBAAO;AAClC,gBAAMluB,IAAIhZ,GAAIknC,CAAd;AACIh0C,sEAAag0C,CAAb,KAAoBA,EAAK1P,gBAAL;AACxB,iBAAO;QAJqC;QAWrC7d,OAAO3Z,GAAU;AACxB,gBAAMknC,IAAO,KAAKzjD,IAAIuc,CAAT;AACPmiE,cAAU,MAAMxoD,OAAO3Z,CAAb;AAChB,cAAI,CAACmiE;AAAS,mBAAOA;AACjBjvE,sEAAag0C,CAAb,KAAoBA,EAAKzP,eAAL;AACxB,iBAAO0qC;QALiB;QAWjBtwC,QAAK;AACZ,cAAK,KAAK5gB;AACV,uBAAWjR,KAAM,KAAK9E,KAAL;AACf,mBAAKye,OAAO3Z,CAAZ;QAHU;QAWdqI,IAAI6+B,GAAqB;AACvB,iBAAO,KAAKluB;YAAIkuB,EAAK7yB,MAAL;YAAc6yB;UAAvB;QADgB;QAOzBnwB,gBAAa;AACX,iBAAO,CAAC,GAAG,KAAKzC,OAAL,CAAJ;QADI;MApDT,GAVN26B,iDAAA,CAAA;AAUaizB,qDAAAA,yBAAAA;ACcP,UAAgBE,yCAAhB,MAAA;QAgBJ3hD,YAAsB6C,GAAkB;AAAlB,eAAAA,cAAAA;AAXZ,eAAA++C,gBAA4B,IAAIl3D,mDAAW,GAAG,CAAlB;AAG5B,eAAAm3D,oBAAgC,IAAIn3D,mDAAW,GAAG,CAAlB;AAGhC,eAAA+zC,UAA8B;AAMtC,eAAKl3B,UAAU1E;QADuB;QAIxC5F,UAAO;AACL,gBAAUzjB,MAAM,8BAAV;QADD;QAIPqmC,SAASiiC,GAA8C;AACrD,cAASrjB,CAAL,KAAKA,SAAT;AAEA,gBAAMsjB,IAAW,KAAKl/C;AACtB,iBAAK47B,UAAc15D,kDAAiBqwC,qCAAI8e,GAAG,EAAC,SAAS,mBAAV,CAA5B;cACN7xB,WAAT,EAAsBvb,YAAY,KAAK23C,OAAvC;AACA,iBAAKujB,oBAAL;AACc19E,kEACZ,KAAKm6D,SACL,eACA,MACAqjB,CAJF;AAMC,iBAAKrjB,QAAgBl3B,UAAU;AACxBv5B,2DAAgB,KAAKywD,OAA7B;UAbA;QADqD;QAiBvDpwD,UAAO;AACGJ,2DAAkB,KAAKwwD,OAA/B;AACIr5D,sDAAW,KAAKq5D,OAApB;QAFK;QAKP3e,YAAS;AACP,iBAAO;QADA;QAITj6C,UAAO;AACL,iBAAO,IAAIskB,uCAAK,GAAG,CAAZ;QADF;QAQP+vB,WAAWxR,GAA2B;AACpC,eAAKnB,UAAUmB,QAAAA,IAAAA,IAAO,KAAK7F;QADS;QAKtCqtC,aAAU;AACR,iBAAO,KAAK3oC;QADJ;QAIVwY,cAAW;QAAA;QAEXE,iBAAc;QAAA;QAEdC,kBAAe;AACR,eAAKue,YACN,KAAK57B,YAAY9I,YAAjB,IACF,KAAK0kC,QAAQp2C,MAAMkB,UAAU,SAE7B,KAAKk1C,QAAQp2C,MAAMkB,UAAU,SAE3B7d,yDAAU,IAAV,KACF,KAAKo1B,iBAAiB,KAAtB;QARW;QAYfkf,yBAAsB;AACf,eAAKye,YACV,KAAKA,QAAQp2C,MAAMkB,UAAU;QAFT;QAKtB42B,uBAAoB;AAClB,iBAAO;QADW;QAIpBC,iBAAiB30B,GAAkB;AACjC,eAAKm2D,gBAAgBn2D;AACrB,eAAKu2D,oBAAL;QAFiC;QAK3BA,sBAAmB;AACpBvjB,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,YAAAA,EAASv8C,aACZ,aACA,aAAa,KAAK0/D,cAAcx8D,CAAhC,KAAsC,KAAKw8D,cAAct8D,CAAzD,GAFF;QADyB;QAO3Bqb,iBAAiB/H,GAAuB;AACtC,eAAKipD,oBAAoBn3D,mDAAW8Q,IAAI5C,GAAa,KAAKgpD,aAAjC;QADa;QAIxCvhC,UAAO;QAAA;QAWP6sB,oBAAoBC,GAA0B;AAC5C,iBAAO;QADqC;MAvH1C,GAxBN3e,mCAAA,CAAA;AAwBsBmzB,uCAAAA,OAAAA;AnGwFf,UAAMtmE,kDAAY,EACvB3I,kBAAAA,uDADuB,GAhHzB87C,uCAAA,EAgHanzC,WAAAA,gDAhHb;AAqFgBtY,2CAAAA,WAAAA,EAAAA;AAxBApB,2CAAAA,WAAAA;AASAE,2CAAAA,aAAAA;ACjCV,UAAOw4C,sDAAP,cAA6B9N,mCAA7B;QAkFJvM,YACEiiD,GACA3X,GACA77B,GAA4B;AAE5B,gBAAMlC,mCAAMq/B,UAAZ;AA5DM,eAAAsW,WAHA,KAAA3gD,QAHA,KAAA4gD,eALE,KAAAh1C,QAHF,KAAAi1C,mBAAoC;AAoBnC,eAAA3W,eAAe;AAGf,eAAA1d,SAAS;AAsBT,eAAAwd,eAHA,KAAAF,cAPA,KAAAC,cAPD,KAAA+W,mBAAwC;AAiD1CJ,gBAAkB11C,mCAAMq/B,eAExB5tD,MAAMyR,QAAQwyD,CAAd,KACFpvE,sDAAgBovE,CAAhB,GACMK,IAAU3vE,kDAAYsvE,CAAZ,GAChB,KAAKM,iBAAiBD,EAAQ5nE,SAC9B,KAAK4wD,cAAcgX,EAAQ3qC,UAAU,MACrC,KAAK0zB,cAAciX,EAAQrtD,UAAU,QAErC,KAAKstD,iBAAiBN,GAOxB,KAAKO,iBAAiB,KAAKjoC,WAAW,KAAhB,EAAuB,CAAvB,GAElB9L,KACF,KAAKo9B,WAAWp9B,CAAhB,GAEF,KAAKy5B,SAAS,KAAKsa,eAAe,CAApB,CAAd,GACIlY,KACF,KAAKwB,aAAaxB,CAAlB;QA5B0B;QAuCrBj2B,QAAQq4B,GAAqB;AAChC,eAAKpyB,oBAAL,KACF,KAAKC,WAAW,KAAhB;AAEF,eAAK2tB,SAASwE,EAAajkD,WAA3B;QAJoC;QAa7ByT,UAAUhd,GAAyB;AACtC,eAAK4tD,gBAAgBzyB,qDAAen7B,CAApC,MAGA,KAAKo7B,oBAAL,KACF,KAAKC,WAAW,KAAhB,GAEF,KAAK2tB,SAAShpD,CAAd;QAP0C;QAanC2gC,WAAQ;AACX,eAAK4iC,qBAAL,IACF,KAAKvW,kBAAL,IAEA,KAAKX,eAAgB,KAAKN,aAA0B5oC,WAA/B;AAEvB,eAAK8pC,mBAAL;AAEA,eAAKgW,eAAmBp9E,kDAAiBqwC,qCAAI+e,OAAO,CAAA,GAAI,KAAK0W,WAAzC;AAEhB,eAAKmB,aAAL,EAAqB0W,2BACvB,KAAKC,gBAAL,IAEA,KAAKC,iBAAL;AAGE,eAAKhY,eACH5lE,0CAAS,KAAK4lE,aAAa,qBAA/B;QAjBa;QA0BP6X,uBAAoB;AAIvB,cAAA;iBAFH,CAAC,KAAKzW,aAAL,EAAqB6W,wCACrB,KAAK7W,aAAL,EAAqB6W,wCACpB,EAAC,SAAA,IAAA,KAAK9jD,eAAL,KAAA,IAAA,EAAuBlB,SAAvB;QAJuB;QASpB+kD,mBAAgB;AACxB,eAAKrhD,QAAYx8B,kDAAiBqwC,qCAAIsf,OAAO,CAAA,GAAI,KAAKiW,YAAzC;AAGT,cAAA;AAFJ,eAAKppC,MAAOza,YACVJ,SAASG,gBACgBsK,SAAvBA,IAAAA,KAAK4N,eAAL5N,KAAuBA,IAAvBA,EAAuBA,OACnBkpB,oDAAcyoC,aAAa,MAC3B,MAAMzoC,oDAAcyoC,UAH1B,CADF;eAOS9W,aAAL,EAAqBM,8BACvB,KAAK/qC,MAAMrf,aAAa,qBAAqB,SAA7C;AAEE,cAAA;AAAJ,WAA2BiP,SAAvBA,IAAAA,KAAK4N,eAAL5N,KAAuBA,IAAvBA,EAAuBA,OACzB,KAAKq8C,eAAL,EAAsBxmD,aAAa,KAAKua,OAAO,KAAKmpC,YAApD,IAEA,KAAK8C,eAAL,EAAsB1mD,YAAY,KAAKya,KAAvC;QAfsB;QAoBhBohD,kBAAe;AACvB,eAAKT,WAAen9E,kDAClBqwC,qCAAI+e,OACJ,EACE,QAAU,KAAK6X,aAAL,EAAqB+W,gCAAgC,MAC/D,OAAS,KAAK/W,aAAL,EAAqB+W,gCAAgC,KAFhE,GAIA,KAAKlY,WANS;AAQhB,eAAKqX,SAAUlnB,eACThT,2CACJ,cACA,KAAKgkB,aAAL,EAAqBgX,gCAHvB;QATuB;QAsBN/V,YAAYvxD,GAAc;AAC3C,cAAMpN,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,eAAKwmC,eAAL;AAEE,eAAK91C,MAAO23B,gBADVppD,KAA0B,aAArB,OAAOA,EAAE2J,UACY,IAAIqF,mDAAWhP,EAAE2J,SAAS3J,EAAE6J,OAA5B,IAEA;AAIlBrZ,0DAAZ;AAEMg3E,cAAc,KAAK/1C,MAAOkB,OAAmBpiC,iDAAZ,CAAnB;oDACPi3E,GAAa,qBAA1B;AAEI,eAAKlX,aAAL,EAAqBmX,gCACjBC,IAAgB90E,EAAM+0E,UAAN,GAEVl3E,6CAAUi3E,GADA,KAAKnY,aAA0B5iD,MAAMi7D,cAC3D;AAGUj3E,mEAAsB,MAAM,KAAKk3E,iBAAiBh/E,KAAK,IAA3B,CAAxC;AAKA,eAAK4oC,MAAOC,MAAZ;AAEI,eAAKg1C,qBACP,KAAKj1C,MAAOu4B,eAAe,KAAK0c,gBAAhC,GACMh8E;YACJ,KAAKg8E,iBAAiBhd,WAAtB;YACYn5D,iDAAZ;YACA;UAHF;AAOF,eAAK8zC,YAAL;QAxC2C;QA4CrCkjC,iBAAc;AACpB,gBAAM30E,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,gBAAMvP,IAAO,IAAIG;AACjBH,YAAKhjC,QAAaojC,uCAAK02B,OAAvB;AACA,eAAK72B,QAAQD;AAEb,gBAAMxyB,IAAU,KAAK6/B,WAAW,KAAhB;AAChB,eAAK6nC,mBAAmB;AACxB,mBAASvmE,IAAI,GAAGA,IAAInB,EAAQa,QAAQM,KAAK;AACvC,kBAAM,CAACw7B,GAAOpxB,CAAR,IAAiBvL,EAAQmB,CAAR;AAErB,gBAAqB,aAAjB,OAAOw7B,GAAoB;AAEvBmsC,kBAAAA,IAAQ,IAAIC,MAAMpsC,EAAA,OAAgBA,EAAA,MAA1B;AACdmsC,gBAAMzrC,MAAMV,EAAA;AACZmsC,gBAAMlsC,MAAMD,EAAA,OAAgB;YAJC;AAO/B,kBAAOA;AAEH5J,gBAAW,IAAIC,yCAVLtnB,GAUuBH,CAAtB;AACjBwnB,cAASvjC,QAAaojC,uCAAK42B,MAA3B;AACAz2B,cAASE,eAAer/B,EAAM6iB,GAA9B;AACAsc,cAASy5B,aAAa,IAAtB;AACAh6B,cAAKW,SAASJ,CAAd;AACAA,cAAS05B,WAAWlhD,MAAU,KAAKylD,MAAnC;AACIzlD,kBAAU,KAAKylD,WACjB,KAAK0W,mBAAmB30C;AAE1BA,cAASO,SAAS,KAAK01C,uBAAuB,IAA9C;UArBuC;QAXrB;QAuCZH,mBAAgB;AACpB,eAAKp2C,SACP,KAAKA,MAAM9+B,QAAX;AAGF,eAAK+zE,mBADL,KAAKj1C,QAAQ;AAEb,eAAK4S,YAAL;QANwB;QAclB2jC,sBAAsBj2C,GAAkB;AAClC1gC,yDAAY,MAAM,IAA9B;AACA,eAAK42E;YAAgB,KAAKx2C;YAAeM;UAAzC;QAF8C;QAWtCk2C,gBAAgBz2C,GAAYO,GAAkB;AACtD,eAAKy6B,SAASz6B,EAASmP,SAAT,CAAd;QADsD;QAQxDtC,sBAAmB;AACjB,iBAAsC,eAA/B,OAAO,KAAKioC;QADF;QAanBhoC,WAAWqpC,GAAkB;AAC3B,cAAI,CAAC,KAAKrB;AAGR,kBAAMhyD,UAAU,qCAAV;AAER,cAAIvS,MAAMyR,QAAQ,KAAK8yD,cAAnB;AAAoC,mBAAO,KAAKA;AACpD,cAAIqB,KAAY,KAAKvB;AAAkB,mBAAO,KAAKA;AAEnD,eAAKA,mBAAmB,KAAKE,eAAL;AACxB1vE,gEAAgB,KAAKwvE,gBAArB;AACA,iBAAO,KAAKA;QAXe;QAwBVhT,mBACjBn0D,GAAiB;AAKjB,iBAHgB,KAAKq/B,WAAW,IAAhB7/B,EACaic,KAAM6W,OAAWA,EAAO,CAAP,MAActyB,CAAvC2oE,IAgBd3oE,KAbD,KAAK+vD,gBACP9wD,QAAQxG,KACN,2EAEE,KAAKs3D,aAAa/xD,OAClB,mBACA,KAAKC,OACL,cACA+B,CAPJ,GAUK;QAjBQ;QA4BAw0D,eAAex0D,GAAgB;AAChD,gBAAMw0D,eAAex0D,CAArB;AACMR,cAAU,KAAK6/B,WAAW,IAAhB;AAChB,mBAAS1+B,IAAI,GAAG2xB,GAASA,IAAS9yB,EAAQmB,CAAR,GAAaA;AACzC2xB,cAAO,CAAP,MAAc,KAAKk+B,WACrB,KAAK8W,iBAAiBh1C;QALsB;QAazCuS,cAAW;AAClB,gBAAM13B,IAAS,KAAK4iD,aAA0B5iD;AAC1C,eAAKuiD,gBACP,KAAKA,YAAY1oD,aAAa,UAAUmG,EAAMi7D,cAA9C,GACI,KAAKn2C,QACP,KAAKy9B,YAAY1oD,aAAa,QAAQmG,EAAMi7D,cAA5C,IAEA,KAAK1Y,YAAY1oD,aAAa,QAAQ,aAAtC;AAIA,eAAK+oD,gBAAgB,KAAK1pC,UACxB,KAAK0pC,aAAaptC,SAAlB,IACF,KAAK0D,MAAMlZ,MAAMy7D,OAAOz7D,EAAM07D,kBAE9B,KAAKxiD,MAAMlZ,MAAMy7D,OAAOz7D,EAAM27D;QAfhB;QAqBDtW,UAAO;AAExB,eAAKD,eAAL,EAAsBE,YAAY;AAClC,eAAKwU,aAAc95D,MAAMkB,UAAU;AAGnC,gBAAMikB,IAAS,KAAKg1C,kBAAkB,KAAKA,eAAe,CAApB;AAClCh1C,eAA4B,aAAlB,OAAOA,IACnB,KAAKy2C,oBAAoBz2C,CAAzB,IAEA,KAAK02C,mBAAL;AAGF,eAAKvV,oBAAL;QAbwB;QAqBlBsV,oBAAoBE,GAA0B;AACpD,gBAAM71E,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,eAAK0lC,aAAc95D,MAAMkB,UAAU;AACnC,eAAK44D,aAAcnnB,eACbhT,2CACJ,cACAm8B,EAAUpsC,GAHZ;AAKA,eAAKoqC,aAAcjgE,aAAa,UAAUjI,OAAOkqE,EAAUniE,MAAjB,CAA1C;AACA,eAAKmgE,aAAcjgE,aAAa,SAASjI,OAAOkqE,EAAUriE,KAAjB,CAAzC;AAEA,gBAAMsiE,IAAcx3D,OAAOu3D,EAAUniE,MAAjB;AACdqiE,cAAaz3D,OAAOu3D,EAAUriE,KAAjB;AAGnB,cAAMwiE,IAAY,CAAC,CAAC,KAAK1Z;AACzB,gBAAM5oD,IAASoK,KAAKE,IAClBg4D,IAAY,KAAKtY,aAAL,EAAqBuY,oCAAoC,GACrEH,IAAcI,qDAFD;AAITC,cAAWH,IACb,KAAKtY,aAAL,EAAqBiC,8BACrB;AACJ,cAAIyW;cACA,KAAKxC,WACM,KAAKyC,iBAChBN,IAAaI,GACbziE,IAAS,IAAI,KAAKgqD,aAAL,EAAqB+W,gCAAgC,CAFvD,IAKIr9E,kDACf,KAAK67B,OACL,KAAKyqC,aAAL,EAAqBsC,qBACrB,KAAKtC,aAAL,EAAqBuC,uBACrB,KAAKvC,aAAL,EAAqBwC,qBAJV;AAOf,eAAK7C,MAAM7pD,QAAQuiE,IAAaK,IAAwB,IAAXD;AAC7C,eAAK9Y,MAAM3pD,SAASA;AAEpB,cAAIiiB,IAAS;AACT31B,YAAM6iB,MAER,KAAKgxD,aAAcjgE,aAAa,KAAK,GADtBuiE,IAAWC,CACW,EAArC,KAEAzgD,IAASogD,IAAaK,GACtB,KAAKlX,eAAL,EAAsBtrD,aAAa,eAAe,KAAlD,GACA,KAAKigE,aAAcjgE,aAAa,KAAK,GAAGuiE,CAAH,EAArC;AAEF,eAAKtC,aAAcjgE;YAAa;YAAKjI,OAAO+H,IAAS,IAAIoiE,IAAc,CAAlC;UAArC;AAEA,eAAK1V,qBAAqBzqC,IAASwgD,GAAUJ,IAAaK,CAA1D;QAtDoD;QA0D9CR,qBAAkB;AAExB,eAAKzW,eAAL,EAAsBE,YAAY,KAAKC,gBAAL;AAClC,cAAMplD,IAAc,KAAKglD,eAAL;AAChBxoE,oDAASwjB,GAAa,qBAA1B;AACAA,YAAYtG,aAAa,eAAe,OAAxC;AAGA,cAAMoiE,IAAY,CAAC,CAAC,KAAK1Z;AACnB5oD,cAASoK,KAAKE,IAClBg4D,IAAY,KAAKtY,aAAL,EAAqBuY,oCAAoC,GACrE,KAAKvY,aAAL,EAAqBoC,iBAFR;AAIf,gBAAMwW,IAAgBl/E;YACpB,KAAK8nE,eAAL;YACA,KAAKxB,aAAL,EAAqBsC;YACrB,KAAKtC,aAAL,EAAqBuC;YACrB,KAAKvC,aAAL,EAAqBwC;UAJL;AAMZiW,cAAWH,IACb,KAAKtY,aAAL,EAAqBiC,8BACrB;AACJ,cAAIyW,IAAa;AACb,eAAKxC,aACPwC,IAAa,KAAKC,iBAChBC,IAAYH,GACZziE,IAAS,IAAI,KAAKgqD,aAAL,EAAqB+W,gCAAgC,CAFvD;AAKf,eAAKpX,MAAM7pD,QAAQ8iE,IAAYF,IAAwB,IAAXD;AAC5C,eAAK9Y,MAAM3pD,SAASA;AAEpB,eAAK0sD,qBAAqB+V,GAAUG,CAApC;QAhCwB;QA0ClBD,iBAAiBv/D,GAAWE,GAAS;AAC3C,cAAI,CAAC,KAAK48D;AACR,mBAAO;AAET,gBAAM5zE,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAGZ,gBAAMgoC,IADc,KAAK7Z,cAErB,KAAKoB,aAAL,EAAqBiC,8BACrB,GACE4W,IAAc,KAAK7Y,aAAL,EAAqB8Y,kCACnCC,IAAe,KAAK/Y,aAAL,EAAqB+W;AAE1C,eAAKb,SAAShgE,aACZ,aACA,gBAHa5T,EAAM6iB,MAAMszD,IAAWr/D,IAAIy/D,KAGhB,MAAMv/D,IAAI,GAFpC;AAIA,iBAAOy/D,IAAeF;QAnBqB;QA6B1B5V,WAAQ;AACzB,cAAI,CAAC,KAAKuT;AACR,mBAAO;AAET,gBAAMh1C,IAAS,KAAKg1C,eAAe,CAApB;AACf,iBAAsB,aAAlB,OAAOh1C,IACFA,EAAA,MAEFA;QARkB;QAmBXzqC,OAAAA,SACd2X,GAAoC;AAEpC,cAAI,CAACA,EAAQA;AACX,kBAAUlB,MACR,mJADI;AAQR,iBAAO,IAAI,KAAKkB,EAAQA,SAAS6B,QAAW7B,CAArC;QAX6B;MArmBlC;AAEG2/B,0DAAA2qC,qBAAqB;AAMrB3qC,0DAAA4qC,qBAAqB;AAErB5qC,0DAAAyoC,aAAa;AAwqBtB,UAAMoC,uDAAiB,GAGjBV,wDAA2C,IAAjBU;AAwIlBvjF,qDAAS,kBAAkB04C,mDAAzC;UAl2BAmU,uCAAA,CAAA;AAqCanU,2CAAAA,gBAAAA;AmGzBP,UAAO8qC,0EAAP,MAAA;QAGJnlD,YACU06C,GACAj7D,GAAuB;AADvB,eAAAi7D,SAAAA;AACA,eAAAj7D,YAAAA;AAJF,eAAA4iD,WAA8B;QAIL;QAGjC/rB,YAAS;AACP,iBAAO;QADA;QAITC,YAAS;AACSv3B,YAAAA,6CAAX,KACQC,EAAAA,6CAAS,IAApB;AAEF,eAAKojD,WAAW,KAAKqY,OAAO7hD,uBAAZ;AAChB,eAAKpZ,UAAU0xB,kBAAkB,KAAjC;AACA,cAAA;AAAA,mBAAA,IAAA,KAAK1xB,UAAUi1B,gBAAf,MAAA,EAAkC4tB,gBAAgB,KAAKoY,MAAvD;AACA,eAAKA,OAAOnY,eAAe,KAAKmY,OAAOnY,YAAY,IAAxB;QAPpB;QAUT/rB,KAAKgsB,GAAkB;AACrB,eAAKkY,OAAOjY,eAAeD,CAA3B;QADqB;QAIvB/rB,UAAO;AACL,eAAKh3B,UAAU0xB,kBAAkB,IAAjC;YACWlyB,6CAAS,KAApB;AAEA,cAAA;AAAA,mBAAA,IAAA,KAAKQ,UACFi1B,gBADH,MAAA,EAEIiuB,iBAAiB,KAAK+X,QAAezc,oCAFzC;AAGA,eAAKyc,OAAOnY,YAAY,KAAxB;QAPK;QAUP7rB,aAAU;AACJ,eAAK2rB,YAAU,KAAKqY,OAAOjY,eAAe,KAAKJ,QAAhC;QADX;MApCN,GAZN7T,sDAAA,CAAA;AAYa22B,0DAAAA,qBAAAA;ACRV,UAAAC,0CAuBmBC,+CAAhB,MAAA;QAoEJrlD,YACkBvgB,GACN6lE,GACAC,GAAgB;AAFV,eAAA9lE,YAAAA;AACN,eAAA6lE,SAAAA;AACA,eAAAC,YAAAA;AA1BJ,eAAA/0D,OAAO,IAAIrG,uCAAK,GAAG,CAAZ;AAGP,eAAA0f,SAAS;AAGV,eAAAzL,WAAW;AAMV,eAAAonD,eAHA,KAAAC,cAAc;AAKd,eAAAnU,eAAe,IAAI6T,wEAAmB,MAAM,KAAK1lE,SAAlC;AAcrB,eAAKF,KAAiBnd,yDAAZ;AACV,eAAKq8D,UAAc15D;YACjBqwC,qCAAI8e;YACJ,EAAC,SAAS,gBAAV;YACAz0C,EAAUimE,gBAAV;UAHa;AAKTC,cAAkB5gF,kDACtBqwC,qCAAI8e,GACJ,EACE,QAAU,QACR,KAAKz0C,UAAU2jB,YAAf,EAA6B4oC,aAA7B,EAA4C4Z,cADpC,IADZ,GAKA,KAAKnnB,OAPa;AASpB,eAAKonB,OAAW9gF,kDACdqwC,qCAAIif,MACJ,EAAC,SAAS,oBAAV,GACAsxB,CAHU;AAKZ,eAAKG,aAAiB/gF,kDACpBqwC,qCAAIof,MACJ;YACE,SAAS;YACT,GAAK;YACL,GAAK;YACL,IAAM4wB,yCAAOW;YACb,IAAMX,yCAAOW;UALf,GAOAJ,CATgB;AAWlB,eAAKK,mBAAuBjhF,kDAAiBqwC,qCAAI8e,GAAG,CAAA,GAAI,KAAKuK,OAArC;AAEVn6D,gEACZ,KAAKwhF,YACL,eACA,MACA,KAAKG,WAJP;QAnC0B;QA4C5B53E,UAAO;AACDjJ,sDAAW,KAAKq5D,OAApB;AACA,eAAKrgC,WAAW;QAFX;QAaP8nD,kBAAkBZ,GAAoBa,IAAW,OAAK;AACpD,eAAKb,SAASA;AACVa,cACF,KAAKC,eAAe,KAAKb,SAAzB,IAEA,KAAKc,yBAAL;AAEF,eAAKC,WAAL;QAPoD;QAWtDC,4BAA4B78D,GAAcD,GAAW;AACnD,eAAK+7D,eAAe97D;AACpB,eAAK+7D,cAAch8D;AACnB,eAAK48D,yBAAL;AACA,eAAKC,WAAL;QAJmD;QAQ3CzgF,UAAO;AACf,iBAAO,KAAK2qB;QADG;QAYPoK,QAAQpK,GAAY21D,IAAW,OAAK;AAC5C31D,YAAK1O,QAAQsK,KAAKE,IAAIkE,EAAK1O,OAAOsjE,yCAAOoB,QAA5B;AACbh2D,YAAKxO,SAASoK,KAAKE,IAAIkE,EAAKxO,QAAQojE,yCAAOoB,QAA7B;AACd,eAAKh2D,OAAOA;AAEZ,eAAKs1D,WAAW5jE,aAAa,SAAS,GAAGsO,EAAK1O,KAAR,EAAtC;AACA,eAAKgkE,WAAW5jE,aAAa,UAAU,GAAGsO,EAAKxO,MAAR,EAAvC;AAEImkE,cACF,KAAKC,eAAe,KAAKb,SAAzB,IAEA,KAAKc,yBAAL;AAEF,eAAKC,WAAL;QAb4C;QAiBpCjD,YAAS;AACjB,iBAAO,KAAKx5C;QADK;QAKZ19B,UAAU09B,GAAc;AAC7B,eAAKA,SAASA;AACd,eAAKg8C,KAAK3jE,aAAa,QAAQ2nB,CAA/B;AACA,eAAKi8C,WAAW5jE,aAAa,QAAQ2nB,CAArC;QAH6B;QAOvBo8C,YAAYvqE,GAAe;AACjC,cAAA;AAAA,mBAAA,IAAA,KAAK+D,UAAUswD,WAAWr0D,CAA1B,MAAA,EAA8B++D,kBAAkB/+D,GAAG,IAAnD;AACOqF,YAAAA,0CAAY,IAAnB;QAFiC;QAMzBslE,2BAAwB;AAChC,cAAI38D,IAAO,KAAK47D,OAAOlgE;AAErBsE,cADE,KAAKjK,UAAU0R,MACjBzH,KAAQ,KAAK87D,eAAe,KAAKh1D,KAAK1O,SAEtC4H,IAAQ,KAAK87D;AAGf,eAAK1xE,OAAO4V,GADA,KAAK+7D,cAAc,KAAKH,OAAOhgE,CAC3C;QARgC;QAgBlCxR,OAAOsR,GAAWE,GAAS;AACzB,eAAKm5C,QAAQv8C;YAAa;YAAa,aAAakD,CAAb,KAAmBE,CAAnB;UAAvC;QADyB;QAQjB8gE,eAAetxC,IAAO,IAAIxpB,uCAAK,GAAG,GAAG,GAAG,CAAlB,GAAoB;AAClD,cAAMgG,IAAc,KAAK7R,UAAUgiC,kBAAf,EAAmC8D,eAAe,IAAlD,GAEdkhC,IAAc,KAAKC,uBAAuBp1D,CAA5B,GACdq1D,IAAa,KAAKC,sBAAsBt1D,CAA3B;AAEnB,gBAAMu1D,IAAc,EAClBzhE,GAAGqhE,GACHnhE,GAAI,CAAC,KAAKkL,KAAKxO,SACb,KAAKvC,UAAU2jB,YAAf,EAA6B4oC,aAA7B,EAA4C8a,iBAH5B,GAKdC,IAAgB,EAAC3hE,GAAG,CAAC,KAAKoL,KAAK1O,QAAQ,IAAIwD,GAAGqhE,EAA9B;AAChBK,cAAc,EAAC5hE,GAAG0vB,EAAKjb,SAAL,GAAiBvU,GAAGqhE,EAAxB;AACpB,cAAMM,IAAiB,EAAC7hE,GAAGqhE,GAAanhE,GAAGwvB,EAAK6f,UAAL,EAApB;AAEjBuyB,cACJpyC,EAAKjb,SAAL,IAAkBib,EAAK6f,UAAL,IAAmBqyB,IAAcC;AAC/CE,cACJryC,EAAKjb,SAAL,IAAkBib,EAAK6f,UAAL,IAAmBsyB,IAAiBD;AAElDI,cAAqB,KAAKC,WAAWR,GAAav1D,CAA7B;AACrBg2D,cAAuB,KAAKD;YAAWN;YAAez1D;UAA/B;AAC7B,gBAAMi2D,IAAwB,KAAKF,WAAWH,GAAgB51D,CAAhC;AACxBk2D,cAAyB,KAAKH,WAClCF,GACA71D,CAF6B;AAOzBm2D,cAAcr7D,KAAKE,IACvB86D,GACAE,GACAC,GACAC,CAJkB;AAMhBJ,gBAAuBK,KACzB,KAAKjC,eAAeqB,EAAYzhE,GAChC,KAAKqgE,cAAcoB,EAAYvhE,KAI7BgiE,MAAyBG,KAC3B,KAAKjC,eAAeuB,EAAc3hE,GAClC,KAAKqgE,cAAcsB,EAAczhE,KAI/BiiE,MAA0BE,KAC5B,KAAKjC,eAAe0B,EAAe9hE,GACnC,KAAKqgE,cAAcyB,EAAe5hE,MAOpC,KAAKkgE,eAAe2B,EAAgB/hE,GACpC,KAAKqgE,cAAc0B,EAAgB7hE;AAnBjC,eAAK+gE,yBAAL;QAvCgD;QAwE5CgB,WACNK,GACAp2D,GAA4B;AAIvB,cAAA,IAAA,KAAK7R,UAAU0R,MACd,KAAKm0D,OAAOlgE,IAAIsiE,EAAYtiE,IAAI,KAAKoL,KAAK1O,QAC1C4lE,EAAYtiE,IAAI,KAAKkgE,OAAOlgE;AAC7B,cAAAsiE,EAAYpiE,IAAI,KAAKggE,OAAOhgE;AA2BjC,iBAAO8G,KAAKE,IACV,GACAF,KAAKC,IACH,IARFD,KAAKC,IAlBQjH,IAAI,KAAKoL,KAAK1O,OAaxBwP,EAAY5H,OAAO4H,EAAYxP,KAKlC,IACAsK,KAAKE;YAAclH;YATIkM,EAAY5H;UASnC,MAEA0C,KAAKC,IApBQ/G,IAAI,KAAKkL,KAAKxO,QAaxBsP,EAAY7H,MAAM6H,EAAYtP,MAOjC,IACAoK,KAAKE,IAAchH,GAZyBgM,EAAY7H,GAYxD,MAKoC,KAAK+G,KAAK1O,QAAQ,KAAK0O,KAAKxO,OAFhE,CAFK;QAlCqB;QAqDtB0kE,uBAAuBp1D,GAA4B;AAEzD,cAAIk0D,IAAe,CAAC,KAAKh1D,KAAK1O,QAAQ;AAGtC,cAAI,KAAK0O,KAAK1O,QAAQwP,EAAYxP;AAAO,mBAAO0jE;AAE1CmC,cAAgB,KAAKC,qBAAqBt2D,CAA1B;AAEtB,cAAI,KAAK7R,UAAU0R,KAAK;AAEtB,gBAAM02D,IAAc,KAAKvC,OAAOlgE,IAAIogE;AACjBqC,gBAAc,KAAKr3D,KAAK1O,QAE1B6lE,EAAcj+D,OAE7B87D,IAAe,EAAEmC,EAAcj+D,OAAO,KAAK47D,OAAOlgE,IAAI,KAAKoL,KAAK1O,SACvD+lE,IAAcF,EAAcv8D,UAErCo6D,IAAe,EAAEmC,EAAcv8D,QAAQ,KAAKk6D,OAAOlgE;UAV/B,OAYjB;AACC0iE,gBAAatC,IAAe,KAAKF,OAAOlgE;AAC9C,kBAAMyiE,IAAcC,IAAa,KAAKt3D,KAAK1O;AAEvCgmE,gBAAaH,EAAcj+D,OAE7B87D,IAAemC,EAAcj+D,OAAO,KAAK47D,OAAOlgE,IACvCyiE,IAAcF,EAAcv8D,UAErCo6D,IAAemC,EAAcv8D,QAAQ,KAAKk6D,OAAOlgE,IAAI,KAAKoL,KAAK1O;UAT5D;AAaP,iBAAO0jE;QAlCkD;QA+CnDoB,sBAAsBt1D,GAA4B;AAExD,cAAIm0D,IAAc,CAAC,KAAKj1D,KAAKxO,SAAS;AAGtC,cAAI,KAAKwO,KAAKxO,SAASsP,EAAYtP;AAAQ,mBAAOyjE;AAElD,gBAAMh8D,IAAM,KAAK67D,OAAOhgE,IAAImgE,GACtBp6D,IAAS5B,IAAM,KAAK+G,KAAKxO;AACzB2lE,cAAgB,KAAKC,qBAAqBt2D,CAA1B;AAElB7H,cAAMk+D,EAAcl+D,MAEtBg8D,IAAckC,EAAcl+D,MAAM,KAAK67D,OAAOhgE,IACrC+F,IAASs8D,EAAct8D,WAEhCo6D,IAAckC,EAAct8D,SAAS,KAAKi6D,OAAOhgE,IAAI,KAAKkL,KAAKxO;AAGjE,iBAAOyjE;QAnBiD;QA0BlDmC,qBAAqBt2D,GAA4B;AACvD,gBAAM7H,IAAM6H,EAAY7H;AACxB,cAAI4B,IAASiG,EAAY7H,MAAM6H,EAAYtP,QACvC0H,IAAO4H,EAAY5H;AACnB0B,cAAQkG,EAAY5H,OAAO4H,EAAYxP;AAE3CuJ,eAAU,KAAK08D,sBAAL;AACN,eAAKtoE,UAAU0R,MACjBzH,KAAQ,KAAKq+D,sBAAL,IAER38D,KAAS,KAAK28D,sBAAL;AAGX,iBAAO,IAAIz8D,uCAAK7B,GAAK4B,GAAQ3B,GAAM0B,CAA5B;QAbgD;QAiBjD28D,wBAAqB;AAC3B,iBAAO32D,2CAAUC,qBAAqB,KAAK5R,UAAUjB;QAD1B;QAKrB8nE,aAAU;AAChB,gBAAMjgD,IAAQ,CAAA;AAEd,cAAM2hD,IAAa,KAAKx3D,KAAK1O,QAAQ,GAC/BmmE,IAAa,KAAKz3D,KAAKxO,SAAS,GAElCkmE,IAAa,CAAC,KAAK1C,cACnB2C,IAAa,CAAC,KAAK1C;AACvB,cAAIuC,MAAeE,KAAcD,MAAeE;AAG9C9hD,cAAM1qB,KAAK,OAAOqsE,IAAa,MAAMC,CAArC;eACK;AAEQE,iBAAaF;AAChBC,iBAAaF;AACnB,iBAAKvoE,UAAU0R,QACjBs+B,KAAO;AAET,gBAAM24B,IAAah8D,KAAKmc,KAAK8/C,IAAOA,IAAO54B,IAAMA,CAA9B,GACf64B,IAAQl8D,KAAKm8D,KAAK94B,IAAM24B,CAAhB;AACD,gBAAPC,MACFC,IAAQ,IAAIl8D,KAAK4U,KAAKsnD;AAGxB,gBAAIE,IAAaF,IAAQl8D,KAAK4U,KAAK;AAC/BwnD,gBAAuB,IAAVp8D,KAAK4U,OACpBwnD,KAAwB,IAAVp8D,KAAK4U;AAErB,gBAAMynD,IAAYr8D,KAAK6pB,IAAIuyC,CAAT;AAClB,kBAAME,IAAWt8D,KAAKu8D,IAAIH,CAAT;AAGjB,gBAAII,KACD,KAAKp4D,KAAK1O,QAAQ,KAAK0O,KAAKxO,UAAUojE,yCAAOyD;AAChDD,gBAAYx8D,KAAKC,IAAIu8D,GAAW,KAAKp4D,KAAK1O,OAAO,KAAK0O,KAAKxO,MAA/C,IAAyD;AAG/D8mE,gBAAe,IAAI1D,yCAAO2D,gBAAgBX;AAChDF,gBAAaF,IAAac,IAAer5B;AACzC04B,gBAAaF,IAAaa,IAAeT;AAGnCW,gBAAShB,IAAaY,IAAYF;AACxC,kBAAMO,IAAShB,IAAaW,IAAYH;AACzBT,iBAAaY,IAAYF;AACzBT,iBAAaW,IAAYH;AAGlCS,gBAAev9E,4CACnB,KAAK8T,UAAU0R,MAAM,CAACi0D,yCAAO+D,aAAa/D,yCAAO+D,UADnC;AAGZC,gBAAad,IAAQY;AACrBE,gBAAuB,IAAVh9D,KAAK4U,OACpBooD,KAAwB,IAAVh9D,KAAK4U;AAEfqoD,gBAAaj9D,KAAK6pB,IAAImzC,CAAT,IAAuBhB,IAAchD,yCAAOkE;AACzDC,gBAAYn9D,KAAKu8D,IAAIS,CAAT,IAAuBhB,IAAchD,yCAAOkE;AAE9DjjD,cAAM1qB,KAAK,MAAMqtE,IAAS,MAAMC,CAAhC;AACA5iD,cAAM1qB,KACJ,OACGqtE,IAASO,KACV,OACCN,IAASI,KACV,MACAnB,IACA,MACAC,IACA,MACAD,IACA,MACAC,CAZJ;AAcA9hD,cAAM1qB,KACJ,MACEusE,IACA,MACAC,IACA,OACCqB,IAASD,KACV,OACCE,IAASJ,KACV,MACAG,IACA,MACAC,CAZJ;UA9DK;AA6EPpjD,YAAM1qB,KAAK,GAAX;AACKkqE,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,SAAAA,EAAM3jE,aAAa,KAAKmkB,EAAMjpB,KAAK,GAAX,CAA7B;QA1FgB;QAkGlBmkD,eAAY;AACY9C,cAAAA;AAAtB,gBAAMnqB,IAAyBxsB,SAAT22C,IAALA,KAAKA,WAAS32C,SAAT22C,EAAS32C;AAC/B,iBAAI,KAAK22C,YAAqBirB,QAAVp1C,IAAUo1C,SAAVp1C,EAAUo1C,eAAc,KAAKjrB,WAC/C,QAAAnqB,KAAAA,EAAUxtB,YAAY,KAAK23C,OAA3B,GACO,QAEF;QANG;QAUZ5lC,yBAAsB;AACpB,iBAAO,IAAInO;YACT,KAAKjL,UAAU0R,MACX,CAAC,KAAKq0D,eAAe,KAAKF,OAAOlgE,IAAI,KAAKoL,KAAK1O,QAC/C,KAAKwjE,OAAOlgE,IAAI,KAAKogE;YACzB,KAAKF,OAAOhgE,IAAI,KAAKmgE;UAJhB;QADa;QAUtBpjD,aAAU;AACR,iBAAO,KAAKo8B;QADJ;QAUVgE,eAAeD,GAAkB;AAC/B,eAAK1uD,OAAO0uD,EAAOp9C,GAAGo9C,EAAOl9C,CAA7B;AAEE,eAAKkgE,eADH,KAAK/lE,UAAU0R,MACG,KAAKm0D,OAAOlgE,IAAIo9C,EAAOp9C,IAAI,KAAKoL,KAAK1O,QAErC0gD,EAAOp9C,IAAI,KAAKkgE,OAAOlgE;AAE7C,eAAKqgE,cAAcjjB,EAAOl9C,IAAI,KAAKggE,OAAOhgE;AAC1C,eAAKghE,WAAL;QAR+B;QAWjC/jB,YAAYonB,GAAe;QAAA;QAK3B/X,eAAegY,GAAgB;QAAA;QAK/B1zE,cAAW;AACT,iBAAO;QADE;QAKX47D,gBAAgB/pC,GAAS;QAAA;QAKzBuO,YAAS;AACP,iBAAO;QADA;QAKTC,YAAS;AACP,eAAK+6B,aAAa/6B,UAAlB;QADO;QAKTC,KAAKgsB,GAAkB;AACrB,eAAK8O,aAAa96B,KAAKgsB,CAAvB;QADqB;QAKvB/rB,UAAO;AACL,eAAK66B,aAAa76B,QAAlB;QADK;QAKPC,aAAU;AACR,eAAK46B,aAAa56B,WAAlB;QADQ;QAIVv1B,SAAM;QAAA;QAIND,WAAQ;QAAA;MAnnBJ;iDAqnBHmkE;AAnnBeA,mDAAAU,eAAe;AAGfV,mDAAAwE,gBAAoC,IAApBzE,yCAAKW;AAGrBV,mDAAAmB,WAAWpB,yCAAKyE;AAMhBxE,mDAAAwD,iBAAiB;AAGjBxD,mDAAA8D,aAAa;mDAMbG,YAAY;AAGZjE,mDAAA0D,gBAAgB;AArDlC,UAAAv6B,uCAAA,CAAA;AA2BsB62B,2CAAAA,SAAAA;ACNhB,UAAOyE,2EAAP,cAAmCzE,6CAAnC;QA0BJrlD,YACE+pD,GACgBtqE,GACN6lE,GACAC,GAAgB;AAE1B,gBAAM9lE,GAAW6lE,GAAQC,CAAzB;AAJgB,eAAA9lE,YAAAA;AACN,eAAA6lE,SAAAA;AACA,eAAAC,YAAAA;AAPJ,eAAAyE,aAAa;AAUbtvE,cAAU,IAAI+sC,uCAAQsiC,CAAZ;AAChB,eAAKE,yBAAyBvvE,CAA9B;AAEA,eAAKwvE,YAAgBnlF;YACnBqwC,qCAAI0S;YACJ,EACE,GAAKu9B,6CAAOU,cACZ,GAAKV,6CAAOU,aAFd;YAIA,KAAKC;UANU;AAQjB+D,YAAiBzoE,kBAAkB,KAAK7B;AACxC,eAAK0qE,gBAAgB,KAAKC,gBAAgB,IAAI3iC,uCAAQsiC,CAAZ,CAArB;AAGrB,eAAKI,cAAcE,oBAAoB;AACjCvE,cAAa,KAAKqE,cAAcr+E,UAAU,0BAA7B;AACnB,eAAKo+E,UAAUpjE,YAAYg/D,CAA3B;AACIprE,YAAQiuC,iBACVm9B,EAAW9+D,aACT,KAAKmjE,cAActhC,UAAUzT,qCAAI8e,CAAjC,GACA,KAAKi2B,cAAcG,UAAnB,CAFF,GAIM1hC,IAAS,KAAKuhC,cAAc1gC,UAAnB,GACf,QAAAb,KAAAA,EAAQtzC,KAAK,KAAK60E,aAAlB,GACA,QAAAvhC,KAAAA,EAAQn8C,KAAKiO,EAAQiuC,YAArB;eAGGwhC,cAAcrsC,kBAAkB,KAAKysC,kBAAkBhmF,KAAK,IAA5B,CAArC;AACA,cAAA,GAAA;AAAA,mBAAA,IAAA,KAAK4lF,cACF1gC,UADH,MAAA,SAAA,IAAA,EAEI5L,aAFJ,MAAA,EAGIC,kBAAkB,KAAKysC,kBAAkBhmF,KAAK,IAA5B,CAHtB;AAIA,eAAKimF,iBAAL;QApC0B;QAuC5Bn8E,UAAO;AACL,eAAK87E,cAAc97E,QAAnB;AACA,gBAAMA,QAAN;QAFK;QAMPwvC,eAAY;AACV,iBAAO,KAAKssC;QADF;QAKZM,2BAA2BppB,GAAoC;AAC7D,eAAK8oB,cAAcrsC,kBAAkBujB,CAArC;QAD6D;QAQvD4oB,yBAAyBvvE,GAAgB;AAC/C,cAAIA,EAAQxT;AACV,kBAAUsS,MACR,qEADI;AAIR,cAAIkB,EAAQouC;AACV,kBAAUtvC,MAAM,qDAAV;AAER,cACEkB,EAAQ+tC,YAAYO,YACpBtuC,EAAQ+tC,YAAYq3B,SACpBplE,EAAQ+tC,YAAY6vB;AAEpB,kBAAU9+D,MAAM,mDAAV;AAER,cACEkB,EAAQmvC,YAAYC,cACpBpvC,EAAQmvC,YAAYi2B,SACpBplE,EAAQmvC,YAAYrT;AAEpB,kBAAUh9B,MACR,kEADI;AAIR,cAAIkB,EAAQmX;AACV,kBAAUrY,MACR,8DADI;QA1BuC;QAgCzC+wE,oBAAiB;AACvB,eAAKG,qBAAL;eACKF,iBAAL;QAFuB;QAYjBE,uBAAoB;AAC1B,cAAI,CAAA,KAAKP,cAAc1pE,WAAnB;AAIJ,uBAAWnS,KAAS,KAAK67E,cAAcp7C,aAAa,KAAhC,GAAwC;AAC1D,oBAAM0D,IAAUnkC,EAAMuqB,uBAAN;AAHH8xD,mBAMTl4C,EAAQntB,KACVhX,EAAMyF,OAAO,GAPF42E,KAOcl4C,EAAQntB,CAAjC;AAGF,kBAAIhX,EAAM6iB,KAAK;AACb,oBAAI/F,IAAQ;AACZ,sBAAMw9B,IAAS,KAAKuhC,cAAc1gC,UAAnB;AACXb,sBACFx9B,KAASw9B,EAAO/uB,SAAP;AAEP4Y,kBAAQrtB,IAAIgG,KACd9c,EAAMyF,OAAOqX,IAAQqnB,EAAQrtB,GAAG,CAAhC;cAPW;AAVFulE,qBAmBFl4C,EAAQrtB,KACjB9W,EAAMyF,OApBK42E,KAoBWl4C,EAAQrtB,GAAG,CAAjC;YAlBwD;QALlC;QAgCpBolE,mBAAgB;AACtB,cAAI,CAAA,KAAKL,cAAc1pE,WAAnB,GAAJ;AAEA,gBAAMmqE,IAAW,KAAK/kF,QAAL,GACXmxD,IAAU,KAAK6zB,uBAAL;AAEdz+D,iBAAKwP,IAAIgvD,EAAS9oE,QAAQk1C,EAAQl1C,KAAlC,IACEgoE,yEAAoBgB,uBACtB1+D,KAAKwP,IAAIgvD,EAAS5oE,SAASg1C,EAAQh1C,MAAnC,IACE8nE,yEAAoBgB,wBAKxB,KAAKZ,UAAUhoE,aAAa,SAAS,GAAG80C,EAAQl1C,KAAX,IAArC,GACA,KAAKooE,UAAUhoE,aAAa,UAAU,GAAG80C,EAAQh1C,MAAX,IAAtC,GACA,KAAKmoE,cAAchoE,uBAAuB60C,EAAQl1C,OAAOk1C,EAAQh1C,MAAjE,GACI,KAAKmoE,cAAch5D,OAErB,KAAKg5D,cACFG,UADH,EAEGpoE,aAAa,aAAa,aAAa80C,EAAQl1C,KAArB,MAF7B,GAIF,KAAK8Y,QACH,IAAIzQ;cACF6sC,EAAQl1C,QAAQujE,6CAAOwE;cACvB7yB,EAAQh1C,SAASqjE,6CAAOwE;YAF1B,GAIA,KAAKG,UALP,GAOA,KAAKG,cAAc/nE,OAAnB,GACA,KAAK+nE,cAAcY,kBAAnB;UA9BA;QADsB;QAqChBF,yBAAsB;AAC5B,cAAMG,IAAgB,KAAKb,cAAcG,UAAnB,EAA+B1qB,QAA/B;AACtB,cAAI99C,IAAQkpE,EAAclpE,QAAQgoE,yEAAoBa;AAClD3oE,cAASgpE,EAAchpE,SAAS8nE,yEAAoBa;AAExD,gBAAM/hC,IAAS,KAAKuhC,cAAc1gC,UAAnB;AACf,cAAIb,GAAQ;AACV,kBAAMqiC,IAAsBriC,EACzB/K,aADyB,EAEzB4D,kBAFyB,EAGzBI,iBAHyB;gBAInBz1B,KAAKE,IAAItK,GAAQipE,EAAoBjpE,SAAS,EAA9C;AACTF,iBAAS8mC,EAAO/uB,SAAP;UANC;AAQZ,iBAAO,IAAI1P,uCAAKrI,GAAOE,CAAhB;QAdqB;QAkB9BkpE,oBAAiB;AACf,mBAAW58E,KAAS,KAAK67E,cAAc52D,aAAa,KAAhC;AAClBjlB,cAAM68E,SAAS78E,EAAM88E,aAAN,CAAf;AAGe,cAAA;AACjB,cADMC,IAAW,SAAA,IAAA,KAAKlB,cAAc1gC,UAAnB,KAAA,SAAA,EAAgC5L,aAAhC;AAEf,uBAAWvvC,KAAS+8E,EAAS93D,aAAa,KAAtB;AAClBjlB,gBAAM68E,SAAS78E,EAAM88E,aAAN,CAAf;QARW;QAmBjB3oB,eAAeD,GAAkB;AAC/B,gBAAMC,eAAeD,CAArB;AACA,eAAKwnB,aAAa;QAFa;QAMjCl2E,OAAOsR,GAAWE,GAAS;AACzB,gBAAMxR,OAAOsR,GAAGE,CAAhB;AACA,eAAK6kE,cAAcY,kBAAnB;QAFyB;QAO3BX,gBAAgB1vE,GAAgB;AAC9B,gBAAUlB,MACR,iFADI;QADwB;MA3P5B;AAKoBswE,+EAAAgB,sBAAsB;AAMtBhB,+EAAAa,SAAgC,IAAvBtF,6CAAOwE;AAhC1C,UAAAr7B,sDAAA,CAAA;AAqBas7B,0DAAAA,sBAAAA;ACKPwB,UAAAA,gDAMAC;AANAD,uDAAO;AAMPC,mEAAmB;QAQZ5yC,wDAAP,cAA2BgpC,uCAA3B;QA4BJ3hD,YACmBwrD,GACE3oD,GAAqB;AAExC,gBAAMA,CAAN;AAHiB,eAAA2oD,mBAAAA;AACE,eAAA3oD,cAAAA;AAJb,eAAA4oD,0BATA,KAAAC,qBAHA,KAAAC,YAHA,KAAAC,sBAAkD;QAmBhB;QAKjC3uD,UAAO;AACd,iBAAO0b,EAAAA,sDAAYiF;QADL;QAIPiC,SAASiiC,GAA8C;AAC1D,eAAKrjB,YAET,MAAM5e,SAASiiC,CAAf,GAGI/8E,kDACFqwC,qCAAIof,MACJ;YACE,SAAS;YACT,IAAM;YACN,IAAM;YACN,QAAU;YACV,OAAS;UALX,GAOA,KAAKiK,OATP,GAYI15D;YACFqwC,qCAAIif;YACJ,EACE,SAAS,qBACT,GACE,kaAHJ;YAWA,KAAKoK;UAbP,GAgBI15D,kDACFqwC,qCAAIC,QACJ,EAAC,SAAS,oBAAoB,GAAK,OAAO,IAAM,KAAK,IAAM,IAA3D,GACA,KAAKopB,OAHP,GAKIz5D,0CAAS,KAAKy5D,SAAU,sBAA5B;QAvC8D;QA0CvDpwD,UAAO;AACd,gBAAMA,QAAN;AACKu9E,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,wBAAAA,EAAqBv9E,QAA1B;QAFc;QAKPyxC,YAAS;AAChB,iBAAOnH,EAAAA,sDAAYkzC;QADH;QAIThmF,UAAO;AACd,iBAAO,IAAIskB;YAAKmhE;YAAMA;UAAf;QADO;QAIPvrC,cAAW;AAClB,gBAAMA,YAAN;AACK6rC,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,wBAAAA,EAAqBz/E,UAAU,KAAK02B,YAAYxa,MAAM27D,aAA3D;AACK4H,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,wBAAAA,EAAqBV,kBAA1B;QAHkB;QAMXhrC,kBAAe;AACtB,gBAAMA,gBAAN;AACI,eAAKrd,YAAY9I,YAAjB,KAAgC,KAAK+G,iBAAiB,KAAtB;QAFd;QAKfH,iBAAiB/H,GAAuB;AAC/C,gBAAM+H,iBAAiB/H,CAAvB;AACKgzD,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,wBAAAA,EAAqB1F,kBAAkB,KAAK4F,kBAAL,CAA5C;QAF+C;QAKxCzrC,UAAO;AACd,gBAAMA,QAAN;AACI,eAAKxd,YAAYgqB,WAAjB,KACF,KAAK/rB,iBAAiB,CAAC,KAAKD,gBAAL,CAAvB;QAHY;QAOPqsC,sBAAmB;AAC1B,iBAAO;QADmB;QAI5BrsC,kBAAe;AACb,iBAAO,CAAC,CAAC,KAAK+qD;QADD;QAIT9qD,iBAAiBsG,GAAgB;AAAA,gBAAA,IAAA;AAAA,iBAAA,QAAA,qCAAA,aAAA;AACrC,gBAAI,EAAKvG,gBAAL,MAA2BuG,GAA/B;AAEA,oBAAuB99B,6DAAjB;AAEN,kBAAI89B,GAAS;AACX,kBAAKwkD,sBAAsB,IAAI9B;kBAC7B,EAAKiC,uBAAL;kBACA,EAAKlpD,YAAYpjB;kBACjB,EAAKqsE,kBAAL;kBACA,EAAKE,mBAAL;gBAJyB;AAM3B,kBAAKjsC,YAAL;AACA,kBAAKksC,gBAAL;AACA,kBAAKC,2BAAL;AACKN,oBAAAA;AAAL,yBAAKA,IAALA,EAAKA,wBAAAA,EAAqBnB,2BACxB,EAAK0B,kCAAL,CADF;cAVW,OAaN;AACAP,oBAAAA;AAAL,yBAAKA,IAALA,EAAKA,wBAAAA,EAAqBv9E,QAA1B;AACA,kBAAKu9E,sBAAsB;AACvB,kBAAKH,2BACP,EAAK5oD,YAAYpjB,UAAU2sE,qBACzB,EAAKX,uBADP;AAIF,kBAAKA,0BAA0B;cAR1B;AAWIlpF,uDACT,KAAgBS,wCAAe2b,+CAA1B;gBACH,EAAKkkB;gBACLuE;gBACA;cAHF,CADF;YA5BA;UADqC,CAAA;QAAA;QAuC/B2kD,yBAAsB;AAOWnM,cAAAA;AANvC,gBAAMllE,IAA0B,EAC9B,SAAW,OACX,OAAS,KAAKmoB,YAAYpjB,UAAU/E,QAAQ4L,aAC5C,KAAO,KAAKuc,YAAY1R,KACxB,UAAY,KAAK0R,YAAYpjB,UAAU/E,QAAQimC,UAC/C,mBACqCi/B,SAAAA,IAAnCA,KAAK/8C,YAAYpjB,UAAU/E,QAAQklE,qBAAAA,IAAqBrjE,OAN5B;AAS5B,eAAKivE,iBAAiBjwE,WACxBb,EAAQ6uC,UAAU,EAChB,MAAQ,iBACR,UAAY,KAAKiiC,iBAAiBrvE,IAAKjD,QAAU,EAC/C,MAAQ,SACR,MAAQA,EAFuC,EAArC,EAFI;AASpB,iBAAOwB;QApBqB;QA2BtBoxE,oBAAiB;AACvB,gBAAMO,IAAUf,iDAAO;AACvB,iBAAO5gE,mDAAW8Q,IAChB,KAAKqmD,mBACL,IAAIn3D,mDAAW2hE,GAASA,CAAxB,CAFK;QAFgB;QAYjBL,qBAAkB;AACxB,gBAAM95C,IAAO,KAAKrP,YAAYR,WAAjB,EAA8Bu9B,QAA9B;AACb,iBAAO,IAAIt0C,uCAAK4mB,EAAK5sB,GAAG4sB,EAAK5sB,IAAI4sB,EAAKlwB,QAAQkwB,EAAK9sB,GAAG8sB,EAAK9sB,IAAI8sB,EAAKpwB,KAA7D;QAFiB;QAMlBmqE,kBAAe;AACrB,cAAI,CAAC,KAAKppD,YAAYqW;AACpB,kBAAU1/B,MACR,2DADI;AAIR,eAAKmyE,YAAY,KAAK9oD,YAAYqW,UAChC,KAAK0yC,oBAAqB/tC,aAA1B,CADe;mBAINx9B,KAAS,KAAKsrE,UAAUtsE,eAAe,KAA9B;AAClBgB,cAAMhX,YAAN;AAGF,eAAKsiF,UAAU5wD,WAAW,KAA1B;AACA,eAAK4wD,UAAU3wD,aAAa,KAA5B;AAGO4wD,cAAAA,GAAL,GAAA,GAAA;AADIU,cACJ,SAAA,IAAA,SAAKV,IAALA,KAAKA,uBAAL,SAAA,SAAA,IAAKA,EAAqB/tC,aAA1B,KAAA,SAAA,SAAA,IAAA,EAA0C4L,UAA1C,KAAA,SAAA,EAAuD5vB,SAAvD,KAAA,IAAqE;AACvE,eAAK8xD,UAAU53E,OACb,KAAK43E,UAAUx6D,MAAM,EAAEm7D,IAAcf,8DAAoBA,4DACzDA,0DAFF;QAnBqB;QA0BfW,6BAA0B;AAC3B,eAAKrpD,YAAY0pD,mBAAoB,KAAKZ,cAC/C,KAAKF,0BAA0B,MAAK;AAC7B,iBAAK5oD,YAAY0pD,mBAAoB,KAAKZ,aAC/C,KAAK9oD,YAAY0pD,gBAAgB,KAAKZ,SAAtC;UAFkC,GAIpC,KAAKF,wBAAL,GACA,KAAK5oD,YAAYpjB,UAAUq+B,kBAAkB,KAAK2tC,uBAAlD;QAPgC;QAc1BU,oCAAiC;AACvC,iBAAQzwE,OAAe;AAChBi9B,cAAAA,sDAAY6zC,wBAAwB9wE,CAApC,KAA2C,KAAKgwE,uBACnD,KAAKA,qBAAqBjwE;cAAW,MAAK;AACxC,qBAAKiwE,qBAAqB;AAC1B,qBAAKe,qBAAL;cAFwC;cAGvC;YAHuB;UAFP;QADgB;QAiBlCD,OAAAA,wBAAwB9wE,GAAW;AACxC,iBACEA,EAAEuB,aACFvB,EAAExC,SAAoB2G,EAAAA,8CACrBnE,EAAExC,SAAoBgF,EAAAA,8CACU,eAA9BxC,EAAkByC;QALiB;QAUlCsuE,uBAAoB;AAC1B,cAAK,KAAKd,WAAV;AACA,gBAAI,CAAC,KAAK9oD,YAAYoW;AACpB,oBAAUz/B,MACR,yDADI;AAKR,gBAAMwkB,IAA2Bhf,EAAAA,6CAAX;AACjBgf,iBAA0B/e,EAAAA,6CAAS,IAApB;AAEpB,gBAAMytE,IAAgB9kB,8DAAYQ,oBAAoB,KAAKvlC,WAArC;iBACjBA,YAAYoW,QAAQ,KAAK0yC,SAA9B;AACA,gBAAMgB,IAAgB/kB,8DAAYQ,oBAAoB,KAAKvlC,WAArC;AAElB6pD,kBAAkBC,KACTpqF,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,KAAKnb,aACL,YACA,MACA6pD,GACAC,CALF,CADF;AAWS1tE,cAAAA,6CAAS+e,CAApB;UA1BA;QAD0B;QAkC5B6f,eAAY;AACE+tC,cAAAA;AAAZ,iBAAO,SAAKA,IAALA,KAAKA,uBAAL,SAAKA,EAAqB/tC,aAA1B;QADG;MAtTR;QAEYlF,sDAAAiF,OAAOnO,iDAASusB;AAMhBrjB,QAAAA,sDAAAkzC,SAAS;AAhD3B,UAAAr9B,2CAAA,CAAA;AAwCa7V,+CAAAA,cAAAA,EAAAA;ArGzBb,UAAMV,kDAAgBl+B,uBAAOC,OAAO,IAAd,GACTqB,8CAAY,EAAC48B,eAAAA,gDAAD;AA0dzBt2C,QAAAA,2CAAS,8BAA8B+R,wDAAvC;AA1eA,UAAA86C,mCAAA,EAgBanzC,WAAAA,4CAhBb;AAuIgBtI,uCAAAA,QAAAA;uCAoQA+mC,0BAAAA,EAAAA;AA6DAU,uCAAAA,4BAAAA,EAAAA;AA9UA1nC,uCAAAA,eAAAA;AA7FAnR,uCAAAA,WAAAA,EAAAA;AAqBAu2C,uCAAAA,gBAAAA,EAAAA;uCAsBAG,kBAAAA,EAAAA;AAySA7kC,uCAAAA,mBAAAA;AAvQA3R,uCAAAA,aAAAA;ACjGhB,UAAMk5C,4DAAmB,oBAAI7+B,OAT7BsyC,0CAAA,CAAA;AAsBgB76C,8CAAAA,OAAAA;AqGJhB,UAAY2vC;gBAAAA,GAAQ;AAClBA,UAAAA,EAAAspC,mBAAA,CAAA,IAAA;AACAtpC,UAAAA,EAAAupC,YAAA,CAAA,IAAA;AACAvpC,UAAAA,EAAAQ,YAAA,CAAA,IAAA;AACAR,UAAAA,EAAAwpC,MAAA,CAAA,IAAA;AACAxpC,UAAAA,EAAAypC,aAAA,EAAA,IAAA;AACAzpC,UAAAA,EAAA0pC,QAAA,EAAA,IAAA;AACA1pC,UAAAA,EAAA4C,QAAA,EAAA,IAAA;AACA5C,UAAAA,EAAAY,OAAA,EAAA,IAAA;AACAZ,UAAAA,EAAAc,MAAA,EAAA,IAAA;AACAd,UAAAA,EAAA2pC,QAAA,EAAA,IAAA;AACA3pC,UAAAA,EAAA4pC,YAAA,EAAA,IAAA;AACA5pC,UAAAA,EAAAC,MAAA,EAAA,IAAA;AACAD,UAAAA,EAAA6pC,QAAA,EAAA,IAAA;AACA7pC,UAAAA,EAAA8pC,UAAA,EAAA,IAAA;AACA9pC,UAAAA,EAAA+pC,YAAA,EAAA,IAAA;AACA/pC,UAAAA,EAAAgqC,MAAA,EAAA,IAAA;AACAhqC,UAAAA,EAAAiqC,OAAA,EAAA,IAAA;AACAjqC,UAAAA,EAAAryB,OAAA,EAAA,IAAA;AACAqyB,UAAAA,EAAA/wB,KAAA,EAAA,IAAA;AACA+wB,UAAAA,EAAAxxB,QAAA,EAAA,IAAA;AACAwxB,UAAAA,EAAAkW,OAAA,EAAA,IAAA;AACAlW,UAAAA,EAAAkqC,YAAA,EAAA,IAAA;AACAlqC,UAAAA,EAAAmqC,eAAA,EAAA,IAAA;AACAnqC,UAAAA,EAAAoqC,SAAA,EAAA,IAAA;AACApqC,UAAAA,EAAAG,SAAA,EAAA,IAAA;AACAH,UAAAA,EAAAqqC,OAAA,EAAA,IAAA;AACArqC,UAAAA,EAAAsqC,MAAA,EAAA,IAAA;AACAtqC,UAAAA,EAAAuqC,MAAA,EAAA,IAAA;AACAvqC,UAAAA,EAAAwqC,QAAA,EAAA,IAAA;AACAxqC,UAAAA,EAAAyqC,OAAA,EAAA,IAAA;AACAzqC,UAAAA,EAAA0qC,OAAA,EAAA,IAAA;AACA1qC,UAAAA,EAAA2qC,MAAA,EAAA,IAAA;AACA3qC,UAAAA,EAAA4qC,QAAA,EAAA,IAAA;AACA5qC,UAAAA,EAAA6qC,QAAA,EAAA,IAAA;AACA7qC,UAAAA,EAAA8qC,OAAA,EAAA,IAAA;AACA9qC,UAAAA,EAAA+qC,eAAA,EAAA,IAAA;AACA/qC,UAAAA,EAAAgrC,YAAA,EAAA,IAAA;AACAhrC,UAAAA,EAAAirC,UAAA,GAAA,IAAA;AAGAjrC,UAAAA,EAAAkrC,UAAA,GAAA,IAAA;AACAlrC,UAAAA,EAAAmrC,gBAAA,EAAA,IAAA;AACAnrC,UAAAA,EAAAorC,UAAA,EAAA,IAAA;UACAprC,EAAAqrC,IAAA,EAAA,IAAA;AACArrC,UAAAA,EAAAsrC,IAAA,EAAA,IAAA;AACAtrC,UAAAA,EAAAW,IAAA,EAAA,IAAA;AACAX,UAAAA,EAAAurC,IAAA,EAAA,IAAA;AACAvrC,UAAAA,EAAAwrC,IAAA,EAAA,IAAA;AACAxrC,UAAAA,EAAAyrC,IAAA,EAAA,IAAA;AACAzrC,UAAAA,EAAA4Q,IAAA,EAAA,IAAA;AACA5Q,UAAAA,EAAA0rC,IAAA,EAAA,IAAA;AACA1rC,UAAAA,EAAA2rC,IAAA,EAAA,IAAA;AACA3rC,UAAAA,EAAA4rC,IAAA,EAAA,IAAA;AACA5rC,UAAAA,EAAA6rC,IAAA,EAAA,IAAA;AACA7rC,UAAAA,EAAA8rC,IAAA,EAAA,IAAA;AACA9rC,UAAAA,EAAA+rC,IAAA,EAAA,IAAA;AACA/rC,UAAAA,EAAAgsC,IAAA,EAAA,IAAA;AACAhsC,UAAAA,EAAAisC,IAAA,EAAA,IAAA;AACAjsC,UAAAA,EAAAksC,IAAA,EAAA,IAAA;AACAlsC,UAAAA,EAAAmsC,IAAA,EAAA,IAAA;AACAnsC,UAAAA,EAAAosC,IAAA,EAAA,IAAA;AACApsC,UAAAA,EAAAqsC,IAAA,EAAA,IAAA;AACArsC,UAAAA,EAAAssC,IAAA,EAAA,IAAA;AACAtsC,UAAAA,EAAAusC,IAAA,EAAA,IAAA;AACAvsC,UAAAA,EAAA4B,IAAA,EAAA,IAAA;AACA5B,UAAAA,EAAAwsC,IAAA,EAAA,IAAA;AACAxsC,UAAAA,EAAAsB,IAAA,EAAA,IAAA;AACAtB,UAAAA,EAAAgD,IAAA,EAAA,IAAA;AACAhD,UAAAA,EAAAqC,IAAA,EAAA,IAAA;AACArC,UAAAA,EAAAgB,OAAA,EAAA,IAAA;AACAhB,UAAAA,EAAAysC,gBAAA,EAAA,IAAA;AACAzsC,UAAAA,EAAA0sC,eAAA,EAAA,IAAA;AACA1sC,UAAAA,EAAA2sC,WAAA,EAAA,IAAA;AACA3sC,UAAAA,EAAA4sC,UAAA,EAAA,IAAA;AACA5sC,UAAAA,EAAA6sC,UAAA,EAAA,IAAA;AACA7sC,UAAAA,EAAA8sC,YAAA,EAAA,IAAA;AACA9sC,UAAAA,EAAA+sC,WAAA,GAAA,IAAA;AACA/sC,UAAAA,EAAAgtC,WAAA,GAAA,IAAA;AACAhtC,UAAAA,EAAAitC,UAAA,GAAA,IAAA;AACAjtC,UAAAA,EAAAktC,YAAA,GAAA,IAAA;AACAltC,UAAAA,EAAAmtC,YAAA,GAAA,IAAA;AACAntC,UAAAA,EAAAotC,WAAA,GAAA,IAAA;AACAptC,UAAAA,EAAAqtC,eAAA,GAAA,IAAA;AACArtC,UAAAA,EAAAstC,WAAA,GAAA,IAAA;AACAttC,UAAAA,EAAAutC,YAAA,GAAA,IAAA;AACAvtC,UAAAA,EAAAwtC,aAAA,GAAA,IAAA;AACAxtC,UAAAA,EAAAytC,eAAA,GAAA,IAAA;AACAztC,UAAAA,EAAA0tC,KAAA,GAAA,IAAA;AACA1tC,UAAAA,EAAA2tC,KAAA,GAAA,IAAA;AACA3tC,UAAAA,EAAA4tC,KAAA,GAAA,IAAA;AACA5tC,UAAAA,EAAA6tC,KAAA,GAAA,IAAA;AACA7tC,UAAAA,EAAA8tC,KAAA,GAAA,IAAA;AACA9tC,UAAAA,EAAA+tC,KAAA,GAAA,IAAA;AACA/tC,UAAAA,EAAAguC,KAAA,GAAA,IAAA;AACAhuC,UAAAA,EAAAiuC,KAAA,GAAA,IAAA;AACAjuC,UAAAA,EAAAkuC,KAAA,GAAA,IAAA;AACAluC,UAAAA,EAAAmuC,MAAA,GAAA,IAAA;AACAnuC,UAAAA,EAAAouC,MAAA,GAAA,IAAA;AACApuC,UAAAA,EAAAquC,MAAA,GAAA,IAAA;AACAruC,UAAAA,EAAAsuC,UAAA,GAAA,IAAA;AACAtuC,UAAAA,EAAAuuC,cAAA,GAAA,IAAA;AAGAvuC,UAAAA,EAAAwuC,kBAAA,GAAA,IAAA;AACAxuC,UAAAA,EAAAyuC,iBAAA,GAAA,IAAA;AAEAzuC,UAAAA,EAAA0uC,YAAA,GAAA,IAAA;AACA1uC,UAAAA,EAAA2uC,OAAA,GAAA,IAAA;AACA3uC,UAAAA,EAAA4uC,SAAA,GAAA,IAAA;AACA5uC,UAAAA,EAAA6uC,QAAA,GAAA,IAAA;AACA7uC,UAAAA,EAAA8uC,SAAA,GAAA,IAAA;AACA9uC,UAAAA,EAAA+uC,QAAA,GAAA,IAAA;AACA/uC,UAAAA,EAAAgvC,aAAA,GAAA,IAAA;AACAhvC,UAAAA,EAAAivC,QAAA,GAAA,IAAA;AACAjvC,UAAAA,EAAAkvC,eAAA,GAAA,IAAA;UACAlvC,EAAAmvC,sBAAA,GAAA,IAAA;AACAnvC,UAAAA,EAAAovC,YAAA,GAAA,IAAA;AACApvC,UAAAA,EAAAqvC,uBAAA,GAAA,IAAA;AACArvC,UAAAA,EAAAsvC,UAAA,GAAA,IAAA;AACAtvC,UAAAA,EAAAuvC,cAAA,GAAA,IAAA;AACAvvC,UAAAA,EAAAwvC,kBAAA,EAAA,IAAA;AACAxvC,UAAAA,EAAAyvC,mBAAA,EAAA,IAAA;AACAzvC,UAAAA,EAAA0vC,UAAA,GAAA,IAAA;AAIA1vC,UAAAA,EAAA2vC,YAAA,GAAA,IAAA;AAOA3vC,UAAAA,EAAA4vC,UAAA,GAAA,IAAA;MAtIkB,GAAR5vC,mDAAAA,iDAAQ,CAAA,EAApB;UAlBAkL,uCAAA,CAAA;AAkBYlL,2CAAAA,WAAAA;ApGlBZ,UAAAkL,wCAAA,CAAA;AA6HgBr6C,4CAAAA,MAAAA;AA1FAN,4CAAAA,QAAAA;AAwDAI,4CAAAA,OAAAA;AAiBAC,4CAAAA,aAAAA;AA/BAF,4CAAAA,SAAAA;4CAdAD,SAAAA;AAdAD,4CAAAA,SAAAA;AA/BAF,4CAAAA,QAAAA;AqGlBhB,UAAA46C,8BAAA,CAAA;AAsCE9jC,kCAAAA,aAAAA;AAKA44B,kCAAAA,WAAAA;AAKAh4B,kCAAAA,OAAAA;AACAnB,kCAAAA,OAAAA;AAGAirB,kCAAAA,MAAAA;AAlBA+9C,kCAAAA,OAAAA;kCACAC,QAAAA;AACAC,kCAAAA,gBAAAA;AACAxpD,kCAAAA,SAAAA;AAEAypD,kCAAAA,cAAAA;AACAzkE,kCAAAA,MAAAA;AACA0kE,kCAAAA,aAAAA;AACAC,kCAAAA,cAAAA;kCAEAC,OAAAA;AAEAnsD,kCAAAA,SAAAA;AACAosD,kCAAAA,UAAAA;AAGAC,kCAAAA,SAAAA;AACAtrE,kCAAAA,QAAAA;AAEAurE,kCAAAA,UAAAA;AACAC,kCAAAA,WAAAA;kCACAtqC,UAAAA;AACAuqC,kCAAAA,YAAAA;AACA5iD,kCAAAA,MAAAA;ApGzDF,UAAAsd,uCAAA,CAAA;AAkBgB7sD,2CAAAA,WAAAA;AAYAE,2CAAAA,aAAAA;AqGbV,UAAOkyF,wDAAP,cAA0B1O,6CAA1B;QAGJrlD,YACUjX,GACQtJ,GACN6lE,GACAC,GAAgB;AAE1B,gBAAM9lE,GAAW6lE,GAAQC,CAAzB;AALQ,eAAAx8D,OAAAA;AACQ,eAAAtJ,YAAAA;AACN,eAAA6lE,SAAAA;AACA,eAAAC,YAAAA;AAGV,eAAKyO,YAAY,KAAKC,YAAYlrE,GAAM,KAAKi9D,gBAA5B;AACjB,eAAKwE,iBAAL;QAJ0B;QAQ5B1wD,UAAO;AACL,iBAAO,KAAK/Q;QADP;QAKP0R,QAAQ1R,GAAY;AAClB,eAAKA,OAAOA;AACR3jB,sDAAW,KAAK4uF,SAApB;AACA,eAAKA,YAAY,KAAKC,YAAYlrE,GAAM,KAAKi9D,gBAA5B;AACjB,eAAKwE,iBAAL;QAJkB;QAWZyJ,YAAYlrE,GAAcwC,GAAsB;AAChDyoE,cAAY,KAAKE,gBAAgB3oE,CAArB;AACZ4oE,cAAQ,KAAKC,YAAYJ,GAAWjrE,CAA5B;AACV,eAAKtJ,UAAU0R,OACjB,KAAKkjE,gBAAgBL,EAAUp0B,QAAV,EAAoB99C,OAAOqyE,CAAhD;AACF,iBAAOH;QAL+C;QAShDE,gBAAgB3oE,GAAsB;AAC5C,iBAAWxmB,kDACTqwC,qCAAIqf,MACJ,EACE,SAAS,wDACT,GAAK4wB,6CAAOU,aAFd,GAIAx6D,CANK;QADqC;QAYtC6oE,YAAYp0E,GAAwB+I,GAAY;AACtD,iBAAOA,EAAKvB,MAAM,IAAX,EAAiBrL,IAAKlI,OAAQ;AACnC,kBAAMqgF,IAAYvvF;cAChBqwC,qCAAIsf;cACJ,EAAC,IAAM,OAAO,GAAK2wB,6CAAOU,aAA1B;cACA/lE;YAHY;AAKR6wB,gBAAWnqB,SAASG,eAAe5S,CAAxB;AACjBqgF,cAAMxtE,YAAY+pB,CAAlB;AACA,mBAAOyjD;UAR4B,CAA9B;QAD+C;QAchDD,gBAAgBE,GAAkBJ,GAAwB;AAChE,qBAAW7qE,KAAQ6qE;AACjB7qE,cAAKpH,aAAa,eAAe,KAAjC,GACAoH,EAAKpH,aAAa,KAAK,GAAGqyE,IAAWlP,6CAAOU,YAArB,EAAvB;QAH8D;QAQ1DyE,mBAAgB;AACtB,gBAAMt4C,IAAO,KAAK8hD,UAAUp0B,QAAf;AACb,eAAKhlC;YACH,IAAIzQ,uCACF+nB,EAAKpwB,QAA8B,IAAtBujE,6CAAOU,cACpB7zC,EAAKlwB,SAA+B,IAAtBqjE,6CAAOU,YAFvB;YAIA;UALF;QAFsB;MA1EpB,GAjBNv3B,4CAAA,CAAA;AAiBaulC,gDAAAA,aAAAA;ACIP,UAAOS,kEAAP,cAA+BnP,6CAA/B;QAkDJrlD,YACkBvgB,GACN6lE,GACAC,GAAgB;AAE1B,gBAAM9lE,GAAW6lE,GAAQC,CAAzB;AAJgB,eAAA9lE,YAAAA;AACN,eAAA6lE,SAAAA;AACA,eAAAC,YAAAA;AAjCJ,eAAAhnB,4BANA,KAAAC,0BAAqD;AASrD,eAAAL,sBAAsC,CAAA;AAGtC,eAAAC,sBAAsC,CAAA;AAGtC,eAAAr1C,OAAO;AAGE,eAAA0rE,eAAe,IAAItqE,uCAClC,MAAMk7D,6CAAOwE,eACb,KAAKxE,6CAAOwE,aAFkB;eAMfrD,WAAW,IAAIr8D,uCAC9B,KAAKk7D,6CAAOwE,eACZ,KAAKxE,6CAAOwE,aAFc;AAkBtB7kF,oDAAS,KAAKy5D,SAAS,wBAA3B;AACA,WAAC,EAAC,WAAW,KAAKi2B,WAAW,UAAU,KAAKt1B,SAA3C,IAAuD,KAAKu1B,aAC3D,KAAK3O,gBADiD;AAGxD,eAAK4O,cAAc,KAAKr1B,mBAAmB,KAAKd,SAASh/C,CAAtC;AACnB,eAAKmb,QAAQ,KAAK65D,cAAc,IAAhC;QAR0B;QAY5B36D,UAAO;AACL,iBAAO,KAAK/Q;QADP;QAKP0R,QAAQ1R,GAAY;AAClB,eAAKA,OAAOA;AACZ,eAAKq2C,SAASn5C,QAAQ8C;AACtB,eAAK22C,aAAL;QAHkB;QAOpBqC,sBAAsBV,GAAoB;AACxC,eAAKlD,oBAAoBxiD,KAAK0lD,CAA9B;QADwC;QAK1CD,sBAAsBC,GAAoB;AACxC,eAAKjD,oBAAoBziD,KAAK0lD,CAA9B;QADwC;QAKlCszB,aAAappE,GAAsB;AAInCmpE,cAAgB3vF,kDACpBqwC,qCAAI6e,eACJ,EACE,GAAKoxB,6CAAOU,cACZ,GAAKV,6CAAOU,aAFd,GAIAx6D,CANgB;AASlB,gBAAMrC,IAAOxC,SAASU,gBAAoB2gC,0CAAS,MAAtC;AACb7+B,YAAKhH,aAAa,SAAa6lC,wCAA/B;YACKzgC,YAAY;AAEjB,gBAAM83C,IAAW14C,SAASU,gBACpB2gC,0CACJ,UAFe;AAIjBqX,YAAS93C,YAAY;AACrB83C,YAASl9C,aAAa,OAAO,KAAKzC,UAAU0R,MAAM,QAAQ,KAA1D;AAEAjI,YAAKpC,YAAYs4C,CAAjB;AACAs1B,YAAU5tE,YAAYoC,CAAtB;AAEA,eAAK2rE,mBAAmBz1B,CAAxB;AACA3jD,qBAAW,MAAK;AACd2jD,cAAShyB,MAAT;UADc,GAEb,CAFH;AAIA,iBAAO,EAACsnD,WAAAA,GAAWt1B,UAAAA,EAAZ;QAhCkC;QAoCnCy1B,mBAAmBz1B,GAA6B;AAExC96D,gEAAgB86D,GAAU,SAAS,MAAO1jD,OAAY;AAClEA,cAAE6yB,gBAAF;UADkE,CAApE;AAIcjqC;YACZ86D;YACA;YACA;YACA,KAAK01B;YACL;UALF;AAOcxwF,gEAAgB86D,GAAU,UAAU,MAAM,KAAKM,YAA7D;QAbsD;QAiBhDH,mBACNh0C,GACA9L,GAAuB;AAEjB6/C,cAAmBv6D,kDACvBqwC,qCAAI+e,OACJ,EACE,SAAS,uBACT,MAAQ,GAAG10C,EAAU/E,QAAQ4L,WAArB,oBAFV,GAIAiF,CANmB;AASPjnB,gEACZg7D,GACA,eACA,MACA,KAAKK,mBAJP;AAOA,iBAAOL;QAlBgB;QA6BzB1kC,QAAQpK,GAAY21D,IAAW,OAAK;AAClC31D,YAAK1O,QAAQsK,KAAKE,IAAIkE,EAAK1O,OAAO,KAAK0kE,SAAS1kE,KAAnC;AACb0O,YAAKxO,SAASoK,KAAKE,IAAIkE,EAAKxO,QAAQ,KAAKwkE,SAASxkE,MAApC;AAEd,gBAAM+yE,IAAmBvkE,EAAK1O,QAAQujE,6CAAOwE,eACvCmL,IAAoBxkE,EAAKxO,SAASqjE,6CAAOwE;AAC/C,eAAK6K,UAAUxyE,aAAa,SAAS,GAAG6yE,CAAH,EAArC;AACA,eAAKL,UAAUxyE,aAAa,UAAU,GAAG8yE,CAAH,EAAtC;AAEA,eAAKJ,YAAY1yE,aAAa,KAAK,GAAG8yE,CAAH,EAAnC;AACI,eAAKv1E,UAAU0R,MACjB,KAAKyjE,YAAY1yE,aAAa,KAAK,GAAG,CAACmjE,6CAAOwE,aAAX,EAAnC,IAEA,KAAK+K,YAAY1yE,aAAa,KAAK,GAAG6yE,CAAH,EAAnC;AAGF,gBAAMn6D,QAAQpK,GAAM21D,CAApB;AACA,eAAKxlB,aAAL;QAjBkC;QAqBpC96D,UAAO;AAEL,iBAAO,MAAMA,QAAN;QAFF;QAMC85D,oBAAoBjkD,GAAe;AACzC,eAAK6lD,aAAL;8DACgC7lD,CAA5B,MAKJ,KAAK+D,UAAU82B,UACb76B,GACA,IAAIgP,mDACF,KAAKjL,UAAU0R,MAAM,CAAC,KAAKtrB,QAAL,EAAeic,QAAQ,KAAKjc,QAAL,EAAeic,OAC5D,KAAKjc,QAAL,EAAemc,MAFjB,CAFF,GAQA,KAAKw8C,0BAAwCl6D,sDAC3CoiB,UACA,aACA,MACA,KAAK86C,iBAJwB,GAM/B,KAAKjD,4BAA0Cj6D,sDAC7CoiB,UACA,eACA,MACA,KAAK+6C,mBAJ0B,GAMjC,KAAKhiD,UAAUxG,UAAf;YAxBIs1B,gBAAF;QAHuC;QAiCnCizB,kBAAkBz5B,GAAgB;AAClC7jC,4DAAN;AACI,eAAKs6D,4BACOh6D,6CAAO,KAAKg6D,uBAA1B,GACA,KAAKA,0BAA0B;AAE7B,eAAKD,8BACO/5D,6CAAO,KAAK+5D,yBAA1B,GACA,KAAKA,4BAA4B;QARK;QAalCkD,oBAAoB/lD,GAAe;AACnCgmD,cAAQ,KAAKjiD,UAAUkiD,SAASjmD,CAAxB;AACd,eAAKkf,QACH,IAAIzQ,uCAAK,KAAK1K,UAAU0R,MAAM,CAACuwC,EAAMt8C,IAAIs8C,EAAMt8C,GAAGs8C,EAAMp8C,CAAxD,GACA,KAFF;AAIA,eAAKq7C,aAAL;QANyC;QAYnCm0B,cAAW;AACb,eAAKvzB,aAAL,KAGF,KAAKnC,SAAShyB,MAAd;QAJe;QASXsyB,eAAY;AAClB,eAAK32C,OAAO,KAAKq2C,SAASn5C;AAC1B,qBAAWo7C,KAAY,KAAKlD;AAC1BkD,cAAA;QAHgB;QAQZV,eAAY;AAClB,qBAAWU,KAAY,KAAKjD;AAC1BiD,cAAA;QAFgB;MAjRhB;AAwRF1/D,0CAAS,gPAAb;UA7SA6sD,iDAAA,CAAA;AAqBagmC,qDAAAA,kBAAAA;ACMb,UAAMlJ,iDAAO,IAGP2J,iEAAuB,KAGvBC,kEAAwB,IAKjBvoC,wDAAP,cAA2Bg1B,uCAA3B;QA+BJ3hD,YAA+B6C,GAAkB;AAC/C,gBAAMA,CAAN;AAD6B,eAAAA,cAAAA;AAjBvB,eAAAsyD,aAHA,KAAAC,kBAA0C;AAM1C,eAAArsE,OAAO;AAGP,eAAAssE,aAAa,IAAIlrE;YAAK8qE;YAAsBC;UAA/B;AASb,eAAAI,kBAAkB;QAEuB;QAIxCr4D,UAAO;AACd,iBAAO0vB,sDAAY/O;QADL;QAIPiC,SAASiiC,GAA8C;AAC1D,eAAKrjB,YAET,MAAM5e,SAASiiC,CAAf,GAGI/8E,kDACFqwC,qCAAIC,QACJ,EAAC,SAAS,oBAAoB,GAAK,KAAK,IAAM,KAAK,IAAM,IAAzD,GACA,KAAKopB,OAHP,GAOI15D;YACFqwC,qCAAIif;YACJ,EACE,SAAS,qBACT,GACE,uKAHJ;YAOA,KAAKoK;UATP,GAYI15D,kDACFqwC,qCAAIof,MACJ,EACE,SAAS,qBACT,GAAK,OACL,GAAK,SACL,QAAU,KACV,OAAS,IALX,GAOA,KAAKiK,OATP,GAWIz5D,0CAAS,KAAKy5D,SAAU,sBAA5B;QApC8D;QAuCvDpwD,UAAO;AACd,gBAAMA,QAAN;AACK+mF,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,oBAAAA,EAAiB/mF,QAAtB;AACK8mF,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAY9mF,QAAjB;QAHc;QAMPyxC,YAAS;AAChB,iBAAO6M,sDAAYk/B;QADH;QAIThmF,UAAO;AACd,iBAAO,IAAIskB;YAAKmhE;YAAMA;UAAf;QADO;QAIPvrC,cAAW;AAClB,gBAAMA,YAAN;AACA,gBAAMlW,IAAU,KAAKhH,YAAyBxa,MAAM27D;AAC/CoR,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,oBAAAA,EAAiBjpF,UAAU09B,CAAhC;AACKsrD,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAYhpF,UAAU09B,CAA3B;QAJkB;QAWLoW,iBAAc;AAAA,gBAAA,IAAA,MAAA,IAAA,MAC3B,MAAMA;AADqB,iBAAA,QAAA,qCAAA,aAAA;AACrBA,cAAAA,EAAAA,KAAAA,CAAN;AACI,cAAKpf,gBAAL,MAEF,MAAM,EAAKC,iBAAiB,KAAtB,GACN,MAAM,EAAKA,iBAAiB,IAAtB;UALmB,CAAA;QAAA;QASpBH,iBAAiB/H,GAAuB;AAC/C,gBAAM+H,iBAAiB/H,CAAvB;AACM28D,cAAiB,KAAKzJ,kBAAL;cAClBsJ;AAAL,mBAAKA,IAALA,KAAKA,oBAAAA,EAAiBlP,kBAAkBqP,CAAxC;AACKJ,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAYjP,kBAAkBqP,CAAnC;QAJ+C;QAQjD96D,QAAQ1R,GAAY;AAClB,gBAAM20C,IAAU,KAAK30C;AACVxmB,mDACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,KAAKnb,aACL,WACA,MACA66B,GACA30C,CALF,CADF;AASA,eAAKA,OAAOA;AACPqsE,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,oBAAAA,EAAiB36D,QAAQ,KAAK1R,IAAnC;AACKosE,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAY16D,QAAQ,KAAK1R,IAA9B;QAbkB;QAiBpB+Q,UAAO;AACL,iBAAO,KAAK/Q;QADP;QAQPwqB,cAAc/iB,GAAU;AACtB,eAAK6kE,aAAa7kE;AACb4kE,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,oBAAAA,EAAiBx6D,QAAQ,KAAKy6D,YAAY,IAA/C;QAFsB;QAMxB1lD,gBAAa;AACX,iBAAO,KAAK0lD;QADD;QAQbp5D,YAAS;AACP,iBAAI,KAAKlT,OACA,EACL,MAAQ,KAAKA,MACb,QAAU,KAAK8X,gBAAL,GACV,QAAU,KAAKw0D,WAAWrzE,QAC1B,OAAS,KAAKqzE,WAAWvzE,MAJpB,IAOF;QATA;QAaToa,UAAUhd,GAAmB;AACf,cAAA;AAAZ,eAAK6J,OAAO,SAAA,IAAA7J,EAAA,QAAA,IAAiB;AAE3B,cAAA,GACA;AAFF,eAAKm2E,aAAa,IAAIlrE,uCACpB,SAAA,IAAAjL,EAAA,SAAA,IAAkB+1E,gEAClB,SAAA,IAAA/1E,EAAA,UAAA,IAAmBg2E,+DAFH;cAIK;AAAvB,eAAKI,kBAAkB,SAAA,IAAAp2E,EAAA,UAAA,IAAmB;AAC1C,eAAK4hB,iBAAiB,KAAKw0D,eAA3B;QAP2B;QAUpBj1C,UAAO;AACd,gBAAMA,QAAN;AACA,eAAKvf,iBAAiB,CAAC,KAAKD,gBAAL,CAAvB;QAFc;QAKPqsC,sBAAmB;AAC1B,iBAAO;QADmB;QAQ5BxN,eAAY;AACV,cAAK,KAAK01B,iBAAV;AAEA,gBAAMz3B,IAAU,KAAKy3B,gBAAgBt7D,QAArB;AACZ,iBAAK/Q,SAAS40C,MAEPp7D,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,KAAKnb,aACL,WACA,MACA,KAAK9Z,MACL40C,CALF,CADF,GASA,KAAK50C,OAAO40C;UAdZ;QADU;QAsBZgD,eAAY;AACN,eAAKy0B,oBACP,KAAKC,aAAa,KAAKD,gBAAgBvvF,QAArB;QAFV;QAMZg7B,kBAAe;AACb,iBAAO,KAAKy0D;QADC;QAITx0D,iBAAiBsG,GAAgB;AAAA,gBAAA,IAAA;AAAA,iBAAA,QAAA,qCAAA,aAAA;AACjC,cAAKkuD,oBAAoBluD,MAC7B,EAAKkuD,kBAAkBluD,GAEvB,MAAuB99B,6DAAjB,GAGcw0B,CAAjB,EAAK+E,YAAY/E,YAClB,EAAK+E,YAAYqZ,cACjB,EAAKrZ,YAAYvG,kBAAjB,MAIE8K,KACE,EAAKvE,YAAYgqB,WAAjB,IACF,EAAK2oC,mBAAL,IAEA,EAAKC,sBAAL,GAEF,EAAK11C,YAAL,KAEA,EAAK21C,WAAL,GAGSnzF,yCACT,KAAgBS,wCAAe2b,+CAA1B,GACH,EAAKkkB,aACLuE,GACA,SAHF,CADF;UAxBqC,CAAA;QAAA;QAqC/BouD,qBAAkB;AACxB,eAAKJ,kBAAkB,IAAIZ,gEACzB,KAAK3xD,YAAYpjB,WACjB,KAAKqsE,kBAAL,GACA,KAAKE,mBAAL,CAHqB;AAKvB,eAAKoJ,gBAAgB36D,QAAQ,KAAKX,QAAL,CAA7B;AACA,eAAKs7D,gBAAgBx6D,QAAQ,KAAKy6D,YAAY,IAA9C;AACA,eAAKD,gBAAgBrzB,sBAAsB,MAAM,KAAKrC,aAAL,CAAjD;eACK01B,gBAAgBh0B,sBAAsB,MAAM,KAAKT,aAAL,CAAjD;QATwB;QAalB80B,wBAAqB;AAC3B,eAAKN,aAAa,IAAIpB,sDACpB,KAAKj6D,QAAL,GACA,KAAK+I,YAAYpjB,WACjB,KAAKqsE,kBAAL,GACA,KAAKE,mBAAL,CAJgB;QADS;QAUrB0J,aAAU;AACXN,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,oBAAAA,EAAiB/mF,QAAtB;AACA,eAAK+mF,kBAAkB;AAClBD,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAY9mF,QAAjB;AACA,eAAK8mF,aAAa;QAJF;QAWVrJ,oBAAiB;AACvB,gBAAMO,IAAUf,iDAAO;AACvB,iBAAO5gE,mDAAW8Q;YAChB,KAAKqmD;YACL,IAAIn3D,mDAAW2hE,GAASA,CAAxB;UAFK;QAFgB;QAYjBL,qBAAkB;AACxB,gBAAM95C,IAAQ,KAAKrP,YAAyBR,WAA9B,EAA2Cu9B,QAA3C;AACd,iBAAO,IAAIt0C,uCAAK4mB,EAAK5sB,GAAG4sB,EAAK5sB,IAAI4sB,EAAKlwB,QAAQkwB,EAAK9sB,GAAG8sB,EAAK9sB,IAAI8sB,EAAKpwB,KAA7D;QAFiB;MAtTtB;AAEY6qC,4DAAA/O,OAAOnO,iDAASC;AAMhBid,4DAAAk/B,SAAS;qDAmUTl/B,sDAAY/O,MAAM+O,qDAApC;AAjXA,UAAA6B,2CAAA,CAAA;AAsCa7B,+CAAAA,cAAAA;AChBb,UAAM2+B,iDAAO,IAQAqK,wDAAP,cAA2BhU,uCAA3B;QAiBJ3hD,YAA+B6C,GAAqB;AAClD,gBAAMA,CAAN;AAD6B,eAAAA,cAAAA;AANvB,eAAA+yD,UAA+B,oBAAI3jC;AAGnC,eAAAkjC,aAAgC;QAGY;QAI3Cl4D,UAAO;AACd,iBAAO04D,sDAAY/3C;QADL;QAIPiC,SAASiiC,GAA8C;AAC1D,eAAKrjB,YAET,MAAM5e,SAASiiC,CAAf,GAGI/8E;YACFqwC,qCAAIif;YACJ,EACE,SAAS,oBACT,GAAK,+DAFP;YAIA,KAAKoK;UANP,GAUI15D,kDACFqwC,qCAAIif,MACJ,EACE,SAAS,qBACT,GAAK,+CAFP,GAIA,KAAKoK,OANP,GASI15D,kDACFqwC,qCAAIof,MACJ,EACE,SAAS,qBACT,GAAK,KACL,GAAK,MACL,QAAU,KACV,OAAS,IALX,GAOA,KAAKiK,OATP,GAWIz5D,0CAAS,KAAKy5D,SAAU,sBAA5B;QApC8D;QAuCvDpwD,UAAO;AACd,gBAAMA,QAAN;AACK8mF,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAY9mF,QAAjB;QAFc;QAKPyxC,YAAS;AAChB,iBAAO61C,sDAAY9J;QADH;QAIThmF,UAAO;AACd,iBAAO,IAAIskB,uCAAKmhE,gDAAMA,8CAAf;QADO;QAIPvrC,cAAW;AAClB,gBAAMA,YAAN;AACKo1C,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAYhpF,UAAU,KAAK02B,YAAYxa,MAAM27D,aAAlD;QAFkB;QAKX9jC,kBAAe;QAAA;QAMfC,uBAAoB;AAC3B,iBAAO;QADoB;QAKpBxf,iBAAiB/H,GAAuB;AAC/C,gBAAM+H,iBAAiB/H,CAAvB;AACKu8D,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAYjP,kBAAkB,KAAK4F,kBAAL,CAAnC;QAF+C;QAYjD+J,WAAW9sE,GAAcxJ,GAAU;AACjC,cAAI,KAAKq2E,QAAQ5yF,IAAIuc,CAAjB,MAAyBwJ;AAAM,mBAAO;AAEtCA,cACF,KAAK6sE,QAAQr9D,IAAIhZ,GAAIwJ,CAArB,IAEA,KAAK6sE,QAAQ18D,OAAO3Z,CAApB;AAGG41E,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,eAAAA,EAAY16D,QAAQ,KAAKX,QAAL,CAAzB;AACA,iBAAO;QAV0B;QAkBnCA,UAAO;AACL,iBAAO,CAAC,GAAG,KAAK87D,QAAQ/hE,OAAb,CAAJ,EAA2BzW,KAAK,IAAhC;QADF;QAKEijC,UAAO;AACd,gBAAMA,QAAN;AACA,eAAKvf,iBAAiB,CAAC,KAAKD,gBAAL,CAAvB;QAFc;QAKPqsC,sBAAmB;AAC1B,iBAAO;QADmB;QAI5BrsC,kBAAe;AACb,iBAAO,CAAC,CAAC,KAAKs0D;QADD;QAITr0D,iBAAiBsG,GAAgB;AAAA,gBAAA,IAAA;AAAA,iBAAA,QAAA,qCAAA,aAAA;AACrC,gBAAI,EAAKvG,gBAAL,MAA2BuG,GAA/B;AAEA,oBAAuB99B,6DAAjB;kBAEF89B;AACF,kBAAK+tD,aAAa,IAAIpB,sDACpB,EAAKj6D,QAAL,GACA,EAAK+I,YAAYpjB,WACjB,EAAKqsE,kBAAL,GACA,EAAKE,mBAAL,CAJgB,GAMlB,EAAKjsC,YAAL;mBACK;AACAo1C,oBAAAA;AAAL,yBAAKA,IAALA,EAAKA,eAAAA,EAAY9mF,QAAjB;AACA,kBAAK8mF,aAAa;cAFb;AAKI5yF,uDACT,KAAgBS,wCAAe2b,+CAA1B,GACH,EAAKkkB,aACLuE,GACA,SAHF,CADF;YAjBA;UADqC,CAAA;QAAA;QA+B/B0kD,oBAAiB;AACvB,gBAAMO,IAAUf,iDAAO;AACvB,iBAAO5gE,mDAAW8Q;YAChB,KAAKqmD;YACL,IAAIn3D,mDAAW2hE,GAASA,CAAxB;UAFK;QAFgB;QAYjBL,qBAAkB;AACxB,gBAAM95C,IAAO,KAAKrP,YAAYR,WAAjB,EAA8Bu9B,QAA9B;AACb,iBAAO,IAAIt0C,uCAAK4mB,EAAK5sB,GAAG4sB,EAAK5sB,IAAI4sB,EAAKlwB,QAAQkwB,EAAK9sB,GAAG8sB,EAAK9sB,IAAI8sB,EAAKpwB,KAA7D;QAFiB;MAxLtB;AAEY6zE,4DAAA/3C,OAAOnO,iDAASwsB;AAMhB05B,4DAAA9J,SAAS;AAtC3B,UAAAr9B,2CAAA,CAAA;AA8BamnC,+CAAAA,cAAAA;ACnBP,UAAOG,4DAAP,cAAiCt8E,MAAjC;QAIJwmB,YAAmBjD,GAAW;AAC5B,gBACE,mCAAmCA,EAAKE,QAAL,CAAnC,kGADF;AADiB,eAAAF,OAAAA;QAAW;MAJ1B,GAXNyxB,yCAAA,CAAA;AAWasnC,6CAAAA,oBAAAA;ACXb,UAAAtnC,8BAAA,CAAA;AAgBE7B,kCAAAA,cAAAA;AADAg1B,kCAAAA,OAAAA;AAKAlyC,kCAAAA,WAAAA;AAFAkJ,kCAAAA,cAAAA,EAAAA;AACAg9C,kCAAAA,cAAAA;kCAEAI,aAAAA;AACA/yC,kCAAAA,WAAAA;AzG0BWia,UAAAA,iDAhDbzO;AAgDayO,wDAAgB;AAKhB1f,QAAAA,gDAAc;AArD3BiR,yCAAA,EAgDayO,eAAAA,iDAKA1f,aAAAA,EAAAA,8CArDb;AAsfEkkC,uCAAAA,yBAAAA;uCAvbcrtE,gBAAAA;AA0DA6nC,uCAAAA,gBAAAA,EAAAA;AA+GA3zC,uCAAAA,iBAAAA;AA+KAqM,uCAAAA,aAAAA;AAqEAiqC,uCAAAA,gBAAAA,EAAAA;uCAvTArqC,aAAAA;AAoVd/B,uCAAAA,mBAAAA;AArEc2rC,uCAAAA,gBAAAA,EAAAA;AAjFA1pC,uCAAAA,sBAAAA;AA7JA+nC,uCAAAA,SAAAA,EAAAA;A0GxLhB,UAAMw5C,oEAAN,MAAA;QAAAh2D,cAAA;AAGE,eAAAi2D,OAAO;AACP,eAAA/7E,QAAQ;AACR,eAAAg8E,MAAM;AACN,eAAAj2D,OAAO;AACP,eAAAk2D,SAAS;AACT,eAAAC,qBAAqB;AACrB,eAAAC,gBAAgB;AAChB,eAAAC,uBAAuB;AACvB,eAAAtoC,QAAQ;AACR,eAAAuoC,eAAe;AACf,eAAAC,kBAAkB;AAClB,eAAAC,aAAa;AACb,eAAAC,sBAAsB;AACtB,eAAAC,kBAAkB;AAClB,eAAAC,oBAAoB;AACpB,eAAAC,SAAS;AACT,eAAAC,qBAAqB;AACrB,eAAAC,oBAAoB;AACpB,eAAAC,sBAAsB;eACtBC,qBAAqB;AACrB,eAAAC,cAAc;AACd,eAAA9yB,MAAM;AACN,eAAA+yB,UAAU;AACV,eAAAC,aAAa;AACb,eAAAC,YAAY;AAKZ,eAAAC,cAAc,KAAKR,qBAAqB,KAAKC;AAK7C,eAAAQ,eAAe,KAAKP,sBAAsB,KAAKC;AAQ/C,eAAAO,iBAAiB;QA7CnB;QAqDEv6D,QAAQ/jB,GAAY;AACba,iBAAO2xB,UAAU+rD,eAAevzE,KAAK,MAAMhL,CAA3C,MACH,KAAKA,CAAL,IAAa,KAAKs+E,gBAClB,KAAKA,mBAAmB;AAE1B,iBAAO,KAAKt+E,CAAL;QALW;QAcpBw+E,QAAQ10E,GAAgB;AACtB,iBAAOA,EAAK9J,OAAO,KAAKgB;QADF;QAUxBy9E,MAAM30E,GAAgB;AACpB,iBAAOA,EAAK9J,OAAO,KAAKg9E;QADJ;QAUtB/gF,OAAO6N,GAAgB;AACrB,iBAAOA,EAAK9J,OAAO,KAAK+mB;QADH;QAUvB23D,SAAS50E,GAAsB;AAC7B,iBAAOA,EAAK9J,OAAO,KAAKi9E;QADK;QAU/B0B,cAAc70E,GAAgB;AAC5B,iBAAOA,EAAK9J,OAAO,KAAKm9E;QADI;QAU9ByB,QAAQ90E,GAAgB;AACtB,iBAAOA,EAAK9J,OAAO,KAAK80C;QADF;QAUxB+pC,gBAAgB/0E,GAAgB;AAC9B,iBAAOA,EAAK9J,OAAO,KAAKo9E;QADM;QAUhC0B,cAAch1E,GAAgB;AAC5B,iBAAOA,EAAK9J,OAAO,KAAKq9E;QADI;QAU9B0B,iBAAiBj1E,GAAgB;AAC/B,iBAAOA,EAAK9J,OAAO,KAAKs9E;QADO;QAUjC0B,qBAAqBl1E,GAAgB;AACnC,iBAAOA,EAAK9J,OAAO,KAAKw9E;QADW;QAUrCyB,iBAAiBn1E,GAAgB;AAC/B,iBAAOA,EAAK9J,OAAO,KAAKy9E;QADO;QAYjCyB,2BAA2Bp1E,GAAgB;AACzC,iBAAOA,EAAK9J,QAAQ,KAAKw9E,sBAAsB,KAAKC;QADX;QAU3C0B,oBAAoBr1E,GAAgB;AAClC,iBAAOA,EAAK9J,OAAO,KAAK69E;QADU;QAUpCuB,qBAAqBt1E,GAAgB;AACnC,iBAAOA,EAAK9J,OAAO,KAAK+9E;QADW;QAUrCsB,mBAAmBv1E,GAAgB;AACjC,iBAAOA,EAAK9J,OAAO,KAAK49E;QADS;QAUnC0B,oBAAoBx1E,GAAgB;AAClC,iBAAOA,EAAK9J,OAAO,KAAK89E;QADU;QAUpCyB,SAASz1E,GAAgB;AACvB,iBAAOA,EAAK9J,OAAO,KAAK29E;QADD;QAUzB6B,aAAa11E,GAAgB;AAC3B,iBAAOA,EAAK9J,OAAO,KAAKg+E;QADG;QAU7ByB,MAAMC,GAAQ;AACZ,iBAAOA,EAAI1/E,OAAO,KAAKkrD;QADX;QAUdy0B,mBAAmBD,GAAQ;AACzB,iBAAOA,EAAI1/E,OAAO,KAAKk9E;QADE;QAU3B0C,SAASF,GAAQ;AACf,iBAAOA,EAAI1/E,OAAO,KAAKi+E;QADR;QAUjB4B,YAAYH,GAAQ;AAClB,iBAAOA,EAAI1/E,OAAO,KAAKk+E;QADL;QAUpB4B,iBAAiBJ,GAAQ;AACvB,iBAAOA,EAAI1/E,QAAQ,KAAKi+E,UAAU,KAAKC;QADhB;QAUzB6B,WAAWL,GAAQ;AACjB,iBAAOA,EAAI1/E,OAAO,KAAKm+E;QADN;MA3SrB,GAgTa6B,2DAAQ,IAAIlD,qEA9TzBxnC,oDAAA,EA8Ta0qC,OAAAA,yDA9Tb;ACiBM,UAAOC,+DAAP,MAAA;QAgBJn5D,YAAY+tC,GAA2B;AATvC,eAAAqrB,aAFA,KAAAC,OAFA,KAAAr3E,SAFA,KAAAF,QAAQ;AAgBN,eAAK0oD,aAAauD;AAElB,eAAK70D,OAAOggF,yDAAMjD;AAElB,eAAKqD,cAAc,KAAK9uB,WAAW+uB;QALE;MAhBnC,GAjBN/qC,mDAAA,CAAA;AAiBa2qC,uDAAAA,aAAAA;ACEP,UAAOK,uDAAP,MAAA;QA2FJx5D,YAAY+tC,GAA2B;AArFvC,eAAA0rB,WAAyB,CAAA;AAwCzB,eAAAJ,OANA,KAAA7lB,OANA,KAAAkmB,2BANA,KAAAC,WANA,KAAAC,YALA,KAAA93E,QANA,KAAAE,SAAS;AA6CT,eAAA63E,eALA,KAAAC,mBAAmB;AAYnB,eAAAC,gBAAgB;AAehB,eAAAC,gBALA,KAAAC,gBALA,KAAAC,iBAAiB;AAgBjB,eAAAC,QAAuB;AASrB,eAAK3vB,aAAauD;AAGlB,eAAK70D,OAAOggF,yDAAM90B;AAElB,eAAKk1B,cAAc,KAAK9uB,WAAW+uB;QAPE;QAevCa,eAAY;AAEV,mBAASv+E,IAAI,KAAK49E,SAASl+E,SAAS,GAAQ,KAALM,GAAQA,KAAK;AAClD,kBAAMmH,IAAO,KAAKy2E,SAAS59E,CAAd;AACb,gBAAIq9E,yDAAMpB,QAAQ90E,CAAd;AACF,qBAAOA;UAHyC;AAMpD,iBAAO;QARG;QAcZq3E,UAAO;AACL,gBAAM7gF,MAAM,2CAAN;QADD;QASP8gF,uBAAoB;AAClB,iBAAO;QADW;QASpBC,qBAAkB;AAChB,iBAAO;QADS;QASlBC,iBAAc;AACZ,mBAAS3+E,IAAI,GAAGA,IAAI,KAAK49E,SAASl+E,QAAQM,KAAK;AAC7C,kBAAMmH,IAAO,KAAKy2E,SAAS59E,CAAd;AACb,gBAAIq9E,yDAAMtB,SAAS50E,CAAf;AACF,qBAAOA;UAHoC;AAM/C,iBAAO;QAPK;QAedy3E,gBAAa;AACX,mBAAS5+E,IAAI,KAAK49E,SAASl+E,SAAS,GAAQ,KAALM,GAAQA,KAAK;AAClD,kBAAMmH,IAAO,KAAKy2E,SAAS59E,CAAd;AACb,gBAAIq9E,yDAAMtB,SAAS50E,CAAf;AACF,qBAAOA;UAHyC;AAMpD,iBAAO;QAPI;MAlKT,GAnBNwrC,kDAAA,CAAA;AAmBagrC,sDAAAA,MAAAA;ACEP,UAAOkB,oEAAP,cAAyBlB,qDAAzB;QA2BJx5D,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;AAxBF,eAAA4sB,oBAAoB;AAKpB,eAAAp9D,aAAoC;AAapC,eAAA3T,WANA,KAAAgxE,kBAAkB;AAahB,eAAK1hF,QAAQggF,yDAAM9B;QAFkB;QAWvCyD,oBAAoBvsF,GAAe;AACjC,iBAAO,CAAC,CAACA,EAAMiS,oBAAoB,CAAC,CAACjS,EAAMoS,aAAN;QADJ;QAUnCo6E,qBAAqBC,GAAgB;AACnC,iBAAO;QAD4B;QAI5BV,UAAO;AACd,cAAIr4E,IAAS,GACTF,IAAQ,GACR84E,IAAkB;AACtB,mBAAS/+E,IAAI,GAAGA,IAAI,KAAK49E,SAASl+E,QAAQM,KAAK;AAC7C,kBAAMmH,IAAO,KAAKy2E,SAAS59E,CAAd;AACbiG,iBAASkB,EAAKlB;AACTo3E,qEAAMtB,SAAS50E,CAAf,MAGCk2E,yDAAMf,iBAAiBn1E,CAAvB,IACF43E,IAAkBxuE,KAAKE,IAAIsuE,GAAiB53E,EAAKhB,MAA/B,IAElBA,IAASoK,KAAKE,IAAItK,GAAQgB,EAAKhB,MAAtB;UATgC;AAa/C,eAAKF,QAAQsK,KAAKE,IAAI,KAAKqtE,UAAU73E,CAAxB;AACb,eAAKE,SAASoK,KAAKE,IAAI,KAAKstE,WAAW53E,CAAzB,IAAmC44E;AACjD,eAAKA,kBAAkBA;AACvB,eAAKlB,2BAA2B,KAAK53E;QApBvB;QAuBPw4E,uBAAoB;AAC3B,iBAAO;QADoB;QAIpBC,qBAAkB;AACzB,iBAAO;QADkB;MA/EvB,GArBN/rC,yDAAA,CAAA;6DAqBaksC,YAAAA;ACFP,UAAOM,qEAAP,cAA0B7B,6DAA1B;QAUJn5D,YACE+tC,GACOktB,GAAmC;AAE1C,gBAAMltB,CAAN;AAFO,eAAAktB,kBAAAA;AAIP,eAAK/hF,QAAQggF,yDAAMzC;AAEnB,eAAK53C,QAAQ,KAAK2rB,WAAW0wB,SAASD,CAAzB;AACb,eAAKpmF,iBAAiB,eAAe,KAAKgqC,SAAS,KAAKA,MAAMC;AAE9D,eAAK2nB,cAAcw0B,EAAgBE,cAAhB;QATuB;MAZxC,GAnBN3sC,yDAAA,CAAA;6DAmBawsC,aAAAA;ACCP,UAAOI,gFAAP,cAA+BJ,mEAA/B;QAYJh7D,YACE+tC,GACO3wC,GAAY;AAEnB,gBAAM2wC,GAAW3wC,EAAMG,UAAvB;AAFO,eAAAH,QAAAA;AART,eAAAi+D,oBADA,KAAAC,oBAAoB;AAalB,eAAKpiF,QAAQggF,yDAAMlrC;AAEnB,eAAKmsC,QAAQ/8D,EAAM+8D;AAOnB,WALA,KAAKoB,iBACHn+D,EAAMG,cAAcH,EAAMG,WAAWK,YAAjB,IACfR,EAAMG,WAAWK,YAAjB,IACD,SAGE4E,IAAO,KAAK+4D,eAAe7lD,eAApB,GACb,KAAK8lD,sBAAsBh5D,EAAK1gB,OAChC,KAAK25E,uBAAuBj5D,EAAKxgB,UAGjC,KAAKy5E,uBADL,KAAKD,sBAAsB;QAlBV;MAdjB,GApBNhtC,+DAAA,CAAA;AAoBa4sC,mEAAAA,kBAAAA;ACDP,UAAOM,uFAAP,cAAkCN,8EAAlC;QAWJp7D,YAAY+tC,GAA6B3wC,GAAY;AACnD,gBAAM2wC,GAAW3wC,CAAjB;AAXO,eAAApb,SAAS;AAYhB,eAAK9I,QAAQggF,yDAAM5C;AAIjB,eAAKt0E,SAHF,KAAKu5E,iBAIN,KAAKE,uBACL,KAAKjxB,WAAWmxB,sBAChB,KAAKnxB,WAAWoxB,iBALJ,KAAK/8C,MAAM78B;AAQ3B,eAAKF,QACF,KAAK+8B,MAAM/8B,QACZ,KAAK0oD,WAAWqxB;eAEbR,oBAAoB,KAAK7wB,WAAWmxB;AAEzC,eAAKG,mBAAmB,KAAKj9C,MAAM78B;AAEnC,eAAK+5E,kBAAkB,KAAKl9C,MAAM/8B;QApBiB;MAXjD,GAnBN0sC,mEAAA,CAAA;AAmBaktC,uEAAAA,qBAAAA;ACCP,UAAOnvD,2DAAP,cAAqB4sD,6DAArB;QAWJn5D,YACE+tC,GACO72C,GACAo5C,GAAkB;AAEzB,gBAAMvC,CAAN;AAHO,eAAA72C,QAAAA;AACA,eAAAo5C,cAAAA;AAIP,eAAKzjB,aAAa31B,EAAMs0C;AAExB,eAAKwwB,UAAU9kE,EAAMu5C,WAAN;AACf,eAAKv3D,QAAQggF,yDAAMh/E;AAEbsW,cAAO,KAAK0G,MAAMrxB,QAAX;AAEb,eAAKmc,SAASwO,EAAKxO;AAEnB,eAAKF,QAAQ0O,EAAK1O;QAbO;MAdvB,GApBN0sC,oDAAA,CAAA;AAoBajiB,wDAAAA,QAAAA;ACHP,UAAO0vD,uDAAP,cAAmB9C,6DAAnB;QAMJn5D,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;AACA,eAAK70D,QAAQggF,yDAAMhD;AAEnB,eAAKl0E,SAAS,KAAKwoD,WAAW0xB,UAAUl6E;AACxC,eAAKF,QAAQ,KAAK0oD,WAAW0xB,UAAUp6E;AAEvC,eAAKq6E,iBAAiB,KAAKn6E;QAPU;MANnC,GAjBNwsC,kDAAA,CAAA;AAiBaytC,sDAAAA,MAAAA;ACEP,UAAOta,yDAAP,cAAoBwX,6DAApB;QAUJn5D,YACE+tC,GACOhxC,GAAiB;AAExB,gBAAMgxC,CAAN;AAFO,eAAAhxC,OAAAA;AAXT,eAAAi/D,UAAU;AAeR,eAAK9iF,QAAQggF,yDAAMj5D;AAEbzP,cAAOuM,EAAKl3B,QAAL;AACb,eAAKmc,SAASwO,EAAKxO;AACnB,eAAKF,QAAQ0O,EAAK1O;QARM;MAZtB,GAnBN0sC,mDAAA,CAAA;AAmBamzB,uDAAAA,OAAAA;ACFP,UAAOya,yEAAP,cAA2BjD,6DAA3B;QAKJn5D,YAAY+tC,GAA6BjsD,GAAa;AACpD,gBAAMisD,CAAN;AACA,eAAK70D,OAAL,KAAKA,OAAQggF,yDAAM/C,SAAS+C,yDAAM7C;AAClC,eAAKv0E,QAAQA;AACb,eAAKE,SAAS,KAAKwoD,WAAW6xB;QAJsB;MALlD,GAjBN7tC,4DAAA,CAAA;gEAiBa4tC,cAAAA;ACEP,UAAOE,wEAAP,cAA2BlB,8EAA3B;QAQJp7D,YAAY+tC,GAA6B3wC,GAAY;AACnD,gBAAM2wC,GAAW3wC,CAAjB;AACA,eAAKlkB,QAAQggF,yDAAM3C;AAEd,eAAKgF,kBAMR,KAAKz5E,QAAQ,KAAK05E,qBAClB,KAAKx5E,SAAS,KAAKy5E,yBANnB,KAAKz5E,SAAS,KAAKwoD,WAAW+xB,2BAC9B,KAAKz6E,QAAQ,KAAK0oD,WAAWgyB;AAQ/B,eAAKV,mBAAoB,KAAKjnF,iBAEzB,KAAKgqC,MAAM78B,OAAkC,KAAKA,MAAlD,IADA,KAAK68B,MAAM78B;AAGhB,eAAK+5E,kBAAmB,KAAKlnF,iBAExB,KAAKgqC,MAAM/8B,MAAiC,KAAKE,MAAjD,IADA,KAAK68B,MAAM/8B;AAEX,eAAKy5E,mBACR,KAAKz5E,SAAS,KAAKi6E,mBAAmB,KAAKlnF,iBAAiB,IAAI;AAGlE,eAAKwmF,oBACH,uBAAuB,KAAKx8C,QACxB,KAAKA,MAAMw8C,kBAAkB,KAAKS,gBAAlC,IACA,KAAKtxB,WAAWmxB;AAEtB,eAAKL,oBACH,uBAAuB,KAAKz8C,QACxB,KAAKA,MAAMy8C,kBAAkB,KAAKS,eAAlC,IACA;QAjC6C;MARjD,GAnBNvtC,2DAAA,CAAA;AAmBa8tC,+DAAAA,cAAAA;ACAP,UAAOvvC,8EAAP,cAA8BquC,8EAA9B;QAKJp7D,YAAY+tC,GAA6B3wC,GAAY;AACnD,gBAAM2wC,GAAW3wC,CAAjB;AACA,eAAKlkB,QAAQggF,yDAAM1C;AAOjB,eAAKx0E,SALF,KAAKu5E,iBAMN,KAAKE,uBAAuB,KAAKjxB,WAAWiyB,0BALhC,KAAKjyB,WAAWkyB;AAOhC,eAAK56E,QACH,KAAK0oD,WAAWmyB,+BACf,KAAK99C,MAAM/8B;QAdqC;MALjD,GAnBN0sC,8DAAA,CAAA;AAmBazB,kEAAAA,iBAAAA;ACAP,UAAO6vC,kEAAP,cAAwBpD,qDAAxB;QASJx5D,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;AANF,eAAA8uB,uBAAuB;AAOrB,eAAK3jF,QAAQggF,yDAAM7B;QAFkB;QAQ9BgD,UAAO;AACd,eAAKv4E,QAAQ,KAAK63E;AAClB,eAAK33E,SAAS,KAAK43E;AACnB,cAAIiD,IAAuB;AAC3B,mBAAShhF,IAAI,GAAGA,IAAI,KAAK49E,SAASl+E,QAAQM,KAAK;AAC7C,kBAAMmH,IAAO,KAAKy2E,SAAS59E,CAAd;AACb,iBAAKiG,SAASkB,EAAKlB;AACfo3E,qEAAMpB,QAAQ90E,CAAd,KAAuBA,aAAgBo4E,kFACrClC,yDAAMjB,iBAAiBj1E,CAAvB,KAAgCA,aAAgB+pC,8EAClD8vC,KAAwB75E,EAAKw4E,sBAE7BtC,yDAAMnB,gBAAgB/0E,CAAtB,KACAA,aAAgB04E,wFACa,MAA7B14E,EAAKw4E,wBAELqB,KACE75E,EAAKw4E,sBAAsBx4E,EAAK+4E;AAGjC7C,qEAAMtB,SAAS50E,CAAf,MACH,KAAKhB,SAASoK,KAAKE,IAAI,KAAKtK,QAAQgB,EAAKhB,MAA3B;UAhB6B;AAmB/C,eAAK66E,uBAAuBA;AAC5B,eAAKnD,2BAA2B,KAAK53E,QAAQ+6E;QAxB/B;QA2BPtC,qBAAkB;AACzB,iBAAO,CAAC,KAAKT,oBAAoB,CAAC,KAAKD;QADd;MA5CvB,GAnBNrrC,wDAAA,CAAA;AAmBaouC,4DAAAA,WAAAA;ACFP,UAAOE,sEAAP,cAA0B3D,6DAA1B;QAIJn5D,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;AACA,eAAK70D,QAAQggF,yDAAMhC;AACnB,eAAKl1E,SAAS,KAAKwoD,WAAWuyB,aAAa/6E;AAC3C,eAAKF,QAAQ,KAAK0oD,WAAWuyB,aAAaj7E;QAJL;MAJnC,GAjBN0sC,0DAAA,CAAA;AAiBasuC,8DAAAA,aAAAA;ACCP,UAAOE,8EAAP,cAA8BhC,mEAA9B;QAMJh7D,YACE+tC,GACAktB,GAAmC;AAEnC,gBAAMltB,GAAWktB,CAAjB;AACA,eAAK/hF,QAAQggF,yDAAMvC;AACnB,eAAK30E,SAAS,KAAK68B,MAAM78B;AACzB,eAAKF,QAAQ,KAAK+8B,MAAM/8B;QALW;MARjC,GAlBN0sC,8DAAA,CAAA;AAkBawuC,kEAAAA,iBAAAA;ACAP,UAAOC,kFAAP,cAAgCjC,mEAAhC;QAUJh7D,YACE+tC,GACAktB,GAAmC;AAEnC,gBAAMltB,GAAWktB,CAAjB;AAXF,eAAAK,oBAAoB;AAYlB,eAAKpiF,QAAQggF,yDAAMtC;AAEnB,eAAK50E,SAAU,KAAKnN,iBAAiD,IAA/B,KAAKgqC,MAAM78B;AAGjD,eAAKk7E,SAFL,KAAKp7E,QAAS,KAAKjN,iBAAgD,IAA9B,KAAKgqC,MAAM/8B;AAIhD,eAAKu5E,oBAAoB,KAAK7wB,WAAWmxB;QAVN;MAZjC,GAlBNntC,gEAAA,CAAA;AAkBayuC,oEAAAA,mBAAAA;ACAP,UAAOE,sFAAP,cAAkCnC,mEAAlC;QAMJh7D,YACE+tC,GACAktB,GAAmC;AAEnC,gBAAMltB,GAAWktB,CAAjB;AACA,eAAK/hF,QAAQggF,yDAAMxC;AACnB,eAAK10E,SAAS,KAAK68B,MAAM78B;AACzB,eAAKF,QAAQ,KAAK+8B,MAAM/8B;QALW;MARjC,GAlBN0sC,kEAAA,CAAA;AAkBa2uC,sEAAAA,qBAAAA;ACDP,UAAOC,wEAAP,cAA2BjE,6DAA3B;QAKJn5D,YAAY+tC,GAA6BsvB,GAAqB;AAC5D,gBAAMtvB,CAAN;AACA,eAAK70D,QACDmkF,KAAiC,WAAjBA,IAEdnE,yDAAMjC,qBADNiC,yDAAMnC,qBACsBmC,yDAAMrC;AACxC,eAAK/0E,QAAQ,KAAK0oD,WAAW8yB;AAG7B,eAAKt7E,SAAS,KAAKwoD,WAAW8yB,gBAAgB;QATc;MAL1D,GAjBN9uC,2DAAA,CAAA;AAiBa4uC,+DAAAA,cAAAA;ACAP,UAAOG,oEAAP,cAAyB/D,qDAAzB;QAaJx5D,YACE+tC,GACgB/rD,GACAF,GAAa;AAE7B,gBAAMisD,CAAN;AAHgB,eAAA/rD,SAAAA;AACA,eAAAF,QAAAA;AAblB,eAAA07E,oBAFA,KAAAC,mBAAmB;AAIV,eAAA/D,2BAA2B;AAclC,eAAKxgF,OAAL,KAAKA,OAAQggF,yDAAM/C,SAAS+C,yDAAM9C;AAElC,eAAKqD,WAAW,CAAC,IAAI2C;YAAY,KAAK5xB;YAAY1oD;UAAjC,CAAD;QALa;QAQtBu4E,UAAO;QAAA;MAxBZ,GAjBN7rC,yDAAA,CAAA;AAiBa+uC,6DAAAA,YAAAA;ACAP,UAAOG,0EAAP,cAA4BvE,6DAA5B;QAKJn5D,YAAY+tC,GAA6BsvB,GAAqB;AAC5D,gBAAMtvB,CAAN;AACA,eAAK70D,QACDmkF,KAAiC,WAAjBA,IAEdnE,yDAAMlC,sBADNkC,yDAAMpC,sBACuBoC,yDAAMrC;AAEzC,eAAK/0E,QADL,KAAKE,SAAS,KAAKwoD,WAAWmzB;QAN8B;MAL1D,GAjBNnvC,4DAAA,CAAA;AAiBakvC,gEAAAA,eAAAA;ACOP,UAAOE,8DAAP,cAAsBpE,qDAAtB;QAoBJx5D,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;AAZF,eAAAouB,iBAHA,KAAA0B,UAAU;AAMV,eAAAC,wBAAwB;AAGxB,eAAAvgE,aAAwC;AAQtC,eAAKrkB,QAAQggF,yDAAM/B;QAHkB;QAYvC0D,oBAAoBvsF,GAAe;AACjC,gBAAMyvF,KACHzvF,EAAM0vF,MAAoB,UAAd1vF,EAAM0vF,MAAgB,KAAKxzB,WAAWyzB,mBACnD,CAAC3vF,EAAMiS,oBACP,CAACjS,EAAMkS,oBACH09E,IAAY5vF,EAAM6vF,iBAAN;AAElB,iBACE,CAAC,CAAC7vF,EAAMiS,oBACRw9E,MACCG,IAAYA,EAAUx9E,aAAV,MAA6BpS,IAAQ;QAVnB;QAoBnCwsF,qBAAqBC,GAAgB;AACnC,iBAAO;QAD4B;QAI5BV,UAAO;AACd,cAAIr4E,IAAS,GACTF,IAAQ,GACRq6E,IAAiB;AACrB,mBAAStgF,IAAI,GAAGA,IAAI,KAAK49E,SAASl+E,QAAQM,KAAK;AAC7C,kBAAMmH,IAAO,KAAKy2E,SAAS59E,CAAd;AACbiG,iBAASkB,EAAKlB;AACTo3E,qEAAMtB,SAAS50E,CAAf,MACCk2E,yDAAMvB,MAAM30E,CAAZ,KAAqBA,aAAgBi5E,uDACvCE,IAAiB/vE,KAAKE,IAAI6vE,GAAgBn5E,EAAKm5E,cAA9B,IAEjBn6E,IAASoK,KAAKE,IAAItK,GAAQgB,EAAKhB,MAAtB;UAPgC;AAW/C,eAAKF,QAAQsK,KAAKE,IAAI,KAAKqtE,UAAU73E,CAAxB;AACb,eAAKE,SAASoK,KAAKE,IAAI,KAAKstE,WAAW53E,CAAzB,IAAmCm6E;AAEjD,eAAK0B,UADL,KAAK1B,iBAAiBA;AAEtB,eAAKzC,2BAA2B,KAAK53E;QAnBvB;QAsBPw4E,uBAAoB;AAC3B,iBAAO;QADoB;QAIpBC,qBAAkB;AACzB,iBAAO;QADkB;MAlFvB,GAxBN/rC,sDAAA,CAAA;AAwBaovC,0DAAAA,SAAAA;A9HiGP,UAAOQ,qEAAP,MAAA;QAuRJp+D,cAAA;AArRA,eAAA29D,aAAa;AAGb,eAAAU,gBAAgB;AAGhB,eAAAzC,iBAAiB;AAGjB,eAAA0C,uBAAuB;AAGvB,eAAAC,gBAAgB;AAIhB,eAAAC,aAAa;AAKb,eAAA7C,sBAAsB;AAMtB,eAAA8C,uBAAuB;AAGvB,eAAAC,YAAY;AAGZ,eAAAC,cAAc;AAGd,eAAAC,eAAe;AAGf,eAAAC,kBAAkB;AAClB,eAAAC,4BAA4B;AAK5B,eAAAxB,gBAAgB;AAMhB,eAAA/D,oBAAoB;AAGpB,eAAAkD,0BAA0B;AAC1B,eAAAsC,+BAA+B;AAG/B,eAAAC,8BAA8B;AAU9B,eAAAf,iBAAiB;AAGjB,eAAAgB,mBAAmB;AAGnB,eAAAC,kBAAkB;AAElB,eAAA7C,wBAAwB;AAExB,eAAAvV,mBAAmB;AAEnB,eAAA0V,6BAA6B;AAG7B,eAAAX,+BAA+B;AAK/B,eAAAsD,sBAAsB;AAGtB,eAAAC,qBAAqB;AAGrB,eAAA9wB,sBAAsB;AAGtB,eAAAC,wBAAwB;AAGxB,eAAAC,wBAAwB;AAaxB,eAAAK,sBANA,KAAAT,oBAAoB;AASpB,eAAA/B,2BAA2B;AAG3B,eAAAoC,2BAA2B;AAG3B,eAAAR,8BAA8B;AAG9B,eAAAoxB,8BAA8B;AAK9B,eAAAC,2BAA2B;AAiB3B,eAAA5c,2BAHA,KAAAS,8BANA,KAAAN,uCAAuC;AAavC,eAAAE,gCAAgC;AAahC,eAAAwc,0BANA,KAAAC,6BAA6B;AAS7B,eAAAC,6BAA6B;AASrB,eAAAx3C,OAA0B;AAKlC,eAAA29B,iBAAiB;AAGT,eAAA8Z,eAAkC;AAK1C,eAAAC,oBAAoB;AAKZ,eAAAC,kBAAqC;AAK7C,eAAAC,gBAAgB;AAQR,eAAAp5E,UAHA,KAAAq5E,cAAiC;AAQzC,eAAAC,gBAAgB;AAKhB,eAAAC,gBAAgB;AAKhB,eAAAC,kBAAkB;AAKlB,eAAAC,mBAAmB;AAKnB,eAAAC,uBAAuB;AAKvB,eAAAC,uBAAuB;AAKvB,eAAAC,sBAAsB;AAKtB,eAAAC,oBAAoB;AAMpB,eAAAC,0BAA0B;AAK1B,eAAAC,2BAA2B;AAE3B,eAAAC,SAAkC,EAACC,QAAQ,GAAGC,OAAO,EAAnB;AAuBhC,eAAKC,4BAA4B,KAAKhF;AAMtC,eAAKiF,gCAHL,KAAKC,yBAAyB,KAAKtC;AASnC,eAAK7B,+BAA+B,KAAKpD;AAGzC,eAAKwH,qBAAqB,KAAKnF;AAG/B,eAAKoF,wCAAwC,KAAKzC;AAGlD,eAAK0C,wBAAwB,KAAKrF;AAGlC,eAAKsF,wCAAwC,KAAK3C;AAGlD,eAAKhC,4BAA4B,KAAKiC,aAAa;AAQnD,eAAK9B,+BAA+B,KAAK5V;AAEzC,eAAKqa,cAAuBptF,8CAAO,GAAG,CAAnB;AAMnB,eAAKu4D,6BAA6B;AAGlC,eAAKiY,oCAAoC,KAAK9V;eAGzCqW,mCAAmC,KAAK7W;AAG7C,eAAK+U,mCACH;eAaGoe,8BAA8B,KAAK3yB;AAGxC,eAAK4yB,0BAA0B,KAAKpzB,8BAA8B;AAMlE,eAAKqzB,mBAAmBrnF,OAAOmS,KAAKg8B,OAAL,CAAP,EAAsB1e,UAAU,CAAhC;QAjF1B;QAuFAp0B,OAAI;AAKF,eAAKynF,eAAe,KAAKwE,gBAAL;AAGpB,eAAKZ,QAAQ,KAAKa,UAAL;AAGb,eAAKtF,YAAY,KAAKuF,aAAL;AAKjB,eAAKC,aAAa,KAAKC,cAAL;AAKlB,eAAKC,iBAAiB,KAAKC,kBAAL;AAKtB,eAAKC,kBAAkB,KAAKC,mBAAL;QA1BrB;QAkCJC,SAASvhD,GAAY;AAEnB,eAAKs8B,cAAchjE,uBAAOC,OAAO,IAAd;AAEnB,gBAAM+iE,IAAct8B,EAAMs8B;AAC1B,qBAAWviE,KAAOuiE;AAChB,iBAAKA,YAAYviE,CAAjB,IAAwB,KAAKynF,qBAAqBllB,EAAYviE,CAAZ,CAA1B;AAG1B,eAAK0nF,sBAAsBzhD,CAA3B;QATmB;QAiBXyhD,sBAAsBzhD,GAAY;AAC1C,eAAK0hD,kBAAkB1hD,CAAvB;AACA,eAAK2hD,uBAAuB3hD,CAA5B;AAEA,eAAKw9C,iBACiB1hF,WAApBkkC,EAAMq8B,YAA0Br8B,EAAMq8B,YAAY,KAAKmhB;QALf;QAalCkE,kBAAkB1hD,GAAY;AAClCA,YAAMy8B,aAAaz8B,EAAMy8B,UAAN,WACrB,KAAK1O,wBAAwB/tB,EAAMy8B,UAAN;AAG3Bz8B,YAAMy8B,aAAaz8B,EAAMy8B,UAAN,WACrB,KAAK3O,wBAAwB9tB,EAAMy8B,UAAN;AAG3Bz8B,YAAMy8B,aAAaz8B,EAAMy8B,UAAN,SACrB,KAAK5O,sBAAsB7tB,EAAMy8B,UAAN;AAGvBmlB,cAAkBz8F;YACtB;YACA,KAAK0oE,sBAAsB;YAC3B,KAAKC;YACL,KAAKC;UAJa;AAOpB,eAAKJ,oBAAoBi0B,EAAYrgF;AACrC,eAAK6sD,sBAAsBwzB,EAAYz4E;QArBD;QA6B9Bw4E,uBAAuB3hD,GAAY;AAC3C,eAAKs/C,gBACHt/C,EAAMg9B,kBAAkB,cAAxB,KAA2C,KAAKsiB;AAClD,eAAKC,gBACHv/C,EAAMg9B,kBAAkB,cAAxB,KAA2C,KAAKuiB;AAClD,eAAKO,0BACH9/C,EAAMg9B,kBAAkB,uBAAxB,KACA,KAAK8iB;AACP,eAAKC,2BACH5zE,OAAO6zB,EAAMg9B,kBAAkB,wBAAxB,CAAP,KACA,KAAK+iB;QAVoC;QAqB7C8B,uBAAuBz4D,GAAc;AACnC,gBAAM1wB,IAAO,UAAU0wB;AAClB,eAAKkzC,YAAY5jE,CAAjB,MACH,KAAK4jE,YAAY5jE,CAAjB,IAAyB,KAAKopF,kBAAkB14D,CAAvB;AAE3B,iBAAO,EAACxhB,OAAO,KAAK00D,YAAY5jE,CAAjB,GAAwBA,MAAAA,EAAhC;QAL4B;QAerCqpF,cAAcplB,GAA6B;AACzC,iBACE,KAAKL,YAAYK,KAAkB,EAAnC,MACCA,KAAkBA,EAAe35D,WAAW,OAA1B,IACf,KAAK6+E,uBAAuBllB,EAAe1zC,UAAU,CAAzB,CAA5B,EAAyDrhB,QACzD,KAAKk6E,kBAAkB,SAAvB;QALmC;QAejCA,kBAAkB14D,GAAc;AACxC,iBAAO,KAAKo4D,qBAAqB,EAAC,eAAiBp4D,EAAlB,CAA1B;QADiC;QAWhCo4D,qBAAqB5kB,GAA+B;AAE5D,gBAAMolB,IAAQ,CAAA;AACVplB,eACFtjE,OAAO2oF,OAAOD,GAAOplB,CAArB;AAGIslB,cAAuBlzF,sDAC3BgzF,EAAA,iBAA0B,MADP;AAGrBA,YAAMze,gBAAgB2e,EAAan5D;AACnCi5D,YAAM1e,kBAAkB0e,EAAA,kBACZhzF,sDAAiBgzF,EAAA,eAAzB,EAAmDj5D,MACnD,KAAKo5D,yBAAyBH,EAAMze,aAApC;AACJye,YAAMnf,iBAAiBmf,EAAA,iBACXhzF,sDAAiBgzF,EAAA,cAAzB,EAAkDj5D,MAClD,KAAKq5D,wBAAwBJ,EAAMze,aAAnC;AAEJye,YAAMzE,MAAMyE,EAAA,OAAgB;AAC5B,iBAAOA;QAnBqD;QA4BpDG,yBAAyBE,GAAmB;AACpD,iBAAc3zF,0CAAM,QAAQ2zF,GAAa,GAAlC,KAA0CA;QADG;QAU5CD,wBAAwBC,GAAmB;AACnD,iBAAc3zF;YAAM;YAAQ2zF;YAAa;UAAlC,KAA0CA;QADE;QAQrDz0F,UAAO;AACD,eAAKqxF,gBACHt6F,4CAAW,KAAKs6F,YAApB;AAEE,eAAKE,mBACHx6F,4CAAW,KAAKw6F,eAApB;AAEE,eAAKE,eACH16F,4CAAW,KAAK06F,WAApB;AAEF,eAAKr5E,UAAU;QAVV;QAiBG86E,kBAAe;AACvB,gBAAMv/E,IAAS,KAAKm9E,qBACdr9E,IAAQ,KAAKs9E,oBAEb2D,IAAoB9uF,4CAAK,CACpBL,6CAAMkO,GAAOE,IAAS,CAA/B,GACSpO,6CAAe,IAAT,CAACkO,GAAWE,IAAS,CAApC,GACSpO,6CAAMkO,GAAOE,IAAS,CAA/B,CAH6B,CAAd;AAKjB,iBAAO,EAACA,QAAAA,GAAQF,OAAAA,GAAOkhF,MAAMD,EAAtB;QATgB;QAeftB,eAAY;AACpB,gBAAMz/E,IAAS,KAAKi9E,kBACdn9E,IAAQ,KAAKo9E,iBAEb6D,IAAoBlvF,6CAAM,KAAK,CAC1BD,6CAAM,IAAI,CAACoO,CAApB,GACSpO,6CAAM,IAAI,CAACoO,CAApB,GACSpO,6CAAMkO,GAAO,CAAtB,CAHmC,CAApB;AAKjB,iBAAO,EAACE,QAAAA,GAAQF,OAAAA,GAAOkhF,MAAMD,EAAtB;QATa;QAgBZpB,gBAAa;AAerBsB,mBAASA,EAAaC,GAAW;AACzBvmF,gBAAUumF,IAAK,KAAK;AAC1B,kBAAMC,IAAO,CAACxmF;AAGd,gBAAMiyD,IAAa5sD,IAAS;AAC5B,kBAAMohF,IAAYx0B,IAFFy0B,KAGVC,IAAY10B,IAAa,KAGzB20B,IAAqB3vF;cAAM,CAACkO;cAAOnF,IAAUiyD;YAAjC;AACZ40B,gBAAqB5vF,6CAAMkO,GAAOnF,IAAUiyD,CAAhC;AAElB,mBACW/6D,6CAAM,KAAK,CACTD,6CAAM,GAAG+I,IAAUymF,CAA5B,GACSxvF,6CAAM,CAACkO,GAAOqhF,IAAOG,CAA9B,GACAC,CAHkB,CAApB,IAKS1vF,6CAAM,KAAK,CACTD,6CAAMkO,GAhBHuhF,MAgBUF,CAAtB,GACAK,CAFkB,CAApB;UAnB6B;AAdjC,gBAAM1hF,IAAQ,KAAK48E,WACb18E,IAAS,KAAKw8E,YAwCdx/C,IAASikD,EAAa,IAAb,GAETlkD,IAAWkkD,EAAa,KAAb;AAEjB,iBAAO,EACL/pF,MAAM,KAAKunF,OAAOC,QAClB5+E,OAAAA,GACAE,QAAAA,GACA+8B,UAAAA,GACAC,QAAAA,EALK;QA9Cc;QA0DbwiD,YAAS;AAajByB,mBAASA,EAAaQ,GAAW;AAC/B,mBAAgBxvF,4CAAK,CACVL,6CAAM6vF,IAAMC,GAAY1hF,CAAjC,GACSpO,6CAbM+vF,IAaAF,GAAkB,CAAjC,GACS7vF,6CAAM6vF,IAAMC,GAAY,CAAC1hF,CAAlC,CAHmB,CAAd;UADwB;AAZjC,gBAAMF,IAAQ,KAAK68E,aACb38E,IAAS,KAAK48E,cAEd8E,KAAc5hF,IADD6hF,KACuB,GAgBpC1kD,IAAWgkD,EAAa,CAAb,GACX/jD,IAAY+jD,EAAa,EAAb;AAElB,iBAAO,EACL/pF,MAAM,KAAKunF,OAAOE,OAClB7+E,OAAAA,GACAE,QAAAA,GACAi9B,UAAAA,GACAC,WAAAA,EALK;QAvBU;QAoCT2iD,oBAAiB;AACzB,gBAAM1mD,IAAS,KAAKmiD,eAEdsG,IAA8BzvF,2CAClC,KACA,SACAgnC,GACSvnC,6CAAM,CAACunC,GAAQA,CAAxB,CAJyB,GAOrB0oD,IAAiC1vF,2CACrC,KACA,SACAgnC,GACSvnC;YAAMunC;YAAQA;UAAvB,CAJ4B;AAO9B,iBAAO,EACLr5B,OAAOq5B,GACPn5B,QAAQm5B,GACR2oD,SAASF,GACTG,YAAYF,EAJP;QAjBkB;QA6BjB9B,qBAAkB;AAC1B,gBAAM5mD,IAAS,KAAKmiD,eAEd0G,IACKjwF,8CAAO,GAAGonC,CAAnB,IACShnC,2CAAI,KAAK,SAASgnC,GAAiBvnC,6CAAMunC,GAAQ,CAACA,CAAxB,CAAnC,GAGI8oD,IAAoB9vF,2CACxB,KACA,SACAgnC,GACSvnC,6CAAMunC,GAAQA,CAAvB,CAJe,GAQX+oD,IAAsB/vF,2CAC1B,KACA,SACAgnC,GACSvnC,6CAAM,CAACunC,GAAQ,CAACA,CAAzB,CAJiB,GAQbgpD,IAAuBhwF;YAC3B;YACA;YACAgnC;YACSvnC,6CAAM,CAACunC,GAAQA,CAAxB;UAJkB;AAOpB,iBAAO,EACL6oD,SAAAA,GACAC,UAAAA,GACAE,aAAAA,GACAD,YAAAA,GACAE,aAAajpD,EALR;QA/BmB;QA+C5B+/C,SAAS39D,GAA8B;AACrC,kBAAQA,EAAWrkB,MAAnB;YACE,KAAK85D,sDAAeC;YACpB,KAAKD,sDAAeE;AAClB,qBAAO,KAAKwuB;YACd,KAAK1uB,sDAAeI;YACpB,KAAKJ,sDAAeG;AAClB,qBAAO,KAAKwtB;YACd;AACE,oBAAMnnF,MAAM,yBAAN;UARV;QADqC;QAoBvC1N,UAAUyV,GAAiB+M,GAAiB+1E,GAAgB;AAC1D,eAAKC,WAAWh2E,GAAS+1E,CAAzB;AAOA,eAAKp8C,OAAWljD,kDAAiBqwC,qCAAI8S,MAAM,CAAA,GAAI3mC,CAAnC;AAeNm+E,cAAmB36F,kDACvBqwC,qCAAI4e,QACJ,EAAC,IAAM,wBAAwB,KAAKstC,iBAApC,GACA,KAAKr5C,IAHc;AAKjBljD,4DACFqwC,qCAAIye,gBACJ,EAAC,MAAM,eAAe,cAAgB,GAAG,QAAU,OAAnD,GACA6rC,CAHF;AAKM6E,cAAyBx/F;YAC7BqwC,qCAAI2e;YACJ,EACE,MAAM,QACN,cAAgB,GAChB,kBAAoB,KACpB,kBAAoB,IACpB,kBAAkB,SAClB,QAAU,UANZ;YAQA2rC;UAVyB;AAYvB36F,4DACFqwC,qCAAI0e,cACJ,EAAC,GAAK,MAAO,GAAK,MAAQ,GAAK,IAA/B,GACAywC,CAHF;AAKIx/F,4DACFqwC,qCAAIqe,aACJ,EACE,MAAM,WACN,KAAO,eACP,UAAY,MACZ,QAAU,UAJZ,GAMAisC,CARF;AAUI36F;YACFqwC,qCAAIqe;YACJ,EACE,MAAM,iBACN,KAAO,WACP,UAAY,cACZ,IAAM,GACN,IAAM,GACN,IAAM,GACN,IAAM,EAPR;YASAisC;UAXF;AAaA,eAAK9Z,iBAAiB8Z,EAAangF;AACnC,eAAKmgF,eAAeA;AASdE,cAAsB76F,kDAC1BqwC,qCAAIkf,SACJ,EACE,IAAM,2BAA2B,KAAKgtC,kBACtC,cAAgB,kBAChB,OAAS,IACT,QAAU,GAJZ,GAMA,KAAKr5C,IARiB;AAUpBljD,4DACFqwC,qCAAIof,MACJ,EAAC,OAAS,IAAI,QAAU,IAAI,MAAQ,OAApC,GACAorC,CAHF;AAKI76F;YACFqwC,qCAAIif;YACJ,EAAC,GAAK,+BAA+B,QAAU,OAA/C;YACAurC;UAHF;AAKA,eAAKD,oBAAoBC,EAAgBrgF;AACzC,eAAKqgF,kBAAkBA;AAEvB,eAAK4E,kBAAL;QA1G0D;QAiHpDA,oBAAiB;AAEvB,cAAI,CAAC,KAAK1E,aAAa;AACrB,kBAAMA,IAAkB/6F,kDACtBqwC,qCAAI4e,QACJ,EACE,IAAM,uBAAuB,KAAKstC,kBAClC,QAAU,QACV,OAAS,QACT,GAAK,QACL,GAAK,OALP,GAOA,KAAKr5C,IATa,GAYdw8C,IAA6B1/F;cACjCqwC,qCAAIse;cACJ,EAAC,QAAU,UAAX;cACAosC;YAH6B;AAK3B/6F,8DACFqwC,qCAAIwe,SACJ,EAAC,MAAQ,SAAS,aAAe,oCAAjC,GACA6wC,CAHF;AAMI1/F,8DACFqwC,qCAAIue,SACJ,EACE,eAAe,WACf,iBAAiB,KACjB,QAAU,WAHZ,GAKAmsC,CAPF;AASI/6F,8DACFqwC,qCAAIqe,aACJ,EACE,MAAM,YACN,KAAO,WACP,UAAY,MACZ,QAAU,UAJZ,GAMAqsC,CARF;AAUA,iBAAKD,gBAAgBC,EAAYvgF;AACjC,iBAAKugF,cAAcA;UA5CE;QAFA;QAwDfwE,WAAWh2E,GAAiB+1E,GAAgB;AAC9CK,cAAW,KAAKC,QAAQN,CAAb;AACXO,cAAY,4BAA4Bt2E;AAC9C,eAAK7H,UAAUC,SAAS6gC,eAAeq9C,CAAxB;AACf,gBAAM77E,IAAO27E,EAAStnF,KAAK,IAAd;AACT,eAAKqJ,UAEP,KAAKA,QAAQQ,WAAYwB,cAAcM,KAInCtC,IAAUC,SAASC,cAAc,OAAvB,GAChBF,EAAQlH,KAAKqlF,GACPh+E,IAAcF,SAASG,eAAekC,CAAxB,GACpBtC,EAAQK,YAAYF,CAApB,GACAF,SAASK,KAAKC,aAAaP,GAASC,SAASK,KAAKE,UAAlD,GACA,KAAKR,UAAUA;QAhBqC;QAyB5Ck+E,QAAQN,GAAgB;AAEhC,iBAAO;YAEL,GAAGA,CAAH;YACA,GAAGA,CAAH;YACE,SAAS,KAAK91B,qBAAd,IACO,KAAKD,mBAAR,MAAiC,KAAKE,qBAAtC;YACN;YAGA,GAAG61B,CAAH;YACE;YACF;YACA,GAAGA,CAAH;YACA,GAAGA,CAAH;YACE,SAAS,KAAK/E,wBAAd;YACA;YACA;YACF;YACA,GAAG+E,CAAH;YACA,GAAGA,CAAH;YACE;YACF;YAGA,GAAGA,CAAH;YACE;YACF;YAGA,GAAGA,CAAH;YACE;YACF;YAGA,GAAGA,CAAH;YACE;YACA;YACF;YAGA,GAAGA,CAAH;YACE,gBAAgB,KAAK71B,qBAArB;YACA,gBAAgB,KAAKD,qBAArB;YACF;YAGA,GAAG81B,CAAH;YACE;YACA;YACF;YAGA,GAAGA,CAAH;YACE;YACF;YAGA,GAAGA,CAAH;YACE;YACF;YACA,GAAGA,CAAH;YACA,GAAGA,CAAH;YACE;YACF;YAGA,GAAGA,CAAH;YACE,iBAAiB,KAAK7D,wBAAtB;YACA;YACF;UArEK;QAFyB;MAv+B9B,GAzHNhyC,mDAAA,CAAA;AAyHa4vC,uDAAAA,mBAAAA;AAvBGvpF,uDAAAA,iBAAAA;AAaAE,uDAAAA,UAAAA;uDARAD,cAAAA;A+H3EV,UAAO+vF,wDAAP,MAAA;QAaJ7kE,YAAY1xB,GAAiBw2F,GAAgB;AAR7C,eAAAC,cADA,KAAAC,eAAe;AAUb,eAAKC,SAAS32F;AACd,eAAK42F,QAAQJ;AACb,eAAKK,WAAW72F,EAAMuqB,uBAAN;AAGhB,eAAK2xC,aAAas6B,EAAK1hE,YAAL,EAAmB4oC,aAAnB;QANyB;QAkB7C9B,OAAI;AACF,eAAKk7B,aAAL;AACA,eAAKC,eAAL;AACA,eAAKC,2BAAL;AAEA,eAAKL,OAAOM,WAAWC,QAAQ,KAAKR,eAAe,OAAO,KAAKD,WAA/D;AACI,eAAKG,MAAM/zE,OACb,KAAK8zE,OAAOM,WAAWE,QAAvB;AAEF,eAAKC,mBAAL;QATE;QAkBMA,qBAAkB;AAG1B,eAAKT,OAAOjjF,SAAS,KAAKkjF,MAAMljF;AAChC,eAAKijF,OAAOnjF,QAAQ,KAAKojF,MAAMS;QAJL;QAQlBP,eAAY;AACpB,eAAKQ,SAAL;AACA,mBAASn5E,IAAI,GAAGA,IAAI,KAAKy4E,MAAMW,KAAKtqF,SAAS,GAAGkR,KAAK;AACnD,kBAAMmsE,IAAM,KAAKsM,MAAMW,KAAKp5E,CAAhB;AACRmsE,cAAIoB,gBACN,KAAK8L,gBAAgBlN,CAArB,IACSA,EAAIiB,eACb,KAAKkM,oBAAoBnN,CAAzB,IACSA,EAAIkB,mBACb,KAAKkM,gBAAgBpN,CAArB,IAEA,KAAKqN,kBAAkBrN,CAAvB;UATiD;AAYrD,eAAKsN,YAAL;AACA,eAAKC,UAAL;QAfoB;QAsBZP,WAAQ;AAChB,gBAAMQ,IAAS,KAAKlB,MAAMkB,QACpB3M,IAAW2M,EAAO3M;AAExB,eAAK4M,4BAAL;AACA,eAAKrB,gBAAyBjxF;YAAOqyF,EAAO/M;YAAM,KAAK6L,MAAMoB;UAAxC;AACrB,mBAASzqF,IAAI,GAAGmH,GAAOA,IAAOy2E,EAAS59E,CAAT,GAAcA;AACtCq9E,qEAAMb,oBAAoBr1E,CAA1B,IACF,KAAKgiF,gBAAgB,KAAKx6B,WAAWs3B,gBAAgBkC,UAC5C9K,yDAAMZ,qBAAqBt1E,CAA3B,IACT,KAAKgiF,gBAAgB,KAAKx6B,WAAWs3B,gBAAgBmC,WAErD/K,yDAAMhB,qBAAqBl1E,CAA3B,KACAA,aAAgBg4E,qEAEhB,KAAKgK,gBACFhiF,EAA4B67B,MAC7BI,WACOi6C,yDAAMvB,MAAM30E,CAAZ,IACT,KAAKgiF,gBAAgB,KAAKx6B,WAAW0xB,UAAU8G,OACtC9J,yDAAMtB,SAAS50E,CAAf,MACT,KAAKgiF,gBAAyB9wF,kDAAW,KAAK8O,EAAKlB,KAA9B;AAIzB,eAAKkjF,gBAAyB9wF,kDAAW,KAAKkyF,EAAOpkF,MAAhC;QAzBL;QAiCR8jF,gBAAgBlN,GAAQ;AAEhC,eAAKoM,gBACH,KAAKx6B,WAAWuyB,aAAaiG,OAAgB9uF,kDAAW,KAFxC0kF,EAAI52E,SAAS,KAAKwoD,WAAWuyB,aAAa/6E,MAEtB;QAHN;QAYxBgkF,gBAAgBpN,GAAQ;AAChC,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,eAAKmM,iCAAiC3N,CAAtC;AAEA,gBAAM75C,IAAWlqC,iEAAeuoB,EAAMyhB,KAArB,IACbzhB,EAAMyhB,MAAME,SAAS3hB,EAAMpb,MAA3B,IACCob,EAAMyhB,MAAoBE;AAE/B,eAAKimD,gBACM9wF,kDAAW,KAAKkpB,EAAMi8D,OAAOj8D,EAAMtb,KAA5C,IACAi9B,IACS7qC,kDAAW,KAAK0kF,EAAI52E,SAASob,EAAM0+D,gBAA5C;QAX8B;QAmBxBiK,oBAAoBnN,GAAQ;AACpC,cAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAKh9D,GAAL;AAEA,gBAAMhY,IAAIgY,EAAMi8D,OAAOj8D,EAAMk8D,cAAel8D,EAAMyhB,MAAgB/8B;AAE5D8hF,gBACHxmE,EAAMyhB,MAAgBK,YACdhrC,kDACP,KACA,EAAEkpB,EAAMk8D,cAAc,KAAK9uB,WAAWo3B,eAAe9/E,MAFvD,IAIA,KAAK0oD,WAAWo3B,eAAekC;AAEjC,gBAAM0C,IAAc5N,EAAI52E,SAAS,IAAI,KAAKwoD,WAAWo3B,eAAe5/E;AAEpE,iBAAKgjF,gBACM9wF,kDAAW,KAAKkR,CAAzB,IACAw+E,IACS1vF,kDAAW,KAAKsyF,CAAzB,IACA,KAAKh8B,WAAWo3B,eAAemC,aACtB7vF,kDAAW,KAAK0kF,EAAIS,OAAOT,EAAI92E,KAAxC;AAEF,iBAAK2kF,kCAAkC7N,CAAvC;UArBA;QAFoC;QAgC5BqN,kBAAkBrN,GAAQ;AAClC,eAAKoM,gBAAyB9wF,kDAAW,KAAK0kF,EAAIplB,OAAOolB,EAAI52E,MAAxC;QADa;QAQ1BkkF,cAAW;AACnB,gBAAMQ,IAAY,KAAKxB,MAAMwB,WACvBC,IAAQD,EAAUjN;AACxB,eAAKmN,wBAAL;AAEA,cAAIC,IAAqB,GACrBC,IAAc;AAClB,mBAASjrF,IAAI8qF,EAAMprF,SAAS,GAAGyH,GAAOA,IAAO2jF,EAAM9qF,CAAN,GAAWA;AAClDq9E,qEAAMf,iBAAiBn1E,CAAvB,KAAgCA,aAAgBg4E,qEAClD8L,KAAgB9jF,EAAK67B,MAAgBK,YAC5Bg6C,yDAAMX,mBAAmBv1E,CAAzB,IACT8jF,KAAwB5yF;cAAW;cAAKwyF,EAAUrN;YAAnC,IACNH,yDAAMb,oBAAoBr1E,CAA1B,IACT8jF,KAAe,KAAKt8B,WAAWs3B,gBAAgBoC,aACtChL,yDAAMZ,qBAAqBt1E,CAA3B,KACT8jF,KAAe,KAAKt8B,WAAWs3B,gBAAgBqC,aAC/C0C,IAAqB,KAAKr8B,WAAWs3B,gBAAgBsC,eAC5ClL,yDAAMtB,SAAS50E,CAAf,MACT8jF,KAAwB5yF,kDAAW,KAAkB,KAAb8O,EAAKlB,KAA9B;AAInB,eAAKkjF,gBAAyB9wF;YAC5B;YACAwyF,EAAU98E,WAAWi9E;UAFF;AAIrB,eAAK7B,gBAAgB8B;QA1BF;QAiCXX,YAAS;AACjB,cAAM5lF,IAAmB,KAAK2kF,MAAM3kF;AACpC,eAAKwmF,0BAAL;AAEA,cAAIxmF,GAAkB;AACpB,kBAAMymF,IACJzmF,EAAiB86E,oBAAoB96E,EAAiByB;AAClDg9B,gBAASnqC,iEAAe0L,EAAiBs+B,KAAhC,IACXt+B,EAAiBs+B,MAAMG,OAAOz+B,EAAiByB,MAA/C,IACCzB,EAAiBs+B,MAAoBG;AAG1C,iBAAKgmD,gBAAyB9wF,kDAAW,KAAK8yF,CAAzB,IAAsChoD;UARvC;AAYtB,eAAKgmD,gBAAgB;QAhBJ;QAuBTK,iBAAc;AACtB,mBAASxpF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKsM,MAAMW,KAAKhqF,CAAhB,GAAqBA;AAC/C,qBAASsU,IAAI,GAAGnN,GAAOA,IAAO41E,EAAIa,SAAStpE,CAAb,GAAkBA;AAC1C+oE,uEAAMlB,cAAch1E,CAApB,IACF,KAAKikF,iBAAiBjkF,CAAtB,KACSk2E,yDAAM/jF,OAAO6N,CAAb,KAAsBk2E,yDAAMxB,QAAQ10E,CAAd,MAC/B,KAAKkkF,aAAalkF,CAAlB;QANgB;QAiBdkkF,aAAaC,GAAuB;AAC5C,gBAAM3zB,IAAO2zB,EAAU/N,aAAa+N,EAAUnlF,SAAS;AACvD,cAAIq3E,IAAO8N,EAAU9N;AACrB,cAAI76E,IAAQ;AACR,eAAK0mF,MAAM/zE,QACbkoE,IAAO,EAAEA,IAAO8N,EAAUrlF,QACtBqlF,EAAUnL,YACZ3C,KAAQ8N,EAAUrlF,OAClBtD,IAAQ;AAIR06E,mEAAM/jF,OAAOgyF,CAAb,KACIpqE,IAAQoqE,EAAmBpqE,MACjCA,EAAKqjB,iBAAiB,IAAI11B,mDAAW2uE,GAAM7lB,CAArB,CAAtB,GACI,KAAK0xB,MAAM5oE,qBACbS,EAAKijB,uBAAL,MAGI1L,IAAY6yD,EAAoBjwE,MAAMmL,WAA1B,GAClBiS,EAASpyB,aACP,aACA,eAAem3E,IAAO,MAAM7lB,IAAO,MAAMh1D,CAF3C,GAII,KAAK0mF,MAAM5oE,qBACbgY,EAASpyB,aAAa,WAAW,MAAjC;QAzBwC;QAmCpC+kF,iBAAiB7pE,GAAkB;AAC3C,gBAAMtb,IAAQsb,EAAMtb,OACdE,IAASob,EAAMpb,QAGfolF,IAAgBhqE,EAAMi+D,mBACtBgM,IAAmBjqE,EAAM0+D,mBAAmBsL;AAGlD,eAAKrC,eACMjxF,8CAHaspB,EAAMi8D,OAAOj8D,EAAM2+D,iBAJ9B3+D,EAAMg8D,aAAap3E,IAAS,CAOvC,IACS9N,kDAAW,KAAKkzF,CAAzB,IACChqE,EAAMyhB,MAAoBE,WAClB7qC,kDAAW,KAAK8N,IAASqlF,CAAlC,IACSnzF,kDAAW,KAAK4N,IAAQsb,EAAM2+D,eAAvC,IACS7nF,kDAAW,KAAK,CAAC8N,CAA1B,IACA;AAEF,eAAKslF,+BAA+BlqE,CAApC;QAlB2C;QA4BnCkqE,+BAA+BlqE,GAAkB;AACzD,gBAAMo2C,IAAOp2C,EAAMg8D,aAAah8D,EAAMpb,SAAS;AAE/C,cAAIob,EAAM69D,iBAAiB;AAEzB,gBAAIsM,IAAQnqE,EAAMi8D,OAAOj8D,EAAM2+D,kBAAkB3+D,EAAMk+D;AACnD,iBAAK4J,MAAM/zE,QACbo2E,KAAS;AAEXnqE,cAAM69D,gBAAgB76C,iBACpBmnD,GACA/zB,IAAOp2C,EAAMi+D,iBAFf;UANyB;QAH8B;QAuBjDoL,kCAAkC7N,GAAQ;AAClD,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAWa,QAAP79D,IAAO69D,IAAP79D,EAAO69D,iBAAiB;AAC1B,gBAAIsM,IAAQ3O,EAAIS,OAAOT,EAAImB,gBAAgB38D,EAAMk8D;AAC7C,iBAAK4L,MAAM/zE,QACbo2E,KAAS;AAEXnqE,cAAM69D,gBAAgB76C,iBAAiBmnD,GAAO3O,EAAIplB,IAAlD;UAL0B;QAFsB;QAkB1C+yB,iCAAiC3N,GAAQ;AACjD,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAIh9D,KAASA,EAAM69D,iBAAiB;AAClC,gBAAIsM,IAAQ3O,EAAIS,OAAOT,EAAI92E;AACvB,iBAAKojF,MAAM/zE,QACbo2E,KAAS;AAEXnqE,cAAM69D,gBAAgB76C,iBAAiBmnD,GAAO3O,EAAIplB,IAAlD;UALkC;QAFa;QAYzC6yB,8BAA2B;AACnC,gBAAMD,IAAS,KAAKlB,MAAMkB;AAC1B,cAAIA,EAAO7oE,YAAY;AACrB,kBAAMnY,IAAIghF,EAAO/M,OAAO+M,EAAO9M;AAE/B8M,cAAO7oE,WAAW09D,gBAAgB76C,iBADpB,KAAK8kD,MAAM/zE,MAAM,CAAC/L,IAAIA,GACsB,CAA1D;UAHqB;QAFY;QAU3BwhF,0BAAuB;AAC/B,gBAAMF,IAAY,KAAKxB,MAAMwB;cAEzBA,EAAUnpE,YAAY;AACxB,kBAAMiqE,IAAWd,EAAUnpE,YACrBnY,IAAIoiF,EAASnO;AAEnBmO,cAASvM,gBAAgB76C,iBADX,KAAK8kD,MAAM/zE,MAAM,CAAC/L,IAAIA,GACashF,EAAU98E,QAA3D;UAJwB;QAHK;QAYvBm9E,4BAAyB;AACjC,cAAI,KAAK7B,MAAM3kF,kBAAkB;AAC/B,kBAAM6E,IACJ,KAAK8/E,MAAMhI,SAAS,KAAKgI,MAAM3kF,iBAAiB+6E;AAElD,iBAAK2J,OAAO1kF,iBAAiB6/B,iBADf,KAAK8kD,MAAM/zE,MAAM,CAAC/L,IAAIA,GAGlC,KAAK8/E,MAAM3kF,iBAAiB86E,iBAF9B;UAJ+B;QADA;QAgBzBiK,6BAA0B;AAClC,qBAAW1M,KAAO,KAAKsM,MAAMW;AAC3B,uBAAW7iF,KAAQ41E,EAAIa;AACrB,kBAAMz2E,aAAgBg4E;AAEtB,oBAAIh4E,EAAKyjD;AACP,uBAAKghC,4BAA4BzkF,CAAjC;qBACK;AACOuiF,sBAAAA,GAAWmC;AAAvB,2BAAuBA,KAAXnC,IAAZA,KAAKN,OAAOM,YAAWmC,8BAAAA,EAAAA,KAAXnC,GACVviF,EAAKi4E,eADP;gBADK;QAPuB;QAiBpCwM,4BAA4BE,GAAsB;AAChD,gBAAMh0B,IAAOg0B,EAAW1M;AAMtB+H,cAHArvB,EAAKz6D,SAAS85D,sDAAeC,eAC7BU,EAAKz6D,SAAS85D,sDAAeE,eAEtB,KAAK00B,qCAAqCD,CAA1C,IAEA,KAAKE,oCAAoCF,CAAzC;AAET,gBAAMr5F,IAAQqlE,EAAK50C,eAAL;AACRwmE,cAAAA,GAAWuC;AAAjB,mBAAiBA,KAAXvC,IAANj3F,EAAMi3F,YAAWuC,2BAAAA,EAAAA;YAAXvC;YACJ5xB;YACAqvB;YACArvB,EAAKo0B,iBAAL;YACAz5F,EAAM6iB;UAJR;QAZgD;QAwB1Cy2E,qCAAqCrqE,GAAsB;AACjE,cAAIyqE,IAAW;AACXnzF,2EAAe0oB,EAAWshB,KAA1B,IACFmpD,IAAWzqE,EAAWshB,MAAME,SAASxhB,EAAWvb,MAArC,IACFlN,8DAAYyoB,EAAWshB,KAAvB,MACTmpD,IAAWzqE,EAAWshB,MAAME;AAKxBkpD,cAAO,KAAKz9B,WAAWmxB;AAC7B,iBACW5nF,8CAAO,GAAG,CAACk0F,CAApB,IACS/zF,kDAAW,KAAK+zF,CAAzB,IACAD,IACS9zF,kDAAW,KAAK+zF,CAAzB;QAf+D;QAuB3DJ,oCAAoCtqE,GAAsB;AAChE,cAAI,CAACxoB,0DAAQwoB,EAAWshB,KAAnB;AACH,kBAAUrlC,MAAM,gDAAV;AAGR,gBAAM0uF,IACJ,KAAK19B,WAAW+uB,oBAAoB,KAAK/uB,WAAW8yB;AACtD,iBACWvpF,8CAAO,CAACm0F,GAAM,CAAvB,IACSh0F,kDAAW,KAAKg0F,CAAzB,IACA3qE,EAAWshB,MAAMI,WACR/qC,kDAAW,KAAKg0F,CAAzB;QAX8D;MA1d9D,GA5BN15C,gDAAA,CAAA;AA4Baq2C,oDAAAA,SAAAA;ACnBb,OAAA,SAAYsD,GAAK;AACfA,UAAAA,EAAAl3E,OAAA,EAAA,IAAA;AACAk3E,UAAAA,EAAAC,SAAA,CAAA,IAAA;AACAD,UAAAA,EAAAr2E,QAAA,CAAA,IAAA;MAHe,GAALq2E,EAAAA,8CAAAA,EAAAA,4CAAK,CAAA,EAAjB;AATA,UAAA35C,qCAAA,CAAA;AASY25C,yCAAAA,QAAAA,EAAAA;ACaN,UAAOE,gDAAP,cAA0B97D,mCAA1B;QAyBJvM,YACE/Z,GACAqiF,GACA75D,GAAyB;AAEzB,gBAAMlC,mCAAMq/B,UAAZ;AA5BM,eAAA28B,QAAuB;AAMtB,eAAA/8B,WAAW;AAGX,eAAAR,mBAAmB14B;AAqBtBrsB,gBAAUsmB,mCAAMq/B,eAChBn9B,IACF,KAAKo9B,WAAWp9B,CAAhB,IAEA,KAAK85D,QAAQD,KAAa,MAE5B,KAAKpgC,SAASjiD,CAAd;QAVyB;QAaR4lD,WAAWp9B,GAAwB;AACpD,gBAAMo9B,WAAWp9B,CAAjB;AACIA,YAAO85D,UAAO,KAAKA,QAAQ95D,EAAO85D;QAFc;QAQ7C1oD,WAAQ;AACf,eAAKssB,mBAAL;AACI,eAAKo8B,SACHvjG;YAAS,KAAKwoE,eAAL;YAAuB,KAAK+6B;UAAzC;QAHa;QAaEl5B,mBACjBn0D,GAA6B;AAE7B,iBAAiB,SAAbA,KAAkCqB,WAAbrB,IAChB,OAEF,GAAGA,CAAH;QALsB;QAa/BstF,SAASC,GAAuB;AAC1B,eAAK99B,iBACH,KAAK49B,SACHrjG,6CAAY,KAAKylE,cAAc,KAAK49B,KAAxC,GAEEE,KACEzjG,0CAAS,KAAK2lE,cAAc89B,CAAhC;AAGJ,eAAKF,QAAQE;QATiB;QAqBhB1lG,OAAAA,SAAS2X,GAAiC;AAIxD,iBAAO,IAAI,KAHUnL,8DAAyBmL,EAAQqO,IAAzCA,GAGSxM,QAAW7B,CAA1B;QAJiD;MAjGtD;AAyGQ/Y,qDAAS,eAAe0mG,6CAAtC;oDAEW38D,UAAU6+B,gBAAgB;AAjIrC,UAAA/b,oCAAA,CAAA;AAsBa65C,wCAAAA,aAAAA;ACKP,UAAOK,4CAAP,MAAA;QAiBJ1oE,YACS7mB,GACC0pB,GAAkB;AADnB,eAAA1pB,OAAAA;AACC,eAAA0pB,cAAAA;AAlBV,eAAAxF,WAAoB,CAAA;AAEpB,eAAA88D,QAAQgO,EAAAA,0CAAMl3E;AAGN,eAAAmW,UAAU;AAEF,eAAAluB,OAAmB+lB,EAAAA,qDAAWi9B;AAEvC,eAAA3+B,aAAgC;QASX;QAQ5BwB,iBAAc;AACZ,iBAAO,KAAK8D;QADA;QAad8lE,YAAezxE,GAA0BE,GAAiB;AACxD,eAAKwxE,cAAc,KAAKvrE,SAAS9hB,QAAQ2b,GAAOE,CAAhD;AACA,iBAAO;QAFiD;QAe1DwxE,cACErrF,GACA2Z,GACAE,GAAiB;AAEjB,cAAY,IAAR7Z,KAAaA,IAAQ,KAAK8f,SAAS9hB;AACrC,kBAAM/B,MAAM,WAAW+D,IAAQ,iBAAzB;AAIR,cAAI,EAAC2Z,KAAqB,OAAVA,KAAgBE;AAC9B,mBAAO7Z;AAIY,uBAAjB,OAAO2Z,MACTA,IAAsBn0B,EAAAA,+CAAS,EAC7BmW,MAAM,eACN6P,MAAMmO,EAFuB,CAAvB;AAMVA,YAAM60C,eAAe,KAAKlpC,WAA1B;AACI,eAAKA,YAAYxJ,eAAa,KAAKwvE,UAAU3xE,CAAf;AAClCA,YAAM/d,OAAOie;AACbF,YAAMihC,WAAW,KAAKrrD,UAAL,CAAjB;AAEIoqB,YAAMo0C,gBAER/tD,IAAQ,KAAKqrF,cAAcrrF,GAAO2Z,EAAMo0C,WAAhC;AAGV,eAAKjuC,SAAS5gB,OAAOc,GAAO,GAAG2Z,CAA/B;AACA3Z;AACI2Z,YAAMm0C,gBAER9tD,IAAQ,KAAKqrF,cAAcrrF,GAAO2Z,EAAMm0C,WAAhC;AAGN,eAAKxoC,YAAY/E,YAClB,KAAK+E,YAAyBx5B,YAA9B;AAEH,iBAAOkU;QAvCU;QAmDnBurF,YAAY3vF,GAAc4vF,GAAmB;AAC3C,mBAASltF,IAAI,GAAGqb,GAAQA,IAAQ,KAAKmG,SAASxhB,CAAd,GAAmBA;AACjD,gBAAIqb,EAAM/d,SAASA;AAMjB,qBALA+d,EAAM7oB,QAAN,GACA,KAAKgvB,SAAS5gB,OAAOZ,GAAG,CAAxB,GACI,KAAKgnB,YAAY/E,YAClB,KAAK+E,YAAyBx5B,YAA9B,GAEI;AAGX,cAAI0/F;AACF,mBAAO;AAET,gBAAMvvF,MAAM,YAAYL,IAAO,cAAzB;QAdqC;QAsB7CrM,YAAS;AACP,iBAAO,KAAKs6B;QADL;QAYT+wB,WAAW/wB,GAAgB;AAIzB,cAAI4hE,IAAmC,CAAA;AACvC,cAAI,KAAK5hE,YAAYA;AACnB,mBAAO4hE;AAET,eAAK5hE,UAAUA;AAEf,mBAAS9hB,IAAI,GAAG4R,GAAQA,IAAQ,KAAKmG,SAAS/X,CAAd,GAAmBA;AACjD4R,cAAMihC,WAAW/wB,CAAjB;AAEF,cAAI,KAAK7J,YAAY;AACnB,gBAAM0rE,IAAqB,KAAK1rE;AAE5B6J,gBACF4hE,IAAaC,EAAmBC,iBAAnB,IAEbD,EAAmBE,gBAAnB;AAGF,gBADM9oF,IAAQ4oF,EAAmBrrE,YAAnB;AAEZvd,gBAAMgiB,WAAN,EAAmBha,MAAMkB,UAAU6d,IAAU,UAAU;UAVtC;AAarB,iBAAO4hE;QA1BkB;QAkC3B95B,YAAS;AACP,mBAAS5pD,IAAI,GAAG4R,GAAQA,IAAQ,KAAKmG,SAAS/X,CAAd,GAAmBA;AACjD4R,cAAMg4C,UAAN;QAFK;QAaTk6B,SAASC,GAA+B;AACtC,cAAI,CAAC,KAAK9rE;AACR,kBAAM/jB,MAAM,wCAAN;AAER,eAAK+jB,WAAW6rE,SAASC,CAAzB;AACA,iBAAO;QAL+B;QAexCC,SAASnP,GAAY;AACnB,eAAKA,QAAQA;AACT,eAAKt3D,YAAY/E,YACC,KAAK+E,YACbx5B,YAAZ;AAEF,iBAAO;QANY;QAerBwqC,aAAanW,GAAsB;AACjC,cAAI,CAAC,KAAKH;AACR,kBAAM/jB,MAAM,wCAAN;AAER,eAAK+jB,WAAWsW,aAAanW,CAA7B;AACA,iBAAO;QAL0B;QAanC2S,eAAY;AACV,cAAI,CAAC,KAAK9S;AACR,kBAAM/jB,MAAM,wCAAN;AAER,iBAAO,KAAK+jB,WAAW8S,aAAhB;QAJG;QAQZ/6B,OAAI;AACF,qBAAW4hB,KAAS,KAAKmG;AACvBnG,cAAM5hB,KAAN;QAFA;QAWGsrB,YAAS;AACd,qBAAW1J,KAAS,KAAKmG;AACvBnG,cAAM0J,UAAN;QAFY;QAORioE,UAAU3xE,GAAY;AACxB,eAAK2L,YAAY/E,WACnB5G,EAAM5hB,KAAN,IAEA4hB,EAAM0J,UAAN;QAJ0B;QAW9BvyB,UAAO;AACL,mBAASwN,IAAI,GAAGqb,GAAQA,IAAQ,KAAKmG,SAASxhB,CAAd,GAAmBA;AACjDqb,cAAM7oB,QAAN;AAEE,eAAKkvB,cACP,KAAKA,WAAWlvB,QAAhB;QALG;QAiBGk7F,eAAerwF,GAAoB;AAC3C,iBAAO,KAAK2pB,YAAY2mE,gBAAgBtwF,CAAjC;QADoC;MA/RzC,GA3BNs1C,qCAAA,CAAA;AA2Bak6C,yCAAAA,QAAAA;AChBP,UAAOe,uDAAP,cAA0Bf,0CAA1B;QAQJ1oE,YACS7mB,GACP7K,GAAY;AAEZ,gBAAM6K,GAAM7K,CAAZ;AAHO,eAAA6K,OAAAA;AARA,eAAAD,OAAO+lB,EAAAA,qDAAW+Q;QASb;MAVV,GAXNwe,2CAAA,CAAA;AAWai7C,+CAAAA,aAAAA;ACKP,UAAOC,0DAAP,cAA2BhB,0CAA3B;QAQJ1oE,YACS7mB,GACP7K,GAAY;AAEZ,gBAAM6K,GAAM7K,CAAZ;AAHO,eAAA6K,OAAAA;AARA,eAAAD,OAAO+lB,EAAAA,qDAAWgR;QASb;MAVV,GAhBNue,6CAAA,CAAA;AAgBak7C,iDAAAA,cAAAA;ACHP,UAAO38C,+DAAP,cAA8B27C,0CAA9B;QAUJ1oE,YACS7mB,GACP7K,GAAY;AAGZ,cAAI,CAAC6K;AAAM,kBAAUK,MAAM,6CAAV;AAEjB,gBAAML,GAAM7K,CAAZ;AANO,eAAA6K,OAAAA;AAVA,eAAAD,OAAO+lB,EAAAA,qDAAWkR;AAiBzB,eAAK5S,aAAa,KAAKgsE,eAAev2B,sDAAeG,cAAnC;QANN;MAZV,GAbN3kB,+CAAA,CAAA;mDAaazB,iBAAAA;ACbbyB,UAAAA;AAYam7C,QAAAA,uDAAP,cAA0BjB,0CAA1B;QAQJ1oE,YACS7mB,GACP7K,GAAY;AAGZ,cAAI,CAAC6K;AAAM,kBAAUK,MAAM,yCAAV;AACjB,gBAAML,GAAM7K,CAAZ;AALO,eAAA6K,OAAAA;AARA,eAAAD,OAAO+lB,EAAAA,qDAAWC;AAczB,eAAK3B,aAAa,KAAKgsE,eAAev2B,sDAAeC,WAAnC;QALN;MAVV;AAZNzkB,iDAAA,CAAA;+CAYam7C,aAAAA,EAAAA;ACoCP,UAAOC,0DAAP,MAAA;QA2CJ5pE,YAAY2gB,GAAoBryC,GAAe;AApB/C,eAAAyrF,gBADA,KAAAj4E,QANA,KAAA6jF,oBAHA,KAAA3jF,SAAS;AAaT,eAAA6jF,OAAc,CAAA;AAGd,eAAAgE,YAAwB,CAAA;AAQxB,eAAAvD,SADA,KAAApJ,SAAS;AAQP,eAAK4M,YAAYnpD;AAEjB,eAAKskD,SAAS32F;AAGd,eAAKk8D,aAAa,KAAKs/B,UAAU99B,aAAf;AAMlB,eAAKzrD,mBAAmBjS,EAAMiS,mBAC1B,IAAI08E,gFAAiB,KAAKzyB,YAAYl8D,EAAMiS,gBAA5C,IACA;AAMJ,eAAKwpF,WAAWz7F,EAAMqsC,gBAAN,KAA2B,CAACrsC,EAAMyrB,YAAN;eAGvCA,cAAczrB,EAAMyrB,YAAN;AAMnB,eAAKuC,oBAAoBhuB,EAAMguB,kBAAN;AAGzB,eAAKnL,MAAM7iB,EAAM6iB;AAKjB,eAAKi1E,SAAS,IAAIxI,4DAAO,KAAKpzB,UAAhB;AAKd,eAAKk8B,YAAY,IAAIhM,kEAAU,KAAKlwB,UAAnB;QA1C4B;QAkD/CpnC,cAAW;AACT,iBAAO,KAAK0mE;QADH;QAWXzP,UAAO;AACL,eAAK2P,YAAL;AACA,eAAKC,gBAAL;AACA,eAAKC,eAAL;AACA,eAAKC,eAAL;AACA,eAAKC,kBAAL;AACA,eAAKC,UAAL;QANK;QAaGL,cAAW;AACnB,eAAKM,gBAAL;AACA,eAAKzE,KAAKlqF,KAAK,KAAKyqF,MAApB;cACImE,IAAY,IAAI3N,gEAAS,KAAKpyB,UAAlB;AAChB,eAAKq/B,UAAUluF,KAAK4uF,CAApB;AAGA,cAAMztE,IAAQ,KAAKmoE,OAAOjoE,SAAZ;AACd,mBAASnhB,IAAI,GAAGkhB,GAAOA,IAAOD,EAAMjhB,CAAN,GAAWA,KAAK;AAC5C,kBAAM2uF,IAAW,IAAI7oB,uDAAK,KAAKnX,YAAYztC,CAA1B;AACZ,iBAAKhD,eAAe,CAAAgD,EAAKojB,qBAAL,KACvBoqD,EAAU9Q,SAAS99E,KAAK6uF,CAAxB;UAH0C;AAO1CC,cAAYluF;AAGhB,mBAASV,IAAI,GAAGuhB,GAAQA,IAAQ,KAAK6nE,OAAO9nE,UAAUthB,CAAtB,GAA2BA;AACzD,gBAAKuhB,EAAMtwB,UAAN,GAAL;AAGI,mBAAK49F,mBAAmBttE,GAAOqtE,CAA/B,MAEF,KAAK5E,KAAKlqF,KAAK4uF,CAAf,GACAA,IAAY,IAAI3N,gEAAS,KAAKpyB,UAAlB,GACZ,KAAKq/B,UAAUluF,KAAK4uF,CAApB;AAIF,uBAASp6E,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAClDo6E,kBAAU9Q,SAAS99E,KAAK,IAAI4wB,yDAAM,KAAKi+B,YAAYtzC,GAAOkG,CAAlC,CAAxB;AAEF,mBAAKutE,UAAUvtE,GAAOmtE,CAAtB;AACAE,kBAAYrtE;YAfZ;AAkBE,eAAKrD,gBACPwwE,EAAUvQ,gBAAgB,MAC1BuQ,EAAU9Q,SAAS99E,KAAK,IAAImhF,oEAAW,KAAKtyB,UAApB,CAAxB;AAGF,WAAI+/B,EAAU9Q,SAASl+E,UAAUgvF,EAAUtQ,kBACzC,KAAK4L,KAAKlqF,KAAK4uF,CAAf;AAEF,eAAKK,mBAAL;AACA,eAAK/E,KAAKlqF,KAAK,KAAK+qF,SAApB;QA9CmB;QAoDX4D,kBAAe;AACvB,cAAMO,IAAc,CAAC,CAAC,KAAK5F,OAAOzkF;AAClC,gBAAMu9E,KACH,KAAKkH,OAAOjH,MACW,UAApB,KAAKiH,OAAOjH,MACZ,KAAKxzB,WAAWyzB,mBACpB,CAAC,KAAK19E,oBACN,CAACsqF;AAEH,cAAIC,IAAc,KAAK1E,OAAOvL,oBAAoB,KAAKoK,MAArC,IACdvH,0EACAN;AACJ,eAAKgJ,OAAO3M,SAAS99E,KAAK,IAAImvF,EAAY,KAAKtgC,UAArB,CAA1B;AAEIuzB,eACIC,IAAM,IAAI/B,qDAAI,KAAKzxB,UAAb,GACZ,KAAK47B,OAAO3M,SAAS99E,KAAKqiF,CAA1B,GACA,KAAKoI,OAAOvI,UAAUG,EAAI7B,kBACjB0O,MACT,KAAKzE,OAAOtI,wBAAwB,MACpC,KAAKsI,OAAO7oE,aAAa,IAAI4/D,oFAC3B,KAAK3yB,YACL,KAAKy6B,OAAOzkF,kBAFW,GAIzB,KAAK4lF,OAAO3M,SAAS99E,KAAK,KAAKyqF,OAAO7oE,UAAtC;AAIA,eAAK0nE,OAAO9nE,UAAU5hB,UACtB,KAAK0pF,OAAO9nE,UAAU,CAAtB,aAAoC4vB,gEAIb,CAAC,KAAKk4C,OAAOlrE,YAAZ,IACxB,KAAKqsE,OAAOxM,YACV,KAAKpvB,WAAWw2B,wCAElB,KAAKoF,OAAOxM,YAAY,KAAKpvB,WAAWu2B;AAG1C+J,cAAc,KAAK1E,OAAOtL,qBAAqB,KAAKmK,MAAtC,IACVvH,0EACAN;AACJ,eAAKgJ,OAAO3M,SAAS99E,KAAK,IAAImvF,EAAY,KAAKtgC,YAAY,OAAjC,CAA1B;QA3CuB;QAiDfogC,qBAAkB;AAC1B,eAAKlE,UAAU/L,oBAAoB,CAAC,CAAC,KAAKsK,OAAOxnE;AAU/C,eAAKipE,UAAU9M,YAPf,KAAKqL,OAAO9nE,UAAU5hB,UACtB,KAAK0pF,OAAO9nE,UAAU,KAAK8nE,OAAO9nE,UAAU5hB,SAAS,CAArD,aACEwxC,+DAMA,KAAKyd,WAAW02B,wCAES,KAAK12B,WAAWy2B;AAGpB,eAAKyF,UAAU7L,oBAAoB,KAAKoK,MAAxC8F,IAGvB,KAAKrE,UAAUjN,SAAS99E,KAAK,IAAI+hF,wEAAa,KAAKlzB,UAAtB,CAA7B,IAEA,KAAKk8B,UAAUjN,SAAS99E,KAAK,IAAIyhF,sEAAY,KAAK5yB,UAArB,CAA7B;AAGE,eAAKk8B,UAAU/L,sBACjB,KAAK+L,UAAUnpE,aAAa,IAAIy/D;YAC9B,KAAKxyB;YACL,KAAKy6B,OAAOxnE;UAFc,GAI5B,KAAKipE,UAAUjN,SAAS99E,KAAK,KAAK+qF,UAAUnpE,UAA5C;AAGwB,eAAKmpE,UAAU5L,qBAAqB,KAAKmK,MAAzC+F,IAGxB,KAAKtE,UAAUjN,SAAS99E,KAAK,IAAI+hF,wEAAa,KAAKlzB,YAAY,OAAlC,CAA7B,IAEA,KAAKk8B,UAAUjN,SAAS99E,KAAK,IAAIyhF,sEAAY,KAAK5yB,YAAY,OAAjC,CAA7B;QAtCwB;QAiDlBmgC,UAAUvtE,GAAcmtE,GAAc;AAE9C,cAAI,KAAKR,YAAY3sE,aAAiBusE,EAAAA;AACpCY,cAAU9Q,SAAS99E,KAAK,IAAI2gF;cAAY,KAAK9xB;cAAYptC;YAAjC,CAAxB,GACAmtE,EAAUrQ,iBAAiB;mBAClB98D,aAAiB2vB;AAC1Bw9C,cAAU9Q,SAAS99E,KACjB,IAAIsvF,4EAAyB,KAAKzgC,YAAYptC,CAA9C,CADF,GAGAmtE,EAAU1Q,eAAe;mBAChBz8D,aAAiBusE,EAAAA;AAC1BY,cAAU9Q,SAAS99E,KAAK,IAAI+/E,qFAAmB,KAAKlxB,YAAYptC,CAAxC,CAAxB,GACAmtE,EAAUzQ,mBAAmB;mBACpB18D,aAAiBqsE,wDAAcrsE,aAAiBssE;AAGzDa,cAAU3Q,YAAYxtE,KAAKE,IACzBi+E,EAAU3Q,WACVx8D,EAAM2B,eAAN,KAA0B3B,EAAM2B,eAAN,EAAwBlB,SAAxB,IACtB,KAAK2sC,WAAWq2B,gCAChB,KAAKr2B,WAAWs2B,sBAJA,GAMtByJ,EAAUtQ,gBAAgB;AAEJ,mBAApBsQ,EAAUpQ,UACZoQ,EAAUpQ,QAAQ/8D,EAAM+8D;QAzBoB;QAoCtCuQ,mBAAmBQ,GAAkBC,GAAiB;AAG9D,iBAAKA,IAKDA,aAAqBzB,2DAKvBwB,aAAqBn+C,gEACrBo+C,aAAqBp+C,+DAEd,OAKPm+C,aAAqBvB,EAAAA,wDACrBuB,aAAqBzB,wDACrB0B,aAAqBxB,EAAAA,uDAEd,CAAC,KAAKI,WAER,QAvBE;QAJqD;QA+BtDE,kBAAe;AACvB,mBAASpuF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA,KAAK;AAC9C,kBAAMuvF,IAAWxS,EAAIa;AACrBb,cAAIa,WAAW,CAAA;AAEXb,cAAI0B,qBAAJ,KAEF1B,EAAIa,SAAS99E,KACX,IAAIygF,uEACF,KAAK5xB,YACL,KAAK6gC,iBAAiB,MAAMD,EAAS,CAAT,CAA5B,CAFF,CADF;AAOF,gBAAKA,EAAS7vF,QAAd;AAGA,uBAASG,IAAI,GAAGA,IAAI0vF,EAAS7vF,SAAS,GAAGG,KAAK;AAC5Ck9E,kBAAIa,SAAS99E,KAAKyvF,EAAS1vF,CAAT,CAAlB;AACA,sBAAM6/D,IAAU,KAAK8vB,iBAAiBD,EAAS1vF,CAAT,GAAa0vF,EAAS1vF,IAAI,CAAb,CAAnC;AAChBk9E,kBAAIa,SAAS99E,KAAK,IAAIygF,uEAAY,KAAK5xB,YAAY+Q,CAAjC,CAAlB;cAH4C;AAK9Cqd,gBAAIa,SAAS99E,KAAKyvF,EAASA,EAAS7vF,SAAS,CAA3B,CAAlB;AACIq9E,gBAAI2B,mBAAJ,KAEF3B,EAAIa,SAAS99E,KACX,IAAIygF,uEACF,KAAK5xB,YACL,KAAK6gC,iBAAiBD,EAASA,EAAS7vF,SAAS,CAA3B,GAA+B,IAArD,CAFF,CADF;YAXF;UAb8C;QADzB;QA4Cf8vF,iBACRC,GACAn4D,GAAuB;AAEvB,cAAI,CAACm4D,KAECn4D,KAAQ+lD,yDAAMjB,iBAAiB9kD,CAAvB;AACV,mBAAO,KAAKq3B,WAAWu0B;cAIvBuM,KAAQpS,yDAAMpB,QAAQwT,CAAd,KAAuB,CAACn4D,GAAM;AACxC,gBAAI+lD,yDAAMnB,gBAAgBuT,CAAtB;AACF,qBAAO,KAAK9gC,WAAWmzB;AAClB,gBAAIzE,yDAAMlB,cAAcsT,CAApB;AACT,qBAAO,KAAK9gC,WAAW+zB;AAClB,gBAAIrF,yDAAMjB,iBAAiBqT,CAAvB;AACT,qBAAO,KAAK9gC,WAAWmzB;UANe;AAW1C,iBAAI2N,KAAQpS,yDAAMX,mBAAmB+S,CAAzB,KAAkCn4D,MACxC+lD,yDAAMhB,qBAAqB/kD,CAA3B,KAAoC+lD,yDAAMf,iBAAiBhlD,CAAvB,KAC/BA,EAAKmmD,cAKZgS,KAAQpS,yDAAMb,oBAAoBiT,CAA1B,KAAmCn4D,MACzC+lD,yDAAMhB,qBAAqB/kD,CAA3B,KAAoC+lD,yDAAMf,iBAAiBhlD,CAAvB,KAC/BA,EAAKmmD,cAAc,KAAK9uB,WAAW8yB,gBAIvC,KAAK9yB,WAAWoxB;QAjCA;QAwCfuO,iBAAc;AACtB,cAAIoB,IAA2B,GAC3BC,IAAa,GACbC,IAA+B;AACnC,mBAAS5vF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA,KAAK;AAC9C+8E,cAAIyB,QAAJ;AACAmR,gBAAap/E,KAAKE,IAAIk/E,GAAY5S,EAAI92E,KAAzB;AACb,gBAAI82E,EAAIiB,cAAc;AACpB,kBAAM6R,IAAiB9S,EAAIwB,aAAJ;AACSsR,kBAAAA,GAAgB5pF;AAA1C6hF,kBAAa/K,EAAI92E,SAAyBA,SAAAA,IAAAA,SAAhB4pF,IAAAA,KAAgB5pF,SAAhB4pF,EAAgB5pF,SAAAA,IAAS;AACzDypF,kBAA2Bn/E,KAAKE,IAC9Bi/E,GACA5H,CAFyB;YAHP;AAQtB8H,gBAA+Br/E,KAAKE,IAClCm/E,GACA7S,EAAIc,wBAFyB;UAXe;AAiBhD,eAAKK,gBAAgBwR;AACrB,eAAKzpF,QAAQ0pF;AAEb,mBAAS3vF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA;AACrC+8E,cAAIiB,iBACNjB,EAAImB,gBAAgB,KAAKA;AAI7B,eAAK4L,oBAAoBv5E,KAAKE,IAAIk/E,GAAYC,CAArB;AAErB,eAAKlrF,qBACP,KAAK28E,SAAS,KAAK38E,iBAAiBuB,OACpC,KAAKA,SAAS,KAAKvB,iBAAiBuB,OACpC,KAAK6jF,qBAAqB,KAAKplF,iBAAiBuB;QAnC5B;QA4CdsoF,oBAAiB;AACzB,mBAASvuF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA;AACzC,gBAAI+8E,EAAIiB;AACN,mBAAK8R,mBAAmB/S,CAAxB;iBACK;AACL,kBAAMgT,IAAehT,EAAI92E;AAEnB+pF,kBADe,KAAKC,oBAAoBlT,CAAzBmT,IACeH;AACjB,kBAAfC,KACF,KAAKG,qBAAqBpT,GAAKiT,CAA/B;AAEE3S,uEAAMF,iBAAiBJ,CAAvB,MACFA,EAAIc,2BAA2Bd,EAAI92E;YARhC;QAJgB;QAwBjBgqF,oBAAoBG,GAAS;AACrC,iBAAO,KAAKnqF,QAAQ,KAAKo7E;QADY;QAY7B8O,qBAAqBpT,GAAUiT,GAAoB;AAC3D,gBAAMK,IAActT,EAAI4B,eAAJ,GACd2R,IAAavT,EAAI6B,cAAJ;AACnB,cAAI7B,EAAIkB,oBAAoBlB,EAAIiB;AAC9BjB,cAAIc,4BAA4BmS;AAIlC,cAAIjT,EAAIuB,UAAUgO,EAAAA,0CAAMl3E,QAAQk7E;AAE9BA,cAAWrqF,SAAS+pF;mBACXjT,EAAIuB,UAAUgO,EAAAA,0CAAMC,UAAU8D,KAAeC;AAEtDD,cAAYpqF,SAAS+pF,IAAe,GACpCM,EAAWrqF,SAAS+pF,IAAe;mBAC1BjT,EAAIuB,UAAUgO,EAAAA,0CAAMr2E,SAASo6E;AAEtCA,cAAYpqF,SAAS+pF;mBACZM;AAETA,cAAWrqF,SAAS+pF;;AAEpB;AAEFjT,YAAI92E,SAAS+pF;QAxB8C;QAiCnDF,mBAAmB/S,GAAa;AACxC,gBAAM8S,IAAiB9S,EAAIwB,aAAJ;AACvB,cAAKsR,GAAL;AACA,gBAAIE,IAAehT,EAAI92E,QAAQ4pF,EAAe5pF,OAC1CiqF,IAAe,KAAKhS;AAElB8R,gBAAeE,IAAeH;AACjB,gBAAfC,KACF,KAAKG,qBAAqBpT,GAAKiT,CAA/B;AAIFD,gBAAehT,EAAI92E;AACnBiqF,gBAAe,KAAKD,oBAAoBlT,CAAzB;AACf8S,cAAe5pF,SAASiqF,IAAeH;AACvCF,cAAe1pF,SAASoK,KAAKE,IAAIo/E,EAAe1pF,QAAQ42E,EAAI52E,MAApC;AACxB42E,cAAI92E,SAASiqF,IAAeH;AAC5BhT,cAAIc,2BAA2BttE,KAAKE,IAClCssE,EAAI92E,OACJ,KAAKi4E,gBAAgBnB,EAAIiE,oBAFI;UAf/B;QAFwC;QAwBhCqN,iBAAc;AACtB,gBAAMkC,IAAU,KAAKvG;AACrB,eAAKA,OAAO,CAAA;AAEZ,mBAASp5E,IAAI,GAAGA,IAAI2/E,EAAQ7wF,QAAQkR;AAClC,iBAAKo5E,KAAKlqF,KAAKywF,EAAQ3/E,CAAR,CAAf,GACIA,MAAM2/E,EAAQ7wF,SAAS,KACzB,KAAKsqF,KAAKlqF,KAAK,KAAK0wF,eAAeD,EAAQ3/E,CAAR,GAAY2/E,EAAQ3/E,IAAI,CAAZ,CAAhC,CAAf;QAPkB;QAmBd4/E,eAAef,GAAWn4D,GAAS;AAC3C,cAAMnxB,IAAS,KAAKsqF,oBAAoBhB,GAAMn4D,CAA/B;AACf,gBAAMrxB,IAAQ,KAAKyqF,mBAAmBjB,GAAMn4D,CAA9B;AACRq5D,cAAS,IAAIjP,kEAAU,KAAK/yB,YAAYxoD,GAAQF,CAAvC;AACXwpF,YAAKzR,iBACP2S,EAAO/O,mBAAmB;AAExBtqD,YAAK0mD,iBACP2S,EAAOhP,oBAAoB;AAE7B,iBAAOgP;QAVoC;QAoBnCD,mBAAmBE,GAAYC,GAAU;AACjD,iBAAO,KAAK5qF,QAAQ,KAAKo7E;QADwB;QAWzCoP,oBAAoBG,GAAYC,GAAU;AAClD,iBAAO,KAAKliC,WAAWoxB;QAD2B;QAe1C+Q,mBAAmB/T,GAAU51E,GAAgB;AACrD,iBAAIk2E,yDAAMtB,SAAS50E,CAAf,IACK41E,EAAIplB,OAAOxwD,EAAKhB,SAAS,IAE9Bk3E,yDAAMH,YAAYH,CAAlB,KAEIhvE,IADYgvE,EAENplB,OAFMolB,EAEW52E,SAFX42E,EAE8BgC,iBAC5C1B,yDAAMf,iBAAiBn1E,CAAvB,IACK4G,IAAW5G,EAAKhB,SAAS,IAE3B4H,IAAW5G,EAAKhB,SAAS,KAE9Bk3E,yDAAMJ,SAASF,CAAf,IAEEM,yDAAMvB,MAAM30E,CAAZ,IADW41E,EAECiF,UAAU76E,EAAKhB,SAAS,IAFzB42E,EAIDiF,UAAU76E,EAAKhB,SAAS,IAEjC42E,EAAIplB,OAAOolB,EAAI52E,SAAS;QApBsB;QA6B7C4qF,qBAAqBhU,GAAQ;AACrC,cAAIiU,IAAUjU,EAAIS;AAClB,mBAASlpE,IAAI,GAAGnN,GAAOA,IAAO41E,EAAIa,SAAStpE,CAAb,GAAkBA;AAE1C+oE,qEAAMtB,SAAS50E,CAAf,MACFA,EAAKhB,SAAS42E,EAAI52E,SAEpBgB,EAAKq2E,OAAOwT,GACZ7pF,EAAKo2E,aAAa,KAAKuT,mBAAmB/T,GAAK51E,CAA7B,GAClB6pF,KAAW7pF,EAAKlB;QATmB;QAiB7BuoF,YAAS;AAIjB,cAAIoB,IAA+B,GAC/BqB,IAAU;AACd,mBAASjxF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA;AACzC+8E,cAAIplB,OAAOs5B,GACXlU,EAAIS,OAAO,KAAK6D,QAChB4P,KAAWlU,EAAI52E,QAEfypF,IAA+Br/E,KAAKE,IAClCm/E,GACA7S,EAAIc,wBAFyB,GAI/B,KAAKkT,qBAAqBhU,CAA1B;AAEF,cAAI,KAAKr4E,oBAAoB,KAAK0kF,OAAOxnE,gBAAgB;AACvD,kBAAMhZ,IAAS,KAAKwgF,OAAOxnE,eAAeG,YAA3B;AACXnZ,kBAEFgnF,IAA+Br/E,KAAKE,IAClCm/E,GACAhnF,EAAOixB,eAAP,EAAwB5zB,KAFK;UAJsB;AAWzD,eAAK6jF,oBAAoB8F,IAA+B,KAAKvO;AAE7D,eAAKl7E,SAAS8qF;AACd,eAAKxG,SAAS,KAAKF,OAAOvI;AAC1B,eAAK6I,UAAU98E,WAAWkjF,IAAU,KAAKpG,UAAU9L;QAhClC;QAoCnBmS,4BAA4Bp5B,GAAwB;AACzCpzD,cAAAA;AAAT,eAA2B06E,SAAlB16E,IAALA,KAAKA,oBAAkB06E,SAAlB16E,EAAkB06E,qBAAoBtnB;AAC7C,mBAAO,KAAKpzD;qBAGHq4E,KAAO,KAAKiN;AACrB,uBAAW7iF,KAAQ41E,EAAIa;AACrB,kBAAIz2E,aAAgBg4E,sEAAch4E,EAAKi4E,oBAAoBtnB;AACzD,uBAAO3wD;AAKb,iBAAO;QAb2C;MAhsBhD,GAhDNwrC,8CAAA,CAAA;AAgDao7C,kDAAAA,aAAAA;ACrBP,UAAOoD,gEAAP,cAA2BrlC,0DAA3B;QAgBJ3nC,YAAYgwB,GAAiB;AAC3B,gBAAMA,CAAN;AAJO,eAAA92C,OAAkB6kC,EAAAA;AAMzB,cAAKiS,GAAL;AAIA,gBAAIA,EAAU/vC,UAAV;AACF,oBAAMzG,MAAM,qCAAN;AAEJw2C,cAAUnyB,SAAV,MAEF,KAAK1iB,aAAa;AAGpB,iBAAK8xF,SAAax8F,4CAAiBu/C,CAArB;AACd,iBAAK7wC,MAAiBrc,qDAAiBktD,CAA5B;AACX,iBAAKk9C,YAAYl9C,EAAUnyB,SAAV;AACjB,iBAAKsvE,UAAiBrjG;cAAKkmD;cAAW,EACpCt2B,gBAAgB,KADoB;YAAvB;UAff;QAH2B;QA4BpB61B,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAK09C;AACR,kBAAUzzF,MACR,0FADI;AAKR,cAAI,CAAC,KAAK2F;AACR,kBAAU3F,MACR,uFADI;AAKR,cAAuB+C,WAAnB,KAAK2wF;AACP,kBAAU1zF,MACR,uGADI;AAKR,cAAI,CAAC,KAAK2zF;AACR,kBAAU3zF,MACR,2FADI;AAKRgG,YAAA,SAAqB3Y,qCAAU,KAAKomG,MAAnB;AACjBztF,YAAA,MAAc,KAAKL;AACnBK,YAAA,YAAoB,KAAK0tF;AACzB1tF,YAAA,UAAkB,KAAK2tF;AAClB,eAAKhyF,eACRqE,EAAA,aAAqB,KAAKrE;AAE5B,iBAAOqE;QAjCM;QA6CRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI4xF,+DAHE;AAKjB78C,YAAS88C,SAAkBz+E,EAAAA,2CAAUhP,EAAA,MAAnB;AAClB2wC,YAAShxC,MAAMK,EAAA;AACf2wC,YAAS+8C,YACP1tF,EAAA,aAA+D,aAA1C2wC,EAAS88C,OAAO3+E,QAAQ7U,YAAxB;AACvB02C,YAASg9C,UAAU3tF,EAAA;AACQjD,qBAAvBiD,EAAA,eACF2wC,EAASh1C,aAAaqE,EAAA;AAExB,iBAAO2wC;QAfI;QAuBJV,IAAI9yC,GAAgB;AAC3B,gBAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKxwC;AACR,kBAAU3F,MACR,uFADI;AAKR,cAAI,CAAC,KAAK2zF;AACR,kBAAU3zF,MACR,2FADI;AAKR,cAAImD;AACF,iBAASd,IAAI,GAAGA,IAAI,KAAKsD,IAAI5D,QAAQM,KAAK;AACxC,oBAAM0D,IAAK,KAAKJ,IAAItD,CAAT,GACLvN,IAAQmR,EAAUK,aAAaP,CAAvB;AACVjR,kBACFA,EAAMD,QAAQ,KAAd,IACSkR,MAAO,KAAKpC,WAErBhD,QAAQxG,KAAK,sCAAsC4L,CAAnD;YAPsC;;AAWnCxV;cAAO,KAAKojG;cAAS1tF;YAA5B;QA1ByB;MAnHzB;AA0JG9d,+CAAkB2X,qCAAKsG,OAAkB6jC,EAAAA,4CAAQupD,6DAA1D;AArLA,UAAAx+C,mDAAA,CAAA;AA2Baw+C,uDAAAA,cAAAA;AvIDP,UAAOhS,+CAAP,MAAA;QAkDJh7D,YACE2W,GACOz9B,GAAY;AAAZ,eAAAA,OAAAA;AArCT,eAAAmmC,mBAAsC;AAOtC,eAAAjhB,WAAW;AAMH,eAAAgvE,YAHA,KAAA/D,QAAyB;AAiBjC,eAAA/jF,IAPA,KAAAF,IAAI;AASI,eAAAioF,cAAmC;AAUzC,eAAKpiC,eAAet0B;QAFD;QAWX22D,SAASnuE,GAA2B;AAC5C,gBAAM6uB,IAAQglB,sDAAeC,aACvBs6B,IAAc,KAAKxuE,eAAL;AACpB,cAAMmR,IAAa/Q,EAAgBJ,eAAhB;AAGfI,YAAgB2U,YAAhB,KACF3U,EAAgBquE,mBAAmB,KAAnC;AAIF,cAAIC;AACJ,cAAI,KAAK35D,YAAL,GAAoB;AACtB,kBAAMu5D,IAAc,KAAKK,iBAAL,GACdjpF,IAAS,KAAKmZ,YAAL;AACXnZ,cAAQoZ,SAAR,IACFpZ,EAAQpW,QAAQ,KAAhB,KAEA,KAAKm/F,mBAAL,GACAC,IAAShpF;AAEX,iBAAKkpF,iBAAiBN,CAAtB;UATsB;AAaxB,cAAIjyF;AACWxY,wDAAX,MACFwY,IAAQ,KAAgBpY,wCAAe++C,EAAAA,wCAA1B,GACX7R,CADM,GAGR90B,EAAM0iD,UAAU,CAAC,SAAD,CAAhB;AAEF9oD,gEAAoB,MAAMmqB,CAA1B;AACA+Q,YAAW09D,UAAUL,CAArB;AACInyF,gBACFA,EAAM2iD,UAAN,GACWx7D,yCAAK6Y,CAAhB;AAIF,cAAIqyF,MACII,IACJ,KAAK30F,SAAS80C,IACVy/C,EAAOltF,mBACPktF,EAAOjtF;AAMb,gBAJM+c,IAAay9D,6CAAW8S;cAC5B59D;cACA29D;YAFiB;AAKjBA,gBAAiBxuE,QAAQ9B,CAAzB;;AAEAswE,gBAAiBE,gBAAgB,IAAjC;QArDwC;QA+D9C1/F,UAAO;AAEL,cAAI,KAAKylC,YAAL,GAAoB;AAClB,iBAAKk6D,WAAL,KAEF,KAAKC,uBAAL;AAGF,kBAAMrwE,IAAc,KAAKA,YAAL;AAChBA,iBAAe,CAACA,EAAYouB,cAAZ,KAElBpuB,EAAYswE,OAAZ;UAToB;AAaxB,eAAK9vE,WAAW;QAfX;QAuBPW,iBAAc;AACZ,iBAAO,KAAKksC;QADA;QAUd+iC,aAAU;AACR,iBACE,KAAK90F,SAAS85D,sDAAeC,eAC7B,KAAK/5D,SAAS85D,sDAAeG;QAHvB;QAYVr/B,cAAW;AACT,iBAAO,CAAC,CAAC,KAAKuL;QADL;QAUXK,uBAAoB;AAClB,iBAAO,KAAKurB,aAAaxrD,UAAU+f;QADjB;QAYpBuuE,gBAAgBI,GAA4B;QAAA;QAS5C9uE,QAAQ+uE,GAA2B;AACjC,cAAI,KAAK/uD,qBAAqB+uD;AAE5B,mBAAO;AAIT,cADgB,KAAK1uD,qBAALngB,EACJogB,WAAW,MAAMyuD,GAAiB,KAA1C,GAAkD;AACpD,kBAAMpwE,IAA2Bhf,EAAAA,6CAAX;AACjBgf,iBACQ/e,EAAAA,6CAAS,IAApB;AAGE,iBAAK+uF,WAAL,IAEF,KAAKV,SAASc,CAAd,IAGAA,EAAgBd,SAAS,IAAzB;AAESruF,cAAAA,6CAAS+e,CAApB;UAboD;AAgBtD,iBAAO,KAAK8V,YAAL;QAvB0B;QA6BnCu6D,aAAU;AACR,eAAKb,mBAAL;QADQ;QAYAA,mBAAmBI,IAAY,MAAI;AAC3C,gBAAM,EAAC,kBAAA7vE,GAAkB,iBAAAoB,EAAnB,IACJ,KAAKmvE,6BAAL;AACF,cAAI,CAACvwE,KAAoB,CAACoB;AACxB,kBAAM3lB,MAAM,kCAAN;AAGR,gBAAMwkB,IAA2Bhf,EAAAA,6CAAX;AACjBgf,eACQ/e,EAAAA,6CAAS,IAApB;AAGF,cAAI7D;AACWxY,wDAAX,MACFwY,IAAQ,KAAgBpY,wCAAe++C,EAAAA,wCAA1B,GACX5iB,EAAgBJ,eAAhB,CADM,GAGR3jB,EAAM0iD,UAAU,CAAC,YAAD,CAAhB;AAEF,gBAAMswC,IAAkB,KAAK/uD;AACzB+uD,gBACFA,EAAgB/uD,mBAAmB;AAErC,eAAKA,mBAAmB;AACpBuuD,eAAWzuE,EAAgBJ,eAAhB,EAAiC6uE,UAAU,IAA3C;AACXxyF,gBACFA,EAAM2iD,UAAN,GACWx7D,yCAAK6Y,CAAhB;AAGG+jB,YAAgBJ,eAAhB,EAAiClB,SAAjC,KAEHE,EAAiBwwE,eAAjB;AAGStvF,YAAAA,6CAAS+e,CAApB;QAnC2C;QA6CnCswE,+BAA4B;AAIpC,iBAAK,KAAKjvD,mBACN,KAAK2uD,WAAL,IACK,EACLjwE,kBAAkB,MAClBoB,iBAAiB,KAAKkgB,iBAFjB,IAKF,EACLthB,kBAAkB,KAAKshB,kBACvBlgB,iBAAiB,KAFZ,IAP4B,CAAA;QAJC;QAoB5BovE,iBAAc;AAEtB,eAAKC,kBAAkB,IAAvB;QAFsB;QAcxBC,UAAUngG,GAAciyB,GAAiB;AAEvC,cAAI,KAAKxB,eAAL,EAAsBitB,cAAtB;AAAuC,mBAAO;AAEzB,cAAA;AAAnB0iD,cAA8CnxE,SAA3BA,IAAAjvB,EAAMkyB,SAASD,CAAfhD,KAA2BA,SAA3BA,EAA2BA;AAC9CoxE,cAAgB,KAAK/wE,YAAL;AACtB,iBACI+wE,KAAiBA,MAAkBrgG,KACrCogG,CAAAA,KACAA,EAAiBrvD,qBAAqB,OASjC,SAPDqvD,EAAiB56D,YAAjB,KAEF46D,EAAiBL,WAAjB,GAEFK,EAAiBrvE,QAAQ,IAAzB,GACO;QAhB8B;QA0BzCzB,cAAW;AACT,cAAI,KAAKkW,YAAL,GAAoB;AACVuL,gBAAAA,GAAL;AAAP,mBAAO,SAAA,IAAA,SAAKA,IAALA,KAAKA,oBAAL,SAAKA,EAAkBtgB,eAAvB,KAAA,IAA2C;UAD5B;AAGxB,iBAAO;QAJE;QAUD6vE,kBAAe;AAGrB,WAAA,KAAK96D,YAAL,KACE,KAAKuL,oBACJ,KAAKK,qBAAL,EAA4BC,WAC3B,MACA,KAAKN,kBACL,KAHD,MAMW,KAAK2uD,WAAL,IAAoB,KAAKpwE,YAAL,IAAqB,KAAKqtC,cACrDijC,OAAP;QAZqB;QAuBzB9E,SAASC,GAA+B;AAClCA,eACGrrF,MAAMyR,QAAQ45E,CAAd,MACHA,IAAQ,CAACA,CAAD,IAEV,KAAKA,QAAQA,GACb,KAAKuF,gBAAL,KAEA,KAAKvF,QAAQ;AAEf,iBAAO;QAV+B;QAmBxCwF,WAAQ;AACN,iBAAO,KAAKxF;QADN;QASRx1D,aAAau5D,GAAyB;AACpC,eAAKa,uBAAuB,EAACb,WAAAA,EAAD,CAA5B;QADoC;QAatC/8D,aAAay+D,GAAuB;AAClC,iBAAOA,KAAiB,KAAKlxE,YAAL,EAAoBC,SAApB,IACfjtB,sCAAW,KAAKgtB,YAAL,CAAf,IACD,KAAKwvE;QAHyB;QAWpC3sE,eAAe4sE,GAAgC;AAC7C,eAAKY,uBAAuB,EAACZ,aAAAA,EAAD,CAA5B;QAD6C;QAc/C1vE,eAAemxE,GAAuB;AACpC,iBAAIA,KAAiB,KAAKlxE,YAAL,KAAsB,KAAKA,YAAL,EAAoBC,SAApB,IAC3B/zB,iDAAK,KAAK8zB,YAAL,CAAZ,IAEF,KAAKyvE;QAJwB;QAoBtC54B,WAAWs6B,GAAiB;AAC1B,iBAAO,CAAA;QADmB;QAW5B1+B,iBAAc;AACZ,cAAIC,IAAc;AAClB,gBAAMhzC,IAAS,KAAK2tC,aAAa9tC;AACjC,mBAASthB,IAAI,GAAGA,IAAIyhB,EAAO/hB,QAAQM;AACjC,gBAAIyhB,EAAOzhB,CAAP,EAAU0hB,eAAe,MAAM;AACjC+yC,kBAAchzC,EAAOzhB,CAAP;AACd;YAFiC;AAKrC,iBAAOy0D;QATK;QAkBdv1D,WAAQ;AACN,gBAAMzM,IAAQ,KAAK28D;AACnB,cAAI,CAAC38D;AACH,mBAAO;AAGT,cAAIA,EAAMiS,qBAAqB;AAC7B,gBAAAlG,IAAM;mBACG/L,EAAMkS,uBAAuB;AACtCnG,gBAAM;mBACG/L,EAAMmvB,mBAAmB;AAClCpjB,gBAAM;eACD;AACDi2D,gBAAc;AAClB,qBAASz0D,IAAI,GAAGuhB,GAAQA,IAAQ9uB,EAAM6uB,UAAUthB,CAAhB,GAAqBA;AACnD,kBAAIuhB,EAAMG,eAAe,MAAM;AAC7B+yC,oBAAclzC;AACd;cAF6B;AAKjC,gBAAIkzC;AACFj2D,kBAAM,YAAYi2D,EAAYn3D,OAAO;;AAGrC,qBADAgB,QAAQxG,KAAK,mDAAb,GACO;UAZJ;AAeP,iBAAO0G,IAAM/L,EAAMg5D,YAAN;QA3BP;QAoCAomC,mBAAgB;AAItB,gBAAMN,IAAY,KAAK/8D,aAAa,IAAlB,GACZg9D,IAAc,KAAK1vE,eAAe,IAApB;AAGpB,eAAK0vE,cADL,KAAKD,YAAY;AAEjB,iBAAO,EAACA,WAAAA,GAAWC,aAAAA,EAAZ;QATe;QAkBhBM,iBAAiB,EACvB,WAAAP,GACA,aAAAC,EAFuB,GAMxB;AACC,eAAKD,YAAYA;AACjB,eAAKC,cAAcA;QAFpB;QAUOY,uBAAuB,EAC7B,WAAAb,IAAY,MACZ,aAAAC,IAAc,KAFe,IAM3B,CAAA,GAAE;AAGJ,eAAKD,YAAYA;AACjB,eAAKC,cAAcA;AAEf,eAAKtuE,eAAL,EAAsBitB,cAAtB,OAEEvnC,IAAS,KAAKmZ,YAAL,KAMJnZ,EAAOoZ,SAAP,KACTpZ,EAAOpW,QAAQ,KAAf,GACA,KAAKkgG,eAAL,GACI,KAAK3wE,YAAL,KAAsB,KAAKA,YAAL,EAAoBC,SAApB,KACxB,KAAKmxE,gBAAgB,KAAKpxE,YAAL,CAArB,MAGIF,IAAS,KAAK8wE,kBAAkB,KAAvB,GACf,KAAKQ,gBAAgBtxE,CAArB,GACIA,KACFA,EAAOrvB,QAAQ,KAAf,MAdF,KAAKkgG,eAAL,GACI,KAAK3wE,YAAL,KAAsB,KAAKA,YAAL,EAAoBC,SAApB,KACxB,KAAKmxE,gBAAgB,KAAKpxE,YAAL,CAArB;QAZA;QAsCE4wE,kBAAkBS,GAAyB;AACjD,cAAM1B,IAAc,KAAKxuE,eAAL;AACpB,gBAAMsuE,IAAc,KAAK1vE,eAAL,GACdyvE,IAAY,KAAK/8D,aAAL;AAClB,cAAIk9D,EAAYvhD,cAAZ,KAAgC,CAACqhD,KAAe,CAACD;AACnD,mBAAO;AAIT,cAAIC;AAMF,mBALA6B,IAAqBrkG,2DAAewiG,GAAaE,EAAY9tF,WAAW,EACtEse,kBAAkBkxE,IAAmB,OAAO1yF,QAC5CshB,UAAU,MACV1iB,YAAY,MAH0D,CAA1D;AAQhB,cAAIiyF,GAAW;AACb8B,gBAAkBh+F;cAAmBk8F;cAAWG,EAAY9tF;YAA9C;AACd,gBAAIwvF;AACF,kBAAI,KAAK/1F,SAAS85D,sDAAeC,aAAa;AAC5C,oBAAI,CAACi8B,EAAY3uF;AACf,wBAAU/G,MAAM,8CAAV;AAER,oBAAI,CAAC,KAAK6lB,QAAQ6vE,EAAY3uF,gBAAzB;AACH,wBAAU/G,MAAM,8CAAV;cALoC,WAOnC,KAAKN,SAAS85D,sDAAeG,gBAAgB;AACtD,oBAAI,CAAC+7B,EAAY1uF;AACf,wBAAUhH,MAAM,6CAAV;AAER,oBAAI,CAAC,KAAK6lB,QAAQ6vE,EAAY1uF,kBAAzB;AACH,wBAAUhH,MAAM,8CAAV;cAL8C;AAQtD,sBAAUA,MACR,+DADI;AAKV,mBAAO01F;UAvBM;AAyBf,iBAAO;QA3C0C;QAoD3CF,gBAAgBtxE,GAAoB;AACrCA,gBAGL,KAAK0vE,YAAgBx8F,sCAAW8sB,CAAf,GACjB,KAAK2vE,cAAqBvjG,iDAAK4zB,CAAZ;QALuB;QAiBrCowE,OAAAA,mCACLluD,GACAiuD,GAA4B;AAE5B,cAAIA,EAAiB30F,SAAS85D,sDAAeE;AAC3C,mBAAOh+D,iEACL0qC,GACAiuD,EAAiB9uE,eAAjB,CAFK;AAMHxB,cAAaqiB,EAAWuvD,sBAAsB,IAAjC;gBACb5vE,IAAUsuE,EAAiBnuD,qBAAjB;AAChB,iBAAIniB,KAAcgC,EAAQogB,WAAWkuD,GAAkBtwE,GAAY,KAAjD,IACTA,IAEF;QAdqB;MAzqB1B;AAEGy9D,mDAAAoU,cAAc;AACdpU,mDAAAqU,yBAAyB;AACzBrU,mDAAAsU,oBAAoB;AACpBtU,mDAAAuU,qBAAqB;AACrBvU,mDAAAwU,uBAAuB;AACvBxU,mDAAAyU,8BAA8B;mDAC9BC,uBAAuB;AACvB1U,mDAAA2U,4BAA4B;AAC5B3U,mDAAA4U,6BAA6B;AApCtC,UAAAphD,mCAAA,CAAA;AA0BawsC,uCAAAA,aAAAA;AC1Bb,UAAAxsC,0CAAA,CAAA;AAiGgBr5C,8CAAAA,SAAAA;ACjGhB,UAAAq5C,kDAAA,CAAA;AA4BgBp5C,sDAAAA,gBAAAA;AsI+BV,UAAOy6F,qCAAP,MAAA;QAwLJ7vE,YAAYvgB,GAAsBk0B,GAAuBkpB,GAAe;AAtKxE,eAAAngC,OAAsB;AAOtB,eAAA0B,WAAW;AAMH,eAAA0xE,OAAsB;AAGpB,eAAAC,UAAU;AAGV,eAAAC,aAAa;AA8CvB,eAAAC,uBAAuC;AAwBvC,eAAAzvF,qBADA,KAAAid,iBADA,KAAAld,mBAAsC;AAGtC,eAAA4c,YAAqB,CAAA;AAErB,eAAAL,QAAiB,CAAA;AACT,eAAAqX,kBAAkB,oBAAIj4B;AAC9B,eAAAqrB,UAA2B;AAC3B,eAAA2oE,cAAc;AAEJ,eAAAC,eAA4B;AAE5B,eAAAC,eAAuB,CAAA;AAMzB,eAAAC,YAFA,KAAAC,WAFA,KAAAC,aAAa;AAQX,eAAAC,aAFF,KAAAC,YAAY;AAGV,eAAAC,eAA8B;AA0B/B,eAAA5yE,WANC,KAAA6yE,qBARV,KAAAt3E,cAPU,KAAAgkC,YAAY;AA6Bd,eAAAuzC,mBAHR,KAAAtjD,UAAoC;AAUpC,eAAAujD,sBAAsB;AAgBpB,eAAKpxF,YAAYA;AAEjB,eAAKF,KACHs9C,KAAU,CAACp9C,EAAUK,aAAa+8C,CAAvB,IAAiCA,IAAqBx6D,gDAAZ;AACvDod,YAAUqxF,aAAa,KAAKvxF,IAAI,IAAhC;AAMA,eAAKwxF,MAAM,IAAIrmF,mDAAW,GAAG,CAAlB;AACX,eAAKwxB,aAAaz8B,EAAUgY;AAC5B,eAAKu5E,cAAcvxF,EAAUm5B;AAE7B,eAAKznB,MAAM1R,EAAU0R;AAGrB,cAAIwiB,GAAe;AACjB,iBAAKz6B,OAAOy6B;AACNjI,gBAAYxoB,qCAAOywB,CAAP;AAClB,gBAAI,CAACjI,KAAkC,aAArB,OAAOA;AACvB,oBAAMnb,UAAU,wCAAwCojB,CAAlD;AAER55B,mBAAO2oF,OAAO,MAAMh3D,CAApB;UANiB;AASnBjsB,YAAUwxF,YAAY,IAAtB;AACAxxF,YAAUyxF,cAAc,IAAxB;AAEI,yBAAerB,sCACjB,KAAKsB,QAAL;QA/BoE;QAoC9DA,UAAO;AAIf,gBAAMnzE,IAA2Bhf,EAAAA,6CAAX;AACjBgf,eACQ/e,EAAAA,6CAAS,IAApB;AAEF,gBAAMc,IAA6Bzd,kDAAX;AAExB,cAAI;AAEuB,2BAArB,OAAO,KAAKgT,SACH2F,EAAAA,kDAAc,KAAzB,GACA,KAAK3F,KAAL,GACW2F,EAAAA,kDAAc8E,CAAzB,IAIand,8CAAX,KACSL,yCAAK,KAAgBS,wCAAek7B,EAAAA,0CAA1B,GAAyC,IAA9C,CAAhB;UAVA,UAAJ;AAaajf,cAAAA,6CAAS+e,CAApB,GAEW/iB,EAAAA,kDAAc8E,CAAzB;UAHQ;AAKV,eAAK0c,sBAAsB,KAAKD;AAGH,yBAAzB,OAAO,KAAK40E,YACd,KAAKC,YAAY,KAAKD,QAAtB;QA/Ba;QA0CjB/iG,QAAQijG,IAAY,OAAK;AACvB,eAAKj0C,YAAY;AAKb,eAAKuzC,oBACP,KAAKnxF,UAAU2sE,qBAAqB,KAAKwkB,gBAAzC;AAGF,eAAK1C,OAAOoD,CAAZ;AACe1uG,wDAAX,KAESL,yCAAK,KAAgBS,wCAAe+6C,EAAAA,0CAA1B,GAAyC,IAA9C,CAAhB;AAEF,eAAKt+B,UAAU8xF,eAAe,IAA9B;AACA,eAAKC,gBAAL;QAhBuB;QAuBfA,kBAAe;AACvB,eAAKn0C,YAAY;AACb,eAAKuzC,oBACP,KAAKnxF,UAAU2sE,qBAAqB,KAAKwkB,gBAAzC;AAGF,eAAKnxF,UAAUgyF,iBAAiB,IAAhC;AACA,eAAKhyF,UAAUiyF,gBAAgB,KAAKnyF,EAApC;AAE4B,yBAAxB,OAAO,KAAKoyF,WAAwB,KAAKA,QAAL;AAExC,eAAKvB,aAAaz0D,QAASpgB,OAAMA,EAAEi2E,gBAAF,CAAjC;AACA,eAAKr0E,UAAUwe,QAAS9/B,OAAMA,EAAExN,QAAF,CAA9B;AACA,eAAK8uB,UAAU5hB,SAAS;AACxB,eAAKwlC,gBAAgB,IAArB,EAA2BpF,QAASpgB,OAAMA,EAAEltB,QAAF,CAA1C;AACA,eAAK+vB,WAAW;QAfO;QAwBzB4tB,gBAAa;AACX,iBAAO,KAAKqR,aAAa,KAAKj/B;QADnB;QAYbwC,YAAS;AACP,cAASvH,CAAL,KAAKA,aAAT;AACA,uBAAW+D,KAAS,KAAKD;AACvBC,gBAAMwD,UAAN;AAEF,iBAAKvH,cAAc;UAJnB;QADO;QAeT60E,OAAO0D,GAAuB;AACxB,eAAKrxF,oBACP,KAAKsxF,eAAeD,CAApB;AAEE,eAAKpxF,sBACP,KAAKsxF,iBAAiBF,CAAtB;QAL0B;QAgBtBC,eAAeD,GAAuB;AAC5C,cAAI7zE,IAAmB,MACdxd;AAAT,cAAI,SAAKA,IAALA,KAAKA,oBAAL,IAAKA,EAAkBuzB,YAAvB;AACF/V,gBAAmB,KAAKxd,iBAAiB8+B,kBAEzC,KAAK9+B,iBAAiB8tF,WAAtB;eAIwBuD,MAIpBG,IAAiB,KAAKC,wBAAL,MAGpBD,EAAej+D,YAAf,KACD,CAAAi+D,EAAen0E,YAAf,EAA8BC,SAA9B,MAOIsB,IAAkB4yE,EAAe1yD,kBAEvC,QAAAlgB,KAAAA,EAAiBkvE,WAAjB,GAGE,KAAK5uF,UAAU+f,kBAAkBmgB,WAC/BxgB,GACApB,GACA,KAHF,IAMAA,EAAiBsB,QAAQF,CAAzB,IAEA,QAAAA,KAAAA,EAAiB4uE,gBAAgBhwE,CAAjC;QArC0C;QAkDtCi0E,0BAAuB;AAC7B,cAAIz0E,IAAa;AACjB,mBAAS1hB,IAAI,GAAGA,IAAI,KAAKshB,UAAU5hB,QAAQM,KAAK;AAC9C,kBAAMk2F,IAAiB,KAAK50E,UAAUthB,CAAf,EAAkB0hB;AACzC,gBACEw0E,KACAA,EAAe74F,SAAS85D,sDAAeC,eACvC8+B,EAAe1yD,kBACf;AACA,kBAAI9hB;AACF,uBAAO;AAETA,kBAAaw0E;YAJb;UAN4C;AAahD,iBAAOx0E;QAfsB;QAyBvBu0E,iBAAiBF,GAAuB;AAC9C,cAAIK,IAAiB;AACZzxF,cAAAA;AAAT,cAAI,SAAKA,IAALA,KAAKA,sBAAL,IAAKA,EAAoBszB,YAAzB;AAEFm+D,gBAAiB,KAAKzxF,mBAAmB6+B,kBAEzC,KAAK7+B,mBAAmB6tF,WAAxB;AAEI9rF,cAAY,KAAK7B,aAAL;AAClB,cAAIkxF,KAAiBrvF,KAAa,CAACA,EAAUsb,SAAV,GAAsB;AAE/BJ,gBAAAA,GAAgB4hB;AAAlC6yD,gBAAkC7yD,SAAAA,IAAAA,SAAhB5hB,IAALA,KAAKA,kBAAgB4hB,SAAhB5hB,EAAgB4hB,oBAAAA,IAAoB;AAC5D,oBAAA6yD,KAAAA,EAAY7D,WAAZ;AAEE4D,iBACA,KAAKxyF,UAAU+f,kBAAkBmgB,WAC/BsyD,GACAC,GACA,KAHF,KAOAD,EAAe5yE,QAAQ6yE,CAAvB;UAbqD;QATX;QAkChDnxD,gBAAgBoxD,GAAa;AACrBC,cAAgB,CAAA;AAClB,eAAK7xF,oBACP6xF,EAAcz2F,KAAK,KAAK4E,gBAAxB;AAEE,eAAKC,sBACP4xF,EAAcz2F,KAAK,KAAK6E,kBAAxB;eAEOid,kBACP20E,EAAcz2F,KAAK,KAAK8hB,cAAxB;AAEF,mBAAS5hB,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAC9CuhB,cAAMG,cACR60E,EAAcz2F,KAAKyhB,EAAMG,UAAzB;AAGJ,iBAAO60E;QAhBoB;QA6B7BjD,sBAAsBkD,GAAsB;AAC1C,cAAI50E,IAAiB,KAAKA;AAC1B,iBAAOA,KAAgB;AACrB,kBAAMlb,IAAYkb,EAAeG,YAAf;AAClB,gBAAI,CAACrb,KAAc8vF,KAAiB9vF,EAAUsb,SAAV;AAClC,qBAAOJ;AAETA,gBAAiBlb,EAAUkb;UALN;AAOvB,iBAAO;QATmC;QAgB5CxE,iBAAc;QAAA;QAUdhZ,YAAS;AACP,iBAAO,KAAKkwF;QADL;QAUTmC,kBAAkBhkG,GAAY;AAC5B,mBAASuN,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,gBAAIuhB,EAAMG,cAAcH,EAAMG,WAAWK,YAAjB,MAAmCtvB;AACzD,qBAAO8uB;AAGX,iBAAO;QANqB;QAiB9Bm1E,oBAAiB;AAEf,cAAIjkG,IAAqB,MACrB4vF;AACJ;AAGE,gBAFAA,IAAY5vF,GACZA,IAAQA,EAAM2R,UAAN,GACJ,CAAC3R;AAEH,qBAAO;iBAEFA,EAAMoS,aAAN,MAAyBw9E;AAElC,iBAAO5vF;QAbQ;QAqBjBoS,eAAY;AACV,iBAAO,KAAK+c,kBAAkB,KAAKA,eAAeG,YAApB;QADpB;QASZugE,mBAAgB;AACd,iBAAO,KAAK39E,sBAAsB,KAAKA,mBAAmBod,YAAxB;QADpB;QAUhBokB,eAAY;AACV,cAAI2pC,GAEAr9E,IAAqB;AACzB;AACEq9E,gBAAYr9E,GACZA,IAAQq9E,EAAUwkB;iBACX7hG;AACT,iBAAOq9E;QARG;QAmBZ6mB,mBAAgB;AAEd,cAAIlkG,IAAQ,MACRmkG;AACJ;AACEA,gBAAWnkG,EAAM6vF,iBAAN;iBAIXsU,KACAA,EAAS/xF,aAAT,MAA4BpS,MAC3BA,IAAQmkG;AAEX,iBAAOnkG;QAbO;QAyBhB6qB,YAAYu5E,GAAgB;AAC1B,cAAI,CAACA;AACH,mBAAO,KAAKtC;AAERrtF,cAAS,CAAA;AACf,mBAASlH,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,gBAAIuhB,EAAMG,YAAY;AACpB,kBAAMld,IAAQ+c,EAAMG,WAAWK,YAAjB;AACVvd,mBACF0C,EAAOpH,KAAK0E,CAAZ;YAHkB;AAQxB,WADM8yB,IAAO,KAAKzyB,aAAL,MAEXqC,EAAOpH,KAAKw3B,CAAZ;AAEF,iBAAOpwB;QAjBmB;QA0B5B6qF,UAAUvsF,GAAsB;AAC9B,cAAIA,MAAc,KAAK8uF,cAAvB;AAMA,gBAAMvyE,IACH,KAAKpd,sBAAsB,KAAKA,mBAAmBod,YAAxB,KAC3B,KAAKrd,oBAAoB,KAAKA,iBAAiBqd,YAAtB,GACtBkW,IAAc,CAAC,CAAClW;AAEtB,gBAAIkW,KAAezyB,KAAauc,MAAgBvc;AAC9C,oBAAM7H,MAAM,yDAAN;AACD,gBAAI,CAACs6B,KAAezyB;AACzB,oBAAM7H,MAAM,oCAAN;AACD,gBAAIs6B,KAAe,CAACzyB;AACzB,oBAAM7H,MACJ,6EADI;AASJ,iBAAK22F,eAEItrG,8CAAW,KAAKsrG,aAAaC,cAAc,IAAtD,IAIA,KAAK3wF,UAAU8xF,eAAe,IAA9B;AAIF,aADA,KAAKpB,eAAe9uF,KAGlBA,EAAU+uF,aAAaz0F,KAAK,IAA5B,IAEA,KAAK8D,UAAUwxF,YAAY,IAA3B;UAvCF;QAD8B;QAsDhC5xF,eAAeqzF,GAAgB;AAC7B,gBAAM3vF,IAAS,CAAC,IAAD,GACT4vF,IAAc,KAAKx5E,YAAYu5E,CAAjB;AACpB,mBAASryF,GAAOxE,IAAI,GAAIwE,IAAQsyF,EAAY92F,CAAZ,GAAiBA;AAG/CkH,cAAOpH,KAAK,GAAI0E,EAAMhB,eAAeqzF,CAArB,CAAhB;AAEF,iBAAO3vF;QARsB;QAgB/B7M,cAAW;AACT,iBACE,KAAKq6F,cACL,CAAC,KAAKE,aACN,CAAC,KAAKzkD,cAAL,KACD,CAAC,KAAKvsC,UAAU/E,QAAQ0oC;QALjB;QAcX/oB,iBAAc;AACZ,iBAAO,KAAKk2E;QADA;QASdv1E,aAAaV,GAAkB;AAC7B,eAAKi2E,aAAaj2E;QADW;QAU/Bgc,YAAS;AACP,iBACE,KAAKg6D,YACL,CAAC,KAAKG,aACN,CAAC,KAAKzkD,cAAL,KACD,CAAC,KAAKvsC,UAAU/E,QAAQ0oC;QALnB;QAeTjpB,eAAY;AACV,iBAAO,KAAKm2E;QADF;QASZv1E,WAAWX,GAAgB;AACzB,eAAKk2E,WAAWl2E;QADS;QAY3BmyB,iBAAc;AACZ,iBAAK,KAAK9sC,UAAUmzF,eAAf,IAGE,KAAKnzF,UAAUozF,oBACbjvG,iDAAmB,MAAM,IAAhC,CADK,IAFE;QAFG;QAcdi6B,WAAQ;AACN,iBAAO,KAAK4yE;QADN;QAYRjyE,UAAUd,GAAe;AACvB,eAAK+yE,YAAY/yE;QADM;QASzBpB,oBAAiB;AACf,iBAAO,KAAKq0E;QADG;QAWjBmC,mBAAmBC,GAAwB;AACzC,eAAKpC,qBAAqBoC;QADe;QAU3ClmD,aAAU;AACR,iBACE,KAAKwjD,aACL,CAAC,KAAKrkD,cAAL,KACD,CAAC,KAAKvsC,UAAU/E,QAAQ0oC;QAJlB;QAaVnpB,gBAAa;AACX,iBAAO,KAAKo2E;QADD;QASbv1E,YAAYZ,GAAiB;AAC3B,eAAKm2E,YAAYn2E;AACjB,mBAASre,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,qBAASsU,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAClD+G,gBAAM+oB,eAAN;QAJuB;QAc7B7mB,aAAU;AACR,iBAAO,KAAKgF;QADJ;QAQV40E,mBAAgB;AACd,cAAI,CAAC,KAAKzyF;AAAkB,mBAAO;AAEnC,qBAAW6c,KAAS,KAAKD;AACvB,gBAAIC,EAAMG,cAAsC,IAAxBH,EAAMC,SAAS9hB;AAAY,qBAAO;AAE5D,iBAAO;QANO;QAmBhB03F,sBACEnyD,GACA6yB,GAAgB;AAEhB,gBAAML,IAAc,KAAKvyB,gBAAgB,IAArB;AACdmyD,cAAmBpyD,EAAWC,gBAAgB,IAA3B;AACzB,cAAIuyB,EAAY/3D,WAAW23F,EAAiB33F;AAC1C,kBAAM/B,MAAM,2CAAN;AAER,mBAASqC,IAAI,GAAGA,IAAIq3F,EAAiB33F,QAAQM;AAC3C,gBAAIq3F,EAAiBr3F,CAAjB,MAAwB83D;AAC1B,qBAAOL,EAAYz3D,CAAZ;AAGX,iBAAO;QAZS;QAqBlBs3F,WAAWz5C,GAAsB;AAC/B,eAAKpM,UAAUoM;QADgB;QAWjCxf,WAAW+1B,GAAuB;AAChC,eAAK1oC,UAAU0oC;QADiB;QASlCC,aAAU;AACR,iBAAepiE,kDAAmB,IAA3B;QADC;QASVu1E,YAAS;AACP,iBAAO,KAAK0sB;QADL;QAST3kB,eAAY;AACV,iBAAO,KAAK4kB;QADF;QASZoD,SAAM;AACJ,iBAAO,KAAKtD;QADR;QAUN3jG,UAAU09B,GAAuB;AACzBwpE,cAAiB5jG,sDAAiBo6B,CAAzB;AACf,eAAKimE,OAAOuD,EAAOroE;AACnB,eAAK+kE,UAAUsD,EAAO7pE;QAHS;QAWjC2hD,SAAS/N,GAAsB;AAC7B,eAAK4yB,aAAa5yB;QADW;QAa/Bi0B,YAAYiC,GAAkC;AAC5C,cAAIA,KAAoC,eAAtB,OAAOA;AACvB,kBAAM95F,MAAM,8BAAN;AAEJ,eAAKo3F,oBACP,KAAKnxF,UAAU2sE,qBAAqB,KAAKwkB,gBAAzC;AAEF,eAAKQ,WAAWkC;AAChB,eAAK1C,mBAAmB0C,EAAW/uG,KAAK,IAAhB;AACxB,eAAKkb,UAAUq+B,kBAAkB,KAAK8yD,gBAAtC;QAT4C;QAkB9CtwE,SAASnnB,GAAY;AACnB,cAAoB,aAAhB,OAAOA;AACT,kBAAMoX,UACJ,iFAEYhU,WAATpD,IAAqB,YAAYA,IAAO,cAAc,OAAOA,KAC9D,UAJE;AAOR,mBAAS0C,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,qBAASsU,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAClD,kBAAI+G,EAAM/d,SAASA;AACjB,uBAAO+d;AAIb,iBAAO;QAhBY;QAwBrBq8E,UAAO;AACL,gBAAMC,IAAiB,CAAA;AACvB,mBAAS33F,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,qBAASsU,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAC9C+G,gBAAMi5C,oBAAN,KAEFqjC,EAAK73F,KAAKub,EAAM0lB,SAAN,CAAV;AAIN,iBAAO42D;QAVF;QAmBP9/E,eAAY;AACV,gBAAM8/E,IAAO,CAAA;AACb,mBAAS33F,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,qBAASsU,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAClD,kBAAI+G,EAAMi5C,oBAAN,GAA6B;AAC/B,sBAAM5zB,IAAQ,KAAK98B,UAAU+X,gBAC3BN,EAAM0lB,SAAN,CADY;AAKVL,qBACFi3D,EAAK73F,KAAK4gC,CAAV;cAP6B;AAYrC,iBAAOi3D;QAhBG;QA0BZC,cAAc9/E,GAAuB;AACnC,mBAAS9X,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,qBAASsU,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAEhD+G,gBAAMi5C,oBAAN,KACAx8C,EAASC,MAAT,MAAqBsD,EAAM0lB,SAAN,KAErB1lB,EAAMk5C,oBAAN;QAP6B;QAqBrCsjC,cAAcC,GAAeC,GAAa;AACxC,mBAAS/3F,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,qBAASsU,IAAI,GAAG+G,GAAQA,IAAQkG,EAAMC,SAASlN,CAAf,GAAoBA;AAC9C+G,gBAAMi5C,oBAAN,KAA+BwjC,MAAUz8E,EAAM0lB,SAAN,KAC3C1lB,EAAMgxC,SAAS0rC,CAAf;QAJkC;QAgB1Cz5D,cAAchhC,GAAY;AAExB,kBADM+d,IAAQ,KAAKoJ,SAASnnB,CAAd,KAEL+d,EAAM0lB,SAAN,IAEF;QALiB;QAc1Bi3D,cAAc34F,GAA8B/B,GAAY;AACtD,gBAAM+d,IAAQ,KAAKoJ,SAASnnB,CAAd;AACd,cAAI,CAAC+d;AACH,kBAAM1d,MAAM,YAAYL,IAAO,cAAzB;AAER+d,YAAMgxC,SAAShtD,CAAf;QALsD;QAexD44F,qBACEC,GACAC,GAAoC;AAEpC,cAAID;AACgBx3F,uBAAdy3F,MACFA,IAAY,OAET,KAAKxzF,uBACR,KAAKA,qBAAqB,KAAKgpF,gBAC7Bx2B,sDAAeI,kBADS,IAI5B,KAAK5yD,mBAAmB4oF,SAAS4K,CAAjC;mBAEI,KAAKxzF,oBAAoB;AAC3B,gBAAI,KAAKA,mBAAmBszB,YAAxB;AACF,oBAAMt6B,MACJ,gEADI;AAKR,iBAAKgH,mBAAmBnS,QAAxB;AACA,iBAAKmS,qBAAqB;UARC;QAbK;QAiCtCyzF,iBAAiBF,GAAqBC,GAAoC;AACxE,cAAID;AACgBx3F,uBAAdy3F,MACFA,IAAY,OAET,KAAKv2E,mBACR,KAAKA,iBAAiB,KAAK+rE,gBACzBx2B,sDAAeG,cADK,IAIxB,KAAK11C,eAAe2rE,SAAS4K,CAA7B;mBAEI,KAAKv2E,gBAAgB;AACvB,gBAAI,KAAKA,eAAeqW,YAApB;AACF,oBAAMt6B,MACJ,4DADI;AAIR,iBAAKikB,eAAepvB,QAApB;AACA,iBAAKovB,iBAAiB;UAPC;QAZ6C;QA+B1Ey2E,UAAUH,GAAqBC,GAAoC;AACjE,cAAID;AACgBx3F,uBAAdy3F,MACFA,IAAY,OAET,KAAKzzF,qBACR,KAAKA,mBAAmB,KAAKipF,gBAC3Bx2B,sDAAeE,YADO,IAI1B,KAAK3yD,iBAAiB6oF,SAAS4K,CAA/B;mBAEI,KAAKzzF,kBAAkB;AACzB,gBAAI,KAAKA,iBAAiBuzB,YAAtB;AACF,oBAAMt6B,MACJ,0DADI;AAIR,iBAAK+G,iBAAiBlS,QAAtB;AACA,iBAAKkS,mBAAmB;UAPC;QAZoC;QA6BnEse,gBAAgBk1E,GAAmB;AAC7B,eAAKv3E,iBAAiBu3E,MACbxxG,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,MACA,UACA,MACA,KAAKxhB,cACLu3E,CALF,CADF,GASA,KAAKv3E,eAAeu3E;QAXW;QAoBnCp5D,kBAAe;AACb,cAA0Bp+B,WAAtB,KAAKigB;AAEP,mBAAO,KAAKA;AAGd,mBAAS3gB,IAAI,GAAGA,IAAI,KAAKshB,UAAU5hB,QAAQM;AACzC,gBACE,KAAKshB,UAAUthB,IAAI,CAAnB,aAAiC4tF,wDACjC,KAAKtsE,UAAUthB,CAAf,aAA6B4tF;AAG7B,qBAAO;AAGX,eAAS5tF,IAAI,GAAGA,IAAI,KAAKshB,UAAU5hB,QAAQM;AACzC,gBACE,KAAKshB,UAAUthB,IAAI,CAAnB,aAAiC8tF,EAAAA,wDACjC,KAAKxsE,UAAUthB,CAAf,aAA6B4tF;AAG7B,qBAAO;AAGX,eAAS5tF,IAAI,GAAGA,IAAI,KAAKshB,UAAU5hB,QAAQM;AACzC,gBAAI,KAAKshB,UAAUthB,CAAf,aAA6B6tF;AAE/B,qBAAO;AAGX,iBAAO;QA9BM;QAsCfyK,eAAeC,GAA0B;AACvC,eAAK1D,eAAe0D;QADmB;QASzCC,iBAAc;AACZ,iBAAO,KAAK3D;QADA;QAYd9tG,YAAS;AACP,iBAAqC,MAA9B,KAAKuxC,gBAAgB3jB;QADrB;QAKG,IAAA,WAAQ;AACN7c;YACV;YACA;YACA;YACA;UAJF;AAMA,iBAAO,KAAKuM,kBAA4B0e,kDAAjC;QAPW;QAWR,IAAA,SAAS3Y,GAAc;AACrBtS,wDACV,YACA,OACA,OACA,uCAJF;AAMA,eAAK2M,kBAAkB2F,GAAiB2Y,kDAAxC;QAPiC;QAoBnCkP,WAAWC,GAAgB;AACbp6B,wDACV,cACA,OACA,OACA,uCAJF;AAMA,eAAK2M;YAAkB,CAACytB;YAAmBnP;UAA3C;QAPyB;QAwB3Bte,kBAAkBxB,GAAmBjB,GAAc;AAC7C,eAAKs2B,gBAAgBzb,IAAI7a,CAAzB,MAAqCiB,MACnCA,IACF,KAAKq1B,gBAAgBvsB,IAAI/J,CAAzB,IAEA,KAAKs2B,gBAAgBjb,OAAOrb,CAA5B,GAEIy2F,IAAmB,KAAgBtxG,wCAAeg7C,EAAAA,0CAA1B,GAC5B,MACA,YACY,MACI,CAACl/B,GACDA,CALO,GAOzBw1F,EAAiBh0F,kBAAkBzC,CAAnC,GACWtb,yCAAK+xG,CAAhB;QAf+C;QAyBnDnnD,uBAAoB;AAClB,cAAIonD,IAAW,KAAKhC,kBAAL;AACf,iBAAOgC,KAAU;AACf,gBAAI,CAACA,EAAS3xG,UAAT;AACH,qBAAO;AAET2xG,gBAAWA,EAAShC,kBAAT;UAJI;AAOjB,iBAAO;QATW;QAmBpBryF,kBAAkBrC,GAAc;AAC9B,iBAAO,KAAKs2B,gBAAgBzb,IAAI7a,CAAzB;QADuB;QAUhC0e,qBAAkB;AAChB,iBAAO,KAAK4X;QADI;QASlBpa,cAAW;AACT,iBAAO,KAAKy2E;QADH;QASX31E,aAAab,GAAkB;AACzB,eAAKw2E,eAAex2E,MACXz3B,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,MACA,aACA,MACA,KAAKwyD,YACLx2E,CALF,CADF,GASA,KAAKw2E,aAAax2E;QAXS;QAuB/Bjf,SAASy5F,GAAwBC,GAAuB;AAChDtpE,cAAS,KAAKupE,SAASD,CAAd;AAKf,mBAAS54F,IAAI,GAAGA,IAAIsvB,EAAO5vB,QAAQM;AACX,oBAAlBsvB,EAAOtvB,IAAI,CAAX,KAAuC,QAAdsvB,EAAOtvB,CAAP,MAC3BsvB,EAAOtvB,IAAI,CAAX,IAAgBsvB,EAAOtvB,IAAI,CAAX,GAChBsvB,EAAO1uB,OAAOZ,IAAI,GAAG,CAArB;AAKJ,cAAIyvF,IAAO;AACPviF,cAAeoiB,EAAO9F,OAAO,CAACsvE,GAAKC,MAAQ;AACvCz+D,gBAAMw+D,KAAgB,QAATrJ,KAAyB,QAATsJ,IAAe,KAAK,OAAOA;AAC9DtJ,gBAAOsJ,EAAKA,EAAKr5F,SAAS,CAAnB;AACP,mBAAO46B;UAHsC,GAI5C,EAJgB;AAMnBptB,cAAOA,EAAKxP,KAAL,KAAe;AAClBi7F,eAIEzrF,EAAKxN,SAASi5F,MAChBzrF,IAAOA,EAAK2gB,UAAU,GAAG8qE,IAAgB,CAAlC,IAAuC;AAGlD,iBAAOzrF;QA9B+C;QAwChD2rF,SAASG,IAAa,KAAG;AAC/B,gBAAM1pE,IAAS,CAAA;AAiBf,qBAAW/N,KAAS,KAAKD;AACvB,gBAAIC,EAAMjkB,QAAkB2iD,uDAA5B;AAGA,yBAAW5kC,KAASkG,EAAMC;AACxB8N,kBAAOxvB,KAAKub,EAAM4C,QAAN,CAAZ;AAEF,kBAAIsD,EAAMG,YAAY;AACpB,sBAAMld,IAAQ+c,EAAMG,WAAWK,YAAjB;AACd,oBAAIvd,GAAO;AAC0Ckd,sBAAAA,IAANH,EAAMG;AAnBvD,sBAAIu3E,IAASv3E,EAAWsxE,SAAX;AACT,mBAACiG,KAAUv3E,EAAW8hB,qBACxBy1D,IAASv3E,EAAW8hB,iBAAiBwvD,SAA5B;AAkBP,mBADMkG,IAdR,CAAC,CAACD,MAAWA,EAAOjoF,SAAS,SAAhB,KAA8BioF,EAAOjoF,SAAS,QAAhB,OAepBse,EAAOxvB,KAAK,GAAZ;AACrBwvB,oBAAOxvB,KAAK,GAAG0E,EAAMq0F,SAASG,CAAf,CAAf;AACIE,uBAAiB5pE,EAAOxvB,KAAK,GAAZ;gBAJZ;AAMTwvB,oBAAOxvB,KAAKk5F,CAAZ;cARkB;YANtB;AAkBF,iBAAO1pE;QArCwB;QA+CjC6pE,iBAAiB77F,GAAY;AAC3B,iBAAO,KAAK87F,YAAY,IAAItL,EAAAA;YAAWxwF;YAAM;UAArB,CAAjB;QADoB;QAW7B+7F,qBAAqB/7F,GAAY;AAC/B,eAAK03F;AACL,iBAAO,KAAKoE,YAAY,IAAIloD,6DAAe5zC,GAAM,IAAzB,CAAjB;QAFwB;QAYjCg8F,iBAAiBh8F,IAAO,IAAE;AACxB,iBAAO,KAAK87F,YAAY,IAAIxL,qDAAWtwF,GAAM,IAArB,CAAjB;QADiB;QAW1Bi8F,kBAAkBj8F,IAAO,IAAE;AACzB,iBAAO,KAAK87F,YAAY,IAAIvL,wDAAYvwF,GAAM,IAAtB,CAAjB;QADkB;QAS3B87F,YAAY73E,GAAY;AACtB,eAAKD,UAAUxhB,KAAKyhB,CAApB;AACA,iBAAOA;QAFe;QAchBi4E,wBAAwBn8F,GAAcC,GAAY;AAMxD,kBALMm8F,IAA4BtzG;YACvBsX,qCAAK00C;YACd90C;YACA;UAHuB,KAMlB,KAAK+7F,YAAY,IAAIK,EAAiBn8F,GAAM,IAA3B,CAAjB,IADuB;QAN0B;QAgB1DwJ,SAASnD,GAAwB;AAC/B,cAAM+1F,IAAgB/1F,EAAA,OAAe,YAAYA,EAAA,OAAe,QAAQ;AAGxE,cAAIA,EAAA,UAAkBA,EAAA;AACpB,kBAAMhG,MACJ+7F,IAAgB,uDADZ;AAOR,mBADIC,IAAI,GACDh2F,EAAK,SAASg2F,CAAd,KAAkB;AACvB,gBAA4Bj5F,WAAxBiD,EAAK,YAAYg2F,CAAjB;AACF,oBAAMh8F,MACJ+7F,IACE,OAAOC,CAAP,8CAAsDA,CAAtD,IAFE;AAKRA;UAPuB;AAYrBh2F,YAAA,SAAiBA,EAAA,MAAcw+E,QACjC,KAAKA,MAAMx+E,EAAA,MAAcw+E,KAGzBx+E,EAAA,QAAgB;AAGlB,cAAIA,EAAA,SAAiBA,EAAA;AACnB,kBAAMhG,MAAM+7F,IAAgB,0CAAtB;AACG/1F,YAAA,QACT,KAAKi2F,eAAej2F,GAAM+1F,CAA1B,IAEA,KAAKG,gBAAgBl2F,GAAM+1F,CAA3B;AAKF,eADI15F,IAAI,GACuBU,WAAxBiD,EAAK,YAAY3D,CAAjB;AACL,iBAAK85F,aACHn2F,EAAK,YAAY3D,CAAjB,GACA2D,EAAK,SAAS3D,CAAd,KAAoB,CAAA,GAEpB2D,EAAK,kBAAkB3D,CAAvB,KAA6B2D,EAAK,mBAAmB3D,CAAxB,GAC7B05F,CALF,GAOA15F;AAG2BU,qBAAzBiD,EAAA,iBACSX,EAAAA,4CAAX,GACA,KAAKggB,gBAAgBrf,EAAA,YAArB,GACWT,EAAAA,2CAAX;AAIqBxC,qBAAnBiD,EAAA,UACF,KAAK00F,UAAU,MAAM10F,EAAA,MAArB;AAE0BjD,qBAAxBiD,EAAA,eACF,KAAK20F,eAAe30F,EAAA,WAApB;AAEgCjD,qBAA9BiD,EAAA,qBACF,KAAKs0F,qBAAqB,MAAMt0F,EAAA,iBAAhC;qBAEEA,EAAA,iBACF,KAAKy0F,iBAAiB,MAAMz0F,EAAA,aAA5B;AAEsBjD,qBAApBiD,EAAA,YAEIo2F,IAAwBrmG,8DADbiQ,EAAAisB,OACK,GACtB,KAAKyO,WAAW07D,CAAhB;AAEgCr5F,qBAA9BiD,EAAA,sBACF,KAAK0wF,cAAc,CAAC,CAAC1wF,EAAA;AAEcjD,qBAAjCiD,EAAA,yBACF,KAAKywF,uBAAuB,CAAC,CAACzwF,EAAA;AAERjD,qBAApBiD,EAAA,YAEIq2F,IAAyBtmG,8DADdiQ,EAAAisB,OACM,GACvB,KAAK0nE,WAAW0C,CAAhB;AAEgC,uBAA9B,OAAOr2F,EAAA,eACTrF,QAAQxG,KACN4hG,IACE,8FAEA/1F,EAAA,OACA,UALJ,GAOAA,EAAA,aAAqB,CAACA,EAAA,UAAD;AAICjD,qBAApBiD,EAAA,WACSzM,wCAAMyM,EAAA,SAAiB,MAAM,IAAxC;AAGIs2F,cAAiBt2F,EAAA;AACvB,cAAIxB,MAAMyR,QAAQqmF,CAAd;AACF,iBAAS3lF,IAAI,GAAGA,IAAI2lF,EAAev6F,QAAQ4U;AAC9Bpd,sDAAM+iG,EAAe3lF,CAAf,GAAmB,MAAM,KAA1C;QA1G2B;QAqHzBulF,gBAAgBl2F,GAA0B+1F,GAAqB;AACrE,cAAI,YAAY/1F;AACd,gBAAuBjD,WAAnBiD,EAAA;AACFrF,sBAAQxG,KAAK4hG,IAAgB,yBAA7B;iBACK;AACC9pE,kBAAWjsB,EAAA;AACjB,kBAAI;AACF,qBAAKrT,UAAUs/B,CAAf;cADE,SAEK/vB,GAAG;AACVvB,wBAAQxG;kBAAK4hG,IAAgB;kBAA0B9pE;gBAAvD;cADU;YAJP;QAJ4D;QAqB/DgqE,eAAej2F,GAA0B+1F,GAAqB;AAC9Dn4B,cAAiB59D,EAAA;AACvB,cAAI;AACF,iBAAK2rE,SAAS/N,CAAd;UADE,SAEK24B,GAAY;AACnB57F,oBAAQxG,KAAK4hG,IAAgB,0BAA0Bn4B,CAAvD;UADmB;QAJ+C;QAmBtEhlC,MAAMD,GAA8B69D,GAA0B;AAC5D,cACuBz5F,WAArBy5F,KAC4B,cAA5B,OAAOA;AAEP,kBAAMx8F,MAAM,gDAAN;AAER,cAAI,CAACw8F,GAAkB;AACfC,gBAAa,CAAA;AACnB,uBAAWz7F,KAAO29B;AAC0B57B,yBAArC,KAA4B/B,CAA5B,KACHy7F,EAAWt6F,KAAKnB,CAAhB;AAGJ,gBAAIy7F,EAAW16F;AACb,oBAAM/B,MACJ,yCAAyC6uD,KAAKC,UAAU2tC,CAAf,CADrC;UARa;AAavBl8F,iBAAO2oF,OAAO,MAAMvqD,CAApB;QApB4D;QAiCtDw9D,aACNnjF,GACAyqB,GACAi5D,GACAX,GAAqB;AAEfpqE,cAAiB77B,2DAAsBkjB,CAA9B;AACf,eAAK2jF,gBAAgBhrE,GAAQ8R,EAAK1hC,MAAlC;AACMk+E,cAAW,KAAK2c,sBAAsBjrE,GAAQ8R,GAAMi5D,CAAzC;AAGXG,cAAa,CAAA;AACnB,mBAASx6F,IAAI,GAAGsC,GAAUA,IAAUs7E,EAAS59E,CAAT,GAAcA;AAChD,gBAAI,KAAKy6F,gBAAgBn4F,EAAA,IAArB,GAGF;AAAA,kBAFMif,IAAQ,KAAKm5E,eAAep4F,GAASo3F,CAA7B,GAEH;AACT,yBAASplF,IAAI,GAAG0nB,GAAQA,IAAQw+D,EAAWlmF,CAAX,GAAgBA;AAC9CiN,oBAAMurE,YAAY9wD,EAAM,CAAN,GAAUA,EAAM,CAAN,CAA5B;AAEFw+D,kBAAW96F,SAAS;cAJX;YAAX;AAUA,eADM2b,IAAQ,KAAKs/E,eAAer4F,CAApB,MAEZk4F,EAAW16F,KAAK,CAACub,GAAO/Y,EAAA,IAAR,CAAhB;QAvBe;QAqCfg4F,gBAAgBhrE,GAAgCsrE,GAAiB;AACvE,gBAAMC,IAAkB,CAAA;AACxB,cAAIC,IAAmB;AACvB,mBAAS96F,IAAI,GAAGA,IAAIsvB,EAAO5vB,QAAQM,KAAK;AACtC,kBAAM+6F,IAAQzrE,EAAOtvB,CAAP;AACd,gBAAqB,aAAjB,OAAO+6F,GAAX;AAGA,kBAAY,IAARA,KAAaA,IAAQH;AACvB,sBAAMj9F,MACJ,YACE,KAAKN,OACL,uBAEA09F,IACA,gBANE;AASR,kBAAIF,EAAgBE,CAAhB;AACF,sBAAMp9F,MACJ,YACE,KAAKN,OACL,uBAEA09F,IACA,cANE;AASRF,gBAAgBE,CAAhB,IAAyB;AACzBD;YAxBA;UAFsC;AA4BxC,cAAIA,MAAqBF;AACvB,kBAAMj9F,MACJ,YACE,KAAKN,OACL,uCAEAu9F,IACA,UANE;QAhC+D;QAuDjEL,sBACNjrE,GACA8R,GACAi5D,GAAiC;AAEjC,gBAAMzc,IAAW,CAAA;AACjB,mBAAS59E,IAAI,GAAGA,IAAIsvB,EAAO5vB,QAAQM,KAAK;AACtC,gBAAIsC,IAAUgtB,EAAOtvB,CAAP;AACS,yBAAnB,OAAOsC,MACTA,IAAU8+B,EAAK9+B,IAAU,CAAf;AAGZ,gBAAuB,aAAnB,OAAOA;AACT,kBAAgB,SAAZA;AAEI04F,oBAAe,EAAC,MAAQ,gBAAT,GACjBX,MACDW,EAAA,QAA+CX;uBAMlD/3F,IAAU,KAAK24F,mBAAmB34F,CAAxB,GACN,CAACA;AACH;;AAINs7E,cAAS99E,KAAKwC,CAAd;UAvBsC;AA2BxC,WADM5C,IAASk+E,EAASl+E,WAGtB,CAAC,KAAK+6F,gBACH7c,EAAgCl+E,IAAS,CAAzC,EAAA,IADF,MAIKw7F,IAAa,EAAC,MAAQ,cAAT,GACfb,MACDa,EAAA,QAA6Cb,IAEhDzc,EAAS99E,KAAKo7F,CAAd;AAGF,iBAAOtd;QA3C0B;QAsD3B+c,eAAer4F,GAItB;AACC,gBAAM+Y,IAAsBn0B,EAAAA,+CAASob,CAAvB;iBACV,CAAC+Y,KAAS/Y,EAAA,MACkB,aAA1B,OAAOA,EAAA,OACHqB,IAAO,KAAKs3F,mBAAmB34F,EAAA,GAAxB,KACC,KAAKq4F,eAAeh3F,CAApB,IAA4B,OAErC,KAAKg3F,eAAer4F,EAAA,GAApB,IAEF+Y;QATR;QAsBOq/E,eACNp4F,GACAo3F,GAAqB;AAErB,cAAMyB,IAAkB,EACtB,MAAQ7O,EAAAA,0CAAMl3E,MACd,OAASk3E,EAAAA,0CAAMr2E,OACf,QAAUq2E,EAAAA,0CAAMC,QAChB,QAAUD,EAAAA,0CAAMC,OAJM;AAOxB,cAAIhrE;AACJ,kBAAQjf,EAAA,MAAR;YACE,KAAK;AACHif,kBAAQ,KAAK43E,iBAAiB72F,EAAA,IAAtB;AACR;YACF,KAAK;AACHif,kBAAQ,KAAK83E,qBAAqB/2F,EAAA,IAA1B;;YAEV,KAAK;AACHif,kBAAQ,KAAK+3E,iBAAiBh3F,EAAA,IAAtB;AACR;YACF,KAAK;AACHif,kBAAQ,KAAKg4E,kBAAkBj3F,EAAA,IAAvB;AACR;YACF;AACEif,kBAAQ,KAAKi4E,wBAAwBl3F,EAAA,MAAiBA,EAAA,IAA9C;UAdZ;AAmBA,cAAI,CAACif;AACH,mBAAO;AAGLjf,YAAA,SACFif,EAAMgsE,SAASjrF,EAAA,KAAf;AAEEA,YAAA,UACI84F,IAAaD,EACjB74F,EAAA,MAAiByR,YAAjB,CADiB,GAGDrT,WAAd06F,IACF98F,QAAQxG,KAAK4hG,IAAgB,yBAAyBp3F,EAAA,KAAtD,IAEAif,EAAMksE,SAAS2N,CAAf;AAGJ,iBAAO75E;QA9Cc;QAwDfk5E,gBAAgBtvE,GAAW;AACjC,iBACU,kBAARA,KACQ,sBAARA,KACQ,kBAARA,KACQ,oBAARA,KACSjlC;YAAiBuX,qCAAK00C;YAAOhnB;UAAtC;QAN+B;QAiB3B8vE,mBAAmB9vE,GAAW;AAEpC,kBADAA,IAAMA,EAAIztB,KAAJ,KAEG,EACL,MAAQ,eACR,MAAQytB,EAFH,IAKF;QAR6B;QAkBtCkwE,gBAAgB/9F,GAAcg+F,GAAsB;AAClD,cAAIh+F,MAASg+F,GAAb;AAIA,gBAAIC,IAAa,IACbC,IAAWF,IAAU,KAAK,KAAKh6E,UAAU5hB;AAC7C,qBAASM,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,kBAAIuhB,EAAMjkB,SAASA,GAEjB;AAAA,oBADAi+F,IAAav7F,GACI,OAAbw7F;AACF;cADF,WAGSF,KAAW/5E,EAAMjkB,SAASg+F,MACnCE,IAAWx7F,GACQ,OAAfu7F;AACF;AAIN,gBAAmB,OAAfA;AACF,oBAAM59F,MAAM,kBAAkBL,IAAO,cAA/B;AAER,gBAAiB,OAAbk+F;AACF,oBAAM79F,MAAM,sBAAsB29F,IAAU,cAAtC;AAER,iBAAKG,wBAAwBF,GAAYC,CAAzC;UAzBA;QADkD;QAmCpDC,wBAAwBF,GAAoBC,GAAgB;AAE1D,cAAID,MAAeC;AACjB,kBAAM79F,MAAM,6BAAN;AAER,cAAI49F,KAAc,KAAKj6E,UAAU5hB;AAC/B,kBAAMg8F,WAAW,iBAAiBH,IAAa,iBAAzC;AAER,cAAIC,IAAW,KAAKl6E,UAAU5hB;AAC5B,kBAAMg8F,WAAW,qBAAqBF,IAAW,iBAA3C;AAGR,gBAAMj6E,IAAQ,KAAKD,UAAUi6E,CAAf;AACd,eAAKj6E,UAAU1gB,OAAO26F,GAAY,CAAlC;AACIA,cAAaC,KACfA;AAGF,eAAKl6E,UAAU1gB,OAAO46F,GAAU,GAAGj6E,CAAnC;QAlB0D;QA8B5Do6E,YAAYr+F,GAAc4vF,GAAmB;AAC3C,mBAASltF,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,gBAAIuhB,EAAMjkB,SAASA;AAIjB,qBAHIikB,aAAiB2vB,gEAAgB,KAAK8jD,uBAC1CzzE,EAAM/uB,QAAN,GACA,KAAK8uB,UAAU1gB,OAAOZ,GAAG,CAAzB,GACO;AAGX,cAAIktF;AACF,mBAAO;AAET,gBAAMvvF,MAAM,sBAAsBL,CAA5B;QAZqC;QAqB7CqnB,SAASrnB,GAAY;AACnB,mBAAS0C,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,gBAAIuhB,EAAMjkB,SAASA;AACjB,qBAAOikB;AAIX,iBAAO;QAPY;QAiBrBq6E,oBAAoBt+F,GAAY;AAE9B,kBADMikB,IAAQ,KAAKoD,SAASrnB,CAAd,MACEikB,EAAMG,cAAcH,EAAMG,WAAWK,YAAjB;QAFN;QAUhC4R,iBAAc;AAEL/V,cAAAA,GAAA;AAAP,iBAAO,SAAA,IAAA,SAAAA,IADS,KAAKsG,QAAQ0P,iDAASC,OAAtBjW,KACT,SAAAA,EAASK,QAAT,KAAA,IAAsB;QAFjB;QAUdwZ,eAAevqB,GAAmB;AAEhB0Q,cAAAA;AAAA,cAAA;AAAhB,gBAAMikC,IAAU,SAAA,IAAA,SAAAjkC,IADA,KAAKsG,QAAQ0P,iDAASC,OAAtBjW,KACA,SAAAA,EAASK,QAAT,KAAA,IAAsB;AACtC,cAAI4jC,MAAY30C,GAAhB;AACA,gBAAa,SAATA,GAAe;AACb0Q,kBAAU,KAAKsG,QAAQ0P,iDAASC,OAAtB;kBACV,CAACjW,GAAS;AACNi+E,oBAA8B11G,yCACzBsX,qCAAK2mB,MACdwP,iDAASC,QAAQ30B,SAAjB,GACA,KAHyB;AAK3B,oBAAI,CAAC28F;AACH,wBAAUl+F,MACR,iEADI;AAIFujB,oBAAO,IAAI26E,EAAmB,IAAvB;AACb,oBAAI,CAACtiG,+DAAc2nB,CAAd;AACH,wBAAUvjB,MACR,uFADI;AAKRigB,oBAAU,KAAK0G,QAAQpD,CAAb;cAlBE;AAoBHle,gBAAAA,4CAAX;AACA4a,gBAAQgB,QAAQ1R,CAAhB;gBACWhK,2CAAX;YAxBiB;AA0BjB,mBAAK44F,WAAWloE,iDAASC,OAAzB;AAGSntC,qDACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,MACA,WACA,MACA0f,GACA30C,CALF,CADF;UA9BA;QAHgC;QAmDlC6uF,eAAeC,GAAsBC,GAAgB;QAAA;QASrDp/D,WAAWq/D,GAAqB;QAAA;QAKhC53E,QAAyBpD,GAAO;AAC9B,cAAI,KAAK2vB,QAAQ3vB,EAAKE,QAAL,CAAb;AAA8B,kBAAM,IAAI64D,0DAAkB/4D,CAAtB;AACxC,eAAKD,MAAMnhB,KAAKohB,CAAhB;AACA,eAAKD,MAAMtI,KAAK,CAAC8Q,GAAG7M,MAAM6M,EAAEwa,UAAF,IAAgBrnB,EAAEqnB,UAAF,CAA1C;iBACO/iB;QAJuB;QAchC46E,WAAWz+F,GAAqB;AAC9B,cAAI,CAAC,KAAKwzC,QAAQxzC,CAAb;AAAoB,mBAAO;AAChC,cAAA;AAAA,mBAAA,IAAA,KAAK6mB,QAAQ7mB,CAAb,MAAA,EAAoB7K,QAApB;AACA,eAAKyuB,QAAQ,KAAKA,MAAMp6B,OAAQq6B,OAAS,CAACA,EAAKE,QAAL,EAAeof,OAAOnjC,CAAtB,CAA7B;AACb,iBAAO;QAJuB;QAWhCwzC,QAAQxzC,GAAqB;AAC3B,iBAAO,KAAK4jB,MAAMnG,KAAMoG,OAASA,EAAKE,QAAL,EAAeof,OAAOnjC,CAAtB,CAA1B;QADoB;QAU7B6mB,QAAyB7mB,GAA0B;AACjD,iBAAIA,aAAgBu2B,mDACX,KAAK3S,MAAMk7E,KAAMj7E,OAASA,EAAKE,QAAL,EAAeof,OAAOnjC,CAAtB,CAA1B,IAEA,KAAK4jB,MAAMk7E,KAAMj7E,OAASA,EAAKE,QAAL,EAAeliB,SAAf,MAA8B7B,CAAxD;QAJwC;QASnD8jB,WAAQ;AACN,iBAAO,CAAC,GAAG,KAAKF,KAAT;QADD;QAURjE,yBAAsB;AACpB,iBAAO,KAAKk4E;QADQ;QAWtBh9F,OAAOk0B,GAAYG,GAAYvqB,GAAiB;AAC9C,cAAI,KAAKsyF;AACP,kBAAM32F,MAAM,kBAAN;AAER,gBAAM4B,IAAQ,KAAgBpY,wCAAe++C,EAAAA,wCAA1B,GACjB,IADY;AAGdlkC,eAAUzC,EAAM0iD,UAAUjgD,CAAhB;AACV,eAAKkzF,IAAIt1E,UAAUwM,GAAIG,CAAvB;AACAhtB,YAAM2iD,UAAN;AACWx7D,mDAAK6Y,CAAhB;QAV8C;QAoBhDouF,gBAAgBtwF,GAAoB;AAClC,iBAAO,IAAI8hF,6CAAW,MAAM9hF,CAArB;QAD2B;QAYpC++F,gBAAgBC,GAAmC;AAEf37F,qBAA9B27F,MACFA,IAA4B;AAE9B,cAAI,CAACA,KAA6B,KAAKr6E,SAAL;AAChC,mBAAO;AAIT,mBAAShiB,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClD,gBAAKuhB,EAAMG,YAAX;AAGA,kBAAM9Y,IAAS2Y,EAAMG,WAAWK,YAAjB;AACf,kBAAI,CAACnZ,KAAU,CAACA,EAAOwzF,gBAAgBC,CAAvB;AACd,uBAAO;YALT;AAWF,kBADM/kE,IAAO,KAAKzyB,aAAL,KAEJyyB,EAAK8kE,gBAAgBC,CAArB,IAGF;QA1B0C;QAuCnD5wC,cAAW;AACT,cAAIjtD,IAAM,KAAKnB,OAAO,MAAM,KAAKA,OAAO,YAAY;AAChD,eAAKqG,OACPlF,KAAO,WAAW,KAAKkF,KAAK;AAE9B,iBAAOlF;QALE;MA34EP;AASYw1F,yCAAA/zC,uBAAyCA;AAGzC+zC,yCAAA9zC,uBAAyCA;AAvE3D,UAAAvN,8BAAA,CAAA;AA2DaqhD,kCAAAA,QAAAA;AChCP,UAAOsI,oDAAP,MAAA;QA4CJn4E,YACmBvgB,GACAiY,GACjBlY,GACiB44F,GAAsB;AAHtB,eAAA34F,YAAAA;AACA,eAAAiY,kBAAAA;AAEA,eAAA0gF,gBAAAA;AAhCX,eAAAC,mBAA8C;AAOtD,eAAAr2F,SAHA,KAAAF,QAAQ;AAeR,eAAA+nD,YANQ,KAAAyuC,UAHA,KAAAhkE,WAA+B;AAwBrC,eAAKvrB,OAAOvJ,EAAA;AAEZ,eAAKgK,WAAW,IAAIkB,mDAAW,GAAG,CAAlB;AAGhB,eAAK6tF,cACF/4F,EAAA,eAIAA,EAAA;AAGH,eAAKipF,WAAYjpF,EAA4B,WAA5B,KAA4C;AAG7D,eAAKslF,OAAOtlF;QAlB2B;QA0BzC1T,YAAS;AACP,cAAI28F,IAAW,KAAK2P,gBAChB,uBACA;eACK3P,aACPA,KAAY,MAAM,KAAKA;AAGzB,eAAKn0D,WAAevvC,kDAClBqwC,qCAAI8e,GACJ,EAAC,SAASu0C,EAAV,GACA,KAAKhpF,UAAU6qE,UAAf,CAHc;AAMhB,cAAI5sD;AACC,eAAK06E,kBAER16E,IAAa34B,kDACXqwC,qCAAIof,MACJ,EACE,SAAS,6BACT,IAAM2jD,kDAAaK,eACnB,IAAML,kDAAaK,eACnB,GAAK,GACL,GAAK,EALP,GAOA,KAAKlkE,QATE;AAaLQ,cAAW/vC;YACfqwC,qCAAIof;YACJ,EACE,SAAS,KAAK4jD,gBACV,iCACA,iCACJ,IAAMD,kDAAaK,eACnB,IAAML,kDAAaK,cALrB;YAOA,KAAKlkE;UATM;AAYb,gBAAMgkE,IAAcvzG,kDAClBqwC,qCAAIqf,MACJ,EACE,SAAS,KAAK2jD,gBAAgB,2BAA2B,eACzD,GAAK,GACL,GAAK,GACL,eAAe,SAJjB,GAMA,KAAK9jE,QARS;AAUhB,cAAIvrB,IAAexZ,8DAAyB,KAAKwZ,IAAtC;eACFtJ,UAAU0R,QAEjBpI,KAAQ;AAEVuvF,YAAQ7vF,cAAcM;AAClB,eAAKqvF,kBACP,KAAKE,UAAUA,GACf,KAAK74F,UACFypC,gBADH,EAEGC,UAAU,KAAKmvD,SAAS,0BAA0B,MAFrD;AAKF,gBAAM1vF,IAAiB5iB,oDAAiBsyG,GAAS,UAAhC,GACXzvF,IAAmB7iB,oDAAiBsyG,GAAS,YAAhC,GACbxvF,IAAmB9iB,oDAAiBsyG,GAAS,YAAhC;AACnB,eAAKx2F,QAAYnc,gEACf2yG,GACA1vF,GACAC,GACAC,CAJW;AAMPu5E,cAAkBz8F;YACtBmjB;YACAH;YACAC;YACAC;UAJkB;AAMpB,eAAK9G,SAASqgF,EAAYrgF;AAE1B,cAAI,CAAC,KAAKo2F,eAAe;AACvB,iBAAKt2F,SAAS,IAAIq2F,kDAAaM;AAC/B,iBAAKz2F,UAAU,IAAIm2F,kDAAaO;AAChCh7E,gBAAAA;AAAA,qBAAAA,IAAAA,MAAAA,EAAQxb,aAAa,SAASjI,OAAO,KAAK6H,KAAZ,CAA9B;AACA4b,gBAAAA;AAAA,qBAAAA,IAAAA,MAAAA,EAAQxb,aAAa,UAAUjI,OAAO,KAAK+H,MAAZ,CAA/B;UAJuB;AAMzB8yB,YAAK5yB,aAAa,SAASjI,OAAO,KAAK6H,KAAZ,CAA3B;AACAgzB,YAAK5yB,aAAa,UAAUjI,OAAO,KAAK+H,MAAZ,CAA5B;AAEAs2F,YAAQp2F,aAAa,KAAKjI,OAAO,KAAK6H,QAAQ,CAApB,CAA1B;AACAw2F,YAAQp2F,aACN,KACAjI,OAAO,KAAK+H,SAAS,IAAIqgF,EAAYrgF,SAAS,IAAIqgF,EAAYz4E,QAA9D,CAFF;AAKA,eAAK+uF,gBAAL;AAIA,eAAKN,mBAAiC/zG,sDACpC,KAAKgwC,UACL,aACA,MACA,KAAKskE,SAJiB;AAMxB,iBAAO,KAAKtkE;QA3GL;QA+GT7nC,OAAI;AACF,eAAKksG,gBAAL;AACA,eAAKrkE,SAAUpyB,aAAa,WAAW,OAAvC;QAFE;QAMIy2F,kBAAe;AACrB,eAAKrkE,SAAUpyB,aACb,aACA,eAAe,KAAKsH,SAASpE,IAAI,MAAM,KAAKoE,SAASlE,IAAI,GAF3D;QADqB;QAavBxR,OAAOsR,GAAWE,GAAS;AACzB,eAAKkE,SAASpE,IAAIA;AAClB,eAAKoE,SAASlE,IAAIA;AAClB,eAAKqzF,gBAAL;QAHyB;QAO3BE,UAAO;AACL,iBAAO,KAAKT;QADP;QAUP1pG,cAAW;AACT,iBAAO,KAAK8a;QADH;QAKXsvF,gBAAa;AACX,iBAAO,KAAK/vF;QADD;QASboL,qBAAkB;AAChB,iBAAO,KAAKuD;QADI;QASlBmmB,eAAY;AACV,iBAAO,KAAKp+B;QADF;QAKZpR,UAAO;AACD,eAAKgqG,oBACO7zG,6CAAO,KAAK6zG,gBAA1B;AAEE,eAAK/jE,YACHlvC,4CAAW,KAAKkvC,QAApB;AAEE,eAAKgkE,WACP,KAAK74F,UAAUypC,gBAAf,EAAiCsN,YAAY,KAAK8hD,OAAlD;QARG;QAkBP1uC,aAAaC,GAAqB;AAC3BA,cAID,KAAKv1B,aACP,KAAKA,SAASxtB,YAAY+iD,CAA1B,GACA,KAAKA,YAAYA,KALjB,KAAKA,YAAY;QAFa;QAgBlCR,eAAY;AACV,gBAAU7vD,MAAM,wCAAV;QADI;QASJo/F,UAAUl9F,GAAe;AAE/B,WADMyH,IAAU,KAAKuU,gBAAgBq4C,WAAWr0D,CAAhC,MAEdyH,EAAQo1D,OAAR;AAGE,eAAK6/B,iBAAiB,KAAKG,cAC7Bp+F,QAAQxG,KACN,mDAAmD,KAAKoV,IAD1D,IAIC,KAAKqvF,iBAEJ,KAAKG,eACL,KAAK7gF,gBAAgBqhF,kBAAkB,KAAKR,WAA5C,IAIQ,KAAKH,kBACT9zF,IAAW,KAAKoT,gBAAgBqhF,kBAAkB,KAAKR,WAA5C,MAEfj0F,EAAS,IAAT,IAJFnK,QAAQxG,KAAK,iDAAiD,KAAKoV,IAAnE;QAjB6B;MApS7B;AAEGovF,wDAAAM,gBAAgB;AAGhBN,wDAAAO,gBAAgB;AAGhBP,wDAAAK,gBAAgB;AAwTrB72G,0CAAS,2QAAb;UA3VA6sD,sCAAA,CAAA;AA2Ba2pD,0CAAAA,eAAAA;AtIKP,UAAOa,uDAAP,MAAA;QA0BJh5E,YAAY9mB,GAAckkD,GAA4B67C,GAAmB;AARjE,eAAAC,eAA2B;AASjC,cAAI,CAAC97C;AACH,kBAAM5jD,MAAM,0CAAN;AAOR,eAAKN,OAAOA;AAGZ,eAAKigG,uBAAuBH,qDAAQI,iBAAiBlgG,CAAzB;AAG5B,eAAKkkD,WAAWA;AAEhB,eAAKi8C,cAAcJ,KAAc,IAAjC;QAjBuE;QAyBjEI,cAAc7iF,GAAqB;AACpCA,eAGDA,EAAO0iF,iBACT,KAAKA,eAAe1iF,EAAO0iF;QALY;QAiB3CI,cAAW;AACT,iBAAO,KAAKl8C;QADH;QAUXngC,UAAO;AACL,iBAAO,KAAK/jB;QADP;QAUPqgG,kBAAe;AACb,iBAAO,KAAKL;QADC;QAUfM,eAAY;AACV,iBAAO,KAAKL;QADF;QAYJM,mBAAgB;AAEtB,cAAMnpC,IADW,KAAKlT,SACOiT,eAAT;AACpB,gBAAM/hE,IAAQgiE,EAAavxC,eAAb;AAGR26E,cAASprG,EAAO6uB,UAAU3a,QAAQ8tD,CAAzB;AACf,eAAaopC,KAAS,GAAG79F,IAAIvN,EAAO6uB,UAAU5hB,QAAQM,KAAK;AACzD,kBAAMuhB,IAAQ9uB,EAAO6uB,UAAUthB,CAAjB,GACRwhB,IAAWD,EAAMC;AACvB,qBAASlN,IAAI,GAAGA,IAAIkN,EAAS9hB,QAAQ4U,KAAK;AACxC,oBAAM+G,IAAQmG,EAASlN,CAAT;AACd,kBAAI+G,EAAM81C,YAAN,KAAuBgsC,qDAAQW;AACjC,uBAAOX,qDAAQY,gBAAgB1iF,CAAxB;YAH+B;AAM1C,gBAAIkG,EAAMG;AACR,qBAAOy7E,qDAAQa,gBAAgBz8E,CAAxB;UAVgD;AAa3D,iBAAO;QApBe;QA8BhB08E,mBAAgB;AACtB,cAAM18C,IAAW,KAAKA,UAChBhgC,IAAQggC,EAASiT,eAAT;AACd,gBAAM/hE,IAAQ8uD,EAASr+B,eAAT;AACd,cAAI,CAACzwB;AACH,kBAAUkL,MACR,yDADI;AAIR,cAAMkgG,IAASprG,EAAM6uB,UAAU3a,QAAQ4a,CAAxB;AAEf,eADI28E,IAAW38E,EAAMC,SAAS7a,QAAQ46C,CAAvB,IAAmC,GAC7BvhD,IAAIvN,EAAM6uB,UAAU5hB,QAAQM,KAAK;AAC9Cm+F,gBAAW1rG,EAAM6uB,UAAUthB,CAAhB;AACjB,kBAAMwhB,IAAW28E,EAAS38E;AAC1B,mBAAO08E,IAAW18E,EAAS9hB,UAAQ;AACjC,kBAAI8hB,EAAS08E,CAAT,EAAmB/sC,YAAnB,KAAoCgsC,qDAAQW;AAC9C,uBAAOX,qDAAQY,gBAAgBv8E,EAAS08E,CAAT,CAAxB;AAETA;YAJiC;AAMnCA,gBAAW;AACX,gBAAIC,EAASz8E;AACX,qBAAOy7E,qDAAQa,gBAAgBG,CAAxB;UAX2C;AActD,iBAAO;QAzBe;QAmChBC,mBAAgB;AAEtB,gBAAM3pC,IADW,KAAKlT,SACOiT,eAAT,GACd/hE,IAAQgiE,EAAavxC,eAAb;AAId,mBADM26E,IAASprG,EAAO6uB,UAAU3a,QAAQ8tD,CAAzB,GACW,KAALz0D,GAAQA,KAAK;AAChC,gBAAMuhB,IAAQ9uB,EAAO6uB,UAAUthB,CAAjB;AACd,gBAAIuhB,EAAMG,cAAcH,MAAUkzC;AAChC,qBAAO0oC,qDAAQa,gBAAgBz8E,CAAxB;AAEHC,gBAAWD,EAAMC;AACvB,qBAASlN,IAAIkN,EAAS9hB,SAAS,GAAQ,KAAL4U,GAAQA,KAAK;AAC7C,oBAAM+G,IAAQmG,EAASlN,CAAT;AACd,kBAAI+G,EAAM81C,YAAN,KAAuBgsC,qDAAQW;AACjC,uBAAOX,qDAAQY,gBAAgB1iF,CAAxB;YAHoC;UANf;AAalC,iBAAO;QApBe;QA6BhBgjF,mBAAgB;AACtB,cAAM98C,IAAW,KAAKA;AACtB,gBAAMkT,IAAclT,EAASiT,eAAT,GACd/hE,IAAQ8uD,EAASr+B,eAAT;AACd,cAAI,CAACzwB;AACH,kBAAUkL,MACR,yDADI;AAIR,cAAMkgG,IAASprG,EAAM6uB,UAAU3a,QAAQ8tD,CAAxB;AAEf,eADIypC,IAAWzpC,EAAYjzC,SAAS7a,QAAQ46C,CAA7B,IAAyC,GAC9B,KAALvhD,GAAQA,KAAK;AAChC,gBAAMuhB,IAAQ9uB,EAAM6uB,UAAUthB,CAAhB;AACd,gBAAIuhB,EAAMG,cAAcH,MAAUkzC;AAChC,qBAAO0oC,qDAAQa,gBAAgBz8E,CAAxB;AAGT,iBADMC,IAAWD,EAAMC,UACL,KAAX08E,KAAe;AACpB,kBAAI18E,EAAS08E,CAAT,EAAmB/sC,YAAnB,KAAoCgsC,qDAAQW;AAC9C,uBAAOX,qDAAQY,gBAAgBv8E,EAAS08E,CAAT,CAAxB;;YAFW;AAQT,iBAATl+F,IAAI,MACNk+F,IAAWzrG,EAAM6uB,UAAUthB,IAAI,CAApB,EAAuBwhB,SAAS9hB,SAAS;UAftB;AAkBlC,iBAAO;QA7Be;QAuChB4+F,sBAAsBx9F,GAAgB;AAC5C,cAAIy9F,IAAc,KAAKd,YAAL;AAGlB,cAAKc,EAA0Cr7E,gBAAgB;AAC7D,gBAAMzwB,IAAS8rG,EAA0Cr7E,eAA1C;AACXzwB,kBACF8rG,IAAc9rG;UAH6C;AAS/D,cAAI,CAAC+rG,KAAsBA,EAAmBruD,cAAnB;AACzB,mBAAO;AAET,cAAIquD,EAAmB56F,UAAUgY;AAC/B,mBAAO,KAAK6iF,uBAAuB39F,CAA5B;AAEH49F,cAAUF,EAAmBr4D,aAAnB;AACVK,cAAYk4D,EAAQ96F,UAAUsvB,aAAa,IAA/B;AAClB,mBAASlzB,IAAI,GAAGA,IAAIwmC,EAAU9mC,QAAQM;AAEpC,gBAAI0+F,EAAQh7F,OADK8iC,EAAUxmC,CAAVk3B,EACWxzB;AAG1B,qBADMi7F,IAAc3+F,KADLc,IAAU,IAAI,KAET,OAAhB69F,KAAsBA,MAAgBn4D,EAAU9mC,SAC3C,OAEFy9F,qDAAQyB,gBAAgBp4D,EAAUm4D,CAAV,CAAxB;AAGX,gBAAMhhG,MACJ,oBAAoBmD,IAAU,SAAS,cAAc,UADjD;QAhCsC;QA2CtC29F,uBAAuB39F,GAAgB;AAE7C,cAAIygD;AAGJ,kBAJiB,KAAKngC,QAALvN,GAIjB;YACE,KAAKspF,qDAAQ0B,MAAMC;AACjBv9C,kBAAW,KAAKk8C,YAAL;AAEX,kBAAA5hF,IADkB0lC,EAAS39C,UACCiY;AAC5B;YAEF,KAAKshF,qDAAQ0B,MAAME;AACjBx9C,kBAAW,KAAKk8C,YAAL;AACX5hF,kBAAkB0lC,EAASjpC,mBAAT;AAClB;YAEF;AACE,qBAAO;UAbX;AAgBMy0B,cAASlxB,EAAgB+xB,UAAhB;AACf,iBAAKb,KAECiyD,IAAW,KAAKC,yBACpBlyD,EAAOmyD,YAAP,GACA39C,GACAzgD,CAHe,KAOK,aAAlBk+F,EAAS3hG,QAAqB2hG,EAAS71F,SAClCg0F,qDAAQgC,iBAAiBH,EAAS71F,MAAlC,IACoB,YAAlB61F,EAAS3hG,QAAoB2hG,EAASvsG,QACxC0qG,qDAAQyB,gBAAgBI,EAASvsG,KAAjC,IAGF,OARe,OAPF;QAtByB;QAgDvCwsG,yBACNG,GACAC,GACAv+F,GAAgB;AAEhB,gBAAMw+F,IAAeF,EAAeG,UAAWzrF,OACzCurF,aAA2BrL,sCAASlgF,EAAKrhB,UAAU4sG,KAIrDA,aAA2B/C,qDAC3BxoF,EAAK3K,WAAWk2F,IAET,OAEF,KAVY;AAarB,cAAmB,IAAfC;AAAkB,mBAAO;AAEvBX,cAAc79F,IAAUw+F,IAAe,IAAIA,IAAe;AAChE,iBAAoB,OAAhBX,KAAsBA,MAAgBS,EAAe1/F,SAChD,OAGF0/F,EAAeT,CAAf;QAtBS;QAiCVa,uBAAuB/sG,GAAY;AACzC,gBAAMgyC,IAAgBjrC,iEAAoB/G,CAApB;AACtB,iBAAIgyC,IACK04D,qDAAQsC,qBAAqBh7D,CAA7B,IAEA04D,qDAAQuC,gBAAgBjtG,CAAxB;QALgC;QAiBnCktG,sBAAsBltG,GAAY;AACxC,cAAI,CAACA;AACH,mBAAO;AAIHykC,cAAWzkC,EAAMkkG,iBAAN;AACjB,gBAAMlyD,IAAgBjrC,iEAAoB09B,CAApB;AAGtB,iBACEuN,KACAA,EAAcjB,oBACdiB,EAAcjB,iBAAiBgxB,eAA/B,IAIO2oC,qDAAQa,gBACbv5D,EAAcjB,iBAAiBgxB,eAA/B,CADK,IAKA2oC,qDAAQyB,gBAAgB1nE,CAAxB;QAtB+B;QAkClC0oE,sBAAsBntG,GAAY;AAClCgvB,cAAShvB,EAAM6uB;AACrB,mBAASthB,IAAI,GAAGA,IAAIyhB,EAAO/hB,QAAQM,KAAK;AACtC,kBAAMuhB,IAAQE,EAAOzhB,CAAP,GACRwhB,IAAWD,EAAMC;AACvB,qBAASlN,IAAI,GAAGA,IAAIkN,EAAS9hB,QAAQ4U,KAAK;AACxC,oBAAM+G,IAAQmG,EAASlN,CAAT;AACd,kBAAI+G,EAAM81C,YAAN,KAAuBgsC,qDAAQW;AACjC,uBAAOX,qDAAQY,gBAAgB1iF,CAAxB;YAH+B;AAM1C,gBAAIkG,EAAMG;AACR,qBAAOy7E,qDAAQa,gBAAgBz8E,CAAxB;UAV6B;AAaxC,iBAAO;QAfiC;QAwB1C2B,iBAAc;AACZ,iBAAI,KAAK9B,QAAL,MAAmB+7E,qDAAQ0B,MAAMluD,QAC5B,KAAK8sD,YAAL,IACE,KAAKr8E,QAAL,MAAmB+7E,qDAAQ0B,MAAMC,QACnC,KAAKrB,YAAL,IACE,KAAKr8E,QAAL,MAAmB+7E,qDAAQ0B,MAAM3vD,YACnC,OACE,KAAK9tB,QAAL,MAAmB+7E,qDAAQ0B,MAAME,SACnC,OAEC,KAAKtB,YAAL,EAAiDv6E,eAAjD;QAVE;QAoBdoU,OAAI;AACF,kBAAQ,KAAKj6B,MAAb;YACE,KAAK8/F,qDAAQ0B,MAAMC;AACjB,qBAAO,KAAKR,sBAAsB,IAA3B;YAET,KAAKnB,qDAAQ0B,MAAMgB;AAEjB,qBAAO1C,qDAAQuC,gBADI,KAAKn+C,SACkBr+B,eAAX,CAAxB;iBAEJi6E,qDAAQ0B,MAAMxgG;AACjB,qBAAO,KAAK4/F,iBAAL;YAET,KAAKd,qDAAQ0B,MAAM1sD;AACjB,qBAAO,KAAKyrD,iBAAL;YAET,KAAKT,qDAAQ0B,MAAMluD;AAEjB,oBAAM/uB,IADQ,KAAK2/B,SACU3/B;AAC7B,kBAAI,CAACA;AAAgB;AACrB,qBAAOu7E,qDAAQsC,qBAAqB79E,CAA7B;YAET,KAAKu7E,qDAAQ0B,MAAMiB;AAEjB,qBAAO3C,qDAAQuC,gBADI,KAAKn+C,SACkBr+B,eAAX,CAAxB;iBAEJi6E,qDAAQ0B,MAAMkB;AAGjB,qBAAO5C,qDAAQsC,qBAFI,KAAKl+C,SACY/d,gBAC7B;YAET,KAAK25D,qDAAQ0B,MAAME;AACjB,qBAAO,KAAKN,uBAAuB,IAA5B;UA9BX;AAiCA,iBAAO;QAlCL;QA4CJuB,KAAE;AACA,kBAAQ,KAAK3iG,MAAb;YACE,KAAK8/F,qDAAQ0B,MAAM3vD;AAEjB,oBAAM1I,IADY,KAAK+a,SACKruB,aAAa,IAAvB;AAClB,kBAAuB,IAAnBsT,EAAU9mC;AACZ,uBAAOy9F,qDAAQyB,gBAAgBp4D,EAAU,CAAV,CAAxB;;YAIX,KAAK22D,qDAAQ0B,MAAMC;AAEjB,qBAAO,KAAKU,uBADE,KAAKj+C,QACZ;YAET,KAAK47C,qDAAQ0B,MAAMluD;AAEjB,qBAAO,KAAKivD,sBADE,KAAKr+C,QACZ;YAET,KAAK47C,qDAAQ0B,MAAM1sD;AAGjB,qBAAOgrD,qDAAQsC,qBAFI,KAAKl+C,SACY/d,gBAC7B;UApBX;AAwBA,iBAAO;QAzBP;QAkCFisD,OAAI;AACF,kBAAQ,KAAKpyF,MAAb;YACE,KAAK8/F,qDAAQ0B,MAAMC;AACjB,qBAAO,KAAKR,sBAAsB,KAA3B;iBAKJnB,qDAAQ0B,MAAMxgG;AACjB,qBAAO,KAAKggG,iBAAL;YAET,KAAKlB,qDAAQ0B,MAAM1sD;AACjB,qBAAO,KAAKisD,iBAAL;YAET,KAAKjB,qDAAQ0B,MAAMluD;AAEjB,kBAAMlM,IAAgBjrC,iEADR,KAAK+nD,QACG;AACtB,kBAAI,CAAC9c;AAAe;AACpB,qBAAO04D,qDAAQsC,qBAAqBh7D,CAA7B;YAET,KAAK04D,qDAAQ0B,MAAMiB;AAGjB,mBADMt8D,IADa,KAAK+d,SACY/d,qBACZ,CAACA,EAAiBgxB,eAAjB;AACvB,uBAAO2oC,qDAAQsC,qBAAqBj8D,CAA7B;AAET;YAEF,KAAK25D,qDAAQ0B,MAAMkB;AAEjB,qBAAO5C,qDAAQuC,gBADI,KAAKn+C,SACkBr+B,eAAX,CAAxB;YAET,KAAKi6E,qDAAQ0B,MAAME;AACjB,qBAAO,KAAKN,uBAAuB,KAA5B;UAhCX;AAmCA,iBAAO;QApCL;QA8CJwB,MAAG;AACD,kBAAQ,KAAK5iG,MAAb;YACE,KAAK8/F,qDAAQ0B,MAAMC;AACjB,kBAAMrsG,IAAQ,KAAK8uD,UACb2+C,IAAWztG,EAAMuqB,uBAAN;AAEXqgF,kBAAe,IAAIxuF,mDACvBqxF,EAAS32F,GACT22F,EAASz2F,IAAI0zF,qDAAQgD,gBAFF;AAIrB,qBAAOhD,qDAAQiD,oBAAoB3tG,EAAMmR,WAAWy5F,CAA7C;YAET,KAAKF,qDAAQ0B,MAAMgB;AAGjB,qBAFMn+E,IAAa,KAAK6/B,WAClB34C,IAAS8Y,EAAW8hB,oBAEjB25D,qDAAQsC,qBAAqB72F,CAA7B,IAEFu0F,qDAAQyB,gBAAgBl9E,EAAWwB,eAAX,CAAxB;iBAEJi6E,qDAAQ0B,MAAMxgG;AAEX5L,kBADQ,KAAK8uD,SACCr+B,eAAN;AACd,kBAAI,CAACzwB;AACH,sBAAUkL,MACR,yDADI;AAIR,qBAAOw/F,qDAAQuC,gBAAgBjtG,CAAxB;YAET,KAAK0qG,qDAAQ0B,MAAM1sD;AAEjB,qBAAOgrD,qDAAQuC,gBADI,KAAKn+C,SACkBr+B,eAAX,CAAxB;YAET,KAAKi6E,qDAAQ0B,MAAMluD;AAEjB,qBAAO,KAAKgvD,sBADE,KAAKp+C,QACZ;iBAEJ47C,qDAAQ0B,MAAMiB;AAEjB,qBAAO,KAAKH,sBADO,KAAKp+C,SACqBr+B,eAAX,CAA3B;YAET,KAAKi6E,qDAAQ0B,MAAMkB;AAEjB,qBAAO,KAAKJ,sBADO,KAAKp+C,SACqBr+B,eAAX,CAA3B;UA3CX;AA+CA,iBAAO;QAhDN;QAyDYq6E,OAAAA,iBAAiBlgG,GAAY;AAC1C,kBAAQA,GAAR;YACE,KAAK8/F,qDAAQ0B,MAAMiB;YACnB,KAAK3C,qDAAQ0B,MAAMkB;YACnB,KAAK5C,qDAAQ0B,MAAM1sD;YACnB,KAAKgrD,qDAAQ0B,MAAMgB;AACjB,qBAAO;UALX;AAOA,iBAAO;QARmC;QAiBrC9B,OAAAA,gBAAgB1iF,GAAY;AACjC,iBAAKA,IAGE,IAAI8hF,qDAAQA,qDAAQ0B,MAAMxgG,OAAOgd,CAAjC,IAFE;QAFwB;QAe5BokF,OAAAA,qBAAqB/9E,GAAsB;AAChD,cAAI,CAACA;AACH,mBAAO;AAET,gBAAMrkB,IAAOqkB,EAAWrkB;AAOjB,iBANHA,MAAS85D,sDAAeC,eAO1B/5D,MAAS85D,sDAAeG,kBACxB51C,EAAW8yC,eAAX,IAIO2oC,qDAAQa,gBACbt8E,EAAW8yC,eAAX,CADK,IAGEn3D,MAAS85D,sDAAeG,iBAC1B,IAAI6lC,qDAAQA,qDAAQ0B,MAAMkB,MAAMr+E,CAAhC,IACErkB,MAAS85D,sDAAeE,eAC1B,IAAI8lC,qDAAQA,qDAAQ0B,MAAMgB,QAAQn+E,CAAlC,IACErkB,MAAS85D,sDAAeI,qBAC1B,IAAI4lC;YAAQA,qDAAQ0B,MAAMiB;YAAUp+E;UAApC,IAEF;QA3ByC;QAqC3Cs8E,OAAAA,gBAAgBz8E,GAAY;AACjC,iBAAKA,KAAUA,EAAMG,aAGd,IAAIy7E,qDAAQA,qDAAQ0B,MAAM1sD,OAAO5wB,EAAMG,UAAvC,IAFE;QAFwB;QAa5Bg+E,OAAAA,gBAAgBjtG,GAAY;AACjC,iBAAKA,IAGE,IAAI0qG,qDAAQA,qDAAQ0B,MAAMluD,OAAOl+C,CAAjC,IAFE;QAFwB;QAiB5BmsG,OAAAA,gBAAgB1nE,GAAe;AACpC,iBAAKA,IAGE,IAAIimE;YAAQA,qDAAQ0B,MAAMC;YAAO5nE;UAAjC,IAFE;QAF2B;QAgB/BioE,OAAAA,iBAAiBh2F,GAAoB;AAC1C,iBAAKA,IAGE,IAAIg0F,qDAAQA,qDAAQ0B,MAAME,QAAQ51F,CAAlC,IAFE;QAFiC;QAerCi3F,OAAAA,oBACLx8F,GACAy5F,GAA+B;AAE/B,iBAAKA,KAAiBz5F,IAIf,IAAIu5F,qDAAQA,qDAAQ0B,MAAM3vD,WAAWtrC,GAD7B+W,EAAC0iF,cAAAA,EAAD1iF,CACR,IAHE;QAHsB;QAgB1B0lF,OAAAA,cAAc5tG,GAAY;AAE/B,gBAAMgyC,IAAgBjrC,iEAAoB/G,CAApB;AAMtB,iBALIgyC,IACQ04D,qDAAQsC,qBAAqBh7D,CAA7B,IAEA04D,qDAAQuC,gBAAgBjtG,CAAxB;QANmB;MA1xB7B;AAIG0qG,2DAAAW,sBAAsB;AAMLX,2DAAAgD,mBAA2B;gBA4xBpChD,GAAO;AAKV,YAAAA,EAAA0B,UAAA1B,EAAA0B,QAAK,CAAA;AACfA,UAAAxgG,QAAA;AACAwgG,UAAAluD,QAAA;AACAkuD,UAAA1sD,QAAA;AACA0sD,UAAAgB,SAAA;AACAhB,UAAAkB,OAAA;AACAlB,UAAAiB,WAAA;AACAjB,UAAAC,QAAA;AACAD,UAAA3vD,YAAA;AACA2vD,UAAAE,SAAA;MAdoB,GAAP5B,yDAAAA,uDAAO,CAAA,EAAxB;AAt0BA,UAAAxqD,8CAAA,CAAA;AAgCawqD,kDAAAA,UAAAA;AuINP,UAAOmD,8DAAP,cAA0BvsD,oDAA1B;QA6BJ5vB,YACEgwB,GACAosD,GACAC,GACAC,GAAqB;AAErB,cAAIxgG,IAAck0C,IAAYA,EAAUvwC,UAAUF,KAAKhD;AACnD+/F,eAAeA,EAAYr/E,QAAZ,MAA0B+7E,qDAAQ0B,MAAM3vD,cACzDjvC,IAAewgG,EAAYhD,YAAZ,EAAwC/5F;AAEzD,gBAAMzD,CAAN;AAtBO,eAAA5C,OAAkB41C;AAwBzB,eAAK3xC,UAAqBoC,QAAXywC,IAAWzwC,SAAXywC,EAAWzwC;AAC1B,eAAKg9F,UAAUF,KAAe9/F;AAC9B,eAAKyL,UAAUs0F;AACf,eAAKF,WAAWA;QAXK;QAmBd7sD,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAsBhzC,WAAlB,KAAK6/F;AACP,kBAAU5iG,MACR,8GADI;AAKR,cAAI,CAAC,KAAKwO;AACR,kBAAUxO,MACR,oFADI;AAKRgG,YAAA,WAAmB,KAAK48F;AACxB58F,YAAA,UAAkB,KAAKrC;AACvBqC,YAAA,UAAkB,KAAK+8F;AACvB/8F,YAAA,UAAkB,KAAKwI;AACvB,iBAAOxI;QAlBM;QA8BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI+gG,6DAHE;AAKjBhsD,YAASisD,WAAW58F,EAAA;AACpB2wC,YAAShzC,UAAUqC,EAAA;AACnB2wC,YAASosD,UAAU/8F,EAAA;AACnB2wC,YAASnoC,UAAUxI,EAAA;AACnB,iBAAO2wC;QAXI;MArFT;+CA2GqB72C,qCAAKsG,OAAkBkvC,iDAAaqtD,2DAA/D;AArIA,UAAA3tD,kDAAA,CAAA;AA0Ba2tD,sDAAAA,aAAAA;ACGb,UAAMK,kEAAe,iBAGfC,kEAAe,iBAMfC,uEAAoB,MAMbC,+DAAP,MAAA;QA8BJ38E,YACmBvgB,GACjBsuD,GACiB9E,GAAc;AAFd,eAAAxpD,YAAAA;AAEA,eAAAwpD,SAAAA;AAbT,eAAA2zC,iBAFA,KAAAC,iBADA,KAAAC,eAFA,KAAAC,eAFA,KAAAC,YADA,KAAAj0C,aAJV,KAAAk0C,mBAHQ,KAAAj9F,SAAqC;AA8B3C,eAAKwqD,aAAauD;AAEZmvC,cAAgB,KAAKd,SAAL,IAClB,KAAK5xC,WAAWu1B,gBAChB,KAAKv1B,WAAWw1B;AAGpB,eAAK+P,UAAU9mC,EAAOp/B,UAAUqzE;QATD;QAiBjC76E,aAAU;AACR,iBAAO,KAAK26E;QADJ;QASVxzC,YAAS;AACP,iBAAO,KAAKP;QADL;QAUTmzC,WAAQ;AACN,iBAA4B,aAArB,KAAKnzC,OAAO/vD;QADb;QASRpN,YAAS;AACP,gBAAMwb,IAAY,KAAK80F,SAAL,IAAkBI,kEAAeC;AAEnD,eAAKO,YAAgBj4G,kDAAiBqwC,qCAAI8e,GAAG,EAAC,SAAS5sC,EAAV,CAA5B;AAEjB,eAAK61F,mBAAL;iBACO,KAAKH;QANL;QAeCI,WAAW/7F,GAA8B;AAC5C,eAAK+6F,SAAL,KAMC,KAAKp8F,UACP,KAAKA,OAAO4pD,aAAa,IAAzB,GAEFvoD,EAAUuoD,aAAa,KAAKvnC,WAAL,CAAvB,MARI,KAAKriB,UACP,KAAKA,OAAOqpD,aAAa,IAAzB,GAEFhoD,EAAUgoD,aAAa,KAAKhnC,WAAL,CAAvB;AAOF,eAAKriB,SAASqB;QAZmC;QAqBnD6oD,KAAKqyC,GAAkBc,GAAgB;AACrC,cAAKA,GAAL;AAKA,iBAAK7yC,aAAa,KAAK/qD,UAAU2jB,YAAf,EAA6B4oC,aAA7B;AAElB,gBAAMkxC,IAAgB,KAAKd,SAAL,IAClB,KAAK5xC,WAAWu1B,gBAChB,KAAKv1B,WAAWw1B;AACpB,iBAAK+P,UAAU,KAAK9mC,OAAOp/B,UAAUqzE;AACrC,iBAAKI,aAAaD,CAAlB;AAEA,iBAAKE,gBAAgBF,CAArB;AAEA,iBAAKG,gBAAgBjB,GAASc,CAA9B;AAGMI,gBAAU,KAAKR,iBAAkBhtF,WAAW,CAAlC;uBACZwtF,KACDA,EAAgChoE,gBAC9BgoE,EAAgChoE,aAAhC;UArBL;AACE,iBAAKzoC,KAAL;QAFmC;QA+B7BuwG,gBAAgBF,GAAgB;AAExC,gBAAMK,IADsBL,EAAQ/D,YAARqE,EACezkG;AACvCmkG,YAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMluD,QACtC,KAAKoxD,eAAeP,CAApB,IACSA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMgB,SAC7C,KAAKmC,gBAAgBR,CAArB,IACSK,MAAmB1qC,sDAAeC,cAC3C,KAAK6qC,eAAeT,CAApB,IACSK,MAAmB1qC,sDAAeG,iBAC3C,KAAK4qC,cAAcV,CAAnB,IACSA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMiB,WAC7C,KAAKqC,kBAAkBX,CAAvB,IACSA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMxgG,QAC7C,KAAK+jG,eAAeZ,CAApB,IACSA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAM3vD,YAC7C,KAAKmzD,qBAAqBb,CAA1B,IACSA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMC,QAC7C,KAAKwD,eAAed,CAApB,IACSA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAME,UAC7C,KAAKwD,gBAAgBf,CAArB;QApBsC;QAkClCgB,wBAAwBhB,GAAgB;AACxC/uG,cAAQ+uG,EAAQt+E,eAAR;AACd,gBAAMjd,IAAQxT,EAAMwT;AACpB,cAAME,IAAS1T,EAAM0T,QACfs8F,IAAet8F,IAAS06F;AAC9B,gBAAM6B,IAAe,KAAK/zC,WAAW41B;AAEjC9xF,YAAMkS,sBACFg+F,IAAkB,KAAKh0C,WAAW0wB,SACtC5sF,EAAMkS,kBADgB,GAGxB,KAAKi+F,kBACH38F,GACAy8F,GACAD,GACAE,CAJF,KAMSlwG,EAAMiS,oBACTi+F,IAAkB,KAAKh0C,WAAW0wB,SACtC5sF,EAAMiS,gBADgB,GAGxB,KAAKm+F,gBAAgB58F,GAAOE,GAAQw8F,CAApC,KAEA,KAAKG,eAAe78F,GAAOy8F,GAAcD,CAAzC;AAEF,eAAKlB,WAAW9uG,CAAhB;AACA,eAAKswG,aAAL;QA1B8C;QAkCtChB,eAAeP,GAAgB;AACvC,eAAKgB,wBAAwBhB,CAA7B;QADuC;QAS/BW,kBAAkBX,GAAgB;AAC1C,eAAKgB,wBAAwBhB,CAA7B;QAD0C;QASlCQ,gBAAgBR,GAAgB;AACxC,eAAKgB,wBAAwBhB,CAA7B;QADwC;QAUhCa,qBAAqBb,GAAgB;AAC7C,cAAMnE,IAAemE,EAAQ9D,gBAAR;AACjBn0F,cAAI8zF,EAAa9zF;AACfE,cAAI4zF,EAAa5zF;AAEnB,eAAK7F,UAAU0R,QACjB/L,KAAK,KAAKolD,WAAWy1B;AAGvB,eAAK4e,cAAcz5F,GAAGE,GAAG,KAAKklD,WAAWy1B,eAAzC;AACA,eAAKmd,WAAW,KAAK39F,SAArB;AACA,eAAKm/F,aAAL;QAX6C;QAoBrCX,eAAeZ,GAAgB;AACjCnmF,cAAQmmF,EAAQ/D,YAAR;AACd,gBAAMx3F,IAAQoV,EAAMrxB,QAAN,EAAgBic,OACxBE,IAASkV,EAAMrxB,QAAN,EAAgBmc;AAE/B,eAAK88F,cAAc,GAAG,GAAGh9F,GAAOE,CAAhC;AACA,eAAKo7F,WAAWlmF,CAAhB;AACA,eAAK0nF,aAAL;QAPuC;QAgB/Bd,eAAeT,GAAgB;AACjC9/E,cAAa8/E,EAAQ/D,YAAR;AACnB,gBAAMz2E,IAActF,EAAWwB,eAAX;AAEpB,eAAKggF,eAAexhF,CAApB;AACA,eAAK6/E,WAAWv6E,CAAhB;AACA,eAAK+7E,aAAL;QANuC;QAe/Bb,cAAcV,GAAgB;AACtC,cAAM9/E,IAAa8/E,EAAQ/D,YAAR;cACC/7E,EAAWwB,eAAX;AACpB,cAAI3Z,IAAI;AACFE,cAAIiY,EAAWwqE,iBAAX,EAA8BziF;AACxC,gBAAMxD,IAAQ8b,EAAY8X,eAAZ,EAA6B5zB;AACvC,eAAKrC,UAAU0R,QACjB/L,IAAI,CAACtD;AAEP,eAAK+8F,cAAcz5F,GAAGE,GAAGxD,CAAzB;AACA,eAAKs7F,WAAWx/E,CAAhB;AACA,eAAKghF,aAAL;QAXsC;QAoB9BT,eAAed,GAAgB;AACjC/uG,cAAQ+uG,EAAQ/D,YAAR;AAGd,cAAM0F,IAAc1wG,EAAMonC,eAAN;AAIpB,gBAAM5zB,IAAQk9F,EAAYl9F,QAAQ,KAAK0oD,WAAW21B;AAC5Cn+E,cAASg9F,EAAYh9F,SAAS,KAAKwoD,WAAW21B;AAIpD,gBAAM1b,IAAW,CAAC,KAAKja,WAAW21B,uBAAuB,GACnD8e,IAAW,CAAC,KAAKz0C,WAAW21B,uBAAuB;AAEzD,cAAI/6E,IAAIq/D;AAGJ,eAAKhlE,UAAU0R,QACjB/L,IAAI,EAAEtD,IAAQ2iE;AAEhB,eAAKq6B,cAAc15F,GALT65F,GAKen9F,GAAOE,CAAhC;AACA,eAAKo7F,WAAW9uG,CAAhB;eACKswG,aAAL;QAxBuC;QAiC/BR,gBAAgBf,GAAgB;AAClCr4F,cAASq4F,EAAQ/D,YAAR;AAMf,gBAAMx3F,IAH6CkD,EAAOlD,QAGxB,KAAK0oD,WAAW21B,sBAC5Cn+E,IAJuBgD,EAAOhD,SAIA,KAAKwoD,WAAW21B,sBAI9C1b,IAAW,CAAC,KAAKja,WAAW21B,uBAAuB,GACnD8e,IAAW,CAAC,KAAKz0C,WAAW21B,uBAAuB;AAEzD,cAAI/6E,IAAIq/D;AAGJ,eAAKhlE,UAAU0R,QACjB/L,IAAI,EAAEtD,IAAQ2iE;AAEhB,eAAKq6B,cAAc15F,GALT65F,GAKen9F,GAAOE,CAAhC;AACA,eAAKo7F,WAAWp4F,CAAhB;AACA,eAAK45F,aAAL;QAvBwC;QA2BhCA,eAAY;AACpB,eAAK5xG,KAAL;AACI,eAAKiwG,qBACP,KAAKA,iBAAiB50F,MAAMkB,UAAU;QAHpB;QAmBZo1F,eACR78F,GACAy8F,GACAD,GAAoB;AAEdY,cACKnrG;YAAO,CAACwqG;YAAcD;UAA/B,IACSpqG,kDAAW,KAAK,CAACqqG,CAA1B,IACSrqG,kDAAW,KAAK4N,IAAuB,IAAfy8F,CAAjC,IACSrqG,kDAAW,KAAKoqG,CAAzB;AACF,cAAI,CAAC,KAAKvB;AACR,kBAAUvjG,MACR,0DADI;AAIR,eAAKujG,aAAa76F,aAAa,KAAKg9F,CAApC;AACI,eAAKz/F,UAAU0R,OACjB,KAAK6qE,QAAQ,KAAK+gB,YAAlB;AAEF,eAAKE,mBAAmB,KAAKF;QAhBT;QAyBZgC,eAAexhF,GAA8B;AACrD,gBAAMnY,IAAImY,EAAWwqE,iBAAX,EAA8B3iF,GAClCE,IAAIiY,EAAWwqE,iBAAX,EAA8BziF;AAElC09E,cACKlvF;YAAO;YAAG;UAAnB,IACC,KAAK02D,WAAW0wB,SAAS39D,CAAzB,EAAmDwhB;AAEtD,eAAK+9D,aAAc56F,aAAa,KAAK8gF,CAArC;AACA,eAAK8Z,aAAc56F,aACjB,aACA,eACEkD,IACA,MACAE,IACA,OACC,KAAK7F,UAAU0R,MAAM,iBAAiB,GAP3C;AASA,eAAK8rF,mBAAmB,KAAKH;QAlBwB;QA6B7C+B,cAAcz5F,GAAWE,GAAWxD,GAAa;AACzD,cAAI,CAAC,KAAK+6F;AACR,kBAAUrjG,MAAM,wDAAV;AAER,eAAKqjG,eAAe36F,aAAa,KAAK,GAAGkD,CAAH,EAAtC;AACA,eAAKy3F,eAAe36F,aAAa,KAAK,GAAGoD,CAAH,EAAtC;AACA,eAAKu3F,eAAe36F,aAAa,SAAS,GAAGJ,CAAH,EAA1C;AACA,eAAKm7F,mBAAmB,KAAKJ;QAP4B;QAkBjD6B,gBACR58F,GACAE,GACAw8F,GAA0B;AAE1B,cAAI,CAAC,KAAKzB;AACR,kBAAUvjG,MACR,0DADI;AAIF0lG,cACKnrG,8CAAO+N,GAAO,CAAvB,IACS5N,kDAAW,KAAK,EAAE4N,IAAQ08F,EAAgB18F,MAAnD,IACS5N,kDAAW,KAAK,KAAKs2D,WAAWmxB,mBAAzC,IACA6iB,EAAgBz/D,WACP7qC,kDAAW,KAAK8N,CAAzB,IACS9N,kDAAW,KAAK4N,CAAzB;AACF,eAAKi7F,aAAa76F;YAAa;YAAKg9F;UAApC;AACI,eAAKz/F,UAAU0R,OACjB,KAAK6qE,QAAQ,KAAK+gB,YAAlB;AAEF,eAAKE,mBAAmB,KAAKF;QAlBH;QA+BlB0B,kBACR38F,GACAy8F,GACAD,GACAE,GAAsB;AAEtB,cAAI,CAAC,KAAKzB;AACR,kBAAUvjG,MACR,8EADI;AAIF0lG,cACKnrG,8CAAO,CAACwqG,GAAcD,CAA/B,IACSpqG,kDAAW,KAAK,CAACqqG,CAA1B,IACSrqG,kDAAW,KAAK,KAAKs2D,WAAW+uB,iBAAzC,IACAilB,EAAgBv/D,WACP/qC;YAAW;YAAK4N,IAAuB,IAAfy8F;UAAjC,IACSrqG,kDAAW,KAAKoqG,CAAzB;AACF,eAAKvB,aAAa76F,aAAa,KAAKg9F,CAApC;AACI,eAAKz/F,UAAU0R,OACjB,KAAK6qE,QAAQ,KAAK+gB,YAAlB;AAEF,eAAKE,mBAAmB,KAAKF;QAlBP;QA8Bd+B,cAAc15F,GAAWE,GAAWxD,GAAeE,GAAc;AACzE,cAAI,CAAC,KAAK46F;AACR,kBAAUpjG,MAAM,wDAAV;AAER,eAAKojG,eAAe16F,aAAa,KAAK,GAAGkD,CAAH,EAAtC;AACA,eAAKw3F,eAAe16F,aAAa,KAAK,GAAGoD,CAAH,EAAtC;AACA,eAAKs3F,eAAe16F,aAAa,SAAS,GAAGJ,CAAH,EAA1C;AACA,eAAK86F,eAAe16F,aAAa,UAAU,GAAGF,CAAH,EAA3C;AACA,eAAKi7F,mBAAmB,KAAKL;QAR4C;QAgBnE5gB,QAAQjyB,GAAqB;AACnCA,YAAU7nD,aAAa,aAAa,aAApC;QADmC;QAKrClV,OAAI;AACF,cACE,EAAC,KAAK6vG,kBACL,KAAKD,kBACL,KAAKE,gBACL,KAAKC;AAEN,kBAAUvjG,MAAM,qDAAV;AAER,eAAKqjG,eAAex0F,MAAMkB,UAAU;AACpC,eAAKqzF,eAAev0F,MAAMkB,UAAU;AACpC,eAAKuzF,aAAaz0F,MAAMkB,UAAU;AAClC,eAAKwzF,aAAa10F,MAAMkB,UAAU;QAZhC;QAqBIi0F,gBAAgBjB,GAAkBc,GAAgB;AACxD,gBAAM8B,IAAW9B,EAAQt+E,eAAR;AACX3jB,cAAQ,KAAgBpY,wCAAe8rD,+CAA1B;YACjBqwD;YACA,KAAK/C,SAAL;YACAG;YACAc;UAJY;AAMH96G,mDAAK6Y,CAAhB;QARwD;QAgBhDgkG,sBAAmB;AAC3B,iBAAO,EACL,eAAiB,OACjB,eAAiB,QACjB,KAAO,MACP,QAAU,KAAKrP,UAAU,6BACzB,aAAe,aALV;QADoB;QAenBoN,qBAAkB;AAW1B,eAAKp0C,aAAiBhkE,kDACpBqwC,qCAAI8e,GACJ,EACE,OAAS,KAAKsW,WAAWy1B,iBACzB,QAAU,KAAKz1B,WAAW01B,iBAF5B,GAIA,KAAK8c,SANW;AAWlB,eAAKH,iBAAqB93G;YACxBqwC,qCAAIof;YACJ,EACE,OAAS,KAAKgW,WAAWy1B,iBACzB,QAAU,KAAKz1B,WAAW01B,iBAF5B;YAIA,KAAKn3B;UANe;AAUtB,eAAK6zC,iBAAqB73G,kDACxBqwC,qCAAIof,MACJ,EACE,SAAS,yBACT,IAAM,IACN,IAAM,GAHR,GAKA,KAAKuU,UAPe;AAWtB,eAAK+zC,eAAmB/3G,kDACtBqwC,qCAAIif,MACJ,EAAC,WAAa,GAAd,GACA,KAAK0U,UAHa;AAQpB,eAAKg0C,eAAmBh4G;YACtBqwC,qCAAIif;YACJ,EACE,WAAa,IACb,MAAQ,QACR,gBAAgB,KAAKmW,WAAW61B,oBAHlC;YAKA,KAAKt3B;UAPa;AAUpB,eAAK/7D,KAAL;AAGA,cAAI,KAAKovG,SAAL,GAAiB;AACnB,kBAAMiD,IAAkB,KAAKD,oBAAL;AACpBr6G,8DAAiBqwC,qCAAIG,SAAS8pE,GAAiB,KAAKxC,cAAxD;AACI93G,8DAAiBqwC,qCAAIG,SAAS8pE,GAAiB,KAAKvC,YAAxD;AACI/3G,8DACFqwC,qCAAIG,SACJ,OAAA;cAAA,CAAA;cAAI8pE;cAAJ,EAAqBC,eAAe,SAApC;YAAA,GACA,KAAKvC,YAHP;UAJmB;AAWrB,iBAAO,KAAKh0C;QA3Ec;QAmFlBu0C,aAAaiC,GAAiB;AACtC,cACE,EAAC,KAAK1C,kBACL,KAAKD,kBACL,KAAKE,gBACL,KAAKC;AAEN,kBAAUvjG,MACR,iEADI;AAIR,eAAKqjG,eAAe36F,aAAa,QAAQ,KAAK6tF,OAA9C;AACA,eAAK6M,eAAe16F,aAAa,UAAU,KAAK6tF,OAAhD;AACA,eAAK+M,aAAa56F,aAAa,QAAQ,KAAK6tF,OAA5C;AACA,eAAKgN,aAAa76F,aAAa,UAAU,KAAK6tF,OAA9C;AAEI,eAAKqM,SAAL,MACIvoF,IAAS,KAAKk8E,UAAU,6BAC9B,KAAK8M,eAAe2C,kBAAmBt9F,aAAa,UAAU2R,CAA9D,GACA,KAAKipF,aAAa0C,kBAAmBt9F,aAAa,UAAU2R,CAA5D,GACA,KAAKkpF,aAAayC,kBAAmBt9F,aAAa,UAAU2R,CAA5D;QApBoC;QAyBxCxlB,UAAO;AACD,eAAK2uG,aACH53G,4CAAW,KAAK43G,SAApB;QAFG;MA3sBH,GA5CNxuD,oDAAA,CAAA;AA4CamuD,wDAAAA,YAAAA;ACrBP,UAAO8C,iEAAP,MAAA;QA8BJz/E,YACEqb,GACAhzB,GACA0lD,GAA2B;AAnB7B,eAAAhE,YANA,KAAAF,YAA+B;AAYvB,eAAA61C,uBAAuB,oBAAIviD;AAG3B,eAAAwiD,mBAAmB,oBAAIxiD;AAY7B,eAAK4Q,YAAYA;AACjB,eAAK1lD,QAAQA;AACb,eAAKo2C,UAAUpjB;AAGf,eAAKukE,UAAc76G,kDACjBqwC,qCAAIif,MACJ,EAAC,SAAS,cAAV,GACA,KAAKoK,OAHQ;QAPY;QAmB7B+mC,QAAQqa,GAAkB;AACxB,eAAKD,QAAQ19F,aAAa,KAAK29F,CAA/B;QADwB;QAO1Bpa,UAAO;AAEL,eAAKma,QAAQ19F,aAAa,aAAa,aAAvC;QAFK;QAWP0nD,aAAaC,GAAqB;AAC3BA,eAKL,KAAKpL,QAAQ33C,YAAY+iD,CAAzB,GACA,KAAKA,YAAYA,KALf,KAAKA,YAAY;QAFa;QAgBlCR,aAAaU,GAAqB;AAC3BA,eAKD,KAAKF,YACP,KAAKpL,QAAQz3C,aAAa+iD,GAAW,KAAKF,SAA1C,IAEA,KAAKpL,QAAQ33C,YAAYijD,CAAzB,GAEF,KAAKA,YAAYA,KATf,KAAKA,YAAY;QAFa;QAoBlChqB,YAAYzxC,GAAe;AACzB,eAAKsxG,QAAQ19F,aAAa,UAAU,KAAKmG,MAAMi7D,cAA/C;AACA,eAAKs8B,QAAQ19F,aAAa,QAAQ,KAAKmG,MAAM27D,aAA7C;AAEA,eAAK87B,cAAcxxG,EAAMuvB,SAAN,CAAnB;AACA,eAAKkiF,gBAAgB,CAACzxG,EAAM1L,UAAN,KAAqB0L,EAAM6+C,qBAAN,CAA3C;QALyB;QAa3Bg+B,SAAS9N,GAAsB;AAC7B,eAAKh1D,QAAQg1D;QADgB;QAWrB2iC,UAAU14F,GAAmBM,GAAY;AAC5CN,gBAGDM,IACE5iB;YAAS,KAAKy5D;YAASn3C;UAA3B,IAEIpiB,6CAAY,KAAKu5D,SAASn3C,CAA9B;QAP+C;QAiBnD24F,kBAAkBlhG,GAAe;AAC3BA,cACF,KAAK6gG,QAAQ19F,aACX,UACA,UAAU,KAAK6rD,UAAU6X,iBAAiB,GAF5C,IAKA,KAAKg6B,QAAQ19F,aAAa,UAAU,MAApC;QAP6B;QAgBvB49F,cAAcpiF,GAAe;AACjCA,gBACF,KAAKkiF,QAAQ19F,aAAa,UAAU,MAApC,GACA,KAAK09F,QAAQ19F,aAAa,QAAQ,KAAKmG,MAAM07D,eAA7C;QAHmC;QAY7Bg8B,gBAAgBjhG,GAAiB;AACzC,eAAKkhG,UAAU,mBAAmBlhG,CAAlC;AACIA,eACF,KAAK8gG,QAAQ19F,aACX,QACA,UAAU,KAAK6rD,UAAU4xB,oBAAoB,GAF/C;QAHuC;QAe3CugB,eAAenhG,GAAe;AAC5B,eAAKihG;YAAU;YAAmBjhG;UAAlC;QAD4B;QAU9BohG,qBAAqBphG,GAAe;AAClC,eAAKihG,UAAU,yBAAyBjhG,CAAxC;QADkC;QASpCqhG,sBAAsBrhG,GAAe;AACnC,eAAKihG,UAAU,0BAA0BjhG,CAAzC;QADmC;QASrCshG,cAActhG,GAAe;AAC3B,eAAKihG,UAAU,oBAAoBjhG,CAAnC;QAD2B;QAW7BuhG,sBAAsBvhG,GAAe;AACnC,eAAKihG,UAAU,sBAAsBjhG,CAArC;QADmC;QAWrCwhG,6BAA6BC,GAAmB52B,GAAgB;QAAA;QAKhEke,uBACEvqE,GACAkjF,GACAh1F,GACAsX,GAAY;AAEZ,cAAI,KAAK28E,qBAAqBhnF,IAAI6E,CAA9B,GAA2C;AAC7C,gBAAI,KAAKmjF,2BAA2BnjF,GAAYkjF,GAAgBh1F,CAA5D;AACF;AAEF,iBAAKi8E,0BAA0BnqE,CAA/B;UAJ6C;AAOzCqpC,cAAgB7hE;YACpBqwC,qCAAIif;YACJ,EACE,SAAS,oCACT,GAAKosD,GACL,WACE,aAAah1F,EAAOrG,CAApB,KAA0BqG,EAAOnG,CAAjC,OAAyCyd,IAAM,iBAAiB,IAJpE;YAMA,KAAK07B;UARW;AAUlB,eAAKihD,qBAAqBnnF,IAAIgF,GAAYqpC,CAA1C;QAnBY;QAsBN85C,2BACNnjF,GACAojF,GACAC,GAAqB;AAEJ,cAAA;AAAjB,gBAAMC,IAAW,SAAA,IAAA,KAAKnB,qBACnB18G,IAAIu6B,CADU,KAAA,SAAA,EAEb5Y,aAAa,GAFA;AAGXm8F,cAAa,KAAKnB,iBAAiB38G,IAAIu6B,CAA1B;AACnB,iBAAOsjF,MAAaF,KAAWj2F,mDAAW2xB,OAAOykE,GAAYF,CAA9B;QANV;QAYvBlZ,0BAA0BnqE,GAA8B;AACtD,gBAAMqpC,IAAY,KAAK84C,qBAAqB18G,IAAIu6B,CAA9B;AACbqpC,gBACDxhE,4CAAWwhE,CAAf,GACA,KAAK84C,qBAAqBxmF,OAAOqE,CAAjC;QAJsD;MA9RpD,GAvBNixB,qDAAA,CAAA;AAuBaixD,yDAAAA,aAAAA;AC4BP,UAAOsB,yEAAP,MAAA;QAmEJ/gF,YAAY1xB,GAAe;AA9BnB,eAAA0yG,kBAZA,KAAAC,aAPA,KAAAC,cAAyC;AA2B1C,eAAAC,mBAAmB;AAYlB,eAAAC,aAHA,KAAAC,mBAHA,KAAAC,mBAA8C;AAiB7CvgG,YAAAA,0CAAYzS,CAAnB;AACA,eAAKykC,WAAWzkC;AAEhB,eAAKmR,YAAYnR,EAAMmR;AAEvB,eAAK8hG,cAAc,KAAKC,kBAAkB,KAAKzuE,QAA5B;AAEnB,eAAK0uE,uBAAuB,KAAKC,yBAAL;AAExB,eAAKR,gBACP,KAAKD,aAAa,KAAKO,kBACrB,KAAKN,YAAYniF,eAAjB,CADgB;QAXK;QAsB3B1wB,UAAO;AACL,eAAKozG,qBAAqBlmG,SAAS;AACnC,eAAKomG,uBAAuB,KAAKJ,WAAjC;AACA,eAAKI,uBAAuB,KAAKV,UAAjC;QAHK;QAYPW,6BAA0B;AACxB,eAAKH,uBAAuB,KAAKC,yBAAL;QADJ;QAW1BG,oBAAiB;AACf,iBAAO,CAAC,CAAC,KAAKb;QADC;QAUjBc,mBAAgB;AACd,cAAK,KAAKd,iBAAV;AACWniG,cAAAA,4CAAX;AACA,iBAAKkjG,YAAL;AACWhjG,cAAAA,2CAAX;AACA,gBAAM,EAAC,OAAAijG,GAAO,SAAAhhE,EAAR,IAAmB,KAAKggE;AAC9BgB,cAAM3iF,QAAQ2hB,CAAd;AACA,gBAAMihE,IAAqBD,EAAMhU,WAAN,IAAqBhtD,IAAUghE,GACpDr2B,IAAY,KAAK54C,SAASiP,aAAd;yEAElB,EAAsBkgE,KAAK,MAAK;AACdhwG,yEAAmB+vG,EAAmBljF,eAAnB,CAAnC;AAEAtjB,yBAAW,MAAK;AACdkwE,kBAAUpqB,aAAV;cADc,GAEb,CAFH;YAH8B,CAAhC;UATA;QADc;QA0BhBoa,OAAO9G,GAAiBstC,GAA8B;AACpD,gBAAMC,IAAe,KAAKC,aAAaxtC,CAAlB;AAOrB,eALA,KAAKssC,mBAAmB,KAAKmB,aAAa,CAAC,CAACF,GAAcD,CAAlC,MAGG,KAAKI,qBAAqBH,GAAcvtC,CAAxC;AAIdh2D,cAAAA,4CAAX,GACA,KAAK2jG,iBAAiBJ,CAAtB,GACA,KAAKK,iBAAiBL,CAAtB,GACWrjG,EAAAA,2CAAX;QAbkD;QAuB9CyiG,kBAAkB3+E,GAAqB;AAClChkB,YAAAA,4CAAX;cACI8K;AACJ,cAAI;AACF,kBAAM+4F,IAAmB54G,iDAAK+4B,GAAa,EACzCnJ,gBAAgB,OAChByC,gBAAgB,OAChBC,eAAe,OACfC,qBAAqB,MAJoB,CAAzB;AAOlB,gBAAI,CAACqmF;AACH,oBAAUlpG,MACR,qCAAqCqpB,EAAYykC,YAAZ,CAArC,EADI;AAKR39C,gBAAgB5f,mDAAO24G,GAAW,KAAKjjG,SAA9B;AAIT,uBAAWnR,KAASqb,EAAOtK,eAAe,KAAtB;AAClB/Q,gBAAMwkG,mBAAmB,IAAzB;AAGFnpF,cAAO+W,QAAP;AACA/W,cAAO0Y,WAAP,EAAoBngB,aAAa,cAAc,QAA/C;UAvBE,UAAJ;AAyBanD,cAAAA,2CAAX;UADQ;AAIV,iBAAO4K;QA/BsC;QAwCvC+3F,2BAAwB;AAC9B,gBAAMiB,IAAY,KAAK5vE,SAASgO,gBAAgB,KAA9B,GAEZmgE,IAAc,KAAKnuE,SAASo8D,sBAAsB,IAApC;AAChB+R,eAAeA,MAAgB,KAAKnuE,SAAStV,mBAC/CklF,EAAUhnG,KAAKulG,CAAf,GACA,KAAKA,cAAcA;AAErB,iBAAOyB;QARuB;QAoBxBJ,qBACNH,GACAvtC,GAAe;AAGf,cAAI,CAACutC;AAAc,mBAAO,CAAC,CAAC,KAAKpB;AAGjC,cAAI,CAAC,KAAKA;AAAiB,mBAAO;AAIlC,gBAAM,EAAC,OAAO4B,GAAa,SAASC,EAA9B,IAA+C,KAAK7B;AAC1D,cACE6B,MAAkBT,EAAaphE,WAC/B4hE,MAAgBR,EAAaJ;AAG7B,mBAAO;AAGT,gBAAMc,IAAQF,EAAYx9F,IAAIyvD,EAAIzvD,IAAIy9F,EAAcz9F;AAC9C29F,cAAQH,EAAYt9F,IAAIuvD,EAAIvvD,IAAIu9F,EAAcv9F;AAGpD,iBACE88F,EAAajnE,SAHK/uB,KAAKmc,KAAKu6E,IAAQA,IAAQC,IAAQA,CAAlCC,IAGkBv0E,EAAAA,qCAAOk1B;QAxB9B;QAoCT0+C,aAAaxtC,GAAe;AAQ7B,eAAKysC,oBAAqB,KAAKA,iBAAiBxtE,YAAtB,KAC7B,KAAK8tE,2BAAL;AAGF,cAAIzmE,IAAS,KAAK8nE,eAAL,GACTC,IAAY;AAChB,mBAASrnG,IAAI,GAAGA,IAAI,KAAK4lG,qBAAqBlmG,QAAQM,KAAK;AACzD,kBAAMsnG,IAAe,KAAK1B,qBAAqB5lG,CAA1B,GACfunG,IAAYD,EAAaniE,QAAQ7F,GAAQ05B,CAA7B;AACduuC,cAAU7lF,eACZ2lF,IAAY,EACVliE,SAASoiE,EAAU7lF,YACnBykF,OAAOmB,GACPhoE,QAAQioE,EAAUjoE,OAHR,GAKZA,IAASioE,EAAUjoE;UAToC;AAY3D,iBAAO+nE;QA1B2B;QAmC5BD,iBAAc;AAOpB,iBAAO,KAAKjC,kBACRvyE,EAAAA,qCAAOi1B,uBACPj1B,EAAAA,qCAAOC;QATS;QAoBd4zE,aACNF,GACAD,GAA8B;AAE9B,iBAAIA,KACuB,KAAK1iG,UAAUg7C,oBAAf4oD,EACazwD;YACpCuvD,EAAW5iG;YACXwyC,0DAAiBN,WAAWI;UAFTyxD,IAKXnB,EAA2BtwC,YAAY,KAAK9+B,QAA5C,IAGL;QAZuB;QAuBxB0vE,iBAAiBL,GAAwC;AAC/D,cAASjB,CAAL,KAAKA,oBACJiB,GAAL;AAEA,gBAAMphE,IAAUohE,EAAaphE,SAKVggE;AAAjBhgE,mBAAkCA,SAAjBggE,IAALA,KAAKA,mBAAiBhgE,SAAjBggE,EAAiBhgE,YAClCA,EAAQjiB,eAAR,EAAyBzC,kBAAzB,IAEAniB,QAAQqhD,IAAI,0CAAZ,KAGF,KAAKwlD,kBAAkBoB,GAEvB,KAAKmB,YAAY,KAAKvC,eAAtB;UAfA;QAF+D;QA2BzDuC,YAAYvC,GAAoC;AACtD,gBAAMrgE,IAAW,KAAKlhC,UAAU2jB,YAAf;AAOjB,kBANeud,EAAS6iE;YACtBxC,EAAgBhgE;YAChBggE,EAAgBgB;YAChB,KAAKjvE;UAHQ0wE,GAMf;YACE,KAAK1C,uEAAuB2C,aAAaC;AACvC,mBAAKC,0BAA0B5C,CAA/B;AACA;YACF,KAAKD,uEAAuB2C,aAAaG;AACvC,mBAAKC,oBAAoB9C,CAAzB;AACA;YACF,KAAKD,uEAAuB2C,aAAaK;AACvC,mBAAKC,oBAAoBhD,CAAzB;UARJ;AAcIrgE,YAASsjE,0BAA0BjD,EAAgBhgE,OAAnD,KACFggE,EAAgBhgE,QAAQ4lB,UAAxB;QAvBoD;QAmChD47C,iBAAiBJ,GAAwC;AAI/D,cAAI,CAACA;AACH,iBAAKL,YAAL;mBAEI,KAAKf,iBAAiB;AAGxB,kBAAMkD,IAAe,KAAKlD,gBAAgBgB,UAAUI,EAAaJ;AAMjE,aAPE,KAAKhB,gBAAgBhgE,YAAYohE,EAAaphE,WAO1BkjE,KAAgB,KAAK/C,qBACzC,KAAKY,YAAL;UAVsB;AAiB5B,eAAKf,kBADL,KAAKM,mBAAmB;QAvBuC;QA+BzDS,cAAW;AACIf,cAAAA;AAArB,gBAAMhgE,IAAgCA,SAAjBggE,IAALA,KAAKA,mBAAiBhgE,SAAjBggE,EAAiBhgE;AAEpCA,eACAA,EAAQpjB,YAAR,KACA,KAAKne,UAAU2jB,YAAf,EAA6B6gF,0BAA0BjjE,CAAvD,KAEAA,EAAQmjE,YAAR;AAEF,eAAKC,oBAAL;AACA,eAAKC,0BAAL;AACA,eAAKC,oBAAL;QAXiB;QAqBXR,oBAAoB9C,GAAoC;AAC9D,gBAAM;YAAC,OAAAgB;YAAO,SAAAhhE;UAAR,IAAmBggE;AAGzB,cAAIjO,KADEwR,IAAgB,KAAKrD,eAAec,MAAU,KAAKd,eACnB,KAAKD,aAAa,KAAKM;AAC7D,cAAI,CAACxO;AACH,kBAAUv5F,MACR,6EADI;AAKR,cAAIgrG;AACJ,cAAI;AACFA,gBAASzR,EAAgBE,sBACvB+O,EAAMjjF,eAAN,GACAijF,CAFO;UADP,SAKKtmG,GAAG;AAON6oG,iBAAiB,KAAKrD,eACxB,KAAKS,uBAAuB,KAAKV,UAAjC,GAIAlO,IAHA,KAAKkO,aAAa,KAAKO,kBACrB,KAAKN,YAAYniF,eAAjB,CADgB,MAKlB,KAAK4iF,uBAAuB,KAAKJ,WAAjC,GAEAxO,IADA,KAAKwO,cAAc,KAAKC,kBAAkB,KAAKzuE,QAA5B;gBAIjB,CAACggE;AACH,oBAAUv5F,MACR,6EADI;AAKRgrG,gBAASzR,EAAgBE,sBACvB+O,EAAMjjF,eAAN,GACAijF,CAFO;UAzBC;AA+BZ,cAAI,CAACwC;AACH,kBAAUhrG,MACR,4EADI;AAMR,cAAIgrG,MAAW,KAAKlD;AAClB,kBAAU9nG,MACR,uEADI;AAQRu5F,YAAgB1pG,YAAhB;AACiBE,wEAAjB;AAGAi7G,YAAOnlF,QAAQ2hB,CAAf;AAEA,gBAAMyjE,IAAyB,EAC7Br/F,GAAG47B,EAAQ57B,IAAIo/F,EAAOp/F,GACtBE,GAAG07B,EAAQ17B,IAAIk/F,EAAOl/F,EAFO,GAIzBo/F,IAAwBF,EAAOzc,iBAAP,EAA0BtzD,MAA1B,GACxBkwE,IAAcH;AACHl7G,uEAAjB,EAAuC44G,KAAK,MAAK;AAE/CnP,gBAAAA;AAAA,qBAAAA,IAAAA,MAAAA,EAAiB6R,uBACfD,GACAF,GACAC,CAHF;AAKA3R,gBAAAA;AAAA,qBAAAA,IAAAA,MAAAA,EAAiB1wE,WAAjB,EAA8BngB,aAAa,cAAc,SAAzD;UAP+C,CAAjD;AAUA,eAAKo/F,mBAAmBkD;QAtFsC;QA6FxDF,sBAAmB;AACzB,cAAK,KAAKhD,kBAAV;AAEA,gBAAMuD,IAAa,KAAKvD,kBAClBwD,IAAUD,EAAW9lF,eAAX,GAEVgmF,IAAeD,EAAQvkG,kBAExBykG;AAAL,iBAAiB3lE,SAAZ2lE,IAHcF,EAAQtkG,sBAGV6+B,IAAZ2lE,EAAY3lE,sBAAmCA,QAAd0lE,IAAc1lE,IAAd0lE,EAAc1lE;AAMlDylE,gBAAQ5W,OAAO,IAAf;iBANoE;AAIpE,kBAAA;AAAA,uBAAA,IAAA2W,EAAWjnF,YAAX,MAAA,EAA0BswE,OAAO,KAAjC;YAJoE;AAStE,gBAAI2W,EAAWxlE;AACb,oBAAM7lC,MACJ,0EADI;AAMR,iBAAK8nG,mBAAmB;AAExB,aADM//F,IAAMujG,EAAQziF,WAAR,MAEV9gB,EAAIW,aAAa,cAAc,QAA/B;UA1BF;QADyB;QAqCnB0hG,0BAA0B5C,GAAoC;AAC9DhgE,cAAUggE,EAAgBhgE;AAChC,eAAKqgE,mBAAmBrgE,EAAQjiB,eAAR;AACxB,eAAKsiF,iBAAiB4D,uBAAuBjkE,GAAS,IAAtD;QAHoE;QAO9DqjE,4BAAyB;AAC/B,cAAK,KAAKhD,kBAAV;AAEA,gBAAI,CAAC,KAAKL;AACR,oBAAUxnG,MACR,+EADI;AAKR,iBAAK6nG,iBAAiB4D,uBACpB,KAAKjE,gBAAgBhgE,SACrB,KAFF;AAIA,iBAAKqgE,mBAAmB;UAZxB;QAD+B;QAuBzB2C,oBAAoBhD,GAAoC;AAC9D,eAAKI,aAAaJ,EAAgBhgE,QAAQpjB,YAAxB;AAClB,cAAI,CAAC,KAAKwjF;AACR,kBAAU5nG,MACR,8FADI;AAKR,eAAK4nG,WAAW8D,mBAAmB,IAAnC;QAR8D;QAcxDd,sBAAmB;AACpB,eAAKhD,eAEV,KAAKA,WAAW8D,mBAAmB,KAAnC,GACA,KAAK9D,aAAa;QAJO;QAc3B+D,sBAAmB;AACjB,gBAAMx7F,IAAS,CAAA;AACX,eAAK43F,eACP53F,EAAOhO,KAAK,KAAK4lG,WAAjB;AAEE,eAAKN,cACPt3F,EAAOhO,KAAK,KAAKslG,UAAjB;AAEF,iBAAOt3F;QARU;QAcXg4F,uBAAuB14C,GAAuB;AACpD,cAAIA,GAAQ;AACCpqD,cAAAA,4CAAX;AACA,gBAAI;AACFoqD,gBAAO56D,QAAP;YADE,UAAJ;AAGa0Q,gBAAAA,2CAAX;YADQ;UAJA;QADwC;MAzpBlD;gBAqqBWgiG,GAAsB;AAKzB,YAAAA,EAAA2C,iBAAA3C,EAAA2C,eAAY,CAAA;AACtBA,UAAAA,EAAAG,mBAAA,CAAA,IAAA;AACAH,UAAAA,EAAAC,gBAAA,CAAA,IAAA;AACAD,UAAAA,EAAAK,mBAAA,CAAA,IAAA;MARmC,GAAtBhD,2EAAAA,yEAAsB,CAAA,EAAvC;UAaaqE,8DAAcrE,uEAAuB2C,cAruBlDl1D,iDAAA,CAAA;AAmDauyD,qDAAAA,yBAAAA;AAkrBAqE,qDAAAA,cAAAA;ACpsBP,UAAOC,4DAAP,MAAA;QAcJrlF,YAAY7mB,GAAY;AALd,eAAAmsG,YAA2B;AAMnC,eAAKnsG,OAAOA;QADU;QASxBkqB,eAAY;AACV,iBAAO,KAAKlqB,OAAO;QADT;QAUZ7D,KACEmrC,GACAC,GAAyD;AAEzD,eAAK8pB,aAAa,KAAK+6C,eAAL;AACd7kE,gBACF,KAAK4kE,YAAY5kE,GACjB3mC,OAAO2oF,OAAO,KAAKl4B,YAAY9pB,CAA/B;AAEF,eAAK8pB,WAAWw3B,SAASvhD,CAAzB;AACA,eAAK+pB,WAAWl1D,KAAhB;QARyD;QAoB3DxJ,UAAUyV,GAAiBk/B,GAAY;AACrC,eAAK+pB,WAAW1+D,UACdyV,GACA,KAAKpI,OAAO,MAAMsnC,EAAMtnC,MACxB,MAAM,KAAKkqB,aAAL,IAAsB,MAAMod,EAAMpd,aAAN,CAHpC;QADqC;QAcvCmiF,WAAWjkG,GAAiBk/B,GAAY;AACtC,gBAAMglE,IAAoB,KAAKz5C,aAAL;AAC1By5C,YAAkBp3G,QAAlB;AACA,eAAKm8D,aAAa,KAAK+6C,eAAL;eACTD,aACPvrG,OAAO2oF,OAAO,KAAKl4B,YAAY,KAAK86C,SAApC;AAGF,eAAK96C,WAAW82B,mBAAmBmkB,EAAkBnkB;AACrD,eAAK92B,WAAWw3B,SAASvhD,CAAzB;AACA,eAAK+pB,WAAWl1D,KAAhB;AACA,eAAKxJ,UAAUyV,GAAKk/B,CAApB;QAXsC;QAkBxCpyC,UAAO;AACD,eAAKm8D,cACP,KAAKA,WAAWn8D,QAAhB;QAFG;QAWGk3G,iBAAc;AACtB,iBAAO,IAAInnB;QADW;QAUdsnB,gBAAgBp3G,GAAe;AACvC,iBAAO,IAAIs7F,wDAAW,MAAMt7F,CAArB;QADgC;QAY/Bq3G,YAAYr3G,GAAiBw2F,GAAgB;AACrD,iBAAO,IAAID;YAAOv2F;YAAOw2F;UAAlB;QAD8C;QAWvD17B,iBAAiB3pD,GAAyBwpD,GAAc;AACtD,iBAAO,IAAI0zC,6DAAUl9F,GAAW,KAAKusD,aAAL,GAAqB/C,CAA9C;QAD+C;QAWxD28C,eAAevqE,GAAkBhzB,GAAiB;AAChD,iBAAO,IAAIo3F,+DAAWpkE,GAAMhzB,GAAO,KAAKmiD,UAAjC;QADyC;QAUlDwB,eAAY;AACV,iBAAO,KAAKxB;QADF;QAUZy5C,0BAA0BzD,GAAiB;AACzC,iBAAO;QADkC;QAgBjCqF,sBACR9yE,GACAuM,GACAwmE,GAAiB;AAMjB,iBAAO,CAAC,CAAC9qB,6CAAW8S,mCAClB/6D,GAJA+yE,MAAc9yC,sDAAeE,eACzB5zB,EAAY/+B,mBACZ++B,EAAY9+B,kBACT;QANQ;QAwBnBgjG,2BACExiE,GACAghE,GACAjvE,GAAkB;AAENp/B,wDACV,8BACA,OACA,OACA,wDAJF;AAMA,iBACEquG,EAAM9oG,SAAS85D,sDAAeE,gBAC9B8uC,EAAM9oG,SAAS85D,sDAAeI,qBAG5B,CAACpyB,EAAQlN,YAAR,KACD,KAAK+xE,sBACH9yE,GACAiO,EAAQpjB,YAAR,GACAokF,EAAM9oG,IAHR,IAMO6nG,uEAAuB2C,aAAaG,mBAEtC9C,uEAAuB2C,aAAaK,mBAGtChD,uEAAuB2C,aAAaG;QAzBzB;QAkCpBx1E,OAAO//B,GAAe;AACpB,gBAAMw2F,IAAO,KAAK4gB,gBAAgBp3G,CAArB;AACbw2F,YAAKzK,QAAL;AACA,eAAKsrB,YAAYr3G,GAAOw2F,CAAxB,EAA8B56B,KAA9B;QAHoB;MAlPlB,GAjCN1b,kDAAA,CAAA;AAiCa62D,sDAAAA,WAAAA;A1IjCb,UAAA72D,yDAAA,CAAA;AAgFQksC,6DAAAA,YAAAA;AACAM,6DAAAA,aAAAA;AAqCNoD,6DAAAA,mBAAAA;6DApCMyG,SAAAA;AACAnJ,6DAAAA,qBAAAA;AACAnvD,6DAAAA,QAAAA;AACA0vD,6DAAAA,MAAAA;6DACAta,OAAAA;AACAya,6DAAAA,cAAAA;AACAE,6DAAAA,cAAAA;AACAlB,6DAAAA,kBAAAA;6DACAwB,WAAAA;AAEAE,6DAAAA,aAAAA;AACA6f,6DAAAA,YAAAA;AACAxjB,6DAAAA,aAAAA;6DACA6D,iBAAAA;AACAC,6DAAAA,mBAAAA;AACAwiB,6DAAAA,aAAAA;6DACAtiB,qBAAAA;AAEAyM,6DAAAA,aAAAA;AADAyb,6DAAAA,WAAAA;AAEAjoB,6DAAAA,cAAAA;6DACA5D,MAAAA;AACA+D,6DAAAA,YAAAA;AACAG,6DAAAA,eAAAA;AACA3wC,6DAAAA,iBAAAA;6DACA6wC,SAAAA;AACA1E,6DAAAA,QAAAA;AArCQ5jF,6DAAAA,OAAAA;AAvBA3T,6DAAAA,WAAAA;6DASAE,aAAAA;A2IjCV,UAAOkkH,oDAAP,MAAA;QAUJ/lF,YACmBvgB,GACTghC,GAAY;AADH,eAAAhhC,YAAAA;AACT,eAAAghC,QAAAA;AAVF,eAAAulE,wBAAqC,CAAA;AACrC,eAAAC,cAAc,oBAAIh0D;QASJ;QAStB1uB,WAAQ;AACN,iBAAO,KAAKkd;QADN;QAURuhD,SAASvhD,GAAY;AACnB,cAAMylE,IAAY,KAAKzlE;AACvB,eAAKA,QAAQA;AAGb,cADMjzB,IAAe,KAAK/N,UAAU8N,gBAAf;AAEf24F,kBACIC,IAAeD,EAAU7iF,aAAV,MAEfn+B,6CAAYsoB,GAAc24F,CAA9B,IAGEC,IAAe,KAAK3lE,MAAMpd,aAAX,MAEfr+B,0CAASwoB,GAAc44F,CAA3B;AAKJ,mBACMvqG,IAAI,GAAG4D,GACVA,IAAY,KAAKumG,sBAAsBnqG,CAA3B,GACbA;AAEC4D,cAA2B4mG,aAA3B;AAIH,qBAAW;YAAC7rG;YAAK8rG;UAAN,KAAwB,KAAKL;AACtC,uBAAW5zD,KAAai0D,GAAe;AAC/BnoG,kBAAUk0C,EAAUl0C;AACpBooG,kBAAel0D,EAAUk0D;AAC/B,oBAAMl+F,IAAQ,KAAKo4B,SAAS,KAAKA,MAAMg9B,kBAAkBjjE,CAA7B;AAC5B2D,gBAAQkK,MAAMm+F,YAAYD,GAAcl+F,KAAS,EAAjD;YAJqC;AAQzC,qBAAW5I,KAAa,KAAKumG;AAC1BvmG,cAA2BxG,UAA3B;QAtCgB;QAiDrBwtG,mBAAmBhnG,GAAoB;AACrC,eAAKumG,sBAAsBrqG,KAAK8D,CAAhC;QADqC;QAUvCinG,qBAAqBjnG,GAAoB;AACvC,cAAI,CAAY5a,8CAAW,KAAKmhH,uBAAuBvmG,CAAlD;AACH,kBAAMjG,MACJ,6DADI;QAF+B;QAkBzC2vC,UACEhrC,GACAu/D,GACA6oC,GAAoB;AAEf,eAAKN,YAAYvtF,IAAIglD,CAArB,KACH,KAAKuoC,YAAY1tF;YAAImlD;YAAe,CAAA;UAApC;AAIF,eAAKuoC,YAAYjjH,IAAI06E,CAArB,EAAqC/hE,KAAK,EAACwC,SAAAA,GAASooG,cAAAA,EAAV,CAA1C;AAGMl+F,cAAQ,KAAKo4B,SAAS,KAAKA,MAAMg9B,kBAAkBC,CAA7B;AAC5Bv/D,YAAQkK,MAAMm+F,YAAYD,GAAcl+F,KAAS,EAAjD;QAXoB;QAoBtBmuC,YAAYr4C,GAAiC;AAC3C,cAAKA;AAIL,uBAAW,CAACu/D,GAAe+b,CAAhB,KAA6B,KAAKwsB,aAAa;AACxD,uBAASpqG,IAAI49E,EAASl+E,SAAS,GAAQ,KAALM,GAAQA;AACpC49E,kBAAS59E,CAAT,EAAYsC,YAAYA,KAC1Bs7E,EAASh9E,OAAOZ,GAAG,CAAnB;AAIC49E,gBAASl+E,UACZ,KAAK0qG,YAAY/sF,OAAOwkD,CAAxB;YARsD;QALf;QAuB7CrvE,UAAO;AACL,eAAK23G,sBAAsBzqG,SAAS;AACpC,eAAK0qG,YAAY70E,MAAjB;QAFK;MA1JH,GAvBNod,sCAAA,CAAA;AAuBau3D,0CAAAA,eAAAA;A1ICN,UAAM9oD,yDAAgB,oBAehB0pD,8EAAqCpxG,mEAerCqxG,8EAAqCpxG,mEAerCqxG,8EAAqCpxG,mEArElD+4C,0CAAA,EAwBayO,eAAAA,uDAxBb;AA8EgB30D,8CAAAA,iBAAAA;AAuCAC,8CAAAA,uBAAAA;AAhDHs+G,8CAAAA,qCAAAA;8CAfAD,qCAAAA;AAfAD,8CAAAA,qCAAAA;A2IxBN,UAAMG,2DAAiB,IAOjBC,0DAA0B,CAAA;AACvCA,8DAAc/zC,sDAAeC,WAA7B,IAA4CD,sDAAeE;AAC3D6zC,8DAAc/zC,sDAAeE,YAA7B,IAA6CF,sDAAeC;8DAC9CD,sDAAeG,cAA7B,IACEH,sDAAeI;AACjB2zC,8DAAc/zC,sDAAeI,kBAA7B,IACEJ,sDAAeG;UASJ6zC,+DAAqB,sBASrBC,+DAAqB,sBA9ClCz4D,2CAAA,EAeas4D,gBAAAA,0DA+BAG,oBAAAA,8DAxBAF,eAAAA,yDAeAC,oBAAAA,6DArCb;ACyBM,UAAOE,8DAAP,MAAA;QAYJvnE,WACEra,GACA7M,GACAhY,GACA0mG,GAAqB;AAErB,iBACE,KAAKxnF,qBAAqB2F,GAAG7M,GAAGhY,GAAY0mG,CAA5C,MACAnsB,6CAAWoU;QAJQ;QAoBvBzvE,qBACE2F,GACA7M,GACAhY,GACA0mG,GAAqB;AAErB,gBAAMC,IAAS,KAAKC,eAAe/hF,GAAG7M,CAAvB;AACf,iBAAI2uF,MAAWpsB,6CAAWoU,cACjBgY,IAMJ,KAAKE,aAFMhiF,GACA7M,CACX,IAKHhY,KACA,CAAC,KAAK8mG,aACJjiF,GACA7M,GACA0uF,KAAgB,CAHjB,IAMMnsB,6CAAW2U,4BAGb3U,6CAAWoU,cAdTpU,6CAAWwU;QAXC;QAoCvB9vE,gBACE8nF,GACAliF,GACA7M,GAAoB;AAEpB,kBAAQ+uF,GAAR;YACE,KAAKxsB,6CAAWqU;AACd,qBAAO;YACT,KAAKrU,6CAAWyU;AAEd,qBAAO;YACT,KAAKzU,6CAAWsU;AACd,qBAAO;YACT,KAAKtU,6CAAWuU;AACd,qBAAO;iBACJvU,6CAAWwU;AAUd,qBAPUn1F,gCAFMirB,IAKd,eALcA,EAMNupE,SAAR,IACA,aANcp2E,EAONo2E,SAAR;YAGJ,KAAK7T,6CAAW0U;AACd,qBAAO;YACT,KAAK1U,6CAAW2U;AACd,qBAAO;YACT,KAAK3U,6CAAW4U;AACd,qBAAO;;AAEP,qBAAO;UA7BX;QAFoB;QA2CtByX,eAAe/hF,GAAsB7M,GAAoB;AACvD,cAAI,CAAC6M,KAAK,CAAC7M;AACT,mBAAOuiE,6CAAWuU;AAEpB,cAAIkY,GACAC,GAEAzF;AACA38E,YAAE0oE,WAAF,KACFyZ,IAAgBniF,EAAEvG,eAAF,GAChB2oF,IAAgBjvF,EAAEsG,eAAF,GAEhBkjF,IAAqBxpF,MAErBivF,IAAgBpiF,EAAEvG,eAAF,GAChB0oF,IAAgBhvF,EAAEsG,eAAF,GAChBkjF,IAAqB38E,GACrBqiF,IAAqBlvF;AAEvB,iBAAIgvF,MAAkBC,IACb1sB,6CAAWqU,yBAElB4S,EAAmB/oG,SACD6tG,wDAAcY,EAAmBzuG,IAAnD,IAEO8hF,6CAAWsU,oBACTmY,EAAchoG,cAAcioG,EAAcjoG,YAC5Cu7E,6CAAWyU,8BACTgY,EAAc5pF,SAAd,KAA4B,CAAC6pF,EAAc7pF,SAAd,IAC/Bm9D,6CAAW0U,uBAElBuS,EAAmB/oG,SAAS85D,sDAAeE,gBAC3Cw0C,EAAclnG,sBACdknG,EAAclnG,mBAAmBszB,YAAjC,KAIAmuE,EAAmB/oG,SAAS85D,sDAAeI,sBAC3Cs0C,EAAcnnG,oBACdmnG,EAAcnnG,iBAAiBuzB,YAA/B,IAEOknD,6CAAW4U,6BAEb5U,6CAAWoU;QA3CqC;QAuDzDkY,aAAahiF,GAAe7M,GAAa;AACjCmvF,cAAgBtiF,EAAEupE,SAAF;AAChBgZ,cAAgBpvF,EAAEo2E,SAAF;AAEtB,cAAI,CAAC+Y,KAAiB,CAACC;AAErB,mBAAO;AAGT,mBAAShsG,IAAI,GAAGA,IAAI+rG,EAAcrsG,QAAQM;AACxC,gBAAIgsG,EAAch7F,SAAS+6F,EAAc/rG,CAAd,CAAvB;AACF,qBAAO;AAIX,iBAAO;QAfgC;QA0BzC0rG,aACEjiF,GACA7M,GACA66B,GAAgB;AAOhB,cALIhuB,EAAE4vC,aAAaz8C,CAAf,IAAoB66B,KAKpB76B,EAAEsG,eAAF,EAAmBzC,kBAAnB;AACF,mBAAO;AAGT,kBAAQ7D,EAAEvf,MAAV;YACE,KAAK85D,sDAAeI;AAClB,qBAAO,KAAK00C,sBAAsBxiF,GAAG7M,CAA9B;YACT,KAAKu6C,sDAAeE;AAGlB,kBACGz6C,EAAEqb,YAAF,KAAmB,CAACrb,EAAEmF,YAAF,EAAiBtB,kBAAjB,KACrBgJ,EAAEwO,YAAF;AAEA,uBAAO;AAET;YAEF,KAAKk/B,sDAAeC;AAIlB,kBACEx6C,EAAEqb,YAAF,KACA,CAACrb,EAAEmF,YAAF,EAAiB0Y,UAAjB,KACD,CAAC7d,EAAEmF,YAAF,EAAiBC,SAAjB;AAED,uBAAO;AAET;YAEF,KAAKm1C,sDAAeG;AAgBlB,kBAVE16C,EAAEqb,YAAF,KACA,CAACxO,EAAEvG,eAAF,EAAmBtB,kBACpB,CAAChF,EAAEmF,YAAF,EAAiBC,SAAjB,KACDpF,EAAEmF,YAAF,EAAiBH,kBAQjBhF,EAAEmF,YAAF,KACA,CAACnF,EAAEmF,YAAF,EAAiB0Y,UAAjB,KACD,CAAC7d,EAAEmF,YAAF,EAAiBC,SAAjB;AAED,uBAAO;;YAIX;AAEE,qBAAO;UAtDX;AA0DA,iBAAWwxB,kDAAoBxiC,SAAS4L,CAApC,IACK,QAGF;QAzES;QAoFRqvF,sBAAsBxiF,GAAe7M,GAAa;AAQ1D,cAPI6M,EAAE+Z,oBAOKgQ,kDAAoBxiC,SAAS4L,CAApC;AACF,mBAAO;AAGT,cAAI,CAACA,EAAE4mB;AACL,mBAAO;AAGHzhB,cAAcnF,EAAEmF,YAAF;AAEpB,iBAAKA,EAAatB,kBAAb,IAME,CAACsB,EAAaugE,iBAAb,IALC;QAnBiD;MAlSxD;AA8TGx8F,+CACE2X,qCAAKu0C,oBACLhzC,yCACTqsG,2DAHF;UAvVA14D,2CAAA,CAAA;AAyBa04D,+CAAAA,oBAAAA;ACLP,UAAOa,4DAAP,cAAyBzrD,sDAAzB;QAUJt8B,YAAYu8B,GAA4B;AACtC,gBAAMA,CAAN;AAVO,eAAArjD,OAAkBy1C;AAYpB4N,gBAGL,KAAKG,UAAUH,EAAarjD,MAC5B,KAAKyjD,UAAUJ,EAAapjD;QAPU;QAe/Bo2C,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAqBhzC,WAAjB,KAAKmgD;AACP,kBAAUljD,MACR,wFADI;AAKR,cAAI,CAAC,KAAKmjD;AACR,kBAAUnjD,MACR,wFADI;AAKRgG,YAAA,UAAkB,KAAKk9C;AACvBl9C,YAAA,UAAkB,KAAKm9C;AACvB,iBAAOn9C;QAhBM;QA4BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI2sG,2DAHE;AAKjB53D,YAASuM,UAAUl9C,EAAA;AACnB2wC,YAASwM,UAAUn9C,EAAA;AACnB,iBAAO2wC;QATI;QAiBJV,IAAI9yC,GAAgB;AAC3B,gBAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAK6M;AACR,kBAAUhjD,MACR,sFADI;AAKR,cAAI,CAAC,KAAKmjD;AACR,kBAAUnjD,MACR,wFADI;AAKJmD,cACF8C,EAAUm9C,mBAAmB,KAAKJ,KAAlC,IAEA/8C,EAAUtW,eAAe,KAAKwzD,SAAS,KAAKD,SAAS,KAAKF,KAA1D;QAjByB;MAzEzB;AAoGG76D,+CAAkB2X,qCAAKsG,OAAkB+uC,gDAAYo5D,yDAA9D;AAxHA,UAAAv5D,iDAAA,CAAA;AAoBau5D,qDAAAA,YAAAA;ACAP,UAAOC,4DAAP,cAAyB1rD,sDAAzB;QAaJt8B,YAAYu8B,GAA8B3mC,GAAgB;AACxD,gBAAM2mC,CAAN;AAbO,eAAArjD,OAAkB01C;AAepB2N,gBAGL,KAAKnmC,UAAUmmC,EAAapjD,MAC5B,KAAKyc,UAA6B,gBAAnB,OAAOA,IAA0B,KAAKA;QAPG;QAejD25B,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKn5B;AACR,kBAAU5c,MACR,4FADI;AAKR,cAAI,CAAC,KAAKoc;AACR,kBAAUpc,MACR,yFADI;AAKRgG,YAAA,UAAkB,KAAK4W;AACvB5W,YAAA,UAAkB,KAAKoW;AACvB,iBAAOpW;QAhBM;QA4BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI4sG,2DAHE;AAKjB73D,YAAS/5B,UAAU5W,EAAA;AACnB2wC,YAASv6B,UAAUpW,EAAA;AACnB,iBAAO2wC;QATI;QAiBJV,IAAI9yC,GAAgB;AAC3B,gBAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAK6M;AACR,kBAAUhjD,MACR,sFADI;AAKR,cAAI,CAAC,KAAK4c;AACR,kBAAU5c,MACR,4FADI;AAKR,cAAI,CAAC,KAAKoc;AACR,kBAAUpc,MACR,yFADI;AAKJmD,cACF8C,EAAUqW,mBAAmB,KAAK0mC,OAAO,KAAK5mC,OAA9C,IAEAnW,EAAUqW,mBAAmB,KAAK0mC,OAAO,KAAKpmC,OAA9C;QAvByB;MA5EzB;AA6GGz0B,+CAAkB2X,qCAAKsG,OAAkBgvC,gDAAYo5D,yDAA9D;AAjIA,UAAAx5D,iDAAA,CAAA;AAoBaw5D,qDAAAA,YAAAA;ACaP,UAAOC,kDAAP,MAAA;QASJjoF,YAAmBvgB,GAAoB;AAApB,eAAAA,YAAAA;AAHX,eAAA2gE,cAAc,oBAAInuB;QAGa;QAGvC7gB,QAAK;AACH,qBAAW5d,KAAa,KAAK4sD,YAAYvsD,OAAjB;AACtB,mBAA0B,IAAnBL,EAAUjY;AACf,mBAAK2sG,eAAe10F,EAAU,CAAV,CAApB;AAGJ,cAA8B,MAA1B,KAAK4sD,YAAY5vD;AACnB,kBAAMhX,MAAM,wBAAN;QAPL;QAmBLkc,eAAe/B,GAAyBiC,GAAe;AACrD,cAAIjC,EAASxa,SAASyc,GAAtB;AAEA,gBAAMuyF,IAAc,KAAK9wF,YAAYzB,GADxBjC,EAASza,IACF,GACd6J,IAAS,KAAKtD,UAAU8T,aAAa,KAA5B,GACTyK,IAA2Bhf,EAAAA,6CAAX;AACjBgf,iBACQ/e,EAAAA,6CAAS,IAApB;AAEF,gBAAI;AAGGkpG,mBAAeA,EAAYv0F,MAAZ,MAAwBD,EAASC,MAAT,IAG1C,KAAKw0F,4BACHz0F,GACAiC,GACAuyF,GACAplG,CAJF,IAFA,KAAKslG,uBAAuB10F,GAAUiC,GAAS7S,CAA/C;YAJA,UAAJ;AAca9D,gBAAAA,6CAAS+e,CAApB;YADQ;UArBV;QADqD;QAkCvDlI,mBAAmBvW,GAAYqW,GAAe;AAC5C,gBAAMjC,IAAW,KAAK6D,gBAAgBjY,CAArB;AACjB,cAAI,CAACoU;AACH,kBAAMna,MAAM,uDAAuD+F,CAA7D;AAGR,eAAKmW,eAAe/B,GAAUiC,CAA9B;QAN4C;QAiBtCyyF,uBACN10F,GACAiC,GACA7S,GAAe;AAEJxgB,mDACT,KAAgBS,wCAAe4rD,8CAA1B,GAAuCj7B,GAAUiC,CAAtD,CADF;AAGAjC,YAASxa,OAAOyc;AAChB,eAAS/Z,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM;AACjCkH,cAAOlH,CAAP,EAAU43F,cAAc9/E,CAAxB;QAPa;QAsBTy0F,4BACNz0F,GACAiC,GACAuyF,GACAplG,GAAe;AAEf,gBAAM7J,IAAOya,EAASza;AAGlB0c,gBAFYuyF,EAAYhvG,QAI1B,KAAKkvG,uBAAuBF,GAAavyF,GAAS7S,CAAlD;AAKF,eAASlH,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM;AACjCkH,cAAOlH,CAAP,EAAU63F,cAAc//E,EAASC,MAAT,GAAkBu0F,EAAYv0F,MAAZ,CAA1C;AAGSrxB,mDAAK,KAAgBS,wCAAe2rD,8CAA1B,GAAuCh7B,CAA5C,CAAhB;AAEW9uB,wDAAW,KAAKu7E,YAAYp9E,IAAIkW,CAArB,GAA6Bya,CAAnD;QAlBe;QAiCjBxqB,eACEgQ,GACAkc,GACAwnC,GAAsB;AAEtB,cAAIlpC,IAAW,KAAK0D,YAAYle,GAAMkc,CAAvB;AACf,cAAI1B,GAAU;AACZ,gBAAIkpC,KAAUlpC,EAASC,MAAT,MAAqBipC;AACjC,oBAAMrjD,MACJ,eACEL,IACA,wCACAwa,EAASC,MAAT,IACA,+CAEAipC,IACA,IARE;AAYR,mBAAOlpC;UAdK;AAgBd,cAAIkpC,KAAU,KAAKrlC,gBAAgBqlC,CAArB;AACZ,kBAAMrjD,MAAM,mBAAmBqjD,IAAS,uBAAlC;AAEFt9C,cAAKs9C,KAAsBx6D,gDAAZ;AACf6W,cAAOmc,KAAY;AACzB1B,cAAW,IAAIc,oDAAc,KAAKhV,WAAWtG,GAAMD,GAAMqG,CAA9C;AAELiU,cAAY,KAAK4sD,YAAYp9E,IAAIkW,CAArB,KAA8B,CAAA;AAChDsa,YAAU7X,KAAKgY,CAAf;AAKA,eAAKysD,YAAYlnD,OAAOhgB,CAAxB;AACA,eAAKknE,YAAY7nD,IAAIrf,GAAMsa,CAA3B;AAEWjxB,mDAAK,KAAgBS,wCAAe27B,8CAA1B,GAAuChL,CAA5C,CAAhB;AAEA,iBAAOA;QArCe;QA8CxBu0F,eAAev0F,GAAuB;AACpC,gBAAM20F,IAAa30F,EAASC,MAAT,GACbob,IAAe,KAAKoxC,YAAYp9E,IAAI2wB,EAASza,IAA9B;AACrB,cAAI81B;AACF,qBAASnzB,IAAI,GAAGA,IAAImzB,EAAazzB,QAAQM;AAEvC,kBADgBmzB,EAAanzB,CAAb0sG,EACJ30F,MAAR,MAAoB00F,GAAY;AAClCt5E,kBAAavyB,OAAOZ,GAAG,CAAvB;AACWtZ,yDACT,KAAgBS,wCAAe2rD,8CAA1B,GAAuCh7B,CAA5C,CADF;AAG4B,sBAAxBqb,EAAazzB,UACf,KAAK6kE,YAAYlnD,OAAOvF,EAASza,IAAjC;AAEF;cARkC;;QANJ;QA0BtC0jD,mBAAmBr9C,GAAU;AAC3B,gBAAMoU,IAAW,KAAK6D,gBAAgBjY,CAArB;AACjB,cAAIoU,GAAU;AAEZ,gBAAM60F,IAAe70F,EAASxa;AAC9B,kBAAMsvG,IAAO,KAAKC,oBAAoBnpG,CAAzB;AACb,qBAAS1D,IAAI,GAAGvN,GAAQA,IAAQm6G,EAAK5sG,CAAL,GAAUA;AACxC,kBACiB,6BAAfvN,EAAM4K,QACS,2BAAf5K,EAAM4K,MACN;AACMyvG,oBAAgB1uG,OAAO3L,EAAM6rC,cAAc,MAApB,CAAP;AAChByuE,oBAAapzF,EAAAA,+BAAA,iCAChBhP,QAAQ,MAAMgiG,CADE,EAEhBhiG,QAAQ,MAAMmiG,CAFE;AAGZ/gH,oDAAMghH,CAAb;AACA;cANA;AAUc,gBAAdH,EAAKltG,UAEDstG,IAAcrzF,EAAAA,+BAAA,6BACjBhP,QAAQ,MAAMvM,OAAOwuG,EAAKltG,MAAZ,CADG,EAEjBiL,QAAQ,MAAMgiG,CAFG,GAGb1gH,sCAAQ+gH,GAAcx8D,OAAM;AAC7BA,mBAAM14B,KACR,KAAKm1F,uBAAuBn1F,GAAU80F,CAAtC;YAF+B,CAAnC,KAOA,KAAKK,uBAAuBn1F,GAAU80F,CAAtC;UA9BU;AAiCZtuG,oBAAQxG,KAAK,yCAAyC4L,CAAtD;QAnCyB;QA+C7BupG,uBAAuBn1F,GAAyB80F,GAAa;AAC3D,gBAAMzqF,IAA2Bhf,EAAAA,6CAAX;AACjBgf,eACQ/e,EAAAA,6CAAS,IAApB;AAEF,cAAI;AACF,qBAASpD,IAAI,GAAGA,IAAI4sG,EAAKltG,QAAQM;AAC/B4sG,gBAAK5sG,CAAL,EAAQxN,QAAQ,IAAhB;AAEF,iBAAK65G,eAAev0F,CAApB;UAJE,UAAJ;AAMa1U,cAAAA,6CAAS+e,CAApB;UADQ;QAViD;QAwB7D3G,YAAYle,GAAckc,GAAwB;AAGhD,cADM0zF,IAAO,KAAK3oC,YAAYp9E,IADjBqyB,KAAY,EACZ;AAEX,qBAASlF,IAAI,GAAGwD,GAAWA,IAAWo1F,EAAK54F,CAAL,GAAUA;AAC9C,kBAAIisB,EAAAA,mCAAMC,OAAO1oB,EAASxa,MAAMA,CAA5B;AACF,uBAAOwa;;AAIb,iBAAO;QAVyC;QAmBlD6D,gBAAgBjY,GAAU;AACxB,qBAAWiU,KAAa,KAAK4sD,YAAYvsD,OAAjB;AACtB,uBAAWF,KAAYH;AACrB,kBAAIG,EAASC,MAAT,MAAqBrU;AACvB,uBAAOoU;AAIb,iBAAO;QARiB;QAmB1BW,mBAAmBpb,GAAmB;AAGpC,kBADM81B,IAAe,KAAKoxC,YAAYp9E,IAD/BkW,KAAQ,EACM,KAEZ81B,EAAapyB,MAAb,IAEF,CAAA;QAN6B;QAmBtCosG,iBAAiB97F,GAAoB;AACnC,gBAAM+7F,IAAgB,IAAI/sG,IAAY,KAAKkkE,YAAY3lE,KAAjB,CAAhB;AACtB,cAAIyS,KAAMA,EAAGqK,wBAAH;AACR,uBAAW/c,KAAO0S,EAAGqK,wBAAH,EAA8B6oD,YAAY3lE,KAA1C;AAChBwuG,gBAAcrhG,IAAIpN,CAAlB;AAGCyuG,YAAcvwF,IAAI,EAAlB,KACHuwF,EAAcrhG,IAAI,EAAlB;AAEF,iBAAO5J,MAAMC,KAAKgrG,EAAcp1F,OAAd,CAAX;QAV4B;QAkBrCsC,kBAAe;AACb,cAAIF,IAAgC,CAAA;AACpC,qBAAWzC,KAAa,KAAK4sD,YAAYvsD,OAAjB;AACtBoC,gBAAeA,EAAalY,OAAOyV,CAApB;AAEjB,iBAAOyC;QALM;QAafpB,sBAAmB;AACjB,iBAAO7W,MAAMC,KAAK,KAAKmiE,YAAYvsD,OAAjB,CAAX,EACJq1F,KADI,EAEJ/sG,IAAKwX,OAAaA,EAASxa,IAFvB;QADU;QAYnBuvG,oBAAoBnpG,GAAU;AAC5B,gBAAMkpG,IAAO,CAAA,GACP1lG,IAAS,KAAKtD,UAAU8T,aAAa,KAA5B;mBAEN1X,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM,KAAK;AACtC,kBAAM4X,IAAiB1Q,EAAOlH,CAAP,EAAU6X,aAAV;AACvB,gBAAID;AACF,uBAAStD,IAAI,GAAGA,IAAIsD,EAAelY,QAAQ4U;AACrCsD,kBAAetD,CAAf,EAAkByD,MAAlB,MAA8BrU,KAChCkpG,EAAK9sG,KAAKoH,EAAOlH,CAAP,CAAV;UALgC;AAUxC,iBAAO4sG;QAdqB;MAtY1B,GAjCNj6D,qCAAA,CAAA;AAiCay5D,yCAAAA,cAAAA;ACOP,UAAOkB,6CAAP,MAAA;QA2BA,IAAA,WAAQ;AACV,iBAAO,KAAKC;QADF;QAYR,IAAA,YAAS;AACX,iBAAO,KAAK/+B;QADD;QA4CbrqD,YAAYqnB,GAAqB;AAlCjC,eAAAgiE,aAbA,KAAAh/B,oBAZA,KAAA++B,mBAPA,KAAAtrF,WAAW;AAsCX,eAAAwrF,WAAW;AAGX,eAAAC,mBAAmC,CAAA;AAGlB,eAAAlnE,YAAqB,CAAA;AACrB,eAAAmnE,cAAkC,CAAA;AAClC,eAAAC,YAAY,oBAAIx3D;AAChB,eAAAy3D,YAAwB,CAAA;AAC/B,eAAAC,aAAyB,CAAA;AACzB,eAAAC,aAAyB,CAAA;AAClB,eAAAC,UAAU,oBAAI53D;AACd,eAAA63D,gBAAgB,oBAAI73D;AAE7B,eAAA83D,eAA8B,IAAItoC;eAUlCnqD,uBAA2C;AAIjD,eAAK/X,KAAiBld,gDAAZ;AACHe,0DAAkB,IAAzB;AACA,eAAKsX,UAAU2sC,KAAe,IAAII,uCAAQ,CAAA,CAAZ;AAC9B,eAAKt2B,MAAM,CAAC,CAAC,KAAKzW,QAAQyW;AAC1B,eAAKU,mBAAmB,CAAC,CAAC,KAAKnX,QAAQmX;AACvC,eAAKmtD,kBAAkB,KAAKtkE,QAAQskE;AAUpC,eAAKx/C,oBAAoB,KARer9B,oDAC7BmX,qCAAKu0C,oBACd,KAAKnzC,SACL,IAH6BsvG,GAQsB,IAA5B;AAOzB,eAAK5pC,cAAc,IAAI6nC,gDAAY,IAAhB;QAvBY;QA8BjC55G,UAAO;AACL,eAAKq7G,UAAUnuG,SAAS;AACxB,eAAK61B,MAAL;AAEO/tC,2DAAmB,IAA1B;QAJK;QAgBC4mH,aACN3kF,GACA7M,GAA2B;AAE3B,gBAAMhN,IACJW,KAAK6pB,IAAStqC,4CAAUw9G,2CAAUe,UAAzB,CAAT,KAAkD,KAAK/4F,MAAM,KAAK;AAC9Dg5F,cAAM7kF,EAAEzM,uBAAF;AACNuxF,cAAM3xF,EAAEI,uBAAF;AACZ,iBAAOsxF,EAAI7kG,IAAImG,IAAS0+F,EAAI/kG,KAAKglG,EAAI9kG,IAAImG,IAAS2+F,EAAIhlG;QAN3B;QAc7B6rF,YAAY3iG,GAAY;AACtB,eAAK+zC,UAAU1mC,KAAKrN,CAApB;QADsB;QASxBijG,eAAejjG,GAAY;AACzB,cAAI,CAAYzJ;YAAW,KAAKw9C;YAAW/zC;UAAtC;AACH,kBAAMkL,MAAM,2DAAN;QAFiB;QAa3Bu1B,aAAa2jE,IAAU,OAAK;AAE1B,gBAAM3vF,IAAS,CAAA,EAAmBhF,OAAO,KAAKskC,SAA/B;AACXqwD,eAA2B,IAAhB3vF,EAAOxH,UACpBwH,EAAOyR,KAAK,KAAKy1F,aAAa1lH,KAAK,IAAvB,CAAZ;AAEF,iBAAOwe;QANmB;QAc5BmuF,cAAc5iG,GAAY;AACnB,eAAKw7G,cAAcpxF,IAAIpqB,EAAM4K,IAA7B,KACH,KAAK4wG,cAAcvxF,IAAIjqB,EAAM4K,MAAM,CAAA,CAAnC;AAEF,eAAK4wG,cAAc9mH,IAAIsL,EAAM4K,IAA7B,EAAoCyC,KAAKrN,CAAzC;QAJwB;QAY1BmjG,iBAAiBnjG,GAAY;AAChBzJ,wDAAW,KAAKilH,cAAc9mH,IAAIsL,EAAM4K,IAA7B,GAAqC5K,CAA3D;AACK,eAAKw7G,cAAc9mH,IAAIsL,EAAM4K,IAA7B,EAAoCqC,UACvC,KAAKuuG,cAAc5wF,OAAO5qB,EAAM4K,IAAhC;QAHyB;QAe7BwiC,gBAAgBxiC,GAAcw5F,IAAU,OAAK;AAC3C,cAAI,CAAC,KAAKoX,cAAcpxF,IAAIxf,CAAvB;AACH,mBAAO,CAAA;AAEH6J,cAAS,KAAK+mG,cAAc9mH,IAAIkW,CAAvB,EAA8B0D,MAAM,CAApC;AACX81F,eAAW3vF,KAA0B,IAAhBA,EAAOxH,UAC9BwH,EAAOyR,KAAK,KAAKy1F,aAAa1lH,KAAK,IAAvB,CAAZ;AAGF,iBAAOwe,EAAOrgB,OAAO,SAAU4L,GAAY;AACzC,mBAAO,CAACA,EAAMguB,kBAAN;UADiC,CAApC;QAToC;QAoB7CghC,cAAc7jC,GAAyB;AACrC,eAAK+vF,YAAY7tG,KAAK8d,CAAtB;AAII,eAAKgwF,UAAU/wF,IAAIe,EAAQla,EAA3B,KACFpF,QAAQxG,KACN,gEACE8lB,EAAQla,KACR,GAHJ;AAMF,eAAKkqG,UAAUlxF,IAAIkB,EAAQla,IAAIka,CAA/B;QAZqC;QAqBvCukC,iBAAiBvkC,GAAyB;AACxC,cAAI,CAAY50B,8CAAW,KAAK2kH,aAAa/vF,CAAxC;AACH,kBAAMjgB,MACJ,+DADI;AAMR,eAAKiwG,UAAUvwF,OAAOO,EAAQla,EAA9B;QARwC;QAmB1C8b,eAAeq3E,IAAU,OAAK;AAE5B,gBAAM9lD,IAAW,CAAA,EAA8B7uC,OAAO,KAAKyrG,WAA1C;AACb9W,eAA6B,IAAlB9lD,EAASrxC,UACtBqxC,EAASp4B,KAAK,KAAKy1F,aAAa1lH,KAAK,IAAvB,CAAd;AAEF,iBAAOqoD;QANqB;QAgB9Br5B,aAAam/E,IAAU,OAAK;AAE1B,cAAIA,GAAS;AAEX,gBAAMrwD,IAAY,KAAKtT,aAAa,IAAlB;AAClBhsB,gBAAS,CAAA;AACT,qBAASlH,IAAI,GAAGA,IAAIwmC,EAAU9mC,QAAQM;AACpCkH,gBAAOpH,KAAK,GAAG0mC,EAAUxmC,CAAV,EAAawD,eAAe,IAA5B,CAAf;UALS;AAUX,iBADA0D,IAAS,KAAKgsB,aAAa,KAAlB,GACAlzB,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM;AACjCkH,gBAAOpH,KAAK,GAAGoH,EAAOlH,CAAP,EAAUsd,YAAY,KAAtB,CAAf;AAUJ,iBAJiBpW,EAAOrgB,OAAO,SAAU4L,GAAK;AAC5C,mBAAO,CAACA,EAAMguB,kBAAN;UADoC,CAA7B+tF;QAnBS;QA2B5Bj5E,QAAK;AACH,eAAKi4E,aAAa;AAClB,cAAI;AACF,kBAAMrrF,IAA2Bhf,EAAAA,6CAAX;AAItB,iBAHKgf,KACQ/e,EAAAA,6CAAS,IAApB,GAEK,KAAKojC,UAAU9mC;AACpB,mBAAK8mC,UAAU,CAAf,EAAkBh0C,QAAQ,KAA1B;AAEF,mBAAO,KAAKm7G,YAAYjuG;AACtB,mBAAKiuG,YAAY,KAAKA,YAAYjuG,SAAS,CAA3C,EAA8ClN,QAA9C;AAES4Q,cAAAA,6CAAS+e,CAApB;AACA,iBAAKoiD,YAAYhvC,MAAjB;AACI,iBAAK9Z,wBACP,KAAKA,qBAAqB8Z,MAA1B;UAdA,UAAJ;AAiBE,iBAAKi4E,aAAa;UADV;QAlBP;QA+BLvzF,mBAAmBvW,GAAYqW,GAAe;AAC5C,eAAKwqD,YAAYtqD,mBAAmBvW,GAAIqW,CAAxC;QAD4C;QAe9CzsB,eACEgQ,GACAkc,GACAwnC,GAAsB;AAEtB,iBAAO,KAAKujB,YAAYj3E,eAAegQ,GAAMkc,GAAUwnC,CAAhD;QAFe;QAWxB6rD,oBAAoBnpG,GAAU;AAC5B,iBAAO,KAAK6gE,YAAYsoC,oBAAoBnpG,CAArC;QADqB;QAU9Bq9C,mBAAmBr9C,GAAU;AAC3B,eAAK6gE,YAAYxjB,mBAAmBr9C,CAApC;QAD2B;QAa7B8X,YAAYle,GAAckc,GAAiB;AAEzC,iBAAO,KAAK+qD,YAAY/oD,YAAYle,GAAMkc,CAAnC;QAFkC;QAW3CmC,gBAAgBjY,GAAU;AACxB,iBAAO,KAAK6gE,YAAY5oD,gBAAgBjY,CAAjC;QADiB;QAY1B+U,mBAAmBpb,GAAmB;AACpC,iBAAO,KAAKknE,YAAY9rD,mBAAmBpb,CAApC;QAD6B;QAUtC8vG,mBAAgB;AACd,iBAAO,KAAK5oC,YAAY4oC,iBAAiB,IAAlC;QADO;QAShB7yF,kBAAe;AACb,iBAAO,KAAKiqD,YAAYjqD,gBAAjB;QADM;QASftB,sBAAmB;AACjB,iBAAO,KAAKurD,YAAYvrD,oBAAjB;QADU;QAWnBgF,WAAQ;AACN,iBAAO;QADD;QAeR0E,SAASoV,GAAuBkpB,GAAe;AAC7C,gBAAUrjD,MACR,0EADI;QADuC;QAc/CghB,WAAWjb,GAAW;AACpB,gBAAU/F,MACR,4EADI;QADc;QActB8wG,oBAAiB;AACf,iBAAIp+E,MAAM,KAAKxxB,QAAQ2kE,SAAnB,IACK/sC,WAGF,KAAK53B,QAAQ2kE,YAAY,KAAK9rD,aAAa,KAAlB,EAAyBhY;QAL1C;QAejBgvG,wBAAwBrxG,GAAY;AAClC,iBAAK,KAAKwB,QAAQ4kE,gBAKoB/iE,WAApC,KAAK7B,QAAQ4kE,aAAapmE,CAA1B,IACI,KAAKwB,QAAQ4kE,aAAapmE,CAA1B,IACAo5B,YAEqB,KAAKoJ,gBAAgBxiC,GAAM,KAA3B,EAAkCqC,SARpD+2B;QAFyB;QAuBpCugE,oBAAoBvwF,GAAsC;AACxD,cAAI,CAAC,KAAKswF,eAAL;AACH,mBAAO;AAET,cAAI4X,IAAsB;AAC1B,qBAAWtxG,KAAQoJ,GAAe;AAChC,gBAAIA,EAAcpJ,CAAd,IAAsB,KAAKqxG,wBAAwBrxG,CAA7B;AACxB,qBAAO;AAETsxG,iBAAuBloG,EAAcpJ,CAAd;UAJS;AAMlC,iBAAIsxG,IAAsB,KAAKF,kBAAL,IACjB,QAEF;QAdiD;QAuB1D1X,iBAAc;AACZ,iBAAkCtgE,aAA3B,KAAK53B,QAAQ2kE,aAA0B,CAAC,CAAC,KAAK3kE,QAAQ4kE;QADjD;QAUdjjE,eAAY;AACV,iBAAO,KAAKstG;QADF;QAUZz+D,eAAY;AACV,iBAAO,KAAK0+D;QADF;QASZ5jE,KAAKykE,GAAa;AAChB,cAAMC,IAAaD,IAAO,KAAKb,aAAa,KAAKD,YAC3CgB,IAAcF,IAAO,KAAKd,aAAa,KAAKC;AAClD,gBAAMgB,IAAaF,EAAWnmG,IAAX;AACnB,cAAKqmG,GAAL;AAKA,qBAFIpuG,IAAS,CAACouG,CAAD,GAGXF,EAAWnvG,UACXqvG,EAAWtuG,SACXsuG,EAAWtuG,UAAUouG,EAAWA,EAAWnvG,SAAS,CAA/B,EAAkCe,SACvD;AACA,oBAAMlB,IAAQsvG,EAAWnmG,IAAX;AACTnJ,mBACLoB,EAAOb,KAAKP,CAAZ;YAHA;AAMF,iBAASS,IAAI,GAAGA,IAAIW,EAAOjB,QAAQM;AAEjC8uG,gBAAYhvG,KADEa,EAAOX,CAAPT,CACd;AAEFoB,gBAAoB9Z,2CAAO8Z,GAAQiuG,CAA1B;AACExvG,cAAAA,kDAAc,KAAzB;AACA,gBAAI;AACF,mBAASY,IAAI,GAAGA,IAAIW,EAAOjB,QAAQM;AACnBW,kBAAOX,CAAPT,EACRq0C,IAAIg7D,CAAV;YAHA,UAAJ;AAMaxvG,gBAAAA,kDAAc,IAAzB;YADQ;UA1BV;QAJgB;QAoClB4vG,YAAS;AACP,eAAKlB,WAAWpuG,SAAS;AACzB,eAAKquG,WAAWruG,SAAS;AAEd5Y,+DAAX;QAJO;QAgBTm7C,kBAAkB/5B,GAA2B;AAC3C,eAAK2lG,UAAU/tG,KAAKoI,CAApB;AACA,iBAAOA;QAFoC;QAU7CqoE,qBAAqBroE,GAAc;AACtBlf,wDAAW,KAAK6kH,WAAW3lG,CAAtC;QADiC;QASnC/H,mBAAmBZ,GAAe;AAChC,cAAIA,EAAMD;AAGR,iBAFA,KAAKwuG,WAAWhuG,KAAKP,CAArB,GACA,KAAKwuG,WAAWruG,SAAS,GAClB,KAAKouG,WAAWpuG,SAAS,KAAK+tG,YAA6B,KAAjB,KAAKA;AACpD,mBAAKK,WAAW59D,MAAhB;AAGJ,mBAASlwC,IAAI,GAAGA,IAAI,KAAK6tG,UAAUnuG,QAAQM;AAEzC,aAAA,GADa,KAAK6tG,UAAU7tG,CAAfkI,GACR3I,CAAL;QAV8B;QAoBlC0E,aAAaP,GAAU;AACrB,iBAAO,KAAKsqG,QAAQ7mH,IAAIuc,CAAjB,KAAwB;QADV;QAWvBuxF,aAAavxF,GAAYjR,GAAY;AACnC,eAAKu7G,QAAQtxF,IAAIhZ,GAAIjR,CAArB;QADmC;QAUrCojG,gBAAgBnyF,GAAU;AACxB,eAAKsqG,QAAQ3wF,OAAO3Z,CAApB;QADwB;QAW1B4iC,eAAe5iC,GAAU;AAChB,cAAA;AAAP,iBAAO,SAAA,IAAA,KAAKkqG,UAAUzmH,IAAIuc,CAAnB,KAAA,IAA0B;QADV;QAYzB04F,gBAAgBC,GAAmC;AACjD,gBAAMn1F,IAAS,KAAKgsB,aAAa,KAAlB;AACf,mBAASlzB,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM;AAEjC,gBAAI,CADUkH,EAAOlH,CAAPvN,EACH2pG,gBAAgBC,CAAtB;AACH,qBAAO;AAGX,iBAAO;QAR0C;QAkBnD3gF,0BAAuB;AACrB,iBAAO,KAAKD;QADS;QASvBwzF,6BAA0B;AACxB,eAAKxzF,uBAAuB,IAAI2wF,gDAAY,IAAhB;QADJ;QAS1B/xF,iBAAc;AACZ,iBAAO,KAAKkqD;QADA;QAUdG,eAAeH,GAAwB;AACrC,eAAKA,cAAcA;QADkB;QAKvC/pD,kBAAe;AACb,iBAAO,KAAK0zF;QADC;QAWflnE,mBAAgB;AACd,cAAIkoE,IAAU;AACd,gBAAM/qG,IAAS,KAAKtF,QAAQ4G;AAGxB,eAAKmW,WACHzX,KAAUA,EAAOtF,YACnBqwG,IAAU/qG,EAAOtF,QAAQ4G,mBAElBtB,MACT+qG,IAAU/qG;AAEZ,iBAAO+qG;QAZO;QAqBTC,OAAAA,QAAQzrG,GAAU;AACvB,iBAAcrc,+CAAiBqc,CAAxB;QADgB;QASlB0rG,OAAAA,SAAM;AACX,iBAAc9nH,+CAAP;QADI;MAhzBT;AAOGgmH,iDAAAe,aAAa;AA/CtB,UAAA17D,kCAAA,CAAA;AAwCa26D,sCAAAA,YAAAA;ACnBb,UAAM+B,qDAAc,KAKPC,wDAAP,MAAA;QAcJnrF,YAAoB1e,GAA6B;AAA7B,eAAAA,kBAAAA;AAZZ,eAAA8pG,SAAS,oBAAIn5D;AAGb,eAAAo5D,aAA0B;AAG1B,eAAAC,QAAiB;QAMwB;QAOjDj9G,UAAO;AACL,eAAK+8G,OAAOh6E,MAAZ;QADK;QAYPl6B,KAAKq0G,GAAqBpyG,GAAY;AACpC,cAAKoyG,EAAUhwG,QAAf;AAIA,gBAAI;AACF,kBAAAiwG,IAAY,IAAIj7D,WAAA;YADd,SAEK70C,GAAG;AAGV;YAHU;AAMZ,qBAASG,IAAI,GAAGA,IAAI0vG,EAAUhwG,QAAQM,KAAK;AACzC,oBAAM4vG,IAAWF,EAAU1vG,CAAV,GACX6vG,IAAMD,EAAS/+F,MAAM,UAAf;AACZ,kBAAIg/F,KAAOF,EAAUG,YAAY,WAAWD,EAAI,CAAJ,CAAjC,GAA0C;AAEnD,oBAAAE,IAAQ,IAAIr7D,WAAA,MAAoBk7D,CAAxB;AACR;cAHmD;YAHZ;AASvCG,iBACF,KAAKR,OAAO7yF,IAAIpf,GAAMyyG,CAAtB;UAtBF;QADoC;QAgCtCnhE,UAAO;AACL,qBAAWmhE,KAAS,KAAKR,OAAOv3F,OAAZ,GAAsB;AACxC+3F,cAAMC,SAAS;AACf,kBAAMC,IAAcF,EAAMp3E,KAAN;AAEAj4B,uBAAhBuvG,IAKFA,EAAY5J,KAAK0J,EAAMG,KAAvB,EAA8BC,MAE5B,WAAA;YAAA,CAFF,IAKAJ,EAAMG,MAAN;AAMF,gBAAc3hE,+CAAkBmH;AAC9B;UArBsC;QADrC;QAkCP/c,KAAKr7B,GAAc8yG,GAAmB;AACpC,cAASX,CAAL,KAAKA,OAAT;AAGA,gBAAMM,IAAQ,KAAKR,OAAOpoH,IAAImW,CAAhB;AACVyyG,iBAEIM,IAAM,oBAAIr3E,QAEM,SAApB,KAAKw2E,cACLa,EAAIj3E,QAAJ,IAAgB,KAAKo2E,WAAWp2E,QAAhB,IAA4Bi2E,uDAI9C,KAAKG,aAAaa,GAMhBC,IAJY/hE,+CAAkBkH,iDAIpBs6D,IAEAA,EAAMh7E,UAAN,GAEZu7E,EAAQN,SAAwBtvG,WAAf0vG,IAA2B,IAAIA,GAChDE,EAAQ33E,KAAR,MACS,KAAKlzB,mBAEd,KAAKA,gBAAgBizB,gBAArB,EAAuCC,KAAKr7B,GAAM8yG,CAAlD;UA3BF;QADoC;QAmCtCG,SAASd,GAAc;AACrB,eAAKA,QAAQA;QADQ;QAOvBe,WAAQ;AACN,iBAAO,KAAKf;QADN;MA7IJ,GA1BN98D,wCAAA,CAAA;AA0Ba28D,4CAAAA,iBAAAA;ACZP,UAAOmB,oDAAP,MAAA;QASJtsF,YAAoBvgB,GAAuB;AAAvB,eAAAA,YAAAA;AAHZ,eAAA8sG,SAAS,oBAAIt6D;AAQnB,cAJMzkC,IAAe/N,EAAU8N,gBAAV;AAKnB,iBAAKi/F,YAAY,KAAKC,gBAAgBj/F,CAArB,GACjB,KAAKk/F,iBAAiB,KAAKC,qBAAqBn/F,CAA1B;AAKlBo/F,cAAa,KAAKC,YAAsBrgE,mCAA3B;AACfxnD,oDAAS4nH,GAAY,oBAAzB;AACME,cAAc,KAAKD,YAAsB5uD,oCAA3B;AAChBj5D,oDAAS8nH,GAAa,qBAA1B;QAfyC;QAkBnCL,gBAAgBj/F,GAAqB;AAC3C,gBAAMjM,IAAUxc;YAAiBqwC,qCAAI0S;YAAK,EACxC,SAAS,2BACT,OAAazgC,yCACb,cAAkB0gC,0CAClB,eAAmBC,2CACnB,SAAW,MAL6B;UAA9B;AAOZx6B,YAAazjB,OAAOwX,CAApB;AACA,iBAAWxc,kDAAiBqwC,qCAAI8e,GAAG,CAAA,GAAI3yC,CAAhC;QAToC;QAYrCorG,qBAAqBn/F,GAAqB;AAChD,gBAAMjM,IAAUxc,kDAAiBqwC,qCAAI0S,KAAK;YACxC,SAAS;YACT,OAAazgC;YACb,cAAkB0gC;YAClB,eAAmBC;YACnB,SAAW;UAL6B,CAA9B;AAOZx6B,YAAazjB,OAAOwX,CAApB;AACA,iBAAWxc,kDAAiBqwC,qCAAI8e,GAAG,CAAA,GAAI3yC,CAAhC;QATyC;QAmBlDozB,uBAAuB3xB,GAAsB;AACbwpG,cAAAA;AAA9B,gBAAMO,IAAmB,SAAKP,IAALA,KAAKA,aAAL,SAAKA,EAAW7nG,aAAa,WAA7B;AAGzB,cAAIooG,GAAkB;AACfL,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,mBAAAA,EAAgBxqG,aAAa,aAAa6qG,CAA/C;UADoB;AAGjBL,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,mBAAAA,EAAgB5lG,YAAY9D,EAAKqf,WAAL,CAAjC;QAP2C;QAe7C2qF,gBAAgBC,GAAsBC,GAAgB;AAC9CC,cAAc,aAAaF,EAAS7nG,CAAtB,KAA4B6nG,EAAS3nG,CAArC,WAAiD4nG,CAAjD;AACfV,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,cAAAA,EAAWtqG,aAAa,aAAairG,CAA1C;AACA,qBAAW,CAAA,EAAIC,CAAJ,KAAc,KAAKb;AAC5Ba,cAAMlrG,aAAa,aAAairG,CAAhC;QAJkD;QActD7qD,gBAAgBt/C,GAAsB;AAC/BwpG,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,cAAAA,EAAW1lG,YAAY9D,EAAKqf,WAAL,CAA5B;QADoC;QAStCsgC,iBAAiB3/C,GAAwBqqG,GAAgB;AACvD,eAAKtjH,OAAOiZ,GAAMqqG,CAAlB;QADuD;QAUzDtjH,OAAOiZ,GAAwBqqG,GAAgB;AACxC,eAAKd,OAAO7zF,IAAI20F,CAAhB,KACH,KAAKR,YAAYQ,CAAjB;AAEF,cAAA;AAAA,mBAAA,IAAA,KAAKd,OAAOvpH,IAAIqqH,CAAhB,MAAA,EAA2BvmG,YAAY9D,EAAKqf,WAAL,CAAvC;QAJ6C;QAavCwqF,YAAYQ,GAAgB;AAClC,gBAAMrtG,IAAS,KAAKP,UAAU6tG,YAAf,GACTF,IAAYroH;YAAiBqwC,qCAAI8e;YAAG,CAAA;UAA5B;AAEd,cAAIq5D,IAAW;AACf,gBAAMC,IAAe,CAAC,GAAG,KAAKjB,MAAT,EAAiB/3F,KAAK,CAAC8Q,GAAG7M,MAAM6M,EAAE,CAAF,IAAO7M,EAAE,CAAF,CAAvC;AACrB,qBAAW,CAACg1F,GAAKC,CAAN,KAAcF;AACvB,gBAAIH,IAAWI,GAAK;AAClBztG,gBAAOgH,aAAaomG,GAAOM,CAA3B;AACAH,kBAAW;AACX;YAHkB;AAMjBA,eACHvtG,EAAO8G,YAAYsmG,CAAnB;AAEF,eAAKb,OAAOh0F,IAAI80F,GAAUD,CAA1B;AACA,iBAAOA;QAjB2B;QA0BpCO,SAAS3qG,GAAgB;AACvB,iBACEA,MAAS,KAAKwpG,aACd,IAAItwG,IAAI,KAAKqwG,OAAO14F,OAAZ,CAAR,EAA8B6E,IAAI1V,CAAlC;QAHqB;QAazB4qG,gBAAa;AACX,iBAAO,KAAKrB,OAAOvpH,IAAcwpD,mCAA1B;QADI;QAUbqhE,iBAAc;AACZ,iBAAO,KAAKtB,OAAOvpH,IAAci7D,oCAA1B;QADK;MAxKV,GAdNzP,sCAAA,CAAA;AAca89D,0CAAAA,eAAAA;AjJgEb,UAAMwB,0DAAqB,IAMd5mE,oDAAP,cAA4BiiE,2CAA5B;QA+OJnpF,YAAYtlB,GAAgB;AAC1B,gBAAMA,CAAN;AA3OM,eAAAqzG,uBAAkD;AAmBlD,eAAAC,iBANA,KAAAC,aANC,KAAAnwF,WAAW;AAkFpB,eAAAowF,eAHA,KAAAC,eAHA,KAAAjlF,UAhCA,KAAAE,UAAU;AAyCF,eAAAglF,cAAiC;AAMjC,eAAA3vG,WAHR,KAAAD,QAAQ;AASA,eAAA6vG,UAHA,KAAAC,SAAS;AAqET,eAAAC,mBAHR,KAAA72F,kBARQ,KAAA82F,qBARR,KAAAC,uBAVQ,KAAAC,yBAPA,KAAAlhG,eANR,KAAA6tD,kBAPQ,KAAAszC,WANA,KAAA/lE,SALR,KAAA/3B,YAHA,KAAA84B,WAA4B;AAkEpB,eAAAilE,wBAAwB;AAYf,eAAAC,oBAAgC,CAAA;AASzC,eAAAC,2BAA2B,oBAAI78D;AAS/B,eAAA88D,wBAAwB,oBAAI98D;AAK5B,eAAA+8D,kBAAqC;AAG7C,eAAA/kD,4BAA4B;AAGpB,eAAAglD,qBAAwC,CAAA;AAGxC,eAAAC,kBACN,CAAA;AAWF,eAAAtlE,gBATQ,KAAAulE,eAAoC;AAuB1C,eAAK3tE,iBAAiB,KANer/C;YAC1BmX,qCAAKg1C;YACd5zC;YACA;UAH0B00G,GAMmB,IAAzB;AAGtB,eAAKh4D,aACH18C,EAAQ08C,cACR,KAAK5V,eAAe4V,WAAW7yD,KAAK,KAAKi9C,cAAzC;AAGF,eAAKwI,aACHtvC,EAAQsvC,cAAc9C,kDAAamoE;AAErC,eAAKhM,mBAAmB,IAAItxD;AAE5B,eAAKw3D,mBAAmBl2C,kDAAa/9D,KAAK,KAAKkqB,iBAAvB;AAKxB,eAAK8vF,eAAe,IAAInE,sDACtBzwG,EAAQ4G,eADU;AAKpB,eAAKywD,OAAO,KAAKr3D,QAAQ2tC,cACrB,IAAIC,iCAAK,KAAK5tC,QAAQ2tC,aAAa3tC,EAAQ6tC,WAA3C,IACA;AAGJ,eAAKgnE,gBAAgB,IAAI5mD,oDAAc,IAAlB;AAEjB6mD,6CAAuBlnH,mDACzB,KAAKmnH,gCACOxyD,gDACA30D,+CAFZ;AAMEonH,qDAAqCpnH,2DACvC,KAAKmnH;YACcxyD;YACA30D;UAFnB;AAMEqnH,8CAAyBrnH,qDAC3B,KAAKmnH,gCACQxyD,iDACA30D,gDAFb,GAIA,KAAKw1C,kBAA6BrpC,qDAAlC;AAIF,eAAKm7G,gBAAgB,KAAKl1G,QAAQ4G,kBAC9B,KAAK5G,QAAQ4G,gBAAgB4nC,gBAA7B,IACA,IAAI68D;YAAa;YAAM,KAAKrrG,QAAQ+lC,SAAS29B;UAA7C;AACJ,eAAKwxC,cAAcnJ,mBAAmB,IAAtC;AAMe7mC,cAAAA;AAHf,eAAKj/B,WAA0BrrC,6DAC7B,KAAKoF,QAAQimC,YAAY,SACzB,KAAKpd,SAAL,GACaq8C,SAAAA,IAAbA,KAAKllE,QAAQklE,qBAAAA,IAAqBrjE,MAHpB;AAUhB,eAAKszG,sBAAsB,IAAI1lG,uCAAK,GAAG,CAAZ;QA9ED;QAsF5B2lG,mBAAgB;AACd,iBAAO,KAAKP;QADE;QAShB9tE,oBAAiB;AACf,iBAAO,KAAKD;QADG;QAUjBuuE,kBAAkBvuE,GAA+B;AAC/C,eAAKA,iBAAiBA;AACtB,eAAK4V,aAAa,KAAK5V,eAAe4V,WAAW7yD,KAAK,KAAKi9C,cAAzC;QAF6B;QAUjDiZ,sBAAmB;AACjB,iBAAO,KAAK4oD;QADK;QAWnBz5C,aAAaC,GAAqB;AAChC,eAAK0lD,cAAc3lD,aAAaC,CAAhC;QADgC;QAWlCR,aAAaU,GAAqB;AAChC,eAAKwlD,cAAclmD,aAAaU,CAAhC;QADgC;QAYlCP,UAAUjqD,GAAU;AAClB,iBAAI,KAAKgwG,gBACA,KAAKA,cAAc/lD,UAAUjqD,CAA7B,IAEF;QAJW;QAYpBgqD,YAAS;AACP,iBAAI,KAAKgmD,gBACA,KAAKA,cAAchmD,UAAnB,IAEF;QAJA;QAYTnmC,cAAW;AACT,iBAAO,KAAKud;QADH;QAUXuI,kBAAe;AACb,iBAAO,KAAK0mE;QADC;QASfrsF,WAAQ;AACN,iBAAO,KAAKqsF,cAAcrsF,SAAnB;QADD;QAURy+D,SAASvhD,GAAY;AACdA,gBACHA,IAAQ29B;AAEV,eAAKwxC,cAAc5tB,SAASvhD,CAA5B;QAJmB;QAUrB4lE,eAAY;AACN,eAAKrJ,aACP,KAAKr8D,SAAS6kE,WAAW,KAAKxI,WAAW,KAAKz5E,SAAL,CAAzC;AAIF,eAAKysF,mBACH,KAAKz8F,aAAa,KAAlB,EAAyB7wB,OAAO,SAAU4L,GAAK;AAC7C,mBAAO,CAAC,CAACA,EAAM88E,aAAN;UADoC,CAA/C,CADF;AAOA,eAAK6kC,wBAAL;AACI,eAAKtB,YACP,KAAKA,SAAStI,aAAd;AAIE,eAAKv5G,UAAL,KACF,KAAKqrD,WAAW,IAAhB;AAGF,gBAAM/8C,IAAQ,KAAgBpY,wCAAeisD,gDAA1B,GACjB,KAAK1rB,SAAL,EAAgBpqB,MAChB,KAAKoG,EAFO;mDAIEnE,CAAhB;QA3BU;QAmCJ40G,mBAAmBjtG,GAAe;AACxC,mBAASlH,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA,KAAK;AAC/C,kBAAMuhE,IAAiB9uE,EAAM88E,aAAN;AACnBhO,iBACe9uE,EACR68E,SAAS/N,CAAlB;UAJ6C;QADT;QAe1CrkB,sBAAmB;AAGjB,cAAI,KAAK61D,uBAAuB;AAC9B,kBAAMsB,IAAM,KAAK1uG,aAAL,EAAoBgE,aAApB;AACR0qG,kBACF,KAAK3B,mBAAmB2B,EAAIzqG,QAAJ,GACxB,KAAKmpG,wBAAwB;UAJD;AAQhC,iBAAO,KAAKL;QAXK;QAenBpkE,yBAAsB;AACpB,eAAKykE,wBAAwB;QADT;QAUtB9hH,YAAS;AACP,iBAAO,KAAKmhH;QADL;QAaT/4E,SAAS/2B,GAAmB;AAC1B,cAAIiH,IAAI,GACJE,IAAI,GACJ9G,IAAQ;AACZ,cACE,KAAK8rE,UAAL,EAAiB3iE,SAASxJ,CAA1B,KACA,KAAKunE,gBAAL,EAAuB/9D,SAASxJ,CAAhC;AAGAK,gBAAQ,KAAKA;AAEf,aAAG;AAED,kBAAM+N,IAAajmB,oDAAc6X,CAAtB;AACX,gBAAIA,MAAY,KAAKmsE,UAAL,KAAoBnsE,MAAY,KAAKunE,gBAAL;AAE9ClnE,kBAAQ;AAEV4G,iBAAKmH,EAAGnH,IAAI5G;AACZ8G,iBAAKiH,EAAGjH,IAAI9G;AACZL,gBAAUA,EAAQ2J;UATjB,SAWD3J,KACAA,MAAY,KAAKqD,aAAL,KACZrD,MAAY,KAAKoP,gBAAL;AAEd,iBAAO,IAAI7C,mDAAWtF,GAAGE,CAAlB;QA1BmB;QAmC5B5D,yBAAsB;AACpB,gBAAM8O,IAAO,KAAKq/F;AAClB,iBAAO,IAAI1lG,uCAAKqG,EAAK1O,OAAO0O,EAAKxO,MAA1B;QAFa;QActB2L,0BAAuB;AACrB,iBAAepnB,wDAAkB,KAAK+jF,UAAL,CAA1B;QADc;QAavB/8D,kBAAe;AAGb,cAAI,CAAC,KAAKC,cAAc;AACtB,gBAAIrP,IAAmB,KAAK6+F;AAC5B,mBAAO7+F,KAAS;AAEd,mBAAK,OADWA,EAAQwG,aAAa,OAArB,KAAiC,MAC5B,KAAKkI,SAAS,gBAA/B,GAAkD;AACpD,qBAAKW,eAAerP;AACpB;cAFoD;AAItDA,kBAAUA,EAAQ2J;YANJ;UAFM;AAWxB,iBAAO,KAAK0F;QAdC;QAsBf8/F,cAAW;AACT,iBAAO,KAAKtQ;QADH;QAUXlzC,iBAAc;AACZ,iBAAO,KAAKwgB,UAAL;QADK;QASdhhC,wBAAwB+jB,GAA2B;AACjD,eAAK0gD,uBAAuB1gD;QADqB;QAWnDvhE,UAAUqkH,GAA8B3iG,GAAsB;AACvD,eAAKA,iBACR,KAAKA,eAAeA,QAAAA,IAAAA,IAAgB;AAWtC,eAAKwvF,YAAgBj4G,kDAAiBqwC,qCAAI8e,GAAG,EAAC,SAAS,mBAAV,CAA5B;AAKbi8D,gBACF,KAAKC,iBAAqBrrH,kDACxBqwC,qCAAIof,MACJ,EAAC,QAAU,QAAQ,OAAS,QAAQ,SAAS27D,EAA7C,GACA,KAAKnT,SAHe,GAMM,4BAAxBmT,KAAmD,KAAKp+C,OAC1D,KAAKq+C,eAAe/nG,MAAMy7D,OACxB,UAAU,KAAK/R,KAAKkK,aAAV,IAA2B,MAEvC,KAAK2zC,cAAczmE,UACjB,KAAKinE,gBACL,6BACA,MAHF;AAQJ,eAAKjB,eAAe,IAAI7C,kDAAa,IAAjB;AAEpB,eAAK+D,kBAAkB,KAAKlB,aAAavB,cAAlB;AACvB,eAAK0C,mBAAmB,KAAKnB,aAAatB,eAAlB;eAEdp2F,aACMnzB,sDACZ,KAAK04G,WACL,eACA,MACA,KAAKvwC,cACL,KALF,GAUA,KAAK+hD,qBAAqB,MAAK;UAAA,GAC/B9nG,SAASwC,KAAK7E,iBAAiB,SAAS,KAAKmqG,kBAA7C,GACclqH,sDACZ,KAAK04G,WACL,SACA,MACA,KAAKuT,aAJP;AAUE,eAAK71G,QAAQxT,kBAMf,KAAKynH,WAAW,KALcxsH,oDACnBmX,qCAAK20C,SACd,KAAKvzC,SACL,IAHmB81G,GAKa,IAAlB;AAEd,eAAKz+C,QACP,KAAKA,KAAK4J,OAAO,KAAKn9D,KAAtB;AAEF,eAAKusE,kBAAL;AAMA,WALM0lC,IAAuBtuH,oDAClBmX,qCAAKy0C,QACd,KAAKrzC,OAFa,MAKL,KAAK60G,cAAc9lD,UAAU,IAAIgnD,GAAjC;AAEf,eAAK9vE,SAAS70C,UAAU,KAAKkxG,WAAW,KAAKz5E,SAAL,CAAxC;AACA,iBAAO,KAAKy5E;QArFgD;QA4FrD3uG,UAAO;AAEd,eAAKyvB,WAAW;AACZ,eAAKu9C,mBACP,KAAKA,gBAAgB9C,OAArB;AAEE,eAAKykC,aACH53G,4CAAW,KAAK43G,SAApB;AAEE,eAAK2R,aACP,KAAKA,SAAStgH,QAAd,GACA,KAAKsgH,WAAW;AAEd,eAAK/lE,WACP,KAAKA,OAAOv6C,QAAZ,GACA,KAAKu6C,SAAS;AAEZ,eAAKe,aACP,KAAKA,SAASt7C,QAAd,GACA,KAAKs7C,WAAW;AAEd,eAAK94B,cACP,KAAKA,UAAUxiB,QAAf,GACA,KAAKwiB,YAAY;AAEf,eAAK+4B,iBACP,KAAKA,cAAcv7C,QAAnB;AAGE,eAAKihH,gBACP,KAAKA,aAAajhH,QAAlB;AAGE,eAAK0jE,SACP,KAAKA,OAAO;AAGd,eAAKpxB,SAAStyC,QAAd;AAEI,eAAKkhH,iBACP,KAAKA,cAAclhH,QAAnB;AAGF,gBAAMA,QAAN;AAGI,eAAKuhH,kBACP,KAAKA,cAAclJ,qBAAqB,IAAxC,GACA,KAAKkJ,cAAcp5D,YAAY,KAAK45D,cAApC,GACK,KAAK11G,QAAQ4G,mBAChB,KAAKsuG,cAAcvhH,QAAnB;AAIJ,eAAKk7G,iBAAiBhuG,SAAS;AAE/B,eAAKuzG,yBAAyB19E,MAA9B;AACA,eAAK29E,sBAAsB39E,MAA3B;AAEA,cAAI,CAAC,KAAK12B,QAAQ4G,iBAAiB;AAGjC,kBAAMovG,IAAY,KAAKlvG,aAAL;AACdkvG,iBAAaA,EAAU5oG,cACrB1iB,4CAAWsrH,EAAU5oG,UAAzB;UAL+B;AAQ/B,eAAKimG,yBACOvpH,6CAAO,KAAKupH,oBAA1B,GACA,KAAKA,uBAAuB;AAI1B,eAAKS,uBACP9nG,SAASwC,KAAK1E,oBAAoB,SAAS,KAAKgqG,kBAAhD,GACA,KAAKA,qBAAqB;QA3Ed;QAoFhBzlE,cAAW;AACT,eAAKY,WAAWzC,kDAAaypE,YAAY,IAAzB;AAChB,gBAAMC,IAAc,KAAKjnE,SAAS79C,UAAd;AACpB,eAAKkxG,UAAUh2F,aAAa4pG,GAAa,KAAKtmC,UAAL,CAAzC;QAHS;QAUJqmC,OAAAA,YAAYE,GAAwB;AACzC,gBAAUr3G,MACR,6EADI;QADmC;QAY3CyvC,kBAAe;AACb,eAAKW,gBAAgB,IAAI+P,kDAAa,IAAjB;AACrB,gBAAMm3D,IAAkB,KAAKlnE,cAAc99C,UAAnB;AACxB,eAAKkxG,UAAUl2F,YAAYgqG,CAA3B;QAHa;QAafjoE,UAAUv6B,GAAuD;AAC/D,gBAAMy7D,IAAmB,IAAItiC,uCAAQ;YACnC,iBAAmB;YACnB,KAAO,KAAKt2B;YACZ,eAAiB,KAAKzW,QAAQ0kE;YAC9B,kBAAoB,KAAKvtD;YACzB,UAAY,KAAKnX,QAAQimC;YACzB,mBAAqB,KAAKjmC,QAAQklE;YAClC,MAAQ,EACN,YAAc,KADR;UAP2B,CAAZ;AAWzBmK,YAAiB/K,kBAAkB,KAAKtkE,QAAQskE;AAO9C,eAAKp2B,SANH,KAAK/2B,mBAMO,KALoB1vB,oDACvBmX,qCAAK+0C,4BACd,KAAK3zC,SACL,IAHuBq2G,GAKWhnC,CAAtB,IAOA,KALkB5nF;YACrBmX,qCAAK80C;YACd,KAAK1zC;YACL;UAHqBs2G,GAKWjnC,CAApB;AAEhB,eAAKnhC,OAAOiyB,YAAY;AACxB,eAAKjyB,OAAO/K,aAAZ,EAA2Bsa,WAAW,IAAtC;AAKA,iBAAO,KAAKvP,OAAO98C,UAAUwiB,CAAtB;QAlCwD;QA6CjEm7B,UAAUwnE,GAAiB;AACzB,iBAAI,KAAKroE,UAAUqoE,IACV,KAAKroE,SAEV,KAAK+lE,WACA,KAAKA,SAASllE,UAAd,IAEF;QAPkB;QAe3BD,aAAU;AACR,iBAAO,KAAKmlE;QADJ;QAQFuC,4BAAyB;AAC/B,eAAK/mE,uBAAL;AACA,eAAK4gC,kBAAL;QAF+B;QAYjCpyD,iBAAc;AACP,eAAKq1F,kBAAmB,KAAKlwF,aAG9B,KAAKjN,aACP,KAAKA,UAAUzO,OAAf,GAEF,KAAK+nC,uBAAL;QAPY;QAiBd/nC,SAAM;AACA,eAAKusG,YACP,KAAKA,SAASnlG,SAAd;eAEOo/B,UACP,KAAKA,OAAOp/B,SAAZ;AAGF,gBAAM2nG,IAAgB,KAAK9N,iBAAiBvwD,cAC1Cf,0DAAiBN,WAAWE,cAC5B,IAFoB,GAIhBhhC,IAAU,KAAK8wB,kBAAL,EAAyB2vE,aAAzB,GACVj/F,IAAiB,CAAA;AACvB,mBAAStW,IAAI,GAAGw1G,GAAeA,IAAeF,EAAct1G,CAAd,GAAmBA,KAAK;AACpEw1G,cAAa7nG,SAASmH,GAASwB,CAA/B;AACA,kBAAM7E,IAAe+jG,EAAalwE,qBAAb;AACjB7zB,iBACF6E,EAAexW,KAAK2R,CAApB;UAJkE;AAQlE,eAAKuD,aACP,KAAKA,UAAUzO,OAAf;AAEF,eAAK8uG,0BAAL;QAzBI;QAkCNr5C,qCAAkC;AAEhC,gBAAMy5C,IAAqB7qH,wDAAR;AACdikB,6DAAW2xB;YAAO,KAAKqyE;YAAwB4C;UAA/C,MACH,KAAK5C,yBAAyB4C,GAC9B,KAAKJ,0BAAL;QAL8B;QAalCx8E,kBAAe;AACb,iBAAO,KAAKy6E;QADC;QASf7kC,YAAS;AACP,iBAAO,KAAK6kC,aAAcvB,cAAnB;QADA;QAYTzrG,uBAAuBL,GAAsBE,GAAqB;AAChE,gBAAMT,IAAM,KAAKC,aAAL;AACC,kBAATM,MACF,KAAK+tG,oBAAoB/tG,QAAQA,GAGjCP,EAAIW,aAAa,qBAAqB,GAAGJ,CAAH,EAAtC;AAEY,kBAAVE,MACF,KAAK6tG,oBAAoB7tG,SAASA,GAGlCT,EAAIW,aAAa,sBAAsB,GAAGF,CAAH,EAAvC;QAZ8D;QAqBlE0jE,kBAAe;AACb,iBAAO,KAAKypC,aAActB,eAAnB;QADM;QAWfrsG,eAAY;AACV,cAAI,CAAC,KAAKwtG,iBAAiB;AACzB,gBAAI7wG,IAAU,KAAK6+F;AACnB,mBAAO7+F,KAAS;AACd,kBAAwB,UAApBA,EAAQmQ,SAAmB;AAC7B,qBAAK0gG,kBAAkB7wG;AACvB;cAF6B;AAI/BA,kBAAUA,EAAQ2J;YALJ;UAFS;AAU3B,iBAAO,KAAKknG;QAXF;QAoBZuC,+BAA4B;AAC1B,cAAgB3uH,8CAAX,GAAL;AAGA,gBAAM4b,IAAQ,KAAKA,OACbiL,IAAM,CAAC,KAAKyf,SACZxf,IAAO,CAAC,KAAK0f;AACnB,gBACE,EAAA5qB,MAAU,KAAKC,YACe,IAA9B2N,KAAKwP,IAAInS,IAAM,KAAK6kG,MAApB,KACgC,IAAhCliG,KAAKwP,IAAIlS,IAAO,KAAK2kG,OAArB,IAHF;AASA,kBAAMjzG,IAAQ,KAAgBpY,wCAAeob,mDAA1B,GACjBqL,GACAC,GACAlL,GACA,KAAKe,IACL,KAAKd,QALO;AAOd,mBAAKA,WAAWD;AAChB,mBAAK8vG,SAAS7kG;AACd,mBAAK4kG,UAAU3kG;AACJnnB,uDAAK6Y,CAAhB;YAnBA;UANA;QAD0B;QAqC5BqgB,UAAUrW,GAAWE,GAAS;AACvB6pG,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,iBAAAA,EAAcnC,gBAAgB,IAAItiG,mDAAWtF,GAAGE,CAAlB,GAAsB,KAAK9G,KAA9D;AACKuzD,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,SAAAA,EAAMj+D,OAAOsR,GAAGE,CAArB;AACA,eAAKisG,6BAAL;QAH4B;QAYrB13F,WAAQ;AACf,gBAAMlJ,IAAU,KAAKymC,WAAL;AAChB,iBAAOzmC,IAAUA,EAAQ+mC,YAAY,KAAKl5C,QAAQ;QAFnC;QAWjB25C,WAAWrrD,GAAkB;AAC3B,eAAKmhH,aAAanhH;AACb,eAAKkwG,cAMN,KAAKnsF,aACP,KAAKA,UAAU6nC,oBAAoB5rD,CAAnC,GAKE,KAAK28C,UAAL,KACF,KAAKA,UAAL,EAAkBiP,oBAAoB5rD,CAAtC,GAGF,KAAK0U,aAAL,EAAoB6G,MAAMkB,UAAUzc,IAAY,UAAU,QACtD,KAAK6hH,YAEP,KAAKA,SAASx2D,WAAWrrD,CAAzB,GAEGA,KACH,KAAKmM,UAAU,IAAf;QAxByB;QA+B7Bo1B,SAAM;AAEJ,gBAAMtrB,IAAS,KAAKwQ,aAAa,KAAlB;AAEf,mBAAS1X,IAAIkH,EAAOxH,SAAS,GAAQ,KAALM,GAAQA;AACtCkH,cAAOlH,CAAP,EAAUxS,YAAV;AAGF,eAAK0lC,aAAL,EACGyiF,QAASljH,OAAUA,EAAM+Q,eAAe,KAArB,CADtB,EAEG3c,OAAQ4L,OAAUA,EAAMguB,kBAAN,CAFrB,EAGGqf,QAASrtC,OAAUA,EAAMjF,YAAN,CAHtB;AAMGC,uEADH,EAEG44G,KAAK,MAAM,KAAK,KAAKqN,cAAcvlD,cAAnB,CAFnB;QAbI;QA4BNynD,eAAelyG,GAAmBmyG,GAAmB;AACnD,cAAkBn1G,WAAdm1G,GAAyB;AAE3B,qBAAS71G,IAAI,GAAGvN,GAAQA,IAAQ,KAAKugH,kBAAkBhzG,CAAvB,GAA4BA;AAC1DvN,gBAAMo3D,eAAe,KAArB;AAEF,iBAAKmpD,kBAAkBtzG,SAAS;UALL;AAS7B,cADMjN,IAAQiR,IAAK,KAAKO,aAAaP,CAAlB,IAAwB;AAIzC,aAFML,IAAsB3C,WAAdm1G,KAA2BA,KAI7B,KAAK7C,kBAAkBhiG,SAASve,CAAhC,KACV,KAAKugH,kBAAkBlzG,KAAKrN,CAA5B,IAFWzJ,8CAAW,KAAKgqH,mBAAmBvgH,CAA9C,GAIFA,EAAMo3D,eAAexmD,CAArB;QAlBiD;QA2BrD+wG,0BAAuB;AACrB,gBAAM/iG,IAAK,KAAKuK,WAAW,KAAKC,kBAAkB;AAC9CxK,eAAM,CAACA,EAAGmuD,mBAAmBnuD,EAAGyhG,YAAYzhG,EAAGyhG,SAASllE,UAAZ,KAC9Cv8B,EAAGyhG,SAASgD,iBAAZ;QAHmB;QAcd77F,mBAAmBvW,GAAYqW,GAAe;AACrD,gBAAME,mBAAmBvW,GAAIqW,CAA7B;AACA,eAAKq6F,wBAAL;QAFqD;QAW9CrzD,mBAAmBr9C,GAAU;AACpC,gBAAMq9C,mBAAmBr9C,CAAzB;eACK0wG,wBAAL;QAFoC;QAgB7B9mH,eACPgQ,GACAkc,GACAwnC,GAAsB;AAEhB7mC,cAAS,MAAM7sB,eAAegQ,GAAMkc,GAAUwnC,CAArC;AACf,eAAKozD,wBAAL;AACA,iBAAOj6F;QAJe;QAQxB+0D,oBAAiB;AACf,gBAAM6mC,IAAc,KAAKvO,iBAAiBvwD,cACxCf,0DAAiBN,WAAWG,aAC5B,IAFkB;AAKpB,eAAKs9D,kBAAkB,CAAA;AACvB,mBAASrzG,IAAI,GAAGg2G,GAAaA,IAAaD,EAAY/1G,CAAZ,GAAiBA,KAAK;AAC9D,kBAAMi5B,IAAO+8E,EAAWC,cAAX;AACTh9E,iBACF,KAAKo6E,gBAAgBvzG,KAAK,EACxB02C,WAAWw/D,GACXE,YAAYj9E,EAFY,CAA1B;UAH4D;QAPjD;QA4BRvW,SAASoV,GAAuBkpB,GAAe;AACtD,gBAAUrjD,MACR,0EADI;QADgD;QAcxDghB,WAAWjb,GAAW;AACpB,gBAAU/F,MACR,4EADI;QADc;QAetBw4G,cAAct2G,GAAe;AAC3B,mBAASG,IAAI,GAAGg2G,GAAaA,IAAa,KAAK3C,gBAAgBrzG,CAArB,GAA0BA;AAClE,gBAAIg2G,EAAWE,WAAWpqG,SAASjM,EAAE2J,SAAS3J,EAAE6J,OAA5C;AACF,qBAAOssG,EAAWx/D;AAGtB,iBAAO;QANoB;QAcrBoa,aAAa/wD,GAAe;AAClC,gBAAMyH,IAAU,KAAK4sD,WAAWr0D,CAAhB;AACZyH,eACFA,EAAQ+2D,cAAcx+D,GAAG,IAAzB;QAHgC;QAapC66B,UAAU76B,GAAiB6Q,GAAc;AAEjC3Y,cAAsBjP,iDAC1B+W,GACA,KAAK8F,aAAL,GACA,KAAKu3C,oBAAL,CAHY;AAMdnlD,YAAMwR,KAAK,KAAK5G;AAChB5K,YAAM0R,KAAK,KAAK9G;AAChB,eAAK4vG,cAAc1jG,mDAAWkD;YAAWrB;YAAI3Y;UAA1B;QAVoB;QAmBzC+tD,SAASjmD,GAAe;AAChB9H,cAAsBjP,iDAC1B+W,GACA,KAAK8F,aAAL,GACA,KAAKu3C,oBAAL,CAHY;AAMdnlD,YAAMwR,KAAK,KAAK5G;AAChB5K,YAAM0R,KAAK,KAAK9G;AAChB,iBAAOkM,mDAAW8Q,IAAI,KAAK4yF,aAAcx6G,CAAlC;QATe;QAiBxB6M,aAAU;AACR,iBAAgC,SAAzB,KAAK46D,mBAA4B,KAAKA,gBAAgB56D,WAArB;QADhC;QASVnO,cAAW;AACT,iBAAO,KAAKoI,QAAQmvC,eAAe,KAAKnvC,QAAQmvC,YAAYrT;QADnD;QAeXF,YAAS;AACP,iBACG,KAAK57B,QAAQmvC,eAAe,CAAC,CAAC,KAAKnvC,QAAQmvC,YAAYC,cACvD,KAAKpvC,QAAQmvC,eAAe,KAAKnvC,QAAQmvC,YAAYi2B,SACrD,KAAKplE,QAAQmvC,eAAe,KAAKnvC,QAAQmvC,YAAYrT,QACrD,KAAK97B,QAAQ+tC,eAAe,KAAK/tC,QAAQ+tC,YAAYq3B,SACrD,KAAKplE,QAAQ+tC,eAAe,KAAK/tC,QAAQ+tC,YAAY6vB;QANjD;QAeThD,wBAAqB;AACnB,gBAAMkK,IAAgB,CAAC,CAAC,KAAK3uD;AAC7B,iBACE,KAAKylB,UAAL,MACC,CAACkpC,KACCA,KAAiB,KAAK3uD,UAAWa,sBAAhB;QALH;QAcrB8jD,sBAAmB;AACjB,gBAAMgK,IAAgB,CAAC,CAAC,KAAK3uD;AAC7B,iBACE,KAAKylB,UAAL,MACC,CAACkpC,KACCA,KAAiB,KAAK3uD,UAAWC,oBAAhB;QALL;QAcXy/F,cAAc70G,GAAa;AAEjC,cAAIgoC,uCAAQC,WAAR;AACFjoC,cAAE4yB,eAAF,GACA5yB,EAAE6yB,gBAAF;eAFF;AAKA,gBAAM0jF,IACJ,KAAKv3G,QAAQ+tC,eAAe,KAAK/tC,QAAQ+tC,YAAYq3B,OACjDoyC,IACJ,KAAKx3G,QAAQmvC,eAAe,KAAKnvC,QAAQmvC,YAAYi2B;AACvD,gBAAKmyC,KAAiBC,GAAtB;AAIA,kBAAMC,IAA4BvtH,2DAAqB8W,CAAnC;AAKpB,kBAAcqJ;AACZ,oBAAAqtG,IAAa12G,EAAE6qD;AAGb0rD,oBAAiBv2G,EAAEoJ,WAAWstG,KAAc,CAACF,MAKzCxwD,IAAQ,CAACywD,EAAY7sG,IADE+sG,IAEvB7oG,IAAyB7kB,iDAC7B+W,GACA,KAAK8F,aAAL,GACA,KAAKu3C,oBAAL,CAHe,GAKjB,KAAKkC,KAAKzxC,EAASpE,GAAGoE,EAASlE,GAAGo8C,CAAlC,MAGIt8C,IAAI,KAAKgkB,UAAU+oF,EAAY/sG,GAC/BE,IAAI,KAAK4jB,UAAUipF,EAAY7sG,GAE/B5J,EAAE4qD,YAAY,CAAC6rD,EAAY/sG,MAI7BA,IAAI,KAAKgkB,UAAU+oF,EAAY7sG,GAC/BA,IAAI,KAAK4jB,UAEX,KAAK0sC,OAAOxwD,GAAGE,CAAf;AAEF5J,gBAAE4yB,eAAF;YAvCA;UATA;QAFiC;QA4DnC2D,uBAAoB;AAClB,gBAAMqgF,IAAc,KAAKhwE,sBAAL;AAEpB,cAAI,CAACgwE,EAAY/2G;AACf,mBAAO,IAAI+P,uCAAK,GAAG,GAAG,GAAG,CAAlB;AAIT,gBAAMinG,IAAWD,EAAY,CAAZ,EAAenxE,qBAAf;AAGjB,mBAAStlC,IAAI,GAAGA,IAAIy2G,EAAY/2G,QAAQM,KAAK;AAC3C,gBAAM22G,IAAaF,EAAYz2G,CAAZ;AAEhB22G,cAAmBl2F,qBACnBk2F,EAAmBl2F,kBAAnB,MAIGm2F,IAAgBD,EAAWrxE,qBAAX,GAClBsxE,EAAchpG,MAAM8oG,EAAS9oG,QAC/B8oG,EAAS9oG,MAAMgpG,EAAchpG,MAE3BgpG,EAAcpnG,SAASknG,EAASlnG,WAClCknG,EAASlnG,SAASonG,EAAcpnG,SAE9BonG,EAAc/oG,OAAO6oG,EAAS7oG,SAChC6oG,EAAS7oG,OAAO+oG,EAAc/oG,OAE5B+oG,EAAcrnG,QAAQmnG,EAASnnG,UACjCmnG,EAASnnG,QAAQqnG,EAAcrnG;UAnBU;AAsB7C,iBAAOmnG;QAjCW;QAqCpBnnE,UAAO;AACL,eAAKja,kBAAkB,KAAvB;YACWlyB,6CAAS,IAApB;AACA,gBAAMojC,IAAY,KAAKtT,aAAa,IAAlB;AAClB,cAAI2jF,IAAU;AACd,mBAAS72G,IAAI,GAAGvN,GAAQA,IAAQ+zC,EAAUxmC,CAAV,GAAeA,KAAK;AAClD,gBAAI,CAACvN,EAAMgoC,UAAN;AACH;AAEF,kBAAM/pB,IAAKje,EAAMuqB,uBAAN;AACXvqB,cAAMyF,OAAO,CAACwY,EAAGnH,GAAGstG,IAAUnmG,EAAGjH,GAAG,CAAC,SAAD,CAApC;AACAhX,cAAMs0D,WAAN;AACA8vD,gBACEpkH,EAAMuqB,uBAAN,EAA+BvT,IAC/BhX,EAAMonC,eAAN,EAAuB1zB,SACvB,KAAK2+B,SAASqrB,aAAd,EAA6B8a;UAVmB;AAYzC7nE,YAAAA,6CAAS,KAApB;AACA,eAAKkyB,kBAAkB,IAAvB;QAlBK;QA2BP2gC,gBAAgBp2D,GAAe;AAC7B,cAAiB0nC,CAAb,KAAK1oC,QAAQ0oC,YAAiB3rB,CAAL,KAAKA,UAAlC;AAGA,gBAAM05C,IAAczmB,gEAAoB1H,SAASkuB;cAC/CxmB,gEAAoBI,UAAUC;cAC9B,EAACtrC,WAAW,KAAZ;YAFkB;AAMhB,iBAAKgvG,wBACP,KAAKA,qBAAqBt9C,GAAaz1D,CAAvC;AAGUjP,oDAAKiP,GAAGy1D,GAAa,KAAKhgD,KAAK,IAA3C;UAbA;QAD6B;QAuB/BssB,cAAcxuB,GAA4C;AAGxD,cAFMqB,IAA2BvpB,6DAAwBkoB,CAAhC,GAEzB;AAMA,gBAAI,CAAC,KAAKvU,QAAQiuC;AAChB,oBAAMnvC,MAAM,sDAAN;AAGR,gBAAYtS,mDAAcopB,CAAtB,GAAyC;AAC3C,kBAAI,CAAC,KAAKq+F;AACR,sBAAMn1G,MAAM,yDAAN;AAER,mBAAKkB,QAAQiuC,eAAer4B;AAC5B,mBAAKq+F,SAAStgF,OAAO/d,CAArB;YAL2C,OAMtC;AACL,kBAAI,CAAC,KAAKs4B;AACR,sBAAMpvC,MAAM,sDAAN;AAER,mBAAKkB,QAAQiuC,eAAer4B;AAC5B,mBAAKs4B,OAAOn8C,KAAK6jB,CAAjB;YALK;UAhBP,WACM,KAAK5V,QAAQiuC;AACf,kBAAMnvC,MAAM,oCAAN;QAL8C;QA6B1DyrB,cAAW;AACL,eAAKvqB,QAAQ4G,kBACf,KAAK5G,QAAQ4G,gBAAgB2jB,YAA7B,KAEO1hC,+CAAiB,IAAxB,GAIA,KAAKie,aAAL,EAAoB4rB,MAAM,EAACi4B,eAAe,KAAhB,CAA1B;QARO;QAyBXpK,KAAK71C,GAAWE,GAAW61C,GAAc;AAGnCw3D,cAAcvmG,KAAKsa,IADT,KAAKhsB,QAAQ+tC,YAAYgT,YACLN,CAAhB;AAClB,gBAAM+xD,IAAW,KAAK1uG,QAAQm0G;AAC9B,cAAI,KAAKn0G,UAAU0uG,GAAnB;AAKIA,gBAAW,KAAKxyG,QAAQ+tC,YAAYs3B,WACtC4yC,IAAc,KAAKj4G,QAAQ+tC,YAAYs3B,WAAW,KAAKvhE,QAC9C0uG,IAAW,KAAKxyG,QAAQ+tC,YAAYu3B,aAC7C2yC,IAAc,KAAKj4G,QAAQ+tC,YAAYu3B,WAAW,KAAKxhE;AAMzD,gBAAIyG,IAAS,KAAKqlE,UAAL,EAAiBsoC,OAAjB,GACTC,IAAS,KAAKrxG,aAAL,EAAoB2D,eAApB;AACb0tG,cAAOztG,IAAIA;AACXytG,cAAOvtG,IAAIA;AACXutG,gBAASA,EAAOntG,gBAAgBT,EAAQQ,QAAR,CAAvB;AACTL,gBAAIytG,EAAOztG;AACXE,gBAAIutG,EAAOvtG;AAKXL,gBAASA,EACNwW,UAAUrW,KAAK,IAAIutG,IAAcrtG,KAAK,IAAIqtG,EADpC,EAENn0G,MAAMm0G,CAFA;AAOT,iBAAKvpF,UAAUnkB,EAAOvJ;AACtB,iBAAKwtB,UAAUjkB,EAAO6tG;AACtB,iBAAKC,SAAS7F,CAAd;UAlCA;QALuC;QA+CzC9xD,WAAWliD,GAAY;AACrB,cAAMyX,IAAU,KAAKymC,WAAL;AAChB,cAAIhyC;AAEA,eAAKwjC,UAMPxjC,IAAIuL,EAAQqiG,WAAWriG,EAAQqiG,WAAW,IAAI,GAC9C1tG,IAAIqL,EAAQsiG,YAAYtiG,EAAQsiG,YAAY,IAAI,MAEhD7tG,IAAIuL,EAAQ+mC,YAAY,IAAI/mC,EAAQinC,cACpCtyC,IAAIqL,EAAQgnC,aAAa,IAAIhnC,EAAQknC;AAEvC,eAAKoD,KAAK71C,GAAGE,GAAGpM,CAAhB;QAhBqB;QAoBvBg6G,YAAS;AACP,cAAK,KAAK58E,UAAL,GAAL;AAQA,gBAAM3lB,IAAU,KAAKymC,WAAL,GACZ+7D,IAAiBxiG,EAAQ+mC;AACzB07D,gBAAkBziG,EAAQgnC;AAC9B,gBAAM07D,IAAY,KAAKphF,qBAAL,GACZqhF,IAAoC,IAArBxF,yDACjByF,IAAcF,EAAUjoG,QAAQioG,EAAU3pG,OAAO4pG;AACjDE,gBAAeH,EAAUhoG,SAASgoG,EAAU5pG,MAAM6pG;AACtD,gBAAKC,GAAL;AAGI,mBAAK3qE,WAKH,KAAK/2B,oBACPuhG,KAAmB,KAAKxqE,OAAO+L,UAAZ,GAEnB6+D,KAAgB,KAAK5qE,OAAO+L,UAAZ,IAA0B,KAAKn2C,UAE/C20G,KAAkB,KAAKvqE,OAAO/uB,SAAZ,GAElB05F,KAAe,KAAK3qE,OAAO/uB,SAAZ,IAAyB,KAAKrb;AAKlC20G,mBAAiBI;AACjBH,mBAAkBI;AACtB30G,gBAAAA,4CAAX;AACA,kBAAI;AACF,qBAAKk0G,SAAS3mG,KAAKC,IAAIonG,GAAQC,CAAjB,CAAd,GACA,KAAK/3D,aAAL;cAFE,UAAJ;AAIa58C,kBAAAA,2CAAX;cADQ;AAGV,mBAAKwyG,6BAAL;YA7BA;UAfA;AACEp3G,oBAAQxG,KACN,2FADF;QAFK;QAsDT+nD,wBAAqB;AACf12D;YAAS,KAAKslF,UAAL;YAAkB;UAA/B;AACItlF,oDAAS,KAAK0gF,gBAAL,GAAwB,4BAArC;QAFmB;QAUrB9pB,sBAAmB;AACb12D,uDAAY,KAAKolF,UAAL,GAAkB,4BAAlC;AACIplF,uDAAY,KAAKwgF,gBAAL,GAAwB,4BAAxC;QAFiB;QAMnB/pB,eAAY;AACV,cAAK,KAAKrlB,UAAL,GAAL;AAQA,gBAAM3lB,IAAU,KAAKymC,WAAL,GACZhyC,KAAKuL,EAAQunC,cAAcvnC,EAAQ+mC,aAAa,GAChDpyC,KAAKqL,EAAQ8nC,eAAe9nC,EAAQgnC,cAAc;AAGtDvyC,gBAAI,CAACA,IAAIuL,EAAQ3F;AACjB1F,gBAAI,CAACA,IAAIqL,EAAQzF;AACjB,iBAAK0qD;cAAOxwD;cAAGE;YAAf;UAfA;AACEnL,oBAAQxG,KACN,2FADF;QAFQ;QA2BZggH,cAAcp0G,GAAmBq0G,GAAmB;AAClD,cAAK,KAAKt9E,UAAL,GAAL;AAQA,gBAAMhoC,IAAQiR,IAAK,KAAKO,aAAaP,CAAlB,IAAwB;AAC3C,gBAAKjR,GAAL;AAKMie,kBAAKje,EAAMuqB,uBAAN;AAELmmF,kBAAc4U,IAChB,EAAC5xG,QAAQ1T,EAAM0T,QAAQF,OAAOxT,EAAMwT,MAApC,IACAxT,EAAMonC,eAAN;AAUJ,kBAAMl3B,IAAQ,KAAKA;AAKbq1G,mBARetnG,EAAGnH,KADL,KAAK+L,MAAM,KAAK,KACO6tF,EAAYl9F,QAAS,KAQjCtD;AACxBs1G,mBAbevnG,EAAGjH,IAAI05F,EAAYh9F,SAAS,KAanBxD;AAExBmS,kBAAU,KAAKymC,WAAL;AAchB,mBAAKwe,OAHKxwD,EAJcyuG,IAJFljG,EAAQ+mC,YAAY,IAShCpyC,EAJcwuG,IAJDnjG,EAAQgnC,aAAa,EAU5C;YAzCA;UATA;AACEx9C,oBAAQxG,KACN,2FADF;QAFgD;QA2DpDo/G,SAAS7F,GAAgB;AAErB,eAAKxyG,QAAQ+tC,YAAYs3B,YACzBmtC,IAAW,KAAKxyG,QAAQ+tC,YAAYs3B,WAEpCmtC,IAAW,KAAKxyG,QAAQ+tC,YAAYs3B,WAEpC,KAAKrlE,QAAQ+tC,YAAYu3B,YACzBktC,IAAW,KAAKxyG,QAAQ+tC,YAAYu3B,aAEpCktC,IAAW,KAAKxyG,QAAQ+tC,YAAYu3B;AAEtC,eAAKxhE,QAAQ0uG;AAEb,eAAKj0G,UAAU,KAAf;AAGA,WADM2vC,IAAS,KAAKa,UAAU,KAAf,MACDb,EAAO97C,UAAP,MACZ87C,EAAOmrE,OAAP,GACA,KAAKhpC,kBAAL;AAEE,eAAKhZ,QACP,KAAKA,KAAK4J,OAAO,KAAKn9D,KAAtB;AAMImS,cAAU,KAAKymC,WAAL;AAEhB,eAAKhuB,WAAWzY,EAAQinC;AACxB,eAAK1uB,WAAWvY,EAAQknC;AAGxBlnC,YAAQpS,YAAYoS,EAAQinC;AAC5BjnC,YAAQrS,WAAWqS,EAAQknC;AAE3B,eAAK+d,OAAO,KAAKxsC,SAAS,KAAKF,OAA/B;AACI,eAAKrY,cACH,KAAK+3B,SACP,KAAK/3B,UAAUmjG,WAAWrjG,CAA1B,IAEA,KAAKE,UAAUojG,cAActjG,CAA7B;QA1CmB;QAqDzBujG,WAAQ;AACN,iBAAI,KAAKx5G,QAAQ4G,kBACR,KAAK5G,QAAQ4G,gBAAgB4yG,SAA7B,IAEF,KAAK11G;QAJN;QAeRo3D,OAAOxwD,GAAWE,GAAS;AACzB,eAAKrM,UAAqC,IAA1C;AAGA,gBAAM0X,IAAU,KAAKymC,WAAL;AAGhBhyC,cAAIgH,KAAKC,IAAIjH,GAAG,CAACuL,EAAQ3F,UAArB;AACJ1F,cAAI8G,KAAKC,IAAI/G,GAAG,CAACqL,EAAQzF,SAArB;AAUJ,gBAAMipG,IAAaxjG,EAAQzF,YAJFkB,KAAKE,IAC5B,GACAqE,EAAQ8nC,eAAe9nC,EAAQgnC,UAFRy8D;AAKzBhvG,cAAIgH,KAAKE,IAAIlH,GAAG,EANGuL,EAAQ3F,aAJFoB,KAAKE,IAC5B,GACAqE,EAAQunC,cAAcvnC,EAAQ+mC,SAFP28D,EAUrB;AACJ/uG,cAAI8G,KAAKE,IAAIhH,GAAG,CAAC6uG,CAAb;AACJ,eAAK/qF,UAAUhkB;AACf,eAAK8jB,UAAU5jB;AAEX,eAAKuL,aAOP,KAAKA,UAAU0H;YACb,EAAEnT,IAAIuL,EAAQ3F;YACd,EAAE1F,IAAIqL,EAAQzF;YACd;UAHF;AAQF9F,eAAKuL,EAAQinC;AACbtyC,eAAKqL,EAAQknC;AACb,eAAKp8B,UAAUrW,GAAGE,CAAlB;QAzCyB;QAkDlBxF,aAAaP,GAAU;AAC9B,iBAAO,MAAMO,aAAaP,CAAnB;QADuB;QAWvBgU,aAAam/E,IAAU,OAAK;AACnC,iBAAO,MAAMn/E,aAAam/E,CAAnB;QAD4B;QAW5B3jE,aAAa2jE,IAAU,OAAK;AACnC,iBAAO,MAAM3jE,aAAa2jE,CAAnB;QAD4B;QAS5BzB,YAAY3iG,GAAY;AAC/B,eAAKgmH,qBAAqBhmH,CAA1B;AACA,gBAAM2iG,YAAY3iG,CAAlB;QAF+B;QAUxBijG,eAAejjG,GAAY;AAClC,eAAKimH,wBAAwBjmH,CAA7B;AACA,gBAAMijG,eAAejjG,CAArB;QAFkC;QAU3BgvD,cAAc7jC,GAAyB;AAC9C,eAAK66F,qBAAqB76F,CAA1B;AACA,gBAAM6jC,cAAc7jC,CAApB;QAF8C;QAUvCukC,iBAAiBvkC,GAAyB;AACjD,eAAK86F,wBAAwB96F,CAA7B;AACA,gBAAMukC,iBAAiBvkC,CAAvB;QAFiD;QAK1CopB,mBAAgB;AACvB,iBAAO,MAAMA,iBAAN;QADgB;QASzByxE,qBAAqBn2G,GAAwB;AAC3C,eAAK8wG,mBAAmBtzG,KAAKwC,CAA7B;QAD2C;QAS7Co2G,wBAAwBp2G,GAAwB;AACnCtZ;YAAW,KAAKoqH;YAAoB9wG;UAA/C;QAD8C;QAShDmkC,wBAAqB;AACnB,iBAAO,CAAA,EAA6BvkC,OAAO,KAAKkxG,kBAAzC;QADY;QAYrB99E,kBAAkBpD,GAAgB;AAChC,gBAAMymF,IAAY,CAAC,KAAKxG,kBAAkBjgF;AAC1C,eAAKigF,iBAAiBjgF;AAClBymF,eAEF,KAAK77F,eAAL;QAL8B;QAazByY,QAAK;AACZ,eAAKD,kBAAkB,KAAvB;AACA,gBAAMC,MAAN;AACA,eAAK69E,qBAAqB,CAAA;AAC1B,eAAK99E,kBAAkB,IAAvB;QAJY;QAkBdjd,uBAAuB1Z,GAAauJ,GAAgC;AAClE,cAAoB,eAAhB,OAAOA;AACT,kBAAMwM,UAAU,qCAAV;AAER,eAAKw+F,sBAAsBx2F,IAAI/d,GAAKuJ,CAApC;QAJkE;QAepEg1F,kBAAkBv+F,GAAW;AACpB,cAAA;AAAP,iBAAO,SAAA,IAAA,KAAKu0G,sBAAsB/rH,IAAIwX,CAA/B,KAAA,IAAuC;QADnB;QAS7Bi6G,qBAAqBj6G,GAAW;AAC9B,eAAKu0G,sBAAsB71F,OAAO1e,CAAlC;QAD8B;QAYhCi1G,gCACEj1G,GACAuJ,GAAoD;AAEpD,cAAoB,eAAhB,OAAOA;AACT,kBAAMwM,UAAU,+CAAV;AAER,eAAKu+F,yBAAyBv2F,IAAI/d,GAAKuJ,CAAvC;QALoD;QAgBtD2wG,2BACEl6G,GAAW;AAEX,iBAAO,KAAKs0G,yBAAyB9rH,IAAIwX,CAAlC,KAA0C;QAFtC;QAUbm6G,8BAA8Bn6G,GAAW;AACvC,eAAKs0G,yBAAyB51F,OAAO1e,CAArC;QADuC;QAazCu1D,WAAWr0D,GAAe;AACxB,gBAAMk5G,IAAqB,kBAAXl5G,EAAExC,MAEZiK,IAAU,KAAKk4D;AACrB,iBAAIl4D,IACEyxG,KAAWzxG,EAAQi4D,WAAR,KACbjhE,QAAQxG,KAAK,wCAAb,GAGAwP,EAAQo1D,OAAR,GACO,QAEFp1D,IAKLyxG,IACF,KAAKv5C,kBAAkB,IAAI33B;YAAQhoC;YAAG;UAAf,IAIlB;QAtBiB;QA8B1By7D,eAAY;AACV,eAAKkE,kBAAkB;QADb;QASZlvB,uBAAoB;AACd,eAAKkvB,mBACP,KAAKA,gBAAgB9C,OAArB;QAFgB;QAWpBhkC,kBAAe;AACb,iBAAO,KAAK+6E;QADC;QASft9C,UAAO;AACL,iBAAO,KAAKD;QADP;QAUP94D,UAAU47G,IAAkB,OAAK;AACvB7nH,8CAAR;AACU2C,oEAAyB,IAAnC;AACY1C,kEAAZ;AAEA,eAAKo8C,eAAewrE,CAApB;QAL+B;QAejCxrE,eAAewrE,IAAkB,OAAK;AACd,eAAKp6D,oBAAL,EAA2B3H;YAC/Cf,0DAAiBN,WAAWK;YAC5B;UAFoBgjE,EAIRn5E,QAASo5E,OACrBA,EAAaC,SAASH,CAAtB,CADF;QALoC;QAgBvBxF,OAAAA,6BAEb4F,GAAiC;AAEjC,gBAAMtkG,IAAU,KAAKymC,WAAL;AAES,uBAArB,OAAO69D,EAAQ7vG,MACjB,KAAKgkB,UAAU,EACbzY,EAAQ3F,cACP2F,EAAQunC,cAAcvnC,EAAQ+mC,aAAau9D,EAAQ7vG;AAG/B,uBAArB,OAAO6vG,EAAQ3vG,MACjB,KAAK4jB,UAAU,EACbvY,EAAQzF,aACPyF,EAAQ8nC,eAAe9nC,EAAQgnC,cAAcs9D,EAAQ3vG;AAQ1D,eAAKmW,UAHK,KAAK2N,UAAUzY,EAAQinC,cACvB,KAAK1uB,UAAUvY,EAAQknC,WAEjC;QArBiC;MApxE/B,GApFNrJ,sCAAA,CAAA;AAoFatH,0CAAAA,eAAAA;0CAozEGxxC,oBAAAA;AkJj3EV,UAAOw/G,kEAAP,cAA4BtlE,oDAA5B;QAcJ5vB,YAAYm1F,GAAsBrlE,GAAwB;AACxD,gBAAMA,CAAN;AATO,eAAA52C,OAAkB61C;AAUzB,eAAKpR,SAASw3E;QAF0C;QAUjD5lE,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAoBhzC,WAAhB,KAAKohC;AACP,kBAAUnkC,MACR,4GADI;AAKRgG,YAAA,SAAiB,KAAKm+B;AACtB,iBAAOn+B;QATM;QAqBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI85G,iEAHE;YAKRv3E,SAASn+B,EAAA;AAClB,iBAAO2wC;QARI;MAhDT;AAgEGxuD,+CAAkB2X,qCAAKsG,OAAkBmvC,mDAAemmE,+DAAjE;AAvFA,UAAA1mE,oDAAA,CAAA;AAuBa0mE,wDAAAA,eAAAA;ACCP,UAAOE,yDAAP,cAAwBxlE,oDAAxB;QAoBJ5vB,YACEq1F,GACAC,GACAxlE,GAAwB;AAExB,gBAAMA,CAAN;AAfO,eAAA52C,OAAkB+H;AAiBzB,eAAKs0G,eAAeF,QAAAA,IAAAA,IAAoB94G;AACxC,eAAKi5G,eAAeF,QAAAA,IAAAA,IAAoB/4G;QALhB;QAajBgzC,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb/vC,YAAA,eAAuB,KAAK+1G;AAC5B/1G,YAAA,eAAuB,KAAKg2G;AAC5B,iBAAOh2G;QAJM;QAgBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIg6G,wDAHE;AAKjBjlE,YAASolE,eAAe/1G,EAAA;AACxB2wC,YAASqlE,eAAeh2G,EAAA;AACxB,iBAAO2wC;QATI;MAvDT;AAyEGxuD,+CAAkB2X,qCAAKsG,OAAkBqB,8CAAUm0G,sDAA5D;AAjGA,UAAA5mE,+CAAA,CAAA;AAwBa4mE,mDAAAA,WAAAA;ACDP,UAAOK,oDAAP,MAAA;QAqBJz1F,cAAA;AANQ,eAAA2pC,SARA,KAAA0zC,UALR,KAAAxzE,SAAwB;AAgBxB,eAAA3wB,OAAO;QAGP;QAOAiwD,UAAUQ,GAAiB;AACzB,eAAKA,SAASA;QADW;QAS3BL,YAAS;AACP,iBAAO,KAAKK;QADL;QAST+rD,aAAU;AACR,iBAAO,KAAKrY;QADJ;QAWVsY,WAAW3tG,GAAgB;AACzB,gBAAMu0F,IAAU,KAAKc;AACrB,eAAKA,UAAUr1F;AACX,eAAK2hD,UACP,KAAKA,OAAOO,KAAKqyC,GAAS,KAAKc,OAA/B;QAJuB;QAa3BnzC,OAAI;AACE,eAAKP,UACP,KAAKA,OAAOO,KAAK,KAAKmzC,SAAS,KAAKA,OAApC;QAFA;QAOJrwG,OAAI;AACE,eAAK28D,UACP,KAAKA,OAAO38D,KAAZ;QAFA;QAOJqB,UAAO;AACD,eAAKi7D,UAAL,KACF,KAAKA,UAAL,EAAiBj7D,QAAjB;QAFG;MApFH,GAvBNmgD,4CAAA,CAAA;AAuBainE,gDAAAA,SAAAA;ACAP,UAAOG,oDAAP,cAAsBH,kDAAtB;QAGJz1F,cAAA;AACE,gBAAA;AAHO,eAAA9mB,OAAO;QAEhB;QAUAi6B,OAAI;AACF,cAAMkqE,IAAU,KAAKqY,WAAL;AAChB,cAAI,CAACrY;AACH,mBAAO;AAIT,eADIr1F,IAAUq1F,EAAQlqE,KAAR,GAEZnrB,KACAA,EAAQmrB,KAAR,MACCnrB,EAAQiV,QAAR,MAAsB+7E,qDAAQ0B,MAAMkB,QACnC5zF,EAAQiV,QAAR,MAAsB+7E,qDAAQ0B,MAAMluD;AAEtCxkC,gBAAUA,EAAQmrB,KAAR;AAGRnrB,eACF,KAAK2tG,WAAW3tG,CAAhB;AAEF,iBAAOA;QAnBL;QA4BJ6zF,KAAE;AACA,cAAIwB,IAA0B,KAAKqY,WAAL;AAC9B,cAAI,CAACrY;AACH,mBAAO;AAIT,cACEA,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMiB,YACpC0B,EAAQpgF,QAAR,MAAsB+7E,qDAAQ0B,MAAMgB;AAEpC2B,gBAAUA,EAAQlqE,KAAR;AAEIkqE,cAAAA,GAAA;AAEhB,WAFMr1F,IAAU,SAAA,IAAA,SAAAq1F,IAAAA,KAAA,SAAAA,EAASxB,GAAT,KAAA,IAAiB,SAG/B,KAAK8Z,WAAW3tG,CAAhB;AAEF,iBAAOA;QAlBP;QA2BFsjF,OAAI;AACF,cAAM+R,IAAU,KAAKqY,WAAL;AAChB,cAAI,CAACrY;AACH,mBAAO;AAIT,eAFIr1F,IAAUq1F,EAAQ/R,KAAR,GAGZtjF,KACAA,EAAQsjF,KAAR,MACCtjF,EAAQiV,QAAR,MAAsB+7E,qDAAQ0B,MAAMkB,QACnC5zF,EAAQiV,QAAR,MAAsB+7E,qDAAQ0B,MAAMluD;AAEtCxkC,gBAAUA,EAAQsjF,KAAR;AAGRtjF,eACF,KAAK2tG,WAAW3tG,CAAhB;iBAEKA;QAnBL;QA4BJ8zF,MAAG;AACD,cAAMuB,IAAU,KAAKqY,WAAL;AAChB,cAAI,CAACrY;AACH,mBAAO;AAIT,WAFIr1F,IAAUq1F,EAAQvB,IAAR,MAEC9zF,EAAQiV,QAAR,MAAsB+7E,qDAAQ0B,MAAMluD,UACjDxkC,IAAUA,EAAQsjF,KAAR,KAAkBtjF;AAG1BA,eACF,KAAK2tG,WAAW3tG,CAAhB;AAEF,iBAAOA;QAdN;MAhGC;AAkHGrmB,+CAAkB2X,qCAAKy0C,QAAiBlzC,yCAAS+6G,iDAA1D;AAzIA,UAAApnE,4CAAA,CAAA;AAuBaonE,gDAAAA,SAAAA;ACCP,UAAOC,+DAAP,cAA2BD,kDAA3B;QAIJ51F,cAAA;AACE,gBAAA;QADF;QAUSmT,OAAI;AACX,cAAMkqE,IAAU,KAAKqY,WAAL;AAChB,cAAI,CAACrY;AACH,mBAAO;AAIT,WAFMr1F,IAAU,KAAK8tG,aAAazY,GAAS,KAAK0Y,UAAhC,MAGd,KAAKJ,WAAW3tG,CAAhB;AAEF,iBAAOA;QAVI;QAqBJ6zF,KAAE;AACT,iBAAO,KAAK1oE,KAAL;QADE;QAUFm4D,OAAI;AACX,cAAM+R,IAAU,KAAKqY,WAAL;AAChB,cAAI,CAACrY;AACH,mBAAO;AAIT,WAFMr1F,IAAU,KAAKguG,iBAAiB3Y,GAAS,KAAK0Y,UAApC,MAGd,KAAKJ,WAAW3tG,CAAhB;AAEF,iBAAOA;QAVI;QAqBJ8zF,MAAG;AACV,iBAAO,KAAKxQ,KAAL;QADG;QAcFwqB,aACRjyG,GACAoyG,GAAwC;AAExC,cAAI,CAACpyG;AACH,mBAAO;AAET,gBAAMmE,IAAUnE,EAAKg4F,GAAL,KAAah4F,EAAKsvB,KAAL;cACzB8iF,EAAQjuG,CAAR;AACF,mBAAOA;AACF,cAAIA;AACT,mBAAO,KAAK8tG,aAAa9tG,GAASiuG,CAA3B;AAEHC,cAAkB,KAAKC,oBAAoBtyG,EAAKi4F,IAAL,CAAzB;AACxB,iBAAIma,EAAQC,CAAR,IACKA,IACEA,IACF,KAAKJ,aAAaI,GAAiBD,CAAnC,IAEF;QAjBiC;QA+BhCD,iBACRnyG,GACAoyG,GAAwC;AAExC,cAAI,CAACpyG;AACH,mBAAO;AAET,cAAImE,IAA0BnE,EAAKynF,KAAL;AAG5BtjF,cADEA,IACQ,KAAKouG,kBAAkBpuG,CAAvB,IAEAnE,EAAKi4F,IAAL;AAEZ,iBAAIma,EAAQjuG,CAAR,IACKA,IACEA,IACF,KAAKguG,iBAAiBhuG,GAASiuG,CAA/B,IAEF;QAjBiC;QA2BhCF,WAAWlyG,GAAoB;AACvC,cAAIoyG,IAAU;AACR/8G,cAAO2K,KAAQA,EAAKoZ,QAAL;AACrB,cACE/jB,MAAS8/F,qDAAQ0B,MAAMgB,UACvBxiG,MAAS8/F,qDAAQ0B,MAAM1sD,SACvB90C,MAAS8/F,qDAAQ0B,MAAMxgG,SACvBhB,MAAS8/F,qDAAQ0B,MAAMkB,QACvB1iG,MAAS8/F,qDAAQ0B,MAAMiB,YACvBziG,MAAS8/F,qDAAQ0B,MAAM3vD;AAEvBkrE,gBAAU;AAEZ,iBAAOA;QAbgC;QAsBjCE,oBAAoBtyG,GAAoB;AAC9C,cAAI,CAACA;AACH,mBAAO;AAET,gBAAMwyG,IAAWxyG,EAAKsvB,KAAL;AACjB,iBAAIkjF,IACKA,IAEF,KAAKF,oBAAoBtyG,EAAKi4F,IAAL,CAAzB;QARuC;QAkBxCsa,kBAAkBvyG,GAAoB;AAC5C,cAAI,CAACA,EAAMg4F,GAAN;AACH,mBAAOh4F;AAGT,eADImE,IAAUnE,EAAMg4F,GAAN,GACP7zF,KAAWA,EAAQmrB,KAAR;AAChBnrB,gBAAUA,EAAQmrB,KAAR;AAEZ,iBAAO,KAAKijF,kBAAkBpuG,CAAvB;QARqC;MAtL1C;mEAEYsuG,mBAAmB;AAgM5B30H,+CACE2X,qCAAKy0C,QACd8nE,6DAAYS,kBACZT,4DAHF;AA1NA,UAAArnE,kDAAA,CAAA;AAwBaqnE,sDAAAA,cAAAA;ACFP,UAAOU,4EAAP,cAAiCV,6DAAjC;QAOKE,WAAWlyG,GAAoB;AACtC,cAAIoyG,IAAU;AACd,gBAAM/8G,IAAO2K,KAAQA,EAAKoZ,QAAL;AACjBpZ,gBACIu5C,IAAWv5C,EAAKy1F,YAAL,GAEfpgG,MAAS8/F,qDAAQ0B,MAAMxgG,SACvBkjD,KACAA,EAASsT,eAAT,KACAtT,EAAS4P,YAAT,MAEAipD,IAAU;AAGd,iBAAOA;QAd+B;MAPpC,GAtBNznE,yDAAA,CAAA;AAsBa+nE,6DAAAA,oBAAAA;ACIb,UAAMC,6DAAkB,IAKXC,gEAAP,cAAkCz7B,6CAAlC;QAgBJh7D,YAAY2W,GAAkBz9B,GAAY;AACxC,gBAAMy9B,GAAQz9B,CAAd;AAVM,eAAAutD,cAAuB;AAGtB,eAAApnB,mBAA8C;AAarD,eAAKk1B,KAAK59B,EAAOl3B,UAAU8pG,iBAAiBrwG,CAAlC;AAMV,eAAKw9G,aACH//E,EAAOl3B,UAAU8pG,iBAAmCxC,wDAAc7tG,CAAhC,CAAlC;AAGF,eAAK0oE,gBAAgB,IAAIl3D,mDAAW,GAAG,CAAlB;AAGrB,eAAKisG,eAAeF,8DAAmBG,aAAaC;QApBZ;QA6BjCxoH,UAAO;AACd,gBAAMA,QAAN;AACI,eAAKsoH,iBAAiBF,8DAAmBG,aAAaE,WACxD,KAAKviD,GAAGN,iBAAiB,MAAM,KAAK3uD,CAApC;AAEgBigF,cAAAA,GAAWmC;AAA7B,mBAA6BA,KAAXnC,IAAlBA,KAAKt6B,aAAas6B,YAAWmC,8BAAAA,EAAAA,KAAXnC,GAAuC,IAAzD;QALc;QAaPxmE,iBAAc;AACrB,iBAAO,MAAMA,eAAN;QADc;QASdnB,cAAW;AAClB,iBAAO,MAAMA,YAAN;QADW;QAWpBs3C,aAAak5B,GAA2B;AACtC,gBAAM0U,IAAQ,KAAK19F,IAAIgpF,EAAgBhpF;AACjC29F,cAAQ,KAAKz9F,IAAI8oF,EAAgB9oF;AACvC,iBAAO8G,KAAKmc,KAAKu6E,IAAQA,IAAQC,IAAQA,CAAlC;QAH+B;QAaxCgU,aAAaC,GAAoC;AAC/C,cAAI,CAAA,KAAK/rD,aAAaxrD,UAAUgB,WAA5B,GAAJ;AAKA,gBAAIkrE,IAAY,KAAK1gB,aAAajpB,aAAlB;AAChB,gBAAc9F,CAAVyvC,EAAUzvC,YAAd;AAIA,kBAAIr/B,IAAU;AACd,kBAAI,CAAC8uE,EAAUr1C,UAAV,GAAuB;AAG1Bq1C,oBAAYqrC,EAAiBj4F,eAAjB,EAAkCijB,aAAlC;AACZ,oBAAI,CAAC2pC,EAAUr1C,UAAV;AACH;AAIF0gF,oBAAmB;AACnBn6G,oBAAU;cAVgB;AAa5B,kBAAMiE,IAAkBtd,0CAAP,KAAwBmoF;AACzC7qE,mBAAY6qE,EAAUsrC,UAAV;AACZ,kBAAIhvF,IACF+uF,EAAiB5xG,IACjBqpB,EAAAA,qCAAOC,aACPtiB,KAAK+Y,MAAM/Y,KAAKg8B,OAAL,IAAgBouE,0DAA3B,IACA,KAAKpxG,GACHgjB,IACF4uF,EAAiB1xG,IACjBmpB,EAAAA,qCAAOC,aACPtiB,KAAK+Y,MAAM/Y,KAAKg8B,OAAL,IAAgBouE,0DAA3B,IACA,KAAKlxG;AACHzI,oBAEFurB,IAAK,CAACA;AAEJujD,gBAAUx6D,QACZ8W,IACE+uF,EAAiB5xG,IACjBqpB,EAAAA,qCAAOC,aACPtiB,KAAK+Y,MAAM/Y,KAAKg8B,OAAL,IAAgBouE,0DAA3B,IACA,KAAKpxG;AAETumE,gBAAU53E,OAAOk0B,GAAIG,GAAI,CAAC,MAAD,CAAzB;AACAtnB,mBAAY6qE,EAAUurC,aAAV;YA1CZ;UANA;QAD+C;QA4DjDpjH,OAAOsR,GAAWE,GAAS;AAIzB,cAAI6xG,IAAU;AAEV,eAAKR,iBAAiBF,8DAAmBG,aAAaC,cACxD,KAAKtiD,GAAGhB,cAAc,MAAMjuD,CAA5B,GACA,KAAKqxG,eAAeF,8DAAmBG,aAAaE,SACpDK,IAAU,QAEV,KAAKR,iBAAiBF,8DAAmBG,aAAaE,YAGtD,KAAKviD,GAAGN,iBAAiB,MAAM,KAAK3uD,CAApC,GACA,KAAKivD,GAAGhB,cAAc,MAAMjuD,CAA5B,GACA6xG,IAAU;AAGZ,eAAK/xG,IAAIA;AACT,eAAKE,IAAIA;AAET,iBAAO6xG;QAtBkB;QAiC3BpjH,OAAOk0B,GAAYG,GAAU;AAC3B,iBAAO,KAAKt0B,OAAO,KAAKsR,IAAI6iB,GAAI,KAAK3iB,IAAI8iB,CAAlC;QADoB;QAa7BgvF,aAAaC,GAAmB;AAC9B,iBAAO,KAAKvjH,OACVujH,EAAQjyG,IAAI,KAAKw8D,cAAcx8D,GAC/BiyG,EAAQ/xG,IAAI,KAAKs8D,cAAct8D,CAF1B;QADuB;QAahC86B,iBAAiBh7B,GAAWE,GAAS;AACnC,eAAKs8D,cAAcx8D,IAAIA;AACvB,eAAKw8D,cAAct8D,IAAIA;QAFY;QAUrCyiF,mBAAgB;AACd,iBAAO,KAAKnmB;QADE;QAUhB01C,qBAAkB;AAChB,cAAM7yG,IAAS,KAAK46B;gBACd/wC,IAAQ,KAAKsvB,YAAL;AACTnZ,eAAWnW,MACVmd,IAASf,mDAAWkD,WACxB,KAAKg0D,eACLn9D,EAAOm9D,aAFM,GAIftzE,EAAMmtB,UAAUhQ,EAAOrG,GAAGqG,EAAOnG,CAAjC;QARgB;QAqBlB07B,QACEu2E,GACA1iD,GAAe;AAEf,iBAAO,KAAK6hD,WAAW9hD,iBAAiB,MAAM2iD,GAAU1iD,CAAjD;QAFQ;QAMjBjO,YAAS;AACP,eAAKH,cAAc;AACnB,eAAK1nC,eAAL,EAAsB11B,YAAtB;QAFO;QAMT86G,cAAW;AACT,eAAK19C,cAAc;AACnB,eAAK1nC,eAAL,EAAsB11B,YAAtB;QAFS;QAMX8xF,gBAAa;AACX,iBAAO,KAAK10B;QADD;QAUb+wD,YAAYC,GAAmB;AAE1BA,eACC,KAAKd,iBAAiBF,8DAAmBG,aAAaE,WACvD,CAACW,KACA,KAAKd,iBAAiBF,8DAAmBG,aAAac,aAItD,KAAKzsD,aAAa/uB,eAIlBu7E,KACF,KAAKljD,GAAGhB,cAAc,MAAM,KAAKjuD,CAAjC,GACA,KAAKqxG,eAAeF,8DAAmBG,aAAaE,YAGlD,KAAKH,iBAAiBF,8DAAmBG,aAAaE,WACxD,KAAKviD,GAAGN,iBAAiB,MAAM,KAAK3uD,CAApC,GAEF,KAAKqxG,eAAeF,8DAAmBG,aAAac;QArBvB;QAiC/BvuB,kBAAe;AACb,eAAKquB,YAAY,KAAjB;cACI,KAAKn4E,kBAAkB;AACzB,kBAAMt8B,IAAS,KAAK6a,YAAL,EAAoBve,eAAe,KAAnC;AACf,qBAASxD,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM,KAAK;AACtC,oBAAMvN,IAAQyU,EAAOlH,CAAP,GAERy3D,IAAchlE,EAAMyyC,gBAAgB,IAAtB;AACpB,uBAAS5wB,IAAI,GAAGA,IAAImjD,EAAY/3D,QAAQ4U;AACtCmjD,kBAAYnjD,CAAZ,EAAeqnG,YAAY,KAA3B;AAGF,yBAAWz6F,KAAQzuB,EAAM0uB,SAAN;AACbtxB,yEAAUqxB,CAAV,KAAiBA,EAAK+D,iBAAiB,KAAtB;YATe;UAFf;QAFd;QA0BfooE,mBAAgB;AACd,eAAKsuB,YAAY,IAAjB;AAKA,cAAIxuB,IAAsB,CAAA;AAC1B,cACE,KAAK9vF,SAAS85D,sDAAeC,eAC7B,KAAK/5D,SAAS85D,sDAAeG;AAG7B,mBAAO61B;gBAEH16F,IAAQ,KAAKsvB,YAAL;AACd,cAAItvB,GAAO;AACT,gBAAIglE;AACAhlE,cAAMyrB,YAAN,KAEFu5C,IAAc,CAAA,GACdhlE,EAAMiS,oBAAoB+yD,EAAY33D,KAAKrN,EAAMiS,gBAAvB,GAC1BjS,EAAMmvB,kBAAkB61C,EAAY33D,KAAKrN,EAAMmvB,cAAvB,GACxBnvB,EAAMkS,sBAAsB8yD,EAAY33D,KAAKrN,EAAMkS,kBAAvB,KAG5B8yD,IAAchlE,EAAMyyC,gBAAgB,IAAtB;AAEhB,qBAASllC,IAAI,GAAGA,IAAIy3D,EAAY/3D,QAAQM;AACtCmtF,gBAAWrtF,KAAK,GAAG23D,EAAYz3D,CAAZ,EAAeqtF,iBAAf,CAAnB;AAEGF,cAAWztF,WAEdytF,IAAa,CAAC16F,CAAD;UAjBN;AAoBX,iBAAO06F;QAnCO;QA+CP+E,gBAAgBK,GAA2B;AAClD,gBAAM9/F,IAAQ,KAAKywB,eAAL;AACd,cAAez8B,kDAAX,GAA4B;AAC9B,kBAAMga,IAAmB0C,EAAAA,6CAAX;AACdvD,wBACE,WAAA;AACOnN,gBAAM8qB,WAAN,KAAuB9qB,EAAM2R,UAAN,MACfhB,EAAAA,6CAAS3C,CAApB,GACA,KAAKy6G,aAAa3oB,CAAlB,GACWnvF,EAAAA,6CAAS,KAApB;YAJJ,GAME1a,KAAK,IANP,GAOAkqC,EAAAA,qCAAOm1B,SART;UAF8B;QAFkB;QAyB3C4pC,mBAAmBI,IAAY,MAAI;AAC1C,gBAAM,EAAC,kBAAA7vE,GAAkB,iBAAAoB,EAAnB,IACJ,KAAKmvE,6BAAL;AACF,cAAKvwE,KAAqBoB,GAA1B;AACA,gBAAMnB,IAA2Bhf,EAAAA,6CAAX;AACjBgf,iBAA0B/e,EAAAA,6CAAS,IAApB;AAEpB,gBAAMe,IAAS+d,EAAiBgB,eAAjB,GACT1e,IAAQ8e,EAAgBJ,eAAhB;AACd,kBAAMyuE,mBAAmBI,CAAzB;AAEA5tF,cAAO3W,YAAP;cACMsuH,eAAN;AACAt3G,cAAMhX,YAAN;AAEAgX,cAAMgiB,WAAN,EAAmBha,MAAMkB,UAAU;AAExBtK,cAAAA,6CAAS+e,CAApB;UAdA;QAH0C;QAwBzBuwE,iBAAc;AAC/B,gBAAMA,eAAN;AACA,gBAAMW,IAAc,KAAKtxE,YAAL;AACfsxE,gBAGLA,EAAYxuE,QAAZ,GACAwuE,EAAY7lG,YAAZ;QAP+B;QAmBxBorE,WAAW8iD,GAAgB;AAClC,iBAAO,KAAKb,WAAWxiD,cAAc,MAAMqjD,CAApC;QAD2B;QAUjBjqB,SAASnuE,GAA2B;AACrD,gBAAMmuE,SAASnuE,CAAf;AAIA,cAAMouE,IAAc,KAAKxuE,eAAL;AACdmR,cAH0B/Q,EAGWJ,eAAxB;AAEnBwuE,YAAYoqB,eAAZ;AACAznF,YAAWynF,eAAX;AACAznF,YAAW7mC,YAAX;AAIA,cADMinE,IAAci9B,EAAY+E,kBAAkBpiE,CAA9B;AAEZ9I,gBAAUkpC,EAAYxjE,UAAZ,GAChBojC,EAAW7N,WAAX,EAAwBha,MAAMkB,UAAU6d,IAAU,UAAU;QAhBT;QAuBpCwnE,kBAAe;AAG9B,WAAA,KAAK96D,YAAL,KACE,KAAKuL,oBACJ,KAAKK,qBAAL,EAA4BC,WAC3B,MACA,KAAKN,kBACL,KAHD,MAMW,KAAK2uD,WAAL,IAAoB,KAAKpwE,YAAL,IAAqB,KAAKqtC,cACrDijC,OAAP;QAZ8B;QAwBzB9E,SAASC,GAA+B;AAC/C,gBAAMD,SAASC,CAAf;AACA,eAAKp+B,aAAa5hE,YAAlB;AACA,iBAAO;QAHwC;MAhgB7C;gBAugBWotH,GAAkB;AAYrB,YAAAA,EAAAG,iBAAAH,EAAAG,eAAY,CAAA;AACtBA,UAAAA,EAAAC,aAAA,EAAA,IAAA;AACAD,UAAAA,EAAAc,YAAA,CAAA,IAAA;AACAd,UAAAA,EAAAE,UAAA,CAAA,IAAA;MAf+B,GAAlBL,kEAAAA,gEAAkB,CAAA,EAAnC;AAoBO,UAAMG,0DAAeH,8DAAmBG,cA1jB/CpoE,4CAAA,CAAA;gDA+BaioE,qBAAAA;AA2hBAG,gDAAAA,eAAAA;AvJziBP,UAAOgB,4DAAP,MAAA;QAGJxhH,MACEusC,GACAljC,GACAmjC,GAAuB;AAEvB,cAAI,CAACnjC,EAAUozF,oBAAoBlwD,EAASk1E,UAAvC;AAAqD,mBAAO;AAE7Dj1E,gBACFD,EAASm1E,WAAT,IAA2Bl1E,EAAWx9B,GACtCu9B,EAASm1E,WAAT,IAA2Bl1E,EAAWt9B;AAMlCyyG,cACJn1E,KACA,IAAIl4B,mDACFi4B,EAASm1E,WAAT,KAA4B,GAC5Bn1E,EAASm1E,WAAT,KAA4B,CAF9B;AAKSj5G,YAAAA,4CAAX;AACA,cAAIvQ;AACJ,cAAI;AACFA,gBAAQvE,mDAAO44C,EAASm1E,YAAYr4G,CAA5B,GACR9J,qEAAuBrH,GAAOypH,CAA9B;UAFE,UAAJ;AAIah5G,cAAAA,2CAAX;UADQ;AAIV,cAAI,CAACzQ;AAAO,mBAAOA;wDAEf,KAA0B,CAACA,EAAMuvB,SAAN,KAClBt7B,yCAAK,KAAgBS,wCAAek7B,EAAAA,0CAA1B,GAAyC5vB,CAA9C,CAAhB;AAEKyS,YAAAA,0CAAYzS,CAAnB;AACA,iBAAOA;QAlCgB;MANrB;AACGspH,gEAAAh6E,OAAO;AA2HPj8C,yDAASi2H,0DAAYh6E,MAAM,IAAIg6E,2DAAxC;UA7IAppE,+CAAA,CAAA;AAiBaopE,mDAAAA,cAAAA;AAuDGjiH,mDAAAA,yBAAAA;ACWT,UAAMqiH,qDAAiBliH,0DAnF9B04C,qCAAA,CAAA;AAmFawpE,yCAAAA,iBAAAA;AAQGjiH,yCAAAA,wBAAAA;AAuFAE,yCAAAA,2BAAAA;AuJ7IV,UAAOgiH,wEAAP,MAAA;QA0BJj4F,YAAoB1xB,GAAe;AAAf,eAAAA,QAAAA;AAVZ,eAAA4pH,sBAFA,KAAAC,sBAFA,KAAA91D,WAFA,KAAA+1D,iBANA,KAAAC,kBAA6C;AAc7C,eAAA3mD,WAAW;AAMX,eAAA4mD,aAAa,IAAI5tG,mDAAW,GAAG,CAAlB;AAGnB,eAAKjL,YAAYnR,EAAMmR;QADU;QAKnC62B,YAAS;AACP,cAAI,KAAKhoC,MAAMuvB,SAAX,GAAuB;AAClB,gBAAA,GAAA;AAAP,mBAAO,SAAA,IAAA,SAAA,IAAA,KAAKvvB,MAAM2R,UAAX,KAAA,SAAA,EAAwBq2B,UAAxB,KAAA,IAAuC;UADrB;AAI3B,iBACE,KAAKhoC,MAAM6rB,aAAX,KACA,CAAC,KAAK7rB,MAAM09C,cAAX,KACD,CAAC,KAAKvsC,UAAU/E,QAAQ0oC,YAGxB,CAAC,KAAK90C,MAAM4tC;QAXP;QAmBT3F,UAAU76B,GAAgB;AACxB,cAAI,KAAKpN,MAAMuvB,SAAX;AACF,iBAAK06F,oBAAoB78G,CAAzB;eADF;AAKA,iBAAKg2D,WAAW;AACA1yD,cAAAA,6CAAX,KACQC,EAAAA,6CAAS,IAApB;AAEF,iBAAKu5G,mBAAL;AAEA,iBAAKn2D,WAAW,KAAK/zD,MAAMuqB,uBAAX;AAEhB,iBAAKs/F,sBAAsB;AAK3B,iBAAKD,sBAAsB,KAJW/1H,oDAC3BmX,qCAAKw0C,sBACd,KAAKruC,UAAU/E,OAFY+9G,GAIwB,KAAKnqH,KAA/B;iEAI3B;AACA,iBAAKmR,UAAU0xB,kBAAkB,KAAjC;AACe9+B,qEAAf;AAEMi/F,gBAAY,CAAC,CAAC51F,MAAMA,EAAE8qD,UAAU9qD,EAAEoJ,WAAWpJ,EAAE6qD;AAEjD,iBAAKmyD,iBAAiBpnB,CAAtB,KACF,KAAKqnB,gBAAgBrnB,CAArB;AAEF,iBAAKhjG,MAAMi0D,YAAY,IAAvB;AACA,gBAAA;AAAA,qBAAA,IAAA,KAAK9iD,UAAUi1B,gBAAf,MAAA,EAAkC4tB,gBAAgB,KAAKh0D,KAAvD;UAhCA;QADwB;QAqClBiqH,oBAAoB78G,GAAgB;AAC1C,gBAAMsE,IAAS,KAAK1R,MAAM2R,UAAX;AACf,cAAI,CAACD;AACH,kBAAUxG,MACR,wFADI;AAKR,eAAK8+G,aAAa5tG,mDAAWkD,WAC3B5N,EAAO6Y,uBAAP,GACA,KAAKvqB,MAAMuqB,uBAAX,CAFgB;AAIlB7Y,YAAOu2B,UAAU76B,CAAjB;QAZ0C;QAqBpCg9G,iBAAiBpnB,GAAkB;AACzC,iBAAO,CAAC,EACN,KAAKhjG,MAAM2R,UAAX,KACCqxF,KACC,KAAKhjG,MAAMmvB,kBACX,KAAKnvB,MAAMmvB,eAAeG,YAA1B;QALqC;QAgBnC+6F,gBAAgBrnB,GAAkB;AAE3B/wF,cAAAA,GACAC,GADkB6+B;AAD/B,eAAKg5E,kBAC0Bh5E,SAAAA,IAAAA,SAAlB9+B,IAAXA,KAAKjS,MAAMiS,oBAAkB8+B,SAAlB9+B,EAAkB8+B,oBAAAA,IACEA,SAApB7+B,IAAXA,KAAKlS,MAAMkS,sBAAoB6+B,SAApB7+B,EAAoB6+B;AACjC,cAAIiyD,GAAW;AACoB7zE,gBAAAA;AAAjC,iBAAK26F,iBAA4C/4E,SAAhB5hB,IAAXA,KAAKnvB,MAAMmvB,kBAAgB4hB,SAAhB5hB,EAAgB4hB;UADpC;AAIf,eAAK/wC,MAAM4/F,OAAOoD,CAAlB;AACen/F,qEAAmB,KAAK7D,KAAvC;QATwC;QAalCkqH,qBAAkB;AACxB,gBAAMp9G,IAAQ,KAAgBpY,wCAAe6rD,8CAA1B,GACjB,KAAKvgD,OACL,MACA,KAAKA,MAAM+Q,eAAe,KAA1B,CAHY;AAKH9c,mDAAK6Y,CAAhB;QANwB;QAUlBw9G,mBAAgB;AACtB,gBAAMx9G,IAAQ,KAAgBpY,wCAAe6rD,8CAA1B;YACjB,KAAKvgD;YACL;YACA,KAAKA,MAAM+Q,eAAe,KAA1B;UAHY;AAKH9c,mDAAK6Y,CAAhB;QANsB;QAUhBsnD,gBAAa;AACnB,cAAI,CAAA,KAAKp0D,MAAM09C,cAAX,GAAJ;AACA,gBAAM5wC,IAAQ,KAAgBpY,wCAAe++C,EAAAA,wCAA1B,GACjB,KAAKzzC,KADO;AAGd8M,cAAM0iD,UAAU,CAAC,MAAD,CAAhB;AACA1iD,cAAMy9G,gBAAgB,KAAKx2D;AAC3BjnD,cAAM2iD,UAAN;AACWx7D,qDAAK6Y,CAAhB;UAPA;QADmB;QAYrBo7B,KAAKgsB,GAAkB;AACrB,cAAI,KAAKl0D,MAAMuvB,SAAX,GAAuB;AACzB,gBAAA;AAAA,qBAAA,IAAA,KAAKvvB,MAAM2R,UAAX,MAAA,EAAwBu2B,KAAK9rB,mDAAW8Q,IAAIgnC,GAAQ,KAAK81D,UAA5B,CAA7B;UADyB;AAK3B,iBAAKhqH,MAAMm0D,eAAeD,CAA1B,GACA,KAAKs2D,wBACH,KAAKxqH,OACLoc,mDAAWkD,WAAW40C,GAAQ,KAAKH,QAAnC,CAFF;QAPqB;QAkBfy2D,wBAAwBC,GAAyBr3D,GAAiB;AACxE,cAAMs3D,IAAgB,KAAKb;AAC3B,gBAAM/V,IAAe,KAAK6W,uBAAuBF,GAAer3D,CAA3C;AACrB,cAAK0gD,GAAL;AAUA,iBAAK+V,sBALCjV,IACJ8V,KACA,KAAKE,sBAAsBF,GAAet3D,GAAO0gD,CAAjD,IACI4W,IACA5W;AAGN,gBAAM,EAAC,OAAAJ,GAAO,WAAAoB,EAAR,IAAqBF;AACrBiW,gBACJnX,EAAM9oG,SAAS85D,sDAAeE,gBAC9B8uC,EAAM9oG,SAAS85D,sDAAeI;AAC1BgmD,gBACJhW,EAAUtvE,YAAV,KAA2B,CAACsvE,EAAUxlF,YAAV,EAAyBtB,kBAAzB;AAE5B68F,iBACAC,KACA,CAAC,KAAKvT,sBACJkT,GACA3V,EAAUxlF,YAAV,GACAokF,EAAM9oG,IAHP,IAMD,KAAKg/G,oBAAqBmB,mBACxBrX,GACAoB,GACAA,EAAUxlF,YAAV,CAHF,IAOF,KAAKs6F,oBAAqBoB,kBAAkBtX,GAAOoB,CAAnD;UAlCA;AACE,iBAAK8U,oBAAqBnW,YAA1B,GACA,KAAKoW,sBAAsB;QAL2C;QA4ClEtS,sBACN9yE,GACAuM,GACAwmE,GAAiB;AAMjB,iBAAO,CAAC,CAAC9qB,6CAAW8S,mCAClB/6D,GAJA+yE,MAAc9yC,sDAAeE,eACzB5zB,EAAY/+B,mBACZ++B,EAAY9+B,kBACT;QANQ;QAiBX04G,sBACNK,GACA73D,GACA0gD,GAAiC;AAEjC,gBAAM,EAAC,OAAOoX,GAAW,WAAWC,EAA9B,IAA+CF;AAC/CG,cAAW,IAAIhvG,mDAAW8uG,EAAUp0G,GAAGo0G,EAAUl0G,CAAtC;AACjB,gBAAMq0G,IAAe,IAAIjvG,mDAAW+uG,EAAcr0G,GAAGq0G,EAAcn0G,CAA9C;AACfs0G,cAAelvG,mDAAW4oC,SAC9B5oC,mDAAW8Q,IAAIk+F,GAAUh4D,CAAzB,GACAi4D,CAFmB;AAIrB,iBACEvX,EAAa9uD,WAAWsmE,IAAenrF,EAAAA,qCAAOk1B;QAVf;QAoB3Bs1D,uBACNF,GACAr3D,GAAiB;AAEXm4D,cAAa,KAAKC,oBAAoBf,CAAzB;AACnB,cAAI59E,IAAS,KAAKg9E,sBACd1pF,EAAAA,qCAAOi1B,uBACPj1B,EAAAA,qCAAOC,YACPw0E,IAAY;AAEhB,qBAAWvvC,KAAQkmD,GAAY;AAC7B,kBAAM,EAAC,YAAYzW,GAAW,QAAQ2W,EAAhC,IAAuCpmD,EAAK3yB,QAAQ7F,GAAQumB,CAArB;AACzC0hD,kBACFF,IAAY,EACVlB,OAAOruC,GACPyvC,WAAWA,GACX9vD,UAAUymE,EAHA,GAKZ5+E,IAAS4+E;UARkB;AAY/B,iBAAO7W;QApBU;QA6BX4W,oBAAoBf,GAAuB;AACjD,gBAAMpW,IAAYoW,EAAch4E,gBAAgB,KAA9B,GACZmgE,IAAc6X,EAAc5pB,sBAAsB,IAApC;AAChB+R,eAAeA,MAAgB6X,EAAct7F,kBAC/CklF,EAAUhnG,KAAKulG,CAAf;AAEF,iBAAOyB;QAN0C;QAanDlsE,QAAQ/6B,GAAgB;AACtB,cAAI,KAAKpN,MAAMuvB,SAAX,GAAuB;AACzB,gBAAA;AAAA,qBAAA,IAAA,KAAKvvB,MAAM2R,UAAX,MAAA,EAAwBw2B,QAAQ/6B,CAAhC;UADyB,OAA3B;AAKA,iBAAKk9G,iBAAL;AACA,iBAAKl2D,cAAL;AAEIl9D,gEAAJ;AAEe6M,qEAAf;iBACK6lH,oBAAqBnW,YAA1B;AAEA,gBAAI,CAAC,KAAKzzG,MAAM09C,cAAX,KAA8B,KAAK0lB,UAAU;AAGhD,kBAAA;AAAA,uBAAA,IAAA,KAAKjyD,UACFi1B,gBADH,MAAA,EAEIiuB,iBAAiB,KAAKr0D,OAAck+C,mCAFxC;AAGA,mBAAKl+C,MAAMi0D,YAAY,KAAvB;YANgD;AAS9C,iBAAK41D,sBAEP,KAAKrW,iBAAiB,KAAKqW,mBAA3B,IAEA,KAAK7pH,MAAMjF,YAAX;AAEF,iBAAKiF,MAAMs0D,WAAX;AAIA,iBAAKs1D,oBAAqB7pH,QAA1B;AACA,iBAAKoR,UAAU0xB,kBAAkB,IAAjC;AAEWlyB,cAAAA,6CAAS,KAApB;UAnCA;QADsB;QAwChB6iG,iBAAiBoB,GAA8B;AACrD,gBAAM;YAAC,OAAAlB;YAAO,WAAAoB;UAAR,IAAqBF;AAC3BlB,YAAM3iF,QAAQ+jF,CAAd;AAEA,gBAAMnB,IAAqBD,EAAMhU,WAAN,IAAqBoV,IAAYpB,GACtDr2B,IAAY,KAAKr9E,MAAM0zC,aAAX;AAElB14C,uEAAA,EAAsB44G,KAAK,MAAK;AACfhwG,uEAAmB+vG,EAAmBljF,eAAnB,CAAlC;AAEAtjB,uBAAW,MAAK;AACdkwE,gBAAUpqB,aAAV;YADc,GAEb,CAFH;UAH8B,CAAhC;QAPqD;QAoBvD7qB,aAAU;AACR,cAAI,KAAKpoC,MAAMuvB,SAAX,GAAuB;AACzB,gBAAA;AAAA,qBAAA,IAAA,KAAKvvB,MAAM2R,UAAX,MAAA,EAAwBy2B,WAAxB;UADyB,OAA3B;AAKK0hF,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,mBAAAA,EAAgB/4F,QAAQ,KAAK/wB,MAAMmvB,cAAxC;AACA,gBAAI,KAAK46F;AACP,sBAAQ,KAAKA,gBAAgBn/G,MAA7B;gBACE,KAAK85D,sDAAeC;AAClB,uBAAKolD,gBAAgBh5F,QAAQ,KAAK/wB,MAAMiS,gBAAxC;;gBAEF,KAAKyyD,sDAAeG;AAClB,uBAAKklD,gBAAgBh5F,QAAQ,KAAK/wB,MAAMkS,kBAAxC;cALJ;iBAOK;AACL,mBAAKlS,MAAMwF,OAAO,KAAKuuD,UAAW,CAAC,MAAD,CAAlC;AACA,kBAAA;AAAA,uBAAA,IAAA,KAAK5iD,UACFi1B,gBADH,MAAA,EAEIiuB,iBAAiB,KAAKr0D,OAAck+C,mCAFxC;AAKYwrE,uEACV,KAAKv4G,WACL,KAAKA,UAAUgiC,kBAAf,EAAmCI,iBAAiB,IAApD,GACA,KAAKvzC,KAHP;YAPK;AAeP,iBAAK+pH,kBADL,KAAKD,iBAAiB;AAGtB,iBAAKF,oBAAqBnW,YAA1B;iBACKoW,sBAAsB;AAE3B,iBAAK7pH,MAAMi0D,YAAY,KAAvB;AACA,iBAAKmP,WAAW;UAnChB;QADQ;MA1XN,GArCNljB,qDAAA,CAAA;AAqCaypE,yDAAAA,oBAAAA;ACkCP,UAAOr0E,4CAAP,cACIisD,mCADJ;QAmGJ7vE,YAAYvgB,GAAyBk0B,GAAuBkpB,GAAe;AACzE,gBAAMp9C,GAAWk0B,GAAekpB,CAAhC;AA9DF,eAAA/6C,QANA,KAAAE,SAAS;AAYD,eAAAg4G,gBAAgB,oBAAI/nE;AAG5B,eAAAgoE,UAA8B;AAQZ,eAAAn8F,WAAW;AAWrB,eAAAo8F,cAHA,KAAAC,sBANA,KAAAC,mBAAmB;AAmBnB,eAAAjN,cAAc;AAGd,eAAAz7C,WAAW;AASnB,eAAA2oD,iBAAiB,IAAI3vG,mDAAW,GAAG,CAAlB;AAET,eAAA4mD,eAA8B,IAAI2mD,sEAAkB,IAAtB;AAWpC,cAAI,CAACx4G,EAAUqe;AACb,kBAAMvN,UAAU,wDAAV;AAER,eAAK9Q,YAAYA;AACjB,eAAKu9F,YAAgBj4G,kDAAiBqwC,qCAAI8e,GAAG,CAAA,CAA5B;AAGjB,eAAK7rC,QAAQ5I,EAAU2jB,YAAV,EAAwB4oC,aAAxB,EAAuCw2B,cAAc,IAArD;AAGb,eAAK+C,aAAa9lF,EACf2jB,YADe,EAEfwiF,eAAe,KAAK5I,WAAW,KAAK30F,KAFrB;AAIZu3F,cAAU,KAAKra,WAAWqa;AAC/BA,YAAgBr4E,UAAU;AACnBv5B,yDAAgB4xG,CAAxB;AAGA,eAAK5C,UAAU96F,aAAa,WAAW,KAAK3C,EAA5C;AAEA,eAAK4xF,QAAL;QAvByE;QA8B3EzwE,UAAO;AACL,cAASrH,CAAL,KAAKA,aAAT;AACA,qBAAW+D,KAAS,KAAKD;AACvBC,gBAAM9nB,KAAN;AAEF,uBAAWynB,KAAQ,KAAKC,SAAL;AACjBD,gBAAK8iB,SAAS,KAAKy6E,8BAA8Bv9F,CAAnC,CAAd,GACAA,EAAKkjB,eAAL;AAEF,iBAAKF,YAAL;AACA,iBAAKwlD,WAAW8a,cAAc,KAAK/pE,UAAL,KAAoB,KAAK4F,UAAvD;AACM36B,gBAAM,KAAK8gB,WAAL;AACR,aAAC,KAAK5iB,UAAU/E,QAAQ0oC,YAAY7hC,KACxBjd,sDACZid,GACA,eACA,MACA,KAAKkrD,YAJP;AAQGlrD,cAAIuG,cACP,KAAKrI,UAAU6qE,UAAf,EAA2BxjE,YAAYvF,CAAvC;AAEF,iBAAK8X,cAAc;UAvBnB;QADK;QAgCPkhG,qBAAkB;AAChB,iBAAO,KAAKlyG,MAAM07D;QADF;QASlBy2C,oBAAiB;AACf,iBAAO,KAAKnyG,MAAMi7D;QADH;QAKjBniE,SAAM;AACJ,cAAI,KAAK0c,SAAL,GAAiB;AACnB,gBAAA;AAAA,qBAAA,IAAA,KAAK5d,UAAL,MAAA,EAAkBkB,OAAlB;UADmB;AAIrB,iBAAK81G,UAAL;QALI;QASN/1G,WAAQ;AACN,cAAI,KAAK2c,SAAL,GAAiB;AACnB,gBAAA;AAAA,qBAAA,IAAA,KAAK5d,UAAL,MAAA,EAAkBiB,SAAlB;UADmB;AAIrB,iBAAKg2G,aAAL;QALM;QAcCtpB,UAAUvsF,GAAsB;AACvC,gBAAMo5G,IAAY,KAAKtqB;AACvB,cAAI9uF,MAAco5G,GAAlB;AAIIl1H,iEAAJ;AACA,kBAAMqoG,UAAUvsF,CAAhB;AACI7b,gEAAJ;AAEA,gBAAMi5D,IAAU,KAAKp8B,WAAL;AAIhB,gBAAmBgnF,CAAf,KAAK5pG,UAAU4pG,cAAe5qD,GAAlC;AAIA,kBAAMi8D,IAAQ,KAAK7hG,uBAAL;AACVxX,kBACDA,EAAuBghB,WAAvB,EAAoCvb,YAAY23C,CAAhD,IACQg8D,OAGH1B,IAAgB,KAAKt5G,UACxB6qE,UADmB,EAEnBhpD,cAAc,kBAFK,KAIpB,KAAK7hB,UAAU6qE,UAAf,EAA2BtjE,aAAay3C,GAASs6D,CAAjD,IAEA,KAAKt5G,UAAU6qE,UAAf,EAA2BxjE,YAAY23C,CAAvC,GAEF,KAAKhjC,UAAUi/F,EAAMt1G,GAAGs1G,EAAMp1G,CAA9B;AAGF,mBAAKy6B,YAAL;YArBA;UAZA;QAFuC;QA+ChClnB,yBAAsB;AAC7B,gBAAM8hG,IAAc,KAAKl7G,UAAUi1B,gBAAf;AACpB,cAAI,CAACimF;AACH,kBAAUnhH,MACR,uEADI;AAIR,cAAI4L,IAAI,GACJE,IAAI,GAEJnH,IAAsB,KAAKkkB,WAAL;AAC1B,cAAIlkB,GAAJ;AACE,eAAG;AAED,oBAAMoO,IAAajmB,oDAAc6X,CAAtB;AACXiH,mBAAKmH,EAAGnH;AACRE,mBAAKiH,EAAGjH;AACRnH,kBAAUA,EAAQ2J;YALjB,SAMM3J,KAAW,CAACw8G,EAAYhN,SAASxvG,CAArB;UAPvB;AASA,iBAAO,IAAIuM;YAAWtF;YAAGE;UAAlB;QApBsB;QA8BtBvR,OAAOk0B,GAAYG,GAAYvqB,GAAiB;AACvD,cAAI,KAAKsyF;AACP,kBAAM32F,MAAM,kBAAN;AAER,gBAAMohH,IAA2Bh4H,8CAAX;AACtB,cAAIwY,IAA0B;AAC1Bw/G,gBACFx/G,IAAQ,KAAgBpY,wCAAe++C,EAAAA,wCAA1B,GAAwC,IAA7C,GACRlkC,KAAUzC,EAAM0iD,UAAUjgD,CAAhB;AAGN6jD,cAAQ,IAAIh3C,mDAAWud,GAAIG,CAAnB;AACRyyF,cAAU,KAAKhiG,uBAAL;AACV2pC,cAAS93C,mDAAW8Q,IAAIq/F,GAASn5D,CAAxB;AACf,eAAKjmC,UAAU+mC,EAAOp9C,GAAGo9C,EAAOl9C,CAAhC;AACA,eAAKwT,yBAAyB0pC,CAA9B;AAEIo4D,eAAiBx/G,MACnBA,EAAO2iD,UAAP,GACWx7D,yCAAK6Y,CAAhB;eAEGqE,UAAUkZ,eAAf;QArBuD;QA+BzD8C,UAAUrW,GAAWE,GAAS;AAC5B,eAAK6nG,cAAc,aAAa/nG,CAAb,KAAmBE,CAAnB;AACnB,eAAK+0G,iBAAiB,IAAI3vG,mDAAWtF,GAAGE,CAAlB;AACtB,eAAK+c,WAAL,EAAkBngB,aAAa,aAAa,KAAKm0B,eAAL,CAA5C;QAH4B;QAW9BA,iBAAc;AACZ,iBAAO,KAAK82E;QADA;QAUdr5G,OAAOyY,GAAgB1O,GAAiB;AACtC,gBAAMi9G,IAAQ,KAAKjiG,uBAAL;AACd,eAAK9kB,OAAOwY,EAAGnH,IAAI01G,EAAM11G,GAAGmH,EAAGjH,IAAIw1G,EAAMx1G,GAAGzH,CAA5C;QAFsC;QAYxC4kD,eAAeD,GAAkB;AAC/B,eAAK/mC,UAAU+mC,EAAOp9C,GAAGo9C,EAAOl9C,CAAhC;AACA,eAAK+c,WAAL,EAAkBngB,aAAa,aAAa,KAAKm0B,eAAL,CAA5C;AACA,eAAKvd,yBAAyB0pC,CAA9B;QAH+B;QAOjCI,aAAU;AACR,cAAI,CAAA,KAAK5W,cAAL,KACA,CAAA,KAAK/rC,UAAL,KACKi8B,CAAL,KAAKA,YAAT;AACA,gBAAM61B,IAAO,KAAKtyD,UAAUuyD,QAAf;AACb,gBAAK,QAAAD,KAAAA,EAAME,WAAN,GAAL;AACA,kBAAMC,IAAY,KAAKr5C,uBAAL;AACZs5C,kBAAYJ,EAAKK,QAAQF,CAAb;AACdC,oBAAcD,KAChB,KAAKp+D,OAAOq+D,GAAW,CAAC,MAAD,CAAvB;YAJF;UAFA;QAHQ;QAoBVhxB,uBAAoB;AAClB,gBAAM1O,IAAU,KAAK5Z,uBAAL,GACVkiG,IAAc,KAAKrlF,eAAL;AACpB,cAAIhsB,GACA0B;AACA,eAAK+F,OACPzH,IAAO+oB,EAAQrtB,IAAI21G,EAAYj5G,OAC/BsJ,IAAQqnB,EAAQrtB,MAEhBsE,IAAO+oB,EAAQrtB,GACfgG,IAAQqnB,EAAQrtB,IAAI21G,EAAYj5G;AAElC,iBAAO,IAAIwJ,uCAAKmnB,EAAQntB,GAAGmtB,EAAQntB,IAAIy1G,EAAY/4G,QAAQ0H,GAAM0B,CAA1D;QAZW;QAmBpB8jD,YAAS;AACP,eAAKq2B,WAAWx3B,YAAY,KAAKtuD,UAAU2jB,YAAf,EAA6B4oC,aAA7B;AAC5B,mBAASnwD,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAClDuhB,cAAM8xC,UAAN;QAHK;QAYAr0C,aAAab,GAAkB;AAClC,eAAKw2E,eAAex2E,MAGxB,MAAMa,aAAab,CAAnB,GACA,KAAKghG,iBAAL;QALsC;QAYhCA,mBAAgB;AACtB,cAAMhhG,IAAY,KAAKD,YAAL;AAClB,gBAAMkhG,IAA+Bn/D,uDAC/Bo/D,IAA+Bn/D;AAErC,mBAASlgD,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAC9CuhB,cAAMjkB,SAAS8hH,KACjB79F,EAAM+6B,WAAW,CAACn+B,CAAlB;AAIJ,mBAAW+C,KAAQ,KAAKC,SAAL;AACjBD,cAAKmjB,gBAAL;AAGGlmB,eAMCjR,IAAO,KAAKhO,SAA2B+rG,wDAAhC,IACP5vF,IAAQ,KAAKoJ,SAAS46F,CAAd,KAEZhkG,EAAMgxC,SAASn/C,CAAf,KAIA,KAAKyX,SAASy6F,CAAd,KACA,KAAK9lB,iBAAiB8lB,CAAtB,GACItyB;YAAY,IAAIN,8CAAWt/E,CAAf;YAAsBmyG;UAAxC,MAdE,KAAKvD,eAAL,GACA,KAAKngB,YAAYyjB,CAAjB;QAjBoB;QAuCxBE,IAAIpmF,GAAcp4B,GAAgB;AAChC,gBAAMy+G,IAAY,IAAI7E;AACtB6E,YAAUzF,WAAW3c,qDAAQY,gBAAgB7kE,CAAxB,CAArB;AACMsmF,cAAcD,EAAU1F,WAAV;AAEhB/4G,cACFy+G,EAAUjoF,KAAV,IAEAioF,EAAU9vB,KAAV;AAIF,WADM+qB,IAAW+E,EAAU1F,WAAV,MACDW,MAAagF,MACThF,EAAS/c,YAATgiB,EACRxtD,WAAV,GAGI,KAAKruD,UAAUwqD,6BACjB,KAAKxqD,UAAU8pD,UAAf,EAA4BosD,WAAWU,CAAvC;QAlB4B;QA4B1B5pD,aAAa/wD,GAAe;AAClC,gBAAMyH,IAAU,KAAK1D,UAAUswD,WAAWr0D,CAA1B;AACZyH,eACFA,EAAQo3D,iBAAiB7+D,GAAG,IAA5B;QAHgC;QAYpC6xC,WAAQ;AACN,gBAAMmM,IACoB,eAAxB,OAAO,KAAKpM,UAAyB,KAAKA,QAAL,IAAiB,KAAKA;AACzDoM,eACFpvC,OAAOixG,KAAK7hE,CAAZ;QAJI;QAaE8hE,sBAAmB;AAG3B,cAAI,KAAK/7G,UAAU/E,QAAQ0oC,YAAY,CAAC,KAAK8sD;AAC3C,mBAAO;AAET,gBAAM/+B,IAAczmB,gEAAoB1H,SAASkuB,sBAC/CxmB,gEAAoBI,UAAU0B,OAC9B,EAACl+C,OAAO,KAAR,CAFkB;AAMhB,eAAKmtH,qBACP,KAAKA,kBAAkBtqD,CAAvB;AAGF,iBAAOA;QAhBoB;QAyB7BW,gBAAgBp2D,GAAe;AAC7B,gBAAMy1D,IAAc,KAAKqqD,oBAAL;AAEhBrqD,eAAeA,EAAY51D,WACjB9O;YAAKiP;YAAGy1D;YAAa,KAAKhgD;YAAK,KAAK1R;UAAhD,GACYxP,mDAAgB,IAA5B;QAL2B;QAgB/B6oB,yBAAyBF,GAAuB;AACzC,eAAK84C,YAAU,KAAKgqD,0BAA0B9iG,CAA/B;AACpB,eAAK+iG,oBAAoB/iG,CAAzB;AACA,eAAKgjG,qBAAqBhjG,CAA1B;AAEA,qBAAWvY,KAAS,KAAK8Y,YAAY,KAAjB;AAClB9Y,cAAMyY,yBACJpO,mDAAW8Q,IAAI5C,GAAavY,EAAMg6G,cAAlC,CADF;QAN4C;QAYxCqB,0BAA0B9iG,GAAuB;AACvD,qBAAW+6C,KAAQ,KAAK5yB,gBAAgB,KAArB;AACjB4yB,cAAKyjD,aAAax+F,CAAlB;QAFqD;QAMjD+iG,oBAAoB/iG,GAAuB;AACjD,qBAAWmE,KAAQ,KAAKC,SAAL;AACjBD,cAAK4D,iBAAiB/H,CAAtB;QAF+C;QAM3CgjG,qBAAqBhjG,GAAuB;AAClD,qBAAWwE,KAAS,KAAKD;AACvB,uBAAWjG,KAASkG,EAAMC;AACxBnG,gBAAMyJ,iBAAiB/H,CAAvB;QAH8C;QAepD2pC,YAAYs5D,GAAe;AAEzB,WADA,KAAKnqD,WAAWmqD,MAEd,KAAK1O,cAAc,IACZ99D,kDAAoB1zC,KAAK,GAAG,KAAKolC,gBAAgB,IAArB,CAAnC,GACI/7C,0CAAS,KAAKg4G,WAAW,iBAA7B,MAEO3tD,kDAAoB9zC,SAAS,GAChCrW,6CAAY,KAAK83G,WAAW,iBAAhC;AAGF,mBAASnhG,IAAI,GAAGA,IAAI,KAAKu0F,aAAa70F,QAAQM;AAC3C,iBAAKu0F,aAAav0F,CAAlB,EAAkC0mD,YAAYs5D,CAA9C;QAZsB;QAqBlB9gG,WAAWX,GAAgB;AAClC,gBAAMW,WAAWX,CAAjB;AACA,eAAKmrE,WAAW8a,cAAcjmF,CAA9B;QAFkC;QAU3BU,YAAYZ,GAAiB;AACpC,gBAAMY,YAAYZ,CAAlB;cACc,KAAK8C,SAAL;AACd,mBAASnhB,IAAI,GAAGA,IAAIihB,EAAMvhB,QAAQM;AAChCihB,cAAMjhB,CAAN,EAASokC,eAAT;QAJkC;QAgB7BzhB,UAAUd,GAAe;AAChC,gBAAMc,UAAUd,CAAhB;AACA,eAAKqiB,YAAL;QAFgC;QAYzB+yD,mBAAmBC,GAAwB;AAC9C,eAAKpC,uBAAuBoC,MAGhC,KAAKpC,qBAAqBoC,OAExB,KAAK5mG,UACH,KAAKsT,UAAU2jB,YAAf,EAA6B4oC,aAA7B,EAA4Cu0B,uBAD9C,GAGA,KAAKgF,WAAW6a,sBAAsB,IAAtC;QATgD;QAkBpD/9E,aAAU;AACR,iBAAO,KAAK26E;QADJ;QAYD3uG,QAAQijG,GAAqBmM,GAAiB;AACrD,eAAKpgD,YAAY;AAEThvD,iDAAR;AACYrB,kDAAZ;AAEIywG,gBACF,KAAKvP,OAAOoD,CAAZ,GACgBt/F,wDAAgB,IAAhC;gBAGI3D,QAAQ,CAAC,CAACijG,CAAhB;AACIlsG,sDAAW,KAAK43G,SAApB;QAZqD;QAmB9CxL,kBAAe;AACtB,eAAKn0C,YAAY;AACjB,gBAAMm0C,gBAAN;AAEWhuG,oDAAP,MAAyB,SAC3B,KAAK0d,SAAL,GACA,KAAKzB,UAAU0sC,qBAAf;AAGF,WAAC,GAAG,KAAK6tE,cAAcnmG,OAAnB,CAAJ,EAAiC8nB,QAAS65D,OAAMjyF,aAAaiyF,CAAb,CAAhD;AACA,eAAKwkB,cAAc5oF,MAAnB;AAEA,eAAKpU,SAAL,EAAgB2e,QAAS9/B,OAAMA,EAAExN,QAAF,CAA/B;QAZsB;QAsBxBw1C,iBAAc;AACR,eAAKpkC,UAAUgY,aAGRxY,EAAAA,6CAAS,IAApB,GACA,KAAKQ,UAAUxG,UAAf,GACI,KAAKsH,mBAGP,KAAKlS,QAAQ,OAAO,IAApB,IAEA,KAAKA,QAAmB,MAAM,IAA9B,GAES4Q,EAAAA,6CAAS,KAApB;QAbY;QAqBdujC,aAAU;AACR,iBAAI,KAAKmuD,qBACA,OAEF,EACL11E,QAAQ28F,0DAAYh6E,MACpBk6E,YAAmBhuH,iDAAK,MAAM,EAC5B4vB,gBAAgB,MAChB0C,eAAe,MAFa,CAAlB,GAIZy7F,YAAmBj0H,iDAAmB,MAAM,IAAhC,EANP;QAJC;QAmBVm8C,cAAW;AACT,eAAKwlD,WAAWxlD,YAAY,IAA5B;AAEA,gBAAMjjB,IAAQ,KAAKE,SAAL;AACd,mBAASnhB,IAAI,GAAGA,IAAIihB,EAAMvhB,QAAQM;AAChCihB,cAAMjhB,CAAN,EAASkkC,YAAT;mBAGO36B,IAAI,GAAGgY,GAAQA,IAAQ,KAAKD,UAAU/X,CAAf,GAAoBA;AAClD,qBAASE,IAAI,GAAG4R,GAAQA,IAAQkG,EAAMC,SAAS/X,CAAf,GAAoBA;AAClD4R,gBAAM6oB,YAAN;QAVK;QAqBX43E,iBAAc;AACZ,gBAAM74G,IAAW,CAAC,KAAKlc,UAAL,KAAoB,KAAKuqD,qBAAL;AAEtC,cAAI,KAAKitE,qBAAqBt7G,GAAU;AACtC,gBAAA;AAAA,qBAAA,IAAA,KAAK4B,aAAL,MAAA,EAAqBi3G,eAArB;UADsC,OAAxC;AAKA,iBAAK53E,YAAL;AACA,iBAAKq6E,mBAAmBt7G;AACxB,uBAAWuB,KAAS,KAAK8Y,YAAY,KAAjB;AAClB9Y,gBAAMs3G,eAAN;UARF;QAHY;QAsBL/f,eAAe7uF,GAAqBxJ,IAAa,IAAE;AAC1D,cAAKA;AAMM,iBAAKy6G,cAActhG,IAAInZ,CAAvB,MAETgE,aAAa,KAAKy2G,cAAch3H,IAAIuc,CAAvB,CAAb,GACA,KAAKy6G,cAAc9gG,OAAO3Z,CAA1B;eATO;AAEP,qBAAWu8G,KAAW,KAAK9B,cAAcnmG,OAAnB;AACpBtQ,2BAAau4G,CAAb;iBAEG9B,cAAc5oF,MAAnB;UALO;AAWT,cAAI,KAAK3xB,UAAUgB,WAAf;AAGF,iBAAKu5G,cAAczhG,IACjBhZ,GACA9D,WAAW,MAAK;AACT,mBAAKuwC,cAAL,MACH,KAAKguE,cAAc9gG,OAAO3Z,CAA1B,GACA,KAAKq4F,eAAe7uF,GAAMxJ,CAA1B;YAHY,GAKb,GALH,CAFF;mBAWE,KAAK28B,eACPnzB,IAAO,OAGHgU,IAAO,KAAKgD,QAAQ41D,sDAAY/3C,IAAzB,GACT70B,GAAM;AAGR,gBAAI/I,IAAS,KAAKuyF,kBAAL,GACTwpB,IAAkB;AACtB,mBAAO/7G;AACDA,gBAAO+Z,YAAP,MACFgiG,IAAkB/7G,IAEpBA,IAASA,EAAOuyF,kBAAP;AAEPwpB,iBACFA,EAAgBnkB,eACdpiF,EAAAA,+BAAA,4BACAouB,0CAASo4E,oBAFX;gBAOCj/F,EAAqB84D,WAAW9sE,GAAMxJ,CAAtC,IAED,KAAK4gB,QAAQ,IAAIw1D,sDAAY,IAAhB,EAAsBE,WAAW9sE,GAAMxJ,CAAvC,CAAb;UArBM;AAuBCwd,kBAEJxd,KAIHwd,EAAK84D,WAAW,IAAIt2E,CAApB,GAEKwd,EAAKjD,QAAL,KAAgB,KAAK69E,WAAWhiB,sDAAY/3C,IAA5B,KALrB,KAAK+5D,WAAWhiB,sDAAY/3C,IAA5B;QAzDsD;QAwEnDlF,WAAWuhF,GAA2B;AAC7C,eAAKtiB,WAAWh/D,EAAAA,sDAAYiF,IAA5B;AACIq8E,eAAS,KAAK95F,QAAQ85F,CAAb;QAFgC;QAKtC95F,QAAyBpD,GAAO;AACvC,gBAAMoD,QAAQpD,CAAd;AAEIA,uBAAgB4b,EAAAA,0DAAa,KAAKshF,UAAUl9F;AAEhDA,YAAK8iB,SAAS,KAAKy6E,8BAA8Bv9F,CAAnC,CAAd;AACAA,YAAKgjB,YAAL;AACAhjB,YAAKkjB,eAAL;AACA,eAAK52C,YAAL;AAEA,iBAAO0zB;QAVgC;QAiBjCu9F,8BAA8Bv9F,GAAW;AAC/C,iBAAQrhB,OAAmB;AACrB,iBAAKswC,cAAL,MACE7oC,IAAU,KAAK1D,UAAUswD,WAAWr0D,CAA1B,MAEdyH,EAAQ23D,aAAa/9C,CAArB;UAJuB;QADoB;QAUxC46E,WAAWz+F,GAAqB;AACvC,gBAAM+iH,IAAU,MAAMtkB,WAAWz+F,CAAjB;AAEZA,YAAKmjC,OAAO1D,EAAAA,sDAAYiF,IAAxB,MAA+B,KAAKq8E,UAAU;AAElD,eAAK5wH,YAAL;AAEA,iBAAO4yH;QAPgC;QAoBhCnuF,WAAWC,GAAgB;AACtBp6B,wDACV,cACA,OACA,OACA,0CAJF;gBAMMuoH,IAAa,KAAKt5H,UAAL;AACnB,gBAAMkrC,WAAWC,CAAjB;AACI,eAAKnrC,UAAL,MAAqBs5H,KAAe,KAAK/uE,qBAAL,KACtC,KAAKwqE,eAAL;QAVgC;QA4B3Br3G,kBAAkBxB,GAAmBjB,GAAc;AAC1D,gBAAMq+G,IAAa,KAAKt5H,UAAL;AACnB,gBAAM0d,kBAAkBxB,GAAUjB,CAAlC;AACI,eAAKjb,UAAL,MAAqBs5H,KAAe,KAAK/uE,qBAAL,KACtC,KAAKwqE,eAAL;QAJwD;QAc5DjyD,eAAee,GAAoB;AACjC,eAAK8+B,WAAW0a,kBAAkBx5C,CAAlC;QADiC;QAUnCwwD,YAAS;AACP,eAAK1xB,WAAW2a,eAAe,IAA/B;QADO;QAUTgX,eAAY;AACV,eAAK3xB,WAAW2a,eAAe,KAA/B;QADU;QAUZtuC,eAAe7yD,GAAe;AAC5B,eAAKwmF,WAAW4a,qBAAqBphG,CAArC;QAD4B;QAYrBskE,YAAS;AAChB,iBAAO,KAAKh7D,MAAM27D;QADF;QAST73E,UAAU09B,GAAuB;AACxC,gBAAM19B,UAAU09B,CAAhB;cACiB,KAAKpqB,UACnB2jB,YADc,EAEd4oC,aAFc,EAGds2B,uBAAuB,KAAKyN,OAHd;AAKjB,eAAKxK,WAAWpa,SAASgxC,EAAS9zG,KAAlC;AACA,eAAKA,QAAQ8zG,EAAS9zG;AACtB,eAAK2nF,aAAamsB,EAAShjH;AAE3B,eAAK4mC,YAAL;QAXwC;QAoBjCorC,SAAS/N,GAAsB;AACtC,gBAAMC,IAAa,KAAK59D,UACrB2jB,YADgB,EAEhB4oC,aAFgB,EAGhBw2B,cAAcplB,CAHE;AAInB,eAAK4yB,aAAa5yB;AAElB,cAAIC;AACF,iBAAK2gB,MAAM3gB,EAAW2gB,KACtB,KAAKuH,WAAWpa,SAAS9N,CAAzB,GAEA,KAAK0yB,UAAU1yB,EAAW2G,eAC1B,KAAK37D,QAAQg1D,GAEb,KAAKt9B,YAAL;;AAEA,kBAAMvmC,MAAM,yBAAyB4jE,CAA/B;QAhB8B;QA8BxC7b,aAAaqyD,IAAY,OAAK;AAE5B,cAAItlH,IAAqB;AACzB,cAAI,CAAAA,EAAM09C,cAAN,GAAJ;AAGA,eAAG;AACD,oBAAM3Q,IAAO/sC,EAAM+zB,WAAN,GACPriB,IAASq7B,EAAKvzB,YACdmI,IAAajQ,EAAQiQ;AAEvBA,gBAAWA,EAAW1U,SAAS,CAA/B,MAAsC8/B,KACxCr7B,EAAQ8G,YAAYu0B,CAApB;AAEF,kBAAIu4E;AAAW;AACftlH,kBAAQA,EAAM2R,UAAN;YATP,SAUM3R;UAbT;QAH4B;QA0BrBwlG,qBACPC,GACAC,GAAoC;AAEpC,gBAAMF,qBAAqBC,GAAYC,CAAvC;AACA,eAAK3qG,YAAL;QAHoC;QAa7B4qG,iBACPF,GACAC,GAAoC;AAEpC,gBAAMC,iBAAiBF,GAAYC,CAAnC;AACA,eAAK3qG,YAAL;QAHoC;QAa7B6qG,UACPH,GACAC,GAAoC;AAEpC,gBAAME,UAAUH,GAAYC,CAA5B;AACA,eAAK3qG,YAAL;QAHoC;QAW7Bw1B,gBAAgBk1E,GAAmB;AAC1C,gBAAMl1E,gBAAgBk1E,CAAtB;AACA,eAAK1qG,YAAL;QAF0C;QAcnCmuG,YAAYr+F,GAAc4vF,GAAmB;AAC9CkzB,cAAU,MAAMzkB,YAAYr+F,GAAM4vF,CAAxB;AAChB,eAAK1/F,YAAL;AACA,iBAAO4yH;QAH6C;QAY7C3kB,wBAAwBF,GAAoBC,GAAgB;AACnE,gBAAMC,wBAAwBF,GAAYC,CAA1C;eACKhuG,YAAL;QAFmE;QAM5D4rG,YAAY73E,GAAY;AAC/B,gBAAM63E,YAAY73E,CAAlB;AACA,eAAK/zB,YAAL;AACA,iBAAO+zB;QAHwB;QAgBjCiB,sBAAsB+9F,GAAc;AAC9B,eAAK57G,sBACP,KAAKA,mBAAmBg3G,YAAY4E,CAApC;AAEE,eAAK77G,oBACP,KAAKA,iBAAiBi3G,YAAY4E,CAAlC;AAEF,cAAI,KAAK3+F,gBAAgB;AACvB,iBAAKA,eAAe+5F,YAAY4E,CAAhC;AACA,gBAAM/7G,IAAQ,KAAKod,eAAeG,YAApB;AACVvd,iBACFA,EAAMge,sBAAsB+9F,CAA5B;UAJqB;AAQzB,cAAS5rB,CAAL,KAAKA;AAOT,iBAAS30F,IAAI,GAAGA,IAAI,KAAKshB,UAAU5hB,QAAQM,KAAK;AAC9C,kBAAM83D,IAAO,KAAKx2C,UAAUthB,CAAf,EAAkB0hB;AAC3Bo2C,oBACFA,EAAK6jD,YAAY4E,CAAjB,IAGM9tH,IAAQqlE,EAAK/1C,YAAL,MAEZtvB,EAAM+vB,sBAAsB+9F,CAA5B;YAR0C;QAtBd;QA4C3Br7E,gBAAgBs7E,GAAY;AACnC,gBAAMjqB,IAAgB,CAAA;AAClB,eAAK7xF,oBACP6xF,EAAcz2F,KAAK,KAAK4E,gBAAxB;AAEE,eAAKC,sBACP4xF,EAAcz2F,KAAK,KAAK6E,kBAAxB;AAEE,eAAKid,kBACP20E,EAAcz2F,KAAK,KAAK8hB,cAAxB;AAEF,cAAI4+F,KAAO,CAAC,KAAK7rB;AACf,qBAAS30F,IAAI,GAAGuhB,GAAQA,IAAQ,KAAKD,UAAUthB,CAAf,GAAoBA;AAC9CuhB,gBAAMG,cACR60E,EAAcz2F,KAAKyhB,EAAMG,UAAzB;AAIN,iBAAO60E;QAlB4B;QA+B5BjD,sBACPkD,GAAsB;AAEtB,iBAAO,MAAMlD,sBAAsBkD,CAA5B;QAFe;QAefY,sBACPnyD,GACA6yB,GAAgB;AAEhB,iBAAO,MAAMs/B,sBAAsBnyD,GAAY6yB,CAAxC;QAFS;QAYT61B,gBAAgBtwF,GAAoB;AAC3C,iBAAO,IAAIu9G,8DAAmB,MAAMv9G,CAA7B;QADoC;QASpCwH,eAAY;AACnB,iBAAO,MAAMA,aAAN;QADY;QASZy9E,mBAAgB;AACvB,iBAAO,MAAMA,iBAAN;QADgB;QAUhBllE,iBAAc;AACrB,gBAAMoiB,IAAO,KAAK2G,aAAL;AACb,cACE,EAAA,KAAKgK,cAAL,KACA,KAAKvsC,UAAUgB,WAAf,KACA46B,EAAKa;AASP,uBAAWy3B,KAAQ,KAAK5yB,gBAAgB,KAArB,GAA6B;AAC9C,kBAAI4yB,EAAKq6B,WAAL,GAAmB;AAErB,oBAAA;AAAA,yBAAA,IAAAr6B,EAAK/1C,YAAL,MAAA,EAAoB3E,eAApB;cAFqB;AAKvB,yBAAWmqF,KAAazvC,EAAKc,WAAWhmC,EAAAA,qCAAOC,UAAvB;AACC00E,kBAVRrkF,eAAV,EAA2BijB,aAA3B,MAA8C3G,MAW/Cs4B,EAAK7/B,YAAL,KAAsBsvE,EAAUtvE,YAAV,MAEtB6/B,EAAKq6B,WAAL,IACFoV,EAAU2T,aAAapjD,CAAvB,IAEAA,EAAKojD,aAAa3T,CAAlB;YAb0C;QAd3B;QAqCvBkZ,sBAAmB;AACjB,eAAK15D,WAAL;AACA,eAAK3pC,eAAL;QAFiB;QAenB2rF,uBACE2X,GACA9X,GACAC,GAAiC;AAIjC,cACE6X,EAAiBrjH,SAAS85D,sDAAeG,kBACzCopD,EAAiBrjH,SAAS85D,sDAAeC,aACzC;AAEA,gBAAIhrC,IAAKw8E,EAAuBr/F;AAC5BgjB,gBAAKq8E,EAAuBn/F;AAEhC2iB,iBAAMy8E,EAAsBt/F,IAAIm3G,EAAiBx0B,iBAAjB,EAAoC3iF;AACpEgjB,iBAAMs8E,EAAsBp/F,IAAIi3G,EAAiBx0B,iBAAjB,EAAoCziF;AAEpE,iBAAKvR,OAAOk0B,GAAIG,CAAhB;UARA;QAP+B;QA4B1BjP,YAAYu5E,GAAgB;AACnC,iBAAO,MAAMv5E,YAAYu5E,CAAlB;QAD4B;QAYrCrpG,cAAW;AACT,iBAAwBA,qDAAY,IAA7B;QADE;QAQXglC,SAAM;AACJ,eAAKhlC,YAAL;AACiBE,wEAAjB;QAFI;QAWN+vB,oBAAiB;AACX/zB,+DAAJ;eAESw0B,YAAL,KACF,KAAKihG,iBAAL;AAGG,eAAKp4H,UAAL,KACH,KAAK+0H,eAAL;AAGF,eAAKl4G,UAAU2jB,YAAf,EAA6BiL,OAAO,IAApC;AACA,eAAKmuF,2BAAL;AAEIh3H,8DAAJ;AACA,eAAKqrE,eAAL;QAfe;QA2BjB2rD,6BAA0B;AACxB,qBAAWp/F,KAAS,KAAKD,WAAW;AAClC,kBAAMw2C,IAAOv2C,EAAMG;AACfo2C,iBAAMA,EAAK2jD,mBAAL;UAFwB;AAIhC,eAAK75F,kBAAgB,KAAKA,eAAe65F,mBAApB;QALD;QAShBzmD,iBAAc;AAClB,eAAKpxD,UAAUwqD,6BAA6B,KAAKs7B,WAAW17B,aAC9D,KAAKpqD,UAAU8pD,UAAf,EAA4BW,KAA5B;eAEOzqD,UAAUwqD,6BAA6B,KAAKs7B,WAAWx7B,aAE9D,KAAKtqD,UAAU+pD,UAAUb,oDAAc0B,YAAvC,EAAsDH,KAAtD;AAEF,qBAAW9sC,KAAS,KAAKD;AACvB,uBAAWjG,KAASkG,EAAMC;AACxBnG,gBAAM25C,eAAN;QAVkB;QAsBxBjH,aAAaC,GAAqB;AAChC,eAAK07B,WAAW37B,aAAaC,CAA7B;QADgC;QAWlCR,aAAaU,GAAqB;AAChC,eAAKw7B,WAAWl8B,aAAaU,CAA7B;QADgC;QAWlCr0B,iBAAc;AACZ,cAAI1zB,IAAS,KAAKA,QACdF,IAAQ,KAAKA;AAEjB,cAAMS,IAAY,KAAK7B,aAAL;AAClB,cAAI6B,GAAW;AACPk6G,gBAAkBl6G,EAAUmzB,eAAV;AACxB,kBAAMgnF,IAAY,KAAKj9G,UACpB2jB,YADe,EAEf4oC,aAFe,EAEA4yB;iBACR69B,EAAgBz6G,SAAS06G;AACnC56G,gBAAQsK,KAAKE,IAAIxK,GAAO26G,EAAgB36G,KAAhC;UANK;AAQf,iBAAO,EAACE,QAAAA,GAAQF,OAAAA,EAAT;QAbK;QAwBdojG,mBAAmBt9F,GAAY;AAE5B,eAAK29E,WAAkC+a,sBAAsB14F,CAA7D;QAF4B;QAa/Bq9F,uBAAuBtxC,GAA0B/rD,GAAY;AAE1D,eAAK29E,WAAkCgb,6BACtC5sC,GACA/rD,CAFD;QAF0D;QAS7D+0G,gBAAgBrrD,GAA2B;AACzC,eAAKA,eAAeA;QADqB;QAKlCh7B,YAAS;AAChB,iBAAO,KAAKg7B,aAAah7B,UAAlB;QADS;QAKlBC,UAAU76B,GAAgB;AACxB,eAAK41D,aAAa/6B,UAAU76B,CAA5B;QADwB;QAK1B86B,KAAKgsB,GAAoB9mD,GAAgB;AACvC,eAAK41D,aAAa96B,KAAKgsB,GAAQ9mD,CAA/B;QADuC;QAKzC+6B,QAAQ/6B,GAAgB;AACtB,eAAK41D,aAAa76B,QAAQ/6B,CAA1B;QADsB;QAKxBg7B,aAAU;AACR,eAAK46B,aAAa56B,WAAlB;QADQ;QAOVkmF,eAAY;AACV,gBAAMp9G,IAAuB,OAAA;YAAA,CAAA;YAAA,EAC3Bq9G,MAAM,QADqB;YAEjB/yH,iDAAK,IAAZ;UAFwB,GAKvBgzH,IAAW,oBAAI5gH,IAAI,CAAC,MAAM,UAAU,SAAS,UAAU,SAApC,CAAR,GAGX6gH,IAAeA,SAAUv9G,GAA8B;AAC3D,uBAAWhF,KAAOgF;AACZs9G,gBAASpkG,IAAIle,CAAb,IACF,OAAOgF,EAAKhF,CAAL,IACuB,aAArB,OAAOgF,EAAKhF,CAAL,KAChBuiH,EAAav9G,EAAKhF,CAAL,CAAb;UALuD;AAU7DuiH,YAAav9G,CAAb;AACA,iBAAO,CAACA,CAAD;QApBG;MA/iDR;AAaYokC,gDAAAo5E,SAAS;AAOTp5E,gDAAAo4E,uBAAuB;AA3FzC,UAAAxtE,kCAAA,CAAA;AAuEa5K,sCAAAA,WAAAA;ACjDP,UAAOq5E,gDAAP,MAAA;QAYJj9F,cAAA;QAAA;QAOAk9F,YAAYC,GAAwB;QAAA;QAUpCC,WAAWD,GAAwB;QAAA;QASnCE,WAAWF,GAAwB;QAAA;QASnCG,OAAOH,GAAwB;QAAA;QAW/BrL,gBAAa;AACX,iBAAO;QADI;QAabyL,kBAAkBJ,GAAwB;AACxC,iBAAO;QADiC;MAvEtC,GAtBN3uE,oCAAA,CAAA;AAsBayuE,wCAAAA,aAAAA;AxJtBb,UAAAzuE,+CAAA,CAAA;AA2BgBt4C,mDAAAA,cAAAA;AyJHV,UAAOsnH,gDAAP,cAA0BP,8CAA1B;QAmBJj9F,cAAA;AACE,gBAAA;AAdQ,eAAAy9F,eAAe;QAazB;QAcA5rD,YAAY1zD,GAAmB;AACzBA,uBAAmBylC,6CAEf85E,IAAmB,CADXv/G,EACkB8B,UAAN,KADZ9B,EACuCjI,YAAN,GAC/C,KAAKynH,mBAAmBD,CAAxB,KAEA,KAAKC,mBAAmBznH,0DAAYiI,CAAZ,KAAwBA,EAAQjI,YAAR,CAAhD;AAEF,iBAAO,KAAKunH;QARiB;QAgBrBE,mBAAmB9rD,GAAoB;AAC/C,eAAK4rD,eAAe5rD;QAD2B;MAjD7C,GAxBNrjB,oCAAA,CAAA;wCAwBagvE,aAAAA;ACoBP,UAAOI,2CAAP,cACIJ,8CADJ;QAqDJx9F,YAAoBvgB,GAAuB;AACzC,gBAAA;AADkB,eAAAA,YAAAA;AA7CX,eAAAF,KAAK;AAKG,eAAAwQ,WAAqB,CAAA;AAOtC,eAAA64B,SAAyB;AAGzB,eAAAi1E,YAAY;AAMJ,eAAAC,cAAc;AASd,eAAAC,UAHA,KAAAC,SAHA,KAAA1pF,WAA8B;AAe9B,eAAA7qB,MAHA,KAAAC,OAHA,KAAAu0G,UAAU;AASV,eAAA5kG,cAAc;AAM8B,eAA9C,KAAK5Z,UAAU/E,QAAQokE,wBAKrBo/C,IAAyB,IAAIz2E,uCAAQ;YACzC,YAAc;YACd,iBAAmB,KAAKhoC;YACxB,KAAO,KAAKA,UAAU0R;YACtB,eAAiB,KAAK1R,UAAU/E,QAAQ0kE;YACxC,UAAY,KAAK3/D,UAAU/E,QAAQimC;YACnC,mBAAqB,KAAKlhC,UAAU/E,QAAQklE;YAC5C,MAAQ,EACN,YAAc,KADR;UAPiC,CAAZ,GAY3B,KAAKngE,UAAUoS,oBACjBqsG,EAAuBl/C,kBACrB,KAAKv/D,UAAUu/D,oBAA4BptD,8CAASH,MACxCG,8CAASG,SACTH,8CAASH,KAMvB,KAAKm3B,SAAS,KALoBzmD;YACvBmX,qCAAK+0C;YACd,KAAK5uC,UAAU/E;YACf;UAHuBq2G,GAKWmN,CAAtB,MAEdA,EAAuBl/C,kBACrB,KAAKv/D,UAAUu/D,oBAA4BptD,8CAASE,QACxCF,8CAASX,OACTW,8CAASE,OAMvB,KAAK82B,SAAS,KALkBzmD,oDACrBmX,qCAAK80C,0BACd,KAAK3uC,UAAU/E,SACf,IAHqBs2G,GAKWkN,CAApB,IAEhB,KAAKz+G,UAAUq+B,kBAAkB,KAAKqgF,SAAS55H,KAAK,IAAnB,CAAjC;QA3CyC;QAmD3CuH,YAAS;AAeP,eAAKwoC,WAAevvC;YAAiBqwC,qCAAI8e;YAAG,EAAC,SAAS,eAAV;UAA5B;AAChB,cAAI4G;AACJ,gBAAM3S,IAAMluC,OAAOmS,KAAKg8B,OAAL,CAAP,EAAsB1e,UAAU,CAAhC;AACZoxB,cAAW/1D,kDACTqwC,qCAAIoe,UACJ,EAAC,IAAM,6BAA6BrL,EAApC,GACA,KAAK7T,QAHA;AAKHvvC,4DACFqwC,qCAAIof,MACJ,EAAC,OAASyF,uCAAO,QAAUmkE,6CAAa,GAAKC,2CAA7C,GACAvjE,CAHF;AAKA,gBAAM5xC,IAAWnkB;YACfqwC,qCAAI+e;YACJ,EACE,OAASsF,sCAAO33C,OAChB,GAAK,CAACw8G,6CACN,QAAU7kE,sCAAOz3C,QACjB,GAAK,CAACu8G,4CACN,aAAa,kCAAkCp2E,IAAM,IALvD;YAOA,KAAK7T;UATM;AAWbprB,YAAK8xC,eACChT,2CACJ,cACA,KAAKvoC,UAAU/E,QAAQ4L,cAAcmzC,sCAAOC,GAH9C;AAMAoB,cAAW/1D;YACTqwC,qCAAIoe;YACJ,EAAC,IAAM,4BAA4BrL,EAAnC;YACA,KAAK7T;UAHA;AAKHvvC,4DACFqwC,qCAAIof,MACJ,EAAC,OAASyF,uCAAO,QAAUokE,2CAA3B,GACAvjE,CAHF;AAKA,eAAKkjE,SAAaj5H,kDAChBqwC,qCAAI+e,OACJ;YACE,OAASsF,sCAAO33C;YAChB,GAAK,CAACw8G;YACN,QAAU7kE,sCAAOz3C;YACjB,GAAK,CAACu8G;YACN,aAAa,iCAAiCp2E,IAAM;UALtD,GAOA,KAAK7T,QATO;AAWd,eAAK0pF,OAAOhjE,eACNhT,2CACJ,cACA,KAAKvoC,UAAU/E,QAAQ4L,cAAcmzC,sCAAOC,GAH9C;AAUcn1D,qDACZ,KAAK+vC,UACL,eACA,MACA,KAAKkqF,0BAJP;AAMcj6H,qDAAK,KAAK+vC,UAAU,aAAa,MAAM,KAAKmqF,KAA1D;AAEcl6H,qDAAK2kB,GAAM,eAAe,MAAM,KAAKw1G,SAAnD;AACcn6H;YAAK2kB;YAAM;YAAc;YAAM,KAAKy1G;UAAlD;AACA,eAAKC,WAAL;AACA,iBAAO,KAAKtqF;QAvFL;QA2FTh/B,OAAI;AAC+C,cAA7C,KAAKmK,UAAU/E,QAAQokE,wBACrBz5E,6CACF,KAAKujD,OAAQ98C,UAAUspC,qCAAI0S,GAA3B,GACA,KAAKroC,UAAU+B,aAAf,CAFF,GAIA,KAAKonC,OAAQtzC,KAAK,KAAKmK,SAAvB;AAEF,eAAKA,UAAUg7C,oBAAf,EAAqCtI,aAAa,EAChDE,WAAW,MACXrH,QAAQ,GACRsH,cAAc;YACZP,0DAAiBN,WAAWK;YAC5BC,0DAAiBN,WAAWI;YAC5BE,0DAAiBN,WAAWG;YAC5BG,0DAAiBN,WAAWE;UAJhB,EAHkC,CAAlD;AAUA,eAAKt4B,cAAc;AACnB,eAAKwlG,WAAW,KAAhB;QAnBE;QA0BJxwH,UAAO;AACL,eAAKoR,UAAUg7C,oBAAf,EAAqChI,gBAAgB,UAArD;AACI,eAAKne,YACHlvC,4CAAW,KAAKkvC,QAApB;AAEE,eAAKypF,WACPx6G,aAAa,KAAKw6G,OAAlB;QANG;QAeCe,cAAW;AACjB,iBAAO,CAAC,CAAC,KAAK/uG,SAASxU;QADN;QASnBwjH,iBAAc;AACZ,iBAAO,CAAC,CAAC,KAAKn2E,UAAU,KAAKA,OAAO97C,UAAZ;QADZ;QAKdkyH,aAAU;AACR,cAAI,CAAA,KAAKD,eAAL,GAAJ;AAGA,gBAAMhvG,IAAW,KAAKA,SAAS5T,IAAI,SAAU8iH,GAAM;AACjD,qBAAO52D,KAAKt5D,MAAMkwH,CAAX;YAD0C,CAAlC,GAIXC,IAAe,KAAKz/G,UAAU+B,aAAf,EAA8B6G;AACnD62G,cAAax1D,SAAS;AACtBjuD,uBAAW,MAAK;AACTmtC,kBAAAA;AAAL,uBAAKA,IAALA,KAAKA,WAAAA,EAAQn8C,KAAKsjB,CAAlB;AACAmvG,gBAAax1D,SAAS;AACP74C,kBAAAA;AAAf,uBAAeA,IAAfA,KAAKpR,UAAUoR,cAAAA,EAAWsnC,WAAW,KAArC;YAHc,GAIb,EAJH;AAKA,iBAAKgnE,YAAY,IAAjB;UAdA;QADQ;QAmBVC,cAAW;AACT,cAAK,KAAKL,eAAL,GAAL;AAGKn2E,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,WAAAA,EAAQ57C,KAAb;AACe6jB,gBAAAA;AAAf,qBAAeA,IAAfA,KAAKpR,UAAUoR,cAAAA,EAAWsnC,WAAW,IAArC;AACA,iBAAKgnE,YAAY,KAAjB;AACA,iBAAK1/G,UAAUsrE,kBAAf;UANA;QADS;QAgBXiqC,SAASH,GAAwB;AAG3B,WAACA,KAAmB,KAAKjsE,UAC3B,KAAKw2E,YAAL;QAJ6B;QAYjCC,gBAAa;AACN,eAAKP,YAAL,MAGL,KAAK/uG,SAASxU,SAAS,GACvB,KAAK+jH,eAAe,CAApB,GACA,KAAKF,YAAL;QANW;QAiBb51G,SAASmH,GAAoBwB,GAAsB;AAEjD,cAAK,KAAKkH,aAAV;AAIA,gBAAMqhC,IAA4BhzD,qEAChC,KAAK+X,WACLkR,CAFqB;AAMjBqB,gBAAuBvqB;cAC3BizD;cACA,IAAIvwC,uCAAK8vC,uCAHImkE,8CAAcC,0CAG3B;cACAjkE;cACAC;cACA1pC;cACA,KAAKlR;YANW;AAcZk7C,gBAA0BhzD,6DAC9BqqB,GACAqoC,iDAPuBK,EAAenpC,aAENC,6DAAiBC,MAClCa,0DAAcknC,OACdlnC,0DAAcC,IAK7BJ,CAJmB;AAOrB,iBAAK1I,MAAMkxC,EAAalxC;AACxB,iBAAKC,OAAOixC,EAAajxC;AACpB4qB,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,aAAAA,EAAUpyB,aACb,aACA,eAAe,KAAKwH,OAAO,MAAM,KAAKD,MAAM,GAF9C;UAjCA;QAFiD;QAgDnD03B,uBAAoB;AAGlB,iBAAO,IAAI71B;YAAK,KAAK7B;YAFN,KAAKA,MAAM20G,8CAAcC;YAEN,KAAK30G;YADzB,KAAKA,OAAOuwC;UACnB;QAHW;QAaX63D,gBAAa;AACpB,cAAI,CAAC,KAAKx9E;AACR,mBAAO;AAGT,cAAMirF,IAAY,KAAKjrF,SAAS1pB,sBAAd;AAClB,gBAAMnB,IAAM81G,EAAU91G,MAAM80G,6CAAaiB;AAEnC91G,cAAO61G,EAAU71G,OAAO40G,8CAAckB;AAE5C,iBAAO,IAAIl0G;YAAK7B;YAHDA,IAAM40G,6CAAaD,8CAAc,IAAIoB;YAGvB91G;YADfA,IAAOuwC,wCAAQ,IAAIulE;UAC1B;QAVa;QAmBbpC,WAAWD,GAAwB;AAC1C,eAAK0B,WAAW,KAAKpB,YAArB;QAD0C;QASnCJ,WAAWF,GAAwB;AAC1C,eAAK0B,WAAW,KAAhB;QAD0C;QAUnCvB,OAAOH,GAAwB;AACtC1hH,qBAAW,KAAKojH,WAAWt6H,KAAK,MAAM,KAA3B,GAAmC,GAA9C;QADsC;QAUxCs6H,WAAW3/G,GAAc;AACnB,eAAK2+G,cAAc3+G,MAGnB,KAAK6+G,WACPx6G,aAAa,KAAKw6G,OAAlB,GAEF,KAAKF,YAAY3+G,GACjB,KAAK0/G,WAAL;QARuB;QAYjBA,aAAU;AAChB,gBAAMa,IAASC;AAEf,cAAMh+D,IAAQ,KAAK+9D,IAAS;AAC5B,eAAKxB,WAAW,KAAKJ,YAAYn8D,IAAQ,CAACA;AAC1C,eAAKu8D,UAAU7xG,KAAKC,IAAID,KAAKE,IAAI,KAAK2xG,SAAS,KAAKH,WAA5B,GAA0C,CAAnD;AAEf,eAAK6B,YAAY,KAAK1B,UAAU2B,6CAAhC;AAGMp+F,cAAUq+F,8CAAc,KAAK5B,WAAW6B,8CAAcD;AACxD,eAAKvrF,aACP,KAAKA,SAASjsB,MAAMmZ,UAAU,GAAGA,CAAH;AAG5B,eAAKy8F,UAAU,KAAKH,eAA8B,IAAf,KAAKG,YAC1C,KAAKF,UAAUtiH,WACb,KAAKmjH,WAAWr6H,KAAK,IAArB,GACAw7H,mDAAmBN,CAFN;QAhBD;QA4BVE,YAAYK,GAAgB;AAClC,gBAAMC,IACJ,KAAKxgH,UAAUu/D,oBAA4BptD,8CAASE,SACnD,KAAKrS,UAAUoS,oBAAoB,KAAKpS,UAAU0R;AAChD6sG,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,WAAAA,EAAQ97G,aACX,aACA,aACG+9G,IAAc,CAACD,IAAWA,KAC3B,OACCC,IAAc,IAAIhmE,wCAAQ,KAC3B,OACCokE,6CAAa,KACd,GARJ;QAJkC;QAuB5BiB,eAAeY,GAAc;AACnC,eAAKpC,cAAcoC;AACd,eAAKrC,aACR,KAAK8B,YAAYO,IAASN,6CAA1B;QAHiC;QAWrCO,WAAQ;AACN,eAAKtB,WAAW,KAAhB;QADM;QAKRJ,QAAK;AACE,eAAKK,YAAL,KAAsB,CAAA,KAAKr/G,UAAUgB,WAAf,KAG3B,KAAKu+G,WAAL;QAJG;QAYGG,YAAYiB,GAAqB;AACjCvkE,cAAU,KAAgB74D,wCAAe+rD,iDAA1B,GACnBqxE,GACA,KAAK3gH,UAAUF,EAFD;AAILhd,mDAAKs5D,CAAhB;QALuC;QAajC2iE,2BAA2B9iH,GAAe;AAC5C,WAAC,KAAKqjH,eAAL,KAAyB,KAAKD,YAAL,KAE5BpjH,EAAE6yB,gBAAF;QAH8C;QAU1CmwF,YAAS;AACX,eAAKI,YAAL,KACF,KAAKD,WAAW,IAAhB;QAFa;QAUTF,WAAQ;AAGd,eAAKE,WAAW,KAAhB;QAHc;QAYRV,SAAS/iH,GAAe;AAC9B,cACE,EAA8C,KAA9C,KAAKqE,UAAU/E,QAAQokE,uBACvB1jE,EAAMlC,SAAoB6kC,EAAAA,8CAKxB3iC,EAAMlC,SAAoB6kC,EAAAA,8CADV3iC,EACuC8xF,YAAW;AACpE,gBAAI,CAFc9xF,EAED+xF;AACf,oBAAU3zF,MAAM,mDAAV;AAEF6mH,gBAAch4D,KAAKC,UACvB,KAAKg4D,eANWllH,EAMgB+xF,OAAhC,CADkB;AAGpB,gBAAI,CAAA,KAAKp9E,SAASlD,SAASwzG,CAAvB,GAAJ;AAIA,mBADA,KAAKtwG,SAASnR,QAAQyhH,CAAtB,GAEE,KAAKtwG,SAASxU,SAAS,KAAKkE,UAAU/E,QAAQokE;AAE9C,qBAAK/uD,SAASxL,IAAd;AAGF,mBAAK+6G,eAAeiB,oDAApB;YAVA;UAPoE;QARxC;QAqCxBD,eAAe9gH,GAAkB;AASvCghH,mBAASA,EAAShhH,GAAkB;AAClC,gBAAKA,GAAL;AAIA,qBAAOA,EAAA;qBACAA,EAAA;AACP,qBAAOA,EAAA;AACP,qBAAOA,EAAA;AACP,qBAAOA,EAAA;AAEP,kBAAIA,EAAA,SAAiBA,EAAA,MAAA,SAA0B;AAC7C,oBAAMia,IAAUja,EAAA,MAAA;AAChB,uBAAOia,EAAA;AACP,uBAAOA,EAAA;AACP,uBAAOA,EAAA;cAJsC;AAOzC6D,kBAAS9d,EAAA;AACf,uBAAWrG,KAAQmkB,GAAQ;AACzB,oBAAMF,IAAQE,EAAOnkB,CAAP;AACd,sBAAM7K,IAAQ8uB,EAAA;AACRM,oBAASN,EAAA;AACX9uB,qBACFkyH,EAASlyH,CAAT;AAEEovB,qBACF8iG,EAAS9iG,CAAT;cARuB;AAWvBle,gBAAA,SACI2zB,IAAO3zB,EAAA,MACPlR,IAAQ6kC,EAAA,OACRzV,IAASyV,EAAA,QACX7kC,KACFkyH,EAASlyH,CAAT,GAEEovB,KACF8iG,EAAS9iG,CAAT;YArCJ;UADkC;AAPpCle,cAAO6oD,KAAKt5D,MAAMs5D,KAAKC,UAAU9oD,CAAf,CAAX;AAkDPghH,YAAShhH,CAAT;AAMA,iBAJ6B,OAAA,OAAA,CAAA,GAAA,EAC3B,MAAQ,QADmB,GAExBA,CAFwBihH;QAtDU;MAplBrC,GAmpBAxmE,wCAAQ,IAGRmkE,8CAAc,IAGdC,6CAAa,IAGbhkE,kDAAkB,IAGlBD,oDAAoB,IAGpBolE,iDAAiB,IAGjBlB,8CAAc,GAGdC,6CAAa,IAMbgC,uDAAuB,KAGvBR,mDAAmB,IAGnBL,mDAAmB,GAGnBG,8CAAc,KAGdC,8CAAc,KAMdF,gDAAgB,IA5uBtBpxE,iCAAA,CAAA;AA4CaovE,qCAAAA,WAAAA;ACrBP,UAAO76E,4DAAP,MAAA;QAUJ/iB,cAAA;AANQ,eAAA0gG,YAAY,oBAAIzuE;AAGhB,eAAA0uE,SAAS,oBAAI1uE;AAInB,eAAKgf,MAAL;QADF;QAKAA,QAAK;AACH,eAAKyvD,UAAUtvF,MAAf;AACA,eAAKuvF,OAAOvvF,MAAZ;QAFG;QAaLzvC,SAASi/H,GAA4BvnH,GAA4B;AAE/D,cAD2B,KAAKqnH,UAAU19H,IAAI49H,EAASznH,IAA5B0nH,KACD,CAACxnH;AACzB,kBAAUG,MAAM,mBAAmBonH,EAASznH,IAA5B,mBAAV;AAER,eAAKunH,UAAUnoG,IAAIqoG,EAASznH,MAAMynH,CAAlC;AAGA,eADMv9E,IAAWu9E,EAASv9E,aACQ,IAAlBA,EAAS9nC;AACvB,qBAASM,IAAI,GAAGA,IAAIwnC,EAAS9nC,QAAQM;AACnC,mBAAKilH,cACHz9E,EAASxnC,CAAT,GACA+kH,EAASznH,MACT,CAAC,CAACynH,EAASG,cAHb;QAV2D;QA0BjEl/H,WAAWm/H,GAAoB;AAG7B,cAAI,CAFa,KAAKN,UAAU19H,IAAIg+H,CAAnBJ;AAIf,mBADAzmH,QAAQxG,KAAK,4BAA4BqtH,CAA5B,cAAb,GACO;AAGT,eAAKC,qBAAqBD,CAA1B;AAEA,eAAKN,UAAUxnG,OAAO8nG,CAAtB;AACA,iBAAO;QAXsB;QA0B/BF,cACEI,GACAF,GACAG,GAA4B;AAE5BD,cAAU,GAAGA,CAAH;AACV,gBAAME,IAAgB,KAAKT,OAAO39H,IAAIk+H,CAAhB;AACtB,cAAIE,KAAiB,CAACD;AACpB,kBAAU3nH,MACR,mBAAmBwnH,CAAnB,8BAA6DI,CAA7D,GADI;AAGGA,eAAiBD,IAC1BC,EAAcxiH,QAAQoiH,CAAtB,IAEA,KAAKL,OAAOpoG,IAAI2oG,GAAS,CAACF,CAAD,CAAzB;QAX0B;QA2B9BK,iBACEH,GACAF,GACAj4B,GAAmB;AAEnB,gBAAMq4B,IAAgB,KAAKT,OAAO39H,IAAIk+H,CAAhB;AAEtB,cAAI,CAACE;AAMH,mBALKr4B,KACH5uF,QAAQxG,KACN,+BAA+BqtH,CAA/B,+BAA0EE,CAA1E,GADF,GAIK;AAGT,gBAAMI,IAAcF,EAAc5+G,QAAQw+G,CAAtB;AACpB,cAAkB,KAAdM;AAKF,mBAJAF,EAAc3kH,OAAO6kH,GAAa,CAAlC,GAC6B,MAAzBF,EAAc7lH,UAChB,KAAKolH,OAAOznG,OAAOgoG,CAAnB,GAEK;AAEJn4B,eACH5uF,QAAQxG,KACN,+BAA+BqtH,CAA/B,+BAA0EE,CAA1E,GADF;iBAIK;QA1BY;QAoCrBD,qBAAqBD,GAAoB;AACvC,qBAAWE,KAAW,KAAKP,OAAOlmH,KAAZ;AACpB,iBAAK4mH,iBAAiBH,GAASF,GAAc,IAA7C;QAFqC;QAYzCO,UAAUC,GAAoC;AAC5C,eAAKb,OAAOvvF,MAAZ;AACA,qBAAW52B,KAAOgnH;AAChB,iBAAKb,OAAOpoG,IAAI/d,GAAKgnH,EAAUhnH,CAAV,CAArB;QAH0C;QAY9CinH,YAAS;AACP,gBAAMC,IAA0C3nH,uBAAOC,OAAO,IAAd;AAChD,qBAAW,CAACQ,GAAKyL,CAAN,KAAgB,KAAK06G;AAC9Be,cAAalnH,CAAb,IAAoByL;AAEtB,iBAAOy7G;QALA;QAaTC,cAAW;AACT,gBAAMC,IACJ7nH,uBAAOC,OAAO,IAAd;AACF,qBAAW,CAACQ,GAAKyL,CAAN,KAAgB,KAAKy6G;AAC9BkB,cAAepnH,CAAf,IAAsByL;AAExB,iBAAc1T,8CAAUwH,uBAAOC,OAAO,IAAd,GAAqB4nH,CAAtC;QANE;QAgBXxqH,UAAUqI,GAAyB/D,GAAgB;AACjD,cAAMlB,IAAM,KAAKqnH,mBAAmBnmH,CAAxB;AACN0lH,cAAgB,KAAKU,0BAA0BtnH,CAA/B;AACtB,cAAI,CAAC4mH;AACH,mBAAO;mBAEAvlH,IAAI,GAAGmlH,GAAeA,IAAeI,EAAcvlH,CAAd,GAAmBA,KAAK;AACpE,kBAAM+kH,IAAW,KAAKF,UAAU19H,IAAIg+H,CAAnB;AACZJ,gBAAAA,GAA4BA;AAAjC,gBAAez9E,SAAVy9E,IAAAA,MAAUz9E,CAAVy9E,EAAUz9E,mBAAkB,SAAAy9E,IAAAA,KAAA,IAAAA,EAAUz9E,eAAe1jC,CAAzB,IAAqC;AAEhEmhH,kBAAAA,GAAsBA;AAA1B,mBAAct8G,SAAVs8G,IAAAA,KAAUt8G,IAAVs8G,EAAUt8G,cAAY,SAAAs8G,IAAAA,KAAA,IAAAA,EAAUt8G,SAAS7E,GAAW/D,GAAGklH,CAAjC;AACxB,uBAAO;YAH2D;UAFF;AAStE,iBAAO;QAf0C;QAyBnDkB,0BAA0BZ,GAAe;AACvC,iBAAO,KAAKP,OAAO39H,IAAIk+H,CAAhB,KAA4B,CAAA;QADI;QAWzCa,0BAA0Bf,GAAoB;AAC5C,gBAAMvmH,IAAO,CAAA;AACb,qBAAW,CAACymH,GAASR,CAAV,KAAwB,KAAKC;AAEpB,iBADED,EAAUl+G,QAAQw+G,CAAlBM,KAElB7mH,EAAKkB,KAAKulH,CAAV;AAGJ,iBAAOzmH;QARqC;QAiBtConH,mBAAmBnmH,GAAgB;AACzC,cAAIsmH,IAAgB;AACpB,qBAAWC,KAAYl/E,0DAAiBm/E;AAClCxmH,cAAEymH,iBAAiBF,CAAnB,MACoB,OAAlBD,MACFA,KAAiB,MAEnBA,KAAiBC;AAGC,iBAAlBD,KAAwBtmH,EAAEwlH,UAC5Bc,KAAiB,MAAMtmH,EAAEwlH,UAChBxlH,EAAEwlH,YACXc,IAAgB/nH,OAAOyB,EAAEwlH,OAAT;AAElB,iBAAOc;QAfkC;QAwBnCI,gBAAgBC,GAAqB;AAC3C,mBAASxmH,IAAI,GAAGomH,GAAWA,IAAWI,EAAUxmH,CAAV,GAAeA;AACnD,gBAAI,EAAEomH,KAAYl/E,0DAAiBm/E;AACjC,oBAAU1oH,MAAMyoH,IAAW,+BAArB;QAHiC;QAgB7Cj+E,oBAAoBk9E,GAAiBmB,GAA4B;AAC/D,cAAIL,IAAgB;AAEpB,cAAIK,GAAW;AACb,iBAAKD,gBAAgBC,CAArB;AACA,uBAAWJ,KAAYl/E,0DAAiBm/E;AAIlCG,gBAAUx1G,SAFZk2B,0DAAiBm/E,aACjBD,CADAK,CAEE,MACoB,OAAlBN,MACFA,KAAiB,MAEnBA,KAAiBC;UAVR;AAeO,iBAAlBD,KAAwBd,IAC1Bc,KAAiB,MAAMd,IACdA,MACTc,IAAgB,GAAGd,CAAH;AAElB,iBAAOc;QAvBwD;MAvS7D;AACYj/E,gEAAAC,WAAW,IAAID;AAiUjC,OAAA,SAAiBA,GAAgB;AAWnB,YAAAA,EAAAm/E,iBAAAn/E,EAAAm/E,eAAY,CAAA;AACtBA,UAAAA,EAAAK,QAAA,EAAA,IAAA;AACAL,UAAAA,EAAAM,UAAA,EAAA,IAAA;AACAN,UAAAA,EAAAO,MAAA,EAAA,IAAA;AACAP,UAAAA,EAAAQ,OAAA,EAAA,IAAA;MAf6B,GAAhB3/E,8DAAAA,4DAAgB,CAAA,EAAjC;UAzVAyL,0CAAA,CAAA;AAuBazL,8CAAAA,mBAAAA;A1JPb,UAAIN,mDAAoC,MAEpCC,oDAAwC,MAyF/BrnC,6CAAY,EACvB/E,mBAAAA,oDACAH,cAAAA,8CAFuB,GA3GzBq4C,kCAAA,CAAA;AAgHQopE,sCAAAA,cAAAA;AALKv8G,sCAAAA,YAAAA;sCA/CGjF,QAAAA;AAoDK4sC,sCAAAA,WAAAA;AChHrB,UAAAwL,8CAAA,CAAA;AA4BgBj4C,kDAAAA,aAAAA;ACHhB,UAAYkzB;AAAZ,OAAA,SAAYA,GAAK;AACfA,UAAAyZ,SAAA;AACAzZ,UAAAga,SAAA;AACAha,UAAA+a,OAAA;AACA/a,UAAAub,MAAA;AACAvb,UAAA6b,QAAA;AACA7b,UAAAsc,OAAA;AACAtc,UAAA+c,OAAA;MAPe,GAAL/c,gDAAAA,8CAAK,CAAA,EAAjB;AAmEA,UAAIkZ,iDAA6B,MAC7B8B,sDAAqC,MACrCC,mDAAgC;AAmPpC3tC,qEAAA;UAjVAy3C,uCAAA,CAAA;AAyBY/kB,2CAAAA,QAAAA;AA0EI/yB,2CAAAA,eAAAA;AAgDAC,2CAAAA,cAAAA;AAoLAI,2CAAAA,2BAAAA;2CA7QAN,iBAAAA;AApBAD,2CAAAA,iBAAAA;AAwKAI,2CAAAA,gBAAAA;AAgFAE,2CAAAA,eAAAA;AAhCAD,2CAAAA,eAAAA;ACvJV,UAAO8rH,sEAAP,MAAA;QAkBJ3iG,YACmB2mB,GACAC,GAA8D;AAD9D,eAAAD,sBAAAA;AACA,eAAAC,sBAAAA;AAfZ,eAAAK,WAAsB8b;QAeoD;QAIjFj5D,KAAK2V,GAAoB;AACjB3V,cAAO2V,EACV4W,gBADU,EAEVC,cAFU,EAGVna,IAAKsqC,OAASzvC,8DAAcyvC,CAAd,CAHJ;AAIb,iBAAO38C,EAAKyR,SAASzR,IAAO;QALL;QAYzBoN,KAAKgI,GAAgBO,GAAoB;AACvC,gBAAMtD,IAAMsD,EAAU4W,gBAAV;AACZ,qBAAWusG,KAAa1jH;AACtB/C,cAAIyL,IACF3Q;cACE,KAAK0vC;cACL,KAAKC;cACLg8E;cACAnjH;YAJF,CADF;QAHqC;QAezC2xB,MAAM3xB,GAAoB;AACxBA,YAAU4W,gBAAV,EAA4B+a,MAA5B;QADwB;MAnDtB,GAvGNod,iDAAA,CAAA;AAuGam0E,qDAAAA,sBAAAA;AArBG1rH,qDAAAA,gBAAAA;AAVAD,qDAAAA,gBAAAA;AwJ9CV,UAAO6rH,oEAAP,MAAA;QAIJ7iG,cAAA;AAEE,eAAKinB,WAAsB6b;QAF7B;QAYAh5D,KAAK2V,GAAoB;AACvB,gBAAMqjH,IAAiB,CAAA;AACvB,qBAAWnvG,KAAYlU,EAAU0W,gBAAV;AACfjX,gBAAQ,EACZ,MAAQyU,EAASxa,MACjB,IAAMwa,EAASC,MAAT,EAFM,GAIVD,EAASza,SACVgG,EAAA,OAAuCyU,EAASza,OAEnD4pH,EAAennH,KAAKuD,CAApB;AAIF,iBACE4jH,EAAevnH,SAASunH,IAAiB;QAfpB;QA0BzB5rH,KAAKgI,GAAgBO,GAAoB;AACvC,qBAAWsjH,KAAY7jH;AACrBO,cAAUtW,eACR45H,EAAA,MACAA,EAAA,MACAA,EAAA,EAHF;QAFqC;QAezC3xF,MAAM3xB,GAAoB;AACxBA,YAAUyW,eAAV,EAA2Bkb,MAA3B;QADwB;MAzDtB;AA8DgBzvC,6DAAS,aAAa,IAAIkhI,mEAAhD;UAxFAr0E,gDAAA,CAAA;AA0Baq0E,oDAAAA,qBAAAA;AvJ1Bb,UAAAr0E,iDAAA,CAAA;AA4CgBt3C,qDAAAA,OAAAA;AAtBApN,qDAAAA,OAAAA;AwJtBhB,UAAA0kD,sCAAA,EAsBEzrC,QAAAA,4CACAgzE,YAAAA,gDACAitC,YAAAA,gDACAzsG,YAAAA,gDACAysB,UAAAA,8CACAxvB,WAAAA,+CAEAyvG,mBAAAA,wDADAriH,YAAAA,+CA5BF;ACuBM,UAAOmpC,sDAAP,MAAA;QAgBJ/pB,YACUvgB,GACRyjH,GACAC,GACAruE,GACAC,GAAmB;AAJX,eAAAt1C,YAAAA;AAXF,eAAA2jH,kBAHR,KAAAC,UADA,KAAAC,UADA,KAAAC,UAA4B;AAsB1BL,cAAkC3mH,WAAlB2mH,IAA8B,OAAOA;AACrDC,cAA8B5mH,WAAhB4mH,IAA4B,OAAOA;AACjD,gBAAMK,IAASN,KAAiBC;AAE5BD,gBACF,KAAKK,UAAU,IAAInyG,2CACjB3R,GACA,MACA+jH,GACA1uE,GACAC,CALa;AAQbouE,gBACF,KAAKG,UAAU,IAAIlyG,2CACjB3R,GACA,OACA+jH,GACA1uE,GACAC,CALa;AASbyuE,gBACF,KAAKH,UAAct+H,kDAAiBqwC,qCAAIof,MAAM;YAC5C,QAAUpjC,2CAAUC;YACpB,OAASD,2CAAUC;YACnB,SAAS;UAHmC,CAA/B,GAKXhsB,6CAAY,KAAKg+H,SAAS5jH,EAAUimE,gBAAV,CAA9B;QA/BiB;QAuCrBr3E,UAAO;AACDjJ,sDAAW,KAAKi+H,OAApB;AAEA,eAAKD,kBADL,KAAKC,UAAU;AAEX,eAAKE,YACP,KAAKA,QAAQl1H,QAAb,GACA,KAAKk1H,UAAU;AAEb,eAAKD,YACP,KAAKA,QAAQj1H,QAAb,GACA,KAAKi1H,UAAU;QAVZ;QAkBPlhH,SAAM;AAEJ,gBAAM+0C,IAAc,KAAK13C,UAAU23C,WAAf;AACpB,cAAKD,GAAL;AAMA,gBAAIssE,IAAU,OACVC,IAAU;AAEX,iBAAKN,mBACN,KAAKA,gBAAgB1rE,cAAcP,EAAYO,aAC/C,KAAK0rE,gBAAgBzrE,eAAeR,EAAYQ,cAChD,KAAKyrE,gBAAgBvrE,gBAAgBV,EAAYU,eACjD,KAAKurE,gBAAgBxrE,iBAAiBT,EAAYS,gBAQ/C,KAAKwrE,mBACN,KAAKA,gBAAgBlrE,gBAAgBf,EAAYe,eACjD,KAAKkrE,gBAAgB7kH,aAAa44C,EAAY54C,YAC9C,KAAK6kH,gBAAgBp4G,eAAemsC,EAAYnsC,eAEhDy4G,IAAU,OAGT,KAAKL,mBACN,KAAKA,gBAAgB3qE,iBAAiBtB,EAAYsB,gBAClD,KAAK2qE,gBAAgB9kH,YAAY64C,EAAY74C,WAC7C,KAAK8kH,gBAAgBl4G,cAAcisC,EAAYjsC,cAE/Cw4G,IAAU,SAjBZA,IADAD,IAAU;AAsBZ,gBAAIA,KAAWC,GAAS;AACtB,kBAAI;AACS7kH,kBAAAA,4CAAX,GACI,KAAK0kH,WAAWE,KAClB,KAAKF,QAAQnhH,OAAO+0C,CAApB,GAEE,KAAKmsE,WAAWI,KAClB,KAAKJ,QAAQlhH,OAAO+0C,CAApB;cANA,UAAJ;AASap4C,kBAAAA,2CAAX;cADQ;AAGV,mBAAKU,UAAU8xG,6BAAf;YAZsB;AAexB,gBAAI,KAAKgS,WAAW,KAAKD,SAAS;AAEhC,kBACE,CAAC,KAAKF,mBACN,KAAKA,gBAAgB1rE,cAAcP,EAAYO,aAC/C,KAAK0rE,gBAAgBxrE,iBAAiBT,EAAYS,cAClD;AACKyrE,oBAAAA;AAAL,yBAAKA,IAALA,KAAKA,YAAAA,EAASnhH,aAAa,KAAKjI,OAAO,KAAKqpH,QAAQ95G,SAASpE,CAA7B,CAAhC;cADA;AAGF,kBACE,CAAC,KAAKg+G,mBACN,KAAKA,gBAAgBzrE,eAAeR,EAAYQ,cAChD,KAAKyrE,gBAAgBvrE,gBAAgBV,EAAYU,aACjD;AACKwrE,oBAAAA;AAAL,yBAAKA,IAALA,KAAKA,YAAAA,EAASnhH,aAAa,KAAKjI,OAAO,KAAKspH,QAAQ/5G,SAASlE,CAA7B,CAAhC;cADA;YAb8B;AAmBlC,iBAAK89G,kBAAkBjsE;UAxEvB;QAHI;QAmFNzlC,wBAAqB;AACnB,iBAAO,CAAC,CAAC,KAAK6xG;QADK;QASrBzyG,sBAAmB;AACjB,iBAAO,CAAC,CAAC,KAAKwyG;QADG;QAcnB/pE,UAAUn0C,GAAWE,GAAS;AACxB,eAAKi+G,WACP,KAAKA,QAAQhqE,UAAUn0C,GAAGE,CAA1B;AAEE,eAAKg+G,WACP,KAAKA,QAAQ/pE,UAAUn0C,GAAGE,CAA1B;QAL0B;QAkB9BiT,IAAInT,GAAWE,GAAWkyC,GAAsB;AAO1C,eAAK+rE,WACP,KAAKA,QAAQhrG,IAAInT,GAAG,KAApB;AAEE,eAAKk+G,WACP,KAAKA,QAAQ/qG,IAAIjT,GAAG,KAApB;AAGF,cAAIkyC,KAAmCj7C,WAAlBi7C;AAEby9D,gBAAoC,CAAA,GACtC,KAAKsO,YACPtO,EAAQ7vG,IAAI,KAAKm+G,QAAQjqE,UAAb,IAEV,KAAKgqE,YACPrO,EAAQ3vG,IAAI,KAAKg+G,QAAQhqE,UAAb,IAEd,KAAK75C,UAAUuqC,WAAWirE,CAA1B;QAvB4C;QAiChD0O,KAAKv+G,GAAS;AACR,eAAKm+G,WACP,KAAKA,QAAQhrG,IAAInT,GAAG,IAApB;QAFU;QAYdw+G,KAAKt+G,GAAS;AACR,eAAKg+G,WACP,KAAKA,QAAQ/qG,IAAIjT,GAAG,IAApB;QAFU;QAWdozC,oBAAoBtxB,GAAgB;AAC9B,eAAKm8F,WACP,KAAKA,QAAQ7qE,oBAAoBtxB,CAAjC;AAEE,eAAKk8F,WACP,KAAKA,QAAQ5qE,oBAAoBtxB,CAAjC;QALgC;QAepCt6B,YAAS;AACP,cAAIA,IAAY;AACZ,eAAKy2H,YACPz2H,IAAY,KAAKy2H,QAAQz2H,UAAb;AAEV,eAAKw2H,YACPx2H,IAAYA,KAAa,KAAKw2H,QAAQx2H,UAAb;AAE3B,iBAAOA;QARA;QAgBTqrD,WAAW/wB,GAAgB;AACrB,eAAKm8F,WAAS,KAAKA,QAAQ1qE,mBAAmBzxB,CAAhC;AACd,eAAKk8F,WAAS,KAAKA,QAAQzqE,mBAAmBzxB,CAAhC;QAFO;QAY3B6sF,cAAc98D,GAAoB;AAC5B,eAAKosE,WACP,KAAKA,QAAQxrE,wBAAwBZ,CAArC;AAEE,eAAKmsE,WACP,KAAKA,QAAQ9qE,sBAAsBrB,CAAnC;QAL8B;QAgBlC68D,WAAW78D,GAAoB;AACzB,eAAKosE,WACP,KAAKA,QAAQzrE,qBAAqBX,CAAlC;AAEE,eAAKmsE,WACP,KAAKA,QAAQ/qE,mBAAmBpB,CAAhC;QAL2B;MA7T3B,GAvBN3I,uCAAA,CAAA;AAuBazE,2CAAAA,gBAAAA;ACEP,UAAO85E,wDAAP,MAAA;QAKJ7jG,YAAYvgB,GAAuB;AACjC,eAAKqkH,aAAarkH;QADe;QAYzBskH,iBAAiB/gH,GAA+B;AACxD,cAAIlB,IAAQ,GACRE,IAAS;AACTgB,gBACFlB,IAAQkB,EAAK6W,SAAL,GACR7X,IAASgB,EAAK2xC,UAAL;AAEX,iBAAO,IAAIxqC,uCAAKrI,GAAOE,CAAhB;QAPiD;QAqB1DgiH,iBAAiB/S,GAAiB;AAC1BgT,cAAmB,KAAKF,iBAC5B,KAAKD,WAAWr6E,UAAUwnE,CAA1B,CADuB;AAGzB,iBAAO,EACLnvG,OAAOmiH,EAAiBniH,OACxBE,QAAQiiH,EAAiBjiH,QACzBwH,UAAU,KAAKs6G,WAAW9kD,gBAHrB;QAJyB;QAmBlCklD,oBAAiB;AACf,gBAAMC,IAAoB,KAAKJ,iBAC7B,KAAKD,WAAWt6E,WAAhB,CADwB;AAI1B,iBAAO,EACL1nC,OAAOqiH,EAAkBriH,OACzBE,QAAQmiH,EAAkBniH,QAC1BwH,UAAU,KAAKs6G,WAAW9kD,gBAHrB;QALQ;QAkBjBolD,gBAAa;AACX,iBAAO,KAAKN,WAAWpiH,uBAAhB;QADI;QAWb2iH,qBAAkB;AAChB,cAAIzsE,IAAe,GACfC,IAAc;AAElB,gBAAMlmC,IAAiB,KAAKuyG,kBAAL,GACjBI,IAAgB,KAAKN,iBAAL,GAChBO,IAAiB,CAAC,CAAC,KAAKT,WAAWt6E,WAAhB;AACF,cAAA;AAAvB,gBAAMg7E,IAAgB,EAA8B3pD,SAA7BA,IAAAA,KAAKipD,WAAWr6E,UAAhBoxB,KAA6BA,IAA7BA,EAA6BA;AAC9CmE,cAAkBulD,IACpB5yG,EAAenI,WACf86G,EAAc96G;AAGlB,gBAAMi7G,IAAQzlD,MAAiCptD,8CAASH;AADzCutD,gBAAiCptD,8CAASX,SAGnDszG,MAAgB3sE,KAAgBjmC,EAAe7P,QAC/C0iH,MAAe5sE,KAAgB0sE,EAAcxiH;AAE/C2iH,gBACEF,MAAgB1sE,KAAelmC,EAAe3P,SAC9CwiH,MAAe3sE,KAAeysE,EAActiH;AAGlD,iBAAO,EACLyH,KAAKouC,GACLnuC,MAAMkuC,EAFD;QAvBS;QAsClBrS,eAAem/E,GAAqC;AAC5ClmH,cAAQkmH,IAA8B,KAAKZ,WAAWtlH,QAAQ;AACpE,gBAAMmmH,IAAa,KAAKP,cAAL,GACbzyG,IAAiB,KAAKuyG,kBAAL,GACjBI,IAAgB,KAAKN,iBAAL,GAChBO,IAAiB,CAAC,CAAC,KAAKT,WAAWt6E,WAAhB;AACF,cAAA;AAAvB,gBAAMg7E,IAAgB,EAA8B3pD,SAA7BA,IAAAA,KAAKipD,WAAWr6E,UAAhBoxB,KAA6BA,IAA7BA,EAA6BA;AAC9CmE,cAAkBulD,IACpB5yG,EAAenI,WACf86G,EAAc96G;AAKlB,gBAAMo7G,IACJ5lD,MAAiCptD,8CAASX,QAC1C+tD,MAAiCptD,8CAASE;AAC5C,cALEktD,MAAiCptD,8CAASH,OAC1CutD,MAAiCptD,8CAASG;AAKtCwyG,kBAAgBI,EAAW3iH,UAAU2P,EAAe3P,SACpDwiH,MAAeG,EAAW3iH,UAAUsiH,EAActiH;AAEpD4iH,gBACEL,MAAgBI,EAAW7iH,SAAS6P,EAAe7P,QACnD0iH,MAAeG,EAAW7iH,SAASwiH,EAAcxiH;AAEvD,iBAAO,EACLE,QAAQ2iH,EAAW3iH,SAASxD,GAC5BsD,OAAO6iH,EAAW7iH,QAAQtD,GAC1BiL,KAAK,CAAC,KAAKq6G,WAAW56F,UAAU1qB,GAChCkL,MAAM,CAAC,KAAKo6G,WAAW16F,UAAU5qB,EAJ5B;QAzB2C;QA0CpDqmH,kBAAkBH,GAAqC;AAC/ClmH,cAAQkmH,IAA8B,IAAI,KAAKZ,WAAWtlH;AAEhE,gBAAMsmH,IAAW,KAAKhB,WAAW7xF,qBAAhB;AAEjB,iBAAO,EACLjwB,SAAS8iH,EAASz5G,SAASy5G,EAASr7G,OAAOjL,GAC3CsD,QAAQgjH,EAAS15G,QAAQ05G,EAASp7G,QAAQlL,GAC1CiL,KAAKq7G,EAASr7G,MAAMjL,GACpBkL,MAAMo7G,EAASp7G,OAAOlL,EAJjB;QAL8C;QAmBvDkjC,gBAAa;AAEX,iBACE,CAAC,KAAKoiF,WAAWxuD,sBAAhB,KACD,CAAC,KAAKwuD,WAAWtuD,oBAAhB;QAJQ;QAgBHuvD,uBACRC,GAAiC;AAEjC,cAAI,CAAC,KAAKtjF,cAAL;AAEH,mBAAO,CAAA;AAGT,gBAAMujF,IAAiB,KAAKnB,WAAWxuD,sBAAhB,GACjB4vD,IAAiB,KAAKpB,WAAWtuD,oBAAhB;cAEHwvD,KAAmB,KAAKz/E,eAAe,KAApB;AAEvC,gBAAM4/E,IAAQ,CAAA;AACTD,gBACHC,EAAM17G,MAAM6H,EAAY7H,KACxB07G,EAAM95G,SAASiG,EAAY7H,MAAM6H,EAAYtP;AAE1CijH,gBACHE,EAAMz7G,OAAO4H,EAAY5H,MACzBy7G,EAAM/5G,QAAQkG,EAAY5H,OAAO4H,EAAYxP;AAE/C,iBAAOqjH;QArB0B;QA+BzBC,kBACR9zG,GACA+zG,GAA+B;AAE/B,gBAAMC,IAAgBD,EAAe57G,MAAM47G,EAAerjH,QACpDujH,IAAeF,EAAe37G,OAAO27G,EAAevjH,OAEpD41C,IAAYpmC,EAAYxP;AACxB61C,cAAarmC,EAAYtP;AAC/B,gBAAMwjH,IAAY9tE,IAAY,GACxBkX,IAAajX,IAAa;AAqBhC,iBAAO,EAACluC,KAjBI2C,KAAKC,IACfg5G,EAAe57G,MAAMmlD,GACrB02D,IAAgB3tE,CAFNluC,GAiBC4B,QATEe,KAAKE,IAClBg5G,IAAgB12D,GAChBy2D,EAAe57G,MAAMkuC,CAFRtsC,GASM3B,MAbR0C,KAAKC,IAChBg5G,EAAe37G,OAAO87G,GACtBD,IAAe7tE,CAFJhuC,GAac0B,OALbgB,KAAKE,IACjBi5G,IAAeC,GACfH,EAAe37G,OAAOguC,CAFVtsC,EAKP;QA7BwB;QA6CjCy2B,iBACE6iF,GACAM,GACAS,GAAoC;AAE9BjnH,cAAQkmH,IAA8B,KAAKZ,WAAWtlH,QAAQ;AAC9D8S,cAAc0zG,KAAmB,KAAKz/E,eAAe,KAApB;AACvC,cAAM8/E,IAAiBI,KAAsB,KAAKZ,kBAAL;AACvCa,cAAa,KAAKX,uBAAuBzzG,CAA5B;cAGG,KAAK8zG,kBAAkB9zG,GAAa+zG,CAApC;AAGhB57G,cACelN,WAAnBmpH,EAAWj8G,MAAoBi8G,EAAWj8G,MAAMk8G,EAAcl8G;AAChE,gBAAMC,IACgBnN,WAApBmpH,EAAWh8G,OAAqBg8G,EAAWh8G,OAAOi8G,EAAcj8G;AAQlE,iBAAO,EACLD,KAAKA,IAAMjL,GACXkL,MAAMA,IAAOlL,GACbsD,SALqBvF,WAArBmpH,EAAWt6G,QAAsBs6G,EAAWt6G,QAAQu6G,EAAcv6G,SAKlD1B,KAAQlL,GACxBwD,UAVsBzF,WAAtBmpH,EAAWr6G,SACPq6G,EAAWr6G,SACXs6G,EAAct6G,UAQA5B,KAAOjL,EAJpB;QAtB6B;QAmCtC4yG,eAAY;AACV,iBAAO,EACL9/F,aAAa,KAAKi0B,eAAL,GACbr0B,iBAAiB,KAAKmzG,mBAAL,GACjB1yG,gBAAgB,KAAKuyG,kBAAL,EAHX;QADG;QA2CZ9sE,aAAU;AACR,gBAAMzlC,IAAiB,KAAKuyG,kBAAL,GACjBI,IAAgB,KAAKN,iBAAiB,IAAtB,GAChBW,IAAa,KAAKP,cAAL,GACblzG,IAAkB,KAAKmzG,mBAAL,GAClB/yG,IAAc,KAAKi0B,eAAL,GACd8/E,IAAiB,KAAKR,kBAAL,GACjBe,IAAgB,KAAK/jF,iBACzB,OACAvwB,GACA+zG,CAHoB;AAMtB,iBAAO,EACLQ,eAAeR,EAAerjH,QAC9BqsD,cAAcg3D,EAAevjH,OAC7BgkH,YAAYT,EAAe57G,KAC3Bs8G,aAAaV,EAAe37G,MAE5B+uC,cAAcmtE,EAAc5jH,QAC5Bk2C,aAAa0tE,EAAc9jH,OAC3BoJ,WAAW06G,EAAcn8G,KACzBuB,YAAY46G,EAAcl8G,MAE1BiuC,YAAYrmC,EAAYtP,QACxB01C,WAAWpmC,EAAYxP,OACvBxD,SAASgT,EAAY7H,KACrBlL,UAAU+S,EAAY5H,MAEtBmuC,aAAa3mC,EAAgBzH,KAC7BmuC,cAAc1mC,EAAgBxH,MAE9BupG,WAAW0R,EAAW3iH,QACtBgxG,UAAU2R,EAAW7iH,OAErBkkH,cAAcr0G,EAAe7P,OAC7BmkH,eAAet0G,EAAe3P,QAC9Bg9D,iBAAiBrtD,EAAenI,UAEhC8iE,aAAag4C,EAAcxiH,OAC3BokH,cAAc5B,EAActiH,OA3BvB;QAbC;MAzWN;+CAycK1I,qCAAKg1C,iBACLzzC,yCACTgpH,qDAHF;AAjeA,UAAAr1E,wCAAA,CAAA;AAyBaq1E,4CAAAA,iBAAAA;ACGP,mBAAatzE,eAChBA,WAAA,UAAgC,EAAC,KAAO/6B,0BAAR;AA7BnC,UAAAg5B,6BAAA,CAAA;ACiCM,UAAO4vC,oEAAP,cAAgC+nC,mEAAhC;QAwHJnmG,cAAA;AACE,gBAAA;AAxHF,eAAAomG,YAAY;AAGH,eAAArmC,gBAAgB;AAKzB,eAAAsmC,gBAAgB;AAIP,eAAAjnC,qBAFA,KAAAD,sBAAsB;AAGtB,eAAAF,mBAAmB;AAEnB,eAAAC,kBAAkB;AAElB,eAAAuB,SAAS,EAAC6lC,WAAW,GAAGC,OAAO,GAAGC,QAAQ,GAAG9lC,QAAQ,GAAGC,OAAO,EAAtD;AASlB,eAAA8lC,yBAAmE;YACjE,GAAG,EAED,GAAG,IAAI,KAAKL,WACZ,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,UALX;YAOH,GAAG,EAED,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,UALX;YAOH,GAAG,EAED,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,WACZ,GAAG,IAAI,KAAKA,UALX;UAf8D;AAwB1D,eAAA9lC,oBAAoB;AAEpB,eAAA/xB,wBAAwB;AAExB,eAAAC,wBACP;AASO,eAAA+wB,0BAFA,KAAAC,6BADA,KAAA9c,2BAFA,KAAAS,8BAFA,KAAAN,uCAAuC;AAWhD,eAAA6jD,uBAAuB;eAGvBC,qBAAqB;AAGrB,eAAAC,0BAA0B;AAG1B,eAAAC,wBAAwB;AAMxB,eAAAC,uBAAuB;AAKf,eAAAC,qBAAwC;AAMhD,eAAAC,0BAA0B;AAuB1B,eAAAC,UANA,KAAAC,UANA,KAAAZ,YANQ,KAAAa,wBAA2C;AAuBjD,eAAK9oC,gBAAgB,KAAK+nC;AAE1B,eAAKxqC,iBAAiB,IAAI,KAAKwqC;AAE/B,eAAK9nC,uBAAuB,IAAI,KAAK8nC;AAErC,eAAK7nC,gBAAgB,IAAI,KAAK6nC;AAE9B,eAAK9oC,gBAAgB,IAAI,KAAK8oC;AAE9B,eAAKznC,cAAc,IAAI,KAAKynC;AAE5B,eAAKxnC,eAAe,IAAI,KAAKwnC;eAIxBzpC,+BAFL,KAAKpD,oBAAoB,IAAI,KAAK6sC;AAIlC,eAAKvnC,kBAAkB,IAAI,KAAKunC;AAEhC,eAAKt/C,mBAAmB,KAAK,KAAKs/C;AAElC,eAAK1pC,+BAA+B,IAAI,KAAK0pC;AAE7C,eAAKrlC,qBAAqB,KAAKzD;AAE/B,eAAK0D,wCAAwC,KAAKzC;AAElD,eAAK0C,wBAAwB,KAAK3D;AAElC,eAAK4D,wCAAwC,IAAI,KAAKklC;AAEtD,eAAK3pC,0BAA0B,CAAC,KAAKmC;AAGrC,eAAKwoC,mCAAmC,KAAK,KAAKhB;AAElD,eAAKrnC,+BAA+B,IAAI,KAAKqnC;AAE7C,eAAK5pC,6BAA6B,IAAI,KAAK4pC;AAE3C,eAAK7pC,4BAA4B,IAAI,KAAK6pC;AAE1C,eAAKtlC,yBAAyB,IAAI,KAAKslC;AAEvC,eAAKvlC,gCAAgC,IAAI,KAAKulC;AAE9C,eAAKnmC,kBAAkB,KAAK,KAAKmmC;AAEjC,eAAK93D,sBAAsB,IAAI,KAAK83D;AAEpC,eAAK/5D,2BAA2B,KAAKixB;AAErC,eAAKrvB,8BAA8B,IAAI,KAAKm4D;AAE5C,eAAK/mC,8BAA8B,QAAQ,KAAK+mC;AAEhD,eAAK33D,2BAA2B,IAAI,KAAK23D;AAEzC,eAAK7hD,oCAAoC,IAAI,KAAK6hD;AAElD,eAAKthD,mCAAmC,KAAK7W;AAE7C,eAAKwxB,6BAA6B,IAAI,KAAK2mC;AAE3C,eAAKhlC,8BAA8B,IAAI,KAAKglC;AAE5C,eAAK/kC,0BAA0B,IAAI,KAAK+kC;AAGxC,eAAKiB,qCAAqC,KAAK,KAAKjB;QAzEtD;QA4ESjkC,kBAAkB1hD,GAAY;AACrC,gBAAM0hD,kBAAkB1hD,CAAxB;AAIA,eAAK8jC,oCAFL,KAAK9V,2BACH,KAAKL,oBAAuD,IAAnC,KAAKixB;QAJK;QAQ9B/pF,OAAI;AACX,gBAAMA,KAAN;eACKgxH,YAAY,KAAKgB,cAAL;AACjB,eAAKJ,UAAU,KAAKK,YAAL;AACf,eAAKN,UAAU,KAAKO,YAAL;AAEf,eAAK7qC,+BACH,KAAKpD,oBACJ,KAAKqI,eAAiC6lC;QAR9B;QAWJvlC,sBAAsBzhD,GAAY;AACzC,gBAAMyhD,sBAAsBzhD,CAA5B;AAEA,eAAKimF,uBACHjmF,EAAMg9B,kBAAkB,oBAAxB,KACA,KAAKipD;AACP,gBAAMgB,IAAmB96G,OACvB6zB,EAAMg9B,kBAAkB,kBAAxB,CADuB;AAGzB,eAAKkpD,qBACHe,KAAoB,CAACx7F,MAAMw7F,CAAN,IACjBA,IACA,KAAKf;AACX,eAAKC,0BACHnmF,EAAMg9B,kBAAkB,uBAAxB,KACA,KAAKmpD;AAIP,eAAKC,yBAHCc,IAAsB/6G,OAC1B6zB,EAAMg9B,kBAAkB,qBAAxB,CAD0B,MAIH,CAACvxC,MAAMy7F,CAAN,IACpBA,IACA,KAAKd;QAtB8B;QAyBlCx4H,UAAO;AACd,gBAAMA,QAAN;AACI,eAAK04H,sBACH3hI,4CAAW,KAAK2hI,kBAApB;AAEE,eAAKI,yBACH/hI,4CAAW,KAAK+hI,qBAApB;QANY;QAUP1lC,eAAY;AACnB,gBAAMz/E,IAAS,KAAKi9E,kBACdn9E,IAAQ,KAAKo9E,iBAEb6D,IAAoBlvF,6CAAM,KAAK,CAC1BD;YAAM;YAAI,CAACoO;UAApB,GACSpO,6CAAM,IAAI,CAACoO,CAApB,GACSpO,6CAAMkO,GAAO,CAAtB,CAHmC,CAApB;AAKjB,iBAAO,EAACE,QAAAA,GAAQF,OAAAA,GAAOkhF,MAAMD,EAAtB;QATY;QAkBXukC,gBAAa;AAgBrBrkC,mBAASA,EAAajhF,GAAgBkhF,GAAa93E,GAAc;AAC/D,gBAAMwjD,IAAa5sD,IAAS;AACtBF,gBAAQ8sD,IAAa2lB,IAAWA,IAAW3lB;AAE3C1rC,gBAAY9X,IAAQ,KAAK;AACzBgd,iBAFU86D,IAAK,KAAK,KAEJlhF,IAAU;AAChC,mBACWhO,8CAAO,CAACkvB,IAAYphB,GAAOsmB,CAApC,IACSp0B,8CAAOkvB,IAAYphB,GAAOsmB,CAAnC;UAR6D;AAfjE,gBAAMmsD,IAAW,KAAK8yC;AA2BtB,iBAAO,EACLnuH,MAAM,KAAKunF,OAAO6lC,WAClBxnF,WAAW,MACXh9B,MAAME,GAAc;AACCA,iBAAS;AAC5B,mBAAO4sD,IAAa2lB,IAAWA,IAAW3lB;UAFxB,GAIpB5sD,OAAOA,GAAc;AACnB,mBAAOA;UADY,GAGrBq5E,kBAAkBS,GAAwB;AACxC,mBAAOA,IAAmB;UADc,GAG1CR,kBAAkBS,GAAuB;AACvC,mBAAO,CAACA;UAD+B,GAGzCh9C,SAAS/8B,GAAc;AACrB,mBAAOihF,EAAajhF,GAAQ,OAAO,KAA5B;UADc,GAGvBg9B,OAAOh9B,GAAc;AACnB,mBAAOihF,EAAajhF,GAAQ,MAAM,KAA3B;UADY,GAGrB4lH,cAAc5lH,GAAc;AAC1B,mBAAOihF,EAAajhF,GAAQ,OAAO,IAA5B;UADmB,GAG5B6lH,YAAY7lH,GAAc;AACxB,mBAAOihF,EAAajhF,GAAQ,OAAO,IAA5B;UADiB,EAzBrB;QA5Bc;QAiEbulH,cAAW;AAmBnBtkC,mBAASA,EACP6kC,GACA5kC,GACA93E,GAAc;AAEd,kBAAM28G,IACJD,IAAcE,IAAYF,IAAcE,IAAY;AAEhD7sF,iBADS2sF,IAAcE,IAAYA,IAAYF,KAC7B;AACxB,kBAAMG,IAAQ78G,MAAU83E,IAAK,MAAM;AACnC,mBACW/uF,2CACP,KACA,SAAS8zH,GACT9sF,GACSvnC,8CAAOwX,IAAQ,IAAI,MAAM+vB,IAAS+nD,IAAK,KAAK,KAAK/nD,CAA1D,CAJF,IAMSjnC,kDAAW,MAAMgvF,IAAK,KAAK,KAAK6kC,CAAzC,IACS5zH,2CACP,KACA,SAAS8zH,GACT9sF,GACSvnC,8CAAOwX,IAAQ,KAAK,KAAK+vB,IAAS+nD,IAAK,KAAK,KAAK/nD,CAA1D,CAJF;UAfY;AArBhB,gBAAMo5C,IAAW,KAAK8yC,oCAChBW,IAAuB,IAAXzzC;AA4ClB,iBAAO,EACLr7E,MAAM,KAAKunF,OAAO8lC,OAClBznF,WAAW,MACXh9B,MAAME,GAAc;AACCA,iBAAS;AAC5B,mBAAO4sD,IAAa2lB,IAAWA,IAAW3lB;UAFxB,GAIpB5sD,OAAOA,GAAc;AACnB,mBAAOA;UADY,GAGrBq5E,kBAAkBS,GAAwB;AACxC,mBAAOA,IAAmB;UADc,GAG1CR,kBAAkBS,GAAuB;AACvC,mBAAO,CAACA;UAD+B,GAGzCh9C,SAAS/8B,GAAc;AACrB,mBAAOihF,EAAajhF,GAAQ,OAAO,KAA5B;UADc,GAGvBg9B,OAAOh9B,GAAc;AACnB,mBAAOihF,EAAajhF,GAAQ,MAAM,KAA3B;UADY,GAGrB4lH,cAAc5lH,GAAc;AAC1B,mBAAOihF,EAAajhF,GAAQ,OAAO,IAA5B;UADmB,GAG5B6lH,YAAY7lH,GAAc;AACxB,mBAAOihF,EAAajhF,GAAQ,OAAO,IAA5B;UADiB,EAzBrB;QA9CY;QAmFXwlH,cAAW;AAiBnBvkC,mBAASA,EAAajhF,GAAgBkhF,GAAa93E,GAAc;AAC3CpJ,iBAAkB,IAATm5B;AAC7B,kBAAM8sF,IAAQ78G,MAAU83E,IAAK,MAAM;AACnC,mBACW/uF;cACP;cACA,SAAS8zH;cACT9sF;cACSvnC,8CAAOwX,IAAQ,IAAI,MAAM+vB,IAAS+nD,IAAK,KAAK,KAAK/nD,CAA1D;YAJF,IAMSjnC,kDAAW,MAAMgvF,IAAK,KAAK,KAAKsD,CAAzC,IACSryF,2CACP,KACA,SAAS8zH,GACT9sF,GACSvnC,8CAAOwX,IAAQ,KAAK,KAAK+vB,IAAS+nD,IAAK,KAAK,KAAK/nD,CAA1D,CAJF;UAX6D;AAhBjE,gBAAMA,IAAS,KAAKmiD;AAoCpB,iBAAO,EACLpkF,MAAM,KAAKunF,OAAO+lC,QAClB1nF,WAAW,MACXh9B,MAAMomH,GAAe;AACnB,mBAAO/sF;UADY,GAGrBn5B,OAAOA,GAAc;AACnB,mBAAOA;UADY,GAGrBq5E,kBAAkBS,GAAwB;AACxC,mBAAOA,IAAmB;UADc,GAG1CR,kBAAkBS,GAAuB;AACvC,mBAAO,CAACA;UAD+B,GAGzCh9C,SAAS/8B,GAAc;AACrB,mBAAOihF,EAAajhF,GAAQ,OAAO,KAA5B;UADc,GAGvBg9B,OAAOh9B,GAAc;AACnB,mBAAOihF;cAAajhF;cAAQ;cAAM;YAA3B;UADY,GAGrB4lH,cAAc5lH,GAAc;AAC1B,mBAAOihF,EAAajhF,GAAQ,OAAO,IAA5B;UADmB,GAG5B6lH,YAAY7lH,GAAc;AACxB,mBAAOihF,EAAajhF,GAAQ,OAAO,IAA5B;UADiB,EAxBrB;QArCY;QAmEZk5E,SAAS39D,GAA8B;AAC9C,cAAIu3E,IAASv3E,EAAWsxE,SAAX;AACT,WAACiG,KAAUv3E,EAAW8hB,qBACxBy1D,IAASv3E,EAAW8hB,iBAAiBwvD,SAA5B;AAGX,kBAAQtxE,EAAWrkB,MAAnB;YACE,KAAK85D,sDAAeC;YACpB,KAAKD,sDAAeE;AAClBkhC,kBAAc72E,EAAWwB,eAAX,EAA4Bs1E,eAA5B;AAEd,kBAAoB,SAAhBD;AACF,wBAAQA,GAAR;kBACE,KAAK,KAAK3T,OAAO6lC;AACf,2BAAO,KAAKA;kBACd,KAAK,KAAK7lC,OAAO8lC;AACf,2BAAO,KAAKW;kBACd,KAAK,KAAKzmC,OAAO+lC;AACf,2BAAO,KAAKS;gBANhB;AAUF,kBAAInyB,KAAUA,EAAOjoF,SAAS,SAAhB;AACZ,uBAAO,KAAKy5G;AAEd,kBAAIxxB,KAAUA,EAAOjoF,SAAS,QAAhB;AACZ,uBAAO,KAAKq6G;AAEVpyB,mBAAUA,EAAOjoF,SAAS,QAAhB;AAGd,qBAAO,KAAKq6G;YACd,KAAKl0D,sDAAeI;YACpB,KAAKJ,sDAAeG;AAClB,qBAAO,KAAKwtB;YACd;AACE,oBAAMnnF,MAAM,cAAN;UA9BV;QAN8C;QAwCvCgoF,YAAS;AAiBhByB,mBAASA,EAAaQ,GAAW;AAC/B,mBACW5vF,6CAAM,KAAK,CACTD,6CAAO6vF,IAAM0kC,IAAc,GAAG,CAAvC,GACSv0H,6CAAO6vF,IAAM0kC,IAAa,IAAK,GAAGC,IAAgB,CAA3D,GACSx0H,6CAAM6vF,IAAM0kC,GAAYC,CAAjC,CAHkB,CAApB,IAKSn0H,4CAAK,CAAUL,6CAAM6vF,IAAM0kC,GAAYv5D,CAAjC,CAAD,CAAd,IACS/6D,6CAAM,KAAK,CACTD,6CAAO6vF,IAAM0kC,IAAc,GAAGC,IAAgB,CAAvD,GACSx0H,6CAAO6vF,IAAM0kC,IAAc,GAAGC,CAAvC,GACSx0H,6CAAM6vF,IAAM0kC,GAAYC,CAAjC,CAHkB,CAApB,IAKSl0H,kDAAW,KAAKuvF,IAAME,CAA/B,IACS9vF,6CAAM,KAAK,CACTD,6CAAO6vF,IAAM0kC,IAAc,GAAG,CAAvC,GACSv0H,6CAAO6vF,IAAM0kC,IAAa,IAAK,GAAG,EAAEC,IAAgB,EAA7D,GACSx0H,6CAAM6vF,IAAM0kC,GAAY,CAACC,CAAlC,CAHkB,CAApB,IAKSn0H,4CAAK,CAAUL,6CAAM6vF,IAAM0kC,GAAY,CAACv5D,CAAlC,CAAD,CAAd,IACS/6D,6CAAM,KAAK,CACTD,6CAAO6vF,IAAM0kC,IAAc,GAAG,EAAEC,IAAgB,EAAzD,GACSx0H,6CAAO6vF,IAAM0kC,IAAc,GAAG,CAACC,CAAxC,GACSx0H,6CAAM6vF,IAAM0kC,GAAY,CAACC,CAAlC,CAHkB,CAApB;UApB6B;AAhBjC,gBAAMtmH,IAAQ,KAAK68E,aACb38E,IAAS,KAAK48E,cAEd+E,IAAa7hF,IAAQ,GACrBqmH,IAAaxkC,IAAa,GAE1B/0B,IAAa5sD,IAAS,GACtBomH,IAAgBx5D,IAAa,GAqC7B3vB,IAAWgkD,EAAa,CAAb,GACX/jD,IAAY+jD,EAAa,EAAb;AAElB,iBAAO,EACL/pF,MAAM,KAAKunF,OAAOE,OAClB7+E,OAAAA,GACAE,QAAAA,GACAi9B,UAAAA,GACAC,WAAAA,EALK;QAhDS;QAyDT2iD,oBAAiB;AACxB,gBAAM1mD,IAAS,KAAKmiD,eAEdsG,IAA8BzvF,2CAClC,KACA,SACAgnC,GACSvnC,6CAAM,CAACunC,GAAQA,CAAxB,CAJyB,GAOrBktF,IAA+Bl0H,2CACnC,KACA,SACAgnC,GACSvnC,6CAAM,CAACunC,GAAQA,CAAxB,CAJ0B,GAOtB0oD,IAAiC1vF,2CACrC,KACA,SACAgnC,GACSvnC,6CAAMunC,GAAQA,CAAvB,CAJ4B,GAOxBmtF,IAAkCn0H;YACtC;YACA;YACAgnC;YACSvnC,6CAAMunC,GAAQA,CAAvB;UAJ6B;AAO/B,iBAAO,EACLr5B,OAAOq5B,GACPn5B,QAAQm5B,GACR2oD,SAASF,GACTG,YAAYF,GACZ4jC,YAAYtsF,GACZipD,aAAajpD,GACbotF,cAAcF,GACdG,iBAAiBF,EARZ;QA/BiB;QA2CjB1lC,yBAAyB/4D,GAAc;AAC9C,iBAAmB16B,0CAAM,QAAQ06B,GAAQ,IAAlC,KAA2CA;QADJ;QAIvCg5D,wBAAwBh5D,GAAc;AAC7C,iBAAmB16B,0CAAM,QAAQ06B,GAAQ,IAAlC,KAA2CA;QADL;QAItC/9B,UAAUyV,GAAiB+M,GAAiB+1E,GAAgB;AACnE,gBAAMv4F,UAAUyV,GAAK+M,GAAS+1E,CAA9B;AAMMp8C,cAAWljD,kDAAiBqwC,qCAAI8S,MAAM,CAAA,GAAI3mC,CAAnC;AAGPwlH,cAAyBhiI;YAC7BqwC,qCAAI4e;YACJ,EACE,IAAM,8BAA8B,KAAKstC,kBACzC,QAAU,QACV,OAAS,QACT,GAAK,QACL,GAAK,OALP;YAOAr5C;UATyB;AAWvBljD,4DACFqwC,qCAAIye,gBACJ,EAAC,MAAM,iBAAiB,cAAgB,KAAK8yE,mBAA7C,GACAI,CAHF;AAMM0B,cAAgC1jI,kDACpCqwC,qCAAIse,qBACJ,EAAC,QAAU,UAAX,GACAqzE,CAHgC;AAK9BhiI,4DACFqwC,qCAAIwe,SACJ;YAAC,MAAQ;YAAS,aAAe;UAAjC,GACA60E,CAHF;AAMI1jI,4DACFqwC,qCAAIue,SACJ,EACE,eAAe,KAAK+yE,sBACpB,iBAAiB,GACjB,QAAU,WAHZ,GAKAK,CAPF;AASIhiI,4DACFqwC,qCAAIqe,aACJ,EACE,MAAM,YACN,KAAO,WACP,UAAY,MACZ,QAAU,UAJZ,GAMAszE,CARF;AAUA,eAAKD,uBAAuBC,EAAmBxnH;AAC/C,eAAKwnH,qBAAqBA;AAIpBI,cAA4BpiI;YAChCqwC,qCAAI4e;YACJ,EACE,IAAM,iCAAiC,KAAKstC,kBAC5C,QAAU,QACV,OAAS,QACT,GAAK,QACL,GAAK,OALP;YAOAr5C;UAT4B;AAW1BljD,4DACFqwC,qCAAIye,gBACJ,EAAC,MAAM,iBAAiB,cAAgB,KAAKgzE,sBAA7C,GACAM,CAHF;AAMMuB,cAAmC3jI,kDACvCqwC,qCAAIse,qBACJ,EAAC,QAAU,UAAX,GACAyzE,CAHmC;AAKjCpiI,4DACFqwC,qCAAIwe,SACJ;YAAC,MAAQ;YAAS,aAAe;UAAjC,GACA80E,CAHF;AAMI3jI,4DACFqwC,qCAAIue,SACJ,EACE,eAAe,KAAKizE,yBACpB,iBAAiB,GACjB,QAAU,WAHZ,GAKAO,CAPF;AASIpiI,4DACFqwC,qCAAIqe,aACJ,EACE,MAAM,YACN,KAAO,WACP,UAAY,MACZ,QAAU,UAJZ,GAMA0zE,CARF;AAUIpiI,4DACFqwC,qCAAIqe,aACJ;YACE,MAAM;YACN,KAAO;YACP,UAAY;UAHd,GAKA0zE,CAPF;AASA,eAAKH,0BAA0BG,EAAsB5nH;AACrD,eAAK4nH,wBAAwBA;QAvHsC;QA0H5DxiC,QAAQN,GAAgB;AAC/B,iBAAO;YAGL,GAAGA,CAAH;YACA,GAAGA,CAAH;YACA,SAAS,KAAK91B,qBAAd,IAAuC,KAAKD,mBAA5C,MACQ,KAAKE,qBAAX;YACF;YAEA,GAAG61B,CAAH;YACA;YACA;YAGA,GAAGA,CAAH;YACA;YACA;YACA,GAAGA,CAAH;YACA,GAAGA,CAAH;YACA,SAAS,KAAK/E,wBAAd;YACA;YACA,GAAG+E,CAAH;YACA,GAAGA,CAAH;YACA,GAAGA,CAAH;YACA,GAAGA,CAAH;YACA;YACA;YAGA,GAAGA,CAAH;YACA;YACA;YAGA,GAAGA,CAAH;YACA;YACA;YAGA,GAAGA,CAAH;YACA;YACA,GAAGA,CAAH;YACA;YACA;YACA;YACA;YAGA,GAAGA,CAAH;YACA,gBAAgB,KAAK71B,qBAArB;YACA,gBAAgB,KAAKD,qBAArB;YACA;YACA;YAGA,GAAG81B,CAAH;YACA;YACA;YAGA,GAAGA,CAAH;YACA,GAAGA,CAAH;YACA,gBAAgB,KAAK71B,qBAArB;YACA;YACA,GAAG61B,CAAH;YACA;YACA;YAGA,GAAGA,CAAH;YACA,WAAW,KAAKqiC,oBAAhB;YACA;YAGA,GAAGriC,CAAH;YACA,oCAAoC,KAAK/C,gBAAzC;YACA;YAGA,GAAG+C,CAAH;YACA,iBAAiB,KAAK7D,wBAAtB;YACA;YACA;UAlFK;QADwB;MAjvB7B,GAjCNhyC,kDAAA,CAAA;AAiCa4vC,sDAAAA,mBAAAA;ACLP,UAAOyG,uDAAP,cAAsB8jC,sDAAtB;QASJ3oG,YAAY1xB,GAAiBw2F,GAAgB;AAC3C,gBAAMx2F,GAAOw2F,CAAb;QAD2C;QAIpC56B,OAAI;AACX,gBAAMq7B,IAAa,KAAKN,OAAOM;AAC/BA,YAAWqjC,aAAX;AACA,eAAKxjC,aAAL;AACA,eAAKC,eAAL;AACA,eAAKC,2BAAL;AAEAC,YAAWC,QAAQ,KAAKR,eAAe,OAAO,KAAKD,WAAnD;AACI,eAAKG,MAAM/zE,OACbo0E,EAAWE,QAAX;AAEF,eAAKC,mBAAL;AACI,eAAKR,MAAM3kF,qBAGbglF,EAAWsjC,kBAAkB,KAAK3jC,MAAM3kF,iBAAiBs+B,MAAM3lC;AAEjEqsF,YAAWujC,WAAX;QAjBW;QAoBJ1jC,eAAY;AAEjB,eAAKF,MAAM3kF,oBACX,KAAK2kF,MAAM3kF,iBAAiB1L,kBAC5B,CAAC,KAAKqwF,MAAM6jC,qBACZ,CAAC,KAAK7jC,MAAMwB,UAAU/L,qBAEtB,KAAKquC,aAAL,GACA,KAAKC,4BAAL,GACA,KAAKC,gBAAL,GACA,KAAKC,2BAAL,KAEA,MAAM/jC,aAAN;QAZiB;QAgBZe,YAAS;AAEd,eAAKjB,MAAM3kF,oBACX,KAAK2kF,MAAM3kF,iBAAiB1L,iBAE5B,KAAKs0H,2BAAL,IAEA,MAAMhjC,UAAN;QAPc;QAiBCF,kBAAkBrN,GAAQ;AAC3C,cAAI,EAAc,KAAdA,EAAI52E,SAAR;AAGA,gBAAIk3E,yDAAMtB,SAASgB,CAAf,GAAqB;AAEvB,oBAAM4E,IADY5E,EACkB4E;AACpC,kBAAMC,IAFY7E,EAEiB6E;AACnC,kBAAID,KAAqBC,GAAkB;AACzC,sBAAM2rC,IAAgB,KAAK5+D,WAAWo3B;AACtC,oBAAMynC,IAAeD,EAAchlC;AAC7B2jC,oBANUnvC,EAOJ52E,UAAUw7E,IAAoB6rC,IAAe;AACnDC,oBAAkB7rC,IACpB2rC,EAAcZ,kBACd;AACEe,oBACc,IAAlBxB,IACa7zH,kDAAW,KAbV0kF,EAayBplB,OAAOu0D,CAA1C,IACA;AAKN,qBAAK/iC,gBAAgBskC,IAAkBC,KAJlB/rC,IACjB4rC,EAAcb,eACd;AAGJ;cAjByC;YAJpB;AAwBzB,iBAAKvjC,gBAAyB9wF,kDAAW,KAAK0kF,EAAIplB,OAAOolB,EAAI52E,MAAxC;UA3BrB;QAD2C;QAkCnCinH,8BAA2B;AACnC,cAAI,CAAC,KAAK/jC,MAAM3kF;AACd,kBAAU/G,MACR,oEADI;AAIR,eAAKwrF,gBACH,KAAKE,MAAM3kF,iBAAiBs+B,MAC5B+oF,cAAc,KAAK1iC,MAAM3kF,iBAAiByB,MAD1C;QAPiC;QAc3BmnH,6BAA0B;AAClC,cAAI,CAAC,KAAKjkC,MAAM3kF;AACd,kBAAU/G,MACR,oEADI;AAIR,eAAKutF,0BAAL;AAEA,eAAK/B,gBACH,KAAKE,MAAM3kF,iBAAiBs+B,MAC5BG,OAAO,KAAKkmD,MAAM3kF,iBAAiByB,MADnC;AAKF,eAAKgjF,gBAAgB;QAda;QAkB1BgkC,eAAY;AACpB,gBAAM5iC,IAAS,KAAKlB,MAAMkB;AAC1B,eAAKC,4BAAL;AAEA,eAAKrB,gBAAyBjxF;YAAOqyF,EAAO/M;YAAM,KAAK6L,MAAMoB;UAAxC;AACrB,eAAKtB,gBAAyB9wF,kDAAW,KAAKkyF,EAAOtkF,KAAhC;QALD;QASZonH,kBAAe;AACvB,gBAAMxiC,IAAY,KAAKxB,MAAMwB;AAC7B,eAAKE,wBAAL;AAEA,eAAK5B,gBAAyB9wF,kDAAW,KAAKwyF,EAAU98E,QAAnC;AACrB,eAAKo7E,gBAAyB9wF,kDAAW,KAAK,CAACwyF,EAAU5kF,KAApC;QALE;QAQhBmlF,iBAAiB7pE,GAAkB;AAC1C,eAAKkqE,+BAA+BlqE,CAApC;AAEA,gBAAMmD,IAAYnD,EAAMA,MAAMjkB;AAC1BikB,YAAMm+D,kBAAkB,KAAK2J,MAAM5oE,sBAOjC0mE,IACKlvF,8CAHaspB,EAAMi8D,OAAOj8D,EAAM2+D,iBAD9B3+D,EAAMg8D,aAAah8D,EAAMpb,SAAS,CAI7C,IAAyC,KAAKwnH,mBAAmBpsG,CAAxB,GAExB,KAAK6nE,OAAOM,WACpBkkC,eAAelpG,GAAWyiE,CAArC;QAf0C;QAkBpCwmC,mBAAmBpsG,GAAkB;AAC3C,gBAAMtb,IAAQsb,EAAMtb,QAAgC,IAAxBsb,EAAM2+D,iBAC5B/5E,IAASob,EAAMpb;AAErB,iBACW9N,kDAAW,KAAK4N,CAAzB,IACCsb,EAAMyhB,MAAuB+oF,cAAc5lH,CAA3C,IACQ9N,kDAAW,KAAK,CAAC4N,CAA1B,IACCsb,EAAMyhB,MAAuBG,OAAOh9B,CAApC,IACD;QATyC;QAapC+jF,oBAAoBnN,GAAQ;AACnC,cAAMx7D,IAAQw7D,EAAIwB,aAAJ;AAEd,gBAAMh1E,IAAIgY,EAAMi8D,OAAOj8D,EAAMk8D,cAAel8D,EAAMyhB,MAAoB/8B,OAEhEsnH,IAAgB,KAAK5+D,WAAWo3B,gBAChCgC,IACHxmE,EAAMyhB,MAAgBK,YACdhrC;YAAW;YAAK,EAAEkpB,EAAMk8D,cAAc8vC,EAActnH;UAA7D,IACAsnH,EAActlC,SAEV0C,IAAc5N,EAAI52E,SAAS,IAAIonH,EAAcpnH;AAE7C6hF,cACJulC,EAAcrlC,aACL7vF,kDAAW,KAAKkpB,EAAMk8D,cAAc8vC,EAActnH,KAA3D,KACCsb,EAAMssG,gCACH,KACCtsG,EAAMyhB,MAAgBI;AAE7B,eAAK+lD,gBACM9wF,kDAAW,KAAKkR,CAAzB,IACAw+E,IACS1vF,kDAAW,KAAKsyF,CAAzB,IACA3C,IACS3vF,kDAAW,KAAK0kF,EAAIS,OAAOT,EAAI92E,KAAxC;AAEF,eAAK2kF,kCAAkC7N,CAAvC;QA3BmC;QA+BrC6O,4BAA4BE,GAAsB;AAChD,gBAAMh0B,IAAOg0B,EAAW1M;cAEtBtnB,EAAKz6D,SAAS85D,sDAAeG,kBAC7BQ,EAAKz6D,SAAS85D,sDAAeI,sBAC5BO,EAAKz6D,SAAS85D,sDAAeE,gBAAgB,CAACy0B,EAAW9yF;AAE1D,kBAAM4yF,4BAA4BE,CAAlC;eALF;AAcE3E,gBAJErvB,EAAKz6D,SAAS85D,sDAAeC,cAIfn/D,8CAHF6zF,EACK5L,iBACN,CAFC4L,EAEM3lF,SAAS,CACtB,IAA8B,KAAKwnH,mBAH5B7hC,CAGuB,IAO1B7zF;cAJI6zF,EACK7lF;cACP,CAFE6lF,EAEM3lF,SAAS;YAE5B,IAJa2lF,EAKL9oD,MAAuBE,SALlB4oD,EAKkC3lF,MAA9C;AAEL,gBAAM1T,IAAQqlE,EAAK50C,eAAL,GACRwmE,GAAWuC;AAAjB,qBAAiBA,KAAXvC,IAANj3F,EAAMi3F,YAAWuC,2BAAAA,EAAAA,KAAXvC,GACJ5xB,GACAqvB,GACArvB,EAAKo0B,iBAAL,GACAz5F,EAAM6iB,GAJR;UAzBA;QAFgD;MAnN9C,GA5BNq9B,+CAAA,CAAA;AA4Baq2C,mDAAAA,SAAAA;ACLP,UAAO8kC,gDAAP,cAA0Bp9F,mCAA1B;QAkDJvM,YACE+X,GACAj2B,GACAE,GACAs1B,GACA+I,GACA27C,GACAvtD,GAAyB;AAEzB,gBAAMlC,mCAAMq/B,UAAZ;AA9CQ,eAAAuW,eAHF,KAAAxd,eAAkD;AAmBlD,eAAAq3B,UAHW,KAAA5wB,WAPD,KAAAI,WAAW;AAarB,eAAAo+D,UAAU;AA6BVxlD,cAAcx3D,OAAerd,8DAAyByS,CAAjC,CAAP;AACdqiE,cAAaz3D,OAAerd,8DAAyBuS,CAAjC,CAAP;AACnB,cAAIoqB,MAAMk4C,CAAN,KAAsBl4C,MAAMm4C,CAAN;AACxB,kBAAM7qE,MACJ,iEADI;AAIR,cAAmB,KAAf4qE,KAAkC,KAAdC;AACtB,kBAAM7qE,MACJ,mEADI;AAOR,eAAKmyD,QAAQ,IAAIxhD,uCAAKk6D,GAAYD,IAAculD,8CAAWE,SAA9C;AAKb,eAAKzlD,cAAcA;AAEI,yBAAnB,OAAO/jC,MACT,KAAKskB,eAAetkB;AAGlBtI,gBAAQxL,mCAAMq/B,eAEdn9B,IACF,KAAKo9B,WAAWp9B,CAAhB,KAEA,KAAKutD,UAAU,CAAC,CAACA,GACjB,KAAK4tC,UAAkBr6H,8DAAyB+nC,CAAjC,KAAyC,KAE1D,KAAK4wB,SAAiB34D,8DAAyBwoC,CAAjC,CAAd;QAtCyB;QA8CR8zB,WAAWp9B,GAAwB;AACpD,gBAAMo9B,WAAWp9B,CAAjB;YACWutD,YAAS,KAAKA,UAAUvtD,EAAOutD;AACtCvtD,YAAO6I,QACT,KAAKsyF,UAAkBr6H,8DAAyBk/B,EAAO6I,GAAxC;QAJmC;QAW7CuI,WAAQ;AACf,eAAKsiC,eAAmBp9E,kDACtBqwC,qCAAI+e,OACJ,EACE,QAAU,KAAKiwB,cAAc,MAC7B,OAAS,KAAKzY,MAAM7pD,QAAQ,MAC5B,KAAO,KAAK8nH,QAHd,GAKA,KAAK/+D,WAPa;AASpB,eAAKsX,aAAannB,eACZhT,2CACJ,cACA,KAAK0jB,MAHP;AAMI,eAAK/G,iBACP,KAAKwd,aAAa95D,MAAMqhD,SAAS;QAjBpB;QAqBRmE,cAAW;QAAA;QASDwB,mBAAmBn0D,GAAc;AAClD,iBAAwB,aAApB,OAAOA,IACF,OAEFA;QAJ2C;QAajCw0D,eAAex0D,GAAgB;AAChD,eAAKwwD,SAASxwD;AACV,eAAKinE,gBACP,KAAKA,aAAannB,eAAmBhT,2CAAU,cAAc,KAAK0jB,MAAlE;QAH8C;QAYzC+E,aAAU;AACjB,iBAAO,KAAKurB;QADK;QASnB8tC,OAAOxyF,GAAkB;AACnBA,gBAAQ,KAAKsyF,YAGjB,KAAKA,UAAUtyF,KAAO,IAClB,KAAK6qC,gBACP,KAAKA,aAAajgE,aAAa,OAAO,KAAK0nH,OAA3C;QANqB;QAcN38D,cAAW;AACxB,eAAKtI,gBACP,KAAKA,aAAa,IAAlB;QAF0B;QAY9BolE,kBAAkBhmH,GAAuC;AACvD,eAAK4gD,eAAe5gD;QADmC;QAWtCkrD,WAAQ;AACzB,iBAAO,KAAK26D;QADa;QAcX7mI,OAAAA,SAAS2X,GAAiC;AACxD,cAAI,CAACA,EAAQq9B,OAAO,CAACr9B,EAAQoH,SAAS,CAACpH,EAAQsH;AAC7C,kBAAUxI,MACR,sGADI;AAOR,iBAAO,IAAI,KACTkB,EAAQq9B,KACRr9B,EAAQoH,OACRpH,EAAQsH,QACRzF,QACAA,QACAA,QACA7B,CAPK;QATiD;MArOtD;AAKoBivH,oDAAAE,YAAY;AAqPxBloI,qDAAS,eAAegoI,6CAAtC;AAEAA,oDAAWj+F,UAAU6+B,gBAAgB;AAnRrC,UAAA/b,oCAAA,CAAA;AAuBam7E,wCAAAA,aAAAA;AC2BP,UAAgBK,gDAAhB,cAAyDz9F,mCAAzD;QAoEJvM,YACE/Z,GACAqkD,GACA77B,GAAyB;AAEzB,gBAAMlC,mCAAMq/B,UAAZ;AA/DQ,eAAAq+D,cAAc;AAGd,eAAAC,aAAsC;AAQtC,eAAAC,eALA,KAAAC,iBAAiB;AAkBnB,eAAAC,qBAHA,KAAAC,oBAHE,KAAAC,4BAA+C;AAYzD,eAAAC,wBAAiC;AAGvB,eAAA1G,aAAkC;AAMnC,eAAAr4D,eAAe;AAGf,eAAA1d,SAAS;AAuBZ9nC,gBAAUsmB,mCAAMq/B,eAChBn9B,KACF,KAAKo9B,WAAWp9B,CAAhB,GAEF,KAAKy5B,SAASjiD,CAAd,GACIqkD,KACF,KAAKwB,aAAaxB,CAAlB;QAVuB;QAcRuB,WAAWp9B,GAAwB;AACpD,gBAAMo9B,WAAWp9B,CAAjB;AAC0BlyB,qBAAtBkyB,EAAOg8F,eACT,KAAKR,cAAcx7F,EAAOg8F;QAHwB;QAO7C5qF,WAAQ;AAEf,cAAI,CADU,KAAK9gB,eAALzwB;AACF,kBAAM,IAAImuC;AACtB,gBAAMoD,SAAN;AAEI,eAAKusB,iBAAL,MACF,KAAKb,eAAgB,KAAKN,aAA0B5oC,WAA/B;QANR;QAUE+pC,mBAAgB;AACjC,gBAAM99D,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AAAO,kBAAM,IAAImuC;AAIlB,cAAA;AACJ,iBAFA,KAAK+tF,wBACH,EAAuBlqC,SAArBA,IAAAA,KAAKt0B,aAALs0B,MAAqBA,CAArBA,EAAqBA,sBAAqBhyF,EAAM0kG,iBAAN;QANb;QAoBhBpjC,gBACjBC,GACApS,IAA2B,MAAI;AAE3B,eAAK2sE,mBACP,KAAKh/D,WAAW,MAChB,KAAK++D,eAAe,OACdniE,IAAW,KAAK0D,QAEtB,KAAKA,SAAS,KAAK6+D,2BAEjB,KAAKt/D,gBACMroE,8CAAX,KACA,KAAK8oE,WAAW1D,KAChBvK,KAEWl7D,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,KAAKitB,cACL,SACA,KAAK9xD,QAAQ,MACb6uD,GACA,KAAK0D,MALP,CADF;QAd2B;QAmCdgE,eAAex0D,GAAoB;AAEpD,eAAKivH,eADL,KAAK/+D,WAAW;AAEhB,eAAKM,SAASxwD;QAHsC;QAS7C6kC,cAAW;AAClB,gBAAMzxC,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AAAO,kBAAM,IAAImuC;AAEjB,eAAKuvB,aAAL,EAAqBs0B,qBACrB,KAAKz1B,gBAEN,CAAC,KAAKuB,iBAAL,KAA2B,KAAKxB,eACnC,KAAKA,YAAaviD,MAAMkB,UAAU,SAClC,KAAKqhD,YAAY1oD,aAAa,UAAU5T,EAAM+Z,MAAMi7D,cAApD,MAEA,KAAK1Y,YAAaviD,MAAMkB,UAAU,QAIlCjb,EAAMi3F,WAAWqa,QAAQ19F,aACvB,QACA,KAAK8pD,aAAL,EAAqBszB,wBAFvB;QAfgB;QA6BXz5F,UAAO;AACV,cAAA;AAAJ,cAAyBy6F,SAArBA,IAAAA,KAAKt0B,aAALs0B,KAAqBA,IAArBA,EAAqBA;AAOvB,iBAAK5yB,QAAL,GACA,KAAKtC,WAAW;AAElB,iBAAO,MAAMvlE,QAAN;QAXO;QAkBhB86B,mBAAgB;AACV,eAAKypG,kBAAgB,KAAKM,cAAL;QADX;QAWGh9D,UAAO;AACxB,gBAAMA,QAAN;AAGA,cAAI,KAAK08D,gBAAgB;AACvB,gBAAMO,IAAY,KAAKT;AAClB,iBAAKC,gBAIJjlI,6CAAYylI,GAAW,qBAA3B,GACKxgI,2CAASwgI,GAAgB/iF,wCAAMgjF,SAAS,KAA7C,MAJI5lI,0CAAS2lI,GAAW,qBAAxB,GACKxgI;cAASwgI;cAAgB/iF,wCAAMgjF;cAAS;YAA7C;UAJqB;AAWnBt8H,cAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AAAO,kBAAM,IAAImuC;AAMlB,eAAKuvB,aAAL,EAAqBs0B,qBAAmBhyF,EAAMyxC,YAAN;QAtBpB;QA8B1B8qF,cAAcxhC,GAAc;AACtBA,gBAAU,KAAK4gC,gBAGnB,KAAKA,cAAc5gC,GACf,KAAK6gC,cAGP,KAAKA,WAAWhoH,aACd,cACA,KAAK+nH,WAFP;QARwB;QA0BTh9D,YAAYllC,GAAY+iG,IAAa,OAAK;AAC3D,eAAKhH,aAAc,KAAK74D,aAA0BxrD;AAEhD,WAACqrH,KACD,KAAKhH,WAAWppH,QAAQykE,gBACb3tB,iDAAoBF,kDAAqBlH,+CAEpD,KAAK2gF,kBAAL,IAEA,KAAKC,kBAAkBF,CAAvB;QATyD;QAkBrDC,oBAAiB;AAChB9iI,+CACLutB,EAAAA,+BAAA,oBACA,KAAKsE,QAAL,GACC/Q,OAAuB;AAET,qBAATA,KACF,KAAKm/C,SAAS,KAAK+iE,wBAAwBliH,CAA7B,CAAd;AAEF,iBAAKmiH,iBAAiB,KAAKx/D,MAA3B;UALsB,CAH1B;QADuB;QAmBjBs/D,kBAAkBF,GAAmB;AAC3C,gBAAMx8H,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEFhwC;YACR;YACA6B,EAAM6iB;YACN,KAAKg6G,eAAe5mI,KAAK,IAAzB;YACA,KAAKu/H;UAJP;AAMA,eAAKoG,aAAa,KAAKkB,cAAL;AAClB,eAAKhB,iBAAiB;AACtB,eAAKG,4BAA4B,KAAK7+D;AAEjCo/D,gBACF,KAAKZ,WAA2B98F,MAAM,EACrCi4B,eAAe,KADsB,CAAtC,GAGD,KAAK6kE,WAAW/oH,OAAhB;QAnByC;QA4BnCiqH,gBAAa;AACrB,cAAM98H,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEDx9B,YAAAA,6CAAS,IAApB;AACA,gBAAM0C,IAAgB9T,wCAAV;AAEZ,cAAM0+D,IAAc,KAAKC,gBAAL;AACpB,cAAI,CAACD;AAAa,kBAAU/yD,MAAM,kCAAV;AACpBxU;YAASunE;YAAa;UAA1B;AAEMo+D,cAAYjkH,SAASC,cAAc,OAAvB;AAClBgkH,YAAUrjH,YAAY;AAGtBqjH,YAAUzoH,aACR,cACA,KAAK+nH,WAFP;AAIA,gBAAMzrH,IAAQ,KAAKslH,WAAY5P,SAAjB;AACd,cAAMtrG,IAAW,KAAKojD,aAAL,EAAqBsC,sBAAsB9vD,IAAQ;AACpEmD,YAAK0G,MAAMO,WAAWA;AACtB+hH,YAAUtiH,MAAMO,WAAWA;AACvByiH,cAAerB,8CAAWsB,eAAe9sH,IAAQ;AAEjD,eAAK4tD,iBAAL,MACI5pC,IAAO,KAAKC,cAAL,GAGb4oG,KAAgB7oG,EAAKnX,SAASmX,EAAK/Y,OAAO,IAAI,MAExC8hH,IAAej9H,EAAM2R,UAAN,IAChB3R,EAAM2R,UAAN,EAA+BoI,MAAMi7D,iBACrC,KAAKrY,aAA0B5iD,MAAMi7D,gBAC1CqnD,EAAUtiH,MAAMmjH,SAAS,IAAIhtH,IAAQ,cAAc+sH,GACnD5pH,EAAK0G,MAAMgjH,eAAeA,GAC1B1pH,EAAK0G,MAAMoZ,aAAa,4BACpB,KAAKuqC,aAAL,EAAqBwzB,+BACvB79E,EAAK0G,MAAMojH,YACT,oCAAoC,IAAIjtH,IAAQ;AAGtDmsH,YAAUtiH,MAAMgjH,eAAeA;AAE/B1pH,YAAKmF,YAAY6jH,CAAjB;AAEAA,YAAU1kH,QAAQ0kH,EAAU73G,eAAe,KAAK44G,eAAe,KAAKhgE,MAAzB;AAC3Ci/D,YAAUzoH,aAAa,8BAA8BjI,OAAO,KAAKyxD,MAAZ,CAArD;AAEA,eAAKg/D,cAAL;AAEA,eAAKiB,iBAAiBhB,CAAtB;AAEA,iBAAOA;QAtDc;QA6DbQ,iBAAc;AAEtB,eAAKf,iBAAiB;AACtB,eAAKD,eAAe;AAEpB,eAAKh7D,cAAL;AACA,eAAK+7D,iBAAiB,KAAKx/D,MAA3B;eAGOT,gBACMroE,8CAAX,KACmC,SAAnC,KAAK2nI,6BACL,KAAKA,8BAA8B,KAAK7+D,WAM7BnpE,yCACT,KAAgBS,wCAAeg7C,EAAAA,0CAA1B,GACH,KAAKitB,cACL,SACA,KAAK9xD,QAAQ,MACb,KAAKoxH,2BACL,KAAK7+D,MALP,CADF,GASA,KAAK6+D,4BAA4B;AAGxBtrH,YAAAA,6CAAS,KAApB;AAGA,eAAK2sH,mBAAL;AACA,cAAMvjH,IAAkBxa,wCAAV,EAAoBwa;YAC5BvG,QAAQ;AACduG,YAAMrG,SAAS;AACfqG,YAAMO,WAAW;AACjBP,YAAMoZ,aAAa;AACnBpZ,YAAMojH,YAAY;AAClB,eAAKvB,aAAa;AAEZ39D,cAAc,KAAKC,gBAAL;AACpB,cAAI,CAACD;AAAa,kBAAU/yD,MAAM,kCAAV;AACpBtU,uDAAYqnE,GAAa,SAA7B;QA5CsB;QAoDxB2+D,iBAAiBW,GAA0B;QAAA;QAOjCF,iBAAiBhB,GAAsB;AAE/C,eAAKL,oBAAkChmI,sDACrCqmI,GACA,WACA,MACA,KAAKmB,mBAJkB;AAOzB,eAAKzB,qBAAmC/lI,sDACtCqmI,GACA,SACA,MACA,KAAKoB,kBAJmB;QATqB;QAkBvCH,qBAAkB;AACtB,eAAKtB,sBACO9lI,6CAAO,KAAK8lI,iBAA1B,GACA,KAAKA,oBAAoB;AAEvB,eAAKD,uBACO7lI,6CAAO,KAAK6lI,kBAA1B,GACA,KAAKA,qBAAqB;QAPF;QAgBlByB,oBAAoBpwH,GAAgB;AAC9B,sBAAVA,EAAElB,OACMzN,6CAAY,IAAtB,GACYE,wDAAZ,KACmB,aAAVyO,EAAElB,OACX,KAAK0tD,SACH,KAAKgiE,WAAYvlH,aAAa,4BAA9B,GACA,KAFF,GAIU5X,6CAAY,IAAtB,GACYE,wDAAZ,KACmB,UAAVyO,EAAElB,QACDzN,6CAAY,IAAtB,GACYE,wDAAZ,GACC,KAAKg+D,aAA0BkwD,IAAI,MAAM,CAACz/G,EAAE4qD,QAA5C,GACD5qD,EAAE4yB,eAAF;QAf0C;QAwBtCy9F,mBAAmBhkG,GAAS;AAK5BigC,cAAW,KAAK0D;AAEtB,eAAKxD,SACH,KAAK+iE,wBAAwB,KAAKf,WAAYjkH,KAA9C,GACuB,KAFzB;AAKE,eAAKglD,gBACMroE,8CAAX,KACA,KAAK8oE,WAAW1D,KAILzlE,yCACT,KAAgBS,wCAAei7C,mEAA1B;YACH,KAAKgtB;YACL,KAAK9xD,QAAQ;YACb6uD;YACA,KAAK0D;UAJP,CADF;QAlBgC;QAuC1BsgE,gBACR9wH,GACAuiD,IAAkB,MAAI;AAEtB,eAAK2N,WAAW;AACZ,eAAKg/D,mBAKP,KAAKF,WAAYjkH,QAAQ,KAAKylH,eAAexwH,CAApB;AAE3B,eAAKgtD,SAAShtD,GAAUuiD,CAAxB;QAVsB;QAcditE,gBAAa;AACrB,cAAMp8H,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,gBAAM96B,IAAgB9T,wCAAV,GACN20B,IAAO,KAAKC,cAAL;AACb9gB,YAAK0G,MAAMvG,QAAQ0gB,EAAKpX,QAAQoX,EAAK9Y,OAAO;AAC5C/H,YAAK0G,MAAMrG,SAASwgB,EAAKnX,SAASmX,EAAK/Y,MAAM;AAKvC8C,cAAK,IAAI7B;YADLpc,EAAM6iB,MAAMqR,EAAKpX,QAAQzJ,EAAKI,cAAcygB,EAAK9Y;YAC9B8Y,EAAK/Y;UAAvB;AAEX9H,YAAK0G,MAAMqB,OAAO6C,EAAGnH,IAAI;AACzBzD,YAAK0G,MAAMoB,MAAM8C,EAAGjH,IAAI;QAhBH;QA2BdnY,4BAAyB;AAChC,gBAAMmB,IAAQ,KAAKywB,eAAL;AAGd,cAAI,EAAEzwB,aAAiBs1C;AAAW,mBAAO;AAEdo0E,mEACzB,KAAK8L,YACL,KAAKA,WAAYriF,kBAAjB,EAAqC8D,eAAe,IAApD,GACAj3C,CAHa29H,KAMF,KAAKvB,cAAL;AAEb,iBAAO;QAdyB;QAsBzBh6D,iBAAc;AACrB,iBAAO;QADc;QAYJzB,WAAQ;AACzB,iBAAI,KAAKm7D,kBAAkB,KAAKF,aAEvB,KAAKA,WAAWjkH,QAElB;QALkB;QAiBjBylH,eAAezlH,GAAyB;AAChD,iBAAO,GAAGA,CAAH;QADyC;QAcxCglH,wBAAwBliH,GAAY;AAC5C,iBAAOA;QADqC;MAhqB1C;oDAOGuiH,eAAe;AAzDxB,UAAA98E,oCAAA,CAAA;AAkDsBw7E,wCAAAA,aAAAA;ACtBhB,UAAOkC,wDAAP,cAA8BlC,8CAA9B;QAeJhqG,YACE/Z,GACAqkD,GACA77B,GAA6B;AAE7B,gBAAMxoB,GAAOqkD,GAAW77B,CAAxB;QAF6B;QAWZ4gC,mBACjBn0D,GAA6B;AAE7B,iBAAiBqB,WAAbrB,IACK,OAEF,GAAGA,CAAH;QALsB;QAiBfnY,OAAAA,SACd2X,GAAqC;AAKrC,iBAAO,IAAI,KAHUnL,8DAAyBmL,EAAQqO,IAAzCA,GAGSxM,QAAW7B,CAA1B;QAL8B;MAhDnC;AAyDQ/Y,qDAAS,eAAeuqI,qDAAtC;4DAEexgG,UAAU6+B,gBAAgB;AAvFzC,UAAA/b,wCAAA,CAAA;AA4Ba09E,4CAAAA,iBAAAA;ACVP,UAAOxxC,0EAAP,cAAyByxC,kEAAzB;QAIJnsG,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;QADqC;QAI9BwsB,qBAAkB;AACzB,iBAAO;QADkB;QAKlBM,oBAAoBvsF,GAAe;AAC1C,iBAAO,CAAC,CAACA,EAAMiS;QAD2B;QAKnCu6E,qBAAqBxsF,GAAe;AAC3C,iBACE,CAAC,CAACA,EAAMiS,oBACR,CAACjS,EAAMuiG,uBACP,CAACviG,EAAMmvB;QAJkC;MAlBzC,GAlBN+wB,+DAAA,CAAA;AAkBaksC,mEAAAA,YAAAA;ACDP,UAAO3tC,2EAAP,cAA8Bq/E,4EAA9B;QAOJpsG,YAAY+tC,GAA6B3wC,GAAY;AACnD,gBAAM2wC,GAAW3wC,CAAjB;AAPF,eAAAssG,gCAAgC;AAS9B,cAAI,KAAKnuC,gBAAgB;AAIvB,iBAFIjtF,IAAQ,KAAKitF,gBAETh5E,IAAYjU,EAAMoS,aAAN;AAClBpS,kBAAQiU;AAELjU,cAAMmvB,mBACT,KAAKzb,SAAS,KAAKy5E,sBACnB,KAAKiuC,gCAAgC;UAThB;QAH0B;MAPjD,GAjBNl7E,2DAAA,CAAA;+DAiBazB,iBAAAA;ACDP,UAAOs/E,uFAAP,cAAoClzC,6DAApC;QAQJn5D,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;AANO,eAAAjsD,QADA,KAAAE,SAAS;AAQhB,eAAK9I,QAAQggF,yDAAMj8D,QAAQ,kBAAd;QAFwB;MARnC,GAhBNuxB,iEAAA,CAAA;AAgBa69E,qEAAAA,uBAAAA;ACIP,UAAOzuC,oEAAP,cAAsB0uC,4DAAtB;QAIJtsG,YAAY+tC,GAA2B;AACrC,gBAAMA,CAAN;QADqC;QAI9BwsB,qBAAkB;AACzB,iBAAO;QADkB;QAKlBM,oBAAoBvsF,GAAe;AAC1C,gBAAMyvF,KACHzvF,EAAM0vF,MAAoB,UAAd1vF,EAAM0vF,MAAgB,KAAKxzB,WAAWyzB,mBACnD,CAAC3vF,EAAMiS,oBACP,CAACjS,EAAMkS;AACT,iBAAO,CAAC,CAAClS,EAAMiS,oBAAoBw9E;QALO;QASnCjD,qBAAqBxsF,GAAe;AAC3C,iBACE,CAAC,CAACA,EAAMiS,oBACR,CAACjS,EAAMuiG,uBACP,CAACviG,EAAMmvB;QAJkC;MAtBzC,GApBN+wB,4DAAA,CAAA;AAoBaovC,gEAAAA,SAAAA;ACsBP,UAAOgM,yDAAP,cAA0B2iC,wDAA1B;QAgBJvsG,YAAY2gB,GAAoBryC,GAAe;AAC7C,gBAAMqyC,GAAUryC,CAAhB;AAXO,eAAAy7F,WAAW;AAalB,eAAKD,YAAYnpD;AAEjB,eAAK6pB,aAAa,KAAKs/B,UAAU99B,aAAf;AAKlB,eAAKo6B,SAAS,IAAIxI,kEAAO,KAAKpzB,UAAhB;AAKd,eAAKk8B,YAAY,IAAIhM,wEAAU,KAAKlwB,UAAnB;AAMjB,eAAKgiE,aAAa,CAACl+H,EAAMqsC,gBAAN,KAA2BrsC,EAAMyrB,YAAN;AAK9C,eAAKgvG,oBAAgD,IAA5Bz6H,EAAMuiG;AAK/B,eAAK47B,YAAY,KAAKlsH,mBAClB,IAAI8rH,qFAAqB,KAAK7hE,UAA9B,IACA;AAMJ,eAAKkiE,0BAA0B,oBAAIvvE;QAvCU;QA+CtC/5B,cAAW;AAClB,iBAAO,KAAK0mE;QADM;QAIXzP,UAAO;AAEd,eAAK2P,YAAL;AACA,eAAKC,gBAAL;AACA,eAAKC,eAAL;AACA,eAAKyiC,iBAAL;AACA,eAAKxiC,eAAL;AACA,eAAKC,kBAAL;AACA,eAAKC,UAAL;QARc;QAWPK,mBAAmBQ,GAAkBC,GAAgB;AAG5D,iBAAKA,IAKDA,aAAqBzB,2DAKvBwB,aAAqBn+C,gEACrBo+C,aAAqBp+C,+DAEd,OAIPm+C,aAAqBvB,EAAAA,wDACrBuB,aAAqBzB,wDACrByB,aAAqBxB,0DAEd,CAAC,KAAKK,YAAY,KAAKyiC,aAEzB,QAtBE;QAJmD;QA6BrD1gC,oBAAoBlT,GAAQ;AACnC,iBAAIA,EAAIiB,eAGC,KAAK/3E,QAAQ,KAAKo7E,UADtB,KAAK1yB,WAAWo3B,eAAiC6lC,cAAc,KAG7D,MAAM37B,oBAAoBlT,CAA1B;QAN4B;QAS5ByS,iBACPC,GACAn4D,GAAuB;AAEvB,iBAAKm4D,KAASn4D,KAIL5yB,CAAL,KAAKA,oBACiB1L,CAAtB,KAAK0L,iBAAiB1L,kBACrB,KAAKk0H,qBACL,KAAKriC,UAAU/L,oBAKhB,CAAC2Q,KAECn4D,KAAQ+lD,yDAAMjB,iBAAiB9kD,CAAvB,IACH,KAAKq3B,WAAWu0B,+BAIvBuM,KAAQpS,yDAAMb,oBAAoBiT,CAA1B,KAAmCn4D,MACzC+lD,yDAAMhB,qBAAqB/kD,CAA3B,KAAoC+lD,yDAAMf,iBAAiBhlD,CAAvB,KAC/BA,EAAKmmD,cAAc,KAAK9uB,WAAW8yB,gBAI1CgO,KAAQpS,yDAAMX,mBAAmB+S,CAAzB,KAAkCn4D,KAAQ+lD,yDAAMvB,MAAMxkD,CAAZ,IAC7C,KAAKq3B,WAAWmzB,aAElB,KAAKnzB,WAAWoxB,iBAnBZ,KAAKpxB,WAAWmzB;QAXJ;QAiChB2O,oBAAoBhB,GAAWn4D,GAAS;AAE/C,cAAI+lD,yDAAMJ,SAASwS,CAAf,KAAwBpS,yDAAMH,YAAY5lD,CAAlB;AAC1B,mBAAO,KAAKq3B,WAAWs0B;AAEzB,gBAAMrB,IAAmBvE,yDAAMD,WAAWqS,CAAjB,KAA0BA,EAAKzR,cAClD2D,IAAoBtE,yDAAMD,WAAW9lD,CAAjB,KAA0BA,EAAK0mD;AACzD,iBAAI2D,KAAqBC,KAGjBz7E,IAASoK,KAAKE,IAAI,KAAKk+C,WAAWo0B,cADrC,KAAKp0B,WAAWo3B,eAAiCwC,eAAe,CACpD,GACR5G,KAAqBC,IACxBrxE,KAAKE,IAAItK,GAAQ,KAAKwoD,WAAWs2B,sBAAjC,IACA9+E,KAGFk3E,yDAAMJ,SAASwS,CAAf,IACaA,EAELxN,yBACN,KAAKv9E,oBAAyBwoH,CAAL,KAAKA,oBAM3B,KAAKv+D,WAAWmzB,aAJdvxE,KAAKwP,IACV,KAAK4uC,WAAWo0B,eAAe,KAAKp0B,WAAW8yB,aAD1C,IAMPpE,yDAAMH,YAAY5lD,CAAlB,IAEG,KAAK5yB,mBAUC,CAXO4yB,EAWIwnD,qBAAqB,KAAKouC,oBACvC38G,KAAKwP,IACV,KAAK4uC,WAAWo0B,eAAe,KAAKp0B,WAAW8yB,aAD1C,IAIF,KAAK9yB,WAAWmzB,aAbnBvxE,KAAKE,IACH,KAAK85E,OAAOxM,WACZxtE,KAAKE,IACH,KAAKk+C,WAAWo0B,cAChB,KAAKp0B,WAAW8yB,aAFlB,CAFF,IAMI,KAAK9yB,WAAW8yB,gBASnB,KAAK9yB,WAAWoxB;QA/CwB;QAkDxC2Q,mBAAmBjB,GAAWn4D,GAAS;AAC9C,gBAAMrxB,IAAQ,KAAKA,QAAQ,KAAKo7E;AAChC,iBACGhE,yDAAMD,WAAWqS,CAAjB,KAA0BA,EAAKzR,gBAC/BX,yDAAMD,WAAW9lD,CAAjB,KAA0BA,EAAK0mD,eAEzBztE,KAAKE,IAAIxK,GAAO,KAAK0oD,WAAW48D,gCAAhC,IAEFtlH;QARuC;QAWvC6qF,mBAAmB/T,GAAU51E,GAAgB;AACpD,cACE41E,EAAIiB,gBACJ,CAACX,yDAAMtB,SAAS50E,CAAf,KACD,CAACk2E,yDAAMjB,iBAAiBj1E,CAAvB;AAED,mBAAO41E,EAAIplB,OAAO,KAAKhJ,WAAWkyB,+BAA+B;AAEnE,cAAIxD,yDAAMlB,cAAch1E,CAApB,KAA6BA,aAAgBo4E,+EAAiB;AAChE,kBAAMG,IAAiBv4E,EAAKu4E;AAC5B,gBACEA,KACAA,EAAeh7E,oBACfg7E,EAAe99D;AAEf,qBAAOm7D,EAAIplB,OAAO+nB,EAAev5E,SAAS;UAPoB;AAUlE,iBAAO,MAAM2qF,mBAAmB/T,GAAK51E,CAA9B;QAlB6C;QAqB7C2nF,UAAUvtE,GAAcmtE,GAAc;AAI7C,eACGntE,aAAiBqsE,wDAAcrsE,aAAiBssE,4DACjDa,EAAUtQ,iBACVsQ,EAAUpQ,UAAUgO,EAAAA,0CAAMl3E,QAC1BmM,EAAM+8D,UAAUgO,EAAAA,0CAAMr2E;AAEtB,iBAAK46G,wBAAwBn0G,IAAIgyE,GAAWntE,CAA5C;mBACSA,aAAiB2vB,8DAAgB;AAE1Cw9C,cAAU9Q,SAAS99E,KACjB,IAAIsvF,yEAAyB,KAAKzgC,YAAYptC,CAA9C,CADF;AAGAmtE,cAAU1Q,eAAe;AAED,qBAApB0Q,EAAUpQ,UACZoQ,EAAUpQ,QAAQ/8D,EAAM+8D;AAE1B;UAV0C;AAY5C,gBAAMwQ,UAAUvtE,GAAOmtE,CAAvB;QAvB6C;QA0BtCyB,qBAAqBpT,GAAUiT,GAAoB;AAC1D,cAAI,KAAK6gC,wBAAwB1pI,IAAI41F,CAAjC,GAAuC;AACzC,gBAAIg0C;AACJ,qBAAS/wH,IAAI,GAAGA,IAAI+8E,EAAIa,SAASl+E,QAAQM,KAAK;AAC5C,oBAAMmH,IAAO41E,EAAIa,SAAS59E,CAAb;uEACH+7E,SAAS50E,CAAf,MACF4pH,IAAmB5pH;AAErB,kBACEk2E,yDAAMxB,QAAQ10E,CAAd,KACAA,aAAgBupB,4DAChBvpB,EAAKstD,gBAAgB,KAAKo8D,wBAAwB1pI,IAAI41F,CAAjC;AAErB;YAV0C;AAa9C,gBAAIg0C,GAAkB;AACpBA,gBAAiB9qH,SAAS+pF;AAC1BjT,gBAAI92E,SAAS+pF;AACb;YAHoB;UAfmB;AAqB3C,gBAAMG,qBAAqBpT,GAAKiT,CAAhC;QAtB0D;QA8BlD8gC,mBAAgB;AACxB,gBAAME,IACJ,KAAKriE,WAAW+uB,oBAAoB,KAAK/uB,WAAWm0B;AACtD,cAAImuC,IAAUD;AAId,mBAAShxH,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,SAAS,GAAGM,KAAK,GAAG;AAChD,gBAAMkxH,IAAa,KAAKlnC,KAAKhqF,IAAI,CAAd;kBACb+8E,IAAM,KAAKiN,KAAKhqF,CAAV;AACZ,gBAAMmxH,IAAa,KAAKnnC,KAAKhqF,IAAI,CAAd;AAEboxH,gBACE,MAANpxH,IACI,CAAC,CAAC,KAAKuqF,OAAOtI,wBACd,CAAC,CAACivC,EAAWtvC;AACbyvC,gBACJrxH,IAAI,KAAK,KAAKgqF,KAAKtqF,SAAS,IACxB,CAAC,CAAC,KAAKmrF,UAAU/L,oBACjB,CAAC,CAACqyC,EAAWxvC;AAEnB,gBAAItE,yDAAMD,WAAWL,CAAjB,KAAyBA,EAAIiB,cAAc;AAC7CjB,gBAAIyB,QAAJ;AAEe,kBAAA,GAAoBv4E;AADnCgrH,kBACEl0C,EAAI92E,SAA6BA,SAAAA,IAAAA,SAApBA,IAAA82E,EAAIwB,aAAJt4E,KAAoBA,SAApBA,EAAoBA,SAAAA,IAAS,KAAK+qH;YAHJ,WAK7CI,MACO,MAANpxH,KAAWqxH,MACZh0C,yDAAMD,WAAWL,CAAjB,KACA,CAACA,EAAIiB,cACL;AACIgT,kBAAUjU,EAAIS;AACd8zC,kBAAkB;AACtB,uBAASh9G,IAAI,GAAGA,IAAIyoE,EAAIa,SAASl+E,QAAQ4U,KAAK;AAC5C,sBAAMnN,IAAO41E,EAAIa,SAAStpE,CAAb;AACT+oE,yEAAMtB,SAAS50E,CAAf,MACFmqH,IAAkBnqH;AAEhBmqH,sBAAoBj0C,yDAAMxB,QAAQ10E,CAAd,KAAuBk2E,yDAAMpB,QAAQ90E,CAAd,MAE3C6pF,IAAUigC,KACV,EACE5zC,yDAAMxB,QAAQ10E,CAAd,KACAA,aAAgBupB,6DACfvpB,EAAKkU,iBAAiBmxE,iDACrBrlF,EAAKkU,iBAAiByyG,oDAI1BwD,EAAgBrrH,SADGgrH,IAAUjgC;AAIjCA,qBAAW7pF,EAAKlB;cAnB4B;YAH9C;UAvB8C;QAP1B;QAgEhBsrH,4BAAyB;AAEjC,cAAK,KAAK7sH,oBAAqB,KAAKA,iBAAiB1L,gBAArD;AAGA,gBAAMw4H,IAAwB,KAAK9sH,iBAAiBs+B;AACpD,gBACI,eAAewuF,KAAyBA,EAAsBvuF,WADlE;AAMA,kBAAIguD,IAAU;AAEd,uBAASjxF,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,QAAQM,KAAK;AACzC,sBAAM+8E,IAAM,KAAKiN,KAAKhqF,CAAV;AACZ+8E,kBAAIplB,OAAOs5B;AACXA,qBAAWlU,EAAI52E;cAH0B;AAK3C,mBAAKA,SAAS8qF;AAGRg7B,kBAAc,KAAKphC,UAAU/L,oBAC/B,KAAK34E,SAAS,KAAK0kF,UAAU9L,kBAC7B,KAAK54E;AACH85E,kBAAmBuxC,EAAsBrrH,OAAO8lH,CAA7B;AACnB/rC,kBAAkBsxC,EAAsBvrH,MAAMgmH,CAA5B;AAExB,mBAAKvnH,iBAAiByB,SAAS85E;AAC/B,mBAAKv7E,iBAAiBuB,QAAQi6E;AAC9B,mBAAKx7E,iBAAiB28E,SAASnB;AAC/B,mBAAKx7E,iBAAiB86E,oBACpBgyC,EAAsBhyC,kBAAkBS,CAAxC;AACF,mBAAKv7E,iBAAiB+6E,oBACpB+xC,EAAsB/xC,kBAAkBS,CAAxC;AAIEuxC,kBAAuB;AACtB,mBAAKvE,qBAAsB,KAAKriC,UAAU/L,sBAC7C2yC,IAAuBvxC,GACvB,KAAK0wC,UAAWzqH,SAAS85E,GACzB,KAAK2wC,UAAW3qH,QAAQwrH,GACxB,KAAKb,UAAWrzC,aAAa0C,IAAmB,GAChD,KAAK2wC,UAAWpzC,OAAO,KAAKv3E,QAAQwrH;AAEtC,mBAAKpwC,SAASnB;AACd,mBAAKj6E,SAASi6E,IAAkBuxC;AAChC,mBAAK3nC,qBAAqB5J,IAAkBuxC;YA1C5C;UAJA;QAFiC;QAyDzBC,+BAA4B;AACpC,cACG,KAAKhtH,oBACDwoH,CAAL,KAAKA,qBACUpuC,CAAf,KAAK+L,UAAU/L,mBAHjB;AAOA,gBAAI6yC,IAAuB;AAC3B,qBAAS3xH,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,QAAQM,KAAK;AACzC,kBAAM+8E,IAAM,KAAKiN,KAAKhqF,CAAV;kBACR,CAACq9E,yDAAMD,WAAWL,CAAjB;AACH;AAGI60C,kBAAW70C,EAAIa,SAASb,EAAIa,SAASl+E,SAAS,CAAnC;AACjB,kBAAImyH,IAAiB,KAAKC,oBAFR/0C,EAAIa,SAAS,CAAbm0C,CAEG,GACjBC,IAAkB,KAAKF,oBAAoBF,CAAzB;AACtBD,kBAAuBE,IAAiBG;AACxC,oBAAMC,IACJ,KAAKtjE,WAAWq0B,kBAAgD,IAA9B,KAAKt+E,iBAAiBuB;AACtD,mBAAKA,QAAQ0rH,IAAuBM,MAGtCN,IAAuB,KAAK1rH,QAAQgsH,GACpCJ,IAAiBF,IAAuB,GACxCK,IAAkBL,IAAuB;AAG3C50C,gBAAIa,SAAS76E,QAAQ,IAAIw9E,uEAAY,KAAK5xB,YAAY,CAACkjE,CAAlC,CAArB;AACA90C,gBAAIa,SAAS99E,KAAK,IAAIygF;gBAAY,KAAK5xB;gBAAY,CAACqjE;cAAlC,CAAlB;YArByC;AAuB3C,gBAAIL;AAIF,mBAHA,KAAK1rH,SAAS0rH,GACd,KAAK7nC,qBAAqB6nC,GAC1B,KAAKf,UAAWpzC,QAAQm0C,GACf3xH,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,QAAQM;AAC9B+8E,oBAAM,KAAKiN,KAAKhqF,CAAV,GACRq9E,yDAAMF,iBAAiBJ,CAAvB,MACFA,EAAIa,SAAS,CAAb,EAAgB33E,SAAS0rH,IAE3B50C,EAAI92E,SAAS0rH,GACb50C,EAAIc,4BAA4B8zC;UAzCpC;QADoC;QAsD5BG,oBAAoB3qH,GAAgB;AAC5C,cAAI,CAACA,KAAQ,CAAC,KAAKzC;AACjB,mBAAO;AAET,gBAAMw7E,IAAkB,KAAKx7E,iBAAiBuB;AAC9C,cAAMisH,IAAa,KAAKxtH,iBAAiBs+B,MAAM3lC;AAC/C,gBAAM60D,IAAY,KAAKvD;AACvB,cAA4B,IAAxB,KAAKq/B,UAAUtuF;AACjB,oBAAQwyH,GAAR;cACE,KAAKhgE,EAAU0yB,OAAO8lC;AAOpB,uBALMhyC,IAAW,KAAK/pB,WAAW68D,oCAC3BvlH,IAAQ,KAAKE,SAAS,IAAIuyE,IAAWA,IAAW,KAAKvyE,SAAS,GAI7D+5E,IADLj6E,KAAS,IAAIsK,KAAK6pB,IAAI7pB,KAAKm8D,MAAMzmE,IAFhB,KAAK0oD,WAAW6zB,iBAEsBv8E,CAAjC,CAAT;cAGjB;AACE,uBAAO;YAXX;AAcF,cAAIo3E,yDAAMlB,cAAch1E,CAApB,KAA6BA,aAAgBo4E,+EAAiB;AAChE,kBAAMG,IAAiBv4E,EAAKu4E;AACtByyC,gBAAazyC,IACdA,EAAegK,WAA0BsjC,kBAC1C7lH,EAAK67B,MAAM3lC;AAaf,mBAZkB,QAAd80H,KAKFzyC,KACAA,EAAeh7E,qBACdg7E,EAAesV,uBAAuBtV,EAAe99D,mBAMtDswG,MAAehgE,EAAU0yB,OAAO6lC,aAChCyH,MAAeC,IAER,IAGPjyC,IACA,KAAKvxB,WAAWi8D,uBAAuBsH,CAAvC,EAAmDC,CAAnD;UAzB8D;AA2B3D,iBAAI90C,yDAAMxB,QAAQ10E,CAAd,KAAuBA,aAAgBupB,2DAG9CwhG,MAAehgE,EAAU0yB,OAAO8lC,SAChCvjH,EAAKkU,iBAAiBg1G,wDAEfnwC,IAAkB,OAAOhuB,EAAUq4D,YAG1CrqC,IAAkB,KAAKvxB,WAAWi8D,uBAAuBsH,CAAvC,EAAmD,CAAnD,IAEX70C,yDAAM/jF,OAAO6N,CAAb,IACF,KAAKwnD,WAAW6zB,gBAElB;QA/DqC;QAuEpC4vC,6BAA0B;AAClC,cAAS1tH,CAAL,KAAKA;AAKT,qBAAS1E,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,SAAS,GAAGM,KAAK,GAAG;AAChD,oBAAMkxH,IAAa,KAAKlnC,KAAKhqF,IAAI,CAAd,GACb+8E,IAAM,KAAKiN,KAAKhqF,CAAV,GACNmxH,IAAa,KAAKnnC,KAAKhqF,IAAI,CAAd;AAEnB,kBAAMqyH,IAAiB,MAANryH,GAIXqxH,IACJrxH,IAAI,KAAK,KAAKgqF,KAAKtqF,SAAS,IACxB,CAAC,CAAC,KAAKmrF,UAAU/L,oBACjB,CAAC,CAACqyC,EAAWxvC;AAEnB,kBARqB0wC,IACf,KAAK9nC,OAAOtI,wBACZivC,EAAWtvC,kBAMC;AAChB,oBAAMz6E,IAAO41E,EAAIa,SAAS,CAAb;AACP00C,oBACoB,MAAxBv1C,EAAIa,SAASl+E,UACbyH,aAAgBupB,6DACfvpB,EAAKkU,iBAAiBmxE,iDACrBrlF,EAAKkU,iBAAiByyG;AAC1B,oBAAI,CAACuE,KAAYC;AAEfpB,oBAAW/qH,UAAU,KAAKwoD,WAAW6zB,eACrC2uC,EAAWhrH,UAAU,KAAKwoD,WAAW6zB,eACrCzF,EAAI52E,UAAU,KAAKwoD,WAAWoxB;yBACrB,CAACsyC,KAAY,CAAChB;AAEvBH,oBAAW/qH,UAAU,KAAKwoD,WAAW6zB;yBAC5B6uC,GAAc;AAEnBkB,sBAA8B;AAElC,uBAASj+G,IAAI,GAAGA,IAAIyoE,EAAIa,SAASl+E,QAAQ4U;AAEvC,wBADMnN,IAAO41E,EAAIa,SAAStpE,CAAb,GAEXnN,aAAgBo4E,iFAChBlC,yDAAMlB,cAAch1E,CAApB,KACAA,EAAKu4E,kBACL,CAACv4E,EAAKu4E,eAAe19D,SAApB,KAPiCwwG,MAQlCrrH,EAAKu4E,eAAe7lD,eAApB,EAAqC1zB,QAErC;AACAosH,0BAA8B;AAC9B;oBAFA;AAOAA,wBACFrB,EAAW/qH,UAAU,KAAKwoD,WAAW6zB,eACrC2uC,EAAWhrH,UAAU,KAAKwoD,WAAW6zB;gBAtBhB;cAfT;YAd8B;QANhB;QAgE3BgM,YAAS;AAChB,eAAK+iC,0BAAL;eACKG,6BAAL;AACA,eAAKU,2BAAL;AACA,gBAAM5jC,UAAN;AAEI,eAAKoiC,cACP,KAAK9mC,qBAAqB,KAAK8mC,UAAU3qH;QAP3B;MAvlBd,GA1CN0sC,6CAAA,CAAA;AA0Cao7C,iDAAAA,aAAAA;ACnBP,UAAO+S,8DAAP,cAAyB2xB,6DAAzB;QAWJtuG,YACEvgB,GACAsuD,GACA9E,GAAc;AAEd,gBAAMxpD,GAAWsuD,GAAW9E,CAA5B;AAZM,eAAAslE,eAAwC;QAUhC;QAURC,oBAAoBnxB,GAAgB;AAC1C,gBAAM/uG,IAAQ+uG,EAAQt+E,eAAR;AAER6iD,cADay7B,EAAQ/D,YAAR/7E,EACcwqE,iBAAX;AAEtB,eAAK0mC,eAAe7sD,EAAcx8D,GAAGw8D,EAAct8D,CAAnD;AACA,eAAK83F,WAAW9uG,CAAhB;AACA,eAAKswG,aAAL;QAP0C;QAUnCf,gBAAgBR,GAAgB;AACvC,eAAKmxB,oBAAoBnxB,CAAzB;QADuC;QAIhCS,eAAeT,GAAgB;AACtC,eAAKmxB,oBAAoBnxB,CAAzB;QADsC;QAS/BO,eAAeP,GAAgB;AAChC/uG,cAAQ+uG,EAAQ/D,YAAR;AAGd,gBAAM0F,IAAc1wG,EAAMonC,eAAN;eAGfopE,cAAc,GAAG,GAAGE,EAAYl9F,OAAOk9F,EAAYh9F,MAAxD;AACA,eAAKo7F,WAAW9uG,CAAhB;AACA,eAAKswG,aAAL;QATsC;QAkBhC6vB,eAAerpH,GAAWE,GAAS;AACpCipH,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,iBAAAA,EAAcrsH,aAAa,MAAM,GAAGkD,CAAH,EAAtC;AACKmpH,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,iBAAAA,EAAcrsH,aAAa,MAAM,GAAGoD,CAAH,EAAtC;AACA,eAAK23F,mBAAmB,KAAKsxB;QAHY;QAMlCvhI,OAAI;AACX,gBAAMA,KAAN;AACI,eAAKuhI,iBACP,KAAKA,aAAalmH,MAAMkB,UAAU;QAHzB;QAOJ4zF,qBAAkB;AAWzB,gBAAMA,mBAAN;AAEA,eAAKoxB,eAAmBxpI;YACtBqwC,qCAAIC;YACJ,EACE,GAAK,KAAKm1B,WAAW67D,eACrB,gBAAgB,KAAK77D,WAAW61B,oBAFlC;YAIA,KAAKt3B;UANa;AAQpB,eAAK/7D,KAAL;AAGA,cAAI,KAAKovG,SAAL,GAAiB;AACnB,kBAAMiD,IAAkB,KAAKD,oBAAL;AACpBr6G,8DAAiBqwC,qCAAIG,SAAS8pE,GAAiB,KAAKkvB,YAAxD;UAFmB;AAKrB,iBAAO,KAAKxlE;QA7Ba;QAgClBu0C,aAAaD,GAAgB;AACpC,gBAAMC,aAAaD,CAAnB;AAEKkxB,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,iBAAAA,EAAcrsH,aAAa,QAAQ,KAAK6tF,OAA7C;AACKw+B,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,iBAAAA,EAAcrsH,aAAa,UAAU,KAAK6tF,OAA/C;AAEA,cAAI,KAAKqM,SAAL,GAAiB;AACbvoF,gBAAS,KAAKk8E,UAAU;AACzBw+B,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,iBAAAA,EAAc/uB,kBAAmBt9F,aAAa,UAAU2R,CAA7D;UAFmB;QANe;MA9GlC,GAvBN26B,mDAAA,CAAA;AAuBamuD,uDAAAA,YAAAA;ACFP,UAAO8C,gEAAP,cAA0BivB,+DAA1B;QA4BJ1uG,YACEqb,GACAhzB,GACA0lD,GAA2B;AAE3B,gBAAM1yB,GAAMhzB,GAAO0lD,CAAnB;AA/BM,eAAA4gE,kBAAqC;AAG5B,eAAAC,WAAW,oBAAI38E;AAQxB,eAAA48E,oBAAoB,oBAAI3yH;AAMhC,eAAA2sH,kBAAiC;AAgB/B,eAAK96D,YAAYA;QAJU;QAOpBy3B,QAAQqa,GAAkB;AACjC,gBAAMra,QAAQqa,CAAd;AACI,eAAK8uB,mBACP,KAAKA,gBAAgBzsH,aAAa,KAAK29F,CAAvC;QAH+B;QAO1B9/D,YAAYzxC,GAAe;AAClC,gBAAMyxC,YAAYzxC,CAAlB;AAEA,gBAAM0R,IAAS1R,EAAM2R,UAAN;AACX3R,YAAMuvB,SAAN,KAAoB7d,KACtB,KAAK4/F,QAAQ19F,aAAa,UAAUlC,EAAOqI,MAAMi7D,cAAjD;qBAISwrD,KAAW,KAAKF,SAAS/6G,OAAd;AACpBi7G,cAAQ5sH,aAAa,QAAQ,KAAKmG,MAAMi7D,cAAxC;QAVgC;QAc3BmiB,UAAO;AACd,gBAAMA,QAAN;AAEA,qBAAWqpC,KAAW,KAAKF,SAAS/6G,OAAd;AACpBi7G,cAAQ5sH,aAAa,aAAa,aAAlC;QAJY;QAQPg+F,eAAenhG,GAAe;AACrC,eAAKihG,UAAU,mBAAmBjhG,CAAlC;AACIA,cACG,KAAK4vH,oBACR,KAAKA,kBAAkB,KAAK/uB,QAAQhvE,UAAU,IAAvB,GACvB,KAAK+9F,gBAAgBzsH,aAAa,QAAQ,MAA1C,GACA,KAAKysH,gBAAgBzsH,aACnB,UACA,UAAU,KAAK6rD,UAAU+4D,uBAAuB,GAFlD,GAIA,KAAKroE,QAAQ33C,YAAY,KAAK6nH,eAA9B,KAGE,KAAKA,oBACP,KAAKlwE,QAAQ12C,YAAY,KAAK4mH,eAA9B,GACA,KAAKA,kBAAkB;QAfU;QAoB9BruB,sBAAsBvhG,GAAe;AAC5C,eAAKihG,UAAU,sBAAsBjhG,CAArC;AACIA,cACF,KAAK6gG,QAAQ19F,aACX,UACA,UAAU,KAAK6rD,UAAUi5D,0BAA0B,GAFrD,IAKA,KAAKpnB,QAAQ9uE,gBAAgB,QAA7B;QAR0C;QAYrCyvE,6BAA6B5sC,GAAkB50D,GAAe;AAC/D5F,cAAOw6D,EAAKtD,eAAL,EAAuBl3D;AAEpC,WADM2tF,IAAc,KAAKioC,eAAe51H,CAApB,OAIhB4F,IACF+nF,EAAY5kF,aACV,UACA,UAAU,KAAK6rD,UAAUi5D,0BAA0B,GAFrD,IAKAlgC,EAAYh2D,gBAAgB,QAA5B;QAZmE;QAmBvE83F,eAAY;AACV,eAAKiG,kBAAkBz9F,MAAvB;qBACW52B,KAAO,KAAKo0H,SAASn0H,KAAd;AAChB,iBAAKo0H,kBAAkBjnH,IAAIpN,CAA3B;QAHQ;QAUZsuH,aAAU;AAGR,cAAI,KAAK+F,kBAAkBr+G;AACzB,uBAAWhW,KAAO,KAAKq0H;AACrB,mBAAKG,kBAAkBx0H,CAAvB;AAGJ,eAAKq0H,kBAAkBz9F,MAAvB;QARQ;QAkBVq4F,eAAetwH,GAAc0mG,GAAkB;AACvCivB,cAAU,KAAKC,eAAe51H,CAApB;AAChB21H,YAAQ5sH,aAAa,KAAK29F,CAA1B;AACAivB,YAAQ5sH,aAAa,QAAQ,KAAKmG,MAAMi7D,cAAxC;QAH6C;QAYvCyrD,eAAe51H,GAAY;AAC5B,eAAKy1H,SAASl2G,IAAIvf,CAAlB,KACH,KAAKy1H,SAASr2G,IACZpf,GACIpU,kDACFqwC,qCAAIif,MACJ;YACE,SAAS;YAGT,GAAK;UAJP,GAMA,KAAKoK,OARP,CAFF;AAcF,eAAKowE,kBAAkB31G,OAAO/f,CAA9B;AACA,iBAAO,KAAKy1H,SAAS5rI,IAAImW,CAAlB;QAjB0B;QAyB3B61H,kBAAkB71H,GAAY;AACpC,cAAA,GAAyB2O;AAAzB,mBAAA,IAAA,KAAK8mH,SAAS5rI,IAAImW,CAAlB,MAAA,SAAyB2O,IAAzBA,EAAyBA,eAAAA,EAAYC,YAAY,KAAK6mH,SAAS5rI,IAAImW,CAAlB,CAAjD;AACA,eAAKy1H,SAAS11G,OAAO/f,CAArB;QAFoC;MAvLlC,GArBNq1C,oDAAA,CAAA;AAqBaixD,wDAAAA,aAAAA;ACWP,UAAO4F,2DAAP,cAAwB4pB,0DAAxB;QAMJjvG,YAAY7mB,GAAY;AACtB,gBAAMA,CAAN;QADsB;QASLosG,iBAAc;AAC/B,iBAAO,IAAInnB;QADoB;QAUdsnB,gBAAgBp3G,GAAe;AAChD,iBAAO,IAAIs7F,uDAAW,MAAMt7F,CAArB;QADyC;QAY/Bq3G,YACjBr3G,GACAw2F,GAAoB;AAEpB,iBAAO,IAAID,qDAAOv2F,GAAOw2F,CAAlB;QAFa;QAYb17B,iBACP3pD,GACAwpD,GAAc;AAEd,iBAAO,IAAI0zC;YAAUl9F;YAAW,KAAKusD,aAAL;YAAqB/C;UAA9C;QAFO;QAYP28C,eAAevqE,GAAkBhzB,GAAiB;AACzD,iBAAO,IAAIo3F,8DAAWpkE,GAAMhzB,GAAO,KAAK2jD,aAAL,CAA5B;QADkD;QAUlDA,eAAY;AACnB,iBAAO,KAAKxB;QADO;QAQZg5C,2BACPxiE,GACAghE,GACAjvE,GAAkB;AAENp/B,wDACV,8BACA,OACA,OACA,wDAJF;AAMA,iBAAIquG,EAAM9oG,SAAS85D,sDAAeE,eAC3BlyB,EAAQlN,YAAR,IAQEitE,uEAAuB2C,aAAaK,mBAPlChD,uEAAuB2C,aAAaC,gBAUxC,MAAMH,2BAA2BxiE,GAASghE,GAAOjvE,CAAjD;QApBW;MAtFhB;AA8GSpxC,uEAAS,SAAS0jH,wDAAjC;AA9IA,UAAA72D,iDAAA,CAAA;AAgCa62D,qDAAAA,WAAAA;ACfP,UAAO6pB,6EAAP,MAAA;QAWJlvG,YAAYmvG,GAAsB;AAF1B,eAAAC,aAFA,KAAAC,cAFA,KAAAxqB,aAFA,KAAAzD,aAA8B;AASpC,eAAK3hG,YAAY0vH,EAAa1vH;QADE;QAelC45G,mBACEgW,GACAD,GACAE,GAAuB;AAEZzwH,YAAAA,4CAAX;AACA,cAAI;AACF,iBAAKkjG,YAAL,GACA,KAAKX,aAAakuB,GAClBA,EAAcpqB,mBAAmB,IAAjC,GACI,KAAKzlG,UAAU2jB,YAAf,EAA6B6gF,0BAA0BmrB,CAAvD,MACFA,EAAWxoE,UAAX,GACA,KAAKwoE,aAAaA;UANlB,UAAJ;AASarwH,cAAAA,2CAAX;UADQ;QAXa;QAwBzBu6G,kBACE+V,GACAD,GAA8B;AAE9B,cAAIC,MAAgB,KAAKA,eAAeD,MAAe,KAAKA,YAA5D;AAIWvwH,cAAAA,4CAAX;AACA,gBAAI;AACF,mBAAKkjG,YAAL,GAMI,KAAKwtB,uBAAuBF,GAAaD,CAAzC,MACF,KAAKvqB,aAAa,KAAK2qB,cAAcH,GAAaD,CAAhC,IAGhB,KAAK3vH,UAAU2jB,YAAf,EAA6B6gF,0BAA0BmrB,CAAvD,KACFA,EAAWxoE,UAAX,GAGF,KAAKyoE,cAAcA,GACnB,KAAKD,aAAaA;YAhBhB,UAAJ;AAkBarwH,gBAAAA,2CAAX;YADQ;UAtBV;QAF8B;QA6BxBwwH,uBACNE,GACAL,GAA8B;AAE9B,iBACEA,EAAWl2H,SAAS85D,sDAAeI,sBACnCg8D,EAAWl2H,SAAS85D,sDAAeG,kBACnC,EAAE,KAAK1zD,UAAU2jB,YAAf,aAAwCssG;QALd;QASxBF,cACNH,GACAD,GAA8B;AAE9B,gBAAMO,IAAUN,EAAYtwG,eAAZ,GACVkqC,IAAS,KAAK2mE,sBAAsBD,CAA3B,GACT9qB,IAAa,KAAK5R,sBAAsB08B,GAAS1mE,GAAQomE,CAA5C;AACnB,cAAI,CAACxqB;AAAY,mBAAO;AAIxB57C,YAAO5/D,YAAP;AACiBE,wEAAjB;AAGAs7G,YAAWxlF,QAAQ+vG,CAAnB;AAEA,gBAAM3qB,IAAyB,EAC7Br/F,GAAGgqH,EAAWhqH,IAAIy/F,EAAWz/F,GAC7BE,GAAG8pH,EAAW9pH,IAAIu/F,EAAWv/F,EAFA,GAIzBo/F,IAAwBG,EAAW9c,iBAAX,EAA8BtzD,MAA9B;AACbnrC,uEAAjB,EAAuC44G,KAAK,MAAK;AAC/C,gBAAI,CAAAj5C,EAAOjd,cAAP,GAAJ;AACWntC,gBAAAA,4CAAX;kBACI;AAEF,wBAAAoqD,KAAAA,EAAQ27C,uBACNC,GACAJ,GACAC,CAHF,GAKA,QAAAz7C,KAAAA,EAAQ5mC,WAAR,EAAqBngB,aAAa,cAAc,SAAhD;cAPE,UAAJ;AASanD,kBAAAA,2CAAX;cADQ;YAVV;UAD+C,CAAjD;AAeA,iBAAO8lG;QAnCuB;QAsCxB+qB,sBAAsBC,GAAmB;AAC/C,gBAAMntB,IAAmB54G,iDAAK+lI,GAAW,EACvCn2G,gBAAgB,OAChByC,gBAAgB,OAChBC,eAAe,OACfC,qBAAqB,MAJkB,CAAvB;AAOlB,cAAI,CAACqmF;AACH,kBAAUlpG,MACR,qCAAqCq2H,EAAUvoE,YAAV,CAArC,EADI;AAKF39C,cAAgB5f,mDAAO24G,GAAW,KAAKjjG,SAA9B;AAIf,qBAAWnR,KAASqb,EAAOtK,eAAe,KAAtB;AAClB/Q,cAAMwkG,mBAAmB,IAAzB;YAGKpyE,QAAP;AACA/W,YAAO0Y,WAAP,EAAoBngB,aAAa,cAAc,QAA/C;AACA,iBAAOyH;QAxBwC;QAoCzCspF,sBACN68B,GACA7mE,GACA8mE,GAA4B;AAEtBC,cAAYF,EAAK/uF,gBAAgB,IAArB;AACZkvF,cAAchnE,EAAOloB,gBAAgB,IAAvB;AACpB,cAAIivF,EAAUz0H,WAAW00H,EAAY10H;AAAQ,mBAAO;AACpD,mBAASM,IAAI,GAAGA,IAAIm0H,EAAUz0H,QAAQM;AACpC,gBAAIm0H,EAAUn0H,CAAV,MAAiBk0H;AACnB,qBAAOE,EAAYp0H,CAAZ;AAGX,iBAAO;QAVqB;QAc9BkmG,cAAW;AACEljG,YAAAA,4CAAX;AACA,cAAI;AACE,iBAAKuwH,eACP,KAAKA,WAAWjrB,YAAhB,GACA,KAAKirB,aAAa,OAEhB,KAAKhuB,eACP,KAAKA,WAAW8D,mBAAmB,KAAnC,GACA,KAAK9D,aAAa,OAEhB,KAAKyD,eACP,KAAKP,oBAAoB,KAAKO,UAA9B,GAEA,KAAKwqB,cADL,KAAKxqB,aAAa;UAXlB,UAAJ;AAea9lG,cAAAA,2CAAX;UADQ;QAhBD;QAqBHulG,oBAAoBO,GAA8B;AACxD,gBAAM57C,IAAS47C,EAAW9lF,eAAX,GAETgmF,IAAe97C,EAAO1oD;AAEvBykG,cAAAA;AAAL,eAAiB3lE,SAAZ2lE,IAHc/7C,EAAOzoD,sBAGT6+B,IAAZ2lE,EAAY3lE,sBAAmCA,QAAd0lE,IAAc1lE,IAAd0lE,EAAc1lE;AAMlD4pB,cAAOilC,OAAO,IAAd;eANoE;AAIpE,gBAAA;AAAA,qBAAA,IAAA2W,EAAWjnF,YAAX,MAAA,EAA0BswE,OAAO,KAAjC;UAJoE;AAStEjlC,YAAO56D,QAAP;QAdwD;QAkB1DA,UAAO;AACL,eAAK0zG,YAAL;QADK;MAnOH;+CAyOKzoG,qCAAKw0C,sBACLjzC,yCACTq0H,0EAHF;AAzPA,UAAA1gF,mDAAA,CAAA;AAiBa0gF,uDAAAA,2BAAAA;ACjBb,UAAA1gF,+BAAA,CAAA;AAeE25C,mCAAAA,QAAAA,EAAAA;AAEAsB,mCAAAA,aAAAA;AACAC,mCAAAA,cAAAA;AAFAhB,mCAAAA,QAAAA;AAGA37C,mCAAAA,iBAAAA;mCACA48C,aAAAA,EAAAA;AACA1qE,mCAAAA,aAAAA,EAAAA;AzKoSF,UAAIirB,oDAAsB,OAzT1BsE,+BAAA,CAAA;AAmCgB1pD,mCAAAA,SAAAA;A0KnChB0pD,UAAAA;QAuCa0hF,iDAAP,MAAA;QA4FJlwG,YAAY7mB,GAAY;AA1ExB,eAAAg3H,WAGIp2H,uBAAOC,OAAO,IAAd;AAQJ,eAAAo2H,6BAA6B;AAsB7B,eAAAC,mBAPA,KAAAC,mBAPA,KAAAC,qBAAoC;AAoBpC,eAAAC,SAAS;AAMT,eAAAC,eAAe;AAGf,eAAAC,kBAA8B,CAAA;AAQ9B,eAAAC,gBAAgC;AAGtB,eAAAC,kBAAkB;AAGlB,eAAAC,eAAwC92H,uBAAOC,OAAO,IAAd;AAMxC,eAAA82H,iBAA0C/2H,uBAAOC,OAAO,IAAd;AAGpD,eAAA+2H,UAAkBx0H;AAIhB,eAAKm1C,QAAQv4C;AAEb,eAAK63H,oCAAoC,IAAIC;YAC3C,KAAKb;YACL;UAFuC;QAHnB;QAexBc,gBAAgBzxH,GAAqB;AAC9BA,gBAEHtF,QAAQxG,KACN,4DADF,GAGA8L,IAAmBnc,+CAAP;AAEd,cAAM6tI,IAAO,CAAA;AACb,eAAK77H,KAAKmK,CAAV;AACMsD,cAAStD,EAAUsvB,aAAa,IAAvB;AACf,mBAASlzB,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA,KAAK;AAC/C,gBAAI5H,IAAO,KAAKm9H,YAAY9iI,CAAjB;AACP0P,kBAAMyR,QAAQxb,CAAd,MAGFA,IAAOA,EAAK,CAAL;AAELA,kBACE3F,EAAMiS,qBAGRtM,IAAO,KAAKo9H,gBAAgBp9H,CAArB,GACH,KAAKq8H,oBAAoB,CAAChiI,EAAM2hG,yBAClCh8F,IAAO,KAAKq9H,SAAS,KAAKhB,kBAAkBhiI,CAArC,IAA8C2F,IAEnD,KAAKo8H,oBAAoB,CAAC/hI,EAAM2hG,yBAC3Bh8F,KAAO,KAAKq9H;cAAS,KAAKjB;cAAkB/hI;YAArC,KAGlB6iI,EAAKx1H,KAAK1H,CAAV;UAnB6C;AAuB7Cs9H,cAAaJ,EAAK/zH,KAAK,IAAV;AACjBm0H,cAAa,KAAKC,OAAOD,CAAZ;AAEbA,cAAaA,EAAW/qH,QAAQ,UAAU,EAA7B;AACb+qH,cAAaA,EAAW/qH,QAAQ,UAAU,IAA7B;AAEb,iBADA+qH,IAAaA,EAAW/qH,QAAQ,aAAa,IAAhC;QAvCsB;QAmDrCirH,YAAY1oH,GAAc4uB,GAAc;AACtC,iBAAOA,IAAS5uB,EAAKvC,QAAQ,cAAc,OAAOmxB,CAAlC;QADsB;QAUxC+5F,kBAAkBpjI,GAAY;AAC5B,gBAAMs+C,IAAW,CAAA;AACX7pC,cAASzU,EAAM+Q,eAAe,IAArB;AACf,mBAASxD,IAAI,GAAGA,IAAIkH,EAAOxH,QAAQM,KAAK;AACtC,kBAAM4d,IAAU1W,EAAOlH,CAAP,EAAU2zB,eAAV;AACZ/V,iBACFmzB,EAASjxC,KAAK8d,CAAd;UAHoC;AAOpCmzB,YAASrxC,UACXqxC,EAASjxC,KAAK,EAAd;AAEF,iBAAOixC,EAASxvC,KAAK,IAAd;QAbqB;QA0B9Bg0H,YACE9iI,GACAqjI,GAAsB;AAEK,oBAAvB,KAAKhB,iBACPx2H,QAAQxG,KACN,kEADF;AAIF,cAAI,CAACrF;AACH,mBAAO;AAET,cAAI,CAACA,EAAM1L,UAAN;AAEH,mBAAO+uI,IAAe,KAAK,KAAKP,YAAY9iI,EAAMoS,aAAN,CAAjB;AAE7B,cAAIpS,EAAMguB,kBAAN;AAEF,mBAAOq1G,IAAe,KAAK,KAAKP,YAAY9iI,EAAM6qB,YAAY,KAAlB,EAAyB,CAAzB,CAAjB;AAK7B,cAAMpV,IAAO,KAAKosH,SAAS7hI,EAAM4K,IAApB;AACb,cAAoB,eAAhB,OAAO6K;AACT,kBAAMvK,MACJ,GAAG,KAAKk4C,KAAR,iEACqBpjD,EAAM4K,IAAzB,IAFE;AAUJi4H,cAAOptH,EAAKG,KAAK5V,GAAOA,GAAO,IAAxB;AACX,cAAI0P,MAAMyR,QAAQ0hH,CAAd,GAAqB;AAEvB,gBAAI,CAAC7iI,EAAMiS;AACT,oBAAMgQ,UAAU,4CAA4CjiB,EAAM4K,IAA5D;AAER,mBAAO,CAAC,KAAK04H,OAAOtjI,GAAO6iI,EAAK,CAAL,GAASQ,CAA5B,GAA2CR,EAAK,CAAL,CAA5C;UALgB;AAMlB,cAAoB,aAAhB,OAAOA;AAOhB,mBANI,KAAKb,oBAAoB,CAAChiI,EAAM2hG,yBAClCkhC,IAAO,KAAKG,SAAS,KAAKhB,kBAAkBhiI,CAArC,IAA8C6iI,IAEnD,KAAKd,oBAAoB,CAAC/hI,EAAM2hG,yBAC3BkhC,KAAO,KAAKG,SAAS,KAAKjB,kBAAkB/hI,CAArC,IAET,KAAKsjI,OAAOtjI,GAAO6iI,GAAMQ,CAAzB;AACF,cAAa,SAATR;AAET,mBAAO;AAET,gBAAMU,YAAY,6BAA6BV,CAAzC;QApDgB;QAiExBW,YAAYxjI,GAAc6K,GAAc44H,GAAkB;AACxD,cAAI7lG,MAAM6lG,CAAN;AACF,kBAAMxhH,UAAU,uCAAuCjiB,EAAM4K,IAAvD;AAER,cAAM0kB,IAActvB,EAAMmpG,oBAAoBt+F,CAA1B;AACpB,cAAI,CAACykB,KAAe,CAACtvB,EAAMkyB,SAASrnB,CAAf;AACnB,kBAAM64H,eAAe,UAAU74H,CAAV,uBAAqC7K,EAAM4K,IAA3C,GAAf;AAER,cAAI,CAAC0kB;AACH,mBAAO;AAEHia,cAAQ,KAAKu5F,YAAYxzG,CAAjB;AACd,cAAc,OAAVia;AAEF,mBAAO;AAIT,cAAI,CAAC75B,MAAMyR,QAAQooB,CAAd;AACH,kBAAMtnB,UACJ,qCAAqCqN,EAAY1kB,IAAjD,qGADI;AAMJi4H,cAAOt5F,EAAM,CAAN;AACLo6F,cAAap6F,EAAM,CAAN;AACnB,cAAI3L,MAAM+lG,CAAN;AACF,kBAAM1hH,UACJ,6CAA6CqN,EAAY1kB,IADrD;AAIR,cAAI,CAACi4H;AACH,mBAAO;AAILe,cAAe;AACnB,cAAMC,IAAkB/lH,KAAK+Y,MAAM4sG,CAAX;AACxB,gBAAMK,IAAkBhmH,KAAK+Y,MAAM8sG,CAAX;AACxB,cAAIE,KAAmBC,MAEnBD,MAAoBC,KACC,MAApBD,KAA6C,OAApBA;AAY1B,iBAFAD,IAAe,MAENr2H,IAAI,GAAGA,IAAI,KAAK60H,gBAAgBn1H,QAAQM;AAC/C,kBACE,KAAK60H,gBAAgB70H,CAArB,EAAwB,CAAxB,MAA+Bk2H,KAC/B,KAAKrB,gBAAgB70H,CAArB,EAAwB,CAAxB,MAA+Bo2H,GAC/B;AACAC,oBAAe;AACf;cAFA;;AAOJA,gBAGFf,IAAO,MAAMA,IAAO;AAEtB,iBAAOA;QAvEiD;QAoF1DkB,gBAAgB/jI,GAAc6K,GAAY;AACxC,gBAAMykB,IAActvB,EAAMmpG,oBAAoBt+F,CAA1B;AACpB,cAAI,CAACykB,KAAe,CAACtvB,EAAMkyB,SAASrnB,CAAf;AACnB,kBAAM64H,eAAe,UAAU74H,CAAV,uBAAqC7K,EAAM4K,IAA3C,GAAf;AAEJi4H,cAAO,KAAKC,YAAYxzG,CAAjB;AAGX,cAAoB,aAAhB,OAAOuzG;AACT,kBAAM5gH,UACJ,2CACGqN,KAAeA,EAAY1kB,KAF1B;AAKJi4H,gBACFA,IAAO,KAAKM,YAAYN,GAAM,KAAKX,MAA5B;AAET,iBAAOW;QAjBiC;QA8B1CmB,YAAYC,GAAgBjkI,GAAY;AAClC,eAAKiiI,uBACPgC,IACE,KAAKd,YACH,KAAKH,SAAS,KAAKf,oBAAoBjiI,CAAvC,GACA,KAAKkiI,MAFP,IAGI+B;AAEJ,eAAKlC,oBAAoB,CAAC/hI,EAAM2hG,yBAClCsiC,IACE,KAAKd,YACH,KAAKH,SAAS,KAAKjB,kBAAkB/hI,CAArC,GACA,KAAKkiI,MAFP,IAGI+B;AAEJ,eAAKjC,oBAAoB,CAAChiI,EAAM2hG,yBAEhCsiC,KACA,KAAKd,YACH,KAAKH;YAAS,KAAKhB;YAAkBhiI;UAArC,GACA,KAAKkiI,MAFP;AAKJ,iBAAO+B;QAvB+B;QAkCxCjB,SAASj3H,GAAa/L,GAAY;AAC1BiR,cAAKjR,EAAMiR,GAAGiH,QAAQ,OAAO,MAAxB;AACX,iBAAOnM,EAAImM,QAAQ,OAAO,MAAMjH,IAAK,GAA9B;QAFyB;QAWlCizH,iBAAiBzsG,GAAa;AAC5B,eAAK6qG,mBAAmB7qG,IAAQ;QADJ;QAwB9B0sG,iBAAiBC,GAAqBvB,GAAuB;AAC3D,cAAI,CAAC,KAAKN,aAAa6B,CAAlB,GAAgC;AACnC,kBAAMC,IAAe,KAAK5B,QAAS9vD,gBACjCyxD,GACAhyD,EAAAA,sCAASa,SAFU;AAIrB,iBAAKuvD,eAAe4B,CAApB,IAAmCC;AAC/B30H,kBAAMyR,QAAQ0hH,CAAd,MACFA,IAAOA,EAAK/zH,KAAK,IAAV;AAELw1H,gBAAWzB,EACZ53H,KADY,EAEZiN,QAAQ,KAAKwqH,mCAAmC2B,CAFpC;AAOf,gBAAIE;AACJ,mBAAOA,MAAgBD;AACrBC,kBAAcD,GACdA,IAAWA,EAASpsH,QAAQ,oBAAoB,MAArC;AAEbosH,gBAAWA,EAASpsH,QAAQ,OAAO,KAAKgqH,MAA7B;iBACNK,aAAa6B,CAAlB,IAAiCE;UAtBE;AAwBrC,iBAAO,KAAK9B,eAAe4B,CAApB;QAzBoD;QAsC7DI,gBAAgBlyD,GAAgB;AAC9B,iBAAO,KAAK/pD,QAAQ+pD,GAAUF,EAAAA,sCAASC,QAAhC;QADuB;QAahCoyD,iBAAiB55H,GAAY;AAC3B,iBAAO,KAAK0d,QAAQ1d,GAAMunE,EAAAA,sCAASa,SAA5B;QADoB;QAIrB1qD,QAAQ+pD,GAAkB1nE,GAAc;AAC9C,cAAI,CAAC,KAAK63H;AACR,kBAAUv3H,MACR,4GADI;AAIR,iBAAO,KAAKu3H,QAAQl6G,QAAQ+pD,GAAU1nE,CAA/B;QANuC;QAgBhD5D,KAAKu7G,GAAqB;AAGxB,eAAKggB,eAAe92H,uBAAOC,OAAO,IAAd;AAIpB,eAAK82H,iBAAiB/2H,uBAAOC,OAAO,IAAd;QAPE;QAsB1B43H,OAAO72C,GAAeo2C,GAAc6B,GAAuB;AAEzD,iBAAO7B;QAFkD;QAa3DK,OAAOL,GAAY;AAGjB,eAAKN,eAAe92H,uBAAOC,OAAO,IAAd;AACpB,eAAK82H,iBAAiB/2H,uBAAOC,OAAO,IAAd;AACtB,iBAAOm3H;QALU;QAiBnBE,gBAAgBp9H,GAAY;AAE1B,iBAAOA;QAFmB;MAvjBxB;AAvCNu6C,wCAAA,CAAA;AAuCa0hF,sCAAAA,gBAAAA,EAAAA;AClBP,UAAO+C,qEAAP,cAAoCpP,sDAApC;QAQJ7jG,YAAYvgB,GAAyBmpC,GAAe;AAClD,gBAAMnpC,CAAN;AACA,eAAKyzH,UAAUtqF;QAFmC;QAW5CuqF,kBAAe;AAGrB,cAAIC;AACJ,cAAI;AACFA,gBAAmB,KAAKtP,WAAWx5C,UAAhB,EAA4B1qB,QAA5B;UADjB,SAEKlkD,GAAG;AAIV03H,gBAAmB,EAACpxH,QAAQ,GAAGsD,GAAG,GAAGxD,OAAO,GAAGsD,GAAG,EAA/B;UAJT;AAMZ,iBAAOguH;QAZc;QAedvO,kBAAkBH,GAAqC;AAE9D,gBAAM0O,IAAmB,KAAKD,gBAAL;AACnB30H,cAAQkmH,IAA8B,IAAI,KAAKZ,WAAWtlH;AAEhE,iBAAO,EACLwD,QAAQoxH,EAAiBpxH,SAASxD,GAClCsD,OAAOsxH,EAAiBtxH,QAAQtD,GAChCiL,KAAK2pH,EAAiB9tH,IAAI9G,GAC1BkL,MAAM0pH,EAAiBhuH,IAAI5G,EAJtB;QALuD;QAavDqjC,iBACP6iF,GACAM,GACAS,GAAoC;AAE9BJ,cAAiBI,KAAsB,KAAKZ,kBAAL;AACvC5yG,cAAS,KAAKihH,QAAQvoD,SAAS,KAAKm5C,WAAWtlH;AAC/CA,cAAQkmH,IAA8B,KAAKZ,WAAWtlH,QAAQ;AAOpE,iBAAO,EACLwD,SAASqjH,EAAerjH,SAAS,IAAIiQ,KAAUzT,GAC/CsD,QAAQujH,EAAevjH,QAJLujH,EAAe37G,OAIYuI,KAAUzT,GACvDiL,KAAK,GACLC,MAAM,EAJD;QAX6B;MAlDlC,GArBN8kC,+CAAA,CAAA;AAqBaykF,mDAAAA,uBAAAA;ACoBb,UAAKI;AAAL,OAAA,SAAKA,GAAc;AACjBA,UAAA7mF,QAAA;AACA6mF,UAAAz4B,SAAA;MAFiB,GAAdy4B,sDAAAA,oDAAc,CAAA,EAAnB;UASMC,iFACJ,+BAKoBC,4CAAhB,cACI/V,8CADJ;QA4NJx9F,YAAY+pD,GAAyB;AACnC,gBAAA;AA5IF,eAAAl4D,mBAAmB;AAQX,eAAA+nC,cAAoC,CAAA;AAapC,eAAA45E,gBAPA,KAAAC,gBAAqD;AAarD,eAAAC,OAAqB,CAAA;AAKnB,eAAAC,WAA2B,CAAA;AAK3B,eAAA5jH,WAAyB,CAAA;AAK3B,eAAA25F,YAAkC,CAAA;AAKlC,eAAAkqB,sBAA+B,CAAA;AAc/B,eAAAC,iBAA6B,CAAA;AAKrC,eAAAh5D,YAAY;AAKJ,eAAAozC,aAAa;AAKb,eAAAz4D,mBAAmB;AAMlB,eAAA8nC,gBAAwB;AAQxB,eAAAw2C,mBAA2B;AAU1B,eAAAC,UALA,KAAAC,SAAS;AA4BT,eAAAC,kBAAkB;AAWlB,eAAAj3B,YALA,KAAAoT,iBAAwC;AAYhDrmC,YAAiB//B,aAAa,KAAKkqF,YAAY3vI,KAAK,IAAtB;AAE9B,eAAKu/H,aAAa,IAAI58E,kDAAa6iC,CAAjB;AAClB,eAAK+5C,WAAW/T,kBACd,IAAIkjB,mEAAqB,KAAKnP,YAAY,IAA1C,CADF;AAIA,eAAKA,WAAW1a,mBAAmB;AAEnC,eAAK0a,WAAW3rE,WAAW,KAAK81D,UAAhC;AAMA,eAAK1uG,KAAiBld,gDAAZ;eAKL8uB,MAAM,CAAC,CAAC44D,EAAiB54D;AAK9B,eAAKgjH,mBAAmBpqD,EAAiB/K;AAKzC,eAAKo1D,YAAY,KAAKtQ,WAAW1gG,YAAhB,EAA8B4oC,aAA9B,EAA6C0yB;AAQ9D,eAAK21C,WAAW,oBAAIl3E;AAKpB,eAAKwtB,SAAS,KAAK2S;AAOnB,eAAKg3C,QAAsB,IAAd,KAAK3pD;AAMlB,eAAK4pD,QAAsB,IAAd,KAAK5pD;QA1DiB;QAsErC7+E,UACEwiB,GAAuD;AAUvD,eAAK0uF,YAAgBj4G,kDAAiBupB,GAAS,EAC7C,SAAS,gBADoC,CAA9B;AAGjB,eAAK0uF,UAAU30F,MAAMkB,UAAU;AAC/B,eAAK6mG,iBAAqBrrH;YACxBqwC,qCAAIif;YACJ,EAAC,SAAS,0BAAV;YACA,KAAK2oD;UAHe;AAKtB,eAAKA,UAAUl2F,YAAY,KAAKg9G,WAAWh4H,UAAhB,CAA3B;AACA,eAAKg4H,WACF56E,gBADH,EAEGC,UAAU,KAAKinE,gBAAgB,0BAA0B,MAF5D;AAGA,eAAK0T,WACF56E,gBADH,EAEGC,UAAU,KAAKinE,gBAAgB,iBAAiB,cAFnD;AAGA,iBAAO,KAAKpT;QA1B2C;QAmCzD1nG,KAAKoiB,GAA6B;AAChC,eAAKA,kBAAkBA;AACvB,eAAKosG,WAAWpsG,kBAAkBA;AAElC,eAAKosG,WAAWjzG,YAAY,IAAIk5B;YAC9B,KAAK+5E;YACL,KAAKjyG;YACL,CAAC,KAAKA;YACN;YACA,KAAKiiH;UALqB;AAQ5B,eAAK9mI,KAAL;AAEA,eAAK4sD,YAAYj+C,KACDrX,sDACZ,KAAK04G,WACL,SACA,MACA,KAAKw3B,MAJP,CADF;AAQA,eAAKhB,gBAAgB,KAAKiB,kBAAkBlwI,KAAK,IAA5B;AACrB,eAAKmzB,gBAAgBomB,kBAAkB,KAAK01F,aAA5C;AAGA,eAAK55E,YAAYj+C,KACDrX,sDACZ,KAAK8rH,gBACL,eACA,MACA,KAAKnqC,WAJP,CADF;AAUA,eAAK69C,WAAW/zD,aAAa,KAAKr4C,gBAAgBq4C,WAAWxrE,KAC3D,KAAKmzB,eADsB;AAK7B,eAAKosG,WAAWvjD,eAAe,KAAK7oD,gBAAgBxB,eAArB,CAA/B;eAEK4tG,WAAWhZ,2BAAhB;AAEApzF,YAAgB+iC,oBAAhB,EAAsCtI,aAAa,EACjDE,WAAW,MACXrH,QAAQ,GACRsH,cAAc,CACZP,0DAAiBN,WAAWK,cAC5BC,0DAAiBN,WAAWI,aAC5BE,0DAAiBN,WAAWG,WAHhB,EAHmC,CAAnD;QA7CgC;QA4DlCvjD,UAAO;AACL,eAAKrB,KAAL;AACA,eAAK0qB,gBAAgB+iC,oBAArB,EAA2ChI,gBAAgB,KAAKlzC,EAAhE;AACA,qBAAWnE,KAAS,KAAKw+C;AACTp1D,yDAAO4W,CAArB;eAEGw+C,YAAYr+C,SAAS;AACtB,eAAKi4H,iBACP,KAAK97G,gBAAgB00D,qBAAqB,KAAKonD,aAA/C;AAEE,eAAK1P,eACP,KAAKA,WAAW56E,gBAAhB,EAAkCsN,YAAY,KAAK45D,cAAnD,GACA,KAAK0T,WAAWz1H,QAAhB;AAEE,eAAK2uG,aACH53G,4CAAW,KAAK43G,SAApB;QAfG;QAwBPnjF,WAAQ;AACN,iBAAO,KAAKm6G;QADN;QASRr/E,YAAS;AACP,iBAAO,KAAKo/E;QADL;QAUTW,iBAAc;AACZ,iBAAO,KAAKh9G,gBAAgBlZ;QADhB;QASdq/B,eAAY;AACV,iBAAO,KAAKimF;QADF;QAQZ6Q,aAAa95D,GAAkB;AAC7B,eAAKA,YAAYA;AACjB,eAAKnjD,gBAAgBqzD,kBAArB;eACKrzD,gBAAgBiB,eAArB;QAH6B;QAO/Bq8F,SAASH,GAAwB;AAE7B,WAACA,KACD,KAAKn9F,gBAAgB+xB,UAAU,IAA/B,MAAyC,QACzC,KAAKoxB,aAEL,KAAK7tE,KAAL;QAN6B;QAcjCmnB,qBAAkB;AAChB,iBAAO,KAAKuD;QADI;QASlB5qB,YAAS;AACP,iBAAO,KAAKmhH;QADL;QAWT91D,WAAW/wB,GAAgB;AACzB,gBAAMuxB,IAAoBvxB,MAAY,KAAKt6B,UAAL;AAEtC,eAAKmhH,aAAa7mF;AACduxB,gBACG,KAAKkiB,aAGR,KAAKnjD,gBAAgBqzD,kBAArB,GAEF,KAAK6pD,cAAL;QAVuB;QAmB3Bl8E,oBAAoBtxB,GAAgB;AAClC,gBAAMuxB,IAAoBvxB,MAAY,KAAKouB;AAC3C,eAAKA,mBAAmBpuB;AACpBuxB,eACF,KAAKi8E,cAAL;QAJgC;QAapC75B,cAAW;AACT,iBAAO,KAAKhrF;QADH;QASX8kH,YAAY9kH,GAAsB;AAChC,eAAKA,WAAWA;QADgB;QAO1B6kH,gBAAa;AACnB,cAAInoI;AAIFA,cAHG,KAAK+oD,mBAGD,KAAK1oD,UAAL,IAFA;AAIL,eAAKkwG,cACP,KAAKA,UAAU30F,MAAMkB,UAAU9c,IAAO,UAAU;AAIlCokB,cAAAA;AAAhB,mBAAgBA,IAAhBA,KAAKizG,WAAWjzG,cAAAA,EAAW6nC,oBAAoBjsD,CAA/C;QAZmB;QAuBXqoI,YAAYhzH,GAAeE,GAAgBoD,GAAWE,GAAS;AAClE03F,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,cAAAA,EAAW96F,aAAa,SAAS,GAAGJ,CAAH,EAAtC;AACKk7F,cAAAA;AAAL,mBAAKA,IAALA,KAAKA,cAAAA,EAAW96F,aAAa,UAAU,GAAGF,CAAH,EAAvC;AACA,eAAK8hH,WAAW3hH,uBAAuBL,GAAOE,CAA9C;AAEI,eAAKg7F,aAEH13G,iDAAgB,KAAK03G,WADP,eAAe53F,IAAI,QAAQE,IAAI,KACjD;cAIIuL,IAAY,KAAKizG,WAAWjzG;AAGhCA,cAAU0oC,UAAUn0C,GAAGE,CAAvB,GACAuL,EAAUzO,OAAV,GAGIyO,EAAU0yG,WACZ1yG,EAAU0yG,QAAQtsE,YAChBpmC,EAAU0yG,QAAQ/5G,SAASpE,GAC3ByL,EAAU0yG,QAAQ/5G,SAASlE,CAF7B,GAKEuL,EAAUyyG,WACZzyG,EAAUyyG,QAAQrsE,YAChBpmC,EAAUyyG,QAAQ95G,SAASpE,GAC3ByL,EAAUyyG,QAAQ95G,SAASlE,CAF7B;QAzBmE;QAoCzEtY,OAAI;AACF,cAAK,KAAKF,UAAL,GAAL;AAGA,iBAAKqrD,WAAW,KAAhB;AAEA,uBAAW48E,KAAU,KAAKrrB;AACVllH,2DAAOuwI,CAArB;AAEF,iBAAKrrB,UAAUnuG,SAAS;AACpB,iBAAKk4H,kBACP,KAAK3P,WAAW13C,qBAAqB,KAAKqnD,aAA1C,GACA,KAAKA,gBAAgB;UAXvB;QADE;QAyBJhnI,KAAK+iB,GAA4C;AAC/C,eAAKs0G,WAAW3yF,kBAAkB,KAAlC;eACKnkC,KAAL;AACA,eAAKgoI,eAAL;AAGyB,uBAArB,OAAOxlH,MACTA,IAAY,KAAKylH,2BAA2BzlH,CAAhC;AAEd,eAAK2oC,WAAW,IAAhB;AAGM+8E,cAAwBjuI,iEAA4BuoB,CAApC;AAChB2lH,cAAa,KAAKC,iBAAiBF,CAAtB;AAEF3rI,wEAAqB,KAAKu6H,UAA3C;AAEA,eAAK+Q,YAAYM,EAAWplH,QAA5B;AAEA,eAAKslH,QAAQF,EAAWplH,UAAUolH,EAAWG,IAA7C;AAEI,eAAKzjH,mBACP,KAAKkiH,UAAU,IAEf,KAAKC,SAAS;AAEhB,eAAKlQ,WAAW3yF,kBAAkB,IAAlC;AACA,eAAK4iF,OAAL;AAEA,eAAK0gB,kBAAL;AAGA,eAAKjrH,SAAL;AAEA,eAAKiqH,gBAAgB,KAAK1f,OAAOxvH,KAAK,IAAjB;AACrB,eAAKu/H,WAAWhmF,kBAAkB,KAAK21F,aAAvC;AACA,eAAK8B,oBAAL;QApC+C;QA+CzCH,iBAAiBF,GAA0C;AAIjE,gBAAMnlH,IAAyB,CAAA,GACzBulH,IAAiB,CAAA;AACvB,eAAK1B,oBAAoBr4H,SAAS;AAClC,gBAAMi6H,IAAa,KAAK3jH,mBAAmB,KAAKyiH,QAAQ,KAAKC;AAC7D,qBAAWzvC,KAAQowC,GAAe;AAChC,gBAAI,YAAYpwC,GAAM;AAGdt1E,kBAAY,KAAKylH,2BAFJnwC,EACE2wC,MACH;AACZC,kBACIzuI,iEAA4BuoB,CAApC;AACF,oBAAM,EAAC,UAAUmmH,GAAiB,MAAMC,EAAlC,IACJ,KAAKR,iBAAiBM,CAAtB;AACF3lH,gBAASpU,KAAK,GAAGg6H,CAAjB;AACAL,gBAAK35H,KAAK,GAAGi6H,CAAb;YAToB;AAYtB,oBAAQ9wC,EAAA,KAAal1E,YAAb,GAAR;cACE,KAAK;AACG6wG,oBAAY37B;AAClB,sBAAMx2F,IAAQ,KAAKunI,kBAAkBpV,CAAvB;AACd1wG,kBAASpU,KAAK,EAACzC,MAAMm6H,kDAAe7mF,OAAOl+C,OAAOA,EAApC,CAAd;AACA,qBAAKwnI,YAAYrV,GAAW6U,GAAME,CAAlC;AACA;cAEF,KAAK;AAEH,qBAAKO,gBADWjxC,GACcwwC,GAAME,CAApC;AACA;cAEF,KAAK;AAGGn+F,oBAAQ,KAAK2+F,aAFDlxC,GAEwC,IAA5C;AACd/0E,kBAASpU,KAAK,EAACzC,MAAMm6H,kDAAez4B,QAAQ51F,QAAQqyB,EAAtC,CAAd;AACAi+F,kBAAK35H,KAAK65H,CAAV;AACA;cAEF,KAAK;AAEGxwH,oBAAS,KAAKgxH,aADDlxC,GACyC,KAA7C,GACf/0E,EAASpU,KAAK,EAACzC,MAAMm6H,kDAAez4B,QAAQ51F,QAAQA,EAAtC,CAAd,GACAswH,EAAK35H,KAAK65H,CAAV;YAzBJ;UAbgC;AA4ClC,iBAAO,EAACzlH,UAAUA,GAAUulH,MAAMA,EAA3B;QApD0D;QA8D3DL,2BACNQ,GAAoB;AAIdQ,cACJ,KAAKnS,WAAWpsG,gBAAiBg9F,2BAA2B+gB,CAA5D;AACF,cAAyB,eAArB,OAAOQ;AACT,kBAAM1lH,UACJ,oEADI;AAKR,iBAAO0lH,EAAU,KAAKnS,WAAWpsG,eAA1B;QAZa;QAuBds+G,aACNE,GACAr9B,GAAgB;AAQhB,iBANkBs9B,IAAIh+B,kDACpB,KAAK2rB,YACL,KAAKpsG,iBACLw+G,GACAr9B,CAJgBs9B;QAFF;QAkBVN,kBAAkBpV,GAA4B;AACpD,cAAInyH;AACAmyH,YAAA,YACIvvF,IAC6B,aAAjC,OAAOuvF,EAAA,WACMjyG,EAAAA,2CAAUiyG,EAAA,QAAnB,IACAA,EAAA,WAENnyH,IAAQ,KAAK8nI,iBAAiBllG,EAAIvsB,aAAa,MAAjB,CAAtB,OAENrW,IAAY4C,8CAAmBggC,GAAK,KAAK4yF,UAAjC,OAGVx1H,IAAQ,KAAK8nI,iBAAiB3V,EAAA,IAAtB,GACHnyH,MAC0BiO,WAAzBkkH,EAAA,YACFA,EAAA,UAC4B,WAA1BA,EAAA,YAA8D,SAA1BA,EAAA,WAGLlkH,WAAjCkkH,EAAA,mBACyB,UAAzBA,EAAA,YAEAA,EAAA,kBAA+B,CAAC7hG,kDAAD,IAEjCtwB,IAAezD,2DACb41H,GACA,KAAKqD,UAFC;AAOPx1H,YAAM1L,UAAN,KAGH,KAAKgxI,oBAAoBj4H,KAAKrN,CAA9B;AAEF,iBAAOA;QArC6C;QAgD9C8nI,iBAAiBC,GAAiB;AACxC,cAAI94H,IAAQ;AACZ,mBAAS1B,IAAI,GAAGA,IAAI,KAAKg4H,eAAet4H,QAAQM;AAC9C,gBAAI,KAAKg4H,eAAeh4H,CAApB,EAAuB3C,SAASm9H,GAAW;AAC7C94H,kBAAQ1B;AACR;YAF6C;AAKjD,iBAAiB,OAAV0B,IAAehB,SAAY,KAAKs3H,eAAep3H,OAAOc,GAAO,CAAlC,EAAqC,CAArC;QARM;QAmBlCu4H,YACNrV,GACA6U,GACAE,GAAkB;AAElB,cAAIc;AACA7V,YAAA,MACF6V,IAAM9pH,SAASvS,OAAOwmH,EAAA,GAAP,CAAT,IACGA,EAAA,aACHvvF,IAC6B,aAAjC,OAAOuvF,EAAA,WACMjyG,EAAAA,2CAAUiyG,EAAA,QAAnB,IACAA,EAAA,UAEN6V,IAAM9pH,SAAS0kB,EAAIvsB,aAAa,KAAjB,CAAT;AAER2wH,YAAK35H,KAAK,CAAC26H,KAAOpqG,MAAMoqG,CAAN,IAAad,IAAac,CAA5C;QAbkB;QAyBZP,gBACNQ,GACAjB,GACAE,GAAkB;AAMZgB,cAAShqH,SAASvS,OAAOs8H,EAAA,GAAP,CAAT;AAEX,WAACrqG,MAAMsqG,CAAN,KAA+B,IAAdlB,EAAK/5H,SACzB+5H,EAAKA,EAAK/5H,SAAS,CAAnB,IAAwBi7H,IAExBlB,EAAK35H,KAAK65H,CAAV;QAXgB;QAkBZR,iBAAc;AAEpB,cAAMyB,IAAY,KAAK3S,WAAW/0F,aAAa,KAA7B;AAClB,mBAASlzB,IAAI,GAAGvN,GAAQA,IAAQmoI,EAAU56H,CAAV,GAAeA;AACzC,iBAAK66H,mBAAmBpoI,CAAxB,IACF,KAAKqoI,aAAaroI,CAAlB,IAEAA,EAAMD,QAAQ,OAAO,KAArB;AAIJ,eAAS8hB,IAAI,GAAGA,IAAI,KAAKujH,KAAKn4H,QAAQ4U,KAAK;AACzC,kBAAM2kB,IAAO,KAAK4+F,KAAKvjH,CAAV;AACT2kB,kBACM7mC,iDAAkB6mC,CAA1B,GACI1vC,4CAAW0vC,CAAf;UAJuC;AAO3C,eAAK4+F,KAAKn4H,SAAS;AAEnB,mBAASM,IAAI,GAAGmJ,GAASA,IAAS,KAAK2uH,SAAS93H,CAAd,GAAmBA;AACnDmJ,cAAO3W,QAAP;AAEF,eAAKslI,SAASp4H,SAAS;AAGvB,cAAA;AAAA,mBAAA,IAAA,KAAKuoH,WAAWvsG,wBAAhB,MAAA,EAA2C6Z,MAA3C;QA1BoB;QAgCdmkG,sBAAmB;AACzB,mBAAS15H,IAAI,GAAGA,IAAI,KAAKg4H,eAAet4H,QAAQM;AAC9C,iBAAKg4H,eAAeh4H,CAApB,EAAuBxN,QAAvB;AAEF,eAAKwlI,iBAAiB,CAAA;QAJG;QAajB6C,mBAAmB37C,GAAgB;AAE3C,iBAAO;QAFoC;QAYrC47C,aAAaroI,GAAe;AAClC,gBAAMie,IAAKje,EAAMuqB,uBAAN;AACXvqB,YAAMyF,OAAO,CAACwY,EAAGnH,GAAG,CAACmH,EAAGjH,CAAxB;AACA,eAAKuuH,eAAel4H,KAAKrN,CAAzB;QAHkC;QAc1BsoI,mBACRv7F,GACA/sC,GACAwmC,GAAgB;AAEhB,eAAK40E,UAAU/tG,KACCrX,sDACZ+2C,GACA,eACA,MACA,KAAKw7F,eAAevoI,CAApB,CAJF,CADF;AAQA,eAAKo7G,UAAU/tG,KACCrX,sDACZwwC,GACA,eACA,MACA,KAAK+hG,eAAevoI,CAApB,CAJF,CADF;AAQA,eAAKo7G,UAAU/tG,KACCpX,2CAAK82C,GAAM,gBAAgB/sC,GAAO,MAAK;AAC9C,iBAAKopB,gBAAgBjX,WAArB,KACHnS,EAAM2oH,UAAN;UAFiD,CAArD,CADF;AAOA,eAAKvN,UAAU/tG,KACCpX;YAAK82C;YAAM;YAAgB/sC;YAAO,MAAK;AAC9C,mBAAKopB,gBAAgBjX,WAArB,KACHnS,EAAM4oH,aAAN;YAFiD;UAArD,CADF;AAOA,eAAKxN,UAAU/tG,KACCpX,2CAAKuwC,GAAM,gBAAgBxmC,GAAO,MAAK;AAC9C,iBAAKopB,gBAAgBjX,WAArB,KACHnS,EAAM2oH,UAAN;UAFiD,CAArD,CADF;AAOA,eAAKvN,UAAU/tG,KACCpX,2CAAKuwC,GAAM,gBAAgBxmC,GAAO,MAAK;AAC9C,iBAAKopB,gBAAgBjX,WAArB,KACHnS,EAAM4oH,aAAN;UAFiD,CAArD,CADF;QAvCgB;QAsDV2f,eAAevoI,GAAe;AACpC,iBAAQoN,OAAmB;AACzB,kBAAMyH,IAAU,KAAKuU,gBAAgBq4C,WAAWr0D,CAAhC;AACZyH,kBACFA,EAAQq3D,cAAclsE,CAAtB,GACA6U,EAAQk3D,kBAAkB3+D,GAAG,IAA7B;UAJuB;QADS;QAe9BuqE,YAAYvqE,GAAe;AACjC,gBAAMyH,IAAU,KAAKuU,gBAAgBq4C,WAAWr0D,CAAhC;AACZyH,eACFA,EAAQk3D,kBAAkB3+D,GAAG,IAA7B;QAH+B;QAgBnCg8D,iBAAiBppE,GAAe;AAC9B,iBAAOA,EAAM1L,UAAN;QADuB;QAYhCk1E,YAAYg/D,GAAuB;AACjC,cAAIv4G,IAAW;AACJ1f,YAAAA,4CAAX;AACA,cAAMof,IAA0B,KAAKvG,gBAAgBvB,gBAArB;AAChC,eAAKuB,gBAAgByZ,kBAAkB,KAAvC;AACA,cAAI;AACF5S,gBAAW,KAAKw4G,cAAcD,CAAnB;UADT,UAAJ;AAGa/3H,cAAAA,2CAAX;UADQ;AAKV,eAAK2Y,gBAAgBze,UAArB;AAEMwlB,cAAyBr1B,mDAC7B,KAAKsuB,iBACLuG,CAFmB;AAKrB,cAAer7B,8CAAX,GAAwB;AACfqc,cAAAA,6CAAS,IAApB;iBAESpD,IAAI,GAAGA,IAAI4iB,EAAaljB,QAAQM,KAAK;AAC5C,oBAAM6iB,IAAeD,EAAa5iB,CAAb;AACVtZ,uDACT,KAAgBS,wCAAe27B,8CAA1B,GAAuCD,CAA5C,CADF;YAF4C;AASnCn8B,qDAAK,KAAgBS,wCAAek7B,EAAAA,0CAA1B,GAAyCK,CAA9C,CAAhB;UAZ0B;AAcxB,eAAKs8C,YACP,KAAK7tE,KAAL,IAEA,KAAKynI,kBAAL;AAEF,iBAAOl2G;QAtC0B;QAiDzBy4G,kBAAkBhyH,GAAsBI,GAAWE,GAAS;AACpE,gBAAM2xH,IAAYjyH,EAAOlZ,UAAP;AAClBkZ,YAAOlR,OAAOsR,GAAGE,CAAjB;AACAN,YAAOvY,KAAP;AAGA,eAAKi9G,UAAU/tG,KACCrX;YACZ2yI;YACA;YACA;YACA,KAAKhxD;UAJP,CADF;AASA,eAAK0tD,SAASh4H,KAAKqJ,CAAnB;QAfoE;QA+B5DkyH,YACR5oI,GACA8W,GACAE,GACA6xH,GACA55H,GAAa;AAIPu3B,cAAW/vC,kDAAiBqwC,qCAAIof,MAAM,EAC1C,gBAAgB,GAChB,GAAKpvC,GACL,GAAKE,GACL,QAAU6xH,EAAQn1H,QAClB,OAASm1H,EAAQr1H,MALyB,CAA/B;AAOZgzB,YAA4BvN,UAAUj5B;AAC/BN,yDAAgB8mC,CAAxB;AAEA,eAAKgvF,WAAWx5C,UAAhB,EAA4BtjE,aAAa8tB,GAAMxmC,EAAM+zB,WAAN,CAA/C;AAEA,eAAKgyG,SAAS97G,IAAIjqB,GAAOwmC,CAAzB;AAEA,iBADA,KAAK4+F,KAAKn2H,CAAV,IAAmBu3B;QAjBN;QA4BLsiG,iBAAiBtiG,GAAkBxmC,GAAe;AAC1D,gBAAM6oI,IAAU7oI,EAAMonC,eAAN;AAChBZ,YAAK5yB,aAAa,SAASjI,OAAOk9H,EAAQr1H,KAAf,CAA3B;AACAgzB,YAAK5yB;YAAa;YAAUjI,OAAOk9H,EAAQn1H,MAAf;UAA5B;AAEMywB,cAAUnkC,EAAMuqB,uBAAN;AAChBic,YAAK5yB,aAAa,KAAKjI,OAAOw4B,EAAQntB,CAAf,CAAvB;AACAwvB,YAAK5yB,aACH,KACAjI,OAAO,KAAKkX,MAAMshB,EAAQrtB,IAAI+xH,EAAQr1H,QAAQ2wB,EAAQrtB,CAAtD,CAFF;QAP0D;QAmBpDqvH,oBAAiB;AACvB,gBAAM1xH,IAAS,KAAK+gH,WAAW/0F,aAAa,KAA7B;AACf,mBAASlzB,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA;AAC1C,gBAAI,CAAC,KAAK+3H,oBAAoB/mH,SAASve,CAAlC,GAA0C;AAC7C,oBAAMyQ,IAAS,KAAK2Y,gBAAgBm7E,oBAC3BjvG,iDAAmB0K,CAA1B,CADa;AAGf,qBAAOA;AACLA,kBAAMgS,kBACJ,CAACvB,GACDu0H,8EAFF,GAIAhlI,IAAQA,EAAMoS,aAAN;YATmC;QAH1B;QAqBzBqzG,SAAM;AACA,eAAK0f,iBACP,KAAK3P,WAAW13C,qBAAqB,KAAKqnD,aAA1C;AAEF,eAAK4D,gBAAL;AACI,eAAK5D,iBACP,KAAK3P,WAAWhmF,kBAAkB,KAAK21F,aAAvC;QANE;QAeN97D,eAAY;AACV,iBAAO,KAAKmsD,WAAWjzG,YACnB,KAAKizG,WAAWjzG,UAAU/jB,UAA1B,IACA;QAHM;QAYJiqI,cAAcO,GAAkB;AACtC,cAAM5/G,IAAkB,KAAKA;AAE7B,cAAI,CADe4/G,EAASj1G,WAATk1G;AAEjB,kBAAM/9H,MAAM,0BAAN;AAIR,gBAAMgG,IAAO,KAAKg4H,eAAeF,CAApB;AAEb5/G,YAAgByZ,kBAAkB,KAAlC;AACM7iC,cAAevE,mDAAOyV,GAAMkY,CAApB;AAEd,eAAK+/G,iBAAiBH,GAAUhpI,CAAhC;AAEA,iBAAOA;QAf+B;QAwB9BkpI,eAAelpI,GAAe;AACtC,iBAAcxE,iDAAKwE,CAAZ;QAD+B;QAUhCmpI,iBAAiBH,GAAoBhpI,GAAe;AAC1D,gBAAMopB,IAAkB,KAAKA;AAI7B,cAAMhK,IAAmBgK,EAAgB/J,wBAAhB,GAInB+pH,IAAqB,KAAK5T,WAAWn2G,wBAAhB;AAGrBgqH,cAAcL,EAASz+G,uBAAT;AAGpB8+G,YAAYn5H,MAAM,KAAKslH,WAAWtlH,KAAlC;AAIMo5H,cAAuBltH,mDAAW8Q,IACtCk8G,GACAC,CAF2B;AAOvBjqF,cAAchjC,mDAAWkD,WAC7BgqH,GACAlqH,CAFkB;AAKpBggC,YAAYlvC,MAAM,IAAIkZ,EAAgBlZ,KAAtC;AAGAlQ,YAAMwF,OAAO,IAAI4W,mDAAWgjC,EAAYtoC,GAAGsoC,EAAYpoC,CAA1C,CAAb;QAlC0D;MAzvCxD;AAwEGiuH,gDAAAF,iBAAiBA;UAhI1B7kF,oCAAA,CAAA;AAwDsB+kF,wCAAAA,SAAAA;AC5BhB,UAAOviB,wDAAP,cAA8BuiB,0CAA9B;QAKJvzG,YAAY+pD,GAAyB;AACnC,gBAAMA,CAAN;QADmC;QAUlBmqD,YAAYjf,GAA+B;AAC5D,cAAK,KAAKnoH,UAAL,GAAL;AAGA,gBAAM00C,IAAiB,KAAKsiF,WAAWriF,kBAAhB,GACjBmkF,IAAgBpkF,EAAeK,iBAAf,GAChBvwB,IAAckwB,EAAe+D,eAAf;AACdr0B,gBAAkBswB,EAAe6iF,mBAAf;AAEC,yBAArB,OAAOpP,EAAQ3vG,MACjB,KAAKw+G,WAAW56F,UAAU,EACxB08F,EAAcn8G,OACbm8G,EAAc5jH,SAASsP,EAAYtP,UAAUizG,EAAQ3vG;AAG1D,iBAAKw+G,WAAWroG,UACd,KAAKqoG,WAAW16F,UAAUlY,EAAgBxH,MAC1C,KAAKo6G,WAAW56F,UAAUhY,EAAgBzH,GAF5C;UAdA;QAD4D;QA0BrDouH,OAAI;AACX,cAAI,CAAC,KAAK/qI,UAAL;AACH,mBAAO;AAET,cAAM00C,IAAiB,KAAK9pB,gBAAiB+pB,kBAAtB;gBACjBvwB,IAAkBswB,EAAe6iF,mBAAf,GAClB/yG,IAAckwB,EAAe+D,eAAf;AACd5zB,cAAiB6vB,EAAe0iF,kBAAf;AAkCvB,iBA7BI,KAAKxsG,gBAAiBsnD,oBAAoB,KAAKm1D,mBAG7C,KAAKz8G,gBAAiB8xB,WAAtB,IACE,KAAK2qF,qBAA6BviH,8CAASX,OACzCU,EAAe7P,QAEfwP,EAAYxP,QAAQ,KAAKkyH,SAG3B,KAAKG,qBAA6BviH,8CAASX,OACzC,IAGAK,EAAYxP,QAIhB,KAAKqyH,qBAA6BviH,8CAASX,OACzC,IAMAK,EAAYxP,QAAQoP,EAAgBxH,OAAO,KAAKsqH;QArC7C;QAiDJ8D,OAAI;AAEX,iBAAO;QAFI;QAMJtuH,WAAQ;AACf,cAAK,KAAK1c,UAAL,KAAqB,KAAK4qB,gBAAiB5qB,UAAtB,GAA1B;AAIA,gBAAMirI,IADiB,KAAKrgH,gBAAiB+pB,kBAAtBD,EAC2B+D,eAAf;AACnC,iBAAKwuF,UAAUgE,EAA2B/1H;AAK1C,iBAAKg2H,kBAHa,KAAKhE,SAAS,KAAK12C,eAEnCy6C,EAA2B/1H,SAAS,IAAI,KAAKs7E,aAC/C;AAEMl4E,gBAAI,KAAKyyH,KAAL;AACV,gBAAMvyH,IAAI,KAAKwyH,KAAL;AAEV,iBAAKhD,YAAY,KAAKd,QAAQ,KAAKD,SAAS3uH,GAAGE,CAA/C;UAfA;QADe;QAyBT0yH,kBAAkBl2H,GAAeE,GAAc;AACrD,gBAAMi2H,IAAU,KAAK9D,qBAA6BviH,8CAASE;AAC3D,cAAMo8C,IAAapsD,IAAQ,KAAKw7E;AAG1B0F,cAA+B,CACnC,QAAQi1C,IAAU/pE,IAAa,KAAK,IADD;AAIrC80B,YAAKrnF,KAAK,KAAKs8H,IAAU,CAACn2H,IAAQA,CAAlC;AAEAkhF,YAAKrnF;YACH;YACA,KAAK2hF;YACL,KAAKA;YACL;YACA;YACA26C,IAAU,IAAI;YACdA,IAAU,CAAC,KAAK36C,gBAAgB,KAAKA;YACrC,KAAKA;UARP;AAWA0F,YAAKrnF,KAAK,KAAKyQ,KAAKE,IAAI,GAAGtK,CAAZ,CAAf;AAEAghF,YAAKrnF,KACH,KACA,KAAK2hF,eACL,KAAKA,eACL,GACA,GACA26C,IAAU,IAAI,GACdA,IAAU,KAAK36C,gBAAgB,CAAC,KAAKA,eACrC,KAAKA,aARP;AAWA0F,YAAKrnF,KAAK,KAAKs8H,IAAUn2H,IAAQ,CAACA,CAAlC;AACAkhF,YAAKrnF,KAAK,GAAV;AACA,eAAKy0G,eAAgBluG,aAAa,KAAK8gF,EAAK5lF,KAAK,GAAV,CAAvC;QArCqD;QAyC9CssC,gBAAa;AACJ74B,cAAAA;AAAhB,mBAAgBA,IAAhBA,KAAKizG,WAAWjzG,cAAAA,EAAW+yG,KAAK,CAAhC;QADoB;QASH4Q,OAAO94H,GAAa;AACrC,cAAMy2G,IAA4BvtH,2DAAqB8W,CAAnC;AAEpB,cAAIy2G,EAAY7sG,GAAG;AACjB,kBAAMk8B,IAAiB,KAAKsiF,WAAWriF,kBAAhB,GACjBmkF,IAAgBpkF,EAAeK,iBAAf;gBACFL,EAAe+D,eAAfj0B,EACI7H,MAAMm8G,EAAcn8G,MAAM0oG,EAAY7sG;AAE9CuL,gBAAAA;AAAhB,qBAAgBA,IAAhBA,KAAKizG,WAAWjzG,cAAAA,EAAW+yG,KAAKn5G,CAAhC;AAGU9a,sEAAyB,KAAKm0H,UAAxC;AACY72H,oEAAZ;UAViB;AAanByO,YAAE4yB,eAAF;AAEA5yB,YAAE6yB,gBAAF;QAlBqC;QA2BpB8mG,QAAQtlH,GAAwBulH,GAAc;AAC/D,eAAKxR,WAAWtlH,QAAQ,KAAKkZ,gBAAiBlZ;AAC9C,cAAMyT,IAAS,KAAK04D;AACpB,gBAAMutD,IAAU,KAAK/mH,MAAMc,IAASA,IAAS,KAAKmiH;AAGlD,mBAASv4H,IAAI,GAAG8T,GAAOA,IAAOI,EAASlU,CAAT,GAAcA;AAC1C,gBAAkB,YAAd8T,EAAKzW,MAAkB;AACzB,kBAAM5K,IAAQqhB,EAAKrhB;AACnB,kBAAI,CAACA;AACH;AAEF,kBAAM6pI,IAAY7pI,EAAM+Q,eAAe,KAArB;AAClB,uBAAS8Q,IAAI,GAAG9P,GAAQA,IAAQ83H,EAAUhoH,CAAV,GAAeA;AAI7C9P,kBAAM67B,aAAa;AAEfb,kBAAO/sC,EAAM+zB,WAAN;AACb,oBAAM80G,IAAU7oI,EAAMonC,eAAN;AAChB,kBAAM0iG,IAAQ9pI,EAAMiS,mBAChB23H,IAAU,KAAK9D,YACf8D;AACJ5pI,gBAAMyF,OAAOqkI,GAAO1lB,CAApB;AAEM59E,kBAAO,KAAKoiG,YAChB5oI,GACA,KAAK6iB,MAAMinH,IAAQjB,EAAQr1H,QAAQs2H,GACnC1lB,GACAykB,GACAt7H,CALW;AAQb,mBAAK+6H,mBAAmBv7F,GAAM/sC,GAAOwmC,CAArC;AAEA49E,mBAAWykB,EAAQn1H,SAASszH,EAAKz5H,CAAL;YA7BH;AA8BF,2BAAd8T,EAAKzW,SACR8L,IAAS2K,EAAK3K,QACpB,KAAKgyH,kBAAkBhyH,GAAQkzH,GAASxlB,CAAxC,GACAA,KAAW1tG,EAAOhD,SAASszH,EAAKz5H,CAAL;QAxCgC;QAsDxD+7D,sBAAsBlC,GAA8B;AAIrD2iE,cAAiBjsH,KAAKksH,MAFjB5iE,EAAmBpwD,GADnBowD,EAAmBtwD,CAGP,IAAqBgH,KAAK4U,KAAM;AAEvD,gBAAMu3G,IAAQ,KAAKtE;AAEnB,iBACGoE,IAAgBE,KAASF,IAAgB,CAACE,KAC3CF,IAAgB,OAAOE,KACvBF,IAAgB,MAAME,IAEf,OAEF;QAfoD;QAyBpDzmB,gBAAa;AACpB,cAAI,CAAC,KAAK9U,aAAa,KAAKniC,aAAa,CAAC,KAAK/tE,UAAL;AAGxC,mBAAO;AAGT,gBAAM0rI,IAAa,KAAKx7B,UAAUpyF,sBAAf,GAMblB,IAAO8uH,EAAW9uH;AAExB,iBAAI,KAAKyqH,qBAA6BviH,8CAASX,OAEtC,IAAI3F,uCAAK,MALFmtH,KAKqB,MAAU/uH,IAD/B8uH,EAAW12H,KAClB,IAGA,IAAIwJ,uCAAK,MARFmtH,KAQqB/uH,GARrB+uH,GAQP;QApBW;QA4BHpB,kBAAe;AAChC,eAAKvT,WAAWtlH,QAAQ,KAAKk2H,eAAL;AACxB,cAAIpoD,IAAc;AAClB,cAAMvpE,IAAS,KAAK+gH,WAAW/0F,aAAa,KAA7B;AACf,mBAASlzB,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA,KAAK;AAC/C,gBAAIiG,IAAQxT,EAAMonC,eAAN,EAAuB5zB;AAC/BxT,cAAMiS,qBACRuB,KAAS,KAAKsyH;AAEhB9nD,gBAAclgE,KAAKE,IAAIggE,GAAaxqE,CAAtB;UALiC;AAOjD,mBAASjG,IAAI,GAAGmJ,GAASA,IAAS,KAAK2uH,SAAS93H,CAAd,GAAmBA;AACnDywE,gBAAclgE,KAAKE,IAAIggE,GAAatnE,EAAOlD,KAA7B;AAEhBwqE,eAA6B,MAAd,KAAK3B,SAAe,KAAKypD;AACxC9nD,eAAe,KAAKw3C,WAAWtlH;AAC/B8tE,eAAel7D,2CAAUC;AAEzB,cAAI,KAAK2iH,WAAW1nD,GAAa;AAC/B,qBAASzwE,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA,KAAK;AAC/C,kBAAI,KAAKsV,KAAK;AAENunH,oBAAOpqI,EAAMuqB,uBAAN,EAA+BzT;AAC5C,oBAAIuzH,IAAOrsD,IAAc,KAAKw3C,WAAWtlH,QAAQ,KAAKmsE;AACjDr8E,kBAAMiS,qBACTo4H,KAAQ,KAAKvE;AAEf9lI,kBAAMyF,OAAO4kI,IAAOD,GAAM,CAA1B;cAPY;AASV,mBAAKrE,SAAS37G,IAAIpqB,CAAlB,KACF,KAAK8oI,iBAAiB,KAAK/C,SAASrxI,IAAIsL,CAAlB,GAA2BA,CAAjD;YAX6C;AAcjD,gBAAI,KAAK6iB;AAEP,uBAAStV,IAAI,GAAGmJ,GAASA,IAAS,KAAK2uH,SAAS93H,CAAd,GAAmBA;AAC7CyJ,oBAAIN,EAAOtW,YAAP,EAAqB4W,GAM/BN,EAAOlR,OAJLw4E,IAAc,KAAKw3C,WAAWtlH,QAC9BwG,EAAOlD,QACP,KAAK6oE,SACL,KAAKypD,WACU9uH,CAAjB;AASD,iBAAKoS,gBAAgB7G,aACrB,KAAKgqD,aACN,KAAKnjD,gBAAgB+xB,UAArB,MAAqC,QACrC,KAAK0qF,qBAA6BviH,8CAASX,QAE3C,KAAKyG,gBAAgB+D,UACnB,KAAK/D,gBAAgB0R,UAAUkjD,GAC/B,KAAK50D,gBAAgBwR,OAFvB;AAMF,iBAAK8qG,SAAS1nD;AACd,iBAAK9iE,SAAL;AACA,iBAAKkO,gBAAgBiB,eAArB;AACA,iBAAKjB,gBAAgBqzD,kBAArB;UA/C+B;QAlBD;MAjT9B;AAEGimC,4DAAA4nB,eAAe;+CAsXbt/H,qCAAK80C,0BACLvzC,yCACTm2G,qDAHF;AAnZA,UAAAxiE,wCAAA,CAAA;AA4BawiE,4CAAAA,iBAAAA;ACAP,UAAOD,4DAAP,cAAgCwiB,0CAAhC;QAIJvzG,YAAY+pD,GAAyB;AACnC,gBAAMA,CAAN;AAJO,eAAAl4D,mBAAmB;QAGS;QAUlBqiH,YAAYjf,GAA+B;AAC5D,cAAK,KAAKnoH,UAAL,GAAL;AAIA,gBAAM00C,IAAiB,KAAKsiF,WAAWriF,kBAAhB,GACjBmkF,IAAgBpkF,EAAeK,iBAAf,GAChBvwB,IAAckwB,EAAe+D,eAAf;AACdr0B,gBAAkBswB,EAAe6iF,mBAAf;AAEC,yBAArB,OAAOpP,EAAQ7vG,MACjB,KAAK0+G,WAAW16F,UAAU,EACxBw8F,EAAcl8G,QACbk8G,EAAc9jH,QAAQwP,EAAYxP,SAASmzG,EAAQ7vG;AAIxD,iBAAK0+G,WAAWroG,UACd,KAAKqoG,WAAW16F,UAAUlY,EAAgBxH,MAC1C,KAAKo6G,WAAW56F,UAAUhY,EAAgBzH,GAF5C;UAhBA;QAD4D;QA4BrDouH,OAAI;AAEX,iBAAO;QAFI;QAUJC,OAAI;AACX,cAAI,CAAC,KAAKhrI,UAAL;AACH,mBAAO;cAEH00C,IAAiB,KAAK9pB,gBAAiB+pB,kBAAtB;AACvB,gBAAMvwB,IAAkBswB,EAAe6iF,mBAAf,GAClB/yG,IAAckwB,EAAe+D,eAAf;AACd5zB,cAAiB6vB,EAAe0iF,kBAAf;AAGvB,gBAAMO,IAAQ,KAAK0P,qBAA6BviH,8CAASH;AAgCzD,iBA7BI,KAAKiG,gBAAiBsnD,oBAAoB,KAAKm1D,mBAG7C,KAAKz8G,gBAAiB8xB,WAAtB,IACEi7E,IACE9yG,EAAe3P,SAEfsP,EAAYtP,SAAS,KAAK+xH,UAG5BtP,IACE,IAGAnzG,EAAYtP,SAIhByiH,IACE,IAMAnzG,EAAYtP,SAASkP,EAAgBzH,MAAM,KAAKsqH;QAtC7C;QA8CJvqH,WAAQ;AACf,cAAK,KAAK1c,UAAL,KAAqB,KAAK4qB,gBAAiB5qB,UAAtB,GAA1B;AAIA,gBAAMirI,IADiB,KAAKrgH,gBAAiB+pB,kBAAtBD,EAC2B+D,eAAf;iBAC9ByuF,SAAS+D,EAA2Bj2H;AAIzC,iBAAKk2H,kBAFaD,EAA2Bj2H,QAAQ,IAAI,KAAKw7E,eAC3C,KAAKy2C,UAAU,KAAKz2C,aACvC;AAEMl4E,gBAAI,KAAKyyH,KAAL;AACV,gBAAMvyH,IAAI,KAAKwyH,KAAL;AAEV,iBAAKhD,YAAY,KAAKd,QAAQ,KAAKD,SAAS3uH,GAAGE,CAA/C;UAdA;QADe;QAwBT0yH,kBAAkBl2H,GAAeE,GAAc;AACrD,gBAAMyiH,IAAQ,KAAK0P,qBAA6BviH,8CAASH,KAEnDuxE,IAA4B,CAChC,UAAUyhC,IAAQ,IAAI,KAAKnnC,cADK;AAI9BmnC,eAEFzhC,EAAKrnF,KAAK,KAAKmG,IAAQ,IAAI,KAAKw7E,aAAhC,GAEA0F,EAAKrnF,KAAK,KAAKqG,CAAf,GAEAghF,EAAKrnF,KACH,KACA,KAAK2hF,eACL,KAAKA,eACL,GACA,GACA,GACA,CAAC,KAAKA,eACN,KAAKA,aARP,GAUA0F,EAAKrnF,KAAK,KAAK,CAACmG,CAAhB,GAEAkhF,EAAKrnF;YACH;YACA,KAAK2hF;YACL,KAAKA;YACL;YACA;YACA;YACA,CAAC,KAAKA;YACN,CAAC,KAAKA;UARR,MAaA0F,EAAKrnF,KACH,KACA,KAAK2hF,eACL,KAAKA,eACL,GACA,GACA,GACA,KAAKA,eACL,CAAC,KAAKA,aARR,GAUA0F,EAAKrnF,KAAK,KAAKmG,CAAf,GAEAkhF,EAAKrnF,KACH,KACA,KAAK2hF,eACL,KAAKA,eACL,GACA,GACA,GACA,KAAKA,eACL,KAAKA,aARP,GAUA0F,EAAKrnF,KAAK,KAAKqG,CAAf,GAEAghF,EAAKrnF,KAAK,KAAK,CAACmG,IAAQ,IAAI,KAAKw7E,aAAjC;AA3BA0F,YAAKrnF,KAAK,GAAV;AA+BF,eAAKy0G,eAAgBluG,aAAa,KAAK8gF,EAAK5lF,KAAK,GAAV,CAAvC;QAlEqD;QAsE9CssC,gBAAa;AACJ74B,cAAAA;AAAhB,mBAAgBA,IAAhBA,KAAKizG,WAAWjzG,cAAAA,EAAW8yG,KAAK,KAAKxyG,MAAMmhB,WAAW,CAAtD;QADoB;QASHkiG,OAAO94H,GAAa;AACrC,cAAMy2G,IAA4BvtH,2DAAqB8W,CAAnC;cACdgmD,IAAQywD,EAAY/sG,KAAK+sG,EAAY7sG,GAEhC;AACT,kBAAMk8B,IAAiB,KAAKsiF,WAAWriF,kBAAhB,GACjBmkF,IAAgBpkF,EAAeK,iBAAf;AAGhBp3B,gBAFc+2B,EAAe+D,eAAfj0B,EAEI5H,OAAOk8G,EAAcl8G,OAAOg4C;AACpC7wC,gBAAAA;AAAhB,qBAAgBA,IAAhBA,KAAKizG,WAAWjzG,cAAAA,EAAW8yG,KAAKl5G,CAAhC;AAGU9a,sEAAyB,KAAKm0H,UAAxC;AACY72H,oEAAZ;UAVS;AAaXyO,YAAE4yB,eAAF;AAEA5yB,YAAE6yB,gBAAF;QAnBqC;QA4BpB8mG,QAAQtlH,GAAwBulH,GAAc;AAC/D,eAAKxR,WAAWtlH,QAAQ,KAAKkZ,gBAAiBlZ;AAC9C,gBAAMyT,IAAS,KAAK04D;AACpB,cAAIutD,IAAUjmH,IAAS,KAAKmiH;AAExB,eAAKjjH,QACPpB,IAAWA,EAASlT,QAAT;AAGb,mBAAShB,IAAI,GAAG8T,GAAOA,IAAOI,EAASlU,CAAT,GAAcA;AAC1C,gBAAkB,YAAd8T,EAAKzW,MAAkB;AACzB,kBAAM5K,IAAQqhB,EAAKrhB;AAEnB,kBAAciO,WAAVjO,KAAiC,SAAVA;AACzB;AAGF,kBAAM6pI,IAAY7pI,EAAM+Q,eAAe,KAArB;AAElB,uBAAS8Q,IAAI,GAAG9P,GAAQA,IAAQ83H,EAAUhoH,CAAV,GAAeA;AAI7C9P,kBAAM67B,aAAa;AAEfb,kBAAO/sC,EAAM+zB,WAAN;AACb,oBAAM80G,IAAU7oI,EAAMonC,eAAN;AAEhB,kBAAMylF,IAAM7sH,EAAMiS,mBAAmB,KAAK6zH,YAAY;AAGpDgE,kBADE,KAAKjnH,MACC+mH,IAAUf,EAAQr1H,QAElBo2H,IAAU/c;AAEpB7sH,gBAAMyF,OAAOqkI,GA/BDnmH,CA+BZ;AAEM6iB,kBAAO,KAAKoiG,YAAY5oI,GAAO8pI,GAjCzBnmH,GAiCyCklH,GAASt7H,CAAjD;AACbq8H,mBAAWf,EAAQr1H,QAAQwzH,EAAKz5H,CAAL;AAE3B,mBAAK+6H,mBAAmBv7F,GAAM/sC,GAAOwmC,CAArC;YA9ByB;AA+BF,2BAAdnlB,EAAKzW,SACR8L,IAAS2K,EAAK3K,QACpB,KAAKgyH,kBAAkBhyH,GAAQkzH,GAvCnBjmH,CAuCZ,GACAimH,KAAWlzH,EAAOlD,QAAQwzH,EAAKz5H,CAAL;QA5CiC;QA0DxD+7D,sBAAsBlC,GAA8B;AAIrD2iE,cAAiBjsH,KAAKksH,MAFjB5iE,EAAmBpwD,GADnBowD,EAAmBtwD,CAGP,IAAqBgH,KAAK4U,KAAM;AAEvD,gBAAMu3G,IAAQ,KAAKtE;AAEnB,iBACGoE,IAAgB,KAAKE,KAASF,IAAgB,KAAKE,KACnDF,IAAgB,MAAME,KAASF,IAAgB,MAAME,IAE/C,OAEF;QAdoD;QAwBpDzmB,gBAAa;AACpB,cAAI,CAAC,KAAK9U,aAAa,KAAKniC,aAAa,CAAC,KAAK/tE,UAAL;AAGxC,mBAAO;AAGT,gBAAM0rI,IAAa,KAAKx7B,UAAUpyF,sBAAf,GAMbnB,IAAM+uH,EAAW/uH;AAEvB,iBAAI,KAAK0qH,qBAA6BviH,8CAASH,MAEtC,IAAInG,uCAAK,MAAU7B,IADX+uH,EAAWx2H,QACc,MAL1By2H,GAKP,IAGA,IAAIntH,uCAAK7B,GARFgvH,KAQgB,MARhBA,GAQP;QApBW;QA4BHpB,kBAAe;AAChC,eAAKvT,WAAWtlH,QAAQ,KAAKk2H,eAAL;AACxB,cAAIxO,IAAe;AACnB,gBAAMnjH,IAAS,KAAK+gH,WAAW/0F,aAAa,KAA7B;AACf,mBAASlzB,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA;AAC1CqqH,gBAAe95G,KAAKE,IAAI45G,GAAc53H,EAAMonC,eAAN,EAAuB1zB,MAA9C;AAEjB,gBAAM62H,IAAU,KAAKlF;AACrB,mBAAS93H,IAAI,GAAGmJ,GAASA,IAAS6zH,EAAQh9H,CAAR,GAAaA;AAC7CqqH,gBAAe95G,KAAKE,IAAI45G,GAAclhH,EAAOhD,MAA9B;AAEjBkkH,eAA8B,MAAd,KAAKv7C;AACrBu7C,eAAgB,KAAKpC,WAAWtlH;AAChC0nH,eAAgB90G,2CAAUC;AAE1B,cAAI,KAAK0iH,YAAY7N,GAAc;AACjC,qBAASrqH,IAAI,GAAGvN,GAAQA,IAAQyU,EAAOlH,CAAP,GAAYA;AACtC,mBAAKw4H,SAAS37G,IAAIpqB,CAAlB,KACF,KAAK8oI,iBAAiB,KAAK/C,SAASrxI,IAAIsL,CAAlB,GAA2BA,CAAjD;AAQD,iBAAKopB,gBAAgB7G,aACrB,KAAKgqD,aACN,KAAKnjD,gBAAgB+xB,UAArB,MAAqC,QACrC,KAAK0qF,qBAA6BviH,8CAASH,OAE3C,KAAKiG,gBAAgB+D,UACnB,KAAK/D,gBAAgB0R,SACrB,KAAK1R,gBAAgBwR,UAAUg9F,CAFjC;AAMF,iBAAK6N,UAAU7N;AACf,iBAAK18G,SAAL;AACA,iBAAKkO,gBAAgBiB,eAArB;AACA,iBAAKjB,gBAAgBqzD,kBAArB;UAzBiC;QAfH;MAnV9B;AAgYGppF,+CACE2X,qCAAK+0C,4BACLxzC,yCACTk2G,yDAHF;AA5ZA,UAAAviE,0CAAA,CAAA;8CA4BauiE,mBAAAA;ACUP,UAAO+nB,sDAAP,cAA6Bz+F,oDAA7B;QA0CJra,YACE28B,GACA2N,GACA2+C,GACA8vB,GACAtqG,GAA4B;AAE5B,gBAAMlC,mCAAMq/B,UAAZ;AA5CM,eAAAmtE,cAAc;AAMtB,eAAA9vB,gBAAiC,CAAA;AAIzB,eAAAt1F,WAAiC;AAMhC,eAAA83C,eAAe;AAkCtB,eAAK8W,iBAAiBu2D,oDAAc71D;AAOpC,eAAK+1D,sBAAyC,aAAnB,OAAOr8E,IAAuBA,IAAU;AAGnE,eAAKgP,QAAQ,IAAIxhD,uCAAK,GAAG,CAAZ;AAETwyC,gBAAYpwB,mCAAMq/B,eAElBn9B,IACF,KAAKo9B,WAAWp9B,CAAhB,IAEA,KAAKwqG,SAAShwB,GAAe8vB,CAA7B,GAEEzuE,KACF,KAAKwB,aAAaxB,CAAlB;QA5B0B;QAqCXuB,WAAWp9B,GAA2B;AACvD,gBAAMo9B,WAAWp9B,CAAjB;AACA,eAAKwqG,SAASxqG,EAAOw6E,eAAex6E,EAAOsqG,WAA3C;QAFuD;QAUhDn4G,YAAS;AAChB,cAAMtyB,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAER,eAAK9oB,aAGHA,IAAqBwD,EAAAA,4DACzB7oB,EAAMmR,WACN,MACA,KAAKu5H,qBACL,KAAKD,WAJU,GAOjB,KAAKrpE,eAAe/7C,EAASC,MAAT,CAApB;QAfgB;QAkBT6uD,uBAAoB;AAC3B,gBAAMn0E,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,iBACE,MAAMgmC,qBAAN,MACC,CAAC,KAAKzW,aAAL,EAAqB6W,wCACN,oBAAfv0E,EAAM4K;QARiB;QAkBpBm7B,QAAQq4B,GAAqB;AACpC,cAAMp+D,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,gBAAMl9B,IAAKmtD,EAAa/nD,aAAa,IAA1B,GACL6jG,IAAe97C,EAAajkD,aAG5BywH,IACJxsE,EAAa/nD,aAAa,cAA1B,KACA+nD,EAAa/nD,aAAa,cAA1B,KACA;AAIIgP,cAAqBwD,EAAAA,4DACzB7oB,EAAMmR,WACNF,GACAipG,GACA0wB,CAJe;AAQjB,cAAqB,SAAjBA,KAAyBA,MAAiBvlH,EAASza;AACrD,kBAAMM,MACJ,uCACEma,EAASC,MAAT,IACA,gBACAD,EAASza,OACT,6DAEIrS,qCAAU6lE,CAAd,IACA,GARE;AAYR,eAAKxE,SAASv0C,EAASC,MAAT,CAAd;QArCoC;QA+C7Bub,MAAMu9B,GAAqB;AAElC,eAAK9rC,UAAL;AAEA8rC,YAAantD,KAAK,KAAKoU,SAAUC,MAAf;AAClB84C,YAAajkD,cAAc,KAAKkL,SAAUxa;AACtC,eAAKwa,SAAUza,QACjBwzD,EAAaxqD,aAAa,gBAAgB,KAAKyR,SAAUza,IAAzD;AAEF,iBAAOwzD;QAT2B;QAqB3BzwC,UAAUI,GAA6B;AAC9C,cAAMuwC,IAAc,KAAKC,gBAAgBisE,mDAArB;AACpB,cAAoB,SAAhBlsE;AACF,mBAAOA;AAGT,eAAKhsC,UAAL;AACM1hB,cAAQ,EAAC,IAAM,KAAKyU,SAAUC,MAAf,EAAP;AACVyI,gBACDnd,EAAA,OAAuC,KAAKyU,SAAUxa,MACtD+F,EAAA,OAAuC,KAAKyU,SAAUza;AAEzD,iBAAOgG;QAZuC;QAqBvCgd,UAAUhd,GAAyB;AAC1C,gBAAM5Q,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAER,eAAKqwB,gBAAgBgsE,qDAAe55H,CAApC,MAIEyU,IAAqBwD,EAAAA,4DACzB7oB,EAAMmR,WACNP,EAAA,MAAe,MACfA,EAAA,MACAA,EAAA,QAAiB,EAJF,GAMjB,KAAKgpD,SAASv0C,EAASC,MAAT,CAAd;QAf0C;QAuBnCm4C,eAAez9D,GAAY;AAClC,cAAIA,EAAMuvB,SAAN;AACF,kBAAMrkB,MAAM,4DAAN;AAER,gBAAMuyD,eAAez9D,CAArB;QAJkC;QAY3BsuC,WAAQ;AACf,iBAAO,KAAKjpB,WAAW,KAAKA,SAASC,MAAd,IAAwB;QADhC;QAURkG,UAAO;AACd,iBAAO,KAAKnG,WAAW,KAAKA,SAASxa,OAAO;QAD9B;QAYhBke,cAAW;AACT,iBAAO,KAAK1D;QADH;QAYF25C,eAAY;AAInB,iBAAI,KAAK35C,WACA,KAAKo3C,aAEP;QAPY;QAgBFsE,mBACjBn0D,GAA6B;AAE7B,cAAiB,SAAbA;AACF,mBAAO;AAET,cAAM5M,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAGN9oB,cAAqB0D,EAAAA,6CAAY/oB,EAAMmR,WAD/BvE,CACG;AACjB,cAAI,CAACyY;AAIH,mBAHAxZ,QAAQxG,KACN,0DAJUuH,CAGZ,GAGO;AAGHhC,cAAOya,EAASza;AACtB,iBAAK,KAAKigI,cAAcjgI,CAAnB,IAVSgC,KAWZf,QAAQxG,KAAK,uDAAuDuF,CAApE,GACO;QArBoB;QAkCZw2D,eAAekkC,GAAa;AAC7C,gBAAMtlG,IAAQ,KAAKywB,eAAL;AACd,cAAI,CAACzwB;AACH,kBAAM,IAAImuC;AAEZ,eAAK9oB,WAAqB0D,EAAAA,6CAAY/oB,EAAMmR,WAAWm0F,CAAvC;AAChB,gBAAMlkC,eAAekkC,CAArB;QAN6C;QAevCulC,cAAcjgI,GAAY;AAChC,gBAAMkgI,IAAW,KAAKpwB,iBAAL;AACjB,cAAI,CAACowB;AACH,mBAAO;AAET,mBAASv9H,IAAI,GAAGA,IAAIu9H,EAAS79H,QAAQM;AACnC,gBAAI3C,MAASkgI,EAASv9H,CAAT;AACX,qBAAO;AAGX,iBAAO;QAVyB;QAmB1BmtG,mBAAgB;AACtB,cAAIC,IAAgB,KAAKA;AACzB,cAAsB,SAAlBA,KAEE,KAAKh+C,gBAAgB,CAAC,KAAKA,aAAajf,cAAlB;AACxB,mBAAO,KAAKif,aAAaxrD,UAAUupG,iBAA5B;cAGKC,KAAiB,CAAC,EAAD;AACjC,cAA6B,MAAzBA,EAAc1tG;AAGhB,kBADMpC,IAAO,KAAK2gB,QAAL,GACPtgB,MACJ,uCAAuCL,IAAO,oBAD1C;AAIR,iBAAO8vG;QAhBe;QA6BhBgwB,SAAShwB,IAAiC,MAAM8vB,IAAc,IAAE;AAKtE,cAAI/6H,MAAMyR,QAAQw5F,CAAd,GAA8B;AAEhC,gBAAIowB,IAAY;AAChB,qBAASx9H,IAAI,GAAGA,IAAIotG,EAAc1tG,QAAQM;AACpCotG,gBAAcptG,CAAd,MAAqBk9H,MACvBM,IAAY;AAGhB,gBAAI,CAACA;AACH,oBAAM7/H,MACJ,2BACEu/H,IACA,wCAHE;UATwB,WAgBL,SAAlB9vB;AACT,kBAAMzvG,MACJ,uEADI;AAMR,eAAKu/H,cAAcA;AACnB,eAAK9vB,gBAAgBA;QA7BiD;QAuC/D74C,sBAAmB;AAC1B,eAAKjB,cAAL;QAD0B;QAYTwU,gBAAgBz2C,GAAYO,GAAkB;AACzDluB,cAAKkuB,EAASmP,SAAT;AAEX,cAAI,KAAKquB,gBAAgB,CAAC,KAAKA,aAAajf,cAAlB,GAAmC;AAC3D,gBAAIzsC,MAAyBynG,8DAAoB;AAErCtxF,gBAAAA,gDACR,KAAKu1C,aAAaxrD,WAClB,KAAKkU,QAFP;AAIA;YAN+C;AAO1C,gBAAIpU,MAAyB0nG,8DAAoB;AAEtD,mBAAKh8C,aAAaxrD,UAAUm9C,mBAAmB,KAAKjpC,SAAUC,MAAf,CAA/C;AACA;YAHsD;UARG;AAe7D,eAAKs0C,SAAS3oD,CAAd;QAlB+D;QA4BxD4wD,sBAAmB;AAC1B,iBAAO;QADmB;QAcZptE,OAAAA,SACd2X,GAAoC;AAKpC,iBAAO,IAAI;YAHanL,8DAAyBmL,EAAQiZ,QAAzCgpC;YAGSpgD;YAAWA;YAAWA;YAAW7B;UAAnD;QAL6B;QAc/BuoE,OAAAA,iBAAc;AACnB,cAAI,CAAC,KAAKtvD;AACR,kBAAMna,MACJ,6EADI;AAKR,gBAAML,IAAO,KAAK2gB,QAAL;AACb,cAAIzF,IAAqC,CAAA;AACzC,cAAI,KAAK42C,gBAAgB,CAAC,KAAKA,aAAajf,cAAlB,GAAmC;AAC3D,gBAAMi9D,IAAgB,KAAKD,iBAAL;AAGtB,qBAASntG,IAAI,GAAGA,IAAIotG,EAAc1tG,QAAQM,KAAK;AAE7C,oBAAM2X,IACJ,KAAKy3C,aAAaxrD,UAAU6U,mBAFT20F,EAAcptG,CAAdq9H,CAEnB;AACF7kH,kBAAoBA,EAAkBtW,OAAOyV,CAAzB;YAJyB;UAJY;AAW7Da,YAAkBG,KAAKC,oDAAcC,aAArC;AAEMha,cAA8B,CAAA;AACpC,eAASmB,IAAI,GAAGA,IAAIwY,EAAkB9Y,QAAQM;AAE5CnB,cAAQmB,CAAR,IAAa,CAACwY,EAAkBxY,CAAlB,EAAqB1C,MAAMkb,EAAkBxY,CAAlB,EAAqB+X,MAArB,CAA5B;YAEPjY,KAAK,CACX6Z,EAAAA,+BAAA,iBACkBwxF,4DAFP,CAAb;AAIIxxF,YAAAA,+BAAA,mBACF9a,EAAQiB,KAAK,CACX6Z,EAAAA,+BAAA,gBAAuBhP,QAAQ,MAAMrN,CAArC,GACkB8tG,4DAFP,CAAb;AAMF,iBAAOvsG;QAtCY;MA9fjB;AAwiBQ/Y,qDAAS,kBAAkBm3I,mDAAzC;AA9kBA,UAAAtqF,uCAAA,CAAA;2CAsCasqF,gBAAAA;ACbP,UAAOQ,kDAAP,cAA2BtP,8CAA3B;QAsCJhqG,YACE/Z,GACAoG,GACAC,GACAitH,GACAjvE,GACA77B,GAA0B;AAG1B,gBAAMlC,mCAAMq/B,UAAZ;AA7CQ,eAAA4tE,OAAO;AAGP,eAAAC,OAAOnnG;AAGP,eAAAonG,aAAa;AAMf,eAAAC,gBAA+B;AAGpB,eAAA1P,cAAc;AAgC3BhkH,gBAAUsmB,mCAAMq/B,eAChBn9B,IACF,KAAKo9B,WAAWp9B,CAAhB,IAEA,KAAKmrG,eAAevtH,GAAKC,GAAKitH,CAA9B,GAEF,KAAKrxE,SAASjiD,CAAd,GACIqkD,KACF,KAAKwB,aAAaxB,CAAlB;QAbwB;QAsBTuB,WAAWp9B,GAAyB;AACrD,gBAAMo9B,WAAWp9B,CAAjB;AACA,eAAKorG,eAAeprG,EAAOpiB,GAA3B;AACA,eAAKytH,eAAerrG,EAAOniB,GAA3B;eACKytH,qBAAqBtrG,EAAO8qG,SAAjC;QAJqD;QAoBvDK,eACEvtH,GACAC,GACAitH,GAA6C;AAE7C,eAAKM,eAAextH,CAApB;AACA,eAAKytH,eAAextH,CAApB;AACA,eAAKytH,qBAAqBR,CAA1B;AACA,eAAKrxE,SAAS,KAAKtrB,SAAL,CAAd;QAL6C;QAc/Co9F,OAAO3tH,GAAuC;AAC5C,eAAKwtH,eAAextH,CAApB;AACA,eAAK67C,SAAS,KAAKtrB,SAAL,CAAd;QAF4C;QAWtCi9F,eAAextH,GAAuC;AACjD,kBAAPA,IACF,KAAKmtH,OAAO,aAEZntH,IAAMO,OAAOP,CAAP,GACD6f,MAAM7f,CAAN,MACH,KAAKmtH,OAAOntH;QAN4C;QAiB9D4tH,SAAM;AACJ,iBAAO,KAAKT;QADR;QAUNU,OAAO5tH,GAAuC;AAC5C,eAAKwtH,eAAextH,CAApB;AACA,eAAK47C,SAAS,KAAKtrB,SAAL,CAAd;QAF4C;QAWtCk9F,eAAextH,GAAuC;AACjD,kBAAPA,IACF,KAAKmtH,OAAOnnG,YAEZhmB,IAAMM,OAAON,CAAP,GACD4f,MAAM5f,CAAN,MACH,KAAKmtH,OAAOntH;QAN4C;QAiB9D6tH,SAAM;AACJ,iBAAO,KAAKV;QADR;QAUNW,aAAab,GAA6C;AACxD,eAAKQ,qBAAqBR,CAA1B;eACKrxE,SAAS,KAAKtrB,SAAL,CAAd;QAFwD;QAWlDm9F,qBAAqBR,GAA6C;AACxE,eAAKG,aAAa9sH,OAAO2sH,CAAP,KAAqB;AACvC,cAAIc,IAAkBpgI,OAAO,KAAKy/H,UAAZ;AAClBW,YAAgBxtH,SAAS,GAAzB,MAGFwtH,IAAkB,KAAKX,WAAWY,eAAe,SAAS,EACxDC,uBAAuB,GADiC,CAAxC;AAIpB,gBAAMC,IAAeH,EAAgB73H,QAAQ,GAAxB;AAInB,eAAKm3H,gBAHc,OAAjBa,IAGmBjB,IAAY,IAAI,OAEhBc,EAAgB9+H,SAASi/H,IAAe;QAhBS;QA2B1EC,eAAY;AACV,iBAAO,KAAKf;QADF;QAWOrqE,mBACjBn0D,GAA6B;AAE7B,cAAiB,SAAbA;AACF,mBAAO;AAOTA,cAHWA,GAAGA,CAAHA,GAGSsL,QAAQ,OAAO,GAAxB;AAEXtL,cAAWA,EAASsL,QAAQ,MAAM,EAAvB;AAEXtL,cAAWA,EAASsL,QAAQ,aAAa,UAA9B;AAGPgvF,cAAI5oF,OAAO1R,KAAY,CAAnB;AACR,cAAIgxB,MAAMspE,CAAN;AAEF,mBAAO;AAGTA,cAAIppF,KAAKC,IAAID,KAAKE;YAAIkpF;YAAG,KAAKgkC;UAAjB,GAAwB,KAAKC,IAAtC;AAEA,eAAKC,cAAcgB,SAASllC,CAAT,MACrBA,IAAIppF,KAAKuQ,MAAM64E,IAAI,KAAKkkC,UAApB,IAAkC,KAAKA;AAGlB,mBAAvB,KAAKC,kBACPnkC,IAAI5oF,OAAO4oF,EAAEmlC,QAAQ,KAAKhB,aAAf,CAAP;AAEN,iBAAOnkC;QAhCsB;QAwCZ41B,gBAAa;AAC9B,gBAAMT,IAAY,MAAMS,cAAN;AAGF,sBAAZ,KAAKoO,SACP7O,EAAUt+G,MAAM,GAAG,KAAKmtH,IAAR,IACXrvI,2CAASwgI,GAAgB/iF,wCAAMgzF,UAAU,KAAKpB,IAAnD;AAEclnG,qBAAZ,KAAKmnG,SACP9O,EAAUr+G,MAAM,GAAG,KAAKmtH,IAAR,IACXtvI;YAASwgI;YAAgB/iF,wCAAMizF;YAAU,KAAKpB;UAAnD;AAEF,iBAAO9O;QAZuB;QAuBhB5nI,OAAAA,SAAS2X,GAAkC;AAGzD,iBAAO,IAAI,KACTA,EAAQuL,OACR1J,QACAA,QACAA,QACAA,QACA7B,CANK;QAHkD;MApSvD;AAkTQ/Y,qDAAS,gBAAgB23I,+CAAvC;AAEAA,sDAAY5tG,UAAU6+B,gBAAgB;AA7UtC,UAAA/b,qCAAA,CAAA;AAyBa8qF,yCAAAA,cAAAA;ACCP,UAAOwB,yEAAP,cAAsCzyC,8CAAtC;QAuBJroE,YAAY/Z,GAAgBqiF,GAAoB75D,GAAyB;AACvE,gBAAMx0B,OAAOgM,QAAAA,IAAAA,IAAS,EAAhB,GAAqBqiF,GAAW75D,CAAtC;AAnBO,eAAA+8B,WAAW;AAOX,eAAAC,eAAe;QAWiD;QAazD1oE,OAAAA,SACd2X,GAAiC;AAKjC,iBAAO,IAAI,KAHUnL,8DAAyBmL,EAAQqO,IAAzCA,GAGSxM,QAAW7B,CAA1B;QAL0B;MArC/B;AA8CQ/Y,qDAAS,4BAA4Bm5I,sEAAnD;UAxEAtsF,iDAAA,CAAA;AA0BassF,qDAAAA,yBAAAA;ACAP,UAAOC,sDAAP,cAA6BxuG,mCAA7B;QAoCJvM,YACE/Z,GACAqkD,GACA77B,GAA4B;AAE5B,gBAAMlC,mCAAMq/B,UAAZ;AAhCO,eAAAH,eAAe;AAKf,eAAA1d,SAAS;AAMT,eAAA2d,SAAyB,KAAKA;AA2BrC,eAAKsvE,YAAYD,oDAAcE;AAE3Bh1H,gBAAUsmB,mCAAMq/B,eAChBn9B,KACF,KAAKo9B,WAAWp9B,CAAhB,GAEF,KAAKy5B,SAASjiD,CAAd,GACIqkD,KACF,KAAKwB,aAAaxB,CAAlB;QAhB0B;QAyBXuB,WAAWp9B,GAA2B;AACvD,gBAAMo9B,WAAWp9B,CAAjB;AACIA,YAAOysG,mBAAgB,KAAKF,YAAYvsG,EAAOysG;QAFI;QAWhDj/G,YAAS;AAChB,gBAAM2wC,IAAc,KAAKC,gBAAgBkuE,mDAArB;AACpB,iBAAoB,SAAhBnuE,IACKA,IAEF,KAAKuuE,gBAAL;QALS;QAWTt7F,WAAQ;AACf,gBAAMA,SAAN;AAEA,gBAAMr3B,IAAc,KAAKglD,eAAL;AAChBxoE,oDAASwjB,GAAa,iBAA1B;AACAA,YAAYH,MAAMkB,UAAU,KAAKmiD,SAAS,UAAU;QALrC;QAQRgC,UAAO;AACV,eAAKhD,iBACP,KAAKA,aAAaiD,YAAY,KAAKC,gBAAL;AAEhC,eAAKC,YAAY,KAAK7B,aAAL,EAAqBq1B,uBAAtC;QAJc;QAOPzzB,kBAAe;AACtB,iBAAO,KAAKotE;QADU;QAUxBI,kBAAkBC,GAAwB;AACxC,eAAKL,YAAYK,KAAaN,oDAAcE;AAC5C,eAAK9rE,cAAL;QAFwC;QAMvBlC,cAAW;AAC5B,eAAK/E,SAAS,CAAC,KAAKwD,MAApB;QAD4B;QAUX2D,mBACjBn0D,GAA6B;AAE7B,iBAAiB,SAAbA,KAAkC,WAAbA,IAChB,SAEQ,UAAbA,KAAmC,YAAbA,IACjB,UAEF;QARsB;QAiBZw0D,eAAex0D,GAAoB;AACpD,eAAKwwD,SAAS,KAAK4vE,oBAAoBpgI,CAAzB;AAEV,eAAKyvD,iBACP,KAAKA,aAAatiD,MAAMkB,UAAU,KAAKmiD,SAAS,UAAU;QAJR;QAa7C9uB,WAAQ;AACf,iBAAO,KAAK8uB,SAAS,SAAS;QADf;QASjByvE,kBAAe;AACb,iBAAO,KAAKzvE;QADC;QASN5xC,UAAO;AACd,iBAAO7f,OAAO,KAAKqhI,oBAAoB,KAAK5vE,MAA9B,CAAP;QADO;QAaR4vE,oBAAoBr1H,GAA0B;AACpD,iBAAqB,aAAjB,OAAOA,IAAqC,WAAVA,IAC/B,CAAC,CAACA;QAF2C;QAatCljB,OAAAA,SACd2X,GAAoC;AAIpC,iBAAO,IAAI,KAAKA,EAAQmsD,SAAStqD,QAAW7B,CAArC;QAJ6B;MA3MlC;AAEYqgI,0DAAAE,aAAa;AAiNjBt5I,qDAAS,kBAAkBo5I,mDAAzC;AAEAA,0DAAcrvG,UAAU6+B,gBAAgB;AA/OxC,UAAA/b,uCAAA,CAAA;AA0BausF,2CAAAA,gBAAAA;ACPP,UAAOQ,kDAAP,MAAA;QAKJv7G,YACYm4C,GACA14D,GAAuB;AADvB,eAAA04D,YAAAA;AACA,eAAA14D,YAAAA;AAJF,eAAA0iG,aAAiC;AAMzC,eAAK9/C,WAAW8V,EAAUt/C,uBAAV;QAFiB;QAMnCo/C,YAAYv8D,GAAe;AACzB,eAAKy8D,UAAU5hC,UAAU76B,CAAzB;QADyB;QAU3Bw8D,OAAOx8D,GAAiB8/H,GAAsB;AAC5C,eAAKC,cAAc//H,GAAG8/H,CAAtB;AACMngG,cAAO,KAAKqgG,QAAQ,KAAKvjE,SAAlB;AAITjiE,oEAAYmlC,CAAZ,KACFA,EAAKu2B,eAAe,KAAK+pE,qBAAqBjgI,GAAG2/B,CAA7B,CAApB;AAEF,eAAKugG,iBAAiBlgI,CAAtB;QAT4C;QAapCkgI,iBAAiBlgI,GAAe;AAClCmgI,cAAgB,KAAKp8H,UAAUuyG,cAAct2G,CAA7B;AACtB,gBAAM2/B,IAAO,KAAKqgG,QAAQ,KAAKvjE,SAAlB;cACT,KAAKgqC,eAAe05B,GAAe;AAChC15B,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,eAAAA,EAAYkb,WAAWhiF,CAA5B;AACA,oBAAAwgG,KAAAA,EAAe3e,YAAY7hF,CAA3B;UAFqC;AAIvC,kBAAAwgG,KAAAA,EAAeze,WAAW/hF,CAA1B;AACA,eAAK8mE,aAAa05B;QARsB;QAelCJ,cAAc//H,GAAiB8/H,GAAsB;AACrD95E,cAAQ,KAAKo6E,uBAAuBN,CAA5B;AACRh5E,cAAS93C,mDAAW8Q,IAAI,KAAK6mC,UAAUX,CAA9B;AACf,eAAKyW,UAAU3hC,KAAKgsB,GAAQ9mD,CAA5B;QAH2D;QAUnDigI,qBACRjgI,GACAqgI,GAAsC;AAUtC,kBARM55B,IAAa,KAAK1iG,UAAUuyG,cAAct2G,CAA7B,MAGM,KAAK+D,UAAUg7C,oBAAf4oD,EACazwD,cACpCuvD,EAAW5iG,IACXwyC,0DAAiBN,WAAWI,WAFTyxD,IAMbnB,EAA2BtwC,YAAYkqE,CAAvC,IAFkB;QAVY;QAgBxChjE,UAAUr9D,GAAe;AACvB,gBAAMsgI,IAAuBh9H,EAAAA,6CAAX;AAClB,cAAMmjG,IAAa,KAAK1iG,UAAUuyG,cAAct2G,CAA7B;AACnB,gBAAM2/B,IAAO,KAAKqgG,QAAQ,KAAKvjE,SAAlB;AAEb,cAAIgqC,GAAY;AACTA,gBAAAA;AAAL,qBAAKA,IAALA,KAAKA,eAAAA,EAAYmb,OAAOjiF,CAAxB;UADc;AAIZ,eAAK4gG,oBAAoBvgI,GAAG2/B,CAA5B,KACF,KAAK88B,UAAUzhC,WAAf;AAMF,WAHMm7B,IAAc37D,0DAAYmlC,CAAZ,KAAqB,KAAKsgG,qBAAqBjgI,GAAG2/B,CAA7B,MAGtB,KAAK88B,qBAAqBv0B,6CAC3B5xC,wDAAgB,KAAKmmE,UAAUn2B,aAAf,CAAhC;eAGGm2B,UAAU1hC,QAAQ/6B,CAAvB;AAEIm2D,eAAe37D,0DAAYmlC,CAAZ,MAGXriB,IAAsBha,EAAAA,6CAAX,GACNC,EAAAA,6CAAS+8H,CAApB,GACA3gG,EAAKhtC,QAAL,GACW4Q,EAAAA,6CAAS+Z,CAApB;QA5BqB;QAkCjB0iH,QAAQvjE,GAAqB;AACnC,iBAAOA,aAAqBv0B,4CAAWu0B,EAAUn2B,aAAV,IAA2Bm2B;QAD/B;QAQ3B8jE,oBAAoBvgI,GAAiBqgI,GAAyB;AAEtE,kBADM55B,IAAa,KAAK1iG,UAAUuyG,cAAct2G,CAA7B,KAEZymG,EAAWob,kBAAkBwe,CAA7B,IADiB;QAF8C;QAM9DD,uBAAuBruF,GAAsB;AAC/C9jC,cAAS,IAAIe,mDACjB+iC,EAAWroC,IAAI,KAAK3F,UAAUjB,OAC9BivC,EAAWnoC,IAAI,KAAK7F,UAAUjB,KAFjB;AAIX,eAAKiB,UAAUm5B,aAKjBjvB,EAAOnL,MAAM,IADK,KAAKiB,UAAU/E,QAAQ4G,gBAAiB9C,KAC1D;AAEF,iBAAOmL;QAZ8C;MA/HnD;AA+IGhoB,+CAAkB2X,qCAAKi1C,eAAwB1zC,yCAAS0gI,+CAAjE;AAlKA,UAAA/sF,yCAAA,CAAA;AAmBa+sF,6CAAAA,UAAAA;ACnBb,UAAA/sF,iCAAA,CAAA;AAWiBypE,qCAAAA,oBAAAA;AAAmB9yC,qCAAAA,qBAAAA;AAAoB/iB,qCAAAA,sBAAAA;AAAhDm5E,qCAAAA,UAAAA;ACYF,UAAOW,4DAAP,cAAyBtsF,oDAAzB;QAuBJ5vB,YAAYgwB,GAAmBmsF,GAAuBC,GAAoB;AAExE,gBADoBpsF,IAAYA,EAAUvwC,UAAUF,KAAKhD,MACzD;AAZO,eAAArD,OAAkB21C;AAapBmB,gBAEL,KAAK7yC,UAAU6yC,EAAUzwC,IACzB,KAAKq1G,UAAUunB,GACf,KAAKp5H,SAASq5H;QAP0D;QAejE7sF,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAqBhzC,WAAjB,KAAKq4G;AACP,kBAAUp7G,MACR,oHADI;AAKR,cAAqB+C,WAAjB,KAAKY;AACP,kBAAU3D,MACR,qFADI;AAKRgG,YAAA,UAAkB,KAAKo1G;AACvBp1G,YAAA,UAAkB,KAAKrC;AAGvBqC,YAAA,SAAiB,KAAKuD;AACtB,iBAAOvD;QAnBM;QA+BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI8gI,2DAHE;AAKjB/rF,YAASykE,UAAUp1G,EAAA;AACnB2wC,YAAShzC,UAAUqC,EAAA;AACnB2wC,YAASptC,SAASvD,EAAA;AAClB,iBAAO2wC;QAVI;MAxET;AA4FGxuD,+CAAkB2X,qCAAKsG,OAAkBivC,gDAAYqtF,yDAA9D;UAnHA1tF,iDAAA,CAAA;AAuBa0tF,qDAAAA,YAAAA;ACGP,UAAOG,oGAAP,cAA4C10E,0DAA5C;QA8BJ3nC,YACEgwB,GACA54B,GACA0wC,GACAC,GAAsB;AAEtB,gBAAM/X,CAAN;AAnCO,eAAA92C,OAAkB+kC;AAYlB,eAAA9iC,aAAa;AAwBf60C,gBAIL,KAAK72C,OAAOie,GACZ,KAAK4wC,WAAWF,GAChB,KAAK5sD,WAAW6sD;QATM;QAiBfxY,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKp2C;AACR,kBAAUK,MACR,+FADI;AAKRgG,YAAA,OAAe,KAAKrG;AACpBqG,YAAA,WAAmB,KAAKwoD;AACxBxoD,YAAA,WAAmB,KAAKtE;AACxB,iBAAOsE;QAXM;QAuBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIihI,mGAHE;AAKjBlsF,YAASh3C,OAAOqG,EAAA;AAChB2wC,YAAS6X,WAAWxoD,EAAA;AACpB2wC,YAASj1C,WAAWsE,EAAA;AACpB,iBAAO2wC;QAVI;QAkBJnzC,SAAM;AACb,iBAAO,KAAKgrD,aAAa,KAAK9sD;QADjB;QASNu0C,IAAI9yC,GAAgB;AAC3B,cAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKxyC;AACR,kBAAU3D,MACR,qFADI;AAKFlL,cAAQmR,EAAUK,aAAa,KAAK3C,OAA5B;AACd,cAAI,CAAC7O;AACH,kBAAUkL,MACR,6FADI;AAMFyM,cAAQtJ,IAAU,KAAKzB,WAAW,KAAK8sD;AAE7C,WADM9wC,IAAQ5oB,EAAMgyB,SAAS,KAAKnnB,IAApB,KAEZ+d,EAAMgxC,SAASjiD,CAAf,IAEA9L,QAAQxG,KAAK,mCAAmC,KAAKwF,IAArD;QArByB;MAxGzB;AAwIGxX,+CACE2X,qCAAKsG,OACHq+B,qEACXo+F,iGAHF;UAlKA7tF,sEAAA,CAAA;AA0Ba6tF,0EAAAA,+BAAAA;ACMP,UAAOC,4DAAP,cAAyB30E,0DAAzB;QAgDJ3nC,YAAYgwB,GAAiB;AAC3B,gBAAMA,CAAN;AAhDO,eAAA92C,OAAkB6oC,EAAAA;AAkDpBiO,gBAIDA,EAAUnyB,SAAV,MAEF,KAAK1iB,aAAa,QAGdiiD,IAAW,KAAKm/E,iBAAL,GACjB,KAAKC,cAAcp/E,EAASq/E,UAC5B,KAAKC,eAAet/E,EAAS78B,WAC7B,KAAKs4F,gBAAgBz7D,EAASxa;QAfH;QAuBpB2M,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb/vC,YAAA,cAAsB,KAAKg9H;AAC3Bh9H,YAAA,eAAuB,KAAKk9H;AACxB,eAAK7jB,kBACPr5G,EAAA,gBACE,GAAG4M,KAAKuQ,MAAM,KAAKk8F,cAAczzG,CAA9B,CAAH,KACGgH,KAAKuQ,MAAM,KAAKk8F,cAAcvzG,CAA9B,CAAH;AAEJ9F,YAAA,cAAsB,KAAK9B;AAC3B8B,YAAA,eAAuB,KAAK7B;AACxB,eAAKC,kBACP4B,EAAA,gBACE,GAAG4M,KAAKuQ,MAAM,KAAK/e,cAAcwH,CAA9B,CAAH,KACGgH,KAAKuQ,MAAM,KAAK/e,cAAc0H,CAA9B,CAAH;AAEA,eAAKzH,WACP2B,EAAA,SAAiB,KAAK3B;AAEnB,eAAK1C,eACRqE,EAAA,aAAqB,KAAKrE;AAE5B,iBAAOqE;QAtBM;QAkCRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIkhI,2DAHE;AAKjBnsF,YAASqsF,cAAch9H,EAAA;AACvB2wC,YAASusF,eAAel9H,EAAA;AACpBA,YAAA,kBACI+M,IAAK/M,EAAA,cAAsBgI,MAAM,GAA5B,GACX2oC,EAAS0oE,gBAAgB,IAAInuG,mDAAWkC,OAAOL,EAAG,CAAH,CAAP,GAAeK,OAAOL,EAAG,CAAH,CAAP,CAA9B;AAE3B4jC,YAASzyC,cAAc8B,EAAA;AACvB2wC,YAASxyC,eAAe6B,EAAA;AACpBA,YAAA,kBACI+M,IAAK/M,EAAA,cAAsBgI,MAAM,GAA5B,GACX2oC,EAASvyC,gBAAgB,IAAI8M,mDAAWkC,OAAOL,EAAG,CAAH,CAAP,GAAeK,OAAOL,EAAG,CAAH,CAAP,CAA9B;AAEJhQ,qBAAnBiD,EAAA,WACF2wC,EAAStyC,SAAS2B,EAAA;AAEOjD,qBAAvBiD,EAAA,eACF2wC,EAASh1C,aAAaqE,EAAA;AAExB,iBAAO2wC;QAzBI;QA6Bb4N,YAAS;AACP,gBAAMX,IAAW,KAAKm/E,iBAAL;AACjB,eAAK7+H,cAAc0/C,EAASq/E;eACvB9+H,eAAey/C,EAAS78B;AAC7B,eAAK3iB,gBAAgBw/C,EAASxa;QAJvB;QAYTkb,UAAUjgD,GAAgB;AACxB,eAAKA,SAASA;QADU;QAUlB0+H,mBAAgB;AACtB,cAAM98H,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKxyC;AACR,kBAAU3D,MACR,qFADI;AAKR,cAAMlL,IAAQmR,EAAUK,aAAa,KAAK3C,OAA5B;AACd,cAAI,CAAC7O;AACH,kBAAUkL,MACR,mEADI;AAKF4jD,cAAW,CAAA;AACjB,gBAAMp9C,IAAS1R,EAAM2R,UAAN;AACf,cAAID,GAGF;AAAA,gBAFAo9C,EAASq/E,WAAWz8H,EAAOT,IACrB6d,IAAQpd,EAAOsyF,kBAAkBhkG,CAAzB;AAEZ8uD,gBAAS78B,YAAYnD,EAAMjkB;UAD7B;AAIAikD,cAASxa,aAAat0C,EAAMuqB,uBAAN;iBAEjBukC;QA1Be;QAkCfpgD,SAAM;AACb,iBACE,KAAKw/H,gBAAgB,KAAK9+H,eAC1B,KAAKg/H,iBAAiB,KAAK/+H,gBAC3B+M,mDAAW2xB,OAAO,KAAKw8E,eAAe,KAAKj7G,aAA3C;QAJW;QAaN6xC,IAAI9yC,GAAgB;AAC3B,cAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKxyC;AACR,kBAAU3D,MACR,qFADI;AAKR,cAAMlL,IAAQmR,EAAUK,aAAa,KAAK3C,OAA5B;AACd,cAAK7O,GAAL;AAIA,gBAAMmuI,IAAW9/H,IAAU,KAAKe,cAAc,KAAK8+H,aAC7Cj8G,IAAY5jB,IAAU,KAAKgB,eAAe,KAAK++H;AAC/C95F,gBAAajmC,IAAU,KAAKiB,gBAAgB,KAAKi7G;gBAEnD4jB,GAAU;AACZ,kBAAAlvC,IAAc9tF,EAAUK,aAAa28H,CAAvB;AACd,kBAAI,CAAClvC,GAAa;AAChBpzF,wBAAQxG,KAAK,0CAA0C8oI,CAAvD;AACA;cAFgB;YAFN;AAOVnuI,cAAM2R,UAAN,KACF3R,EAAM4/F,OAAN;AAEF,gBAAItrD;AACIr2B,kBAAKje,EAAMuqB,uBAAN,GACXvqB,EAAMyF,OAAO6uC,EAAWx9B,IAAImH,EAAGnH,GAAGw9B,EAAWt9B,IAAIiH,EAAGjH,GAAG,KAAKzH,MAA5D;iBACK;AACD8+H,kBAAkBruI,EAAMiS;AAC5B,kBACE,CAACo8H,KACAruI,EAAMkS,sBAAsBlS,EAAMkS,mBAAmBszB,YAAzB;AAE7B6oG,oBAAkBruI,EAAMkS;AAE1B,kBAAIud,GACmB4+G;AAAjBj/B,kBAAkCxkG,SAAjByjI,IAAAA,KAAiBzjI,SAAjByjI,EAAiBzjI;AACxC,kBAAIqnB,GAEF;AAAA,oBADMnD,IAAQmwE,EAAa/sE,SAASD,CAAtB;AAEZxC,sBAAmBX,EAAMG;cAD3B;AAGSmgF,sBAAmB1qC,sDAAeI,uBAC3Cr1C,IAAmBwvE,EAAa9vE;AAE9BM,mBAAoB4+G,IACtBA,EAAgBt9G,QAAQtB,CAAxB,IAEA5jB,QAAQxG,KAAK,0CAA0C4sB,CAAvD;YArBG;UArBP;AACEpmB,oBAAQxG,KAAK,oCAAoC,KAAKwJ,OAAtD;QAVyB;MA9MzB;AAkRGxb,+CAAkB2X,qCAAKsG,OAAkBpC,EAAAA,0CAAM8+H,yDAAxD;AAlTA,UAAA9tF,iDAAA,CAAA;AAgCa8tF,qDAAAA,YAAAA;ACTP,UAAOM,8DAAP,cAA0BhtF,oDAA1B;QAmBJ5vB,YACEgwB,GACAmlE,GACA0nB,GAA2B;AAG3B,gBADoB7sF,IAAYA,EAAUvwC,UAAUF,KAAKhD,MACzD;AAfO,eAAArD,OAAkByF;AAgBpBqxC,gBAEL,KAAK7yC,UAAU6yC,EAAUzwC,IACzB,KAAKo+B,SAASw3E,GACd,KAAKz3E,aAAam/F;QARS;QAgBpBttF,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAoBhzC,WAAhB,KAAKohC;AACP,kBAAUnkC,MACR,uHADI;AAKR,cAAI,CAAC,KAAKkkC;AACR,kBAAUlkC,MACR,6FADI;AAKRgG,YAAA,SAAiB,KAAKm+B;AACtBn+B,YAAA,aAAqB,KAAKk+B;AAC1Bl+B,YAAA,UAAkB,KAAKrC,WAAW;AAClC,iBAAOqC;QAjBM;QA6BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIwhI,6DAHE;AAKjBzsF,YAASxS,SAASn+B,EAAA;AAClB2wC,YAASzS,aAAal+B,EAAA;AACtB2wC,YAAShzC,UAAUqC,EAAA;AACnB,iBAAO2wC;QAVI;MAtET,GAoFM2sF;gBAAAA,GAAU;AACpBA,UAAA9gF,UAAA;AACA8gF,UAAAptG,UAAA;AACAotG,UAAA7gF,UAAA;MAHoB,GAAV6gF,gEAAAA,8DAAU,CAAA,EAAtB;AAYSn7I,+CAAkB2X,qCAAKsG,OAAkBjB,iDAAai+H,2DAA/D;AAvHA,UAAApuF,kDAAA,CAAA;sDAuBaouF,aAAAA;AAoFDE,sDAAAA,aAAAA;AChFN,UAAOC,gEAAP,cAA2BltF,uDAA3B;QAUJ7vB,YAAYg9G,GAA8B;AACxC,gBAAA;AAEA,eAAKxtF,UAAU,CAACwtF;AAEXA,gBAEL,KAAK56F,YAAY46F,EAAYz9H,IAC7B,KAAKzD,cAAckhI,EAAYv9H,UAAUF,IACzC,KAAKjD,QAAmB0C,EAAAA,6CAAX,GACb,KAAK7D,aAAwB7Y,kDAAX;QAVsB;QAkBjCitD,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKnN;AACR,kBAAU5oC,MACR,yFADI;AAKRgG,YAAA,YAAoB,KAAK4iC;AACzB,iBAAO5iC;QATM;QAqBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI2hI,+DAHE;AAKjB5sF,YAAS/N,YAAY5iC,EAAA;AACrB,iBAAO2wC;QARI;QAiBN8sF,OAAAA,0BACL7hI,GACApB,GAAe;AAEf,gBAAMyF,IAAYrE,EAAMu0C,mBAAN;AAClB,cAAI31C,GAAQ;AACV,gBAAI,CAACoB,EAAMoE;AACT,oBAAUhG,MAAM,iDAAV;AAECzP,2EAAOqR,EAAMoE,MAAMC,CAA5B;UAJU,OAKL;AACL,gBAAI,CAACrE,EAAMgnC;AACT,oBAAU5oC,MACR,yFADI;AAMR,aADMigB,IAAUha,EAAU0iC,eAAe/mC,EAAMgnC,SAA/B,KAEd3oB,EAAQprB,QAAR,IAEA8L,QAAQxG,KAAK,wCAAwCyH,EAAMgnC,SAA3D;UAXG;QARQ;MAvEb,GA3BNoM,mDAAA,CAAA;AA2BauuF,uDAAAA,cAAAA;ACJP,UAAOG,oEAAP,cAA6BH,8DAA7B;QAgBJ/8G,YACEg9G,GACAG,GACAC,GAAwB;AAExB,gBAAMJ,CAAN;AApBO,eAAA9jI,OAAkBi2C;AAsBpB6tF,gBAIL,KAAKK,eACwB,gBAA3B,OAAOF,IAAkC,KAAKA,GAChD,KAAKG,eACwB,gBAA3B,OAAOF,IAAkC,KAAKA;QAXxB;QAmBjB7tF,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAK8tF;AACR,kBAAU7jI,MACR,yFADI;AAKR,cAAI,CAAC,KAAK8jI;AACR,kBAAU9jI,MACR,yFADI;AAKRgG,YAAA,cAAsB,KAAK69H;AAC3B79H,YAAA,cAAsB,KAAK89H;AAC3B,iBAAO99H;QAhBM;QA4BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI8hI,mEAHE;AAKjB/sF,YAASktF,eAAe79H,EAAA;AACxB2wC,YAASmtF,eAAe99H,EAAA;AACxB,iBAAO2wC;QATI;QAiBJnzC,SAAM;AACb,iBAAO,KAAKqgI,iBAAiB,KAAKC;QADrB;QASN7tF,IAAI9yC,GAAgB;AAC3B,cAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKvN;AACR,kBAAU5oC,MACR,yFADI;AASR,cAHMigB,IAAUha,EAAU0iC,eACxB,KAAKC,SADS,GAGhB;AAIA,gBAAMryB,IAAWpT,IAAU,KAAK2gI,eAAe,KAAKD;AACpD,gBAAiB9gI,WAAbwT,GAAwB;AAC1B,kBAAIpT;AACF,sBAAUnD,MACR,yFADI;AAKR,oBAAUA,MACR,yFADI;YAPoB;AAY5BigB,cAAQgB,QAAQ1K,CAAhB;UAjBA;AACE5V,oBAAQxG,KAAK,wCAAwC,KAAKyuC,SAA1D;QAbyB;MA/FzB;AAqIGzgD,+CACE2X,qCAAKsG,OACHuvC,oDACX+tF,iEAHF;UA5JA1uF,qDAAA,CAAA;AAuBa0uF,yDAAAA,gBAAAA;ACEP,UAAOK,oEAAP,cAA6BR,8DAA7B;QAaJ/8G,YAAYg9G,GAA8B;AACxC,gBAAMA,CAAN;AAbO,eAAA9jI,OAAkB+oC;AAepB+6F,gBAIL,KAAK9rG,MAAU3gC,gDAAqBysI,CAAzB,GACX,KAAKx9H,OAAgB1V,6DAAKkzI,GAAa,EAACtjH,gBAAgB,KAAjB,CAA3B;QAR4B;QAiBjC61B,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKre;AACR,kBAAU13B,MACR,0FADI;AAKR,cAAI,CAAC,KAAKgG;AACR,kBAAUhG,MACR,yFADI;AAKRgG,YAAA,MAAkB3Y,qCAAU,KAAKqqC,GAAnB;AACd1xB,YAAA,OAAe,KAAKA;AACpB,iBAAOA;QAhBM;QA4BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAImiI,mEAHE;AAKjBptF,YAASjf,MAAe1iB,EAAAA,2CAAUhP,EAAA,GAAnB;AACf2wC,YAAS3wC,OAAOA,EAAA;AAChB,iBAAO2wC;QATI;QAiBJV,IAAI9yC,GAAgB;AAC3BogI,wEAAYE;YAA0B;YAAMtgI;UAA5C;QAD2B;MA9EzB;AAwFGhb,+CACE2X,qCAAKsG,OACHqiC,oDACXs7F,iEAHF;AAjHA,UAAA/uF,qDAAA,CAAA;AAyBa+uF,yDAAAA,gBAAAA;ACAP,UAAOC,oEAAP,cAA6BT,8DAA7B;QAaJ/8G,YAAYg9G,GAA8B;AACxC,gBAAMA,CAAN;AAbO,eAAA9jI,OAAkBg2C;AAepB8tF,gBAIL,KAAK9rG,MAAU3gC,gDAAqBysI,CAAzB,GACX,KAAKx9H,OAAgB1V,6DAAKkzI,GAAa,EAACtjH,gBAAgB,KAAjB,CAA3B;QAR4B;QAgBjC+1B,IAAI9yC,GAAgB;AAC3BogI,wEAAYE,0BAA0B,MAAM,CAACtgI,CAA7C;QAD2B;QASpB4yC,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKre;AACR,kBAAU13B,MACR,0FADI;AAKR,cAAI,CAAC,KAAKgG;AACR,kBAAUhG,MACR,yFADI;AAKRgG,YAAA,MAAkB3Y,qCAAU,KAAKqqC,GAAnB;AACd1xB,YAAA,OAAe,KAAKA;AACpB,iBAAOA;QAhBM;QA4BRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIoiI,mEAHE;AAKjBrtF,YAASjf,MAAe1iB,EAAAA,2CAAUhP,EAAA,GAAnB;YACNA,OAAOA,EAAA;AAChB,iBAAO2wC;QATI;MArET;AAuFGxuD,+CACE2X,qCAAKsG,OACHsvC,oDACXsuF,iEAHF;AAhHA,UAAAhvF,qDAAA,CAAA;AAyBagvF,yDAAAA,gBAAAA;ACDP,UAAOC,gEAAP,cAA2BV,8DAA3B;QA4BJ/8G,YAAYg9G,GAA8B;AACxC,gBAAMA,CAAN;AA5BO,eAAA9jI,OAAkBgpC;AA8BpB86F,gBAIL,KAAKU,WAAWV,GAChB,KAAKn6E,iBAAiBm6E,EAAYnkH,uBAAZ;QARkB;QAe1CklC,YAAS;AACP,cAAI,KAAK4/E;AACP,kBAAMnkI,MACJ,wEADI;AAKR,cAAI,CAAC,KAAKkkI;AACR,kBAAUlkI,MACR,yGADI;AAKR,eAAKmkI,iBAAiB,KAAKD,SAAS7kH,uBAAd;QAbf;QAqBTilC,UAAUjgD,GAAgB;AACxB,eAAKA,SAASA;QADU;QAU1B+/H,iBAAiBrxH,GAAc;AAC7B,eAAKs2C,iBAAiBt2C;QADO;QAUtBgjC,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAAI,CAAC,KAAKsT;AACR,kBAAUrpD,MACR,mGADI;AAKR,cAAI,CAAC,KAAKmkI;AACR,kBAAUnkI,MACR,gFADI;AAKRgG,YAAA,gBACE,GAAG4M,KAAKuQ,MAAM,KAAKkmC,eAAez9C,CAA/B,CAAH,KACGgH,KAAKuQ,MAAM,KAAKkmC,eAAev9C,CAA/B,CAAH;YACF,gBACE8G,KAAKuQ,MAAM,KAAKghH,eAAev4H,CAA/B,IACA,MACAgH,KAAKuQ,MAAM,KAAKghH,eAAer4H,CAA/B;AACF,iBAAO9F;QArBM;QAiCRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIqiI,+DAHE;AAKblxH,cAAK/M,EAAA,cAAsBgI,MAAM,GAA5B;AACT2oC,YAAS0S,iBAAiB,IAAIn4C,mDAAWkC,OAAOL,EAAG,CAAH,CAAP,GAAeK,OAAOL,EAAG,CAAH,CAAP,CAA9B;AAC1BA,cAAK/M,EAAA,cAAsBgI,MAAM,GAA5B;AACL2oC,YAASwtF,iBAAiB,IAAIjzH,mDAAWkC,OAAOL,EAAG,CAAH,CAAP,GAAeK,OAAOL,EAAG,CAAH,CAAP,CAA9B;AAC1B,iBAAO4jC;QAXI;QAmBJnzC,SAAM;AACb,iBAAO0N,mDAAW2xB;YAAO,KAAKwmB;YAAgB,KAAK86E;UAA5C;QADM;QASNluF,IAAI9yC,GAAgB;AAC3B,cAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKvN;AACR,kBAAU5oC,MACR,yFADI;AASR,cAHMigB,IAAUha,EAAU0iC,eACxB,KAAKC,SADS,GAGhB;AAKM39B,gBAAS9H,IAAU,KAAKghI,iBAAiB,KAAK96E;AACpD,gBAAI,CAACp+C;AACH,oBAAUjL,MACR,qIADI;AAMRigB,cAAQ3lB,OAAO2Q,CAAf;UAbA;AACEtK,oBAAQxG,KAAK,sCAAsC,KAAKyuC,SAAxD;QAbyB;MApJzB;+CAsLqB9oC,qCAAKsG,OAAkBsiC,kDAAcu7F,6DAAhE;AA9MA,UAAAjvF,mDAAA,CAAA;AAwBaivF,uDAAAA,cAAAA;ACZP,UAAOI,wEAAP,cAA+Bd,8DAA/B;QAGJ/8G,YACEvG,GACOokC,GAAsB;AAE7B,gBAAMpkC,CAAN;AAFO,eAAAokC,eAAAA;AAJA,eAAA3kD,OAAkBk2C;QAII;QActBG,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb,cAA0BhzC,WAAtB,KAAKshD;AACP,kBAAUrkD,MACR,2EADI;AAKRgG,YAAA,eAAuB,KAAKq+C;AAC5B,iBAAOr+C;QATM;QAqBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAIyiI,uEAHE;AAKjB1tF,YAAS0N,eAAer+C,EAAKq+C;AAC7B,iBAAO1N;QARI;QAgBJV,IAAI9yC,GAAgB;AAC3B,cAAM8C,IAAY,KAAKkwC,mBAAL;AAClB,cAAI,CAAC,KAAKvN;AACR,kBAAU5oC,MACR,yFADI;AASR,WAHMigB,IAAUha,EAAU0iC,eACxB,KAAKC,SADS,KAUhB3oB,EAAQoB,aAAale,IAAU,CAAC,CAAC,KAAKkhD,eAAe,CAAC,KAAKA,YAA3D,IANE1jD,QAAQxG,KACN,wDAAwD,KAAKyuC,SAD/D;QAbyB;MA3DzB;+CAuFK9oC,qCAAKsG,OACHwvC,sDACXyuF,qEAHF;AAlGA,UAAArvF,uDAAA,CAAA;AAYaqvF,2DAAAA,kBAAAA;ACUP,UAAOC,6EAAP,cAAiCluF,oDAAjC;QAiBJ5vB,YACE+9G,GACAC,GACAluF,GAAwB;AAExB,gBAAMA,CAAN;AAfO,eAAA52C,OAAkB81C;AAgBzB,eAAKivF,UAAUF,QAAAA,IAAAA,IAAexhI;AAC9B,eAAK2hI,UAAUF,QAAAA,IAAAA,IAAezhI;QAJN;QAYjBgzC,SAAM;AACb,gBAAM/vC,IAAO,MAAM+vC,OAAN;AACb/vC,YAAA,UAAkB,KAAKy+H;AACvBz+H,YAAA,UAAkB,KAAK0+H;AACvB,iBAAO1+H;QAJM;QAgBRzc,OAAAA,SACLyc,GACAC,GACArE,GAAW;AAEL+0C,cAAW,MAAMptD,SACrByc,GACAC,GACArE,QAAAA,IAAAA,IAAS,IAAI0iI,4EAHE;YAKRG,UAAUz+H,EAAA;AACnB2wC,YAAS+tF,UAAU1+H,EAAA;AACnB,iBAAO2wC;QATI;MAnDT;AAqEGxuD,+CACE2X,qCAAKsG,OACHovC,yDACX8uF,0EAHF;AA3FA,UAAAtvF,0DAAA,CAAA;AAsBasvF,8DAAAA,oBAAAA;ACAP,UAAOK,iEAAP,cAA+BtuF,uDAA/B;QASJ7vB,YAAYo+G,GAAyB;AACnC,gBAAA;AATO,eAAA5uF,UAAU;AACV,eAAAr0C,aAAa;AACb,eAAAjC,OAAkB24B;AAQzB,eAAK2d,UAAU,CAAC,CAAC4uF;AAEZA,gBAEL,KAAKtiI,cAAcsiI,EAAc7+H;QANE;MATjC;AAmBG5d,+CACE2X,qCAAKsG,OACHiyB,sDACXssG,8DAHF;UAzCA3vF,gDAAA,CAAA;AAsBa2vF,oDAAAA,kBAAAA;ACmFN,UAAMngG,oDAA0BA,EAAAA,4CAC1B9f,oDAA0BA,EAAAA,4CAC1B6f,oDAA0BA,EAAAA,4CAC1B8Q,kDAAwBA,gDACxB9M,kDAAwBA,EAAAA,0CACxB9D,uEACAA,qEACAt/B,mDAAyBA,iDAEzBgjC,mDAAyBA,iDACzBzjC,8CAAoBA,EAAAA,4CACpBQ,6CAAmBA,2CACnBywC,sDAA4BA,oDAC5BlN,sDAA4BA,oDAC5BiN,sDAA4BA,oDAC5BhN,oDAA0BA,kDAC1BriC,8CAAoBA,EAAAA,4CACpB4jC,8CAAoBA,EAAAA,4CACpB5R,wDAA8BA,sDAC9Bid,mDAAyBA,iDACzBtxC,4CAAkBA,EAAAA,0CAClByD,gDAAsBA,8CACtBguC,oDAA0BA,kDAC1BD,2DAAiCA,yDACjCD,qDAA2BA,mDAC3B7xC,0CAAgBA,wCAChByhB,kDAAwBA,gDACxBgwB,kDAAwBA,gDACxBC,kDAAwBA,gDACxBxwC,uDAA6BA,qDAG7Bzb,wDAA8BA,sDAC9Bkc,+CAAqBA,EAAAA,6CACrBE,8CAAoBA,EAAAA,4CACpBrc,8CAAoBA,4CACpBH,4CAAkBA,0CAClBQ,gDAAsBA,8CACtBD,wDAA8BA,sDAC9BE,2CAAiBA,yCACjBgc,gDAAsBA,EAAAA,8CACtB1c,qDAA2BA,mDAC3BM,iDAAuBA,+CACvBqc,gDAAsBA,EAAAA,8CACtBhE,qDAA2BA,EAAAA,mDAC3BhY,sDAA4BA,oDAtJzCurD,sCAAA,CAAA;AAgDQc,0CAAAA,WAAAA;0CAyDKtR,eAAAA,EAAAA;AACA9f,0CAAAA,eAAAA,EAAAA;AACA6f,0CAAAA,eAAAA,EAAAA;AACA8Q,0CAAAA,aAAAA;AAEA5Q,0CAAAA,kCAAAA;0CADA8D,aAAAA,EAAAA;AAGApjC,0CAAAA,cAAAA;AAEAgjC,0CAAAA,cAAAA;AA7DLgmB,0CAAAA,YAAAA;AAEAC,0CAAAA,cAAAA;0CAEAyK,cAAAA;AAEA26B,0CAAAA,cAAAA;AAEAkvC,0CAAAA,YAAAA;AAEAG,0CAAAA,+BAAAA;0CAEAC,YAAAA;AAfAM,0CAAAA,aAAAA;AAEAE,0CAAAA,aAAAA;AA+DK5+H,0CAAAA,SAAAA,EAAAA;AACAQ,0CAAAA,QAAAA;0CACAywC,iBAAAA;AACAlN,0CAAAA,iBAAAA;AACAiN,0CAAAA,iBAAAA;AACAhN,0CAAAA,eAAAA;AACAriC,0CAAAA,SAAAA,EAAAA;0CAtDLkwC,QAAAA;AAEAK,0CAAAA,cAAAA;AACA2sF,0CAAAA,cAAAA;AAEAG,0CAAAA,gBAAAA;AAOAW,0CAAAA,kBAAAA;0CALAN,gBAAAA;AAEAC,0CAAAA,gBAAAA;AACAC,0CAAAA,cAAAA;AA6CKh6F,0CAAAA,SAAAA,EAAAA;AACA5R,0CAAAA,mBAAAA;0CA1CLssG,kBAAAA;AA2CKrvF,0CAAAA,cAAAA;AACAtxC,0CAAAA,OAAAA,EAAAA;AA3CL2+F,0CAAAA,aAAAA;AA4CKl7F,0CAAAA,WAAAA;0CA1CLm0G,WAAAA;AA2CKnmE,0CAAAA,eAAAA;AACAD,0CAAAA,sBAAAA;AACAD,0CAAAA,gBAAAA;AA3CLyjB,0CAAAA,cAAAA;0CAEAsrE,oBAAAA;AAEA5oB,0CAAAA,eAAAA;AAwCKh4G,0CAAAA,KAAAA;AAtCL0yC,0CAAAA,SAAAA;AAuCKjxB,0CAAAA,aAAAA;0CACAgwB,aAAAA;AACAC,0CAAAA,aAAAA;AACAxwC,0CAAAA,kBAAAA;AAzCLk+C,0CAAAA,UAAAA;AAEAG,0CAAAA,YAAAA;0CAEAsrD,YAAAA;AAEAC,0CAAAA,YAAAA;AAEAr1C,0CAAAA,iBAAAA;AAoCKhwE,0CAAAA,mBAAAA;AACAkc,0CAAAA,UAAAA,EAAAA;0CAYA5b,iBAAAA;AAXA8b,0CAAAA,SAAAA,EAAAA;AACArc,0CAAAA,SAAAA;AACAH,0CAAAA,OAAAA;AACAQ,0CAAAA,WAAAA;AAEAC,0CAAAA,MAAAA;0CADAF,mBAAAA;AAEAkc,0CAAAA,WAAAA,EAAAA;AACA1c,0CAAAA,gBAAAA;AACAM,0CAAAA,YAAAA;AACAqc,0CAAAA,WAAAA,EAAAA;0CACAhE,gBAAAA,EAAAA;ACrJb,UAAAuzC,8CAAA,CAAA;AAsBEksC,kDAAAA,YAAAA;AACA0D,kDAAAA,mBAAAA;AACAyG,kDAAAA,SAAAA;AACA8X,kDAAAA,YAAAA;kDACA8C,aAAAA;AAEA7V,kDAAAA,aAAAA;AADAyb,kDAAAA,WAAAA;AAEAgnB,kDAAAA,uBAAAA;kDACAt/E,iBAAAA;AACA6wC,kDAAAA,SAAAA;AjM4pBFhlF,sEAAA;AA3rBA,UAAA41C,0CAAA,CAAA;AA8EgBj3C,8CAAAA,kBAAAA;AAuDAE,8CAAAA,mBAAAA;AAsSAU,8CAAAA,8BAAAA;8CA5EAF,kBAAAA;AAmQAO,8CAAAA,wBAAAA;AAvCAF,8CAAAA,wBAAAA;AAmBAC,8CAAAA,2BAAAA;8CA4FAI,yBAAAA;AAYAC,8CAAAA,yBAAAA;AA1LAnC,8CAAAA,iBAAAA;AAxPAqB,8CAAAA,oBAAAA;8CAsMAM,kBAAAA;AA1IAJ,8CAAAA,oBAAAA;AAzJAN,8CAAAA,iBAAAA;AAyXAW,8CAAAA,eAAAA;8CAzJAH,iBAAAA;AAjVApB,8CAAAA,eAAAA;AAxBAD,8CAAAA,eAAAA;AkM9BhB,UAAA23C,iCAAA,CAAA;AAMQ0P,qCAAAA,cAAAA;AAEApsB,qCAAAA,2BAAAA;AADAC,qCAAAA,mBAAAA;ACPR,UAAAyc,gCAAA,CAAA;AAWQ62B,oCAAAA,SAAAA;AAAqCyE,oCAAAA,sBAAAA;AAA7BiK,oCAAAA,aAAAA;AAAYS,oCAAAA,kBAAAA;ACX5B,UAAAhmC,wCAAA,CAAA;AnMAA,UAAAA,4CAAA,CAAA;AAoBgB31C,gDAAAA,WAAAA;ACpBhB,UAAA21C,sDAAA,CAAA;AAmBgB11C,0DAAAA,oBAAAA;ACnBhB,UAAA01C,gDAAA,CAAA;AA0BgBz1C,oDAAAA,eAAAA;AkMbV,UAAOqlF,oEAAP,cAAgC+nC,mEAAhC;QAcJnmG,cAAA;AACE,gBAAA;AAdO,eAAAssC,6BAA6B;AAItC,eAAA+xE,mBAAmB;AAMnB,eAAAC,mBAAmB;AACV,eAAA7hD,0BAA0B,CAAC,KAAKmC,eAAe;QAExD;QAIS+F,QAAQN,GAAgB;AAC/B,iBAAO,MAAMM,QAAQN,CAAd,EAAwBtmF,OAAO;YAIpC,GAAGsmF,CAAH;YACA,GAAGA,CAAH;YACA,iBAAiB,KAAK7D,wBAAtB;YACA;YACA;UARoC,CAA/B;QADwB;MAlB7B,GAbNhyC,kDAAA,CAAA;AAaa4vC,sDAAAA,mBAAAA;AC0BP,UAAOmgD,iEAAP,MAAA;QAmBJv+G,YAAY8kE,GAAgB;AAhB5B,eAAA05C,eADA,KAAAC,SAAS;AAkBP,eAAKv5C,QAAQJ;AAEb,eAAK45C,OAAO,KAAKx5C,MAAM/zE;AAEjBwvB,cAAWmkD,EAAK1hE,YAAL;AAGjB,eAAKonC,aAAa7pB,EAASqrB,aAAT;AAElB,eAAK2yE,sBAAsBh+F,EAASi+F,sBAAT;AAE3B,eAAKC,kBAAkB,KAAKF,oBAAoBG;AAEhD,eAAKC,sBAAsB,KAAKJ,oBAAoBK;AACpD,eAAKC,qBAAqB,KAAKN,oBAAoBO;AACnD,eAAKC,kBAAkB,KAAKR,oBAAoBj9C;AAChD,eAAK09C,cAAc,KAAKT,oBAAoBh+C;AAC5C,eAAK0+C,cAAc,KAAKV,oBAAoBziD;AAC5C,eAAKojD,oBAAoB,KAAKX,oBAAoB5hD;QAnBxB;QA2B5BwiD,UAAO;AACL,iBAAO,KAAKd,SAAS,OAAO,KAAKD;QAD5B;QASPgB,cAAc5mD,GAAW;AACvB,eAAK6lD,UAAmB1qI,8CAAO6kF,EAAIS,MAAM,KAAK6L,MAAMoB,MAArC;AACf,mBAASzqF,IAAI,GAAGmH,GAAOA,IAAO41E,EAAIa,SAAS59E,CAAb,GAAkBA;AAC1Cq9E,qEAAMX,mBAAmBv1E,CAAzB,IACF,KAAKy7H,UAAU,KAAKE,oBAAoBx9C,cAC/BjI,yDAAMb,oBAAoBr1E,CAA1B,IACT,KAAKy7H,UAAU,KAAKM,oBAAoB/6C,QAAQ,KAAK06C,IAAtC,IACNxlD,yDAAMhB,qBAAqBl1E,CAA3B,IACT,KAAKy7H,UAAU,KAAKW,YAAYngG,WACvBi6C,yDAAMvB,MAAM30E,CAAZ,IACT,KAAKy7H,UAAU,KAAKY,YAAYr8C,KAAK,KAAK07C,IAA3B,IACNxlD,yDAAMtB,SAAS50E,CAAf,KAAuC,MAAfA,EAAKlB,UAKtC,KAAK28H,UAAmBvqI,kDACtB,KACA8O,EAAKq2E,OAAOr2E,EAAKlB,QAAQ,KAAK+8H,eAFjB;AAQnB,eAAKJ,UAAmBvqI;YAAW;YADrB0kF,EAAIS,OAAOT,EAAI92E,QAAQ,KAAK+8H;UAC3B;QAxBQ;QAgCzB/4C,gBAAgBlN,GAAQ;AAClB,eAAKsM,MAAM/zE,QAGb,KAAKstH,UACH,KAAKa,kBAAkBrgG,WAAoB/qC,kDAAW,KAFtD0kF,EAAI52E,SAAS,KAAKs9H,kBAAkBt9H,SAAS,KAAK68H,eAEhB;QALhB;QAcxBY,eAAe7mD,GAAQ;AACrB,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAI,KAAKskD,MAAM;AACb,kBAAMgB,IAAiB9mD,EAAI52E,SAASob,EAAM0+D;AAE1C,iBAAK2iD,UACM3qI,8CACPspB,EAAMi8D,OAAOj8D,EAAMtb,QAAQ,KAAK+8H,iBAChCjmD,EAAIplB,IAFN,IAIA,KAAK2rE,gBAAgBpgG,SAAS,KAAK2/F,IAAnC,IACSxqI;cAAW;cAAKwrI;YAAzB;UATW;AAWb,iBAAKjB,UACM3qI,8CAAOspB,EAAMi8D,OAAOj8D,EAAMtb,OAAO82E,EAAIplB,IAA9C,IACA,KAAK2rE,gBAAgBpgG,SAAS,KAAK2/F,IAAnC;QAfiB;QAwBvBiB,mBAAmB/mD,GAAQ;AACzB,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAKh9D;AACL,gBAAI,KAAKshH,MAAM;AACb,oBAAMl4C,IAAc5N,EAAI52E,SAAS,IAAI,KAAKi9H,mBAAmBj9H;AAC7D,mBAAKy8H,UACM3qI,8CAAOspB,EAAMi8D,MAAMT,EAAIplB,IAAhC,IACA,KAAKyrE,mBAAmBn7C,QAAQ,KAAK46C,IAArC,IACSxqI,kDAAW,KAAKsyF,CAAzB,IACA,KAAKy4C,mBAAmBl7C,WAAW,KAAK26C,IAAxC,IACS1qI,8CACP4kF,EAAI92E,QAAQsb,EAAMi8D,OAAO,KAAK4lD,mBAAmBn9H,OACjD,CAFF;YAPW;AAYb,mBAAK28H,UACM3qI,8CAAOspB,EAAMi8D,MAAMT,EAAIplB,OAAOolB,EAAI52E,MAA3C,IACA,KAAKi9H,mBAAmBl7C,WAAW,KAAK26C,IAAxC,IACS1qI,8CACP4kF,EAAI92E,QAAQsb,EAAMi8D,OAAO,KAAK4lD,mBAAmBn9H,OACjD,CAFF;QAlBqB;QA8B3B89H,iBAAiBhnD,GAAQ;AACvB,gBAAMinD,IAAYjnD,EAAIS,OAAOT,EAAI92E,QAAQ,KAAK+8H;AAC1CjmD,uBAAe2E,qEAAa3E,EAAI6E,qBAClC,KAAKghD,UAAmBvqI,kDAAW,KAAK2rI,CAAzB;eAERnB,SACP,KAAKD,UAAmBvqI,kDAAW,KAAK2rI,CAAzB,GACXjnD,EAAI52E,SAAS,KAAK68H,oBACpB,KAAKJ,UAAmBvqI,kDACtB,KACA0kF,EAAIplB,OAAOolB,EAAI52E,SAAS,KAAK68H,eAFhB;QARI;QAqBzBiB,cAAclnD,GAAc;AAG1B,cAAI,KAAK8lD;AACP,iBAAKD,UAAmBvqI,kDACtB,KACA0kF,EAAIhvE,WAAW,KAAKi1H,eAFP;eAIV;AACL,kBAAMkB,IAAa,KAAK76C,MAAMwB,UAAUjN,SAAS,CAA9B;AACfP,qEAAMX,mBAAmBwnD,CAAzB,IACF,KAAKtB,UAAmB3qI,8CACtB8kF,EAAIS,OAAO,KAAKwlD,iBAChBjmD,EAAIhvE,WAAW,KAAKi1H,eAFP,IAIN3lD,yDAAMb,oBAAoB0nD,CAA1B,MACT,KAAKtB,UAAmB3qI,8CAAO8kF,EAAIS,MAAMT,EAAIhvE,QAA9B,GACf,KAAK60H,UAAU,KAAKM,oBAAoB76C,WAAzB;UATZ;QARmB;QAyB5B87C,WAAQ;AACN,cAAMz/H,IAAmB,KAAK2kF,MAAM3kF;AAChCA,gBACIymF,IACJzmF,EAAiB86E,oBAAoB96E,EAAiByB,QAEpD,KAAK08H,OACP,KAAKD,UAAmB3qI,8CAAO,KAAKoxF,MAAMhI,QAAQ8J,CAAnC,KAIf,KAAKy3C,UAAmB3qI,8CAFX,KAAKoxF,MAAMhI,SAAS,KAAK2hD,iBACvB,KAAK35C,MAAMwB,UAAU98E,WAAW,KAAKi1H,eACrC,GACf,KAAKJ,UAAmBvqI,kDAAW,KAAK8yF,CAAzB,IAEjB,KAAKy3C,UAAU,KAAKU,gBAAgBngG,OAAO,KAAK0/F,IAAjC;AAGZ,eAAKA,SACFt4C,IAAS,KAAKlB,MAAMkB,QACtBlN,yDAAMb,oBAAoB+N,EAAO3M,SAAS,CAAhB,CAA1B,IACF,KAAKglD,UAAmBvqI,kDACtB,KACA,KAAK6qI,oBAAoB/8H,MAFZ,IAKf,KAAKy8H,UAAmBvqI,kDACtB,KACAkyF,EAAOvI,UAAU,KAAKghD,eAFT;QAzBb;QAsCRoB,gBAAgB7iH,GAAkB;AAChC,gBAAM3R,IAAS,KAAKozH,iBAGdqB,IAAkB9iH,EAAMi8D,OAAOj8D,EAAM2+D;AAC3C,cAAMvoB,IAAOp2C,EAAMg8D,aAAah8D,EAAMpb,SAAS;AAC/C,gBAAMm+H,IAAuB/iH,EAAMtb,QAAQsb,EAAM2+D,iBAC3CuK,IAAS9yB,IAAO/nD;AAElB,eAAKizH,QACD0B,IAAiBhjH,EAAMi+D,oBAAoB5vE,GAC3Ci0H,IACJtiH,EAAMpb,UACLob,EAAMi+D,oBAAoBj+D,EAAM0+D,oBACjCrwE,GAIF,KAAK+yH,gBACM1qI,8CAHIosI,IAAkBz0H,GAGP66E,CAAxB,IACSpyF,kDAAW,KAAKksI,CAAzB,IACA,KAAKjB,gBAAgBpgG,SAAS,KAAK2/F,IAAnC,IACSxqI,kDAAW,KAAKwrI,CAAzB,IACSxrI,kDAAW,KAAKisI,CAAzB,KAEF,KAAK3B,gBACM1qI,8CAAOspB,EAAMi8D,OAAOj8D,EAAMtb,QAAQ2J,GAAQ66E,CAAnD,IACSpyF,kDAAW,KAAKkpB,EAAMpb,MAA/B,IACS9N,kDAAW,KAAK,CAACisI,CAA1B,IACSrsI,8CAAOosI,GAAiB1sE,IAAOp2C,EAAMi+D,iBAA9C,IAEA,KAAK8jD,gBAAgBpgG,SAAS,KAAK2/F,IAAnC;QA/B4B;MA/O9B,GAvCNlwF,oDAAA,CAAA;AAuCa+vF,wDAAAA,cAAAA;AChBP,UAAO15C,uDAAP,cAAsB8jC,sDAAtB;QAUJ3oG,YAAY1xB,GAAiBw2F,GAAgB;AAC3C,gBAAMx2F,GAAOw2F,CAAb;AAEA,eAAKu7C,eAAe,IAAI9B,+DAAYz5C,CAAhB;QAHuB;QAMpC56B,OAAI;AACX,eAAKk7B,aAAL;AACA,eAAKC,eAAL;AACA,eAAKC,2BAAL;AAEA,gBAAMC,IAAa,KAAKN,OAAOM;AAC/BA,YAAWC,QAAQ,KAAKR,eAAe,OAAO,KAAKD,WAAnD;AACAQ,YAAW+6C,iBAAiB,KAAKD,aAAad,QAAlB,CAA5B;AACI,eAAKr6C,MAAM/zE,OACbo0E,EAAWE,QAAX;AAEF,eAAKC,mBAAL;QAXW;QAcJE,WAAQ;AACf,eAAKy6C,aAAab,cAAc,KAAKt6C,MAAMkB,MAA3C;eACKi6C,aAAaT,iBAAiB,KAAK16C,MAAMkB,MAA9C;AAEA,gBAAMR,SAAN;QAJe;QAORE,gBAAgBlN,GAAQ;AAC/B,eAAKynD,aAAav6C,gBAAgBlN,CAAlC;AAEA,gBAAMkN,gBAAgBlN,CAAtB;QAH+B;QAMxBoN,gBAAgBpN,GAAQ;AAC/B,eAAKynD,aAAaZ,eAAe7mD,CAAjC;AAEA,gBAAMoN,gBAAgBpN,CAAtB;QAH+B;QAMxBmN,oBAAoBnN,GAAQ;AACnC,eAAKynD,aAAaV,mBAAmB/mD,CAArC;AAEA,gBAAMmN,oBAAoBnN,CAA1B;QAHmC;QAM5BqN,kBAAkBrN,GAAQ;AACjC,eAAKynD,aAAaT,iBAAiBhnD,CAAnC;AAEA,eAAKoM,gBACM9wF,kDAAW,KAAK0kF,EAAIS,OAAOT,EAAI92E,KAAxC,IACS5N;YAAW;YAAK0kF,EAAIplB,OAAOolB,EAAI52E;UAAxC;QAL+B;QAQ1BkkF,cAAW;AAClB,eAAKm6C,aAAaP,cAAc,KAAK56C,MAAMwB,SAA3C;AAEA,gBAAMR,YAAN;QAHkB;QAUDC,YAAS;AAC1B,eAAKk6C,aAAaL,SAAlB;AAEA,gBAAM75C,UAAN;QAH0B;QAMnBc,iBAAiB7pE,GAAkB;AAC1C,eAAKijH,aAAaJ,gBAAgB7iH,CAAlC;AAEA,gBAAM6pE,iBAAiB7pE,CAAvB;QAH0C;QAMnCkqE,+BAA+BlqE,GAAkB;AACxD,gBAAMo2C,IAAOp2C,EAAMg8D,aAAah8D,EAAMpb,SAAS;AAE/C,cAAIob,EAAM69D,iBAAiB;AAEzB,gBAAIsM,IACFnqE,EAAMi8D,OAAOj8D,EAAM2+D,kBAAkB,KAAKvxB,WAAW6zE;AACnD,iBAAKn5C,MAAM/zE,QACbo2E,KAAS;AAEXnqE,cAAM69D,gBAAgB76C,iBACpBmnD,GACA/zB,IAAOp2C,EAAMi+D,oBAAoB,KAAK7wB,WAAW6zE,gBAFnD;UAPyB;QAH6B;QAiBjD53C,kCAAkC7N,GAAQ;AACjD,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAWa,QAAP79D,IAAO69D,IAAP79D,EAAO69D,iBAAiB;AAC1B,gBAAIsM,IAAQ3O,EAAIS,OAAOT,EAAImB,gBAAgB38D,EAAMk8D;AAE/CiO,gBADE,KAAKrC,MAAM/zE,MACJ,KAATo2E,IAEAA,IAAS,KAAK/8B,WAAW6zE;AAE3BjhH,cAAM69D,gBAAgB76C,iBACpBmnD,GACA3O,EAAIplB,OAAO,KAAKhJ,WAAW6zE,gBAF7B;UAP0B;QAFqB;QAgB1C93C,iCAAiC3N,GAAQ;AAChD,gBAAMx7D,IAAQw7D,EAAIwB,aAAJ;AACd,cAAIh9D,KAASA,EAAM69D,iBAAiB;AAClC,gBAAIsM,IAAQ3O,EAAIS,OAAOT,EAAI92E,QAAQ,KAAK0oD,WAAW6zE;AAC/C,iBAAKn5C,MAAM/zE,QACbo2E,KAAS;AAEXnqE,cAAM69D,gBAAgB76C,iBAAiBmnD,GAAO3O,EAAIplB,IAAlD;UALkC;QAFY;QAWzCozB,0BAAuB;AAC9B,gBAAMF,IAAY,KAAKxB,MAAMwB;AAE7B,cAAIA,EAAUnpE,YAAY;AACxB,kBAAMiqE,IAAWd,EAAUnpE,YACrBnY,IAAIoiF,EAASnO;AAGnBmO,cAASvM,gBAAgB76C,kBADtB,KAAK8kD,MAAM/zE,MAAM,CAAC/L,IAAIA,KAAK,KAAKolD,WAAW6zE,mBAAmB,GAG/D33C,EAAU98E,WAAW,KAAK4gD,WAAW6zE,gBAFvC;UALwB;QAHI;MAjI5B,GAvBN7vF,+CAAA,CAAA;AAuBaq2C,mDAAAA,SAAAA;ACqCP,UAAO07C,uFAAP,MAAA;QAsBJvgH,YAAY+tC,GAA2B;AAlBvC,eAAA+wE,SAAS;AAoBP,eAAK0B,mBAAmBzyE;AAKxB,eAAKozB,cAAuBptF,8CAAO,KAAK+qI,QAAQ,KAAKA,MAAlC;QAPkB;QAavCxpI,OAAI;AAKF,eAAK4pI,gBAAgB,KAAKuB,iBAAL;AAMrB,eAAKzB,iBAAiB,KAAK0B,kBAAL;AAMtB,eAAKh/C,aAAa,KAAKC,cAAL;AAKlB,eAAKhB,QAAQ,KAAKa,UAAL;AAMb,eAAKzE,eAAe,KAAKwE,gBAAL;AAMpB,eAAKrF,YAAY,KAAKuF,aAAL;QAlCf;QAyCMg/C,mBAAgB;AACxB,gBAAMtlG,IAAS,KAAKqlG,iBAAiBljD,eAC/B7xE,IAAS,KAAKqzH,QAMd6B,KAAqB,IAAIv0H,KAAKw0H,YAAYzlG,IAAS1vB,KAAUA,GAE7Do1H,IACK9sI,8CAAO4sI,GAAmBA,CAAnC,IACSxsI,2CACP,KACA,SACAgnC,GACSvnC,6CAAM,CAAC+sI,IAAoBl1H,GAAQ0vB,IAASwlG,CAArD,CAJF,GAOIG,IAAyB3sI,2CAC7B,KACA,SACAgnC,IAAS1vB,GACA7X,6CAAMunC,IAAS1vB,GAAQ0vB,IAAS1vB,CAAzC,CAJoB,GAOhBs1H,IACKhtI,8CAAO4sI,GAAmB,CAACA,CAApC,IACSxsI,2CACP,KACA,SACAgnC,IAAS1vB,GACA7X,6CAAMunC,IAASwlG,GAAmBA,IAAoBl1H,CAA/D,CAJF;AAOF,iBAAO,EACL3J,OAAOq5B,IAAS1vB,GAChBzJ,QAAQm5B,GACR2oD,QAAQ/gE,GAAG;AACT,mBAAOA,IAAM89G,IAAa;UADjB,GAGX98C,WAAWhhE,GAAG;AACZ,mBAAOA,IAAM+9G,IAAgBC;UADjB,EANT;QAnCiB;QAmDhBL,oBAAiB;AACzB,gBAAMvlG,IAAS,KAAKqlG,iBAAiBljD,eAC/B7xE,IAAS,KAAKqzH,QAMdkC,KAAoB,IAAI50H,KAAKw0H,YAAYzlG,IAAS1vB,KAAUA,GAI5Dw1H,IACKltI,8CAHWitI,GACAA,CAEpB,IACS7sI,2CACP,KACA,SACAgnC,IAAS1vB,GACA7X,6CAAMunC,IARG6lG,GAQqB,CAPrBA,IAOsCv1H,CAAxD,CAJF,GASIy1H,IACKntI,8CAAO0X,GAAQ0vB,CAAxB,IACShnC,2CACP,KACA,SACAgnC,IAAS1vB,GACA7X,6CAAMunC,GAAQ,CAACA,IAAS1vB,CAAjC,CAJF,GAQI01H,IAAmB,CAACH,GACpBI,IACKrtI,8CAHcitI,GAGWG,CAAlC,IACShtI,2CACP,KACA,SACAgnC,IAAS1vB,GACA7X,6CAAM,CARMotI,IAQcv1H,GAAQ,CAAC01H,IAAmBhmG,CAA/D,CAJF;AAOF,iBAAO,EACLn5B,QAAQm5B,GACR6oD,QAAQjhE,GAAG;AACT,mBAAOA,IAAMk+G,IAA4BC;UADhC,GAGXh9C,aAAU;AACR,mBAAOk9C;UADC,EALL;QA3CkB;QA0DjBz/C,gBAAa;AACrB,gBAAM7/E,IAAQ,KAAK0+H,iBAAiB9hD,WAC9B18E,IAAS,KAAKw+H,iBAAiBhiD,YAM/B6iD,IACKttI,8CAAO,IAAI,CAACiO,IAA2B,GAAhD,IACShO,8CAAe,QAAR8N,GAAe,IAA/B,GAEIw/H,IACKptI;YAAW;YAPEqtI;UAOtB,IACSxtI,8CAAgB,OAAT,CAAC+N,GAAc,GAA/B,IACSjO,6CAAM,KAAK,CACTD,6CAAe,OAAT,CAACkO,GAAc,EAA9B,GACSlO,6CAAc,MAARkO,GAAa,GAA5B,CAFkB,CAApB,IAIS/N,8CAAe,OAAR+N,GAAc,IAA9B,IACS5N,kDAAW,KAdEqtI,GActB,GAEIC,IACKttI,kDAAW,KAAK,IAAzB,IACSH,8CAAe,QAAR+N,GAAe,IAA/B,IACSjO;YAAM;YAAK,CACTD,6CAAc,QAARkO,GAAe,IAA9B,GACSlO,6CAAM,GAAG,GAAlB,CAFkB;UAApB,IAISG,8CAAe,OAAR+N,GAAc,CAA9B,GAEI2/H,IACK1tI,8CAAO,IAAIiO,IAAS,GAA7B,IAA6ChO,8CAAe,OAAR8N,GAAc,IAA9B;AAEtC,iBAAO,EACLA,OAAAA,GACAE,QAAAA,GACAg9B,OAAOjc,GAAG;AACR,mBAAOA,IAAMs+G,IAAiBG;UADtB,GAGVziG,SAAShc,GAAG;AACV,mBAAOA,IAAMu+G,IAAmBG;UADtB,EANP;QAlCc;QAkDbjgD,YAAS;AAKjB,iBAAO,EAACviD,UAFG/qC,kDAAW,KAAK,KAAK4qI,MAA9B,IACA,KAAK0B,iBAAiB7/C,MAAM1hD,SACvB;QALU;QAYTsiD,kBAAe;AAKvB,iBAAO,EAACtiD,UAHGjrC;YAAO;YAAK;UAArB,IACSD,8CAAO,OAAO,GAAvB,IACSC,8CAAO,KAAK,GAArB,GACgBgO,QAAQ,IAAIF,OAAO,KAA9B;QALgB;QAYf2/E,eAAY;AACpB,gBAAMigD,IAAY,KAAKlB,iBAAiBtkD,UAAUl6E,QAC5C2/H,IACK5tI,8CAAO,IAAI,IAApB,IACSF,6CAAM,KAAK,CACTD,6CAAM,MAAM,IAArB,GACSA,6CAAM,MAAM,IAArB,GACSA,6CAAM,IAAI,GAAnB,CAHkB,CAApB,GAMIguI,IACK/tI;YAAM;YAAK,CACTD,6CAAM,MAAM,IAArB,GACSA,6CAAM,MAAM,KAArB,GACSA,6CAAM,IAAI,IAAnB,CAHkB;UAApB,IAIcE,8CAAO,OAAO4tI,IAAY,GAAnC;AACP,iBAAO,EACL1+C,KAAKjgE,GAAG;AACN,mBAAOA,IAAM4+G,IAAUC;UADjB,EADH;QAhBa;MAnQlB,GA5DNpzF,4DAAA,CAAA;AA4Da+xF,gEAAAA,4BAAAA;AC1CP,UAAOjkD,8EAAP,cAA2BulD,sEAA3B;QAOJ7hH,YAAY+tC,GAAiC3wC,GAAY;AACvD,gBAAM2wC,GAAW3wC,CAAjB;AACA,eAAKotC,aAAauD;AAEd,eAAKwtB,mBAGP,KAAKz5E,SAAS,KAAK0oD,WAAW6zE,kBAC9B,KAAKr8H,UAAU,KAAKwoD,WAAW6zE;QARsB;MAPrD,GAlBN7vF,iEAAA,CAAA;AAkBa8tC,qEAAAA,cAAAA;ACAP,UAAOvvC,oFAAP,cAA8Bq/E,4EAA9B;QAOJpsG,YAAY+tC,GAAiC3wC,GAAY;AACvD,gBAAM2wC,GAAW3wC,CAAjB;AACA,eAAKotC,aAAauD;AAEd,eAAKwtB,mBAGP,KAAKv5E,UAAU,KAAKwoD,WAAW6zE;QAPsB;MAPrD,GAlBN7vF,oEAAA,CAAA;AAkBazB,wEAAAA,iBAAAA;ACoBP,UAAO68C,yDAAP,cAA0B2iC,wDAA1B;QAUJvsG,YAAY2gB,GAAoBryC,GAAe;AAC7C,gBAAMqyC,GAAUryC,CAAhB;AACA,eAAKw7F,YAAYnpD;QAF4B;QAUtCvd,cAAW;AAClB,iBAAO,KAAK0mE;QADM;QAIXc,qBAAkB;AACzB,gBAAMA,mBAAN;AAGE,eAAK3F,OAAO9nE,UAAU5hB,UACtB,KAAK0pF,OAAO9nE,UAAU,KAAK8nE,OAAO9nE,UAAU5hB,SAAS,CAArD,aACEwxC,iEAMF,KAAK25C,UAAU9M,YACb,KAAKpvB,WAAWoxB,iBAAiB,KAAKpxB,WAAW6zE;QAb5B;QAiBlB1zC,UAAUvtE,GAAcmtE,GAAc;AAE7C,cAAI,KAAKR,YAAY3sE,aAAiBusE,EAAAA;AACpCY,cAAU9Q,SAAS99E,KAAK,IAAI2gF,4EAAY,KAAK9xB,YAAYptC,CAAjC,CAAxB,GACAmtE,EAAUrQ,iBAAiB;mBAClB98D,aAAiB2vB;AAC1Bw9C,cAAU9Q,SAAS99E,KACjB,IAAIsvF,kFAAyB,KAAKzgC,YAAYptC,CAA9C,CADF,GAGAmtE,EAAU1Q,eAAe;mBAChBz8D,aAAiBusE,EAAAA;AAC1BY,cAAU9Q,SAAS99E,KAAK,IAAI+/E;cAAmB,KAAKlxB;cAAYptC;YAAxC,CAAxB,GACAmtE,EAAUzQ,mBAAmB;mBACpB18D,aAAiBqsE,wDAAcrsE,aAAiBssE;AAGzDa,cAAU3Q,YAAYxtE,KAAKE,IACzBi+E,EAAU3Q,WACV,KAAKpvB,WAAWs2B,sBAFI,GAItByJ,EAAUtQ,gBAAgB;AAGvB,eAAK8P,YAAgC,SAApBQ,EAAUpQ,UAC9BoQ,EAAUpQ,QAAQ/8D,EAAM+8D;QAxBmB;QA4BtC8P,kBAAe;AACtB,cAAI63C,IAAoB;AACxB,mBAASjmI,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA;AACrC+8E,cAAIkB,qBACNgoD,IAAoB;AAGxB,mBAASjmI,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA,KAAK;AAC9C,gBAAMuvF,IAAWxS,EAAIa;AACrBb,cAAIa,WAAW,CAAA;AAEXb,cAAI0B,qBAAJ,KAEF1B,EAAIa,SAAS99E,KACX,IAAIygF;cACF,KAAK5xB;cACL,KAAK6gC,iBAAiB,MAAMD,EAAS,CAAT,CAA5B;YAFF,CADF;AAOF,gBAAKA,EAAS7vF,QAAd;AAGA,uBAASG,IAAI,GAAGA,IAAI0vF,EAAS7vF,SAAS,GAAGG,KAAK;AAC5Ck9E,kBAAIa,SAAS99E,KAAKyvF,EAAS1vF,CAAT,CAAlB;AACA,sBAAM6/D,IAAU,KAAK8vB,iBAAiBD,EAAS1vF,CAAT,GAAa0vF,EAAS1vF,IAAI,CAAb,CAAnC;AAChBk9E,kBAAIa,SAAS99E,KAAK,IAAIygF,uEAAY,KAAK5xB,YAAY+Q,CAAjC,CAAlB;cAH4C;AAK9Cqd,gBAAIa,SAAS99E,KAAKyvF,EAASA,EAAS7vF,SAAS,CAA3B,CAAlB;AACIq9E,gBAAI2B,mBAAJ,MACEhf,IAAU,KAAK8vB,iBACjBD,EAASA,EAAS7vF,SAAS,CAA3B,GACA,IAFY,GAIVumI,KAAqBlpD,EAAIqB,kBAC3B1e,KAAW,KAAK/Q,WAAWk0B,YAG7B9F,EAAIa,SAAS99E,KAAK,IAAIygF;gBAAY,KAAK5xB;gBAAY+Q;cAAjC,CAAlB;YAlBF;UAb8C;QAP1B;QA2Cf8vB,iBAAiBC,GAAyBn4D,GAAuB;AACxE,cAAI,CAACm4D;AAEH,mBAAIn4D,KAAQ+lD,yDAAMxB,QAAQvkD,CAAd,KAAwBA,EAAe0Z,aAC1C,KAAK2d,WAAWoxB,iBAGrBzoD,KAAQ+lD,yDAAMlB,cAAc7kD,CAApB,IACH,KAAKq3B,WAAW8zB,uBAErBnrD,KAAQ+lD,yDAAMjB,iBAAiB9kD,CAAvB,IACH,KAAKq3B,WAAWu0B,+BAGlB,KAAKv0B,WAAW+zB;AAIzB,cAAI,CAACrF,yDAAMpB,QAAQwT,CAAd,MAAwB,CAACn4D,KAAQ+lD,yDAAMjB,iBAAiB9kD,CAAvB;AAEpC,mBAAI+lD,yDAAMxB,QAAQ4T,CAAd,KAAwBA,EAAez+C,aAClC,KAAK2d,WAAWoxB,iBAGrB1C,yDAAM/jF,OAAOm2F,CAAb,IACqC,IAAhC,KAAK9gC,WAAW+zB,gBAAoB,IAEzCrF,yDAAMvB,MAAM2T,CAAZ,IACK,KAAK9gC,WAAWmzB,aAIrBzE,yDAAMd,2BAA2BkT,CAAjC,IACK,KAAK9gC,WAAW+zB,gBAGrBrF,yDAAMb,oBAAoBiT,CAA1B,IACK,KAAK9gC,WAAWq0B,kBAGrB3F,yDAAMR,aAAa4S,CAAnB,IACK,KAAK9gC,WAAWmzB,aAGlB,KAAKnzB,WAAW+zB;AAIzB,cAAIrF,yDAAMpB,QAAQwT,CAAd,KAAuB,CAACn4D,GAAM;AAChC,gBAAI+lD,yDAAMnB,gBAAgBuT,CAAtB;AACF,qBAAO,KAAK9gC,WAAWmzB;AAClB,gBAAIzE,yDAAMlB,cAAcsT,CAApB;AACT,qBAAO,KAAK9gC,WAAW+zB;gBACdrF,yDAAMjB,iBAAiBqT,CAAvB;AACT,qBAAO,KAAK9gC,WAAWmzB;UANO;AAWlC,cAAI,CAACzE,yDAAMpB,QAAQwT,CAAd,KAAuBn4D,KAAQ+lD,yDAAMpB,QAAQ3kD,CAAd,GAAqB;AAEvD,gBAAI+lD,yDAAMxB,QAAQ4T,CAAd,KAAwBA,EAAez+C,YAGlC;AAAA,kBAFHqsC,yDAAMlB,cAAc7kD,CAApB,KAEO+lD,yDAAMnB,gBAAgB5kD,CAAtB;AACT,uBAAO,KAAKq3B,WAAW6zB;YADlB,OAGF;AAGE,kBAFHnF,yDAAMlB,cAAc7kD,CAApB,KAEO+lD,yDAAMnB,gBAAgB5kD,CAAtB;AACT,uBAAO,KAAKq3B,WAAW8zB;AAClB,kBAAIpF,yDAAMjB,iBAAiB9kD,CAAvB;AACT,uBAAO,KAAKq3B,WAAW+zB;YANpB;AASP,mBAAO,KAAK/zB,WAAW+zB,gBAAgB;UAjBgB;AAqBzD,cAAIrF,yDAAM/jF,OAAOm2F,CAAb,KAAsBn4D,KAAQ,CAAC+lD,yDAAMpB,QAAQ3kD,CAAd;AACjC,mBAAO,KAAKq3B,WAAW+zB;AAGzB,cAAIrF,yDAAMlB,cAAcsT,CAApB,KAA6Bn4D,KAAQ+lD,yDAAMxB,QAAQvkD,CAAd;AAEvC,mBAAKA,EAAe0Z,aACX,KAAK2d,WAAWoxB,iBAGhB,KAAKpxB,WAAW+zB;AAI3B,cAAIrF,yDAAMX,mBAAmB+S,CAAzB,KAAkCn4D,GAAM;AAE1C,gBAAI+lD,yDAAMvB,MAAMxkD,CAAZ;AACF,qBAAO,KAAKq3B,WAAWmzB;AAGzB,gBAAIzE,yDAAMhB,qBAAqB/kD,CAA3B;AACF,qBAAOA,EAAKmmD;AACP,gBAAIJ,yDAAMf,iBAAiBhlD,CAAvB;AAMT,qBAAOA,EAAKmmD,eADR,KAAKnoE,MAAM,IAAI,MAAM,KAAKq5C,WAAW6zE,mBAAoB;UAbrB;AAmB5C,cAAInlD,yDAAMb,oBAAoBiT,CAA1B,KAAmCn4D,GAAM;AAC3C,gBAAI+lD,yDAAMhB,qBAAqB/kD,CAA3B;AACF,qBAAOA,EAAKmmD,cAAc,KAAK9uB,WAAW8yB;AACrC,gBAAIpE,yDAAMf,iBAAiBhlD,CAAvB;AAMT,qBAAOA,EAAKmmD,cAAc,KAAK9uB,WAAW8yB,iBADtC,KAAKnsE,MAAM,IAAI,MAAM,KAAKq5C,WAAW6zE,mBAAoB;UARpB;AAwB7C,iBATEnlD,yDAAMxB,QAAQ4T,CAAd,KACAn4D,KACA+lD,yDAAMxB,QAAQvkD,CAAd,KACCm4D,EAAez+C,eAAgB1Z,EAAe0Z,cAM7C1Z,KAAQ+lD,yDAAMR,aAAavlD,CAAnB,IACH,KAAKq3B,WAAW+zB,gBAGlB,KAAK/zB,WAAWoxB;QA7IiD;QAgJjE0Q,oBAAoBhB,GAAWn4D,GAAS;AAE/C,iBAAI+lD,yDAAMJ,SAASwS,CAAf,KAAwBpS,yDAAMH,YAAY5lD,CAAlB,IACnB,KAAKq3B,WAAWs0B,4BAGrB5F,yDAAMJ,SAASwS,CAAf,KAAwBpS,yDAAMH,YAAY5lD,CAAlB,IACnB,KAAKq3B,WAAWmzB,aAErB2N,EAAKxR,oBAAoB3mD,EAAK2mD,mBACzB,KAAKtvB,WAAW+zB,gBAErB,CAAC+M,EAAKzR,gBAAgB1mD,EAAK0mD,eACtB,KAAKrvB,WAAWw0B,8BAErBsM,EAAKzR,gBAAgB1mD,EAAK0mD,gBAG1B,CAACyR,EAAKzR,gBAAgB1mD,EAAK8mD,iBAG3BqR,EAAKrR,gBACA,KAAKzvB,WAAW+zB,gBAElB,KAAK/zB,WAAWoxB;QAxBwB;QA2BxC+Q,mBAAmB/T,GAAU51E,GAAgB;AACpD,cAAIk2E,yDAAMtB,SAAS50E,CAAf;AACF,mBAAO41E,EAAIplB,OAAOxwD,EAAKhB,SAAS;AAElC,cAAIk3E,yDAAMH,YAAYH,CAAlB;AAIF,mBAFMhvE,IADYgvE,EAENplB,OAFMolB,EAEW52E,SAFX42E,EAE8BgC,iBAC5C1B,yDAAMf,iBAAiBn1E,CAAvB,IACK4G,IAAW5G,EAAKhB,SAAS,IAE3B4H,IAAW5G,EAAKhB,SAAS;AAElC,cAAIk3E,yDAAMJ,SAASF,CAAf;AAEF,mBAAIM,yDAAMvB,MAAM30E,CAAZ,IADW41E,EAECiF,UAAU76E,EAAKhB,SAAS,IAFzB42E,EAIDiF,UAAU76E,EAAKhB,SAAS;AAGxC,cAAI2H,IAASivE,EAAIplB;AACb0lB,mEAAMxB,QAAQ10E,CAAd,KAAuBk2E,yDAAM/jF,OAAO6N,CAAb,KACzB2G,KAAU3G,EAAKhB,SAAS,IAErB42E,EAAIsB,kBAAkBtB,EAAIiB,iBAC3B72E,EAAKhB,SAAS,KAAKwoD,WAAWo2B,6BAA6BhI,EAAI52E,WAE/D2H,KAAU,KAAK6gD,WAAWo2B,8BAG5Bj3E,IADSuvE,yDAAMlB,cAAch1E,CAApB,IACT2G,IAAU3G,EAAKhB,SAAS,IAExB2H,IAAUivE,EAAI52E,SAAS;AAEzB,iBAAO2H;QAnC6C;QAsC7CygF,oBAAiB;AACxB,cAAK,KAAKL,UAAV;AAMA,gBAAIg4C,IAAgB,GACdC,IAAoB,oBAAI7kF,WAC1BguC,IAAY;AAChB,qBAAStvF,IAAI,KAAKgqF,KAAKtqF,SAAS,GAAGq9E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA;AAC5DmmI,gBAAkBzpH,IAAIqgE,GAAKmpD,CAA3B,GACI7oD,yDAAMD,WAAWL,CAAjB,MACEA,EAAIiB,gBACN,KAAK8R,mBAAmB/S,CAAxB,GAGAuS,KACAA,EAAUtR,gBACVjB,EAAI92E,QAAQqpF,EAAUrpF,QAEtBkgI,EAAkBzpH,IAAIqgE,GAAKuS,EAAUrpF,KAArC,IAEAigI,IADSnpD,EAAIiB,eACGjB,EAAI92E,QAIJsK,KAAKE,IAAIy1H,GAAenpD,EAAI92E,KAA5B,GAElBqpF,IAAYvS;AAKZqpD,gBAAgB;AACpB,qBAASpmI,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA;AACrC+8E,gBAAIiB,eACNooD,IAAgB,KAAKn2C,oBAAoBlT,CAAzB,IACPM,yDAAMtB,SAASgB,CAAf,IAETA,EAAI92E,QAAQsK,KAAKE,IAAI21H,GAAeD,EAAkBh/I,IAAI41F,CAAtB,CAAxB,KAENgT,IAAehT,EAAI92E,OAKnB+pF,IAJez/E,KAAKE,IACxB21H,GACAD,EAAkBh/I,IAAI41F,CAAtB,CAFmBmT,IAIeH,GACjB,IAAfC,KACF,KAAKG,qBAAqBpT,GAAKiT,CAA/B,GAEFo2C,IAAgBrpD,EAAI92E;UAlDxB;AACE,kBAAMsoF,kBAAN;QAFsB;QAwDjB0B,oBAAoBlT,GAAQ;AAEnC,iBAAI,KAAKmR,YAAYnR,EAAIiB,eAErB,KAAKE,gBAAgB,KAAKvvB,WAAW8zE,mBAAmB,KAAKphD,SAG1D,MAAM4O,oBAAoBlT,CAA1B;QAP4B;QAU5ByR,YAAS;AAIhB,cAAIoB,IAA+B,GAC/BqB,IAAU;AACd,mBAASjxF,IAAI,GAAG+8E,GAAMA,IAAM,KAAKiN,KAAKhqF,CAAV,GAAeA,KAAK;AAC9C+8E,cAAIplB,OAAOs5B;AACXlU,cAAIS,OAAO,KAAK6D;AAChB4P,iBAAWlU,EAAI52E;AAEfypF,gBAA+Br/E,KAAKE,IAClCm/E,GACA7S,EAAIc,wBAFyB;AAK/B,gBAAMwoD,IAAmBp1C,IAAU,KAAK1G,OAAOjK;AAE7CvD,kBAAQ,KAAK8N,aACbw7C,IAAmB,KAAK13E,WAAWsc,qBAG7Bq7D,IAAO,KAAK33E,WAAWsc,mBAAmBo7D,GAChD,KAAKx7C,UAAU1kF,UAAUmgI,GACzBr1C,KAAWq1C;AAEb,iBAAKv1C,qBAAqBhU,CAA1B;UApB8C;AAuB9C,eAAKr4E,oBACL,KAAK0kF,OAAOxnE,kBACZ,KAAKwnE,OAAOxnE,eAAeqW,YAA3B,MAEMrvB,IAAS,KAAKwgF,OAAOxnE,eAAeG,YAA3B,OAGb6tE,IAA+Br/E,KAAKE,IAClCm/E,GACAhnF,EAAOixB,eAAP,EAAwB5zB,QAAQ,KAAK0oD,WAAW6zE,gBAFnB;AAOnC,eAAK33C,UAAU98E,WAAWkjF,IAAU,KAAKpG,UAAU9L;AACnD,eAAK+K,oBACH8F,IACA,KAAKvO,SACL,KAAK1yB,WAAW6zE;AAClB,eAAKv8H,SAAS,KAAK0oD,WAAW6zE;AAC9B,eAAKr8H,SAAS8qF,IAAU,KAAKtiC,WAAW6zE;AACxC,eAAK/3C,SAAS,KAAKF,OAAOvI;QAlDV;MAnYd,GAtCNrvC,6CAAA,CAAA;AAsCao7C,iDAAAA,aAAAA;ACjBP,UAAO6V,gEAAP,cAA0BivB,+DAA1B;QAcJ1uG,YACEqb,GACAhzB,GACgB0lD,GAA2B;AAE3C,gBAAM1yB,GAAMhzB,GAAO0lD,CAAnB;AAFgB,eAAAA,YAAAA;AAVlB,eAAAq0E,aAAa;AAeX,eAAKC,cAAkBt9I,kDAAiBqwC,qCAAIif,MAAM,EAChD,SAAS,mBACT,WAAa,iBAFmC,CAA/B;AAOnB,eAAKoK,QAAQz3C,aAAa,KAAKq7H,aAAa,KAAKziC,OAAjD;AAGA,eAAK0iC,eAAmBv9I;YACtBqwC,qCAAIif;YACJ,EAAC,SAAS,mBAAV;YACA,KAAKoK;UAHa;QAfuB;QAsBpC+mC,QAAQzC,GAAgB;AAC/B,eAAK6c,QAAQ19F,aAAa,KAAK6gF,CAA/B;AACA,eAAKs/C,YAAYngI,aAAa,KAAK6gF,CAAnC;QAF+B;QAUjCu9C,iBAAiBiC,GAAqB;AACpC,eAAKD,aAAapgI,aAAa,KAAKqgI,CAApC;QADoC;QAI7B98C,UAAO;AAEd,eAAKma,QAAQ19F,aAAa,aAAa,aAAvC;AACA,eAAKogI,aAAapgI,aAAa,aAAa,aAA5C;AACA,eAAKmgI,YAAYngI,aAAa,aAAa,4BAA3C;QAJc;QAOP69B,YAAYzxC,GAAe;AAClC,eAAKg0I,aAAaj6H,MAAMkB,UAAU;AAClC,eAAK84H,YAAYh6H,MAAMkB,UAAU;AACjC,cAAI,CAAC,KAAKlB,MAAMi7D;AACd,kBAAU9pE,MACR,iFADI;AAKR,eAAK8oI,aAAapgI,aAAa,UAAU,KAAKmG,MAAMi7D,cAApD;AACA,eAAK++D,YAAYngI,aAAa,QAAQ,KAAKkgI,UAA3C;AAEA,gBAAMriG,YAAYzxC,CAAlB;AAEA,eAAKsxG,QAAQ19F,aAAa,UAAU,MAApC;QAdkC;QAiB3BipE,SAAS9N,GAAsB;AACtC,eAAKh1D,QAAQg1D;AACb,eAAK+kE,aACIjzI,0CAAM,QAAQ,KAAKkZ,MAAM27D,eAAe,GAA/C,KAAuD,KAAKo+D;QAHxB;QAM/BniC,kBAAkBx5C,GAAoB;AACzCA,eACF,KAAKm5C,QAAQ19F,aACX,UACA,UAAU,KAAK6rD,UAAU6X,iBAAiB,GAF5C,GAIA,KAAK08D,aAAaj6H,MAAMkB,UAAU,WAElC,KAAKq2F,QAAQ19F,aAAa,UAAU,MAApC,GACA,KAAKogI,aAAaj6H,MAAMkB,UAAU;QATS;QAatCu2F,cAAcpiF,GAAe;AACpC,cAAIA,GAAQ;AACV,iBAAK4kH,aAAaj6H,MAAMkB,UAAU;AAClC,gBAAI,CAAC,KAAKlB,MAAM07D;AACd,oBAAUvqE,MACR,8FADI;AAKR,iBAAK6oI,YAAYngI,aAAa,QAAQ,KAAKmG,MAAM07D,eAAjD;AACA,iBAAK67B,QAAQ19F,aAAa,UAAU,MAApC;AACA,iBAAK09F,QAAQ19F,aAAa,QAAQ,KAAKmG,MAAM07D,eAA7C;UAVU;QADwB;QAe7Bg8B,gBAAgBjhG,GAAiB;AACxC,gBAAMihG,gBAAgBjhG,CAAtB;AACIA,eACF,KAAK8gG,QAAQ19F,aAAa,UAAU,MAApC;QAHsC;MA/GtC,GArBNssC,oDAAA,CAAA;AAqBaixD,wDAAAA,aAAAA;ACOP,UAAO4F,2DAAP,cAAwB4pB,0DAAxB;QAOJjvG,YAAY7mB,GAAY;AACtB,gBAAMA,CAAN;AANM,eAAAqpI,qBAAuD;QAKvC;QAQfltI,KACPmrC,GACAC,GAAyD;AAEzD,gBAAMprC,KAAKmrC,GAAOC,CAAlB;AACA,eAAK8hG,qBAAqB,KAAKC,wBAAL;AAC1B,eAAKD,mBAAmBltI,KAAxB;QAJyD;QAOlDkwG,WAAWjkG,GAAiBk/B,GAAY;AAC/C,gBAAM+kE,WAAWjkG,GAAKk/B,CAAtB;AACA,eAAKm+F,sBAAL,EAA6BtpI,KAA7B;QAF+C;QAKxCiwG,iBAAc;AACrB,iBAAO,IAAInnB;QADU;QAUJsnB,gBAAgBp3G,GAAe;AAChD,iBAAO,IAAIs7F;YAAW;YAAMt7F;UAArB;QADyC;QAY/Bq3G,YACjBr3G,GACAw2F,GAAoB;AAEpB,iBAAO,IAAID,qDAAOv2F,GAAOw2F,CAAlB;QAFa;QAYb8gB,eAAevqE,GAAkBhzB,GAAiB;AACzD,iBAAO,IAAIo3F,8DAAWpkE,GAAMhzB,GAAO,KAAK2jD,aAAL,CAA5B;QADkD;QASjDy2E,0BAAuB;AAC/B,iBAAO,IAAIlC,qFAA0B,KAAKv0E,aAAL,CAA9B;QADwB;QAUjC4yE,wBAAqB;AACnB,cAAI,CAAC,KAAK4D;AACR,kBAAUhpI,MACR,wEADI;AAKR,iBAAO,KAAKgpI;QAPO;MApFjB;uEA+FkB,SAASn9B,wDAAjC;AA3HA,UAAA72D,iDAAA,CAAA;AA4Ba62D,qDAAAA,WAAAA;AC5Bb,UAAA72D,8CAAA,CAAA;AAqBE4vC,kDAAAA,mBAAAA;AACAyG,kDAAAA,SAAAA;AACA07C,kDAAAA,4BAAAA;AACAhC,kDAAAA,cAAAA;kDACAjiD,cAAAA;AACAmjB,kDAAAA,aAAAA;AAEA7V,kDAAAA,aAAAA;AADAyb,kDAAAA,WAAAA;kDAEAt4D,iBAAAA;ACFI,UAAO68C,2DAAP,cAA0B2iC,wDAA1B;QAQJvsG,YAAY2gB,GAAoBryC,GAAe;AAC7C,gBAAMqyC,GAAUryC,CAAhB;QAD6C;QAStC80B,cAAW;AAClB,iBAAO,KAAK0mE;QADM;QAIXG,kBAAe;AACtB,cAAI63C,IAAoB;AACxB,mBAASjmI,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,QAAQM;AAEpC,gBADY,KAAKgqF,KAAKhqF,CAAV+8E,EACJkB,kBAAkB;AACxBgoD,kBAAoB;AACpB;YAFwB;AAK5B,eAASjmI,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,QAAQM,KAAK;AACzC,kBAAM+8E,IAAM,KAAKiN,KAAKhqF,CAAV;AACZ,gBAAMuvF,IAAWxS,EAAIa;AACrBb,cAAIa,WAAW,CAAA;AAEXb,cAAI0B,qBAAJ,KAEF1B,EAAIa,SAAS99E,KACX,IAAIygF;cACF,KAAK5xB;cACL,KAAK6gC,iBAAiB,MAAMD,EAAS,CAAT,CAA5B;YAFF,CADF;AAOF,gBAAKA,EAAS7vF,QAAd;AAGA,uBAASG,IAAI,GAAGA,IAAI0vF,EAAS7vF,SAAS,GAAGG,KAAK;AAC5Ck9E,kBAAIa,SAAS99E,KAAKyvF,EAAS1vF,CAAT,CAAlB;AACA,sBAAM6/D,IAAU,KAAK8vB,iBAAiBD,EAAS1vF,CAAT,GAAa0vF,EAAS1vF,IAAI,CAAb,CAAnC;AAChBk9E,kBAAIa,SAAS99E,KAAK,IAAIygF,uEAAY,KAAK5xB,YAAY+Q,CAAjC,CAAlB;cAH4C;AAK9Cqd,gBAAIa,SAAS99E,KAAKyvF,EAASA,EAAS7vF,SAAS,CAA3B,CAAlB;AACIq9E,gBAAI2B,mBAAJ,MACEhf,IAAU,KAAK8vB,iBACjBD,EAASA,EAAS7vF,SAAS,CAA3B,GACA,IAFY,GAIVumI,KAAqBlpD,EAAIqB,kBAC3B1e,KAAW,KAAK/Q,WAAWk0B,YAG7B9F,EAAIa,SAAS99E,KAAK,IAAIygF;gBAAY,KAAK5xB;gBAAY+Q;cAAjC,CAAlB;YAlBF;UAdyC;QATrB;QA8Cf8vB,iBAAiBC,GAAyBn4D,GAAuB;AACxE,cAAI,CAACm4D;AAEH,mBAAIn4D,KAAQ+lD,yDAAMxB,QAAQvkD,CAAd,KAAwBA,EAAe0Z,aAC1C,KAAK2d,WAAWoxB,iBAGrBzoD,KAAQ+lD,yDAAMlB,cAAc7kD,CAApB,IACH,KAAKq3B,WAAW8zB,uBAErBnrD,KAAQ+lD,yDAAMjB,iBAAiB9kD,CAAvB,IACH,KAAKq3B,WAAWu0B,+BAGlB,KAAKv0B,WAAW+zB;AAIzB,cAAI,CAACrF,yDAAMpB,QAAQwT,CAAd,KAAuB,CAACn4D;AAE3B,mBAAI+lD,yDAAMxB,QAAQ4T,CAAd,KAAwBA,EAAez+C,aAClC,KAAK2d,WAAWoxB,iBAGrB1C,yDAAM/jF,OAAOm2F,CAAb,IACqC,IAAhC,KAAK9gC,WAAW+zB,gBAAoB,IAEzCrF,yDAAMvB,MAAM2T,CAAZ,IACK,KAAK9gC,WAAWmzB,aAIrBzE,yDAAMd,2BAA2BkT,CAAjC,IACK,KAAK9gC,WAAW+zB,gBAGrBrF,yDAAMb,oBAAoBiT,CAA1B,IACK,KAAK9gC,WAAWq0B,kBAGrB3F,yDAAMR,aAAa4S,CAAnB,IACK,KAAK9gC,WAAWmzB,aAGlB,KAAKnzB,WAAW+zB;AAGzB,cAAIrF,yDAAMpB,QAAQwT,CAAd,KAAuB,CAACn4D,GAAM;AAChC,gBAAI+lD,yDAAMnB,gBAAgBuT,CAAtB;AACF,qBAAO,KAAK9gC,WAAWmzB;AAClB,gBAAIzE,yDAAMlB,cAAcsT,CAApB;AACT,qBAAO,KAAK9gC,WAAW+zB;AAClB,gBAAIrF,yDAAMjB,iBAAiBqT,CAAvB;AACT,qBAAO,KAAK9gC,WAAWmzB;UANO;AAWlC,cAAI,CAACzE,yDAAMpB,QAAQwT,CAAd,KAAuBn4D,KAAQ+lD,yDAAMpB,QAAQ3kD,CAAd,GAAqB;AAEvD,gBAAI+lD,yDAAMxB,QAAQ4T,CAAd,KAAwBA,EAAez+C,YAGlC;AAAA,kBAFHqsC,yDAAMlB,cAAc7kD,CAApB,KAEO+lD,yDAAMnB,gBAAgB5kD,CAAtB;AACT,uBAAO,KAAKq3B,WAAW6zB;YADlB,OAGF;AAGE,kBAFHnF,yDAAMlB,cAAc7kD,CAApB,KAEO+lD,yDAAMnB,gBAAgB5kD,CAAtB;AACT,uBAAO,KAAKq3B,WAAW8zB;kBACdpF,yDAAMjB,iBAAiB9kD,CAAvB;AACT,uBAAO,KAAKq3B,WAAW+zB;YANpB;AASP,mBAAO,KAAK/zB,WAAW+zB,gBAAgB;UAjBgB;AAqBzD,cAAIrF,yDAAM/jF,OAAOm2F,CAAb,KAAsBn4D,KAAQ,CAAC+lD,yDAAMpB,QAAQ3kD,CAAd;AACjC,mBAAO,KAAKq3B,WAAW+zB;AAIzB,cAAIrF,yDAAMlB,cAAcsT,CAApB,KAA6Bn4D,KAAQ+lD,yDAAMxB,QAAQvkD,CAAd;AAEvC,mBAAKA,EAAe0Z,aACX,KAAK2d,WAAWoxB,iBAGhB,KAAKpxB,WAAW+zB;AAI3B,cAAIrF,yDAAMX,mBAAmB+S,CAAzB,KAAkCn4D,GAAM;AAE1C,gBAAI+lD,yDAAMvB,MAAMxkD,CAAZ;AACF,qBAAO,KAAKq3B,WAAWmzB;AAGzB,gBAAIzE,yDAAMhB,qBAAqB/kD,CAA3B,KAAoC+lD,yDAAMf,iBAAiBhlD,CAAvB;AACtC,qBAAOA,EAAKmmD;UAP4B;AAW5C,iBAAIJ,yDAAMb,oBAAoBiT,CAA1B,KAAmCn4D,IAC9BA,EAAKmmD,cAAc,KAAK9uB,WAAW8yB,gBAK1CpE,yDAAMxB,QAAQ4T,CAAd,KACAn4D,KACA+lD,yDAAMxB,QAAQvkD,CAAd,KACCm4D,EAAez+C,eAAgB1Z,EAAe0Z,cAM7C1Z,KAAQ+lD,yDAAMR,aAAavlD,CAAnB,IACH,KAAKq3B,WAAW+zB,gBAGlB,KAAK/zB,WAAWoxB;QA5HiD;QA+HjE0Q,oBAAoBhB,GAAWn4D,GAAS;AAE/C,iBAAI+lD,yDAAMJ,SAASwS,CAAf,KAAwBpS,yDAAMH,YAAY5lD,CAAlB,IACnB,KAAKq3B,WAAWs0B,4BAGrB5F,yDAAMJ,SAASwS,CAAf,KAAwBpS,yDAAMH,YAAY5lD,CAAlB,IACnB,KAAKq3B,WAAWmzB,aAErB2N,EAAKxR,oBAAoB3mD,EAAK2mD,mBACzB,KAAKtvB,WAAW+zB,gBAErB,CAAC+M,EAAKzR,gBAAgB1mD,EAAK0mD,eACtB,KAAKrvB,WAAWw0B,8BAErBsM,EAAKzR,gBAAgB1mD,EAAK0mD,gBAG1ByR,EAAKrR,iBAAiB9mD,EAAK8mD,gBACtB,KAAKzvB,WAAW+zB,gBAElB,KAAK/zB,WAAWoxB;QArBwB;QAwBxC+Q,mBAAmB/T,GAAU51E,GAAgB;AACpD,cAAIk2E,yDAAMtB,SAAS50E,CAAf;AACF,mBAAO41E,EAAIplB,OAAOxwD,EAAKhB,SAAS;AAElC,cAAIk3E,yDAAMH,YAAYH,CAAlB;AAIF,mBAFMhvE,IADYgvE,EAENplB,OAFMolB,EAEW52E,SAFX42E,EAE8BgC,iBAC5C1B,yDAAMf,iBAAiBn1E,CAAvB,IACK4G,IAAW5G,EAAKhB,SAAS,IAE3B4H,IAAW5G,EAAKhB,SAAS;AAElC,cAAIk3E,yDAAMJ,SAASF,CAAf;AAEF,mBAAIM,yDAAMvB,MAAM30E,CAAZ,IADW41E,EAECiF,UAAU76E,EAAKhB,SAAS,IAFzB42E,EAIDiF,UAAU76E,EAAKhB,SAAS;AAGxC,cAAI2H,IAASivE,EAAIplB;AAQjB,iBAJE7pD,IAHEuvE,yDAAMxB,QAAQ10E,CAAd,KAAuB41E,EAAIiB,eAG7BlwE,KADE,KAAK6gD,WAAWo2B,4BAA4B59E,EAAKhB,SAAS,KAG5D2H,IAAUivE,EAAI52E,SAAS;QA3B2B;QAgC7CqoF,YAAS;AAIhB,cAAIoB,IAA+B,GAC/BqB,IAAU;AACd,mBAASjxF,IAAI,GAAGA,IAAI,KAAKgqF,KAAKtqF,QAAQM,KAAK;AACzC,kBAAM+8E,IAAM,KAAKiN,KAAKhqF,CAAV;AACZ+8E,cAAIplB,OAAOs5B;AACXlU,cAAIS,OAAO,KAAK6D;AAChB4P,iBAAWlU,EAAI52E;AAEfypF,gBAA+Br/E,KAAKE,IAClCm/E,GACA7S,EAAIc,wBAFyB;AAK/B,gBAAMwoD,IAAmBp1C,IAAU,KAAK1G,OAAOjK;AAE7CvD,kBAAQ,KAAK8N,aACbw7C,IAAmB,KAAK13E,WAAWsc,qBAG7Bq7D,IAAO,KAAK33E,WAAWsc,mBAAmBo7D,GAChD,KAAKx7C,UAAU1kF,UAAUmgI,GACzBr1C,KAAWq1C;AAEb,iBAAKv1C,qBAAqBhU,CAA1B;UArByC;AAwBzC,eAAKr4E,oBACL,KAAK0kF,OAAOxnE,kBACZ,KAAKwnE,OAAOxnE,eAAeqW,YAA3B,MAEMrvB,IAAS,KAAKwgF,OAAOxnE,eAAeG,YAA3B,OAGb6tE,IAA+Br/E,KAAKE,IAClCm/E,GACAhnF,EAAOixB,eAAP,EAAwB5zB,KAFK;AAOnC,eAAK4kF,UAAU98E,WAAWkjF,IAAU,KAAKpG,UAAU9L;AACnD,eAAK+K,oBAAoB8F,IAA+B,KAAKvO;AAE7D,eAAKl7E,SAAS8qF;AACd,eAAKxG,SAAS,KAAKF,OAAOvI;QAhDV;MA1Pd,GA3BNrvC,+CAAA,CAAA;AA2Bao7C,mDAAAA,aAAAA;ACPP,UAAOyb,6DAAP,cAAwB4pB,0DAAxB;QAIJjvG,YAAY7mB,GAAY;AACtB,gBAAMA,CAAN;QADsB;QAULusG,gBAAgBp3G,GAAe;AAChD,iBAAO,IAAIs7F,yDAAW,MAAMt7F,CAArB;QADyC;MAd9C;AAmBS3M,uEAAS,WAAW0jH,0DAAnC;AAvCA,UAAA72D,mDAAA,CAAA;uDAoBa62D,WAAAA;ACpBb,UAAA72D,kDAAA,CAAA;AAakBo7C,sDAAAA,aAAAA;AAAVyb,sDAAAA,WAAAA;ACHR,UAAMlnC,wDAAqB;QACzB,eAAiB,EACf,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHH;QAKjB,aAAe,EACb,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHL;QAKf,cAAgB,EACd,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHJ;QAKhB,aAAe,EACb,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHL;QAKf,aAAe,EACb,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHL;QAKf,kBAAoB,EAClB,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHA;QAKpB,aAAe,EACb,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHL;QAKf,iBAAmB,EACjB,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHD;QAKnB,yBAA2B,EACzB,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,UAHO;QAK3B,YAAc,EACZ,eAAiB,WACjB,iBAAmB,WACnB,gBAAkB,WAClB,KAAO,MAJK;MA9CW,GAsDrBnB,oDAAiB,EACrB,iBAAmB,EAAC,QAAU,UAAX,GACnB,eAAiB,EAAC,QAAU,UAAX,GACjB,gBAAkB,EAAC,QAAU,UAAX,GAClB,eAAiB,EAAC,QAAU,UAAX,GACjB,eAAiB,EAAC,QAAU,UAAX,GACjB,oBAAsB,EAAC,QAAU,UAAX,GACtB,eAAiB,EAAC,QAAU,UAAX,GACjB,mBAAqB,EAAC,QAAU,UAAX,GACrB,2BAA6B,EAAC,QAAU,UAAX,EATR,GAeV0lE,2CAAQ,IAAIhmE,mCAAM,SAASyB,uDAAoBnB,iDAAvC,GA/ErBxuB,oCAAA,EA+Eak0F,OAAAA,yCA/Eb;ACAA,UAAAl0F,qCAAA,EAWQ4vB,SAAAA,8CAASskE,OAAAA,yCAXjB;ACuBM,UAAOC,0DAAP,MAAA;QAeJ3iH,YACE4iH,GACAC,GACA17H,GAAoC;AAGpC,eAAK21C,MACF8lF,EAAA,iBACWxgJ,yDAAZ;AAMF,eAAK0gJ,UAHL,KAAKC,UAAU57H,KAAc,QAGA,KAAK47H,QAAQC,SAAb,IAA0B,IAAI;AAG3D,eAAKC,kBAAkBL;AAEvB,eAAKM,iBAAiBL;AAGtB,eAAK/e,aAAa,KAAKof,eAAerlG,aAApB;QAnBkB;QA2BtCvoC,OAAI;QAAA;QAQJzH,SAAM;AACJ,iBAAO;QADH;QAaNs1I,iBAAc;AACZ,iBAAO;QADK;QASdvvH,QAAK;AACH,iBAAO,KAAKkpC;QADT;QAUL78C,YAAS;AACP,iBAAO;QADA;QAUT+iI,WAAQ;AACN,iBAAO,KAAKF;QADN;QASR/pI,eAAY;AACV,iBAAO;QADG;QASZqqI,gBAAa;AACX,iBAAO;QADI;QAKb/0I,UAAO;QAAA;QAQPg1I,YAAYC,GAAmB;QAAA;MA9H3B,GAvBN90F,6CAAA,CAAA;AAuBam0F,iDAAAA,cAAAA;ACeP,UAAOY,0DAAP,cACIZ,wDADJ;QA4DJ3iH,YACEwjH,GACAX,GACA17H,GAAoC;AAEpC,gBAAMq8H,GAAaX,GAAe17H,CAAlC;AAvCQ,eAAA4oF,UAHA,KAAAr+C,QAAQ;AAkBR,eAAA+xF,YAHA,KAAAC,WAHA,KAAAC,eAHA,KAAAC,UAHA,KAAAC,WAAkC;AAmBlC,eAAAC,cAHA,KAAAC,YAAY;AAMZ,eAAAC,eAA6C,CAAA;AAiBrD,eAAKC,aAAa,KAAKC,sBAAL;QALkB;QAe7B5uI,OAAI;AACX,eAAK6uI,kBAAkB,KAAKlB,eAA5B;AACA,eAAKmB,eAAe,KAAKnB,eAAzB;AACA,eAAKoB,WAAL;AACuC,qBAAnC,KAAKpB,gBAAL,UACF,KAAKj2I,KAAL;QALS;QAeHk3I,wBAAqB;AAC7B,iBAAO,EACL,WAAa,0BACb,KAAO,kBACP,qBAAuB,kCACvB,MAAQ,mBACR,OAAS,oBACT,UAAY,0BACZ,UAAY,uBACZ,UAAY,uBACZ,YAAc,wBATT;QADsB;QAoBrBE,eAAeZ,GAAyB;AAChD,cAAI,YAAYA;AACd,iBAAKQ,eAAeR,EAAA;mBAEdzzH,IAAWyzH,EAAA;AAGjB,qBAAS3nI,IAAI,GAAGA,IAAIkU,EAASxU,QAAQM,KAAK;AAExC,oBAAMyoI,IADUv0H,EAASlU,CAAT0oI;AAEZvmI,oBAAMyR,QAAQ,KAAKu0H,YAAnB,KACF,KAAKA,aAAaroI,KAAK2oI,CAAvB;YAJsC;QAPI;QAsBxCH,kBAAkBX,GAAyB;AACnD,eAAK9xF,QACH,UAAU8xF,IACEj0I,8DAAyBi0I,EAAA,IAAjC,IACA;AACN,eAAKzzC,UAAU,KAAKy0C,WAAWhB,CAAhB;AACfzpI,iBAAO2oF,OACL,KAAKuhD,YACLT,EAAA,aAA6BA,EAAA,SAF/B;QANmD;QAiB3Ca,aAAU;AAClB,eAAKR,WAAW,KAAKY,iBAAL;AACXv6I,oDAAQ,KAAK25I,UAAev2G,uCAAKg3B,QAAtC;AACKn6D,qDAAS,KAAK05I,UAAej8F,wCAAM3mC,UAAU,KAAlD;AACK9W;YAAS,KAAK05I;YAAej8F,wCAAM88F;YAAO,KAAK5B,SAAS;UAA7D;AAEA,eAAKc,UAAU,KAAKe,oBAAL;AACf,eAAKf,QAAQv7H,MAAMu8H,gBAAgB;AACnC,eAAKf,SAAS/8H,YAAY,KAAK88H,OAA/B;AAEA,eAAKD,eAAe,KAAKkB,4BAAL;AACpB,eAAKlB,aAAat7H,MAAMu8H,gBAAgB;AACxC,eAAKhB,QAAQ98H,YAAY,KAAK68H,YAA9B;AAEA,eAAKD,WAAW,KAAKoB,eAAL;AACX56I,oDAAQ,KAAKw5I,UAAep2G,uCAAK62B,YAAtC;AACA,eAAKw/E,aAAa78H,YAAY,KAAK48H,QAAnC;AAEA,eAAKD,YAAY,KAAKsB,gBAAgB,KAAKrzF,KAA1B;eACZiyF,aAAa78H,YAAY,KAAK28H,SAAnC;AAEA,gBAAMlkI,IAAK,KAAKkkI,UAAU9+H,aAAa,IAA5B;AACPpF,eACGpV,2CAAS,KAAK05I,UAAej8F,wCAAMo9F,YAAYzlI,CAApD;AAGF,eAAK0lI,iBAAiB,KAAKl1C,OAA3B;AAEA,iBAAO,KAAK8zC;QA5BM;QAoCVY,mBAAgB;AACxB,gBAAMl5H,IAAY7E,SAASC,cAAc,KAAvB,GACZW,IAAY,KAAK28H,WAAL;AACd38H,eACEtiB,0CAASumB,GAAWjE,CAAxB;AAEF,iBAAOiE;QANiB;QAehBo5H,sBAAmB;AAC3B,gBAAMO,IAASx+H,SAASC,cAAc,KAAvB;AACf,cAAMW,IAAY,KAAK28H,WAAL;AACd38H,eACEtiB;YAASkgJ;YAAQ59H;UAArB;AAEI69H,cAAgB,GACpB5B,wDAAgB4B,gBAAgB,KAAKnC,SAAL,CADZ;AAGtB,eAAKlf,WAAW3yG,MACX+zH,EAAO78H,MAAM+8H,eAAeD,IAC5BD,EAAO78H,MAAMg9H,cAAcF;AAChC,iBAAOD;QAZoB;QAqBnBL,8BAA2B;AACnC,gBAAMS,IAAoB5+H,SAASC,cAAc,KAAvB,GACpBW,IAAY,KAAK28H,WAAL;AACd38H,eACEtiB,0CAASsgJ,GAAmBh+H,CAAhC;AAEF,iBAAOg+H;QAN4B;QAc3BR,iBAAc;AACtB,gBAAMS,IAAc7+H,SAASC,cAAc,MAAvB;AACpB,cAAI,CAAC,KAAKu8H,eAAesC,aAApB,GAAoC;AACvC,kBAAMl+H,IAAY,KAAK28H,WAAL;AACd38H,iBACEtiB;cAASugJ;cAAaj+H;YAA1B;UAHqC;AAOzCi+H,YAAYl9H,MAAMkB,UAAU;AAC5B,iBAAOg8H;QAVe;QAoBdR,gBAAgB5rI,GAAY;AACpC,gBAAMssI,IAAe/+H,SAASC,cAAc,MAAvB;AACrB8+H,YAAavjI,aAAa,MAAM,KAAK0R,MAAL,IAAe,QAA/C;AACA6xH,YAAah9H,cAActP;AAE3B,WADMmO,IAAY,KAAK28H,WAAL,UAEZj/I,0CAASygJ,GAAcn+H,CAA3B;AAEF,iBAAOm+H;QAR6B;QAYtCp/B,eAAY;AACV,eAAKtW,UAAU,KAAKy0C,WAAW,KAAKvB,eAArB;AACf,eAAKgC,iBAAiB,KAAKl1C,OAA3B;QAFU;QAUFk1C,iBAAiBp7G,GAAc;AACnCA,gBACI2hG,IACJ+X,wDAAgBmC,cAAc,eAAe77G,KAAU,SACrD,KAAKi6F,WAAW3yG,MAClB,KAAKyyH,QAASv7H,MAAMs9H,cAAcna,IAElC,KAAKoY,QAASv7H,MAAMu9H,aAAapa;QAPE;QAkB/BgZ,WAAWhB,GAAyB;AAC5C,gBAAMqC,IACJrC,EAAA,iBAAiCA,EAAA;AAGnC,eAFM35G,IAAS25G,EAAA,WAEDqC;AACZ1rI,oBAAQxG,KACN,uBACE,KAAK+9C,QACL,2CAHJ;eAKK;AAAA,gBAAIm0F;AACT,qBAAO,KAAKC,oBAAoBD,CAAzB;AACF,gBAAIh8G;AACT,qBAAO,KAAKk8G,aAAal8G,CAAlB;UAHF;AAKP,iBAAO;QAhBqC;QA0BtCi8G,oBAAoBD,GAAiB;AAC3C,cAAMplG,IAAQ,KAAKqjF,WAAWvgG,SAAhB;AACd,cAAIsiH,KAAaplG,GAAO;AAEtB,iBADMp4B,IAAQo4B,EAAMu8B,eAAe6oE,CAArB,MACDx9H,EAAMwhB;AACjB,qBAAO,KAAKk8G,aAAa19H,EAAMwhB,MAAxB;AAEP1vB,oBAAQxG,KACN,YAAYkyI,IAAY,yCAD1B;UALoB;AAUxB,iBAAO;QAZoC;QAuBpC1C,iBAAc;AACrB,iBAAO,KAAKS;QADS;QAWfmC,aAAaC,GAA4B;AAGzCn8G,cAAiBt6B,8DAAyBy2I,CAAjC;AACf,cAAc,QAAVn8G,KAA6B,OAAXA;AAEpB,mBAAO;AAEP,cAAMmB,IAAMpe,OAAOid,CAAP;AACZ,cAAKqC,MAAMlB,CAAN,GAEE;AAEL,gBADMxB,IAAkBz6B,0CAAM86B,CAAlB;AAEV,qBAAOL;AAEPrvB,oBAAQxG,KACN,uBACE,KAAK+9C,QACL,0CACA7nB,CAJJ;AAMA,mBAAO;UAXJ;AADL,iBAAmBz6B,6CAAS47B,CAArB;QAVoC;QAiCvCi7G,UAAUC,GAAuB;AACzC,cAAKA,GAAL;AAGA,gBAAMC,IAAkB,KAAKlC,WAAL;AACpBkC,iBACElhJ,+CAAcihJ,GAASC,CAA3B;AAGF,aADM7+H,IAAY,KAAK28H,WAAL,aAEZj/I;cAASkhJ;cAAS5+H;YAAtB;UATF;QADyC;QAmBjC8+H,WAAWF,GAAuB;AAC1C,cAAKA,GAAL;AAGA,gBAAMG,IAAgB,KAAKpC,WAAL;AAClBoC,iBACEphJ,+CAAcihJ,GAASG,CAA3B;AAGF,aADM/+H,IAAY,KAAK28H,WAAL,eAEZj/I,0CAASkhJ,GAAS5+H,CAAtB;UATF;QAD0C;QAoBnC+7H,YAAYv2I,GAAkB;AACrC,eAAK+2I,SAAUx7H,MAAMkB,UAAUzc,IAAY,UAAU;AACrD,eAAKi3I,YAAY,CAACj3I;AAEd,eAAKo2I,eAAeoD,gBAApB,MAA0C,QAC5C,KAAKpD,eAAeqD,eAApB;QALmC;QAUvCv5I,OAAI;AACF,eAAKq2I,YAAY,KAAjB;QADE;QAQJ52I,OAAI;AACF,eAAK42I,YAAY,IAAjB;QADE;QAWJv2I,YAAS;AACP,iBAAO,CAAC,KAAKi3I,aAAa,KAAKyC,sBAAL;QADnB;QAUCA,wBAAqB;AAE7B,cAAIC,IAAyB;AAC7B,iBAAOA,EAASxmI,UAAT;AAEL,gBADAwmI,IAAWA,EAASxmI,UAAT,GACP,CAAEwmI,EAAqCC,WAArC;AACJ,qBAAO;AAGX,iBAAO;QATsB;QAYtB3tI,eAAY;AACnB,iBAAO,KAAKjM,UAAL,KAAoB,CAAC,KAAKg3I;QADd;QASrBzjG,QAAQtY,GAAS;QAAA;QAQjBhnB,YAAY4lI,GAAmB;AAC7B,cAAK,KAAK/C,SAAV;AAGA,gBAAMt8H,IAAY,KAAK28H,WAAL;AAClB,gBAAI0C,GAAY;AACd,oBAAMzpC,IAAgB,KAAK6oC,aACzBxC,wDAAgBqD,uBADI;AAGtB,mBAAKhD,QAAQv7H,MAAM2Z,kBAAkB,KAAK+tE,WAAWmN;AACjD51F,mBACEtiB,0CAAS,KAAK4+I,SAASt8H,CAA3B;YANY;AASd,mBAAKs8H,QAAQv7H,MAAM2Z,kBAAkB,IACjC1a,KACEpiB;gBAAY,KAAK0+I;gBAASt8H;cAA9B;AAGCnd,uDAAS,KAAK05I,UAA0Bj8F,wCAAM3mC,UAAU0lI,CAA7D;UAlBA;QAD6B;QA2B/BE,YAAYC,GAAmB;AAC7B,eAAKhD,cAAcgD;AACnB,eAAKj5I,OAAL,EAAeqU,aAAa,YAAY,GAAG4kI,CAAH,EAAxC;AACAA,cACI,KAAKj5I,OAAL,EAAeqU,aAAa,YAAY,MAAxC,IACA,KAAKrU,OAAL,EAAeijC,gBAAgB,UAA/B;QALyB;QAa/Bja,UAAO;AACL,iBAAO,KAAK66B;QADP;QAIEzxC,YAAS;AAChB,iBAAO,KAAK8iI;QADI;QAITl1I,SAAM;AACb,iBAAO,KAAKg2I;QADC;QAUf9oC,cAAW;AACT,iBAAO,KAAKipC;QADH;QAYX+C,qBAAqBh3H,GAAmC;AACtD,eAAKi0H,eAAe,CAAA;AAYlB,eAAKf,kBAViB,aAApB,OAAOlzH,IACkCi3H;YACzCnqB,MAAM,KAAKomB,gBAAgBpmB;YAC3BoqB,QAAQl3H;YACRxQ,IAAI,KAAK0jI,gBAAgB1jI;YACzB2nI,eAAe,KAAKjE,gBAAgBiE;YACpCr9G,QAAQ,KAAKo5G,gBAAgBp5G;YAC7Bs9G,WAAW,KAAKlE,gBAAgBkE;YAChCC,QAAQ,KAAKnE,gBAAgBmE;UAPYJ,IAWDA;YACxCnqB,MAAM,KAAKomB,gBAAgBpmB;YAC3B1jH,MACE,UAAU,KAAK8pI,kBAAkB,KAAKA,gBAAL,OAA+B;YAClElzH,UAAkB9oB,iEAA4B8oB,CAApC;YACVxQ,IAAI,KAAK0jI,gBAAgB1jI;YACzB2nI,eAAe,KAAKjE,gBAAgBiE;YACpCr9G,QAAQ,KAAKo5G,gBAAgBp5G;YAC7Bs9G,WAAW,KAAKlE,gBAAgBkE;YAChCC,QAAQ,KAAKnE,gBAAgBmE;UATWJ;AAa5C,eAAK5C,eAAe,KAAKnB,eAAzB;QA5BsD;QA+B/C50I,UAAO;AACVjJ,sDAAW,KAAKy+I,QAApB;QADc;MAvlBZ;AAKGN,8DAAAjtB,mBAAmB;AAGnBitB,8DAAA4B,gBAAgB;AAGhB5B,8DAAAmC,cAAc;AAMdnC,8DAAAqD,0BAA0B;AA6lB/BjlJ,0CAAS,o8CAAb;+CA2EW2X,qCAAK60C,cACdo1F,wDAAgBjtB,kBAChBitB,uDAHF;AA9tBA,UAAA/0F,yCAAA,CAAA;AAsCa+0F,6CAAAA,kBAAAA;ACbP,UAAO8D,4DAAP,cAAgC1E,wDAAhC;QAaJ3iH,YAAYsnH,GAAqC/9F,GAAiB;AAChE,gBAAM+9F,GAAc/9F,CAApB;AATQ,eAAA06F,aAAwB,EAAC,WAAa,uBAAd;AAE1B,eAAAJ,WAAkC;AAWxC9pI,iBAAO2oF,OAAO,KAAKuhD,YADjBqD,EAAA,aAA8BA,EAAA,SAChC;QALgE;QAQzDhyI,OAAI;AACX,eAAK+uI,WAAL;QADW;QASHA,aAAU;AAClB,gBAAM94H,IAAY7E,SAASC,cAAc,KAAvB,GACZW,IAAY,KAAK28H,WAAL;AACd38H,eACEtiB,0CAASumB,GAAWjE,CAAxB;AAGF,iBADA,KAAKu8H,WAAWt4H;QANE;QAUX1d,SAAM;AACb,iBAAO,KAAKg2I;QADC;QAINx1I,UAAO;AACVjJ,sDAAW,KAAKy+I,QAApB;QADc;MA5CZ;gEAEGvtB,mBAAmB;AAwDxB30H,0CAAS,uSAAb;+CAkBW2X,qCAAK60C,cACdk5F,0DAAiB/wB,kBACjB+wB,yDAHF;AApGA,UAAA74F,0CAAA,CAAA;AAyBa64F,8CAAAA,mBAAAA;ACEP,UAAOE,iFAAP,cACIhE,wDADJ;QAuBJvjH,YACEwjH,GACAj6F,GACApiC,GAAoC;AAEpC,gBAAMq8H,GAAaj6F,GAASpiC,CAA5B;AApBQ,eAAAqgI,oBAA2C;AAG3C,eAAAC,YAAY;AAGZ,eAAAC,gBAAgC,CAAA;QAYJ;QAK7BxD,wBAAqB;AAC5B,gBAAMyD,IAAY,MAAMzD,sBAAN;AAClByD,YAAA,WAAwB;AACxB,iBAAOA;QAHqB;QAMrBvD,eAAeZ,GAAiC;AACvD,cAAI,YAAYA;AACd,iBAAKQ,eAAeR,EAAA;eACf;AACL,kBAAMzzH,IAAWyzH,EAAA;AACjB,gBAAKzzH,GAAL;AACA,mBAAKi0H,eAAe,CAAA;AAChB4D,kBAAmB;AACvB,uBAAS/rI,IAAI,GAAGA,IAAIkU,EAASxU,QAAQM,KAAK;AACxC,sBAAM0oI,IAAUx0H,EAASlU,CAAT;AAId,iBAAU9Z,wCAAiBuX,qCAAK60C,cAAco2F,EAAA,IAA7C,KACAA,EAAA,KAAgB9qI,YAAhB,MACC4tI,0DAAiB/wB,oBACjBsxB,KAGF,KAAK5D,aAAaroI,KADC4oI,CACnB,GACAqD,IAAmB,SAEnB,KAAKC,mBAAmBtD,CAAxB,GACAqD,IAAmB;cAfmB;YAH1C;UAFK;QAHgD;QAkCjDC,mBAAmBtD,GAAgC;AACzD,cAAI3L,IAAe2L,EAAA;AAKc,yBAA/B3L,EAAahpH,YAAb,KACQxoB,2DALUm9I,CAKlB,MAEA3L,IAAe2O,+EAA2BjxB;cAMxB,KAJct0H,yCACvBsX,qCAAK60C,cACdyqF,CAFuBkP,GAKvBvD,GACA,KAAKrB,gBACL,IAHkB;AAKpB,eAAKwE,cAAc/rI,KAAKgyC,CAAxB;QApByD;QAuBlDr4C,OAAI;AACX,gBAAMA,KAAN;AAEA,eAAKyyI,YACkC,WAArC,KAAK9E,gBAAL,YACuC,SAArC,KAAKA,gBAAL,QAFJ;QAHW;QASJoB,aAAU;AACjB,gBAAMA,WAAN;AAEA,gBAAM2D,IAAgB,KAAKC,qBAAL;AACtB,eAAKT,oBAAoB,KAAKU,wBAAwBF,CAA7B;AACpB99I,oDAAQ,KAAKs9I,mBAAwBl6G,uCAAKy2B,KAA/C;eACK8/E,SAAU/8H,YAAY,KAAK0gI,iBAAhC;AACA,eAAKpB,WAAW,KAAK1C,QAArB;AACKv5I,qDAAS,KAAK05I,UAAiCj8F,wCAAMugG,UAAU,KAApE;AAEA,iBAAO,KAAKtE;QAVK;QAaViB,iBAAc;AACrB,gBAAMS,IAAc7+H,SAASC,cAAc,MAAvB;AACpB,cAAI,CAAC,KAAKu8H,eAAesC,aAApB,GAAoC;AACvC,kBAAMl+H,IAAY,KAAK28H,WAAL;AACd38H,iBACEtiB,0CAASugJ,GAAaj+H,CAA1B;AAEFi+H,cAAYl9H,MAAM4B,aAAa;UALQ;AAQzCs7H,YAAYl9H,MAAMkB,UAAU;AAC5B,iBAAOg8H;QAXc;QAoBb2C,wBACRE,GAA6B;AAE7B,gBAAM9C,IAAoB5+H,SAASC,cAAc,KAAvB;YACR0B,MAAMkB,UAAU;AAClC,cAAMjC,IAAY,KAAK28H,WAAL;AACd38H,eACEtiB,0CAASsgJ,GAAmBh+H,CAAhC;AAGF,eAASzL,IAAI,GAAGA,IAAIusI,EAAc7sI,QAAQM,KAAK;AAC7C,kBAAMwsI,IAAcD,EAAcvsI,CAAd;AACpBwsI,cAAY/yI,KAAZ;AACA,kBAAMgzI,IAAiBD,EAAYx6I,OAAZ;AACvBy3I,cAAkBx+H,YAAYwhI,CAA9B;AACA,gBAAID,EAAYlF,gBAAgB;AAC9B,kBAAA;AAAA,uBAAA,IAAAkF,EAAYlF,eAAZ,MAAA,EAA8BjhI,aAAa,MAAMmmI,EAAYz0H,MAAZ,CAAjD;YAD8B;UALa;AAS/C,iBAAO0xH;QAlBsB;QA0B/ByC,YAAYrB,GAAmB;AAC7B,cAAI,KAAKe,cAAcf,GAAvB;AAGA,gBADA,KAAKe,YAAYf;AAEf,mBAAKc,kBAAmBn/H,MAAMkB,UAAU,SACxC,KAAK08H,UAAU,KAAKvC,QAApB;iBACK;AACL,kBAAA;AAAA,uBAAA,IAAA,KAAKR,eAAez5F,UAApB,MAAA,EAAiC0O,WAAW,KAA5C;AACA,mBAAKqvF,kBAAmBn/H,MAAMkB,UAAU;AACxC,mBAAK68H,WAAW,KAAK1C,QAArB;YAHK;AAKFv5I,uDACH,KAAK05I,UACAj8F,wCAAMugG,UACXzB,CAHF;AAMA,iBAAKxD,eAAeqF,wBAApB;UAjBA;QAD6B;QAqBtBlF,YAAYv2I,GAAkB;AACrC,eAAK+2I,SAAUx7H,MAAMkB,UAAUzc,IAAY,UAAU;AACrD,gBAAM07I,IAAoB,KAAKP,qBAAL;AAC1B,mBAASpsI,IAAI,GAAGA,IAAI2sI,EAAkBjtI,QAAQM;AAC9B2sI,cAAkB3sI,CAAlBwE,EACRgjI,YAAYv2I,CAAlB;AAEF,eAAKi3I,YAAY,CAACj3I;AAEd,eAAKo2I,eAAeoD,gBAApB,MAA0C,QAC5C,KAAKpD,eAAeqD,eAApB;QAVmC;QAoBvCG,aAAU;AACR,iBAAO,KAAKe;QADJ;QAIDrE,gBAAa;AACpB,iBAAO;QADa;QAIb/iG,QAAQtY,GAAS;AACxB,eAAK0gH,eAAL;QADwB;QAK1BA,iBAAc;AACZ,eAAKV,YAAY,CAAC,KAAKN,SAAvB;QADY;QAIL55I,SAAM;AACb,iBAAO,KAAKg2I;QADC;QASfoE,uBAAoB;AAClB,iBAAO,KAAKP;QADM;MAtOhB;qFAKYpxB,mBAAmB;AA2P5B30H,+CACE2X,qCAAK60C,cACdo5F,+EAA2BjxB,kBAC3BixB,8EAHF;AA3RA,UAAA/4F,qDAAA,CAAA;yDA2Ba+4F,6BAAAA;AnN3Bb,UAAA/4F,6DAAA,CAAA;AA0DgBx1C,iEAAAA,0BAAAA;AoNPV,UAAO0vI,iDAAP,cACIlrB,8CADJ;QAqDJx9F,YAAYvgB,GAAuB;AACjC,gBAAA;AA9CO,eAAAF,KAAK;AAQJ,eAAAopI,eAHV,KAAAC,UAAiC;AAMvB,eAAA36B,aAAa;AAGb,eAAA46B,YAA4B,CAAA;AAM5B,eAAA9U,UAHA,KAAAC,SAAS;AAeT,eAAA8U,0BAHA,KAAAC,gBALF,KAAA7V,UAA0B;AAexB,eAAA8V,eAAqC,CAAA;AAS7C,eAAKllB,aAAarkH;AAGlB,eAAKwpI,cAAcxpI,EAAU/E,QAAQiuC,gBAAgB,EACnD54B,UAAU,CAAA,EADyC;AAKrD,eAAKm5H,oBAAoBzpI,EAAU/E,QAAQmX;AAG3C,eAAKV,MAAM1R,EAAU/E,QAAQyW;AAG7B,eAAKg4H,cAAcpvI,uBAAOC,OAAO,IAAd;AAGnB,eAAKglE,kBAAkBv/D,EAAU/E,QAAQskE;QApBR;QA6BnCrO,WAAWC,GAA2B;AACpC,iBAAO;QAD6B;QAKtCt7D,OAAI;AACF,cAAMmK,IAAY,KAAKqkH;AACvB,gBAAMviH,IAAM9B,EAAU+B,aAAV;AAEZ,eAAK0xH,UAAU,KAAKkW,cAAL;AAEf,eAAKR,UAAU,KAAKvE,WAAW,KAAKvgB,UAArB;AACXz+H,uDAAY,KAAK6tI,QAAQpnI,UAAU,KAAvB,GAA+ByV,CAA/C;AACA,eAAK42C,WAAW,IAAhB;AACA,eAAK+6E,QAAQ59H,KAAKmK,CAAlB;AAEA,eAAK4uB,OAAO,KAAK46G,WAAjB;AACMI,cAAe5pI,EAAUypC,gBAAV;AACrBmgG,YAAalgG,UACX,KAAKy/F,SACL,2BACA,kBAHF;AAKAS,YAAalgG;YAAU,KAAKy/F;YAAS;YAA2B;UAAhE;AACA,eAAK9kB,WAAWrpE,oBAAhB,EAAsCtI,aAAa,EACjDE,WAAW,MACXrH,QAAQ,GACRsH,cAAc,CACZP,0DAAiBN,WAAWK,cAC5BC,0DAAiBN,WAAWI,aAC5BE,0DAAiBN,WAAWG,WAHhB,EAHmC,CAAnD;QAnBE;QAoCMyyF,WAAW5kI,GAAuB;AACpC8B,cAAM9B,EAAU+B,aAAV;AAEZ,gBAAM+J,IAAY,KAAKk5H,iBAAL;AAElB,eAAKkE,eAAe,KAAKW,yBAAL;AACpB,eAAKX,aAAahhG,WAAW;AACxBz9C;YAAQ,KAAKy+I;YAAmBr7G,uCAAK+2B;UAA1C;AACA94C,YAAUzE,YAAY,KAAK6hI,YAA3B;AAEApnI,YAAIuG,WAAYd,aAAauE,GAAWhK,CAAxC;AAEA,eAAKgoI,cAAch+H,GAAW,KAAKo9H,YAAnC;AACA,iBAAOp9H;QAbmC;QAqBlCk5H,mBAAgB;AACxB,gBAAM+E,IAAmB9iI,SAASC,cAAc,KAAvB;AACzB6iI,YAAiBtnI,aAAa,UAAU,KAAKsjI,aAAL,IAAsB,MAAM,GAApE;AACIxgJ,oDAASwkJ,GAAkB,mBAA/B;AACIxkJ,oDAASwkJ,GAAkB,sBAA/B;AACAA,YAAiBtnI,aAAa,OAAO,KAAKiP,MAAM,QAAQ,KAAxD;AACA,iBAAOq4H;QANiB;QAchBF,2BAAwB;AAChC,gBAAMhE,IAAoB5+H,SAASC,cAAc,KAAvB;oDACb2+H,GAAmB,wBAAhC;AACI,eAAKE,aAAL,MACFF,EAAkBj9H,MAAMohI,gBAAgB;AAE1C,iBAAOnE;QANyB;QAgBxBiE,cACRh+H,GACA+5H,GAAiC;AAG3BoE,cAA2BplJ,sDAC/BinB,GACA,eACA,MACA,KAAKo+H,UACyB,KALb;AAOnB,eAAKX,aAAartI,KAAK+tI,CAAvB;AAEME,cAA6BtlJ,sDACjCghJ,GACA,WACA,MACA,KAAKuE,YACyB,KALX;AAOrB,eAAKb,aAAartI,KAAKiuI,CAAvB;QAnBiC;QA2BzBD,SAASjuI,GAAe;AAChC,cAAkBhX,oDAAcgX,CAA5B,KAAkCA,EAAE+I,WAAW,KAAKmkI;AAE9CtlJ,2DAAP,EAA2C2V,UAAU,KAArD;eACI;AAEL,gBAAM6wI,IADgBpuI,EAAE+I,OACkBE,aAAa,IAAvC;AACZmlI,kBACIn6H,IAAO,KAAKo6H,mBAAmBD,CAAxB,GACTn6H,EAAM5W,aAAN,MACF,KAAKixI,gBAAgBr6H,CAArB,GACCA,EAAgC0wB,QAAQ3kC,CAAxC;AAIGpY,2DAAP,EAA2C2V,UAAU,IAArD;UAXI;AAaD/U,4DAAN;QAjBgC;QAyBxB2lJ,WAAWnuI,GAAgB;AACnC,cAAIuuI,IAAU;AACd,kBAAQvuI,EAAElB,KAAV;YACE,KAAK;AACHyvI,kBAAU,KAAKC,YAAL;AACV;YACF,KAAK;AACHD,kBAAU,KAAKE,gBAAL;AACV;YACF,KAAK;AACHF,kBAAU,KAAKG,cAAL;AACV;YACF,KAAK;AACHH,kBAAU,KAAKI,aAAL;AACV;YACF,KAAK;YACL,KAAK;AACC,mBAAKtB,iBAAiB,KAAKA,cAAc3F,cAAnB,MACA,KAAK2F,cACbN,eAAhB,GACAwB,IAAU;AAEZ;YACF;AACEA,kBAAU;UAtBd;AAyBI,WAACA,KAAW,KAAKlB,iBAGd,KAAKA,cAAsB3xI,cAC9B6yI,IAAW,KAAKlB,cAAsB3xI,UAAUsE,CAArC;AAIXuuI,eACFvuI,EAAE4yB,eAAF;QApCiC;QA+C3B86G,gBAAa;AACrB,gBAAM3pI,IAAY,KAAKqkH,YAEjB/5C,IAAmB,IAAItiC,uCAAQ,EACnC,iBAAmBhoC,GACnB,KAAOA,EAAU0R,KACjB,eAAiB1R,EAAU/E,QAAQ0kE,eACnC,kBAAoB3/D,EAAUoS,kBAC9B,UAAYpS,EAAU/E,QAAQimC,UAC9B,mBAAqBlhC,EAAU/E,QAAQklE,mBACvC,MAAQ,EACN,YAAc,KADR,EAP2B,CAAZ;AAazBmK,YAAiB/K,kBAAkBv/D,EAAU/E,QAAQskE;AAerD,iBAAO,KAbHv/D,EAAUoS,mBACW1vB,oDACZmX,qCAAK+0C,4BACd5uC,EAAU/E,SACV,IAHY,IAMSvY,oDACZmX,qCAAK80C,0BACd3uC,EAAU/E,SACV,IAHY,GAMQqvE,CAAjB;QA/Bc;QAwCvB17C,OAAOpf,GAA+B;AACpC,eAAKg6H,cAAch6H;AACnB,mBAASpT,IAAI,GAAGA,IAAI,KAAKgtI,UAAUttI,QAAQM,KAAK;AAC9C,kBAAM8xC,IAAc,KAAKk7F,UAAUhtI,CAAf;AAChB8xC,iBACFA,EAAYt/C,QAAZ;UAH4C;AAMhD,eAAKw6I,YAAY,CAAA;AACjB,eAAKM,cAAcpvI,uBAAOC,OAAO,IAAd;AACnB,eAAKswI,gBAAgBr7H,EAAA,QAArB;eACKzF,SAAL;AACA,eAAK++H,wBAAL;QAZoC;QAqB5B+B,gBAAgBr7H,GAAqC;AAG7D,gBAAMs7H,IAAW7jI,SAAS8jI,uBAAT;AACjB,mBAAS3uI,IAAI,GAAGA,IAAIoT,EAAW1T,QAAQM;AAErC,iBAAKgsI,mBADkB54H,EAAWpT,CAAX+mI,GACiB2H,CAAxC;AAEF,eAAK5B,aAAc7hI,YAAYyjI,CAA/B;QAR6D;QAkBvD1C,mBACNjF,GACA2H,GAA0B;AAE1B,cAAI3R,IAAegK,EAAA;AAKc,yBAA/BhK,EAAahpH,YAAb,KACQxoB,2DAAsBw7I,CAA9B,MAEAhK,IAAe2O,+EAA2BjxB;AAO5C,cAJMwxB,IAA4B9lJ;YACvBsX,qCAAK60C;YACdyqF,EAAan/H,YAAb;UAFuB;AAKjBk0C,gBAAc,IAAIm6F,EAAiBlF,GAAgB,IAArC,GACpBj1F,EAAYr4C,KAAZ,GACA,KAAKm1I,gBAAgB98F,CAArB,IACM+8F,IAAiB/8F,EAAY9/C,OAAZ,MAErB08I,EAASzjI,YAAY4jI,CAArB,GAIE/8F,EAAYw1F,eAAZ,KACFx1F,EAAYw1F,eAAZ,EAA8BjhI,aAAa,MAAMyrC,EAAY/5B,MAAZ,CAAjD;QA5BsB;QAsClB62H,gBAAgB98F,GAAyB;AACjD,eAAKk7F,UAAUltI,KAAKgyC,CAApB;AACA,eAAKw7F,YAAYx7F,EAAY/5B,MAAZ,CAAjB,IAAwC+5B;AACxC,cAAIA,EAAYy1F,cAAZ,GAA6B;AAEzBoF,gBADkB76F,EACkBs6F,qBAAhB;AAC1B,qBAASpsI,IAAI,GAAGA,IAAI2sI,EAAkBjtI,QAAQM;AAE5C,mBAAK4uI,gBADSjC,EAAkB3sI,CAAlBwE,CACd;UAL6B;QAHgB;QAkBnDsqI,kBAAe;AACb,iBAAO,KAAK9B;QADC;QAUf+B,SAASviI,GAAa;AAChBA,eAAS,KAAKugI,WACZ5jJ,0CAAS,KAAK4jJ,SAASvgI,CAA3B;QAFkB;QAYtBwiI,YAAYxiI,GAAa;AACnBA,eAAS,KAAKugI,WACZ1jJ,6CAAY,KAAK0jJ,SAASvgI,CAA9B;QAFqB;QAahBypG,gBAAa;AACpB,cAAI,CAAC,KAAK82B,WAAW,CAAC,KAAK36B;AACzB,mBAAO;AAMT,cAAM68B,IAAc,KAAKlC,QAAQh+H,sBAAb;AAEpB,gBAAMnB,IAAMqhI,EAAYrhI,KAClB4B,IAAS5B,IAAMqhI,EAAY9oI,QAC3B0H,IAAOohI,EAAYphI;AACnB0B,cAAQ1B,IAAOohI,EAAYhpI;AAIjC,iBAAI,KAAKk9D,oBAA4BptD,8CAASH,MACrC,IAAInG,uCAAK,MAAUD,GAAQ,MAXpBotH,GAWP,IACE,KAAKz5D,oBAA4BptD,8CAASG,SAC5C,IAAIzG,uCAAK7B,GAbFgvH,KAagB,MAbhBA,GAaP,IACE,KAAKz5D,oBAA4BptD,8CAASX,OAC5C,IAAI3F,uCAAK,MAfFmtH,KAeqB,MAAUrtH,CAAtC,IAGA,IAAIE,uCAAK,MAlBFmtH,KAkBqB/uH,GAlBrB+uH,GAkBP;QAzBW;QAuCb5mE,YAAY1zD,GAAmB;AAClCA,uBAAmBylC,4CAErB,KAAK+5E,mBAAmB,CADVx/G,EACiB8B,UAAN,KADX9B,EACsCjI,YAAN,CAA9C,IAEA,KAAKynH,mBAAmBznH,0DAAYiI,CAAZ,KAAwBA,EAAQjI,YAAR,CAAhD;AAEF,iBAAO,KAAKunH;QAP0B;QAe/BP,YAAYC,GAAwB;AAC3C,eAAK4tB,yBAAyB,IAA9B;QAD2C;QASpC1tB,WAAWF,GAAwB;AAC1C,eAAK4tB,yBAAyB,KAA9B;QAD0C;QAUnCztB,OAAOH,GAAwB;AACtC,eAAK4tB,yBAAyB,KAA9B;QADsC;QASrBptB,mBAAmB9rD,GAAoB;AACpDA,gBAAgB,KAAK4rD,iBAQzB,KAAKstB,yBAAyB,KAA9B,GACA,KAAKttB,eAAe5rD,GACpB,KAAKk5E,yBAAyB,IAA9B;QAXwD;QAqBhDA,yBAAyBH,GAAiB;AAClD,gBAAMviI,IAAQ,KAAKo1G,eACf,yBACA;AACAmtB,cACF,KAAKA,SAASviI,CAAd,IAEA,KAAKwiI,YAAYxiI,CAAjB;QAPgD;QAiBpD0hI,mBAAmBxqI,GAAU;AAC3B,iBAAO,KAAK4pI,YAAY5pI,CAAjB,KAAwB;QADJ;QAS7Bsa,WAAQ;AACN,iBAAO,KAAKm6G;QADN;QASRr/E,YAAS;AACP,iBAAO,KAAKo/E;QADL;QASTtqF,YAAS;AACP,iBAAO,KAAKypF;QADL;QASTr1F,eAAY;AACV,iBAAO,KAAKimF;QADF;QASZwiB,kBAAe;AACb,iBAAO,KAAKyC;QADC;QAUfiC,4BAAyB;AACvB,iBAAO,KAAKlC;QADW;QAUzBtD,eAAY;AACV,iBAAO,KAAK0D;QADF;QAQZ1/H,WAAQ;AACN,gBAAMyhI,IAAmB,KAAKnnB,WAAW1sE,WAAhB,GACnB8zF,IAAa,KAAKtC;AACnBsC,gBAKD,KAAKhC,qBACPgC,EAAW7iI,MAAMqB,OAAO,KACxBwhI,EAAW7iI,MAAMrG,SAAS,QAC1BkpI,EAAW7iI,MAAMvG,QAAQ,QACzB,KAAKiyH,UAAUmX,EAAWjpI,cAC1B,KAAK+xH,SAASiX,EAAiBvzF,WAC3B,KAAKsnB,oBAA4BptD,8CAASH,MAC5Cy5H,EAAW7iI,MAAMoB,MAAM,MAGvByhI,EAAW7iI,MAAMgD,SAAS,QAGxB,KAAK2zD,oBAA4BptD,8CAASE,QAC5Co5H,EAAW7iI,MAAM+C,QAAQ,MAGzB8/H,EAAW7iI,MAAMqB,OAAO,KAE1BwhI,EAAW7iI,MAAMrG,SAAS,QAC1B,KAAKgyH,SAASkX,EAAWnpI,aACzB,KAAKgyH,UAAUkX,EAAiBtzF,aAElC,KAAKu7E,QAAS1pH,SAAd;QA/BM;QAuCR++H,0BAAuB;AAGrB,gBAAM9oI,IAAY,KAAKqkH,YACjBhvF,IAAO,KAAK8zG,QAASh+H,sBAAd;AASbnL,YAAUgc,UAPR,KAAKujD,oBAA4BptD,8CAASX,OACtCxR,EAAU2pB,UAAU0L,EAAKhzB,QACzBrC,EAAU2pB,SAEd,KAAK41C,oBAA4BptD,8CAASH,MACtChS,EAAUypB,UAAU4L,EAAK9yB,SACzBvC,EAAUypB,OAChB;AAIOvlC,kDAAU8b,CAAjB;QAjBqB;QAqBvB8mI,iBAAc;AACZ,eAAKyD,gBAAgB,IAArB;QADY;QASd3jC,eAAY;AACV,mBAASxqG,IAAI,GAAGA,IAAI,KAAKgtI,UAAUttI,QAAQM,KAAK;AAG9C,kBAAMsvI,IAFQ,KAAKtC,UAAUhtI,CAAfwE;AAGV8qI,cAAgB9kC,gBAClB8kC,EAAgB9kC,aAAhB;UAL4C;QADtC;QAgBZsL,mBAAgB;AAEZ,eAAKo3B,iBACL,KAAKA,cAAchwI,aAAnB,KACA,KAAKgwI,cAAchuC,YAAnB,EAAiCx/F,UAEjC,KAAK23H,QAASzmI,KAAK,KAAKs8I,cAAchuC,YAAnB,CAAnB;QANY;QAehB5iD,WAAWrrD,GAAkB;AACvB,eAAKmhH,eAAenhH,MAIxB,KAAK87I,QAASvgI,MAAMkB,UAAUzc,IAAY,UAAU,QACpD,KAAKmhH,aAAanhH,GAGlB,KAAKg3H,WAAW/4C,kBAAhB;QAT2B;QAkB7BiqC,SAASH,GAAwB;AAC3B,WAACA,KAAmB,KAAKqe,WAAW,KAAKA,QAAQr4D,aACnD,KAAK0rE,eAAL;QAF6B;QAYjCyD,gBAAgB9L,GAA4B;AAC1C,gBAAMD,IAAU,KAAK8K;AAGjB7K,WAAAA,KAAYD,CAAAA,KACbC,KAAY,CAAAllI,oFAAwBklI,CAAxB,MAKX,KAAKkN;YAAoBnN;YAASC;UAAlC,KAA0D,SAAZD,KAChD,KAAKoN,cAAcpN,CAAnB,GAGE,KAAKqN,kBAAkBrN,GAASC,CAAhC,KAAwD,SAAZA,KAC9C,KAAKqN,YAAYtN,GAASC,CAA1B,GAGF,KAAKsN,cAAcvN,GAASC,CAA5B,GACA,KAAKuN,iBAAiBxN,GAASC,CAA/B;QAnB0C;QA6BlCkN,oBACRnN,GACAC,GAAsC;AAItC,iBACc,SAAZD,MAAqB,CAACA,EAAQmF,cAAR,KAA2BnF,MAAYC;QALzB;QAgB9BoN,kBACRrN,GACAC,GAAsC;AAGtC,iBAAmB,SAAZA,KAAoBA,MAAYD;QAHD;QAY9BoN,cAAc17H,GAA4B;AAClD,eAAKo5H,gBAAgB;AACrB,eAAKD,0BAA0Bn5H;AAC/BA,YAAK5O,YAAY,KAAjB;AACK5W,qDACH,KAAKw+I,cACA/gG,wCAAMge,kBACX,EAHF;QAJkD;QAiB1C2lF,YACRtN,GACAC,GAA+B;AAE/B,eAAK6K,gBAAgB7K;AACrB,eAAK4K,0BAA0B7K;AAC/BC,YAAQn9H,YAAY,IAApB;AACK5W,qDACH,KAAKw+I,cACA/gG,wCAAMge,kBACXs4E,EAAQtqH,MAAR,CAHF;QAL+B;QAiBjC83H,qBAAqBliI,GAAgB;AACpB,eAAXA,KAAiBA,IAAW,KAAKq/H,UAAUttI,WACvCoU,IAAO,KAAKk5H,UAAUr/H,CAAf,GACTmG,EAAK5W,aAAL,KACF,KAAKixI,gBAAgBr6H,CAArB;QAJ+B;QAe3B67H,cACRvN,GACAC,GAAsC;AAGnCA,gBACAD,MAAYC,KAAYA,EAAQkF,cAAR,MACxBlF,EAAQnjC,YAAR,EAAsBx/F,UAIvB,KAAK23H,QAASzmI,KAAKyxI,EAAQnjC,YAAR,CAAnB,GACA,KAAKm4B,QAASxpF,cAAd,KAHA,KAAKwpF,QAASlmI,KAAd;QAPoC;QAoBhCy+I,iBACNxN,GACAC,GAAsC;AAEtC,gBAAMyN,IAAa1N,KAAWA,EAAQpnH,QAAR;cAC1B8Q,IAAau2G,KAAWA,EAAQrnH,QAAR;AAExBonH,gBAAYC,MACdv2G,IAAa;AAETvsB,cAAQ,KAAgBpY,wCAAegsD,uDAA1B,GACjB28F,GACAhkH,GACA,KAAKm8F,WAAWvkH,EAHJ;AAKHhd,mDAAK6Y,CAAhB;QAbsC;QAqBhCgvI,gBAAa;AACnB,iBAAK,KAAKrB,gBAKR,KAAKA,cAAc3F,cAAnB,KACC,KAAK2F,cAA0CrC,WAA/C,KAEuB,KAAKqC,cACbN,eAAhB,GACO,QAEP,KAAKM,cAAc9oI,UAAnB,KACA,KAAK8oI,cAAc9oI,UAAnB,EAAgClH,aAAhC,KAEA,KAAKixI,gBAAgB,KAAKjB,cAAc9oI,UAAnB,CAArB,GACO,QAEF,QAjBE;QAFU;QA4BboqI,eAAY;AAClB,cAAI,CAAC,KAAKtB,iBAAiB,CAAC,KAAKA,cAAc3F,cAAnB;AAC1B,mBAAO;AAET,gBAAMwI,IAAkB,KAAK7C;AACxB6C,YAAgBlF,WAAhB,IAIH,KAAKwD,YAAL,IAHA0B,EAAgBnD,eAAhB;AACA,iBAAO;QAPS;QAmBZyB,cAAW;AACjB,cAAI,CAAC,KAAKnB;AACR,mBAAO;AAGT,cAAI8C,IAAc,KAAKhD,UAAUrmI,QAAQ,KAAKumI,aAA5B,IAA6C;AAC/D,cAAkB,KAAd8C,KAAoBA,IAAc,KAAKhD,UAAUttI,QAAQ;AAC3D,gBAAIs/F,IAAW,KAAKguC,UAAUgD,CAAf;AACf,mBAAOhxC,KAAY,CAACA,EAAS9hG,aAAT;AAClB8hG,kBAAW,KAAKguC,UAAU,EAAEgD,CAAjB;AAEb,gBAAIhxC,KAAYA,EAAS9hG,aAAT;AAEd,qBADA,KAAKixI,gBAAgBnvC,CAArB,GACO;UAPkD;AAU7D,iBAAO;QAhBU;QAwBXsvC,kBAAe;AACrB,cAAI,CAAC,KAAKpB;AACR,mBAAO;AAGT,cAAI+C,IAAc,KAAKjD,UAAUrmI,QAAQ,KAAKumI,aAA5B,IAA6C;AAC/D,cAAkB,KAAd+C,KAAoBA,IAAc,KAAKjD,UAAUttI,QAAQ;AAC3D,gBAAIwwI,IAAW,KAAKlD,UAAUiD,CAAf;AACf,mBAAOC,KAAY,CAACA,EAAShzI,aAAT;AAClBgzI,kBAAW,KAAKlD,UAAU,EAAEiD,CAAjB;AAEb,gBAAIC,KAAYA,EAAShzI,aAAT;AAEd,qBADA,KAAKixI,gBAAgB+B,CAArB,GACO;UAPkD;AAU7D,iBAAO;QAhBc;QAoBvB19I,UAAO;AACL,eAAKy1H,WAAWrpE,oBAAhB,EAAsChI,gBAAgB,SAAtD;AACA,eAAKygF,QAAS7kI,QAAd;AACA,mBAASwN,IAAI,GAAGA,IAAI,KAAKgtI,UAAUttI,QAAQM;AACrB,iBAAKgtI,UAAUhtI,CAAf8xC,EACRt/C,QAAZ;AAGF,eAAS8hB,IAAI,GAAGA,IAAI,KAAK64H,aAAaztI,QAAQ4U;AAC9B3rB,yDAAO,KAAKwkJ,aAAa74H,CAAlB,CAArB;AAEF,eAAK64H,eAAe,CAAA;AACpB,eAAKH,YAAY,CAAA;AAEb,eAAKD,YACP,KAAK9kB,WAAW56E,gBAAhB,EAAkCsN,YAAY,KAAKoyF,OAAnD,GACIxjJ,4CAAW,KAAKwjJ,OAApB;QAhBG;MA1/BH;AAghCFjnJ,0CAAS,iqBAAb;+CAiC2B2X,qCAAK20C,SAAkBpzC,yCAAS6tI,8CAA3D;AApmCA,UAAAl6F,wCAAA,CAAA;AAmDak6F,4CAAAA,UAAAA;AnNyKN,UAAMsD,yCAAU,UAiBV/4E,6CAAcD,sDAAeC,aAK7BC,8CAAeF,sDAAeE,cAK9BC,gDAAiBH,sDAAeG,gBAKhCC,oDAAqBJ,sDAAeI,oBAOpC64E,gDAAyBr6H,8CAASH,KAKlCy6H,mDAA4Bt6H,8CAASG,QAKrCo6H,iDAA0Bv6H,8CAASX,MAKnCm7H,kDAA2Bx6H,8CAASE,OAgBpCnuB,2CAAmBA,yCAmBnBL,kDAA0BA,gDAK1BE,6CAAqBA,2CASrBM,2DAAmCA,yDAWnCJ,oDAA4BA,kDAG5BojH,gDAAmCA,0DACnCC,+CAAkCA,yDAClCC,oDAAuCA,8DACvCC,oDAAuCA,8DACvCnrD,sDAAiCA,uDACjCC,sDAAiCA,uDAOjCswF,wDAA2CpvF,gDAO3CqvF,gEACMrvF,wDAMNsvF,yDAA6CtvF;AAM1DksD,iDAAUz9E,UAAUnN,WAAWiuH,SAC7B74G,GACAkpB,GAAe;AAEf,eAAO,IAAIgzC,mCAAM,MAAMl8D,GAAekpB,CAA/B;MAFQ;AAKjB3V,wDAAaxb,UAAUnN,WAAWkuH,SAChC94G,GACAkpB,GAAe;AAEf,eAAO,IAAIjZ,0CAAS,MAAMjQ,GAAekpB,CAAlC;MAFQ;iDAKPnxB,UAAUlR,aAAakyH,SAC/BntI,GAAW;AAEX,eAAO,IAAawyB,mEAAiB,MAAMxyB,CAApC;MAFI;AAKb2nC,wDAAaxb,UAAUlR,aAAamyH,SAClCptI,GAAW;AAEX,eAAO,IAAauyB,oFAAyB,MAAMvyB,CAA5C;MAFI;AAKb2nC,wDAAaypE,cAAci8B,SAAUntI,GAAuB;AAC1D,eAAO,IAAIm+G,yCAASn+G,CAAb;MADmD;+EAIxCisB,UAAU0+C,kBAAkByiE,SAC9CnyI,GAAgB;AAEhB,eAAO,IAAIwsC,kDAAaxsC,CAAjB;MAFS;AAKlB0hC,QAAAA,mCAAM1Q,UAAUoR,qBAAqBgwG,SAEnCrtI,GAAoB;AAEd8W,YAAwBniB,gDAAcqL,CAAzB;AAEbstI,YAAsBx2H,EAAW,CAAX,EAAcxY,OAAOwY,EAAW,CAAX,CAArB;AAC5B,iBAAS1a,IAAI,GAAGA,IAAIkxI,EAAoBxxI,QAAQM;AAC9C,eAAKgb,QAAQk2H,EAAoBlxI,CAApB,EAAuB,CAAvB,GAA2BugC,EAAAA,mCAAMskC,SAASa,SAAvD;MANkB;UA6DTyrE,6CAAcC,mCApd3Bz+F,gCAAA,CAAA;AAicQwqD,oCAAAA,UAAAA;AACA6c,oCAAAA,cAAAA;AACAhmB,oCAAAA,QAAAA;AAEAjsD,oCAAAA,WAAAA;AACA1gC,oCAAAA,SAAAA;oCAhHK64C,uBAAAA;AADAD,oCAAAA,uBAAAA;AAJAgrD,oCAAAA,iBAAAA;AA4KLopB,oCAAAA,gBAAAA,EAAAA;AArDAqX,oCAAAA,6BAAAA;oCACAx1F,mBAAAA;AACAipC,oCAAAA,aAAAA;AAEAksB,oCAAAA,oBAAAA;AACA7zC,oCAAAA,eAAAA;AAFAL,oCAAAA,iBAAAA;oCAvCAk6E,cAAAA;AACAC,oCAAAA,mBAAAA;AAyCAziG,oCAAAA,sBAAAA;AAxCA0iG,oCAAAA,MAAAA;AA0CAx3B,oCAAAA,SAAAA;AA5HK3O,oCAAAA,qBAAAA;oCA6HLuW,aAAAA;AAEAP,oCAAAA,aAAAA;AACK+vB,oCAAAA,cAAAA;AA7CLK,oCAAAA,SAAAA;AACAC,oCAAAA,aAAAA;AA6CA/gH,oCAAAA,QAAAA;oCAENwuG,gBAAAA;AAMA1gG,oCAAAA,gBAAAA;AAQMsvF,oCAAAA,aAAAA;AACAthC,oCAAAA,aAAAA;AACAyyC,oCAAAA,yBAAAA;oCAENxB,cAAAA;AAMApN,oCAAAA,iBAAAA;AAMA4M,oCAAAA,gBAAAA;AAKMvF,oCAAAA,SAAAA;AACAp7B,oCAAAA,eAAAA;oCACA86B,uBAAAA;AAEA/C,oCAAAA,YAAAA,EAAAA;AACAxsF,oCAAAA,UAAAA;AACA4E,oCAAAA,OAAAA;AACAyoE,oCAAAA,mBAAAA;AApRK99C,oCAAAA,cAAAA;oCA6SLy1B,QAAAA;AAEAqY,oCAAAA,yBAAAA;AACAmuB,oCAAAA,2BAAAA;AAaAzZ,oCAAAA,SAAAA;AACA9sD,oCAAAA,gBAAAA;oCAEAt7B,OAAAA;AACAK,oCAAAA,WAAAA;AACAm2F,oCAAAA,iBAAAA;AACAruG,oCAAAA,MAAAA,EAAAA;AAzTK29C,oCAAAA,iBAAAA;AA0TL/2B,oCAAAA,QAAAA,EAAAA;oCA/NK2qE,gBAAAA;AAhGA7zC,oCAAAA,eAAAA;AAgULzrB,oCAAAA,UAAAA;AAtTK2rB,oCAAAA,qBAAAA;AA+GAm5E,oCAAAA,0BAAAA;oCA8DL58B,aAAAA;AAtFK3I,oCAAAA,qBAAAA;AAgOLyP,oCAAAA,qBAAAA;AAEArlG,oCAAAA,YAAAA;AACA24B,oCAAAA,gBAAAA;oCA3IAwjG,gBAAAA;AA4IAxqG,oCAAAA,mBAAAA;AA/SKmpG,oCAAAA,oBAAAA;AAKAC,oCAAAA,kBAAAA;AAKAC,oCAAAA,mBAAAA;oCAfAH,iBAAAA;AAqTL11B,oCAAAA,oBAAAA;AACA75C,oCAAAA,QAAAA;AACAqpC,oCAAAA,eAAAA;AA9IAynC,oCAAAA,SAAAA;AA+IA9E,oCAAAA,UAAAA;oCACAnF,kBAAAA;AACAZ,oCAAAA,cAAAA;AACA0E,oCAAAA,mBAAAA;AAjJAoG,oCAAAA,UAAAA;AACAC,oCAAAA,QAAAA;AAiJA9vB,oCAAAA,WAAAA;oCA1GoCnhF,uBAAAA;AAxH/B4vG,oCAAAA,yBAAAA;AAOAC,oCAAAA,iCAAAA;AAxIAN,oCAAAA,UAAAA;AAoWL/jC,oCAAAA,cAAAA;oCACAxzF,gBAAAA;AAlJA+6F,oCAAAA,YAAAA;AACAE,oCAAAA,mBAAAA;AAkJAsB,oCAAAA,iBAAAA;AAjJA28B,oCAAAA,YAAAA;AAkJAxkC,oCAAAA,YAAAA;oCACAgC,iBAAAA;AACA/1C,oCAAAA,mBAAAA;AACAluB,oCAAAA,eAAAA;AApJA0mG,oCAAAA,MAAAA;AAqJAj0F,oCAAAA,eAAAA;AApJAk0F,oCAAAA,kBAAAA;oCACAC,iBAAAA;AAjBAz6D,oCAAAA,gBAAAA;AAoCA06D,oCAAAA,UAAAA;AAlBAC,oCAAAA,cAAAA;AACAC,oCAAAA,YAAAA;AAyBArhG,oCAAAA,WAAAA;oCAxBAshG,SAAAA;AAiJAz/G,oCAAAA,SAAAA,EAAAA;AAhJAs/B,oCAAAA,YAAAA;AArHKjqE,oCAAAA,4BAAAA;AAsHLqqJ,oCAAAA,SAAAA;AAyBAz8E,oCAAAA,WAAAA;oCAxBA08E,gBAAAA;AACAC,oCAAAA,QAAAA;AAtIK/qJ,oCAAAA,mBAAAA;AAKAE,oCAAAA,cAAAA;AA2NOkI,oCAAAA,YAAAA;AA3OJuN,oCAAAA,YAAAA;oCAmOR6jB,QAAAA;AA4DAh4B,oCAAAA,SAAAA;AA9CAw4B,oCAAAA,SAAAA;AAbW/mB,oCAAAA,aAAAA;AACCL,oCAAAA,cAAAA;AAIA5D,oCAAAA,cAAAA;oCAGL6C,SAAAA;AAQM1C,oCAAAA,eAAAA;AACJoG,oCAAAA,WAAAA;AAGSC,oCAAAA,oBAAAA;AACLC,oCAAAA,eAAAA;oCAEE3O,iBAAAA;AAIgBjC,oCAAAA,iCAAAA;AA/H/BwnH,oCAAAA,aAAAA;AAkBA3sE,oCAAAA,WAAAA;AAwHAsrG,oCAAAA,mBAAAA;oCAsBAC,gBAAAA;AA1BKpyF,oCAAAA,YAAAA;AAlOAz4D,oCAAAA,qBAAAA;AA5CAC,oCAAAA,YAAAA;AA2JL6qJ,oCAAAA,UAAAA;AACAC,oCAAAA,aAAAA;oCACAC,QAAAA;AACAC,oCAAAA,QAAAA;AoNhcR,UAAAngG,sCAAA,CAAA;ACAA,UAAAA,uDAAA,CAAA;ACAA,UAAAA,kDAAA,CAAA;ACAA,UAAAA,6CAAA,CAAA;ACAA,UAAAA,+CAAA,CAAA;ACAA,UAAAA,gDAAA,CAAA;ACAA,UAAAA,iDAAA,CAAA;ACAA,UAAAA,qDAAA,CAAA;ACAA,UAAAA,mDAAA,CAAA;ACAA,UAAAA,kDAAA,CAAA;ACAA,UAAAA,qDAAA,CAAA;ACAA,UAAAA,6CAAA,CAAA;ACAA,UAAAA,qDAAA,CAAA;ACAA,UAAAA,yDAAA,CAAA;ACAA,UAAAA,4CAAA,CAAA;ACAA,UAAAA,6CAAA,CAAA;ACAA,UAAAA,iDAAA,CAAA;ACAA,UAAAA,iDAAA,CAAA;ACAA,UAAAA,iDAAA,CAAA;ACAA,UAAAA,0DAAA,CAAA;ACAA,UAAAA,wDAAA,CAAA;ACAA,UAAAA,+CAAA,CAAA;ACAA,UAAAA,8DAAA,CAAA;ACAA,UAAAA,4CAAA,CAAA;ACAA,UAAAA,qDAAA,CAAA;ACAA,UAAAA,kDAAA,CAAA;ACAA,UAAAA,kEAAA,CAAA;ACAA,UAAAA,2DAAA,CAAA;ACAA,UAAAA,uDAAA,CAAA;;;;;;",
  "names": ["register", "validate", "unregister", "getItem", "hasItem", "getClass", "getObject", "getAllItems", "getClassFromOptions", "getNextUniqueId", "genUid", "getRecordUndo", "fire", "fireInternal", "fireNow", "filter", "clearPendingUndo", "isEnabled", "setGroupInternal", "getDescendantIds", "fromJson", "get", "disableOrphans", "getWorkspaceById", "getAllWorkspaces", "registerWorkspace", "unregisterWorkpace", "getMainWorkspace", "setMainWorkspace", "getSelected", "getParentContainer", "setParentContainer", "svgResize", "getBlockTypeCounts", "jsonInitFactory", "defineBlocksWithJsonArray", "defineBlocksWithJsonArrayInternal", "longStart", "longStop", "clearTouchIdentifier", "shouldHandleEvent", "getTouchIdentifierFromEvent", "checkTouchIdentifier", "conditionalBind", "bind", "unbind", "isTargetInput", "isRightButton", "mouseToSvg", "getScrollDeltaPixels", "removeElem", "inject", "createSvgElement", "addClass", "removeClasses", "removeClass", "hasClass", "removeNode", "insertAfter", "setCssTransform", "startTextWidthCache", "stopTextWidthCache", "getTextWidth", "getFastTextWidth", "getFastTextWidthWithSizeString", "measureFontMetrics", "getSize", "getSizeInternal", "getSizeWithDisplay", "getComputedStyle", "getPageOffset", "getViewportPageOffset", "getBorderBox", "scrollIntoContainerView", "getContainerOffsetToScrollInto", "getRelativeXY", "getInjectionDivXY", "getViewportBBox", "getDocumentScroll", "screenToWsCoordinates", "wsToScreenCoordinates", "injectDependencies", "domToText", "sanitizeText", "convertToolboxDefToJson", "validateToolbox", "convertFlyoutDefToJsonArray", "hasCategories", "hasCategoriesInternal", "isCategoryCollapsible", "convertToToolboxJson", "xmlToJsonArray", "addAttributes", "parseToolboxTree", "getStartPositionRect", "getCornerOppositeToolbox", "bumpPositionRect", "alert", "setAlert", "confirm", "confirmInternal", "setConfirm", "prompt", "setPrompt", "isVariableBackedParameterModel", "isLegacyProcedureDefBlock", "isLegacyProcedureCallBlock", "flyoutCategory", "flyoutCategoryBlocks", "generateUniqueName", "generateUniqueNameInternal", "generateUniqueNameFromOptions", "createVariableButtonHandler", "promptName", "nameUsedWithOtherType", "nameUsedWithAnyType", "nameUsedWithConflictingParam", "checkForConflictingParamWithProcedureModels", "checkForConflictingParamWithLegacyProcedures", "generateVariableFieldDom", "createVariable", "getAddedVariables", "queueRender", "finishQueuedRenders", "triggerQueuedRenders", "alwaysImmediatelyRender", "queueBlock", "doRenders", "dequeueBlock", "shouldRenderRootBlock", "renderBlock", "save", "append", "moveCommentToNotConflict", "commentOverlapsOtherExactly", "setRole", "setState", "isSerializable", "saveAttributes", "saveCoords", "saveExtraState", "saveIcons", "saveFields", "saveInputBlocks", "saveNextBlocks", "saveConnection", "appendInternal", "appendPrivate", "checkNewVariables", "loadCoords", "loadAttributes", "loadExtraState", "tryToConnectParent", "loadIcons", "loadFields", "loadInputBlocks", "loadNextBlocks", "loadConnection", "initBlock", "hasBubble", "toRadians", "toDegrees", "clamp", "createDom", "setBoundsElement", "getOwner", "getContentDiv", "clearContent", "setColour", "showPositionedByBlock", "showPositionedByField", "getScaledBboxOfBlock", "getScaledBboxOfField", "showPositionedByRect", "show", "getPositionBelowMetrics", "getPositionAboveMetrics", "getPositionTopOfPageMetrics", "getPositionX", "isVisible", "hideIfOwner", "hide", "hideWithoutAnimation", "positionInternal", "repositionForWindowResize", "shortestStringLength", "commonWordPrefix", "commonWordSuffix", "wrapLine", "wrapScore", "wrapMutate", "wrapToText", "setCustomTooltip", "getCustomTooltip", "getDiv", "getTooltipOfObject", "getTargetObject", "bindMouseEvents", "unbindMouseEvents", "onMouseOver", "onMouseOut", "onMouseMove", "dispose", "block", "unblock", "renderContent", "renderDefaultContent", "getPosition", "getHsvSaturation", "setHsvSaturation", "getHsvValue", "setHsvValue", "parse", "rgbToHex", "hexToRgb", "hsvToHex", "blend", "hueToHex", "tokenizeInterpolationInternal", "tokenizeInterpolation", "replaceMessageReferences", "checkMessageReferences", "parseBlockColour", "testOnly_setDiv", "hideIfOwnerIsInWorkspace", "positionWithAnchor", "calculateX", "calculateY", "isRepositionable", "getCurrentBlock", "setCurrentBlock", "populate_", "position_", "createWidget_", "haltPropagation", "workspaceToDom", "saveWorkspaceComment", "variablesToDom", "blockToDomWithXY", "fieldToDom", "allFieldsToDom", "blockToDom", "cloneShadow", "domToPrettyText", "clearWorkspaceAndLoadFromXml", "loadWorkspaceComment", "appendDomToWorkspace", "domToBlockInternal", "domToVariables", "mapSupportedXmlTags", "applyMutationTagNodes", "applyCommentTagNodes", "applyDataTagNodes", "applyFieldTagNodes", "findChildBlocks", "applyInputTagNodes", "applyNextTagNodes", "domToBlockHeadless", "domToField", "deleteNext", "isElement", "disposeUiEffect", "disposeUiStep", "connectionUiEffect", "disconnectUiEffect", "disconnectUiStep", "disconnectUiStop", "isDraggable", "deepMerge", "isProcedureBlock", "isObservable", "fromJsonInternal", "trimOptions", "applyTrim", "validateOptions", "isRegistered", "apply", "checkNoMutatorProperties", "checkXmlHooks", "checkJsonHooks", "checkMutatorDialog", "checkHasFunctionPair", "checkHasMutatorProperties", "getMutatorProperties", "mutatorPropertiesMatch", "runAfterPageLoad", "checkDropdownOptionsInTable", "extensionParentTooltip", "warn", "point", "curve", "moveTo", "moveBy", "lineTo", "line", "lineOnAxis", "arc", "allProcedures", "procTupleComparator", "isLegalName", "isNameUsed", "updateMutatorFlyout", "mutatorOpenListener", "mutatorChangeListener", "getCallers", "blockIsModernCallerFor", "isDynamicShape", "isPuzzleTab", "isNotch", "connectReciprocally", "getSingleConnection", "getConnectionForOrphanedOutput", "isIcon", "isCommentIcon", "getParentConnection", "init", "stringButtonClickHandler", "numberButtonClickHandler", "colourButtonClickHandler", "resizeSvgContents", "moveBlockToNotConflict", "blockOverlapsOtherExactly", "blockIsInSnapRadius", "bumpObjectIntoBounds", "bumpIntoBoundsHandler", "extractObjectFromEvent", "bumpTopObjectsIntoBounds", "isDeletable", "copyInternal", "paste", "pasteFromData", "duplicateInternal", "isCopyable", "registerEscape", "registerDelete", "registerCopy", "registerCut", "registerPaste", "registerUndo", "registerRedo", "registerDefaultShortcuts", "saveProcedure", "loadProcedure", "load", "createMainWorkspace", "onKeyDown", "bindDocumentEvents", "loadSounds", "registerCleanup", "toggleOption_", "registerCollapse", "registerExpand", "addDeletableBlocks_", "getDeletableBlocks_", "deleteNext_", "registerDeleteAll", "registerWorkspaceOptions_", "registerDuplicate", "registerComment", "registerInline", "registerCollapseExpandBlock", "registerDisable", "registerHelp", "registerCommentDelete", "registerCommentDuplicate", "registerCommentCreate", "pixelsToWorkspaceCoords", "registerBlockOptions_", "registerCommentOptions", "registerDefaultOptions", "isPaster", "isRenderedElement", "isSelectable", "isSelectableToolboxItem", "hideChaff", "type", "name", "registryItem", "opt_allowOverrides", "Type", "trim", "Error", "toLowerCase", "caselessName", "typeRegistry", "typeMap", "nameRegistry", "nameMap", "Object", "create", "String", "FIELD", "console", "opt_throwIfMissing", "msg", "opt_cased", "casedRegistry", "key", "keys", "options", "plugin", "plugins", "DEFAULT", "nextId", "toString", "internal", "setRecordUndo", "newValue", "recordUndo", "event", "TEST_ONLY", "FIRE_QUEUE", "length", "requestAnimationFrame", "setTimeout", "e", "push", "queue", "i", "workspaceId", "eventWorkspace", "fireChangeListener", "workspaceIds", "Set", "map", "undoStack", "getUndoStack", "group", "undefined", "events", "splice", "queueIn", "forward", "slice", "reverse", "mergedQueue", "hash", "isNull", "isUiEvent", "UI", "blockId", "join", "lastEntry", "lastEvent", "index", "MOVE", "moveEvent", "newParentId", "newInputName", "newCoordinate", "reason", "reasonSet", "concat", "Array", "from", "CHANGE", "element", "VIEWPORT_CHANGE", "viewportEvent", "viewTop", "viewLeft", "scale", "oldScale", "CLICK", "BUBBLE_OPEN", "unshift", "disable", "disabled", "enable", "getGroup", "setGroup", "state", "ids", "descendants", "getDescendants", "descendant", "id", "json", "workspace", "eventClass", "eventType", "EVENT", "CREATE", "getBlockById", "initialUndoFlag", "parent", "getParent", "hasDisabledReason", "ORPHANED_BLOCK_DISABLED_REASON", "children", "child", "setDisabledReason", "outputConnection", "previousConnection", "isDragging", "getNextBlock", "WorkspaceDB_", "workspaces", "mainWorkspace", "selected", "setSelected", "newSelection", "SELECTED", "unselect", "select", "parentContainer", "newParent", "parentWorkspace", "svg", "getParentSvg", "cachedSize", "getCachedParentSvgSize", "div", "parentElement", "HTMLElement", "width", "offsetWidth", "height", "offsetHeight", "setAttribute", "setCachedParentSvgSize", "resize", "opt_stripFollowing", "typeCountsMap", "nextBlock", "indexOf", "checkBlock", "jsonDef", "jsonInit", "jsonArray", "defineBlocks", "createBlockDefinitionsFromJsonArray", "blocks", "elem", "definition", "Blocks", "gesture", "longPid_", "handleRightClick", "LONGPRESS", "clearTimeout", "touchIdentifier_", "startsWith", "PointerEvent", "pointerId", "identifier", "node", "thisObject", "func", "opt_noCaptureIdentifier", "wrapFunc", "call", "bindData", "TOUCH_MAP", "addEventListener", "callback", "pop", "removeEventListener", "target", "isContentEditable", "getAttribute", "HTMLInputElement", "HTMLTextAreaElement", "ctrlKey", "MAC", "button", "matrix", "svgPoint", "createSVGPoint", "x", "clientX", "y", "clientY", "getScreenCTM", "inverse", "matrixTransform", "deltaMode", "deltaX", "deltaY", "LINE_MODE_MULTIPLIER", "PAGE_MODE_MULTIPLIER", "arr", "value", "cssContent", "injected", "content", "hasCss", "pathToMedia", "mediaPath", "replace", "cssNode", "document", "createElement", "cssTextNode", "createTextNode", "appendChild", "head", "insertBefore", "firstChild", "attrs", "opt_parent", "createElementNS", "SVG_NS", "className", "classNames", "split", "every", "classList", "contains", "add", "remove", "parentNode", "removeChild", "newNode", "refNode", "siblingNode", "nextSibling", "transform", "style", "cacheReference", "cacheWidths", "textElement", "textContent", "baseVal", "getComputedTextLength", "fontSize", "fontWeight", "fontFamily", "text", "canvasContext", "computeCanvas", "body", "getContext", "font", "measureText", "span", "display", "position", "top", "left", "result", "baseline", "alignItems", "offsetTop", "originalDisplay", "originalVisibility", "visibility", "originalPosition", "Size", "property", "styles", "window", "getPropertyValue", "el", "pos", "Coordinate", "box", "getBoundingClientRect", "documentElement", "scrollCoord", "pageXOffset", "scrollLeft", "pageYOffset", "scrollTop", "parseFloat", "right", "bottom", "Rect", "container", "opt_center", "offset", "elementPos", "containerPos", "containerBorder", "relX", "relY", "elementSize", "spaceX", "clientWidth", "spaceY", "clientHeight", "Math", "min", "max", "xy", "parseInt", "r", "match", "XY_REGEX", "Number", "includes", "styleComponents", "XY_STYLE_REGEX", "scrollOffset", "win", "ws", "screenCoordinates", "screenX", "screenY", "boundingRect", "getInjectionDiv", "injectionDiv", "clientOffsetPixels", "mainOffsetPixels", "getOriginOffsetInPixels", "difference", "finalOffsetPixels", "finalOffsetMainWs", "workspaceCoordinates", "mainOffset", "dependencies", "DOMParser", "XMLSerializer", "domParser", "xmlSerializer", "tagName", "NAME_SPACE", "textToDom", "doc", "parseFromString", "getElementsByTagName", "nodeName", "dom", "serializeToString", "INVALID_CONTROL_CHARS", "charCodeAt", "toolboxDef", "Element", "toolboxJson", "toolboxKind", "toolboxContents", "FLYOUT_TOOLBOX_KIND", "CATEGORY_TOOLBOX_KIND", "flyoutDef", "isArray", "nodeType", "item", "toUpperCase", "categories", "categoryInfo", "contents", "Node", "childNodes", "obj", "j", "attributes", "attr", "parsedToolboxDef", "TypeError", "size", "horizontalPadding", "verticalPadding", "metrics", "hasVerticalScrollbar", "scrollbar", "canScrollVertically", "horizontal", "horizontalPosition", "LEFT", "absoluteMetrics", "RTL", "Scrollbar", "scrollbarThickness", "viewMetrics", "vertical", "verticalPosition", "TOP", "canScrollHorizontally", "toolboxMetrics", "Position", "horizontalLayout", "RIGHT", "BOTTOM", "startRect", "margin", "bumpDir", "savedPositions", "otherEl", "intersects", "bumpDirection", "UP", "message", "opt_callback", "alertImplementation", "alertFunction", "confirmImplementation", "confirmFunction", "defaultValue", "promptImplementation", "promptFunction", "param", "getVariableModel", "getProcedureDef", "getProcedureCall", "renameProcedure", "allUsedVarModels", "getAllBlocks", "variables", "blockVariables", "getVarModels", "variable", "getId", "values", "allDeveloperVariables", "getDeveloperVariables", "devVars", "xmlList", "registerButtonCallback", "getTargetWorkspace", "blockList", "variableModelList", "getVariablesOfType", "mostRecentVariable", "sort", "VariableModel", "compareByName", "VAR_LETTER_OPTIONS", "charAt", "getAllVariableNames", "startChar", "usedNames", "letters", "suffix", "letterIndex", "inUse", "potName", "opt_type", "promptAndCheckWithAlert", "defaultName", "Msg", "existing", "renameVariable", "promptText", "newName", "procedure", "renameVariableById", "defaultText", "newVar", "allVariables", "getVariableMap", "getAllVariables", "oldName", "getProcedureMap", "getProcedures", "procedures", "params", "getParameters", "procHasOld", "some", "procHasNew", "getName", "def", "blockHasOld", "blockHasNew", "variableModel", "field", "getOrCreateVariablePackage", "opt_name", "getVariable", "potentialVariableMap", "getPotentialVariableMap", "getVariableById", "isFlyout", "targetWorkspace", "originalVariables", "allCurrentVariables", "addedVariables", "Promise", "resolve", "afterRendersPromise", "afterRendersResolver", "animationRequestId", "cancelAnimationFrame", "JavaFx", "dirtyBlocks", "eventGroups", "set", "rootBlocks", "b", "has", "resizeContents", "blockOrigin", "getRelativeToSurfaceXY", "updateComponentLocations", "oldGroup", "newGroup", "bumpNeighbours", "delete", "getChildren", "isDisposed", "initialized", "renderEfficiently", "serializer", "SERIALIZER", "comment", "addCoordinates", "saveIds", "loc", "getWidth", "getText", "isCollapsed", "collapsed", "isOwnEditable", "editable", "isOwnMovable", "movable", "isOwnDeletable", "deletable", "prevRecordUndo", "newComment", "setText", "defaultLoc", "defaultSize", "setSize", "setCollapsed", "setEditable", "setMovable", "setDeletable", "paster", "PASTER", "coord", "otherCoords", "getTopComments", "otherComment", "c", "sum", "translate", "translateDistance", "otherCoord", "abs", "roleName", "ROLE_ATTRIBUTE", "stateName", "ARIA_PREFIX", "saveState", "loadState", "addInputBlocks", "addNextBlocks", "doFullSerialization", "isInsertionMarker", "getDisabledReasons", "inputsInline", "inputsInlineDefault", "data", "round", "extraState", "mutationToDom", "icons", "icon", "getIcons", "getType", "fields", "inputList", "input", "fieldRow", "inputs", "connection", "connectionState", "nextConnection", "shadow", "getShadowState", "targetBlock", "isShadow", "rendered", "parentConnection", "existingGroup", "variablesBeforeCreation", "BLOCK_CREATE", "blockSvg", "disposed", "setConnectionTracking", "MissingBlockType", "newBlock", "setShadow", "newVariables", "thisVariable", "VAR_CREATE", "MANUALLY_DISABLED", "setInputsInline", "domToMutation", "getSourceBlock", "RealChildOfShadow", "inputTypes", "VALUE", "childConnection", "MissingConnection", "connect", "connected", "checker", "connectionChecker", "BadConnectionCheck", "getErrorMessage", "canConnectWithReason", "iconTypes", "iconType", "iconState", "getIcon", "constructor", "ICON", "UnregisteredIcon", "addIcon", "fieldName", "fieldState", "getField", "inputName", "getInput", "setShadowState", "initSvg", "onLocationChange", "initModel", "bubbleIsVisible", "setBubbleVisible", "angleDegrees", "PI", "angleRadians", "lowerBound", "number", "upperBound", "temp", "querySelector", "arrow", "opacity", "transition", "ANIMATION_TIME", "boundsElem", "boundsElement", "owner", "backgroundColour", "borderColour", "backgroundColor", "borderColor", "opt_onHide", "opt_secondaryYOffset", "positionToField", "getSvgRoot", "scaledHeight", "scaledWidth", "bBox", "getScaledBBox", "primaryX", "primaryY", "secondaryY", "sourceBlock", "newOwner", "rtl", "secondaryX", "onHide", "direction", "renderedClassName", "getRenderer", "getClassName", "themeClassName", "getTheme", "boundsInfo", "divSize", "xCoords", "initialX", "divX", "initialY", "finalX", "finalY", "PADDING_Y", "arrowX", "arrowY", "ARROW_SIZE", "BORDER_SIZE", "arrowAtTop", "arrowVisible", "sourceX", "boundsLeft", "boundsRight", "divWidth", "relativeArrowX", "horizPadding", "ARROW_HORIZONTAL_PADDING", "divOwner", "opt_withoutAnimation", "animateOutTimer", "markFocused", "getPositionMetrics", "floor", "array", "reduce", "a", "opt_shortest", "wordPrefix", "len", "letter", "substr", "wrap", "limit", "lines", "words", "score", "lastText", "lineCount", "lastScore", "wordBreaks", "steps", "insertedBreaks", "lineLengths", "linePunctuation", "maxLength", "pow", "bestScore", "bestBreaks", "mutatedWordBreaks", "mutatedScore", "isNumber", "str", "test", "customFn", "customTooltip", "visible", "containerDiv", "object", "tooltip", "mouseOverWrapper_", "mouseOutWrapper_", "blocked", "newElement", "currentTarget", "poisonedElement", "mouseOutPid", "_e", "showPid", "dx", "lastX", "pageX", "dy", "lastY", "pageY", "sqrt", "RADIUS_OK", "HOVER_MS", "tip", "LIMIT", "windowWidth", "windowHeight", "anchorX", "OFFSET_X", "anchorY", "OFFSET_Y", "scrollY", "MARGINS", "scrollX", "hsvSaturation", "newSaturation", "hsvValue", "hex", "names", "substring", "rgb", "g", "colour", "h", "s", "v", "red", "green", "blue", "sextant", "remainder", "val1", "val2", "val3", "colour1", "colour2", "factor", "hex1", "hex2", "rgb1", "rgb2", "hue", "parseInterpolationTokens", "tokenizeNewlines", "tokens", "chars", "buffer", "rawKey", "keyUpper", "bklyKey", "rawValue", "prototype", "mergedTokens", "interpolatedResult", "validSoFar", "msgTable", "m", "msgKey", "dereferenced", "isNaN", "errorMsg", "newDiv", "containerClassName", "newDispose", "Field", "ownerWorkspace", "rendererWorkspace", "rendererClassName", "oldOwner", "oldOwnerWorkspace", "viewportBBox", "anchorBBox", "widgetSize", "currentBlock", "dummyOwner", "menu", "menu_", "focus", "Menu", "Role", "MENU", "option", "menuItem", "MenuItem", "setRightToLeft", "MENUITEM", "addChild", "setEnabled", "enabled", "onAction", "actionHandler", "scope", "menuSize", "menuDom", "render", "preventDefault", "stopPropagation", "callbackFactory", "config", "snapRadius", "skipId", "treeXml", "variablesElement", "hasChildNodes", "getTopBlocks", "variableList", "opt_noId", "DocumentFragment", "toXml", "fieldDom", "mutation", "hasAttributes", "commentText", "getCommentText", "IconType", "COMMENT", "getBubbleSize", "pinned", "commentElement", "dataElement", "empty", "DUMMY", "END_ROW", "childBlock", "STATEMENT", "childShadow", "getShadowDom", "childElem", "NodeType", "ELEMENT_NODE", "encodeURIComponent", "nextElem", "nextShadow", "cloneNode", "textNode", "removeAttribute", "TEXT_NODE", "blob", "indent", "xml", "setResizesEnabled", "clear", "blockIds", "domToWorkspace", "newBlockIds", "variablesFirst", "xmlChild", "xmlChildElement", "blockX", "blockY", "FINISHED_LOADING", "RenderedWorkspaceComment", "WorkspaceComment", "w", "getBlocksBoundingBox", "bbox", "farY", "topX", "newLeftX", "Infinity", "newRightX", "newY", "blockXY", "offsetY", "ySeparation", "offsetX", "domToBlock", "xmlBlock", "topBlock", "topBlockSvg", "xmlVariables", "childNodeMap", "next", "xmlChildren", "shouldCallInitSvg", "setCommentText", "setBubbleSize", "xmlNode", "childBlockElement", "childShadowElement", "prototypeName", "childBlockInfo", "setShadowDom", "isConnected", "connectedToParentNext", "outerHTML", "xmlChildNameMap", "inline", "disabledReasons", "decodeURIComponent", "fromXml", "svgGroup", "getAudioManager", "play", "clone", "getLayerManager", "appendToAnimationLayer", "cloneRect", "Date", "rect", "start", "percent", "getTime", "getSvgXY", "ripple", "Svg", "CIRCLE", "scaleAnimation", "ANIMATE", "opacityAnimation", "beginElement", "getHeightWidth", "magnitude", "atan", "DISPLACEMENT", "wobblingBlock", "DURATION", "skew", "sin", "WIGGLES", "val", "disconnectPid", "getTranslation", "isMovable", "startDrag", "drag", "endDrag", "revertDrag", "source", "getProcedureModel", "doProcedureUpdate", "isProcedureDef", "startPublishing", "stopPublishing", "fieldClass", "fieldObject", "hasImages", "trimmedOptions", "label", "alt", "stringLabels", "shortest", "prefixLength", "suffixLength", "prefix", "foundError", "tuple", "error", "src", "initFn", "allExtensions", "registerMixin", "mixinObj", "mixin", "registerMutator", "opt_helperFn", "opt_blockList", "errorPrefix", "hasMutatorDialog", "setMutator", "MutatorIcon", "isMutator", "extensionFn", "mutatorProperties", "mutationName", "properties", "compose", "decompose", "func1", "func2", "hasXmlHooks", "hasJsonHooks", "oldProperties", "newProperties", "fn", "readyState", "readyStateCheckInterval", "setInterval", "clearInterval", "buildTooltipForDropdown", "dropdownName", "lookupTable", "blockTypesChecked", "setTooltip", "getFieldValue", "dropdown", "FieldDropdown", "isOptionListDynamic", "getOptions", "buildTooltipWithFieldText", "msgTemplate", "tooltipWhenNotConnected", "getInputsInline", "deprecationDate", "deletionDate", "opt_use", "previousWarnings", "command", "points", "flags", "radius", "iconConstructor", "root", "proceduresNoReturn", "p", "getReturnTypes", "pa", "getBlocksByType", "forEach", "proceduresReturn", "ta", "tb", "localeCompare", "sensitivity", "findLegalName", "isInFlyout", "opt_exclude", "Names", "equals", "excludeModel", "model", "rename", "UnattachedFieldError", "legalName", "setName", "getValue", "procedureBlock", "populateProcedures", "procedureList", "templateName", "args", "arg", "nameField", "xmlElement", "argBlock", "argValue", "DEFAULT_ARG", "fieldContent", "updateToolbox", "bubbleType", "isOpen", "TYPE", "getWorkspace", "addChangeListener", "BLOCK_DELETE", "BLOCK_CHANGE", "BLOCK_FIELD_INTERMEDIATE_CHANGE", "procName", "mutateCallers", "defBlock", "oldRecordUndo", "callers", "caller", "oldMutation", "oldMutationDom", "newMutationDom", "newMutation", "getDefinition", "shape", "isDynamic", "pathDown", "pathUp", "pathLeft", "pathRight", "first", "second", "targetConnection", "orphanBlock", "foundConnection", "output", "typeChecker", "getConnectionChecker", "canConnect", "startBlock", "initView", "getWeight", "applyColour", "hideForInsertionMarker", "updateEditable", "updateCollapsed", "isShownWhenCollapsed", "setOffsetInBlock", "onClick", "topConnection", "rendererClass", "RENDERER", "theme", "opt_rendererOverrides", "renderer", "firstVariable", "bumpOffset", "otherBlock", "getConnections_", "closest", "bounds", "objectMetrics", "getBoundingRectangle", "newYPosition", "leftClamp", "rightClamp", "newXPosition", "metricsManager", "getMetricsManager", "hasFixedEdges", "BUMP_EVENTS", "scrollMetricsInWsCoords", "getScrollMetrics", "wasBumped", "BLOCK_MOVE", "getRootBlock", "COMMENT_CREATE", "COMMENT_MOVE", "getCommentById", "commentId", "topBlocks", "getTopBoundedElements", "toCopy", "toCopyData", "stashedCopyData", "stashedWorkspace", "copyData", "coordinate", "getRootWorkspace", "toDuplicate", "ShortcutRegistry", "registry", "escapeAction", "ESCAPE", "preconditionFn", "readOnly", "keyCodes", "KeyCodes", "ESC", "deleteShortcut", "DELETE", "Gesture", "inProgress", "BlockSvg", "checkAndDelete", "BACKSPACE", "ctrlC", "createSerializedKey", "C", "CTRL", "altC", "ALT", "metaC", "META", "copyShortcut", "COPY", "copyWorkspace", "copyCoords", "ctrlX", "X", "altX", "metaX", "cutShortcut", "CUT", "ctrlV", "V", "altV", "metaV", "pasteShortcut", "PASTE", "getViewMetrics", "viewportRect", "centerCoords", "ctrlZ", "Z", "altZ", "metaZ", "undoShortcut", "UNDO", "undo", "ctrlShiftZ", "SHIFT", "altShiftZ", "metaShiftZ", "ctrlY", "Y", "redoShortcut", "REDO", "proc", "parameters", "procedureModelClass", "parameterModelClass", "entries", "insertParameter", "serializerMap", "deserializers", "priority", "WorkspaceSvg", "deserializer", "pluginState", "opt_options", "containerElement", "getElementById", "ownerDocument", "Options", "subContainer", "tabIndex", "State", "LABEL", "SVG", "HTML_NS", "XLINK_NS", "defs", "DEFS", "rnd", "random", "gridPattern", "Grid", "gridOptions", "wsOptions", "zoomOptions", "startScale", "languageTree", "flyout", "addFlyout", "hasTrashcan", "addTrashcan", "controls", "addZoomControls", "getThemeManager", "subscribe", "workspaceResizeHandler", "hideComponents", "setResizeHandlerWrapper", "toolbox", "getToolbox", "getFlyout", "scrollToStart", "trashcan", "zoomControls_", "moveOptions", "scrollbars", "ScrollbarPair", "setMetrics", "hasSounds", "documentEventsBound", "updateInverseScreenCTM", "IPAD", "unbindSounds", "soundBinds", "oldSoundBinding", "audioMgr", "preload", "ContextMenuRegistry", "undoOption", "displayText", "scopeType", "ScopeType", "WORKSPACE", "weight", "redoOption", "getRedoStack", "cleanOption", "cleanUp", "shouldCollapse", "timeoutFn", "timeoutCounter", "ms", "DELAY", "collapseOption", "collapse", "expandOption", "deleteList", "eventGroup", "shift", "isDeadOrDying", "deleteOption", "deletableBlocksLength", "cancelCurrentGesture", "deletableBlocks", "ok", "duplicateOption", "isDuplicatable", "BLOCK", "commentOption", "hasIcon", "CommentIcon", "comments", "isEditable", "inlineOption", "StatementInput", "collapseExpandOption", "disableOption", "isDisabledForOtherReason", "getInheritedDisabled", "descendantCount", "helpOption", "helpUrl", "showHelp", "createOption", "pixelCoord", "finalOffset", "toolboxItem", "opt_onlyClosePopups", "CONNECTION_CHECKER", "CONNECTION_PREVIEWER", "CURSOR", "INPUT", "TOOLBOX", "THEME", "TOOLBOX_ITEM", "FLYOUTS_VERTICAL_TOOLBOX", "FLYOUTS_HORIZONTAL_TOOLBOX", "METRICS_MANAGER", "BLOCK_DRAGGER", "$jscomp$tmp$exports$module$name", "soup", "soupLength", "VAR_DELETE", "VAR_RENAME", "BLOCK_DRAG", "MARKER_MOVE", "TRASHCAN_OPEN", "TOOLBOX_ITEM_SELECT", "THEME_CHANGE", "COMMENT_DELETE", "COMMENT_CHANGE", "COMMENT_COLLAPSE", "draggingConnections", "Abstract", "toJson", "isBlank", "run", "_forward", "getEventWorkspace_", "UiBase", "AbstractEvent", "opt_workspaceId", "Click", "opt_block", "opt_targetType", "targetType", "newEvent", "ClickTarget", "ZOOM_CONTROLS", "TOUCH_ENABLED", "globalThis", "rawUserAgent", "isJavaFx", "isWebKit", "isGecko", "isAndroid", "isIPad", "isIPhone", "isMac", "isTablet", "isMobile", "raw", "rawUpper", "maxTouchPoints", "GECKO", "ANDROID", "IPHONE", "MOBILE", "Capability", "name_", "POSITIONABLE", "DRAG_TARGET", "DELETE_AREA", "AUTOHIDEABLE", "ComponentManager", "componentData", "Map", "capabilityToComponentIds", "addComponent", "componentInfo", "component", "capabilities", "stringCapabilities", "capability", "removeComponent", "addCapability", "getComponent", "hasCapability", "removeCapability", "getComponents", "sorted", "componentIds", "components", "componentDataList", "componentDatum", "tx", "ty", "distance", "COMMENT_NODE", "CLIPPATH", "FECOMPOSITE", "FECOMPONENTTRANSFER", "FEFLOOD", "FEFUNCA", "FEGAUSSIANBLUR", "FEPOINTLIGHT", "FESPECULARLIGHTING", "FILTER", "FOREIGNOBJECT", "G", "IMAGE", "LINE", "PATH", "PATTERN", "POLYGON", "RECT", "TEXT", "TSPAN", "getHeight", "other", "opt_pair", "opt_class", "opt_margin", "oldHostMetrics", "ratio", "origin", "startDragHandle", "handlePosition", "handleLength", "scrollbarLength", "startDragMouse", "containerVisible", "isHandleVisible", "onMouseMoveWrapper_", "onMouseUpWrapper_", "pair", "DEFAULT_SCROLLBAR_MARGIN", "outerSvg", "svgBackground", "svgHandle", "setInitialThickness", "lengthAttribute_", "positionAttribute_", "onMouseDownBarWrapper_", "onMouseDownBar", "onMouseDownHandleWrapper_", "onMouseDownHandle", "unsubscribe", "constrainHandleLength", "setHandleLength", "newLength", "constrainHandlePosition", "setHandlePosition", "newPosition", "setScrollbarLength", "newSize", "setPosition", "opt_metrics", "hostMetrics", "getMetrics", "metricsAreEquivalent", "resizeHorizontal", "resizeVertical", "updateMetrics", "requiresViewResize", "viewWidth", "viewHeight", "absoluteLeft", "absoluteTop", "resizeViewHorizontal", "resizeContentHorizontal", "viewSize", "xCoordinate", "scrollWidth", "setVisible", "maxScrollDistance", "maxHandleOffset", "handleOffset", "resizeViewVertical", "resizeContentVertical", "scrollHeight", "setContainerVisible", "visibilityChanged", "updateDisplay_", "setVisibleInternal", "mouseXY", "getInverseScreenCTM", "mouseLocation", "handleXY", "handleStart", "pageLength", "onMouseUpHandle", "onMouseMoveHandle", "getRatio_", "setOrigin", "DOWN", "SPRITE", "url", "ZoomControls", "boundEvents", "zoomResetGroup", "zoomOutGroup", "zoomInGroup", "HEIGHT", "WIDTH", "SMALL_SPACING", "LARGE_SPACING", "MARGIN_HORIZONTAL", "MARGIN_VERTICAL", "createZoomOutSvg", "createZoomInSvg", "createZoomResetSvg", "getComponentManager", "cornerPosition", "positionRect", "zoomInTranslateY", "zoomOutTranslateY", "clip", "zoomoutSvg", "setAttributeNS", "zoom", "zoominSvg", "amount", "zoomCenter", "fireZoomEvent", "zoomresetSvg", "resetZoom", "log", "scaleSpeed", "beginCanvasTransition", "scrollCenter", "endCanvasTransition", "uiEvent", "COLLAPSED_INPUT_NAME", "COLLAPSED_FIELD_NAME", "MUTATOR", "WARNING", "CUSTOM", "setLocale", "locale", "k", "VarBase", "opt_variable", "varId", "VarCreate", "varType", "varName", "deleteVariableById", "opt_id", "id_", "var1", "var2", "CATEGORY_NAME", "WeakSet", "WeakMap", "location", "disposing", "addTopComment", "fireCreateEvent", "fireDeleteEvent", "fireChangeEvent", "oldText", "newText", "fireCollapseEvent", "newCollapsed", "setReason", "recordNew", "removeTopComment", "BUBBLE", "CommentView", "textChangeListeners", "sizeChangeListeners", "disposeListeners", "collapseChangeListeners", "resizePointerMoveListener", "resizePointerUpListener", "svgRoot", "highlightRect", "createHighlightRect", "topBarGroup", "topBarBackground", "deleteIcon", "foldoutIcon", "textPreview", "textPreviewNode", "createTopBar", "foreignObject", "textArea", "createTextArea", "resizeHandle", "createResizeHandle", "onFoldoutDown", "onDeleteDown", "onTextChange", "onResizePointerDown", "getBBox", "topBarSize", "deleteSize", "foldoutSize", "textPreviewSize", "resizeSize", "calcMinSize", "oldSize", "updateHighlightRect", "updateTopBarSize", "updateTextAreaSize", "updateDeleteIconPosition", "updateFoldoutIconPosition", "updateTextPreviewSize", "updateResizeHandlePosition", "onSizeChange", "updateTextPreview", "textPreviewWidth", "foldoutMargin", "calcFoldoutMargin", "deleteMargin", "calcDeleteMargin", "checkVisibility", "textPreviewMargin", "addSizeChangeListener", "listener", "removeSizeChangeListener", "bringToFront", "onResizePointerUp", "onResizePointerMove", "delta", "moveDrag", "onCollapse", "addOnCollapseListener", "removeOnCollapseListener", "addTextChangeListener", "removeTextChangeListener", "truncateText", "addDisposeListener", "removeDisposeListener", "CommentDragStrategy", "startLoc", "moveToDragLayer", "setDragging", "newLoc", "moveDuringDrag", "fireMoveEvent", "moveOffDragLayer", "snapToGrid", "oldCoordinate_", "VARIABLES", "PROCEDURES", "BLOCKS", "WORKSPACE_COMMENTS", "saveComment", "WorkspaceCommentSerializer", "commentStates", "commentState", "WorkspaceCommentPaster", "DEFAULT_SNAP_RADIUS", "dragRadius", "flyoutDragRadius", "connectingSnapRadius", "currentConnectionPreference", "bumpDelay", "GRID", "GRIDCELL", "GROUP", "LISTBOX", "MENUITEMCHECKBOX", "OPTION", "PRESENTATION", "ROW", "TREE", "TREEITEM", "menuItems", "onKeyDownHandler", "mouseLeaveHandler", "mouseEnterHandler", "clickHandler", "mouseOverHandler", "highlightedItem", "openingCoords", "handleMouseOver", "handleClick", "handleMouseEnter", "handleMouseLeave", "handleKeyEvent", "getElement", "preventScroll", "blur", "getMenuItem", "menuElem", "currentElement", "setHighlighted", "currentHighlighted", "ACTIVEDESCENDANT", "highlightNext", "highlightHelper", "highlightPrevious", "highlightFirst", "highlightLast", "startIndex", "oldCoords", "newCoords", "performAction", "shiftKey", "metaKey", "altKey", "highlighted", "opt_value", "rightToLeft", "highlight", "checked", "checkable", "checkbox", "contentDom", "DISABLED", "setCheckable", "setChecked", "nameDep", "DeserializationError", "toDevString", "childState", "saveBlock", "BlockSerializer", "blockStates", "BlockBase", "BlockChange", "opt_element", "opt_oldValue", "opt_newValue", "oldValue", "disabledReason", "setValue", "oldState", "getExtraBlockState_", "JSON", "stringify", "getBoundsInfo", "boundPosition", "boundSize", "clientTop", "MarkerManager", "cursorSvg_", "cursor_", "markers", "markerSvg_", "registerMarker", "marker", "unregisterMarker", "setDrawer", "makeMarkerDrawer", "setMarkerSvg", "getDrawer", "getCursor", "getMarker", "setCursor", "cursor", "drawer", "setCursorSvg", "cursorSvg", "getBlockCanvas", "markerSvg", "updateMarkers", "keyboardAccessibilityMode", "draw", "markerIds", "markerId", "LOCAL_MARKER", "validator", "DEFAULT_VALUE", "constants_", "mouseDownWrapper_", "textContent_", "textElement_", "borderRect_", "fieldGroup_", "tooltip_", "validator_", "maxDisplayLength", "sourceBlock_", "enabled_", "visible_", "isDirty_", "suffixField", "prefixField", "clickTarget_", "EDITABLE", "SERIALIZABLE", "value_", "size_", "SKIP_SETUP", "configure_", "setValidator", "setSourceBlock", "getConstants", "bindEvents_", "createBorderRect_", "createTextElement_", "isFullBlockField", "FIELD_BORDER_RECT_RADIUS", "FIELD_TEXT_BASELINE_CENTER", "clickTarget", "getClickTarget_", "onMouseDown_", "fieldElement", "_doFullSerialization", "legacyState", "saveLegacyState", "loadLegacyState", "callingClass", "isClickable", "showEditor_", "isClickableInFlyout", "autoClosingFlyout", "isCurrentlyEditable", "handler", "getValidator", "getBorderRect", "getTextElement", "getTextContent", "render_", "nodeValue", "getDisplayText_", "updateSize_", "showEditor", "constants", "xOffset", "FIELD_BORDER_RECT_X_PADDING", "totalWidth", "totalHeight", "FIELD_TEXT_HEIGHT", "contentWidth", "FIELD_TEXT_FONTSIZE", "FIELD_TEXT_FONTWEIGHT", "FIELD_TEXT_FONTFAMILY", "FIELD_BORDER_RECT_HEIGHT", "positionTextElement_", "positionBorderRect_", "halfHeight", "FIELD_TEXT_BASELINE", "getAbsoluteXY_", "_", "NBSP", "getText_", "markDirty", "forceRerender", "classValidation", "doClassValidation_", "classValue", "processValidation_", "localValidation", "localValue", "doValueUpdate_", "validatedValue", "doValueInvalid_", "_invalidValue", "_fireChangeEvent", "getGesture", "setStartField", "newTip", "getTooltip", "referencesVariables", "refreshVariableName", "getParentInput", "parentInput", "idx", "fieldRows", "getFlipRtl", "isTabNavigable", "onShortcut", "_shortcut", "updateMarkers_", "_options", "Symbol", "registry_", "reset", "getContextMenuOptions", "menuOptions", "precondition", "menuOption", "dragStrategy", "view", "addModelUpdateBindings", "startGesture", "dragging", "handleCommentStart", "setDeleteStyle", "wouldDelete", "showContextMenu", "grid", "getGrid", "shouldSnap", "currentXY", "alignedXY", "alignXY", "BlockCreate", "allShadowBlocks", "shadows", "ThemeChange", "opt_themeName", "themeName", "ViewportChange", "opt_top", "opt_left", "opt_scale", "opt_oldScale", "ConnectionType", "INPUT_VALUE", "OUTPUT_VALUE", "NEXT_STATEMENT", "PREVIOUS_STATEMENT", "ConnectionDB", "connections", "addConnection", "yPos", "calculateIndexForYPos", "findIndexOfConnection", "conn", "bestGuess", "pointer", "pointerMin", "pointerMax", "pointerMid", "removeConnection", "getNeighbours", "maxRadius", "checkConnection", "yIndex", "currentX", "db", "currentY", "neighbours", "isInYRange", "baseY", "searchForClosest", "dxy", "baseX", "closestIndex", "bestConnection", "bestRadius", "distanceFrom", "dbList", "WorkspaceDragger", "horizontalScrollEnabled_", "isMovableHorizontally", "verticalScrollEnabled_", "isMovableVertically", "startScrollXY_", "currentDragDeltaXY", "newXY", "scroll", "ZOOM_IN_MULTIPLIER", "ZOOM_OUT_MULTIPLIER", "creatorWorkspace", "mouseDownXY", "startWorkspace_", "startComment", "startIcon", "startField", "startBubble", "hasExceededDragRadius", "workspaceDragger", "dragger", "isMultiTouch_", "isEnding_", "gestureHasStarted", "calledUpdateIsDragging", "cachedPoints", "startDistance", "previousScale", "currentDropdownOwner", "isPinchZoomEnabled", "mostRecentEvent", "clearGesture", "updateFromEvent", "updateDragDelta", "changed", "updateIsDragging", "currentDragDelta", "updateIsDraggingFromFlyout", "isBlockCreatable", "isScrollable", "isDragTowardWorkspace", "updateScreenCalculationsIfScrolled", "createBlock", "updateIsDraggingWorkspace", "createDragger", "onDragStart", "onDrag", "draggable", "DraggerClass", "doStart", "pinch", "cancel", "pointerType", "handleTouchStart", "handleMove", "handleUp", "isMultiTouch", "handleTouchMove", "handleTouchEnd", "onDragEnd", "isBubbleClick", "isCommentClick", "isFieldClick", "doFieldClick", "isIconClick", "doIconClick", "isBlockClick", "doBlockClick", "isWorkspaceClick", "doWorkspaceClick", "getTouchPoint", "pointers", "point0", "point1", "handlePinch", "moveDistance", "gestureScale", "bringBlockToFront", "handleWsStart", "setStartWorkspace", "fireWorkspaceClick", "handleFlyoutStart", "setStartFlyout", "handleBlockStart", "setStartBlock", "handleBubbleStart", "bubble", "setStartBubble", "setStartComment", "autoClose", "setStartIcon", "setTargetBlock", "hasStartBubble", "hasStartBlock", "handleInFlyout", "getCurrentDragger", "hasStarted", "currentGesture_", "pattern", "spacing", "line2", "line1", "setSpacing", "update", "getSpacing", "setLength", "getLength", "setSnapToGrid", "snap", "getPatternId", "safeSpacing", "half", "end", "setLineAttributes", "x1", "x2", "y1", "y2", "Theme", "opt_blockStyles", "opt_categoryStyles", "opt_componentStyles", "startHats", "blockStyles", "categoryStyles", "componentStyles", "fontStyle", "setBlockStyle", "blockStyleName", "blockStyle", "setCategoryStyle", "categoryStyleName", "categoryStyle", "getComponentStyle", "componentName", "recursiveStyle", "setComponentStyle", "styleValue", "setFontStyle", "setStartHats", "defineTheme", "themeObj", "base", "defaultBlockStyles", "Classic", "toolboxJsonDef", "hasCollapse", "hasComments", "hasDisable", "rawHasTrashcan", "rawHasCollapse", "rawHasComments", "rawHasDisable", "rawHasSounds", "maxTrashcanContents", "toolboxAtStart", "toolboxPosition", "endsWith", "rawOneBasedIndex", "modalInputs", "oneBasedIndex", "maxBlocks", "maxInstances", "parseMoveOptions_", "hasScrollbars", "parseGridOptions_", "parseZoomOptions_", "parseThemeOptions_", "rendererOverrides", "move", "wheel", "maxScale", "minScale", "reservedWordsList", "opt_variablePrefix", "dbReverse", "variableMap", "variablePrefix", "reservedWords", "setVariableMap", "getNameForUserVariable", "populateVariables", "NameType", "VARIABLE", "nameOrId", "normalizedName", "DEVELOPER_VARIABLE", "typeDb", "safeName", "getDistinctName", "getUserNames", "userNames", "encodeURI", "name1", "name2", "PROCEDURE", "DEVELOPER_VARIABLE_TYPE", "ObservableProcedureMap", "existed", "Icon", "offsetInBlock", "workspaceLocation", "pointerdownListener", "svgBlock", "updateSvgRootOffset", "menuGenerator", "svgArrow", "imageElement", "selectedMenuItem", "generatedOptions", "trimmed", "menuGenerator_", "selectedOption", "shouldAddBorderRect_", "FIELD_DROPDOWN_SVG_ARROW", "createSVGArrow_", "createTextArrow_", "FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW", "ARROW_CHAR", "FIELD_DROPDOWN_SVG_ARROW_SIZE", "FIELD_DROPDOWN_SVG_ARROW_DATAURI", "dropdownCreate", "menuElement", "FIELD_DROPDOWN_COLOURED_DIV", "primaryColour", "getColour", "colourTertiary", "dropdownDispose_", "image", "Image", "handleMenuActionEvent", "onItemSelected_", "useCache", "isValueValid", "fill", "colourSecondary", "colourPrimary", "renderSelectedImage", "renderSelectedText", "imageJson", "imageHeight", "imageWidth", "hasBorder", "FIELD_DROPDOWN_BORDER_RECT_HEIGHT", "IMAGE_Y_PADDING", "xPadding", "arrowWidth", "positionSVGArrow", "textWidth", "textPadding", "FIELD_DROPDOWN_SVG_ARROW_PADDING", "svgArrowSize", "CHECKMARK_OVERHANG", "MAX_MENU_HEIGHT_VH", "IMAGE_Y_OFFSET", "BubbleDragStrategy", "_a", "Bubble", "anchor", "ownerRect", "relativeLeft", "relativeTop", "getBubbleCanvas", "embossGroup", "embossFilterId", "tail", "background", "BORDER_WIDTH", "contentContainer", "onMouseDown", "setAnchorLocation", "relayout", "positionByRect", "positionRelativeToAnchor", "renderTail", "setPositionRelativeToAnchor", "MIN_SIZE", "optimalLeft", "getOptimalRelativeLeft", "optimalTop", "getOptimalRelativeTop", "topPosition", "MIN_BLOCK_HEIGHT", "startPosition", "endPosition", "bottomPosition", "closerPosition", "fartherPosition", "topPositionOverlap", "getOverlap", "startPositionOverlap", "closerPositionOverlap", "fartherPositionOverlap", "mostOverlap", "relativeMin", "workspaceRect", "getWorkspaceViewRect", "bubbleRight", "bubbleLeft", "getScrollbarThickness", "relBubbleX", "relBubbleY", "relAnchorX", "relAnchorY", "hypotenuse", "rise", "angle", "acos", "rightAngle", "rightRise", "rightRun", "cos", "thickness", "TAIL_THICKNESS", "backoffRatio", "ANCHOR_RADIUS", "baseX1", "baseY1", "radians", "TAIL_ANGLE", "swirlAngle", "swirlRise", "TAIL_BEND", "swirlRun", "baseX2", "baseY2", "lastChild", "_start", "_enable", "DOUBLE_BORDER", "MiniWorkspaceBubble", "workspaceOptions", "autoLayout", "validateWorkspaceOptions", "svgDialog", "miniWorkspace", "newWorkspaceSvg", "internalIsMutator", "getCanvas", "onWorkspaceChange", "updateBubbleSize", "addWorkspaceChangeListener", "bumpBlocksIntoBounds", "MARGIN", "currSize", "calculateWorkspaceSize", "MINIMUM_VIEW_CHANGE", "recordDragTargets", "workspaceSize", "flyoutScrollMetrics", "updateBlockStyles", "setStyle", "getStyleName", "flyoutWs", "SIZE", "WORKSPACE_MARGIN", "flyoutBlockTypes", "saveConnectionsListener", "updateWorkspacePid", "rootBlock", "miniWorkspaceBubble", "WEIGHT", "getAnchorLocation", "getMiniWorkspaceConfig", "getBubbleOwnerRect", "createRootBlock", "addSaveConnectionsListener", "createMiniWorkspaceChangeListener", "removeChangeListener", "midIcon", "flyoutWidth", "saveConnections", "isIgnorableMutatorEvent", "recomposeSourceBlock", "oldExtraState", "newExtraState", "WIN_KEY_FF_LINUX", "MAC_ENTER", "TAB", "NUM_CENTER", "ENTER", "PAUSE", "CAPS_LOCK", "SPACE", "PAGE_UP", "PAGE_DOWN", "END", "HOME", "PLUS_SIGN", "PRINT_SCREEN", "INSERT", "ZERO", "ONE", "TWO", "THREE", "FOUR", "FIVE", "SIX", "SEVEN", "EIGHT", "NINE", "FF_SEMICOLON", "FF_EQUALS", "FF_DASH", "FF_HASH", "QUESTION_MARK", "AT_SIGN", "A", "B", "D", "E", "F", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "W", "WIN_KEY_RIGHT", "CONTEXT_MENU", "NUM_ZERO", "NUM_ONE", "NUM_TWO", "NUM_THREE", "NUM_FOUR", "NUM_FIVE", "NUM_SIX", "NUM_SEVEN", "NUM_EIGHT", "NUM_NINE", "NUM_MULTIPLY", "NUM_PLUS", "NUM_MINUS", "NUM_PERIOD", "NUM_DIVISION", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "NUMLOCK", "SCROLL_LOCK", "FIRST_MEDIA_KEY", "LAST_MEDIA_KEY", "SEMICOLON", "DASH", "EQUALS", "COMMA", "PERIOD", "SLASH", "APOSTROPHE", "TILDE", "SINGLE_QUOTE", "OPEN_SQUARE_BRACKET", "BACKSLASH", "CLOSE_SQUARE_BRACKET", "WIN_KEY", "MAC_FF_META", "MAC_WK_CMD_LEFT", "MAC_WK_CMD_RIGHT", "WIN_IME", "VK_NONAME", "PHANTOM", "aria", "arrayUtils", "browserEvents", "deprecation", "extensions", "idGenerator", "math", "parsing", "stringUtils", "svgMath", "svgPaths", "userAgent", "TextBubble", "paragraph", "stringToSvg", "createParagraph", "spans", "createSpans", "rightAlignSpans", "tspan", "maxWidth", "TextInputBubble", "DEFAULT_SIZE", "inputRoot", "createEditor", "resizeGroup", "bindTextAreaEvents", "onStartEdit", "widthMinusBorder", "heightMinusBorder", "DEFAULT_BUBBLE_WIDTH", "DEFAULT_BUBBLE_HEIGHT", "textBubble", "textInputBubble", "bubbleSize", "bubbleVisiblity", "anchorLocation", "showEditableBubble", "showNonEditableBubble", "hideBubble", "WarningIcon", "textMap", "addMessage", "DuplicateIconType", "exceptions", "TypesContainer", "NONE", "HAT", "SPACER", "BETWEEN_ROW_SPACER", "IN_ROW_SPACER", "EXTERNAL_VALUE_INPUT", "INLINE_INPUT", "STATEMENT_INPUT", "CONNECTION", "PREVIOUS_CONNECTION", "NEXT_CONNECTION", "OUTPUT_CONNECTION", "CORNER", "LEFT_SQUARE_CORNER", "LEFT_ROUND_CORNER", "RIGHT_SQUARE_CORNER", "RIGHT_ROUND_CORNER", "JAGGED_EDGE", "TOP_ROW", "BOTTOM_ROW", "INPUT_ROW", "LEFT_CORNER", "RIGHT_CORNER", "nextTypeValue_", "hasOwnProperty", "isField", "isHat", "isSpacer", "isInRowSpacer", "isInput", "isExternalInput", "isInlineInput", "isStatementInput", "isPreviousConnection", "isNextConnection", "isPreviousOrNextConnection", "isLeftRoundedCorner", "isRightRoundedCorner", "isLeftSquareCorner", "isRightSquareCorner", "isCorner", "isJaggedEdge", "isRow", "row", "isBetweenRowSpacer", "isTopRow", "isBottomRow", "isTopOrBottomRow", "isInputRow", "Types", "Measurable", "centerline", "xPos", "notchOffset", "NOTCH_OFFSET_LEFT", "Row", "elements", "widthWithConnectedBlocks", "minWidth", "minHeight", "hasStatement", "hasExternalInput", "statementEdge", "hasJaggedEdge", "hasDummyInput", "hasInlineInput", "align", "getLastInput", "measure", "startsWithElemSpacer", "endsWithElemSpacer", "getFirstSpacer", "getLastSpacer", "BottomRow", "hasNextConnection", "descenderHeight", "hasLeftSquareCorner", "hasRightSquareCorner", "_block", "Connection", "connectionModel", "shapeFor", "isHighlighted", "InputConnection", "connectionOffsetY", "connectionOffsetX", "connectedBlock", "connectedBlockWidth", "connectedBlockHeight", "ExternalValueInput", "TAB_OFFSET_FROM_TOP", "MEDIUM_PADDING", "EXTERNAL_VALUE_INPUT_PADDING", "connectionHeight", "connectionWidth", "flipRtl", "Hat", "START_HAT", "ascenderHeight", "InRowSpacer", "SPACER_DEFAULT_HEIGHT", "InlineInput", "EMPTY_INLINE_INPUT_HEIGHT", "EMPTY_INLINE_INPUT_PADDING", "STATEMENT_BOTTOM_SPACER", "EMPTY_STATEMENT_INPUT_HEIGHT", "STATEMENT_INPUT_NOTCH_OFFSET", "InputRow", "connectedBlockWidths", "JaggedEdge", "JAGGED_TEETH", "NextConnection", "OutputConnection", "startX", "PreviousConnection", "RoundCorner", "opt_position", "CORNER_RADIUS", "SpacerRow", "precedesStatement", "followsStatement", "SquareCorner", "NO_PADDING", "TopRow", "capline", "hasPreviousConnection", "hasHat", "hat", "ADD_START_HATS", "prevBlock", "getPreviousBlock", "ConstantProvider", "SMALL_PADDING", "MEDIUM_LARGE_PADDING", "LARGE_PADDING", "TAB_HEIGHT", "TAB_VERTICAL_OVERLAP", "TAB_WIDTH", "NOTCH_WIDTH", "NOTCH_HEIGHT", "MIN_BLOCK_WIDTH", "EMPTY_BLOCK_SPACER_HEIGHT", "STATEMENT_INPUT_PADDING_LEFT", "BETWEEN_STATEMENT_PADDING_Y", "START_HAT_HEIGHT", "START_HAT_WIDTH", "JAGGED_TEETH_HEIGHT", "JAGGED_TEETH_WIDTH", "FIELD_BORDER_RECT_Y_PADDING", "FIELD_BORDER_RECT_COLOUR", "FIELD_COLOUR_FULL_BLOCK", "FIELD_TEXTINPUT_BOX_SHADOW", "FIELD_COLOUR_DEFAULT_WIDTH", "embossFilter", "disabledPatternId", "disabledPattern", "debugFilterId", "debugFilter", "CURSOR_COLOUR", "MARKER_COLOUR", "CURSOR_WS_WIDTH", "WS_CURSOR_HEIGHT", "CURSOR_STACK_PADDING", "CURSOR_BLOCK_PADDING", "CURSOR_STROKE_WIDTH", "FULL_BLOCK_FIELDS", "INSERTION_MARKER_COLOUR", "INSERTION_MARKER_OPACITY", "SHAPES", "PUZZLE", "NOTCH", "TALL_INPUT_FIELD_OFFSET_Y", "DUMMY_INPUT_SHADOW_MIN_HEIGHT", "DUMMY_INPUT_MIN_HEIGHT", "TOP_ROW_MIN_HEIGHT", "TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT", "BOTTOM_ROW_MIN_HEIGHT", "BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT", "START_POINT", "FIELD_COLOUR_DEFAULT_HEIGHT", "FIELD_CHECKBOX_X_OFFSET", "randomIdentifier", "makeJaggedTeeth", "makeNotch", "makeStartHat", "PUZZLE_TAB", "makePuzzleTab", "INSIDE_CORNERS", "makeInsideCorners", "OUTSIDE_CORNERS", "makeOutsideCorners", "setTheme", "validatedBlockStyle_", "setDynamicProperties_", "setFontConstants_", "setComponentConstants_", "fontMetrics", "getBlockStyleForColour", "createBlockStyle_", "getBlockStyle", "valid", "assign", "parsedColour", "generateSecondaryColour_", "generateTertiaryColour_", "inputColour", "mainPath", "path", "makeMainPath", "up", "back", "control1Y", "overlap", "control2Y", "endPoint1", "endPoint2", "dir", "outerWidth", "innerWidth", "innerTopLeftCorner", "innerBottomLeftCorner", "pathTop", "pathBottom", "topLeft", "topRight", "bottomLeft", "bottomRight", "rightHeight", "selector", "injectCSS_", "feSpecularLighting", "createDebugFilter", "debugComponentTransfer", "cssArray", "getCSS_", "cssNodeId", "Drawer", "info", "inlinePath_", "outlinePath_", "block_", "info_", "topLeft_", "drawOutline_", "drawInternals_", "updateConnectionHighlights", "pathObject", "setPath", "flipRTL", "recordSizeOnBlock_", "widthWithChildren", "drawTop_", "rows", "drawJaggedEdge_", "drawStatementInput_", "drawValueInput_", "drawRightSideRow_", "drawBottom_", "drawLeft_", "topRow", "positionPreviousConnection_", "startY", "positionExternalValueConnection_", "innerHeight", "positionStatementInputConnection_", "bottomRow", "elems", "positionNextConnection_", "rightCornerYOffset", "outlinePath", "positionOutputConnection_", "tabBottom", "drawInlineInput_", "layoutField_", "fieldInfo", "connectionTop", "connectionBottom", "positionInlineInputConnection_", "connX", "connInfo", "drawConnectionHighlightPath", "removeConnectionHighlight", "measurable", "getExpressionConnectionHighlightPath", "getStatementConnectionHighlightPath", "addConnectionHighlight", "getOffsetInBlock", "connPath", "yLen", "xLen", "Align", "CENTRE", "FieldLabel", "textClass", "class", "setClass", "cssClass", "Input", "appendField", "insertFieldAt", "initField", "removeField", "opt_quiet", "renderList", "renderedConnection", "startTrackingAll", "stopTrackingAll", "setCheck", "check", "setAlign", "makeConnection", "makeConnection_", "DummyInput", "EndRowInput", "ValueInput", "RenderInfo", "inputRows", "renderer_", "isInline", "createRows_", "addElemSpacing_", "addRowSpacing_", "computeBounds_", "alignRowElements_", "finalize_", "populateTopRow_", "activeRow", "iconInfo", "lastInput", "shouldStartNewRow_", "addInput_", "populateBottomRow_", "hasPrevious", "cornerClass", "leftSquareCorner", "rightSquareCorner", "StatementInputMeasurable", "currInput", "prevInput", "oldElems", "getInRowSpacing_", "prev", "widestStatementRowFields", "blockWidth", "widestRowWithConnectedBlocks", "statementInput", "alignStatementRow_", "currentWidth", "missingSpace", "getDesiredRowWidth_", "desiredWidth", "addAlignmentPadding_", "_row", "firstSpacer", "lastSpacer", "oldRows", "makeSpacerRow_", "getSpacerRowHeight_", "getSpacerRowWidth_", "spacer", "_prev", "_next", "getElemCenterline_", "recordElemPositions_", "xCursor", "yCursor", "getMeasureableForConnection", "BlockDelete", "oldXml", "wasShadow", "oldJson", "shadowDom", "shadowState", "connect_", "parentBlock", "disconnectInternal", "orphan", "stashShadowState", "applyShadowState", "setParent", "orphanConnection", "getConnectionForOrphanedConnection", "onFailedConnect", "isSuperior", "setShadowStateInternal", "unplug", "_otherConnection", "otherConnection", "disconnect", "getParentAndChildConnections", "respawnShadow_", "createShadowBlock", "reconnect", "connectionParent", "currentParent", "onCheckChanged_", "getCheck", "returnCurrent", "_maxLimit", "serializeShadow", "attemptToConnect", "blockShadow", "lastConnectionInStack", "CAN_CONNECT", "REASON_SELF_CONNECTION", "REASON_WRONG_TYPE", "REASON_TARGET_NULL", "REASON_CHECKS_FAILED", "REASON_DIFFERENT_WORKSPACES", "REASON_SHADOW_PARENT", "REASON_DRAG_CHECKS_FAILED", "REASON_PREVIOUS_AND_OUTPUT", "Block", "hue_", "colour_", "styleName_", "suppressPrefixSuffix", "contextMenu", "parentBlock_", "childBlocks_", "editable_", "movable_", "deletable_", "collapsed_", "isShadow_", "outputShape_", "isInsertionMarker_", "onchangeWrapper_", "statementInputCount", "setBlockById", "xy_", "isInMutator", "addTopBlock", "addTypedBlock", "doInit_", "onchange", "setOnChange", "healStack", "removeTopBlock", "disposeInternal", "removeTypedBlock", "removeBlockById", "destroy", "opt_healStack", "unplugFromRow_", "unplugFromStack_", "thisConnection", "getOnlyValueConnection_", "previousTarget", "nextTarget", "_all", "myConnections", "ignoreShadows", "getInputWithBlock", "getSurroundParent", "getTopStackBlock", "previous", "ordered", "childBlocks", "hasBlockLimits", "isCapacityAvailable", "setInsertionMarker", "insertionMarker", "isSimpleReporter", "getMatchingConnection", "otherConnections", "setHelpUrl", "getHue", "parsed", "onchangeFn", "getVars", "vars", "updateVarName", "renameVarById", "oldId", "newId", "setFieldValue", "setPreviousStatement", "newBoolean", "opt_check", "setNextStatement", "setOutput", "setOutputShape", "outputShape", "getOutputShape", "blockChangeEvent", "ancestor", "opt_maxLength", "opt_emptyToken", "toTokens", "acc", "curr", "emptyToken", "checks", "shouldAddParens", "appendValueInput", "appendInput", "appendStatementInput", "appendDummyInput", "appendEndRowInput", "appendInputFromRegistry", "inputConstructor", "warningPrefix", "n", "jsonInitStyle_", "jsonInitColour_", "interpolate_", "localizedText", "localizedValue", "extensionNames", "styleError", "opt_disableCheck", "overwrites", "implicitAlign", "validateTokens_", "interpolateArguments_", "fieldStack", "isInputKeyword_", "inputFromJson_", "fieldFromJson_", "argsCount", "visitedArgsHash", "visitedArgsCount", "token", "newlineInput", "stringToFieldJson_", "dummyInput", "alignmentLookup", "alignment", "moveInputBefore", "refName", "inputIndex", "refIndex", "moveNumberedInputBefore", "RangeError", "removeInput", "getInputTargetBlock", "commentConstructor", "removeIcon", "setWarningText", "_text", "_opt_id", "_mutator", "find", "allInputsFilled", "opt_shadowBlocksAreFilled", "FlyoutButton", "isFlyoutLabel", "onMouseUpWrapper", "svgText", "callbackKey", "BORDER_RADIUS", "TEXT_MARGIN_X", "TEXT_MARGIN_Y", "updateTransform", "onMouseUp", "isLabel", "getButtonText", "getButtonCallback", "ASTNode", "opt_params", "wsCoordinate", "isConnectionLocation", "isConnectionType", "processParams", "getLocation", "getWsCoordinate", "isConnection", "findNextForInput", "curIdx", "NAVIGATE_ALL_FIELDS", "createFieldNode", "createInputNode", "findNextForField", "fieldIdx", "newInput", "findPrevForInput", "findPrevForField", "navigateBetweenStacks", "curLocation", "curLocationAsBlock", "navigateFlyoutContents", "curRoot", "resultIndex", "createStackNode", "types", "STACK", "BUTTON", "nextItem", "findNextLocationInFlyout", "getContents", "createButtonNode", "flyoutContents", "currentLocation", "currentIndex", "findIndex", "findTopASTNodeForBlock", "createConnectionNode", "createBlockNode", "getOutAstNodeForBlock", "findFirstFieldOrInput", "OUTPUT", "PREVIOUS", "NEXT", "in", "out", "blockPos", "DEFAULT_OFFSET_Y", "createWorkspaceNode", "createTopNode", "MarkerMove", "isCursor", "opt_oldNode", "opt_newNode", "oldNode", "CURSOR_CLASS", "MARKER_CLASS", "HEIGHT_MULTIPLIER", "MarkerSvg", "markerSvgRect_", "markerSvgLine_", "markerInput_", "markerBlock_", "svgGroup_", "currentMarkerSvg", "defaultColour", "createDomInternal_", "setParent_", "curNode", "applyColour_", "showAtLocation_", "fireMarkerEvent", "animate", "connectionType", "curNodeAsConnection", "showWithBlock_", "showWithOutput_", "showWithInput_", "showWithNext_", "showWithPrevious_", "showWithField_", "showWithCoordinates_", "showWithStack_", "showWithButton_", "showWithBlockPrevOutput", "markerHeight", "markerOffset", "connectionShape", "positionPrevious_", "positionOutput_", "positionBlock_", "showCurrent_", "positionLine_", "positionRect_", "positionInput_", "heightWidth", "yPadding", "markerPath", "curBlock", "getBlinkProperties_", "blinkProperties", "attributeName", "_curNode", "firstElementChild", "PathObject", "connectionHighlights", "highlightOffsets", "svgPath", "pathString", "updateShadow_", "updateDisabled_", "setClass_", "updateHighlighted", "updateSelected", "updateDraggingDelete", "updateInsertionMarker", "updateMovable", "updateReplacementFade", "updateShapeForInputHighlight", "_conn", "connectionPath", "currentHighlightMatchesNew", "newPath", "newOffset", "currPath", "currOffset", "InsertionMarkerManager", "activeCandidate", "lastMarker", "lastOnStack", "wouldDeleteBlock", "fadedBlock", "highlightedBlock", "markerConnection", "firstMarker", "createMarkerBlock", "availableConnections", "initAvailableConnections", "disposeInsertionMarker", "updateAvailableConnections", "wouldConnectBlock", "applyConnections", "hidePreview", "local", "inferiorConnection", "then", "dragTarget", "newCandidate", "getCandidate", "shouldDelete", "shouldUpdatePreviews", "maybeHidePreview", "maybeShowPreview", "blockJson", "available", "activeLocal", "activeClosest", "xDiff", "yDiff", "curDistance", "getStartRadius", "candidate", "myConnection", "neighbour", "componentManager", "isDeleteArea", "showPreview", "getConnectionPreviewMethod", "method", "PREVIEW_TYPE", "INPUT_OUTLINE", "showInsertionInputOutline", "INSERTION_MARKER", "showInsertionMarker", "REPLACEMENT_FADE", "showReplacementFade", "shouldHighlightConnection", "localChanged", "unhighlight", "hideReplacementFade", "hideInsertionInputOutline", "hideInsertionMarker", "isLastInStack", "imConn", "originalOffsetToTarget", "originalOffsetInBlock", "imConnConst", "positionNearConnection", "markerConn", "imBlock", "markerOutput", "markerPrev", "highlightShapeForInput", "fadeForReplacement", "getInsertionMarkers", "PreviewType", "Renderer", "overrides", "makeConstants_", "refreshDom", "previousConstants", "makeRenderInfo_", "makeDrawer_", "makePathObject", "orphanCanConnectAtEnd", "localType", "ThemeManager", "subscribedWorkspaces_", "componentDB", "prevTheme", "oldClassName", "newClassName", "refreshTheme", "componentList", "propertyName", "setProperty", "subscribeWorkspace", "unsubscribeWorkspace", "onCreateVariableButtonClick_String", "onCreateVariableButtonClick_Number", "onCreateVariableButtonClick_Colour", "COLLAPSE_CHARS", "OPPOSITE_TYPE", "RENAME_VARIABLE_ID", "DELETE_VARIABLE_ID", "ConnectionChecker", "opt_distance", "safety", "doSafetyChecks", "doTypeChecks", "doDragChecks", "errorCode", "superiorBlock", "inferiorBlock", "superiorConnection", "checkArrayOne", "checkArrayTwo", "canConnectToPrevious_", "VarDelete", "VarRename", "VariableMap", "deleteVariable", "conflictVar", "renameVariableWithConflict_", "renameVariableAndUses_", "variableId", "tempVar", "variableName", "uses", "getVariableUsesById", "procedureName", "deleteText", "confirmText", "deleteVariableInternal", "list", "getVariableTypes", "variableTypes", "flat", "Workspace", "internalIsFlyout", "isClearing", "MAX_UNDO", "connectionDBList", "topComments", "commentDB", "listeners", "undoStack_", "redoStack_", "blockDB", "typedBlocksDB", "procedureMap", "connectionCheckerClass", "sortObjects_", "SCAN_ANGLE", "aXY", "bXY", "filtered", "remainingCapacity", "remainingCapacityOfType", "copyableBlocksCount", "redo", "inputStack", "outputStack", "inputEvent", "clearUndo", "createPotentialVariableMap", "outerWs", "getById", "getAll", "SOUND_LIMIT", "WorkspaceAudio", "sounds", "lastSound_", "muted", "filenames", "audioTest", "filename", "ext", "canPlayType", "sound", "volume", "playPromise", "pause", "catch", "opt_volume", "now", "mySound", "setMuted", "getMuted", "LayerManager", "layers", "dragLayer", "createDragLayer", "animationLayer", "createAnimationLayer", "blockLayer", "createLayer", "bubbleLayer", "currentTransform", "translateLayers", "newCoord", "newScale", "translation", "layer", "layerNum", "getSvgGroup", "inserted", "sortedLayers", "num", "sib", "hasLayer", "getBlockLayer", "getBubbleLayer", "ZOOM_TO_FIT_MARGIN", "resizeHandlerWrapper", "resizesEnabled", "isVisible_", "startScrollY", "startScrollX", "dragDeltaXY", "oldLeft", "oldTop", "inverseScreenCTM", "dummyWheelListener", "configureContextMenu", "lastRecordedPageScroll", "toolbox_", "inverseScreenCTMDirty", "highlightedBlocks", "toolboxCategoryCallbacks", "flyoutButtonCallbacks", "cachedParentSvg", "topBoundedElements", "dragTargetAreas", "layerManager", "MetricsManagerClass", "setTopLevelWorkspaceMetrics_", "audioManager", "markerManager", "Variables", "registerToolboxCategoryCallback", "VariablesDynamic", "Procedures", "themeManager_", "cachedParentSvgSize", "getMarkerManager", "setMetricsManager", "updateBlockStyles_", "refreshToolboxSelection", "ctm", "opt_backgroundClass", "svgBackground_", "svgBlockCanvas_", "svgBubbleCanvas_", "onMouseWheel_", "ToolboxClass", "CursorClass", "parentSvg", "newTrashcan", "svgTrashcan", "_workspace", "svgZoomControls", "HorizontalFlyout", "VerticalFlyout", "opt_own", "updateScreenCalculations_", "positionables", "getUiMetrics", "positionable", "currScroll", "maybeFireViewportChangeEvent", "flatMap", "highlightBlock", "opt_state", "refreshSelection", "dragTargets", "targetArea", "getClientRect", "clientRect", "getDragTarget", "canWheelZoom", "canWheelMove", "scrollDelta", "commandKey", "PIXELS_PER_ZOOM_STEP", "topElements", "boundary", "topElement", "blockBoundary", "cursorY", "scaleChange", "getCTM", "center", "f", "setScale", "svgWidth", "svgHeight", "zoomToFit", "workspaceWidth", "workspaceHeight", "blocksBox", "doubleMargin", "blocksWidth", "blocksHeight", "ratioX", "ratioY", "centerOnBlock", "blockOnly", "pixelX", "pixelY", "reflow", "resizeView", "resizeContent", "getScale", "maxYScroll", "maxYDisplacement", "maxXDisplacement", "addTopBoundedElement", "removeTopBoundedElement", "reenabled", "removeButtonCallback", "getToolboxCategoryCallback", "removeToolboxCategoryCallback", "isStart", "onlyClosePopups", "autoHideables", "autoHideable", "autoHide", "xyRatio", "TrashcanOpen", "opt_isOpen", "Selected", "opt_oldElementId", "opt_newElementId", "oldElementId", "newElementId", "Marker", "getCurNode", "setCurNode", "Cursor", "BasicCursor", "getNextNode_", "validNode_", "getPreviousNode_", "isValid", "siblingOrParent", "findSiblingOrParent", "getRightMostChild", "nextNode", "registrationName", "TabNavigateCursor", "BUMP_RANDOMNESS", "RenderedConnection", "dbOpposite", "trackedState", "TrackedState", "WILL_TRACK", "TRACKED", "bumpAwayFrom", "staticConnection", "addSelect", "removeSelect", "updated", "moveToOffset", "blockTL", "tightenEfficiently", "maxLimit", "setTracking", "doTracking", "UNTRACKED", "updateDisabled", "BlockPaster", "typeCounts", "blockState", "initialCoordinates", "bumpIntoBounds", "BlockDragStrategy", "connectionPreviewer", "connectionCandidate", "startChildConn", "startParentConn", "dragOffset", "startDraggingShadow", "fireDragStartEvent", "previewerConstructor", "shouldDisconnect", "disconnectBlock", "fireDragEndEvent", "oldCoordinate", "updateConnectionPreview", "draggingBlock", "currCandidate", "getConnectionCandidate", "currCandidateIsBetter", "localIsOutputOrPrevious", "neighbourIsConnectedToRealBlock", "previewReplacement", "previewConnection", "currCandiate", "currLocal", "currNeighbour", "localPos", "neighbourPos", "currDistance", "localConns", "getLocalConnections", "rad", "warningTextDb", "mutator", "eventsInit_", "renderIsInProgress_", "visuallyDisabled", "relativeCoords", "createIconPointerDownListener", "getColourSecondary", "getColourTertiary", "oldParent", "oldXY", "layerManger", "eventsEnabled", "currLoc", "curXY", "blockBounds", "updateCollapsed_", "collapsedInputName", "collapsedFieldName", "tab", "tabCursor", "currentNode", "nextField", "open", "generateContextMenu", "customContextMenu", "updateConnectionLocations", "updateIconLocations", "updateFieldLocations", "adding", "timeout", "collapsedParent", "COLLAPSED_WARNING_ID", "removed", "wasEnabled", "styleObj", "track", "all", "scheduleSnapAndBump", "sourceConnection", "tightenChildrenEfficiently", "nextHeightWidth", "tabHeight", "setDragStrategy", "toFlyoutInfo", "kind", "toRemove", "traverseJson", "INLINE", "DragTarget", "onDragEnter", "_dragElement", "onDragOver", "onDragExit", "onDrop", "shouldPreventMove", "DeleteArea", "wouldDelete_", "couldDeleteBlock", "updateWouldDelete_", "Trashcan", "isLidOpen", "minOpenness", "lidTask", "svgLid", "lidOpen", "flyoutWorkspaceOptions", "onDelete", "BODY_HEIGHT", "LID_HEIGHT", "SPRITE_LEFT", "SPRITE_TOP", "blockMouseDownWhenOpenable", "click", "mouseOver", "mouseOut", "animateLid", "setLidOpen", "hasContents", "contentsIsOpen", "openFlyout", "string", "blocklyStyle", "fireUiEvent", "closeFlyout", "emptyContents", "setMinOpenness", "trashRect", "MARGIN_HOTSPOT", "frames", "ANIMATION_FRAMES", "setLidAngle", "MAX_LID_ANGLE", "OPACITY_MIN", "OPACITY_MAX", "ANIMATION_LENGTH", "lidAngle", "openAtRight", "newMin", "closeLid", "trashcanOpen", "cleanedJson", "cleanBlockJson", "HAS_BLOCKS_LID_ANGLE", "cleanRec", "blockInfo", "shortcuts", "keyMap", "shortcut", "registeredShortcut", "addKeyMapping", "allowCollision", "shortcutName", "removeAllKeyMappings", "keyCode", "opt_allowCollision", "shortcutNames", "removeKeyMapping", "shortcutIdx", "setKeyMap", "newKeyMap", "getKeyMap", "legacyKeyMap", "getRegistry", "legacyRegistry", "serializeKeyEvent_", "getShortcutNamesByKeyCode", "getKeyCodesByShortcutName", "serializedKey", "modifier", "modifierKeys", "getModifierState", "checkModifiers_", "modifiers", "modifierKeyCode", "Shift", "Control", "Alt", "Meta", "ProcedureSerializer", "procState", "VariableSerializer", "variableStates", "varState", "priorities", "workspaceComments", "addHorizontal", "addVertical", "oldHostMetrics_", "corner_", "vScroll", "hScroll", "isPair", "resizeH", "resizeV", "setX", "setY", "MetricsManager", "workspace_", "getDimensionsPx_", "getFlyoutMetrics", "flyoutDimensions", "getToolboxMetrics", "toolboxDimensions", "getSvgMetrics", "getAbsoluteMetrics", "flyoutMetrics", "respectToolbox", "respectFlyout", "atTop", "opt_getWorkspaceCoordinates", "svgMetrics", "vertToolbox", "getContentMetrics", "blockBox", "getComputedFixedEdges_", "opt_viewMetrics", "hScrollEnabled", "vScrollEnabled", "edges", "getPaddedContent_", "contentMetrics", "contentBottom", "contentRight", "halfWidth", "opt_contentMetrics", "fixedEdges", "paddedContent", "scrollMetrics", "contentHeight", "contentTop", "contentLeft", "toolboxWidth", "toolboxHeight", "flyoutHeight", "BaseConstantProvider", "GRID_UNIT", "CURSOR_RADIUS", "HEXAGONAL", "ROUND", "SQUARE", "SHAPE_IN_SHAPE_PADDING", "SELECTED_GLOW_COLOUR", "SELECTED_GLOW_SIZE", "REPLACEMENT_GLOW_COLOUR", "REPLACEMENT_GLOW_SIZE", "selectedGlowFilterId", "selectedGlowFilter", "replacementGlowFilterId", "SQUARED", "ROUNDED", "replacementGlowFilter", "STATEMENT_INPUT_SPACER_MIN_WIDTH", "MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH", "makeHexagonal", "makeRounded", "makeSquared", "rightWidth", "selectedGlowSize", "replacementGlowSize", "pathRightDown", "pathRightUp", "blockHeight", "remainingHeight", "maxHeight", "sweep", "_height", "curveWidth", "quarterHeight", "innerTopRightCorner", "innerBottomRightCorner", "pathTopRight", "pathBottomRight", "selectedComponentTransfer", "replacementComponentTransfer", "BaseDrawer", "beginDrawing", "outputShapeType", "endDrawing", "hasStatementInput", "drawFlatTop_", "drawRightDynamicConnection_", "drawFlatBottom_", "drawLeftDynamicConnection_", "insideCorners", "cornerHeight", "bottomRightPath", "verticalPath", "getInlineInputPath", "setOutlinePath", "connectedBottomNextConnection", "FieldImage", "altText", "Y_PADDING", "setAlt", "setOnClickHandler", "FieldInput", "spellcheck_", "htmlInput_", "isTextValid_", "isBeingEdited_", "onKeyInputWrapper_", "onKeyDownWrapper_", "valueWhenEditorWasOpened_", "fullBlockClickTarget_", "spellcheck", "resizeEditor_", "htmlInput", "INVALID", "setSpellcheck", "quietInput", "showPromptEditor_", "showInlineEditor_", "getValueFromEditorText_", "onFinishEditing_", "widgetDispose_", "widgetCreate_", "borderRadius", "BORDERRADIUS", "strokeColour", "border", "boxShadow", "getEditorText_", "bindInputEvents_", "unbindInputEvents_", "_value", "onHtmlInputKeyDown_", "onHtmlInputChange_", "setEditorValue_", "bumped", "FieldTextInput", "BaseBottomRow", "BaseStatementInput", "RightConnectionShape", "BaseTopRow", "BaseRenderInfo", "isMultiRow", "rightSide", "rightAlignedDummyInputs", "adjustXPosition_", "alignmentDivider", "notchTotalWidth", "minXPos", "prevSpacer", "nextSpacer", "hasPrevNotch", "hasNextNotch", "prevInRowSpacer", "finalizeOutputConnection_", "outputConnectionShape", "rightConnectionWidth", "finalizeHorizontalAlignment_", "totalNegativeSpacing", "lastElem", "leftNegPadding", "getNegativeSpacing_", "firstElem", "rightNegPadding", "minBlockWidth", "outerShape", "innerShape", "finalizeVerticalAlignment_", "firstRow", "hasSingleTextOrImageField", "hasNonShadowConnectedBlocks", "minVerticalTightNestingHeight", "BaseMarkerSvg", "markerCircle", "showWithInputOutput", "positionCircle", "BasePathObject", "svgPathSelected", "outlines", "remainingOutlines", "outline", "getOutlinePath", "removeOutlinePath", "BaseRenderer", "InsertionMarkerPreviewer", "draggedBlock", "staticConn", "draggedConn", "replacedBlock", "shouldUseMarkerPreview", "previewMarker", "_draggedConn", "ZelosRenderer", "dragged", "createInsertionMarker", "origBlock", "orig", "origConn", "origConns", "markerConns", "CodeGenerator", "forBlock", "FUNCTION_NAME_PLACEHOLDER_", "STATEMENT_SUFFIX", "STATEMENT_PREFIX", "INFINITE_LOOP_TRAP", "INDENT", "COMMENT_WRAP", "ORDER_OVERRIDES", "isInitialized", "RESERVED_WORDS_", "definitions_", "functionNames_", "nameDB_", "FUNCTION_NAME_PLACEHOLDER_REGEXP_", "RegExp", "workspaceToCode", "code", "blockToCode", "scrubNakedValue", "injectId", "codeString", "finish", "prefixLines", "allNestedComments", "opt_thisOnly", "scrub_", "SyntaxError", "valueToCode", "outerOrder", "ReferenceError", "innerOrder", "parensNeeded", "outerOrderClass", "innerOrderClass", "statementToCode", "addLoopTrap", "branch", "addReservedWords", "provideFunction_", "desiredName", "functionName", "codeText", "oldCodeText", "getVariableName", "getProcedureName", "_opt_thisOnly", "FlyoutMetricsManager", "flyout_", "getBoundingBox_", "blockBoundingBox", "FlyoutItemType", "WORKSPACE_AT_BLOCK_CAPACITY_DISABLED_REASON", "Flyout", "filterWrapper", "reflowWrapper", "mats", "buttons_", "permanentlyDisabled", "recycledBlocks", "SCROLLBAR_MARGIN", "height_", "width_", "dragAngleRange_", "setMetrics_", "toolboxPosition_", "tabWidth_", "rectMap_", "GAP_X", "GAP_Y", "wheel_", "filterForCapacity", "getFlyoutScale", "setAutoClose", "updateDisplay", "setContents", "positionAt_", "listen", "clearOldBlocks", "getDynamicCategoryContents", "parsedContent", "flyoutInfo", "createFlyoutInfo", "layout_", "gaps", "emptyRecycledBlocks", "defaultGap", "categoryName", "parsedDynamicContent", "dynamicContents", "dynamicGaps", "createFlyoutBlock", "addBlockGap", "addSeparatorGap", "createButton", "fnToApply", "btnInfo", "curButton", "getRecycledBlock", "blockType", "gap", "sepInfo", "newGap", "oldBlocks", "blockIsRecyclable_", "recycleBlock", "addBlockListeners_", "blockMouseDown", "originalBlock", "placeNewBlock", "initFlyoutButton_", "buttonSvg", "createRect_", "blockHW", "moveRectToBlock_", "reflowInternal_", "oldBlock", "svgRootOld", "serializeBlock", "positionNewBlock", "flyoutOffsetPixels", "oldBlockPos", "oldBlockOffsetPixels", "getX", "getY", "targetWorkspaceViewMetrics", "setBackgroundPath", "atRight", "cursorX", "allBlocks", "moveX", "dragDirection", "atan2", "range", "flyoutRect", "BIG_NUM", "oldX", "newX", "registryName", "buttons", "FieldVariable", "defaultType", "defaultVariableName", "setTypes", "variableType", "typeIsAllowed", "typeList", "isInArray", "FieldNumber", "precision", "min_", "max_", "precision_", "decimalPlaces", "setConstraints", "setMinInternal", "setMaxInternal", "setPrecisionInternal", "setMin", "getMin", "setMax", "getMax", "setPrecision", "precisionString", "toLocaleString", "maximumFractionDigits", "decimalIndex", "getPrecision", "isFinite", "toFixed", "VALUEMIN", "VALUEMAX", "FieldLabelSerializable", "FieldCheckbox", "checkChar", "CHECK_CHAR", "checkCharacter", "getValueBoolean", "setCheckCharacter", "character", "convertValueToBool_", "Dragger", "totalDelta", "moveDraggable", "getRoot", "wouldDeleteDraggable", "updateDragTarget", "newDragTarget", "pixelsToWorkspaceUnits", "rootDraggable", "origGroup", "shouldReturnToStart", "BlockDrag", "opt_isStart", "opt_blocks", "BlockFieldIntermediateChange", "BlockMove", "currentLocation_", "oldParentId", "parentId", "oldInputName", "blockConnection", "BubbleOpen", "opt_bubbleType", "BubbleType", "CommentBase", "opt_comment", "CommentCreateDeleteHelper", "CommentChange", "opt_oldContents", "opt_newContents", "oldContents_", "newContents_", "CommentCreate", "CommentDelete", "CommentMove", "comment_", "newCoordinate_", "setOldCoordinate", "CommentCollapse", "ToolboxItemSelect", "opt_oldItem", "opt_newItem", "oldItem", "newItem", "FinishedLoading", "opt_workspace", "DARK_PATH_OFFSET", "MAX_BOTTOM_WIDTH", "Highlighter", "inlineSteps_", "steps_", "RTL_", "highlightConstants_", "getHighlightConstants", "highlightOffset", "OFFSET", "outsideCornerPaths_", "OUTSIDE_CORNER", "insideCornerPaths_", "INSIDE_CORNER", "puzzleTabPaths_", "notchPaths_", "startPaths_", "jaggedTeethPaths_", "getPath", "drawTopCorner", "drawValueInput", "belowTabHeight", "drawStatementInput", "drawRightSideRow", "rightEdge", "drawBottomRow", "cornerElem", "drawLeft", "drawInlineInput", "connectionRight", "bottomHighlightWidth", "aboveTabHeight", "highlighter_", "setHighlightPath", "HighlightConstantProvider", "constantProvider", "makeInsideCorner", "makeOutsideCorner", "distance45outside", "SQRT1_2", "pathTopRtl", "pathBottomRtl", "pathBottomLtr", "distance45inside", "topLeftCornerHighlightRtl", "topLeftCornerHighlightLtr", "bottomLeftStartY", "bottomLeftPath", "highlightRtlUp", "highlightRtlDown", "verticalOverlap", "highlightLtrUp", "highlightLtrDown", "hatHeight", "pathRtl", "pathLtr", "BaseInlineInput", "hasExternalInputs", "nextRightEdge", "rowNextRightEdges", "prevRightEdge", "heightWithoutHat", "diff", "colourDark", "svgPathDark", "svgPathLight", "highlightPath", "highlightConstants", "makeHighlightConstants_", "Zelos", "ToolboxItem", "toolboxItemDef", "parentToolbox", "level_", "parent_", "getLevel", "toolboxItemDef_", "parentToolbox_", "getClickTarget", "isCollapsible", "setVisible_", "_isVisible", "ToolboxCategory", "categoryDef", "labelDom_", "iconDom_", "rowContents_", "rowDiv_", "htmlDiv_", "isDisabled_", "isHidden_", "flyoutItems_", "cssConfig_", "makeDefaultCssConfig_", "parseCategoryDef_", "parseContents_", "createDom_", "flyoutItem", "itemDef", "getColour_", "createContainer_", "LEVEL", "createRowContainer_", "pointerEvents", "createRowContentsContainer_", "createIconDom_", "createLabelDom_", "LABELLEDBY", "addColourBorder_", "rowDiv", "nestedPadding", "paddingRight", "paddingLeft", "contentsContainer", "toolboxIcon", "isHorizontal", "toolboxLabel", "borderWidth", "borderRight", "borderLeft", "styleName", "getColourfromStyle_", "parseColour_", "colourValue", "openIcon_", "iconDiv", "closedIconClass", "closeIcon_", "openIconClass", "getSelectedItem", "clearSelection", "allAncestorsExpanded_", "category", "isExpanded", "isSelected", "defaultBackgroundColour", "setDisabled", "isDisabled", "updateFlyoutContents", "newDefinition", "custom", "categorystyle", "cssconfig", "hidden", "ToolboxSeparator", "separatorDef", "CollapsibleToolboxCategory", "subcategoriesDiv_", "expanded_", "toolboxItems_", "cssConfig", "prevIsFlyoutItem", "createToolboxItem_", "ToolboxItemClass", "setExpanded", "subCategories", "getChildToolboxItems", "createSubCategoriesDom_", "EXPANDED", "subcategories", "newCategory", "newCategoryDiv", "handleToolboxItemResize", "childToolboxItems", "toggleExpanded", "Toolbox", "contentsDiv_", "HtmlDiv", "contents_", "previouslySelectedItem_", "selectedItem_", "boundEvents_", "toolboxDef_", "horizontalLayout_", "contentMap_", "createFlyout_", "themeManager", "createContentsContainer_", "attachEvents_", "toolboxContainer", "flexDirection", "clickEvent", "onClick_", "keyDownEvent", "onKeyDown_", "itemId", "getToolboxItemById", "setSelectedItem", "handled", "selectNext_", "selectPrevious_", "selectParent_", "selectChild_", "renderContents_", "fragment", "createDocumentFragment", "addToolboxItem_", "toolboxItemDom", "getToolboxItems", "addStyle", "removeStyle", "toolboxRect", "updateCursorDeleteStyle_", "getPreviouslySelectedItem", "workspaceMetrics", "toolboxDiv", "childAsCategory", "shouldDeselectItem_", "deselectItem_", "shouldSelectItem_", "selectItem_", "updateFlyout_", "fireSelectEvent_", "selectItemByPosition", "oldElement", "collapsibleItem", "nextItemIdx", "prevItemIdx", "prevItem", "VERSION", "TOOLBOX_AT_TOP", "TOOLBOX_AT_BOTTOM", "TOOLBOX_AT_LEFT", "TOOLBOX_AT_RIGHT", "VARIABLE_CATEGORY_NAME", "VARIABLE_DYNAMIC_CATEGORY_NAME", "PROCEDURE_CATEGORY_NAME", "Workspace.prototype.newBlock", "WorkspaceSvg.prototype.newBlock", "Workspace.prototype.newComment", "WorkspaceSvg.prototype.newComment", "WorkspaceSvg.newTrashcan", "MiniWorkspaceBubble.prototype.newWorkspaceSvg", "Names.prototype.populateProcedures", "flattenedProcedures", "DropDownDiv", "dropDownDiv", "ContextMenu", "ContextMenuItems", "Css", "Events", "Extensions", "ShortcutItems", "Themes", "Tooltip", "Touch", "WidgetDiv", "Xml", "blockAnimations", "blockRendering", "bubbles", "bumpObjects", "clipboard", "common", "dialog", "fieldRegistry", "geras", "renderManagement", "serialization", "thrasos", "uiPosition", "utils", "zelos"]
}
